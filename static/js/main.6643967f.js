/*! For license information please see main.6643967f.js.LICENSE.txt */
(()=>{var e={1132:(e,t)=>{"use strict";var i,r=Symbol.for("react.element"),s=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),l=Symbol.for("react.provider"),h=Symbol.for("react.context"),c=Symbol.for("react.server_context"),u=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),_=Symbol.for("react.suspense_list"),p=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),g=Symbol.for("react.offscreen");function m(e){if("object"===typeof e&&null!==e){var t=e.$$typeof;switch(t){case r:switch(e=e.type){case n:case o:case a:case d:case _:return e;default:switch(e=e&&e.$$typeof){case c:case h:case u:case f:case p:case l:return e;default:return t}}case s:return t}}}i=Symbol.for("react.module.reference"),t.ForwardRef=u,t.isFragment=function(e){return m(e)===n},t.isMemo=function(e){return m(e)===p}},6816:(e,t,i)=>{"use strict";e.exports=i(1132)},2730:(e,t,i)=>{"use strict";var r=i(5043),s=i(8853);function n(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,i=1;i<arguments.length;i++)t+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,o={};function l(e,t){h(e,t),h(e+"Capture",t)}function h(e,t){for(o[e]=t,e=0;e<t.length;e++)a.add(t[e])}var c=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),u=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,_={},p={};function f(e,t,i,r,s,n,a){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=i,this.propertyName=e,this.type=t,this.sanitizeURL=n,this.removeEmptyString=a}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){g[e]=new f(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];g[t]=new f(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){g[e]=new f(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){g[e]=new f(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){g[e]=new f(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){g[e]=new f(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){g[e]=new f(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){g[e]=new f(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){g[e]=new f(e,5,!1,e.toLowerCase(),null,!1,!1)}));var m=/[\-:]([a-z])/g;function b(e){return e[1].toUpperCase()}function v(e,t,i,r){var s=g.hasOwnProperty(t)?g[t]:null;(null!==s?0!==s.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,i,r){if(null===t||"undefined"===typeof t||function(e,t,i,r){if(null!==i&&0===i.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==i?!i.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,i,r))return!0;if(r)return!1;if(null!==i)switch(i.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,i,s,r)&&(i=null),r||null===s?function(e){return!!u.call(p,e)||!u.call(_,e)&&(d.test(e)?p[e]=!0:(_[e]=!0,!1))}(t)&&(null===i?e.removeAttribute(t):e.setAttribute(t,""+i)):s.mustUseProperty?e[s.propertyName]=null===i?3!==s.type&&"":i:(t=s.attributeName,r=s.attributeNamespace,null===i?e.removeAttribute(t):(i=3===(s=s.type)||4===s&&!0===i?"":""+i,r?e.setAttributeNS(r,t,i):e.setAttribute(t,i))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(m,b);g[t]=new f(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(m,b);g[t]=new f(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(m,b);g[t]=new f(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){g[e]=new f(e,1,!1,e.toLowerCase(),null,!1,!1)})),g.xlinkHref=new f("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){g[e]=new f(e,1,!1,e.toLowerCase(),null,!0,!0)}));var y=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,T=Symbol.for("react.element"),x=Symbol.for("react.portal"),A=Symbol.for("react.fragment"),C=Symbol.for("react.strict_mode"),R=Symbol.for("react.profiler"),E=Symbol.for("react.provider"),S=Symbol.for("react.context"),M=Symbol.for("react.forward_ref"),P=Symbol.for("react.suspense"),I=Symbol.for("react.suspense_list"),O=Symbol.for("react.memo"),D=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var w=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var F=Symbol.iterator;function L(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=F&&e[F]||e["@@iterator"])?e:null}var B,N=Object.assign;function k(e){if(void 0===B)try{throw Error()}catch(i){var t=i.stack.trim().match(/\n( *(at )?)/);B=t&&t[1]||""}return"\n"+B+e}var U=!1;function V(e,t){if(!e||U)return"";U=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(h){var r=h}Reflect.construct(e,[],t)}else{try{t.call()}catch(h){r=h}e.call(t.prototype)}else{try{throw Error()}catch(h){r=h}e()}}catch(h){if(h&&r&&"string"===typeof h.stack){for(var s=h.stack.split("\n"),n=r.stack.split("\n"),a=s.length-1,o=n.length-1;1<=a&&0<=o&&s[a]!==n[o];)o--;for(;1<=a&&0<=o;a--,o--)if(s[a]!==n[o]){if(1!==a||1!==o)do{if(a--,0>--o||s[a]!==n[o]){var l="\n"+s[a].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=a&&0<=o);break}}}finally{U=!1,Error.prepareStackTrace=i}return(e=e?e.displayName||e.name:"")?k(e):""}function z(e){switch(e.tag){case 5:return k(e.type);case 16:return k("Lazy");case 13:return k("Suspense");case 19:return k("SuspenseList");case 0:case 2:case 15:return e=V(e.type,!1);case 11:return e=V(e.type.render,!1);case 1:return e=V(e.type,!0);default:return""}}function G(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case A:return"Fragment";case x:return"Portal";case R:return"Profiler";case C:return"StrictMode";case P:return"Suspense";case I:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case S:return(e.displayName||"Context")+".Consumer";case E:return(e._context.displayName||"Context")+".Provider";case M:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case O:return null!==(t=e.displayName||null)?t:G(e.type)||"Memo";case D:t=e._payload,e=e._init;try{return G(e(t))}catch(i){}}return null}function H(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return G(t);case 8:return t===C?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function W(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function q(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function X(e){e._valueTracker||(e._valueTracker=function(e){var t=q(e)?"checked":"value",i=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof i&&"function"===typeof i.get&&"function"===typeof i.set){var s=i.get,n=i.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return s.call(this)},set:function(e){r=""+e,n.call(this,e)}}),Object.defineProperty(e,t,{enumerable:i.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function K(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var i=t.getValue(),r="";return e&&(r=q(e)?e.checked?"true":"false":e.value),(e=r)!==i&&(t.setValue(e),!0)}function Y(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function j(e,t){var i=t.checked;return N({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=i?i:e._wrapperState.initialChecked})}function Q(e,t){var i=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;i=W(null!=t.value?t.value:i),e._wrapperState={initialChecked:r,initialValue:i,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function $(e,t){null!=(t=t.checked)&&v(e,"checked",t,!1)}function Z(e,t){$(e,t);var i=W(t.value),r=t.type;if(null!=i)"number"===r?(0===i&&""===e.value||e.value!=i)&&(e.value=""+i):e.value!==""+i&&(e.value=""+i);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,i):t.hasOwnProperty("defaultValue")&&ee(e,t.type,W(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function J(e,t,i){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,i||t===e.value||(e.value=t),e.defaultValue=t}""!==(i=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==i&&(e.name=i)}function ee(e,t,i){"number"===t&&Y(e.ownerDocument)===e||(null==i?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+i&&(e.defaultValue=""+i))}var te=Array.isArray;function ie(e,t,i,r){if(e=e.options,t){t={};for(var s=0;s<i.length;s++)t["$"+i[s]]=!0;for(i=0;i<e.length;i++)s=t.hasOwnProperty("$"+e[i].value),e[i].selected!==s&&(e[i].selected=s),s&&r&&(e[i].defaultSelected=!0)}else{for(i=""+W(i),t=null,s=0;s<e.length;s++){if(e[s].value===i)return e[s].selected=!0,void(r&&(e[s].defaultSelected=!0));null!==t||e[s].disabled||(t=e[s])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(n(91));return N({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function se(e,t){var i=t.value;if(null==i){if(i=t.children,t=t.defaultValue,null!=i){if(null!=t)throw Error(n(92));if(te(i)){if(1<i.length)throw Error(n(93));i=i[0]}t=i}null==t&&(t=""),i=t}e._wrapperState={initialValue:W(i)}}function ne(e,t){var i=W(t.value),r=W(t.defaultValue);null!=i&&((i=""+i)!==e.value&&(e.value=i),null==t.defaultValue&&e.defaultValue!==i&&(e.defaultValue=i)),null!=r&&(e.defaultValue=""+r)}function ae(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function oe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?oe(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var he,ce,ue=(ce=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((he=he||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=he.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,i,r){MSApp.execUnsafeLocalFunction((function(){return ce(e,t)}))}:ce);function de(e,t){if(t){var i=e.firstChild;if(i&&i===e.lastChild&&3===i.nodeType)return void(i.nodeValue=t)}e.textContent=t}var _e={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pe=["Webkit","ms","Moz","O"];function fe(e,t,i){return null==t||"boolean"===typeof t||""===t?"":i||"number"!==typeof t||0===t||_e.hasOwnProperty(e)&&_e[e]?(""+t).trim():t+"px"}function ge(e,t){for(var i in e=e.style,t)if(t.hasOwnProperty(i)){var r=0===i.indexOf("--"),s=fe(i,t[i],r);"float"===i&&(i="cssFloat"),r?e.setProperty(i,s):e[i]=s}}Object.keys(_e).forEach((function(e){pe.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),_e[t]=_e[e]}))}));var me=N({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function be(e,t){if(t){if(me[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(n(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(n(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(n(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(n(62))}}function ve(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ye=null;function Te(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var xe=null,Ae=null,Ce=null;function Re(e){if(e=bs(e)){if("function"!==typeof xe)throw Error(n(280));var t=e.stateNode;t&&(t=ys(t),xe(e.stateNode,e.type,t))}}function Ee(e){Ae?Ce?Ce.push(e):Ce=[e]:Ae=e}function Se(){if(Ae){var e=Ae,t=Ce;if(Ce=Ae=null,Re(e),t)for(e=0;e<t.length;e++)Re(t[e])}}function Me(e,t){return e(t)}function Pe(){}var Ie=!1;function Oe(e,t,i){if(Ie)return e(t,i);Ie=!0;try{return Me(e,t,i)}finally{Ie=!1,(null!==Ae||null!==Ce)&&(Pe(),Se())}}function De(e,t){var i=e.stateNode;if(null===i)return null;var r=ys(i);if(null===r)return null;i=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(i&&"function"!==typeof i)throw Error(n(231,t,typeof i));return i}var we=!1;if(c)try{var Fe={};Object.defineProperty(Fe,"passive",{get:function(){we=!0}}),window.addEventListener("test",Fe,Fe),window.removeEventListener("test",Fe,Fe)}catch(ce){we=!1}function Le(e,t,i,r,s,n,a,o,l){var h=Array.prototype.slice.call(arguments,3);try{t.apply(i,h)}catch(c){this.onError(c)}}var Be=!1,Ne=null,ke=!1,Ue=null,Ve={onError:function(e){Be=!0,Ne=e}};function ze(e,t,i,r,s,n,a,o,l){Be=!1,Ne=null,Le.apply(Ve,arguments)}function Ge(e){var t=e,i=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(i=t.return),e=t.return}while(e)}return 3===t.tag?i:null}function He(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function We(e){if(Ge(e)!==e)throw Error(n(188))}function qe(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ge(e)))throw Error(n(188));return t!==e?null:e}for(var i=e,r=t;;){var s=i.return;if(null===s)break;var a=s.alternate;if(null===a){if(null!==(r=s.return)){i=r;continue}break}if(s.child===a.child){for(a=s.child;a;){if(a===i)return We(s),e;if(a===r)return We(s),t;a=a.sibling}throw Error(n(188))}if(i.return!==r.return)i=s,r=a;else{for(var o=!1,l=s.child;l;){if(l===i){o=!0,i=s,r=a;break}if(l===r){o=!0,r=s,i=a;break}l=l.sibling}if(!o){for(l=a.child;l;){if(l===i){o=!0,i=a,r=s;break}if(l===r){o=!0,r=a,i=s;break}l=l.sibling}if(!o)throw Error(n(189))}}if(i.alternate!==r)throw Error(n(190))}if(3!==i.tag)throw Error(n(188));return i.stateNode.current===i?e:t}(e))?Xe(e):null}function Xe(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Xe(e);if(null!==t)return t;e=e.sibling}return null}var Ke=s.unstable_scheduleCallback,Ye=s.unstable_cancelCallback,je=s.unstable_shouldYield,Qe=s.unstable_requestPaint,$e=s.unstable_now,Ze=s.unstable_getCurrentPriorityLevel,Je=s.unstable_ImmediatePriority,et=s.unstable_UserBlockingPriority,tt=s.unstable_NormalPriority,it=s.unstable_LowPriority,rt=s.unstable_IdlePriority,st=null,nt=null;var at=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(ot(e)/lt|0)|0},ot=Math.log,lt=Math.LN2;var ht=64,ct=4194304;function ut(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function dt(e,t){var i=e.pendingLanes;if(0===i)return 0;var r=0,s=e.suspendedLanes,n=e.pingedLanes,a=268435455&i;if(0!==a){var o=a&~s;0!==o?r=ut(o):0!==(n&=a)&&(r=ut(n))}else 0!==(a=i&~s)?r=ut(a):0!==n&&(r=ut(n));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&s)&&((s=r&-r)>=(n=t&-t)||16===s&&0!==(4194240&n)))return t;if(0!==(4&r)&&(r|=16&i),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)s=1<<(i=31-at(t)),r|=e[i],t&=~s;return r}function _t(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function pt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function ft(){var e=ht;return 0===(4194240&(ht<<=1))&&(ht=64),e}function gt(e){for(var t=[],i=0;31>i;i++)t.push(e);return t}function mt(e,t,i){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-at(t)]=i}function bt(e,t){var i=e.entangledLanes|=t;for(e=e.entanglements;i;){var r=31-at(i),s=1<<r;s&t|e[r]&t&&(e[r]|=t),i&=~s}}var vt=0;function yt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var Tt,xt,At,Ct,Rt,Et=!1,St=[],Mt=null,Pt=null,It=null,Ot=new Map,Dt=new Map,wt=[],Ft="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Lt(e,t){switch(e){case"focusin":case"focusout":Mt=null;break;case"dragenter":case"dragleave":Pt=null;break;case"mouseover":case"mouseout":It=null;break;case"pointerover":case"pointerout":Ot.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Dt.delete(t.pointerId)}}function Bt(e,t,i,r,s,n){return null===e||e.nativeEvent!==n?(e={blockedOn:t,domEventName:i,eventSystemFlags:r,nativeEvent:n,targetContainers:[s]},null!==t&&(null!==(t=bs(t))&&xt(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==s&&-1===t.indexOf(s)&&t.push(s),e)}function Nt(e){var t=ms(e.target);if(null!==t){var i=Ge(t);if(null!==i)if(13===(t=i.tag)){if(null!==(t=He(i)))return e.blockedOn=t,void Rt(e.priority,(function(){At(i)}))}else if(3===t&&i.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===i.tag?i.stateNode.containerInfo:null)}e.blockedOn=null}function kt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var i=jt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==i)return null!==(t=bs(i))&&xt(t),e.blockedOn=i,!1;var r=new(i=e.nativeEvent).constructor(i.type,i);ye=r,i.target.dispatchEvent(r),ye=null,t.shift()}return!0}function Ut(e,t,i){kt(e)&&i.delete(t)}function Vt(){Et=!1,null!==Mt&&kt(Mt)&&(Mt=null),null!==Pt&&kt(Pt)&&(Pt=null),null!==It&&kt(It)&&(It=null),Ot.forEach(Ut),Dt.forEach(Ut)}function zt(e,t){e.blockedOn===t&&(e.blockedOn=null,Et||(Et=!0,s.unstable_scheduleCallback(s.unstable_NormalPriority,Vt)))}function Gt(e){function t(t){return zt(t,e)}if(0<St.length){zt(St[0],e);for(var i=1;i<St.length;i++){var r=St[i];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==Mt&&zt(Mt,e),null!==Pt&&zt(Pt,e),null!==It&&zt(It,e),Ot.forEach(t),Dt.forEach(t),i=0;i<wt.length;i++)(r=wt[i]).blockedOn===e&&(r.blockedOn=null);for(;0<wt.length&&null===(i=wt[0]).blockedOn;)Nt(i),null===i.blockedOn&&wt.shift()}var Ht=y.ReactCurrentBatchConfig,Wt=!0;function qt(e,t,i,r){var s=vt,n=Ht.transition;Ht.transition=null;try{vt=1,Kt(e,t,i,r)}finally{vt=s,Ht.transition=n}}function Xt(e,t,i,r){var s=vt,n=Ht.transition;Ht.transition=null;try{vt=4,Kt(e,t,i,r)}finally{vt=s,Ht.transition=n}}function Kt(e,t,i,r){if(Wt){var s=jt(e,t,i,r);if(null===s)Hr(e,t,r,Yt,i),Lt(e,r);else if(function(e,t,i,r,s){switch(t){case"focusin":return Mt=Bt(Mt,e,t,i,r,s),!0;case"dragenter":return Pt=Bt(Pt,e,t,i,r,s),!0;case"mouseover":return It=Bt(It,e,t,i,r,s),!0;case"pointerover":var n=s.pointerId;return Ot.set(n,Bt(Ot.get(n)||null,e,t,i,r,s)),!0;case"gotpointercapture":return n=s.pointerId,Dt.set(n,Bt(Dt.get(n)||null,e,t,i,r,s)),!0}return!1}(s,e,t,i,r))r.stopPropagation();else if(Lt(e,r),4&t&&-1<Ft.indexOf(e)){for(;null!==s;){var n=bs(s);if(null!==n&&Tt(n),null===(n=jt(e,t,i,r))&&Hr(e,t,r,Yt,i),n===s)break;s=n}null!==s&&r.stopPropagation()}else Hr(e,t,r,null,i)}}var Yt=null;function jt(e,t,i,r){if(Yt=null,null!==(e=ms(e=Te(r))))if(null===(t=Ge(e)))e=null;else if(13===(i=t.tag)){if(null!==(e=He(t)))return e;e=null}else if(3===i){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Yt=e,null}function Qt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ze()){case Je:return 1;case et:return 4;case tt:case it:return 16;case rt:return 536870912;default:return 16}default:return 16}}var $t=null,Zt=null,Jt=null;function ei(){if(Jt)return Jt;var e,t,i=Zt,r=i.length,s="value"in $t?$t.value:$t.textContent,n=s.length;for(e=0;e<r&&i[e]===s[e];e++);var a=r-e;for(t=1;t<=a&&i[r-t]===s[n-t];t++);return Jt=s.slice(e,1<t?1-t:void 0)}function ti(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function ii(){return!0}function ri(){return!1}function si(e){function t(t,i,r,s,n){for(var a in this._reactName=t,this._targetInst=r,this.type=i,this.nativeEvent=s,this.target=n,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(s):s[a]);return this.isDefaultPrevented=(null!=s.defaultPrevented?s.defaultPrevented:!1===s.returnValue)?ii:ri,this.isPropagationStopped=ri,this}return N(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=ii)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=ii)},persist:function(){},isPersistent:ii}),t}var ni,ai,oi,li={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},hi=si(li),ci=N({},li,{view:0,detail:0}),ui=si(ci),di=N({},ci,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ci,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==oi&&(oi&&"mousemove"===e.type?(ni=e.screenX-oi.screenX,ai=e.screenY-oi.screenY):ai=ni=0,oi=e),ni)},movementY:function(e){return"movementY"in e?e.movementY:ai}}),_i=si(di),pi=si(N({},di,{dataTransfer:0})),fi=si(N({},ci,{relatedTarget:0})),gi=si(N({},li,{animationName:0,elapsedTime:0,pseudoElement:0})),mi=N({},li,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),bi=si(mi),vi=si(N({},li,{data:0})),yi={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ti={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},xi={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ai(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=xi[e])&&!!t[e]}function Ci(){return Ai}var Ri=N({},ci,{key:function(e){if(e.key){var t=yi[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=ti(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Ti[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ci,charCode:function(e){return"keypress"===e.type?ti(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?ti(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Ei=si(Ri),Si=si(N({},di,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Mi=si(N({},ci,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ci})),Pi=si(N({},li,{propertyName:0,elapsedTime:0,pseudoElement:0})),Ii=N({},di,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Oi=si(Ii),Di=[9,13,27,32],wi=c&&"CompositionEvent"in window,Fi=null;c&&"documentMode"in document&&(Fi=document.documentMode);var Li=c&&"TextEvent"in window&&!Fi,Bi=c&&(!wi||Fi&&8<Fi&&11>=Fi),Ni=String.fromCharCode(32),ki=!1;function Ui(e,t){switch(e){case"keyup":return-1!==Di.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Vi(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var zi=!1;var Gi={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Hi(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Gi[e.type]:"textarea"===t}function Wi(e,t,i,r){Ee(r),0<(t=qr(t,"onChange")).length&&(i=new hi("onChange","change",null,i,r),e.push({event:i,listeners:t}))}var qi=null,Xi=null;function Ki(e){Nr(e,0)}function Yi(e){if(K(vs(e)))return e}function ji(e,t){if("change"===e)return t}var Qi=!1;if(c){var $i;if(c){var Zi="oninput"in document;if(!Zi){var Ji=document.createElement("div");Ji.setAttribute("oninput","return;"),Zi="function"===typeof Ji.oninput}$i=Zi}else $i=!1;Qi=$i&&(!document.documentMode||9<document.documentMode)}function er(){qi&&(qi.detachEvent("onpropertychange",tr),Xi=qi=null)}function tr(e){if("value"===e.propertyName&&Yi(Xi)){var t=[];Wi(t,Xi,e,Te(e)),Oe(Ki,t)}}function ir(e,t,i){"focusin"===e?(er(),Xi=i,(qi=t).attachEvent("onpropertychange",tr)):"focusout"===e&&er()}function rr(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Yi(Xi)}function sr(e,t){if("click"===e)return Yi(t)}function nr(e,t){if("input"===e||"change"===e)return Yi(t)}var ar="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function or(e,t){if(ar(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(r=0;r<i.length;r++){var s=i[r];if(!u.call(t,s)||!ar(e[s],t[s]))return!1}return!0}function lr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function hr(e,t){var i,r=lr(e);for(e=0;r;){if(3===r.nodeType){if(i=e+r.textContent.length,e<=t&&i>=t)return{node:r,offset:t-e};e=i}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=lr(r)}}function cr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?cr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function ur(){for(var e=window,t=Y();t instanceof e.HTMLIFrameElement;){try{var i="string"===typeof t.contentWindow.location.href}catch(r){i=!1}if(!i)break;t=Y((e=t.contentWindow).document)}return t}function dr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function _r(e){var t=ur(),i=e.focusedElem,r=e.selectionRange;if(t!==i&&i&&i.ownerDocument&&cr(i.ownerDocument.documentElement,i)){if(null!==r&&dr(i))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in i)i.selectionStart=t,i.selectionEnd=Math.min(e,i.value.length);else if((e=(t=i.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var s=i.textContent.length,n=Math.min(r.start,s);r=void 0===r.end?n:Math.min(r.end,s),!e.extend&&n>r&&(s=r,r=n,n=s),s=hr(i,n);var a=hr(i,r);s&&a&&(1!==e.rangeCount||e.anchorNode!==s.node||e.anchorOffset!==s.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&((t=t.createRange()).setStart(s.node,s.offset),e.removeAllRanges(),n>r?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}for(t=[],e=i;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof i.focus&&i.focus(),i=0;i<t.length;i++)(e=t[i]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var pr=c&&"documentMode"in document&&11>=document.documentMode,fr=null,gr=null,mr=null,br=!1;function vr(e,t,i){var r=i.window===i?i.document:9===i.nodeType?i:i.ownerDocument;br||null==fr||fr!==Y(r)||("selectionStart"in(r=fr)&&dr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},mr&&or(mr,r)||(mr=r,0<(r=qr(gr,"onSelect")).length&&(t=new hi("onSelect","select",null,t,i),e.push({event:t,listeners:r}),t.target=fr)))}function yr(e,t){var i={};return i[e.toLowerCase()]=t.toLowerCase(),i["Webkit"+e]="webkit"+t,i["Moz"+e]="moz"+t,i}var Tr={animationend:yr("Animation","AnimationEnd"),animationiteration:yr("Animation","AnimationIteration"),animationstart:yr("Animation","AnimationStart"),transitionend:yr("Transition","TransitionEnd")},xr={},Ar={};function Cr(e){if(xr[e])return xr[e];if(!Tr[e])return e;var t,i=Tr[e];for(t in i)if(i.hasOwnProperty(t)&&t in Ar)return xr[e]=i[t];return e}c&&(Ar=document.createElement("div").style,"AnimationEvent"in window||(delete Tr.animationend.animation,delete Tr.animationiteration.animation,delete Tr.animationstart.animation),"TransitionEvent"in window||delete Tr.transitionend.transition);var Rr=Cr("animationend"),Er=Cr("animationiteration"),Sr=Cr("animationstart"),Mr=Cr("transitionend"),Pr=new Map,Ir="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Or(e,t){Pr.set(e,t),l(t,[e])}for(var Dr=0;Dr<Ir.length;Dr++){var wr=Ir[Dr];Or(wr.toLowerCase(),"on"+(wr[0].toUpperCase()+wr.slice(1)))}Or(Rr,"onAnimationEnd"),Or(Er,"onAnimationIteration"),Or(Sr,"onAnimationStart"),Or("dblclick","onDoubleClick"),Or("focusin","onFocus"),Or("focusout","onBlur"),Or(Mr,"onTransitionEnd"),h("onMouseEnter",["mouseout","mouseover"]),h("onMouseLeave",["mouseout","mouseover"]),h("onPointerEnter",["pointerout","pointerover"]),h("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Fr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Lr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Fr));function Br(e,t,i){var r=e.type||"unknown-event";e.currentTarget=i,function(e,t,i,r,s,a,o,l,h){if(ze.apply(this,arguments),Be){if(!Be)throw Error(n(198));var c=Ne;Be=!1,Ne=null,ke||(ke=!0,Ue=c)}}(r,t,void 0,e),e.currentTarget=null}function Nr(e,t){t=0!==(4&t);for(var i=0;i<e.length;i++){var r=e[i],s=r.event;r=r.listeners;e:{var n=void 0;if(t)for(var a=r.length-1;0<=a;a--){var o=r[a],l=o.instance,h=o.currentTarget;if(o=o.listener,l!==n&&s.isPropagationStopped())break e;Br(s,o,h),n=l}else for(a=0;a<r.length;a++){if(l=(o=r[a]).instance,h=o.currentTarget,o=o.listener,l!==n&&s.isPropagationStopped())break e;Br(s,o,h),n=l}}}if(ke)throw e=Ue,ke=!1,Ue=null,e}function kr(e,t){var i=t[ps];void 0===i&&(i=t[ps]=new Set);var r=e+"__bubble";i.has(r)||(Gr(t,e,2,!1),i.add(r))}function Ur(e,t,i){var r=0;t&&(r|=4),Gr(i,e,r,t)}var Vr="_reactListening"+Math.random().toString(36).slice(2);function zr(e){if(!e[Vr]){e[Vr]=!0,a.forEach((function(t){"selectionchange"!==t&&(Lr.has(t)||Ur(t,!1,e),Ur(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Vr]||(t[Vr]=!0,Ur("selectionchange",!1,t))}}function Gr(e,t,i,r){switch(Qt(t)){case 1:var s=qt;break;case 4:s=Xt;break;default:s=Kt}i=s.bind(null,t,i,e),s=void 0,!we||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(s=!0),r?void 0!==s?e.addEventListener(t,i,{capture:!0,passive:s}):e.addEventListener(t,i,!0):void 0!==s?e.addEventListener(t,i,{passive:s}):e.addEventListener(t,i,!1)}function Hr(e,t,i,r,s){var n=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var a=r.tag;if(3===a||4===a){var o=r.stateNode.containerInfo;if(o===s||8===o.nodeType&&o.parentNode===s)break;if(4===a)for(a=r.return;null!==a;){var l=a.tag;if((3===l||4===l)&&((l=a.stateNode.containerInfo)===s||8===l.nodeType&&l.parentNode===s))return;a=a.return}for(;null!==o;){if(null===(a=ms(o)))return;if(5===(l=a.tag)||6===l){r=n=a;continue e}o=o.parentNode}}r=r.return}Oe((function(){var r=n,s=Te(i),a=[];e:{var o=Pr.get(e);if(void 0!==o){var l=hi,h=e;switch(e){case"keypress":if(0===ti(i))break e;case"keydown":case"keyup":l=Ei;break;case"focusin":h="focus",l=fi;break;case"focusout":h="blur",l=fi;break;case"beforeblur":case"afterblur":l=fi;break;case"click":if(2===i.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=_i;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=pi;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Mi;break;case Rr:case Er:case Sr:l=gi;break;case Mr:l=Pi;break;case"scroll":l=ui;break;case"wheel":l=Oi;break;case"copy":case"cut":case"paste":l=bi;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Si}var c=0!==(4&t),u=!c&&"scroll"===e,d=c?null!==o?o+"Capture":null:o;c=[];for(var _,p=r;null!==p;){var f=(_=p).stateNode;if(5===_.tag&&null!==f&&(_=f,null!==d&&(null!=(f=De(p,d))&&c.push(Wr(p,f,_)))),u)break;p=p.return}0<c.length&&(o=new l(o,h,null,i,s),a.push({event:o,listeners:c}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(o="mouseover"===e||"pointerover"===e)||i===ye||!(h=i.relatedTarget||i.fromElement)||!ms(h)&&!h[_s])&&(l||o)&&(o=s.window===s?s:(o=s.ownerDocument)?o.defaultView||o.parentWindow:window,l?(l=r,null!==(h=(h=i.relatedTarget||i.toElement)?ms(h):null)&&(h!==(u=Ge(h))||5!==h.tag&&6!==h.tag)&&(h=null)):(l=null,h=r),l!==h)){if(c=_i,f="onMouseLeave",d="onMouseEnter",p="mouse","pointerout"!==e&&"pointerover"!==e||(c=Si,f="onPointerLeave",d="onPointerEnter",p="pointer"),u=null==l?o:vs(l),_=null==h?o:vs(h),(o=new c(f,p+"leave",l,i,s)).target=u,o.relatedTarget=_,f=null,ms(s)===r&&((c=new c(d,p+"enter",h,i,s)).target=_,c.relatedTarget=u,f=c),u=f,l&&h)e:{for(d=h,p=0,_=c=l;_;_=Xr(_))p++;for(_=0,f=d;f;f=Xr(f))_++;for(;0<p-_;)c=Xr(c),p--;for(;0<_-p;)d=Xr(d),_--;for(;p--;){if(c===d||null!==d&&c===d.alternate)break e;c=Xr(c),d=Xr(d)}c=null}else c=null;null!==l&&Kr(a,o,l,c,!1),null!==h&&null!==u&&Kr(a,u,h,c,!0)}if("select"===(l=(o=r?vs(r):window).nodeName&&o.nodeName.toLowerCase())||"input"===l&&"file"===o.type)var g=ji;else if(Hi(o))if(Qi)g=nr;else{g=rr;var m=ir}else(l=o.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===o.type||"radio"===o.type)&&(g=sr);switch(g&&(g=g(e,r))?Wi(a,g,i,s):(m&&m(e,o,r),"focusout"===e&&(m=o._wrapperState)&&m.controlled&&"number"===o.type&&ee(o,"number",o.value)),m=r?vs(r):window,e){case"focusin":(Hi(m)||"true"===m.contentEditable)&&(fr=m,gr=r,mr=null);break;case"focusout":mr=gr=fr=null;break;case"mousedown":br=!0;break;case"contextmenu":case"mouseup":case"dragend":br=!1,vr(a,i,s);break;case"selectionchange":if(pr)break;case"keydown":case"keyup":vr(a,i,s)}var b;if(wi)e:{switch(e){case"compositionstart":var v="onCompositionStart";break e;case"compositionend":v="onCompositionEnd";break e;case"compositionupdate":v="onCompositionUpdate";break e}v=void 0}else zi?Ui(e,i)&&(v="onCompositionEnd"):"keydown"===e&&229===i.keyCode&&(v="onCompositionStart");v&&(Bi&&"ko"!==i.locale&&(zi||"onCompositionStart"!==v?"onCompositionEnd"===v&&zi&&(b=ei()):(Zt="value"in($t=s)?$t.value:$t.textContent,zi=!0)),0<(m=qr(r,v)).length&&(v=new vi(v,e,null,i,s),a.push({event:v,listeners:m}),b?v.data=b:null!==(b=Vi(i))&&(v.data=b))),(b=Li?function(e,t){switch(e){case"compositionend":return Vi(t);case"keypress":return 32!==t.which?null:(ki=!0,Ni);case"textInput":return(e=t.data)===Ni&&ki?null:e;default:return null}}(e,i):function(e,t){if(zi)return"compositionend"===e||!wi&&Ui(e,t)?(e=ei(),Jt=Zt=$t=null,zi=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Bi&&"ko"!==t.locale?null:t.data}}(e,i))&&(0<(r=qr(r,"onBeforeInput")).length&&(s=new vi("onBeforeInput","beforeinput",null,i,s),a.push({event:s,listeners:r}),s.data=b))}Nr(a,t)}))}function Wr(e,t,i){return{instance:e,listener:t,currentTarget:i}}function qr(e,t){for(var i=t+"Capture",r=[];null!==e;){var s=e,n=s.stateNode;5===s.tag&&null!==n&&(s=n,null!=(n=De(e,i))&&r.unshift(Wr(e,n,s)),null!=(n=De(e,t))&&r.push(Wr(e,n,s))),e=e.return}return r}function Xr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Kr(e,t,i,r,s){for(var n=t._reactName,a=[];null!==i&&i!==r;){var o=i,l=o.alternate,h=o.stateNode;if(null!==l&&l===r)break;5===o.tag&&null!==h&&(o=h,s?null!=(l=De(i,n))&&a.unshift(Wr(i,l,o)):s||null!=(l=De(i,n))&&a.push(Wr(i,l,o))),i=i.return}0!==a.length&&e.push({event:t,listeners:a})}var Yr=/\r\n?/g,jr=/\u0000|\uFFFD/g;function Qr(e){return("string"===typeof e?e:""+e).replace(Yr,"\n").replace(jr,"")}function $r(e,t,i){if(t=Qr(t),Qr(e)!==t&&i)throw Error(n(425))}function Zr(){}var Jr=null,es=null;function ts(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var is="function"===typeof setTimeout?setTimeout:void 0,rs="function"===typeof clearTimeout?clearTimeout:void 0,ss="function"===typeof Promise?Promise:void 0,ns="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof ss?function(e){return ss.resolve(null).then(e).catch(as)}:is;function as(e){setTimeout((function(){throw e}))}function os(e,t){var i=t,r=0;do{var s=i.nextSibling;if(e.removeChild(i),s&&8===s.nodeType)if("/$"===(i=s.data)){if(0===r)return e.removeChild(s),void Gt(t);r--}else"$"!==i&&"$?"!==i&&"$!"!==i||r++;i=s}while(i);Gt(t)}function ls(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function hs(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var i=e.data;if("$"===i||"$!"===i||"$?"===i){if(0===t)return e;t--}else"/$"===i&&t++}e=e.previousSibling}return null}var cs=Math.random().toString(36).slice(2),us="__reactFiber$"+cs,ds="__reactProps$"+cs,_s="__reactContainer$"+cs,ps="__reactEvents$"+cs,fs="__reactListeners$"+cs,gs="__reactHandles$"+cs;function ms(e){var t=e[us];if(t)return t;for(var i=e.parentNode;i;){if(t=i[_s]||i[us]){if(i=t.alternate,null!==t.child||null!==i&&null!==i.child)for(e=hs(e);null!==e;){if(i=e[us])return i;e=hs(e)}return t}i=(e=i).parentNode}return null}function bs(e){return!(e=e[us]||e[_s])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function vs(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(n(33))}function ys(e){return e[ds]||null}var Ts=[],xs=-1;function As(e){return{current:e}}function Cs(e){0>xs||(e.current=Ts[xs],Ts[xs]=null,xs--)}function Rs(e,t){xs++,Ts[xs]=e.current,e.current=t}var Es={},Ss=As(Es),Ms=As(!1),Ps=Es;function Is(e,t){var i=e.type.contextTypes;if(!i)return Es;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var s,n={};for(s in i)n[s]=t[s];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=n),n}function Os(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Ds(){Cs(Ms),Cs(Ss)}function ws(e,t,i){if(Ss.current!==Es)throw Error(n(168));Rs(Ss,t),Rs(Ms,i)}function Fs(e,t,i){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return i;for(var s in r=r.getChildContext())if(!(s in t))throw Error(n(108,H(e)||"Unknown",s));return N({},i,r)}function Ls(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Es,Ps=Ss.current,Rs(Ss,e),Rs(Ms,Ms.current),!0}function Bs(e,t,i){var r=e.stateNode;if(!r)throw Error(n(169));i?(e=Fs(e,t,Ps),r.__reactInternalMemoizedMergedChildContext=e,Cs(Ms),Cs(Ss),Rs(Ss,e)):Cs(Ms),Rs(Ms,i)}var Ns=null,ks=!1,Us=!1;function Vs(e){null===Ns?Ns=[e]:Ns.push(e)}function zs(){if(!Us&&null!==Ns){Us=!0;var e=0,t=vt;try{var i=Ns;for(vt=1;e<i.length;e++){var r=i[e];do{r=r(!0)}while(null!==r)}Ns=null,ks=!1}catch(s){throw null!==Ns&&(Ns=Ns.slice(e+1)),Ke(Je,zs),s}finally{vt=t,Us=!1}}return null}var Gs=[],Hs=0,Ws=null,qs=0,Xs=[],Ks=0,Ys=null,js=1,Qs="";function $s(e,t){Gs[Hs++]=qs,Gs[Hs++]=Ws,Ws=e,qs=t}function Zs(e,t,i){Xs[Ks++]=js,Xs[Ks++]=Qs,Xs[Ks++]=Ys,Ys=e;var r=js;e=Qs;var s=32-at(r)-1;r&=~(1<<s),i+=1;var n=32-at(t)+s;if(30<n){var a=s-s%5;n=(r&(1<<a)-1).toString(32),r>>=a,s-=a,js=1<<32-at(t)+s|i<<s|r,Qs=n+e}else js=1<<n|i<<s|r,Qs=e}function Js(e){null!==e.return&&($s(e,1),Zs(e,1,0))}function en(e){for(;e===Ws;)Ws=Gs[--Hs],Gs[Hs]=null,qs=Gs[--Hs],Gs[Hs]=null;for(;e===Ys;)Ys=Xs[--Ks],Xs[Ks]=null,Qs=Xs[--Ks],Xs[Ks]=null,js=Xs[--Ks],Xs[Ks]=null}var tn=null,rn=null,sn=!1,nn=null;function an(e,t){var i=Oh(5,null,null,0);i.elementType="DELETED",i.stateNode=t,i.return=e,null===(t=e.deletions)?(e.deletions=[i],e.flags|=16):t.push(i)}function on(e,t){switch(e.tag){case 5:var i=e.type;return null!==(t=1!==t.nodeType||i.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,tn=e,rn=ls(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,tn=e,rn=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(i=null!==Ys?{id:js,overflow:Qs}:null,e.memoizedState={dehydrated:t,treeContext:i,retryLane:1073741824},(i=Oh(18,null,null,0)).stateNode=t,i.return=e,e.child=i,tn=e,rn=null,!0);default:return!1}}function ln(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function hn(e){if(sn){var t=rn;if(t){var i=t;if(!on(e,t)){if(ln(e))throw Error(n(418));t=ls(i.nextSibling);var r=tn;t&&on(e,t)?an(r,i):(e.flags=-4097&e.flags|2,sn=!1,tn=e)}}else{if(ln(e))throw Error(n(418));e.flags=-4097&e.flags|2,sn=!1,tn=e}}}function cn(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;tn=e}function un(e){if(e!==tn)return!1;if(!sn)return cn(e),sn=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!ts(e.type,e.memoizedProps)),t&&(t=rn)){if(ln(e))throw dn(),Error(n(418));for(;t;)an(e,t),t=ls(t.nextSibling)}if(cn(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(n(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var i=e.data;if("/$"===i){if(0===t){rn=ls(e.nextSibling);break e}t--}else"$"!==i&&"$!"!==i&&"$?"!==i||t++}e=e.nextSibling}rn=null}}else rn=tn?ls(e.stateNode.nextSibling):null;return!0}function dn(){for(var e=rn;e;)e=ls(e.nextSibling)}function _n(){rn=tn=null,sn=!1}function pn(e){null===nn?nn=[e]:nn.push(e)}var fn=y.ReactCurrentBatchConfig;function gn(e,t,i){if(null!==(e=i.ref)&&"function"!==typeof e&&"object"!==typeof e){if(i._owner){if(i=i._owner){if(1!==i.tag)throw Error(n(309));var r=i.stateNode}if(!r)throw Error(n(147,e));var s=r,a=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===a?t.ref:(t=function(e){var t=s.refs;null===e?delete t[a]:t[a]=e},t._stringRef=a,t)}if("string"!==typeof e)throw Error(n(284));if(!i._owner)throw Error(n(290,e))}return e}function mn(e,t){throw e=Object.prototype.toString.call(t),Error(n(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function bn(e){return(0,e._init)(e._payload)}function vn(e){function t(t,i){if(e){var r=t.deletions;null===r?(t.deletions=[i],t.flags|=16):r.push(i)}}function i(i,r){if(!e)return null;for(;null!==r;)t(i,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function s(e,t){return(e=wh(e,t)).index=0,e.sibling=null,e}function a(t,i,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<i?(t.flags|=2,i):r:(t.flags|=2,i):(t.flags|=1048576,i)}function o(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,i,r){return null===t||6!==t.tag?((t=Nh(i,e.mode,r)).return=e,t):((t=s(t,i)).return=e,t)}function h(e,t,i,r){var n=i.type;return n===A?u(e,t,i.props.children,r,i.key):null!==t&&(t.elementType===n||"object"===typeof n&&null!==n&&n.$$typeof===D&&bn(n)===t.type)?((r=s(t,i.props)).ref=gn(e,t,i),r.return=e,r):((r=Fh(i.type,i.key,i.props,null,e.mode,r)).ref=gn(e,t,i),r.return=e,r)}function c(e,t,i,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==i.containerInfo||t.stateNode.implementation!==i.implementation?((t=kh(i,e.mode,r)).return=e,t):((t=s(t,i.children||[])).return=e,t)}function u(e,t,i,r,n){return null===t||7!==t.tag?((t=Lh(i,e.mode,r,n)).return=e,t):((t=s(t,i)).return=e,t)}function d(e,t,i){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Nh(""+t,e.mode,i)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case T:return(i=Fh(t.type,t.key,t.props,null,e.mode,i)).ref=gn(e,null,t),i.return=e,i;case x:return(t=kh(t,e.mode,i)).return=e,t;case D:return d(e,(0,t._init)(t._payload),i)}if(te(t)||L(t))return(t=Lh(t,e.mode,i,null)).return=e,t;mn(e,t)}return null}function _(e,t,i,r){var s=null!==t?t.key:null;if("string"===typeof i&&""!==i||"number"===typeof i)return null!==s?null:l(e,t,""+i,r);if("object"===typeof i&&null!==i){switch(i.$$typeof){case T:return i.key===s?h(e,t,i,r):null;case x:return i.key===s?c(e,t,i,r):null;case D:return _(e,t,(s=i._init)(i._payload),r)}if(te(i)||L(i))return null!==s?null:u(e,t,i,r,null);mn(e,i)}return null}function p(e,t,i,r,s){if("string"===typeof r&&""!==r||"number"===typeof r)return l(t,e=e.get(i)||null,""+r,s);if("object"===typeof r&&null!==r){switch(r.$$typeof){case T:return h(t,e=e.get(null===r.key?i:r.key)||null,r,s);case x:return c(t,e=e.get(null===r.key?i:r.key)||null,r,s);case D:return p(e,t,i,(0,r._init)(r._payload),s)}if(te(r)||L(r))return u(t,e=e.get(i)||null,r,s,null);mn(t,r)}return null}function f(s,n,o,l){for(var h=null,c=null,u=n,f=n=0,g=null;null!==u&&f<o.length;f++){u.index>f?(g=u,u=null):g=u.sibling;var m=_(s,u,o[f],l);if(null===m){null===u&&(u=g);break}e&&u&&null===m.alternate&&t(s,u),n=a(m,n,f),null===c?h=m:c.sibling=m,c=m,u=g}if(f===o.length)return i(s,u),sn&&$s(s,f),h;if(null===u){for(;f<o.length;f++)null!==(u=d(s,o[f],l))&&(n=a(u,n,f),null===c?h=u:c.sibling=u,c=u);return sn&&$s(s,f),h}for(u=r(s,u);f<o.length;f++)null!==(g=p(u,s,f,o[f],l))&&(e&&null!==g.alternate&&u.delete(null===g.key?f:g.key),n=a(g,n,f),null===c?h=g:c.sibling=g,c=g);return e&&u.forEach((function(e){return t(s,e)})),sn&&$s(s,f),h}function g(s,o,l,h){var c=L(l);if("function"!==typeof c)throw Error(n(150));if(null==(l=c.call(l)))throw Error(n(151));for(var u=c=null,f=o,g=o=0,m=null,b=l.next();null!==f&&!b.done;g++,b=l.next()){f.index>g?(m=f,f=null):m=f.sibling;var v=_(s,f,b.value,h);if(null===v){null===f&&(f=m);break}e&&f&&null===v.alternate&&t(s,f),o=a(v,o,g),null===u?c=v:u.sibling=v,u=v,f=m}if(b.done)return i(s,f),sn&&$s(s,g),c;if(null===f){for(;!b.done;g++,b=l.next())null!==(b=d(s,b.value,h))&&(o=a(b,o,g),null===u?c=b:u.sibling=b,u=b);return sn&&$s(s,g),c}for(f=r(s,f);!b.done;g++,b=l.next())null!==(b=p(f,s,g,b.value,h))&&(e&&null!==b.alternate&&f.delete(null===b.key?g:b.key),o=a(b,o,g),null===u?c=b:u.sibling=b,u=b);return e&&f.forEach((function(e){return t(s,e)})),sn&&$s(s,g),c}return function e(r,n,a,l){if("object"===typeof a&&null!==a&&a.type===A&&null===a.key&&(a=a.props.children),"object"===typeof a&&null!==a){switch(a.$$typeof){case T:e:{for(var h=a.key,c=n;null!==c;){if(c.key===h){if((h=a.type)===A){if(7===c.tag){i(r,c.sibling),(n=s(c,a.props.children)).return=r,r=n;break e}}else if(c.elementType===h||"object"===typeof h&&null!==h&&h.$$typeof===D&&bn(h)===c.type){i(r,c.sibling),(n=s(c,a.props)).ref=gn(r,c,a),n.return=r,r=n;break e}i(r,c);break}t(r,c),c=c.sibling}a.type===A?((n=Lh(a.props.children,r.mode,l,a.key)).return=r,r=n):((l=Fh(a.type,a.key,a.props,null,r.mode,l)).ref=gn(r,n,a),l.return=r,r=l)}return o(r);case x:e:{for(c=a.key;null!==n;){if(n.key===c){if(4===n.tag&&n.stateNode.containerInfo===a.containerInfo&&n.stateNode.implementation===a.implementation){i(r,n.sibling),(n=s(n,a.children||[])).return=r,r=n;break e}i(r,n);break}t(r,n),n=n.sibling}(n=kh(a,r.mode,l)).return=r,r=n}return o(r);case D:return e(r,n,(c=a._init)(a._payload),l)}if(te(a))return f(r,n,a,l);if(L(a))return g(r,n,a,l);mn(r,a)}return"string"===typeof a&&""!==a||"number"===typeof a?(a=""+a,null!==n&&6===n.tag?(i(r,n.sibling),(n=s(n,a)).return=r,r=n):(i(r,n),(n=Nh(a,r.mode,l)).return=r,r=n),o(r)):i(r,n)}}var yn=vn(!0),Tn=vn(!1),xn=As(null),An=null,Cn=null,Rn=null;function En(){Rn=Cn=An=null}function Sn(e){var t=xn.current;Cs(xn),e._currentValue=t}function Mn(e,t,i){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===i)break;e=e.return}}function Pn(e,t){An=e,Rn=Cn=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(vo=!0),e.firstContext=null)}function In(e){var t=e._currentValue;if(Rn!==e)if(e={context:e,memoizedValue:t,next:null},null===Cn){if(null===An)throw Error(n(308));Cn=e,An.dependencies={lanes:0,firstContext:e}}else Cn=Cn.next=e;return t}var On=null;function Dn(e){null===On?On=[e]:On.push(e)}function wn(e,t,i,r){var s=t.interleaved;return null===s?(i.next=i,Dn(t)):(i.next=s.next,s.next=i),t.interleaved=i,Fn(e,r)}function Fn(e,t){e.lanes|=t;var i=e.alternate;for(null!==i&&(i.lanes|=t),i=e,e=e.return;null!==e;)e.childLanes|=t,null!==(i=e.alternate)&&(i.childLanes|=t),i=e,e=e.return;return 3===i.tag?i.stateNode:null}var Ln=!1;function Bn(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Nn(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function kn(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Un(e,t,i){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&Ml)){var s=r.pending;return null===s?t.next=t:(t.next=s.next,s.next=t),r.pending=t,Fn(e,i)}return null===(s=r.interleaved)?(t.next=t,Dn(r)):(t.next=s.next,s.next=t),r.interleaved=t,Fn(e,i)}function Vn(e,t,i){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&i))){var r=t.lanes;i|=r&=e.pendingLanes,t.lanes=i,bt(e,i)}}function zn(e,t){var i=e.updateQueue,r=e.alternate;if(null!==r&&i===(r=r.updateQueue)){var s=null,n=null;if(null!==(i=i.firstBaseUpdate)){do{var a={eventTime:i.eventTime,lane:i.lane,tag:i.tag,payload:i.payload,callback:i.callback,next:null};null===n?s=n=a:n=n.next=a,i=i.next}while(null!==i);null===n?s=n=t:n=n.next=t}else s=n=t;return i={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:n,shared:r.shared,effects:r.effects},void(e.updateQueue=i)}null===(e=i.lastBaseUpdate)?i.firstBaseUpdate=t:e.next=t,i.lastBaseUpdate=t}function Gn(e,t,i,r){var s=e.updateQueue;Ln=!1;var n=s.firstBaseUpdate,a=s.lastBaseUpdate,o=s.shared.pending;if(null!==o){s.shared.pending=null;var l=o,h=l.next;l.next=null,null===a?n=h:a.next=h,a=l;var c=e.alternate;null!==c&&((o=(c=c.updateQueue).lastBaseUpdate)!==a&&(null===o?c.firstBaseUpdate=h:o.next=h,c.lastBaseUpdate=l))}if(null!==n){var u=s.baseState;for(a=0,c=h=l=null,o=n;;){var d=o.lane,_=o.eventTime;if((r&d)===d){null!==c&&(c=c.next={eventTime:_,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var p=e,f=o;switch(d=t,_=i,f.tag){case 1:if("function"===typeof(p=f.payload)){u=p.call(_,u,d);break e}u=p;break e;case 3:p.flags=-65537&p.flags|128;case 0:if(null===(d="function"===typeof(p=f.payload)?p.call(_,u,d):p)||void 0===d)break e;u=N({},u,d);break e;case 2:Ln=!0}}null!==o.callback&&0!==o.lane&&(e.flags|=64,null===(d=s.effects)?s.effects=[o]:d.push(o))}else _={eventTime:_,lane:d,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===c?(h=c=_,l=u):c=c.next=_,a|=d;if(null===(o=o.next)){if(null===(o=s.shared.pending))break;o=(d=o).next,d.next=null,s.lastBaseUpdate=d,s.shared.pending=null}}if(null===c&&(l=u),s.baseState=l,s.firstBaseUpdate=h,s.lastBaseUpdate=c,null!==(t=s.shared.interleaved)){s=t;do{a|=s.lane,s=s.next}while(s!==t)}else null===n&&(s.shared.lanes=0);Bl|=a,e.lanes=a,e.memoizedState=u}}function Hn(e,t,i){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],s=r.callback;if(null!==s){if(r.callback=null,r=i,"function"!==typeof s)throw Error(n(191,s));s.call(r)}}}var Wn={},qn=As(Wn),Xn=As(Wn),Kn=As(Wn);function Yn(e){if(e===Wn)throw Error(n(174));return e}function jn(e,t){switch(Rs(Kn,t),Rs(Xn,e),Rs(qn,Wn),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Cs(qn),Rs(qn,t)}function Qn(){Cs(qn),Cs(Xn),Cs(Kn)}function $n(e){Yn(Kn.current);var t=Yn(qn.current),i=le(t,e.type);t!==i&&(Rs(Xn,e),Rs(qn,i))}function Zn(e){Xn.current===e&&(Cs(qn),Cs(Xn))}var Jn=As(0);function ea(e){for(var t=e;null!==t;){if(13===t.tag){var i=t.memoizedState;if(null!==i&&(null===(i=i.dehydrated)||"$?"===i.data||"$!"===i.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ta=[];function ia(){for(var e=0;e<ta.length;e++)ta[e]._workInProgressVersionPrimary=null;ta.length=0}var ra=y.ReactCurrentDispatcher,sa=y.ReactCurrentBatchConfig,na=0,aa=null,oa=null,la=null,ha=!1,ca=!1,ua=0,da=0;function _a(){throw Error(n(321))}function pa(e,t){if(null===t)return!1;for(var i=0;i<t.length&&i<e.length;i++)if(!ar(e[i],t[i]))return!1;return!0}function fa(e,t,i,r,s,a){if(na=a,aa=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ra.current=null===e||null===e.memoizedState?Za:Ja,e=i(r,s),ca){a=0;do{if(ca=!1,ua=0,25<=a)throw Error(n(301));a+=1,la=oa=null,t.updateQueue=null,ra.current=eo,e=i(r,s)}while(ca)}if(ra.current=$a,t=null!==oa&&null!==oa.next,na=0,la=oa=aa=null,ha=!1,t)throw Error(n(300));return e}function ga(){var e=0!==ua;return ua=0,e}function ma(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===la?aa.memoizedState=la=e:la=la.next=e,la}function ba(){if(null===oa){var e=aa.alternate;e=null!==e?e.memoizedState:null}else e=oa.next;var t=null===la?aa.memoizedState:la.next;if(null!==t)la=t,oa=e;else{if(null===e)throw Error(n(310));e={memoizedState:(oa=e).memoizedState,baseState:oa.baseState,baseQueue:oa.baseQueue,queue:oa.queue,next:null},null===la?aa.memoizedState=la=e:la=la.next=e}return la}function va(e,t){return"function"===typeof t?t(e):t}function ya(e){var t=ba(),i=t.queue;if(null===i)throw Error(n(311));i.lastRenderedReducer=e;var r=oa,s=r.baseQueue,a=i.pending;if(null!==a){if(null!==s){var o=s.next;s.next=a.next,a.next=o}r.baseQueue=s=a,i.pending=null}if(null!==s){a=s.next,r=r.baseState;var l=o=null,h=null,c=a;do{var u=c.lane;if((na&u)===u)null!==h&&(h=h.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:e(r,c.action);else{var d={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};null===h?(l=h=d,o=r):h=h.next=d,aa.lanes|=u,Bl|=u}c=c.next}while(null!==c&&c!==a);null===h?o=r:h.next=l,ar(r,t.memoizedState)||(vo=!0),t.memoizedState=r,t.baseState=o,t.baseQueue=h,i.lastRenderedState=r}if(null!==(e=i.interleaved)){s=e;do{a=s.lane,aa.lanes|=a,Bl|=a,s=s.next}while(s!==e)}else null===s&&(i.lanes=0);return[t.memoizedState,i.dispatch]}function Ta(e){var t=ba(),i=t.queue;if(null===i)throw Error(n(311));i.lastRenderedReducer=e;var r=i.dispatch,s=i.pending,a=t.memoizedState;if(null!==s){i.pending=null;var o=s=s.next;do{a=e(a,o.action),o=o.next}while(o!==s);ar(a,t.memoizedState)||(vo=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),i.lastRenderedState=a}return[a,r]}function xa(){}function Aa(e,t){var i=aa,r=ba(),s=t(),a=!ar(r.memoizedState,s);if(a&&(r.memoizedState=s,vo=!0),r=r.queue,La(Ea.bind(null,i,r,e),[e]),r.getSnapshot!==t||a||null!==la&&1&la.memoizedState.tag){if(i.flags|=2048,Ia(9,Ra.bind(null,i,r,s,t),void 0,null),null===Pl)throw Error(n(349));0!==(30&na)||Ca(i,t,s)}return s}function Ca(e,t,i){e.flags|=16384,e={getSnapshot:t,value:i},null===(t=aa.updateQueue)?(t={lastEffect:null,stores:null},aa.updateQueue=t,t.stores=[e]):null===(i=t.stores)?t.stores=[e]:i.push(e)}function Ra(e,t,i,r){t.value=i,t.getSnapshot=r,Sa(t)&&Ma(e)}function Ea(e,t,i){return i((function(){Sa(t)&&Ma(e)}))}function Sa(e){var t=e.getSnapshot;e=e.value;try{var i=t();return!ar(e,i)}catch(r){return!0}}function Ma(e){var t=Fn(e,1);null!==t&&ih(t,e,1,-1)}function Pa(e){var t=ma();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:va,lastRenderedState:e},t.queue=e,e=e.dispatch=Ka.bind(null,aa,e),[t.memoizedState,e]}function Ia(e,t,i,r){return e={tag:e,create:t,destroy:i,deps:r,next:null},null===(t=aa.updateQueue)?(t={lastEffect:null,stores:null},aa.updateQueue=t,t.lastEffect=e.next=e):null===(i=t.lastEffect)?t.lastEffect=e.next=e:(r=i.next,i.next=e,e.next=r,t.lastEffect=e),e}function Oa(){return ba().memoizedState}function Da(e,t,i,r){var s=ma();aa.flags|=e,s.memoizedState=Ia(1|t,i,void 0,void 0===r?null:r)}function wa(e,t,i,r){var s=ba();r=void 0===r?null:r;var n=void 0;if(null!==oa){var a=oa.memoizedState;if(n=a.destroy,null!==r&&pa(r,a.deps))return void(s.memoizedState=Ia(t,i,n,r))}aa.flags|=e,s.memoizedState=Ia(1|t,i,n,r)}function Fa(e,t){return Da(8390656,8,e,t)}function La(e,t){return wa(2048,8,e,t)}function Ba(e,t){return wa(4,2,e,t)}function Na(e,t){return wa(4,4,e,t)}function ka(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Ua(e,t,i){return i=null!==i&&void 0!==i?i.concat([e]):null,wa(4,4,ka.bind(null,t,e),i)}function Va(){}function za(e,t){var i=ba();t=void 0===t?null:t;var r=i.memoizedState;return null!==r&&null!==t&&pa(t,r[1])?r[0]:(i.memoizedState=[e,t],e)}function Ga(e,t){var i=ba();t=void 0===t?null:t;var r=i.memoizedState;return null!==r&&null!==t&&pa(t,r[1])?r[0]:(e=e(),i.memoizedState=[e,t],e)}function Ha(e,t,i){return 0===(21&na)?(e.baseState&&(e.baseState=!1,vo=!0),e.memoizedState=i):(ar(i,t)||(i=ft(),aa.lanes|=i,Bl|=i,e.baseState=!0),t)}function Wa(e,t){var i=vt;vt=0!==i&&4>i?i:4,e(!0);var r=sa.transition;sa.transition={};try{e(!1),t()}finally{vt=i,sa.transition=r}}function qa(){return ba().memoizedState}function Xa(e,t,i){var r=th(e);if(i={lane:r,action:i,hasEagerState:!1,eagerState:null,next:null},Ya(e))ja(t,i);else if(null!==(i=wn(e,t,i,r))){ih(i,e,r,eh()),Qa(i,t,r)}}function Ka(e,t,i){var r=th(e),s={lane:r,action:i,hasEagerState:!1,eagerState:null,next:null};if(Ya(e))ja(t,s);else{var n=e.alternate;if(0===e.lanes&&(null===n||0===n.lanes)&&null!==(n=t.lastRenderedReducer))try{var a=t.lastRenderedState,o=n(a,i);if(s.hasEagerState=!0,s.eagerState=o,ar(o,a)){var l=t.interleaved;return null===l?(s.next=s,Dn(t)):(s.next=l.next,l.next=s),void(t.interleaved=s)}}catch(h){}null!==(i=wn(e,t,s,r))&&(ih(i,e,r,s=eh()),Qa(i,t,r))}}function Ya(e){var t=e.alternate;return e===aa||null!==t&&t===aa}function ja(e,t){ca=ha=!0;var i=e.pending;null===i?t.next=t:(t.next=i.next,i.next=t),e.pending=t}function Qa(e,t,i){if(0!==(4194240&i)){var r=t.lanes;i|=r&=e.pendingLanes,t.lanes=i,bt(e,i)}}var $a={readContext:In,useCallback:_a,useContext:_a,useEffect:_a,useImperativeHandle:_a,useInsertionEffect:_a,useLayoutEffect:_a,useMemo:_a,useReducer:_a,useRef:_a,useState:_a,useDebugValue:_a,useDeferredValue:_a,useTransition:_a,useMutableSource:_a,useSyncExternalStore:_a,useId:_a,unstable_isNewReconciler:!1},Za={readContext:In,useCallback:function(e,t){return ma().memoizedState=[e,void 0===t?null:t],e},useContext:In,useEffect:Fa,useImperativeHandle:function(e,t,i){return i=null!==i&&void 0!==i?i.concat([e]):null,Da(4194308,4,ka.bind(null,t,e),i)},useLayoutEffect:function(e,t){return Da(4194308,4,e,t)},useInsertionEffect:function(e,t){return Da(4,2,e,t)},useMemo:function(e,t){var i=ma();return t=void 0===t?null:t,e=e(),i.memoizedState=[e,t],e},useReducer:function(e,t,i){var r=ma();return t=void 0!==i?i(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=Xa.bind(null,aa,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},ma().memoizedState=e},useState:Pa,useDebugValue:Va,useDeferredValue:function(e){return ma().memoizedState=e},useTransition:function(){var e=Pa(!1),t=e[0];return e=Wa.bind(null,e[1]),ma().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,i){var r=aa,s=ma();if(sn){if(void 0===i)throw Error(n(407));i=i()}else{if(i=t(),null===Pl)throw Error(n(349));0!==(30&na)||Ca(r,t,i)}s.memoizedState=i;var a={value:i,getSnapshot:t};return s.queue=a,Fa(Ea.bind(null,r,a,e),[e]),r.flags|=2048,Ia(9,Ra.bind(null,r,a,i,t),void 0,null),i},useId:function(){var e=ma(),t=Pl.identifierPrefix;if(sn){var i=Qs;t=":"+t+"R"+(i=(js&~(1<<32-at(js)-1)).toString(32)+i),0<(i=ua++)&&(t+="H"+i.toString(32)),t+=":"}else t=":"+t+"r"+(i=da++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Ja={readContext:In,useCallback:za,useContext:In,useEffect:La,useImperativeHandle:Ua,useInsertionEffect:Ba,useLayoutEffect:Na,useMemo:Ga,useReducer:ya,useRef:Oa,useState:function(){return ya(va)},useDebugValue:Va,useDeferredValue:function(e){return Ha(ba(),oa.memoizedState,e)},useTransition:function(){return[ya(va)[0],ba().memoizedState]},useMutableSource:xa,useSyncExternalStore:Aa,useId:qa,unstable_isNewReconciler:!1},eo={readContext:In,useCallback:za,useContext:In,useEffect:La,useImperativeHandle:Ua,useInsertionEffect:Ba,useLayoutEffect:Na,useMemo:Ga,useReducer:Ta,useRef:Oa,useState:function(){return Ta(va)},useDebugValue:Va,useDeferredValue:function(e){var t=ba();return null===oa?t.memoizedState=e:Ha(t,oa.memoizedState,e)},useTransition:function(){return[Ta(va)[0],ba().memoizedState]},useMutableSource:xa,useSyncExternalStore:Aa,useId:qa,unstable_isNewReconciler:!1};function to(e,t){if(e&&e.defaultProps){for(var i in t=N({},t),e=e.defaultProps)void 0===t[i]&&(t[i]=e[i]);return t}return t}function io(e,t,i,r){i=null===(i=i(r,t=e.memoizedState))||void 0===i?t:N({},t,i),e.memoizedState=i,0===e.lanes&&(e.updateQueue.baseState=i)}var ro={isMounted:function(e){return!!(e=e._reactInternals)&&Ge(e)===e},enqueueSetState:function(e,t,i){e=e._reactInternals;var r=eh(),s=th(e),n=kn(r,s);n.payload=t,void 0!==i&&null!==i&&(n.callback=i),null!==(t=Un(e,n,s))&&(ih(t,e,s,r),Vn(t,e,s))},enqueueReplaceState:function(e,t,i){e=e._reactInternals;var r=eh(),s=th(e),n=kn(r,s);n.tag=1,n.payload=t,void 0!==i&&null!==i&&(n.callback=i),null!==(t=Un(e,n,s))&&(ih(t,e,s,r),Vn(t,e,s))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var i=eh(),r=th(e),s=kn(i,r);s.tag=2,void 0!==t&&null!==t&&(s.callback=t),null!==(t=Un(e,s,r))&&(ih(t,e,r,i),Vn(t,e,r))}};function so(e,t,i,r,s,n,a){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,n,a):!t.prototype||!t.prototype.isPureReactComponent||(!or(i,r)||!or(s,n))}function no(e,t,i){var r=!1,s=Es,n=t.contextType;return"object"===typeof n&&null!==n?n=In(n):(s=Os(t)?Ps:Ss.current,n=(r=null!==(r=t.contextTypes)&&void 0!==r)?Is(e,s):Es),t=new t(i,n),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=ro,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=s,e.__reactInternalMemoizedMaskedChildContext=n),t}function ao(e,t,i,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(i,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(i,r),t.state!==e&&ro.enqueueReplaceState(t,t.state,null)}function oo(e,t,i,r){var s=e.stateNode;s.props=i,s.state=e.memoizedState,s.refs={},Bn(e);var n=t.contextType;"object"===typeof n&&null!==n?s.context=In(n):(n=Os(t)?Ps:Ss.current,s.context=Is(e,n)),s.state=e.memoizedState,"function"===typeof(n=t.getDerivedStateFromProps)&&(io(e,t,n,i),s.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof s.getSnapshotBeforeUpdate||"function"!==typeof s.UNSAFE_componentWillMount&&"function"!==typeof s.componentWillMount||(t=s.state,"function"===typeof s.componentWillMount&&s.componentWillMount(),"function"===typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount(),t!==s.state&&ro.enqueueReplaceState(s,s.state,null),Gn(e,i,s,r),s.state=e.memoizedState),"function"===typeof s.componentDidMount&&(e.flags|=4194308)}function lo(e,t){try{var i="",r=t;do{i+=z(r),r=r.return}while(r);var s=i}catch(n){s="\nError generating stack: "+n.message+"\n"+n.stack}return{value:e,source:t,stack:s,digest:null}}function ho(e,t,i){return{value:e,source:null,stack:null!=i?i:null,digest:null!=t?t:null}}function co(e,t){try{console.error(t.value)}catch(i){setTimeout((function(){throw i}))}}var uo="function"===typeof WeakMap?WeakMap:Map;function _o(e,t,i){(i=kn(-1,i)).tag=3,i.payload={element:null};var r=t.value;return i.callback=function(){Wl||(Wl=!0,ql=r),co(0,t)},i}function po(e,t,i){(i=kn(-1,i)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var s=t.value;i.payload=function(){return r(s)},i.callback=function(){co(0,t)}}var n=e.stateNode;return null!==n&&"function"===typeof n.componentDidCatch&&(i.callback=function(){co(0,t),"function"!==typeof r&&(null===Xl?Xl=new Set([this]):Xl.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),i}function fo(e,t,i){var r=e.pingCache;if(null===r){r=e.pingCache=new uo;var s=new Set;r.set(t,s)}else void 0===(s=r.get(t))&&(s=new Set,r.set(t,s));s.has(i)||(s.add(i),e=Rh.bind(null,e,t,i),t.then(e,e))}function go(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function mo(e,t,i,r,s){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,i.flags|=131072,i.flags&=-52805,1===i.tag&&(null===i.alternate?i.tag=17:((t=kn(-1,1)).tag=2,Un(i,t,1))),i.lanes|=1),e):(e.flags|=65536,e.lanes=s,e)}var bo=y.ReactCurrentOwner,vo=!1;function yo(e,t,i,r){t.child=null===e?Tn(t,null,i,r):yn(t,e.child,i,r)}function To(e,t,i,r,s){i=i.render;var n=t.ref;return Pn(t,s),r=fa(e,t,i,r,n,s),i=ga(),null===e||vo?(sn&&i&&Js(t),t.flags|=1,yo(e,t,r,s),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,Wo(e,t,s))}function xo(e,t,i,r,s){if(null===e){var n=i.type;return"function"!==typeof n||Dh(n)||void 0!==n.defaultProps||null!==i.compare||void 0!==i.defaultProps?((e=Fh(i.type,null,r,t,t.mode,s)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=n,Ao(e,t,n,r,s))}if(n=e.child,0===(e.lanes&s)){var a=n.memoizedProps;if((i=null!==(i=i.compare)?i:or)(a,r)&&e.ref===t.ref)return Wo(e,t,s)}return t.flags|=1,(e=wh(n,r)).ref=t.ref,e.return=t,t.child=e}function Ao(e,t,i,r,s){if(null!==e){var n=e.memoizedProps;if(or(n,r)&&e.ref===t.ref){if(vo=!1,t.pendingProps=r=n,0===(e.lanes&s))return t.lanes=e.lanes,Wo(e,t,s);0!==(131072&e.flags)&&(vo=!0)}}return Eo(e,t,i,r,s)}function Co(e,t,i){var r=t.pendingProps,s=r.children,n=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Rs(wl,Dl),Dl|=i;else{if(0===(1073741824&i))return e=null!==n?n.baseLanes|i:i,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Rs(wl,Dl),Dl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==n?n.baseLanes:i,Rs(wl,Dl),Dl|=r}else null!==n?(r=n.baseLanes|i,t.memoizedState=null):r=i,Rs(wl,Dl),Dl|=r;return yo(e,t,s,i),t.child}function Ro(e,t){var i=t.ref;(null===e&&null!==i||null!==e&&e.ref!==i)&&(t.flags|=512,t.flags|=2097152)}function Eo(e,t,i,r,s){var n=Os(i)?Ps:Ss.current;return n=Is(t,n),Pn(t,s),i=fa(e,t,i,r,n,s),r=ga(),null===e||vo?(sn&&r&&Js(t),t.flags|=1,yo(e,t,i,s),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,Wo(e,t,s))}function So(e,t,i,r,s){if(Os(i)){var n=!0;Ls(t)}else n=!1;if(Pn(t,s),null===t.stateNode)Ho(e,t),no(t,i,r),oo(t,i,r,s),r=!0;else if(null===e){var a=t.stateNode,o=t.memoizedProps;a.props=o;var l=a.context,h=i.contextType;"object"===typeof h&&null!==h?h=In(h):h=Is(t,h=Os(i)?Ps:Ss.current);var c=i.getDerivedStateFromProps,u="function"===typeof c||"function"===typeof a.getSnapshotBeforeUpdate;u||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(o!==r||l!==h)&&ao(t,a,r,h),Ln=!1;var d=t.memoizedState;a.state=d,Gn(t,r,a,s),l=t.memoizedState,o!==r||d!==l||Ms.current||Ln?("function"===typeof c&&(io(t,i,c,r),l=t.memoizedState),(o=Ln||so(t,i,o,r,d,l,h))?(u||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||("function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"===typeof a.componentDidMount&&(t.flags|=4194308)):("function"===typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),a.props=r,a.state=l,a.context=h,r=o):("function"===typeof a.componentDidMount&&(t.flags|=4194308),r=!1)}else{a=t.stateNode,Nn(e,t),o=t.memoizedProps,h=t.type===t.elementType?o:to(t.type,o),a.props=h,u=t.pendingProps,d=a.context,"object"===typeof(l=i.contextType)&&null!==l?l=In(l):l=Is(t,l=Os(i)?Ps:Ss.current);var _=i.getDerivedStateFromProps;(c="function"===typeof _||"function"===typeof a.getSnapshotBeforeUpdate)||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(o!==u||d!==l)&&ao(t,a,r,l),Ln=!1,d=t.memoizedState,a.state=d,Gn(t,r,a,s);var p=t.memoizedState;o!==u||d!==p||Ms.current||Ln?("function"===typeof _&&(io(t,i,_,r),p=t.memoizedState),(h=Ln||so(t,i,h,r,d,p,l)||!1)?(c||"function"!==typeof a.UNSAFE_componentWillUpdate&&"function"!==typeof a.componentWillUpdate||("function"===typeof a.componentWillUpdate&&a.componentWillUpdate(r,p,l),"function"===typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(r,p,l)),"function"===typeof a.componentDidUpdate&&(t.flags|=4),"function"===typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof a.componentDidUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=p),a.props=r,a.state=p,a.context=l,r=h):("function"!==typeof a.componentDidUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),r=!1)}return Mo(e,t,i,r,n,s)}function Mo(e,t,i,r,s,n){Ro(e,t);var a=0!==(128&t.flags);if(!r&&!a)return s&&Bs(t,i,!1),Wo(e,t,n);r=t.stateNode,bo.current=t;var o=a&&"function"!==typeof i.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&a?(t.child=yn(t,e.child,null,n),t.child=yn(t,null,o,n)):yo(e,t,o,n),t.memoizedState=r.state,s&&Bs(t,i,!0),t.child}function Po(e){var t=e.stateNode;t.pendingContext?ws(0,t.pendingContext,t.pendingContext!==t.context):t.context&&ws(0,t.context,!1),jn(e,t.containerInfo)}function Io(e,t,i,r,s){return _n(),pn(s),t.flags|=256,yo(e,t,i,r),t.child}var Oo,Do,wo,Fo,Lo={dehydrated:null,treeContext:null,retryLane:0};function Bo(e){return{baseLanes:e,cachePool:null,transitions:null}}function No(e,t,i){var r,s=t.pendingProps,a=Jn.current,o=!1,l=0!==(128&t.flags);if((r=l)||(r=(null===e||null!==e.memoizedState)&&0!==(2&a)),r?(o=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(a|=1),Rs(Jn,1&a),null===e)return hn(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=s.children,e=s.fallback,o?(s=t.mode,o=t.child,l={mode:"hidden",children:l},0===(1&s)&&null!==o?(o.childLanes=0,o.pendingProps=l):o=Bh(l,s,0,null),e=Lh(e,s,i,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=Bo(i),t.memoizedState=Lo,e):ko(t,l));if(null!==(a=e.memoizedState)&&null!==(r=a.dehydrated))return function(e,t,i,r,s,a,o){if(i)return 256&t.flags?(t.flags&=-257,Uo(e,t,o,r=ho(Error(n(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(a=r.fallback,s=t.mode,r=Bh({mode:"visible",children:r.children},s,0,null),(a=Lh(a,s,o,null)).flags|=2,r.return=t,a.return=t,r.sibling=a,t.child=r,0!==(1&t.mode)&&yn(t,e.child,null,o),t.child.memoizedState=Bo(o),t.memoizedState=Lo,a);if(0===(1&t.mode))return Uo(e,t,o,null);if("$!"===s.data){if(r=s.nextSibling&&s.nextSibling.dataset)var l=r.dgst;return r=l,Uo(e,t,o,r=ho(a=Error(n(419)),r,void 0))}if(l=0!==(o&e.childLanes),vo||l){if(null!==(r=Pl)){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}0!==(s=0!==(s&(r.suspendedLanes|o))?0:s)&&s!==a.retryLane&&(a.retryLane=s,Fn(e,s),ih(r,e,s,-1))}return fh(),Uo(e,t,o,r=ho(Error(n(421))))}return"$?"===s.data?(t.flags|=128,t.child=e.child,t=Sh.bind(null,e),s._reactRetry=t,null):(e=a.treeContext,rn=ls(s.nextSibling),tn=t,sn=!0,nn=null,null!==e&&(Xs[Ks++]=js,Xs[Ks++]=Qs,Xs[Ks++]=Ys,js=e.id,Qs=e.overflow,Ys=t),t=ko(t,r.children),t.flags|=4096,t)}(e,t,l,s,r,a,i);if(o){o=s.fallback,l=t.mode,r=(a=e.child).sibling;var h={mode:"hidden",children:s.children};return 0===(1&l)&&t.child!==a?((s=t.child).childLanes=0,s.pendingProps=h,t.deletions=null):(s=wh(a,h)).subtreeFlags=14680064&a.subtreeFlags,null!==r?o=wh(r,o):(o=Lh(o,l,i,null)).flags|=2,o.return=t,s.return=t,s.sibling=o,t.child=s,s=o,o=t.child,l=null===(l=e.child.memoizedState)?Bo(i):{baseLanes:l.baseLanes|i,cachePool:null,transitions:l.transitions},o.memoizedState=l,o.childLanes=e.childLanes&~i,t.memoizedState=Lo,s}return e=(o=e.child).sibling,s=wh(o,{mode:"visible",children:s.children}),0===(1&t.mode)&&(s.lanes=i),s.return=t,s.sibling=null,null!==e&&(null===(i=t.deletions)?(t.deletions=[e],t.flags|=16):i.push(e)),t.child=s,t.memoizedState=null,s}function ko(e,t){return(t=Bh({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Uo(e,t,i,r){return null!==r&&pn(r),yn(t,e.child,null,i),(e=ko(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Vo(e,t,i){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Mn(e.return,t,i)}function zo(e,t,i,r,s){var n=e.memoizedState;null===n?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:i,tailMode:s}:(n.isBackwards=t,n.rendering=null,n.renderingStartTime=0,n.last=r,n.tail=i,n.tailMode=s)}function Go(e,t,i){var r=t.pendingProps,s=r.revealOrder,n=r.tail;if(yo(e,t,r.children,i),0!==(2&(r=Jn.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Vo(e,i,t);else if(19===e.tag)Vo(e,i,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Rs(Jn,r),0===(1&t.mode))t.memoizedState=null;else switch(s){case"forwards":for(i=t.child,s=null;null!==i;)null!==(e=i.alternate)&&null===ea(e)&&(s=i),i=i.sibling;null===(i=s)?(s=t.child,t.child=null):(s=i.sibling,i.sibling=null),zo(t,!1,s,i,n);break;case"backwards":for(i=null,s=t.child,t.child=null;null!==s;){if(null!==(e=s.alternate)&&null===ea(e)){t.child=s;break}e=s.sibling,s.sibling=i,i=s,s=e}zo(t,!0,i,null,n);break;case"together":zo(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Ho(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Wo(e,t,i){if(null!==e&&(t.dependencies=e.dependencies),Bl|=t.lanes,0===(i&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(n(153));if(null!==t.child){for(i=wh(e=t.child,e.pendingProps),t.child=i,i.return=t;null!==e.sibling;)e=e.sibling,(i=i.sibling=wh(e,e.pendingProps)).return=t;i.sibling=null}return t.child}function qo(e,t){if(!sn)switch(e.tailMode){case"hidden":t=e.tail;for(var i=null;null!==t;)null!==t.alternate&&(i=t),t=t.sibling;null===i?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var r=null;null!==i;)null!==i.alternate&&(r=i),i=i.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Xo(e){var t=null!==e.alternate&&e.alternate.child===e.child,i=0,r=0;if(t)for(var s=e.child;null!==s;)i|=s.lanes|s.childLanes,r|=14680064&s.subtreeFlags,r|=14680064&s.flags,s.return=e,s=s.sibling;else for(s=e.child;null!==s;)i|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=e,s=s.sibling;return e.subtreeFlags|=r,e.childLanes=i,t}function Ko(e,t,i){var r=t.pendingProps;switch(en(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Xo(t),null;case 1:case 17:return Os(t.type)&&Ds(),Xo(t),null;case 3:return r=t.stateNode,Qn(),Cs(Ms),Cs(Ss),ia(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(un(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==nn&&(ah(nn),nn=null))),Do(e,t),Xo(t),null;case 5:Zn(t);var s=Yn(Kn.current);if(i=t.type,null!==e&&null!=t.stateNode)wo(e,t,i,r,s),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(n(166));return Xo(t),null}if(e=Yn(qn.current),un(t)){r=t.stateNode,i=t.type;var a=t.memoizedProps;switch(r[us]=t,r[ds]=a,e=0!==(1&t.mode),i){case"dialog":kr("cancel",r),kr("close",r);break;case"iframe":case"object":case"embed":kr("load",r);break;case"video":case"audio":for(s=0;s<Fr.length;s++)kr(Fr[s],r);break;case"source":kr("error",r);break;case"img":case"image":case"link":kr("error",r),kr("load",r);break;case"details":kr("toggle",r);break;case"input":Q(r,a),kr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!a.multiple},kr("invalid",r);break;case"textarea":se(r,a),kr("invalid",r)}for(var l in be(i,a),s=null,a)if(a.hasOwnProperty(l)){var h=a[l];"children"===l?"string"===typeof h?r.textContent!==h&&(!0!==a.suppressHydrationWarning&&$r(r.textContent,h,e),s=["children",h]):"number"===typeof h&&r.textContent!==""+h&&(!0!==a.suppressHydrationWarning&&$r(r.textContent,h,e),s=["children",""+h]):o.hasOwnProperty(l)&&null!=h&&"onScroll"===l&&kr("scroll",r)}switch(i){case"input":X(r),J(r,a,!0);break;case"textarea":X(r),ae(r);break;case"select":case"option":break;default:"function"===typeof a.onClick&&(r.onclick=Zr)}r=s,t.updateQueue=r,null!==r&&(t.flags|=4)}else{l=9===s.nodeType?s:s.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=oe(i)),"http://www.w3.org/1999/xhtml"===e?"script"===i?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=l.createElement(i,{is:r.is}):(e=l.createElement(i),"select"===i&&(l=e,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):e=l.createElementNS(e,i),e[us]=t,e[ds]=r,Oo(e,t,!1,!1),t.stateNode=e;e:{switch(l=ve(i,r),i){case"dialog":kr("cancel",e),kr("close",e),s=r;break;case"iframe":case"object":case"embed":kr("load",e),s=r;break;case"video":case"audio":for(s=0;s<Fr.length;s++)kr(Fr[s],e);s=r;break;case"source":kr("error",e),s=r;break;case"img":case"image":case"link":kr("error",e),kr("load",e),s=r;break;case"details":kr("toggle",e),s=r;break;case"input":Q(e,r),s=j(e,r),kr("invalid",e);break;case"option":default:s=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},s=N({},r,{value:void 0}),kr("invalid",e);break;case"textarea":se(e,r),s=re(e,r),kr("invalid",e)}for(a in be(i,s),h=s)if(h.hasOwnProperty(a)){var c=h[a];"style"===a?ge(e,c):"dangerouslySetInnerHTML"===a?null!=(c=c?c.__html:void 0)&&ue(e,c):"children"===a?"string"===typeof c?("textarea"!==i||""!==c)&&de(e,c):"number"===typeof c&&de(e,""+c):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(o.hasOwnProperty(a)?null!=c&&"onScroll"===a&&kr("scroll",e):null!=c&&v(e,a,c,l))}switch(i){case"input":X(e),J(e,r,!1);break;case"textarea":X(e),ae(e);break;case"option":null!=r.value&&e.setAttribute("value",""+W(r.value));break;case"select":e.multiple=!!r.multiple,null!=(a=r.value)?ie(e,!!r.multiple,a,!1):null!=r.defaultValue&&ie(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof s.onClick&&(e.onclick=Zr)}switch(i){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Xo(t),null;case 6:if(e&&null!=t.stateNode)Fo(e,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(n(166));if(i=Yn(Kn.current),Yn(qn.current),un(t)){if(r=t.stateNode,i=t.memoizedProps,r[us]=t,(a=r.nodeValue!==i)&&null!==(e=tn))switch(e.tag){case 3:$r(r.nodeValue,i,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&$r(r.nodeValue,i,0!==(1&e.mode))}a&&(t.flags|=4)}else(r=(9===i.nodeType?i:i.ownerDocument).createTextNode(r))[us]=t,t.stateNode=r}return Xo(t),null;case 13:if(Cs(Jn),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(sn&&null!==rn&&0!==(1&t.mode)&&0===(128&t.flags))dn(),_n(),t.flags|=98560,a=!1;else if(a=un(t),null!==r&&null!==r.dehydrated){if(null===e){if(!a)throw Error(n(318));if(!(a=null!==(a=t.memoizedState)?a.dehydrated:null))throw Error(n(317));a[us]=t}else _n(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Xo(t),a=!1}else null!==nn&&(ah(nn),nn=null),a=!0;if(!a)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=i,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&Jn.current)?0===Fl&&(Fl=3):fh())),null!==t.updateQueue&&(t.flags|=4),Xo(t),null);case 4:return Qn(),Do(e,t),null===e&&zr(t.stateNode.containerInfo),Xo(t),null;case 10:return Sn(t.type._context),Xo(t),null;case 19:if(Cs(Jn),null===(a=t.memoizedState))return Xo(t),null;if(r=0!==(128&t.flags),null===(l=a.rendering))if(r)qo(a,!1);else{if(0!==Fl||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=ea(e))){for(t.flags|=128,qo(a,!1),null!==(r=l.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=i,i=t.child;null!==i;)e=r,(a=i).flags&=14680066,null===(l=a.alternate)?(a.childLanes=0,a.lanes=e,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=l.childLanes,a.lanes=l.lanes,a.child=l.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=l.memoizedProps,a.memoizedState=l.memoizedState,a.updateQueue=l.updateQueue,a.type=l.type,e=l.dependencies,a.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),i=i.sibling;return Rs(Jn,1&Jn.current|2),t.child}e=e.sibling}null!==a.tail&&$e()>Gl&&(t.flags|=128,r=!0,qo(a,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=ea(l))){if(t.flags|=128,r=!0,null!==(i=e.updateQueue)&&(t.updateQueue=i,t.flags|=4),qo(a,!0),null===a.tail&&"hidden"===a.tailMode&&!l.alternate&&!sn)return Xo(t),null}else 2*$e()-a.renderingStartTime>Gl&&1073741824!==i&&(t.flags|=128,r=!0,qo(a,!1),t.lanes=4194304);a.isBackwards?(l.sibling=t.child,t.child=l):(null!==(i=a.last)?i.sibling=l:t.child=l,a.last=l)}return null!==a.tail?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=$e(),t.sibling=null,i=Jn.current,Rs(Jn,r?1&i|2:1&i),t):(Xo(t),null);case 22:case 23:return uh(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&Dl)&&(Xo(t),6&t.subtreeFlags&&(t.flags|=8192)):Xo(t),null;case 24:case 25:return null}throw Error(n(156,t.tag))}function Yo(e,t){switch(en(t),t.tag){case 1:return Os(t.type)&&Ds(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Qn(),Cs(Ms),Cs(Ss),ia(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return Zn(t),null;case 13:if(Cs(Jn),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(n(340));_n()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Cs(Jn),null;case 4:return Qn(),null;case 10:return Sn(t.type._context),null;case 22:case 23:return uh(),null;default:return null}}Oo=function(e,t){for(var i=t.child;null!==i;){if(5===i.tag||6===i.tag)e.appendChild(i.stateNode);else if(4!==i.tag&&null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}},Do=function(){},wo=function(e,t,i,r){var s=e.memoizedProps;if(s!==r){e=t.stateNode,Yn(qn.current);var n,a=null;switch(i){case"input":s=j(e,s),r=j(e,r),a=[];break;case"select":s=N({},s,{value:void 0}),r=N({},r,{value:void 0}),a=[];break;case"textarea":s=re(e,s),r=re(e,r),a=[];break;default:"function"!==typeof s.onClick&&"function"===typeof r.onClick&&(e.onclick=Zr)}for(c in be(i,r),i=null,s)if(!r.hasOwnProperty(c)&&s.hasOwnProperty(c)&&null!=s[c])if("style"===c){var l=s[c];for(n in l)l.hasOwnProperty(n)&&(i||(i={}),i[n]="")}else"dangerouslySetInnerHTML"!==c&&"children"!==c&&"suppressContentEditableWarning"!==c&&"suppressHydrationWarning"!==c&&"autoFocus"!==c&&(o.hasOwnProperty(c)?a||(a=[]):(a=a||[]).push(c,null));for(c in r){var h=r[c];if(l=null!=s?s[c]:void 0,r.hasOwnProperty(c)&&h!==l&&(null!=h||null!=l))if("style"===c)if(l){for(n in l)!l.hasOwnProperty(n)||h&&h.hasOwnProperty(n)||(i||(i={}),i[n]="");for(n in h)h.hasOwnProperty(n)&&l[n]!==h[n]&&(i||(i={}),i[n]=h[n])}else i||(a||(a=[]),a.push(c,i)),i=h;else"dangerouslySetInnerHTML"===c?(h=h?h.__html:void 0,l=l?l.__html:void 0,null!=h&&l!==h&&(a=a||[]).push(c,h)):"children"===c?"string"!==typeof h&&"number"!==typeof h||(a=a||[]).push(c,""+h):"suppressContentEditableWarning"!==c&&"suppressHydrationWarning"!==c&&(o.hasOwnProperty(c)?(null!=h&&"onScroll"===c&&kr("scroll",e),a||l===h||(a=[])):(a=a||[]).push(c,h))}i&&(a=a||[]).push("style",i);var c=a;(t.updateQueue=c)&&(t.flags|=4)}},Fo=function(e,t,i,r){i!==r&&(t.flags|=4)};var jo=!1,Qo=!1,$o="function"===typeof WeakSet?WeakSet:Set,Zo=null;function Jo(e,t){var i=e.ref;if(null!==i)if("function"===typeof i)try{i(null)}catch(r){Ch(e,t,r)}else i.current=null}function el(e,t,i){try{i()}catch(r){Ch(e,t,r)}}var tl=!1;function il(e,t,i){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var s=r=r.next;do{if((s.tag&e)===e){var n=s.destroy;s.destroy=void 0,void 0!==n&&el(t,i,n)}s=s.next}while(s!==r)}}function rl(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var i=t=t.next;do{if((i.tag&e)===e){var r=i.create;i.destroy=r()}i=i.next}while(i!==t)}}function sl(e){var t=e.ref;if(null!==t){var i=e.stateNode;e.tag,e=i,"function"===typeof t?t(e):t.current=e}}function nl(e){var t=e.alternate;null!==t&&(e.alternate=null,nl(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[us],delete t[ds],delete t[ps],delete t[fs],delete t[gs])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function al(e){return 5===e.tag||3===e.tag||4===e.tag}function ol(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||al(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function ll(e,t,i){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===i.nodeType?i.parentNode.insertBefore(e,t):i.insertBefore(e,t):(8===i.nodeType?(t=i.parentNode).insertBefore(e,i):(t=i).appendChild(e),null!==(i=i._reactRootContainer)&&void 0!==i||null!==t.onclick||(t.onclick=Zr));else if(4!==r&&null!==(e=e.child))for(ll(e,t,i),e=e.sibling;null!==e;)ll(e,t,i),e=e.sibling}function hl(e,t,i){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?i.insertBefore(e,t):i.appendChild(e);else if(4!==r&&null!==(e=e.child))for(hl(e,t,i),e=e.sibling;null!==e;)hl(e,t,i),e=e.sibling}var cl=null,ul=!1;function dl(e,t,i){for(i=i.child;null!==i;)_l(e,t,i),i=i.sibling}function _l(e,t,i){if(nt&&"function"===typeof nt.onCommitFiberUnmount)try{nt.onCommitFiberUnmount(st,i)}catch(o){}switch(i.tag){case 5:Qo||Jo(i,t);case 6:var r=cl,s=ul;cl=null,dl(e,t,i),ul=s,null!==(cl=r)&&(ul?(e=cl,i=i.stateNode,8===e.nodeType?e.parentNode.removeChild(i):e.removeChild(i)):cl.removeChild(i.stateNode));break;case 18:null!==cl&&(ul?(e=cl,i=i.stateNode,8===e.nodeType?os(e.parentNode,i):1===e.nodeType&&os(e,i),Gt(e)):os(cl,i.stateNode));break;case 4:r=cl,s=ul,cl=i.stateNode.containerInfo,ul=!0,dl(e,t,i),cl=r,ul=s;break;case 0:case 11:case 14:case 15:if(!Qo&&(null!==(r=i.updateQueue)&&null!==(r=r.lastEffect))){s=r=r.next;do{var n=s,a=n.destroy;n=n.tag,void 0!==a&&(0!==(2&n)||0!==(4&n))&&el(i,t,a),s=s.next}while(s!==r)}dl(e,t,i);break;case 1:if(!Qo&&(Jo(i,t),"function"===typeof(r=i.stateNode).componentWillUnmount))try{r.props=i.memoizedProps,r.state=i.memoizedState,r.componentWillUnmount()}catch(o){Ch(i,t,o)}dl(e,t,i);break;case 21:dl(e,t,i);break;case 22:1&i.mode?(Qo=(r=Qo)||null!==i.memoizedState,dl(e,t,i),Qo=r):dl(e,t,i);break;default:dl(e,t,i)}}function pl(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var i=e.stateNode;null===i&&(i=e.stateNode=new $o),t.forEach((function(t){var r=Mh.bind(null,e,t);i.has(t)||(i.add(t),t.then(r,r))}))}}function fl(e,t){var i=t.deletions;if(null!==i)for(var r=0;r<i.length;r++){var s=i[r];try{var a=e,o=t,l=o;e:for(;null!==l;){switch(l.tag){case 5:cl=l.stateNode,ul=!1;break e;case 3:case 4:cl=l.stateNode.containerInfo,ul=!0;break e}l=l.return}if(null===cl)throw Error(n(160));_l(a,o,s),cl=null,ul=!1;var h=s.alternate;null!==h&&(h.return=null),s.return=null}catch(c){Ch(s,t,c)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)gl(t,e),t=t.sibling}function gl(e,t){var i=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(fl(t,e),ml(e),4&r){try{il(3,e,e.return),rl(3,e)}catch(g){Ch(e,e.return,g)}try{il(5,e,e.return)}catch(g){Ch(e,e.return,g)}}break;case 1:fl(t,e),ml(e),512&r&&null!==i&&Jo(i,i.return);break;case 5:if(fl(t,e),ml(e),512&r&&null!==i&&Jo(i,i.return),32&e.flags){var s=e.stateNode;try{de(s,"")}catch(g){Ch(e,e.return,g)}}if(4&r&&null!=(s=e.stateNode)){var a=e.memoizedProps,o=null!==i?i.memoizedProps:a,l=e.type,h=e.updateQueue;if(e.updateQueue=null,null!==h)try{"input"===l&&"radio"===a.type&&null!=a.name&&$(s,a),ve(l,o);var c=ve(l,a);for(o=0;o<h.length;o+=2){var u=h[o],d=h[o+1];"style"===u?ge(s,d):"dangerouslySetInnerHTML"===u?ue(s,d):"children"===u?de(s,d):v(s,u,d,c)}switch(l){case"input":Z(s,a);break;case"textarea":ne(s,a);break;case"select":var _=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!a.multiple;var p=a.value;null!=p?ie(s,!!a.multiple,p,!1):_!==!!a.multiple&&(null!=a.defaultValue?ie(s,!!a.multiple,a.defaultValue,!0):ie(s,!!a.multiple,a.multiple?[]:"",!1))}s[ds]=a}catch(g){Ch(e,e.return,g)}}break;case 6:if(fl(t,e),ml(e),4&r){if(null===e.stateNode)throw Error(n(162));s=e.stateNode,a=e.memoizedProps;try{s.nodeValue=a}catch(g){Ch(e,e.return,g)}}break;case 3:if(fl(t,e),ml(e),4&r&&null!==i&&i.memoizedState.isDehydrated)try{Gt(t.containerInfo)}catch(g){Ch(e,e.return,g)}break;case 4:default:fl(t,e),ml(e);break;case 13:fl(t,e),ml(e),8192&(s=e.child).flags&&(a=null!==s.memoizedState,s.stateNode.isHidden=a,!a||null!==s.alternate&&null!==s.alternate.memoizedState||(zl=$e())),4&r&&pl(e);break;case 22:if(u=null!==i&&null!==i.memoizedState,1&e.mode?(Qo=(c=Qo)||u,fl(t,e),Qo=c):fl(t,e),ml(e),8192&r){if(c=null!==e.memoizedState,(e.stateNode.isHidden=c)&&!u&&0!==(1&e.mode))for(Zo=e,u=e.child;null!==u;){for(d=Zo=u;null!==Zo;){switch(p=(_=Zo).child,_.tag){case 0:case 11:case 14:case 15:il(4,_,_.return);break;case 1:Jo(_,_.return);var f=_.stateNode;if("function"===typeof f.componentWillUnmount){r=_,i=_.return;try{t=r,f.props=t.memoizedProps,f.state=t.memoizedState,f.componentWillUnmount()}catch(g){Ch(r,i,g)}}break;case 5:Jo(_,_.return);break;case 22:if(null!==_.memoizedState){Tl(d);continue}}null!==p?(p.return=_,Zo=p):Tl(d)}u=u.sibling}e:for(u=null,d=e;;){if(5===d.tag){if(null===u){u=d;try{s=d.stateNode,c?"function"===typeof(a=s.style).setProperty?a.setProperty("display","none","important"):a.display="none":(l=d.stateNode,o=void 0!==(h=d.memoizedProps.style)&&null!==h&&h.hasOwnProperty("display")?h.display:null,l.style.display=fe("display",o))}catch(g){Ch(e,e.return,g)}}}else if(6===d.tag){if(null===u)try{d.stateNode.nodeValue=c?"":d.memoizedProps}catch(g){Ch(e,e.return,g)}}else if((22!==d.tag&&23!==d.tag||null===d.memoizedState||d===e)&&null!==d.child){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;null===d.sibling;){if(null===d.return||d.return===e)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:fl(t,e),ml(e),4&r&&pl(e);case 21:}}function ml(e){var t=e.flags;if(2&t){try{e:{for(var i=e.return;null!==i;){if(al(i)){var r=i;break e}i=i.return}throw Error(n(160))}switch(r.tag){case 5:var s=r.stateNode;32&r.flags&&(de(s,""),r.flags&=-33),hl(e,ol(e),s);break;case 3:case 4:var a=r.stateNode.containerInfo;ll(e,ol(e),a);break;default:throw Error(n(161))}}catch(o){Ch(e,e.return,o)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function bl(e,t,i){Zo=e,vl(e,t,i)}function vl(e,t,i){for(var r=0!==(1&e.mode);null!==Zo;){var s=Zo,n=s.child;if(22===s.tag&&r){var a=null!==s.memoizedState||jo;if(!a){var o=s.alternate,l=null!==o&&null!==o.memoizedState||Qo;o=jo;var h=Qo;if(jo=a,(Qo=l)&&!h)for(Zo=s;null!==Zo;)l=(a=Zo).child,22===a.tag&&null!==a.memoizedState?xl(s):null!==l?(l.return=a,Zo=l):xl(s);for(;null!==n;)Zo=n,vl(n,t,i),n=n.sibling;Zo=s,jo=o,Qo=h}yl(e)}else 0!==(8772&s.subtreeFlags)&&null!==n?(n.return=s,Zo=n):yl(e)}}function yl(e){for(;null!==Zo;){var t=Zo;if(0!==(8772&t.flags)){var i=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Qo||rl(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!Qo)if(null===i)r.componentDidMount();else{var s=t.elementType===t.type?i.memoizedProps:to(t.type,i.memoizedProps);r.componentDidUpdate(s,i.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;null!==a&&Hn(t,a,r);break;case 3:var o=t.updateQueue;if(null!==o){if(i=null,null!==t.child)switch(t.child.tag){case 5:case 1:i=t.child.stateNode}Hn(t,o,i)}break;case 5:var l=t.stateNode;if(null===i&&4&t.flags){i=l;var h=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":h.autoFocus&&i.focus();break;case"img":h.src&&(i.src=h.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var c=t.alternate;if(null!==c){var u=c.memoizedState;if(null!==u){var d=u.dehydrated;null!==d&&Gt(d)}}}break;default:throw Error(n(163))}Qo||512&t.flags&&sl(t)}catch(_){Ch(t,t.return,_)}}if(t===e){Zo=null;break}if(null!==(i=t.sibling)){i.return=t.return,Zo=i;break}Zo=t.return}}function Tl(e){for(;null!==Zo;){var t=Zo;if(t===e){Zo=null;break}var i=t.sibling;if(null!==i){i.return=t.return,Zo=i;break}Zo=t.return}}function xl(e){for(;null!==Zo;){var t=Zo;try{switch(t.tag){case 0:case 11:case 15:var i=t.return;try{rl(4,t)}catch(l){Ch(t,i,l)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var s=t.return;try{r.componentDidMount()}catch(l){Ch(t,s,l)}}var n=t.return;try{sl(t)}catch(l){Ch(t,n,l)}break;case 5:var a=t.return;try{sl(t)}catch(l){Ch(t,a,l)}}}catch(l){Ch(t,t.return,l)}if(t===e){Zo=null;break}var o=t.sibling;if(null!==o){o.return=t.return,Zo=o;break}Zo=t.return}}var Al,Cl=Math.ceil,Rl=y.ReactCurrentDispatcher,El=y.ReactCurrentOwner,Sl=y.ReactCurrentBatchConfig,Ml=0,Pl=null,Il=null,Ol=0,Dl=0,wl=As(0),Fl=0,Ll=null,Bl=0,Nl=0,kl=0,Ul=null,Vl=null,zl=0,Gl=1/0,Hl=null,Wl=!1,ql=null,Xl=null,Kl=!1,Yl=null,jl=0,Ql=0,$l=null,Zl=-1,Jl=0;function eh(){return 0!==(6&Ml)?$e():-1!==Zl?Zl:Zl=$e()}function th(e){return 0===(1&e.mode)?1:0!==(2&Ml)&&0!==Ol?Ol&-Ol:null!==fn.transition?(0===Jl&&(Jl=ft()),Jl):0!==(e=vt)?e:e=void 0===(e=window.event)?16:Qt(e.type)}function ih(e,t,i,r){if(50<Ql)throw Ql=0,$l=null,Error(n(185));mt(e,i,r),0!==(2&Ml)&&e===Pl||(e===Pl&&(0===(2&Ml)&&(Nl|=i),4===Fl&&oh(e,Ol)),rh(e,r),1===i&&0===Ml&&0===(1&t.mode)&&(Gl=$e()+500,ks&&zs()))}function rh(e,t){var i=e.callbackNode;!function(e,t){for(var i=e.suspendedLanes,r=e.pingedLanes,s=e.expirationTimes,n=e.pendingLanes;0<n;){var a=31-at(n),o=1<<a,l=s[a];-1===l?0!==(o&i)&&0===(o&r)||(s[a]=_t(o,t)):l<=t&&(e.expiredLanes|=o),n&=~o}}(e,t);var r=dt(e,e===Pl?Ol:0);if(0===r)null!==i&&Ye(i),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=i&&Ye(i),1===t)0===e.tag?function(e){ks=!0,Vs(e)}(lh.bind(null,e)):Vs(lh.bind(null,e)),ns((function(){0===(6&Ml)&&zs()})),i=null;else{switch(yt(r)){case 1:i=Je;break;case 4:i=et;break;case 16:default:i=tt;break;case 536870912:i=rt}i=Ph(i,sh.bind(null,e))}e.callbackPriority=t,e.callbackNode=i}}function sh(e,t){if(Zl=-1,Jl=0,0!==(6&Ml))throw Error(n(327));var i=e.callbackNode;if(xh()&&e.callbackNode!==i)return null;var r=dt(e,e===Pl?Ol:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=gh(e,r);else{t=r;var s=Ml;Ml|=2;var a=ph();for(Pl===e&&Ol===t||(Hl=null,Gl=$e()+500,dh(e,t));;)try{bh();break}catch(l){_h(e,l)}En(),Rl.current=a,Ml=s,null!==Il?t=0:(Pl=null,Ol=0,t=Fl)}if(0!==t){if(2===t&&(0!==(s=pt(e))&&(r=s,t=nh(e,s))),1===t)throw i=Ll,dh(e,0),oh(e,r),rh(e,$e()),i;if(6===t)oh(e,r);else{if(s=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var i=t.updateQueue;if(null!==i&&null!==(i=i.stores))for(var r=0;r<i.length;r++){var s=i[r],n=s.getSnapshot;s=s.value;try{if(!ar(n(),s))return!1}catch(o){return!1}}}if(i=t.child,16384&t.subtreeFlags&&null!==i)i.return=t,t=i;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(s)&&(2===(t=gh(e,r))&&(0!==(a=pt(e))&&(r=a,t=nh(e,a))),1===t))throw i=Ll,dh(e,0),oh(e,r),rh(e,$e()),i;switch(e.finishedWork=s,e.finishedLanes=r,t){case 0:case 1:throw Error(n(345));case 2:case 5:Th(e,Vl,Hl);break;case 3:if(oh(e,r),(130023424&r)===r&&10<(t=zl+500-$e())){if(0!==dt(e,0))break;if(((s=e.suspendedLanes)&r)!==r){eh(),e.pingedLanes|=e.suspendedLanes&s;break}e.timeoutHandle=is(Th.bind(null,e,Vl,Hl),t);break}Th(e,Vl,Hl);break;case 4:if(oh(e,r),(4194240&r)===r)break;for(t=e.eventTimes,s=-1;0<r;){var o=31-at(r);a=1<<o,(o=t[o])>s&&(s=o),r&=~a}if(r=s,10<(r=(120>(r=$e()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Cl(r/1960))-r)){e.timeoutHandle=is(Th.bind(null,e,Vl,Hl),r);break}Th(e,Vl,Hl);break;default:throw Error(n(329))}}}return rh(e,$e()),e.callbackNode===i?sh.bind(null,e):null}function nh(e,t){var i=Ul;return e.current.memoizedState.isDehydrated&&(dh(e,t).flags|=256),2!==(e=gh(e,t))&&(t=Vl,Vl=i,null!==t&&ah(t)),e}function ah(e){null===Vl?Vl=e:Vl.push.apply(Vl,e)}function oh(e,t){for(t&=~kl,t&=~Nl,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var i=31-at(t),r=1<<i;e[i]=-1,t&=~r}}function lh(e){if(0!==(6&Ml))throw Error(n(327));xh();var t=dt(e,0);if(0===(1&t))return rh(e,$e()),null;var i=gh(e,t);if(0!==e.tag&&2===i){var r=pt(e);0!==r&&(t=r,i=nh(e,r))}if(1===i)throw i=Ll,dh(e,0),oh(e,t),rh(e,$e()),i;if(6===i)throw Error(n(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Th(e,Vl,Hl),rh(e,$e()),null}function hh(e,t){var i=Ml;Ml|=1;try{return e(t)}finally{0===(Ml=i)&&(Gl=$e()+500,ks&&zs())}}function ch(e){null!==Yl&&0===Yl.tag&&0===(6&Ml)&&xh();var t=Ml;Ml|=1;var i=Sl.transition,r=vt;try{if(Sl.transition=null,vt=1,e)return e()}finally{vt=r,Sl.transition=i,0===(6&(Ml=t))&&zs()}}function uh(){Dl=wl.current,Cs(wl)}function dh(e,t){e.finishedWork=null,e.finishedLanes=0;var i=e.timeoutHandle;if(-1!==i&&(e.timeoutHandle=-1,rs(i)),null!==Il)for(i=Il.return;null!==i;){var r=i;switch(en(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&Ds();break;case 3:Qn(),Cs(Ms),Cs(Ss),ia();break;case 5:Zn(r);break;case 4:Qn();break;case 13:case 19:Cs(Jn);break;case 10:Sn(r.type._context);break;case 22:case 23:uh()}i=i.return}if(Pl=e,Il=e=wh(e.current,null),Ol=Dl=t,Fl=0,Ll=null,kl=Nl=Bl=0,Vl=Ul=null,null!==On){for(t=0;t<On.length;t++)if(null!==(r=(i=On[t]).interleaved)){i.interleaved=null;var s=r.next,n=i.pending;if(null!==n){var a=n.next;n.next=s,r.next=a}i.pending=r}On=null}return e}function _h(e,t){for(;;){var i=Il;try{if(En(),ra.current=$a,ha){for(var r=aa.memoizedState;null!==r;){var s=r.queue;null!==s&&(s.pending=null),r=r.next}ha=!1}if(na=0,la=oa=aa=null,ca=!1,ua=0,El.current=null,null===i||null===i.return){Fl=1,Ll=t,Il=null;break}e:{var a=e,o=i.return,l=i,h=t;if(t=Ol,l.flags|=32768,null!==h&&"object"===typeof h&&"function"===typeof h.then){var c=h,u=l,d=u.tag;if(0===(1&u.mode)&&(0===d||11===d||15===d)){var _=u.alternate;_?(u.updateQueue=_.updateQueue,u.memoizedState=_.memoizedState,u.lanes=_.lanes):(u.updateQueue=null,u.memoizedState=null)}var p=go(o);if(null!==p){p.flags&=-257,mo(p,o,l,0,t),1&p.mode&&fo(a,c,t),h=c;var f=(t=p).updateQueue;if(null===f){var g=new Set;g.add(h),t.updateQueue=g}else f.add(h);break e}if(0===(1&t)){fo(a,c,t),fh();break e}h=Error(n(426))}else if(sn&&1&l.mode){var m=go(o);if(null!==m){0===(65536&m.flags)&&(m.flags|=256),mo(m,o,l,0,t),pn(lo(h,l));break e}}a=h=lo(h,l),4!==Fl&&(Fl=2),null===Ul?Ul=[a]:Ul.push(a),a=o;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t,zn(a,_o(0,h,t));break e;case 1:l=h;var b=a.type,v=a.stateNode;if(0===(128&a.flags)&&("function"===typeof b.getDerivedStateFromError||null!==v&&"function"===typeof v.componentDidCatch&&(null===Xl||!Xl.has(v)))){a.flags|=65536,t&=-t,a.lanes|=t,zn(a,po(a,l,t));break e}}a=a.return}while(null!==a)}yh(i)}catch(y){t=y,Il===i&&null!==i&&(Il=i=i.return);continue}break}}function ph(){var e=Rl.current;return Rl.current=$a,null===e?$a:e}function fh(){0!==Fl&&3!==Fl&&2!==Fl||(Fl=4),null===Pl||0===(268435455&Bl)&&0===(268435455&Nl)||oh(Pl,Ol)}function gh(e,t){var i=Ml;Ml|=2;var r=ph();for(Pl===e&&Ol===t||(Hl=null,dh(e,t));;)try{mh();break}catch(s){_h(e,s)}if(En(),Ml=i,Rl.current=r,null!==Il)throw Error(n(261));return Pl=null,Ol=0,Fl}function mh(){for(;null!==Il;)vh(Il)}function bh(){for(;null!==Il&&!je();)vh(Il)}function vh(e){var t=Al(e.alternate,e,Dl);e.memoizedProps=e.pendingProps,null===t?yh(e):Il=t,El.current=null}function yh(e){var t=e;do{var i=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(i=Ko(i,t,Dl)))return void(Il=i)}else{if(null!==(i=Yo(i,t)))return i.flags&=32767,void(Il=i);if(null===e)return Fl=6,void(Il=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Il=t);Il=t=e}while(null!==t);0===Fl&&(Fl=5)}function Th(e,t,i){var r=vt,s=Sl.transition;try{Sl.transition=null,vt=1,function(e,t,i,r){do{xh()}while(null!==Yl);if(0!==(6&Ml))throw Error(n(327));i=e.finishedWork;var s=e.finishedLanes;if(null===i)return null;if(e.finishedWork=null,e.finishedLanes=0,i===e.current)throw Error(n(177));e.callbackNode=null,e.callbackPriority=0;var a=i.lanes|i.childLanes;if(function(e,t){var i=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<i;){var s=31-at(i),n=1<<s;t[s]=0,r[s]=-1,e[s]=-1,i&=~n}}(e,a),e===Pl&&(Il=Pl=null,Ol=0),0===(2064&i.subtreeFlags)&&0===(2064&i.flags)||Kl||(Kl=!0,Ph(tt,(function(){return xh(),null}))),a=0!==(15990&i.flags),0!==(15990&i.subtreeFlags)||a){a=Sl.transition,Sl.transition=null;var o=vt;vt=1;var l=Ml;Ml|=4,El.current=null,function(e,t){if(Jr=Wt,dr(e=ur())){if("selectionStart"in e)var i={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(i=(i=e.ownerDocument)&&i.defaultView||window).getSelection&&i.getSelection();if(r&&0!==r.rangeCount){i=r.anchorNode;var s=r.anchorOffset,a=r.focusNode;r=r.focusOffset;try{i.nodeType,a.nodeType}catch(T){i=null;break e}var o=0,l=-1,h=-1,c=0,u=0,d=e,_=null;t:for(;;){for(var p;d!==i||0!==s&&3!==d.nodeType||(l=o+s),d!==a||0!==r&&3!==d.nodeType||(h=o+r),3===d.nodeType&&(o+=d.nodeValue.length),null!==(p=d.firstChild);)_=d,d=p;for(;;){if(d===e)break t;if(_===i&&++c===s&&(l=o),_===a&&++u===r&&(h=o),null!==(p=d.nextSibling))break;_=(d=_).parentNode}d=p}i=-1===l||-1===h?null:{start:l,end:h}}else i=null}i=i||{start:0,end:0}}else i=null;for(es={focusedElem:e,selectionRange:i},Wt=!1,Zo=t;null!==Zo;)if(e=(t=Zo).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Zo=e;else for(;null!==Zo;){t=Zo;try{var f=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==f){var g=f.memoizedProps,m=f.memoizedState,b=t.stateNode,v=b.getSnapshotBeforeUpdate(t.elementType===t.type?g:to(t.type,g),m);b.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var y=t.stateNode.containerInfo;1===y.nodeType?y.textContent="":9===y.nodeType&&y.documentElement&&y.removeChild(y.documentElement);break;default:throw Error(n(163))}}catch(T){Ch(t,t.return,T)}if(null!==(e=t.sibling)){e.return=t.return,Zo=e;break}Zo=t.return}f=tl,tl=!1}(e,i),gl(i,e),_r(es),Wt=!!Jr,es=Jr=null,e.current=i,bl(i,e,s),Qe(),Ml=l,vt=o,Sl.transition=a}else e.current=i;if(Kl&&(Kl=!1,Yl=e,jl=s),a=e.pendingLanes,0===a&&(Xl=null),function(e){if(nt&&"function"===typeof nt.onCommitFiberRoot)try{nt.onCommitFiberRoot(st,e,void 0,128===(128&e.current.flags))}catch(t){}}(i.stateNode),rh(e,$e()),null!==t)for(r=e.onRecoverableError,i=0;i<t.length;i++)s=t[i],r(s.value,{componentStack:s.stack,digest:s.digest});if(Wl)throw Wl=!1,e=ql,ql=null,e;0!==(1&jl)&&0!==e.tag&&xh(),a=e.pendingLanes,0!==(1&a)?e===$l?Ql++:(Ql=0,$l=e):Ql=0,zs()}(e,t,i,r)}finally{Sl.transition=s,vt=r}return null}function xh(){if(null!==Yl){var e=yt(jl),t=Sl.transition,i=vt;try{if(Sl.transition=null,vt=16>e?16:e,null===Yl)var r=!1;else{if(e=Yl,Yl=null,jl=0,0!==(6&Ml))throw Error(n(331));var s=Ml;for(Ml|=4,Zo=e.current;null!==Zo;){var a=Zo,o=a.child;if(0!==(16&Zo.flags)){var l=a.deletions;if(null!==l){for(var h=0;h<l.length;h++){var c=l[h];for(Zo=c;null!==Zo;){var u=Zo;switch(u.tag){case 0:case 11:case 15:il(8,u,a)}var d=u.child;if(null!==d)d.return=u,Zo=d;else for(;null!==Zo;){var _=(u=Zo).sibling,p=u.return;if(nl(u),u===c){Zo=null;break}if(null!==_){_.return=p,Zo=_;break}Zo=p}}}var f=a.alternate;if(null!==f){var g=f.child;if(null!==g){f.child=null;do{var m=g.sibling;g.sibling=null,g=m}while(null!==g)}}Zo=a}}if(0!==(2064&a.subtreeFlags)&&null!==o)o.return=a,Zo=o;else e:for(;null!==Zo;){if(0!==(2048&(a=Zo).flags))switch(a.tag){case 0:case 11:case 15:il(9,a,a.return)}var b=a.sibling;if(null!==b){b.return=a.return,Zo=b;break e}Zo=a.return}}var v=e.current;for(Zo=v;null!==Zo;){var y=(o=Zo).child;if(0!==(2064&o.subtreeFlags)&&null!==y)y.return=o,Zo=y;else e:for(o=v;null!==Zo;){if(0!==(2048&(l=Zo).flags))try{switch(l.tag){case 0:case 11:case 15:rl(9,l)}}catch(x){Ch(l,l.return,x)}if(l===o){Zo=null;break e}var T=l.sibling;if(null!==T){T.return=l.return,Zo=T;break e}Zo=l.return}}if(Ml=s,zs(),nt&&"function"===typeof nt.onPostCommitFiberRoot)try{nt.onPostCommitFiberRoot(st,e)}catch(x){}r=!0}return r}finally{vt=i,Sl.transition=t}}return!1}function Ah(e,t,i){e=Un(e,t=_o(0,t=lo(i,t),1),1),t=eh(),null!==e&&(mt(e,1,t),rh(e,t))}function Ch(e,t,i){if(3===e.tag)Ah(e,e,i);else for(;null!==t;){if(3===t.tag){Ah(t,e,i);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Xl||!Xl.has(r))){t=Un(t,e=po(t,e=lo(i,e),1),1),e=eh(),null!==t&&(mt(t,1,e),rh(t,e));break}}t=t.return}}function Rh(e,t,i){var r=e.pingCache;null!==r&&r.delete(t),t=eh(),e.pingedLanes|=e.suspendedLanes&i,Pl===e&&(Ol&i)===i&&(4===Fl||3===Fl&&(130023424&Ol)===Ol&&500>$e()-zl?dh(e,0):kl|=i),rh(e,t)}function Eh(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ct,0===(130023424&(ct<<=1))&&(ct=4194304)));var i=eh();null!==(e=Fn(e,t))&&(mt(e,t,i),rh(e,i))}function Sh(e){var t=e.memoizedState,i=0;null!==t&&(i=t.retryLane),Eh(e,i)}function Mh(e,t){var i=0;switch(e.tag){case 13:var r=e.stateNode,s=e.memoizedState;null!==s&&(i=s.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(n(314))}null!==r&&r.delete(t),Eh(e,i)}function Ph(e,t){return Ke(e,t)}function Ih(e,t,i,r){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Oh(e,t,i,r){return new Ih(e,t,i,r)}function Dh(e){return!(!(e=e.prototype)||!e.isReactComponent)}function wh(e,t){var i=e.alternate;return null===i?((i=Oh(e.tag,t,e.key,e.mode)).elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=t,i.type=e.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=14680064&e.flags,i.childLanes=e.childLanes,i.lanes=e.lanes,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,t=e.dependencies,i.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i}function Fh(e,t,i,r,s,a){var o=2;if(r=e,"function"===typeof e)Dh(e)&&(o=1);else if("string"===typeof e)o=5;else e:switch(e){case A:return Lh(i.children,s,a,t);case C:o=8,s|=8;break;case R:return(e=Oh(12,i,t,2|s)).elementType=R,e.lanes=a,e;case P:return(e=Oh(13,i,t,s)).elementType=P,e.lanes=a,e;case I:return(e=Oh(19,i,t,s)).elementType=I,e.lanes=a,e;case w:return Bh(i,s,a,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case E:o=10;break e;case S:o=9;break e;case M:o=11;break e;case O:o=14;break e;case D:o=16,r=null;break e}throw Error(n(130,null==e?e:typeof e,""))}return(t=Oh(o,i,t,s)).elementType=e,t.type=r,t.lanes=a,t}function Lh(e,t,i,r){return(e=Oh(7,e,r,t)).lanes=i,e}function Bh(e,t,i,r){return(e=Oh(22,e,r,t)).elementType=w,e.lanes=i,e.stateNode={isHidden:!1},e}function Nh(e,t,i){return(e=Oh(6,e,null,t)).lanes=i,e}function kh(e,t,i){return(t=Oh(4,null!==e.children?e.children:[],e.key,t)).lanes=i,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Uh(e,t,i,r,s){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function Vh(e,t,i,r,s,n,a,o,l){return e=new Uh(e,t,i,o,l),1===t?(t=1,!0===n&&(t|=8)):t=0,n=Oh(3,null,null,t),e.current=n,n.stateNode=e,n.memoizedState={element:r,isDehydrated:i,cache:null,transitions:null,pendingSuspenseBoundaries:null},Bn(n),e}function zh(e){if(!e)return Es;e:{if(Ge(e=e._reactInternals)!==e||1!==e.tag)throw Error(n(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Os(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(n(171))}if(1===e.tag){var i=e.type;if(Os(i))return Fs(e,i,t)}return t}function Gh(e,t,i,r,s,n,a,o,l){return(e=Vh(i,r,!0,e,0,n,0,o,l)).context=zh(null),i=e.current,(n=kn(r=eh(),s=th(i))).callback=void 0!==t&&null!==t?t:null,Un(i,n,s),e.current.lanes=s,mt(e,s,r),rh(e,r),e}function Hh(e,t,i,r){var s=t.current,n=eh(),a=th(s);return i=zh(i),null===t.context?t.context=i:t.pendingContext=i,(t=kn(n,a)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=Un(s,t,a))&&(ih(e,s,a,n),Vn(e,s,a)),a}function Wh(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function qh(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var i=e.retryLane;e.retryLane=0!==i&&i<t?i:t}}function Xh(e,t){qh(e,t),(e=e.alternate)&&qh(e,t)}Al=function(e,t,i){if(null!==e)if(e.memoizedProps!==t.pendingProps||Ms.current)vo=!0;else{if(0===(e.lanes&i)&&0===(128&t.flags))return vo=!1,function(e,t,i){switch(t.tag){case 3:Po(t),_n();break;case 5:$n(t);break;case 1:Os(t.type)&&Ls(t);break;case 4:jn(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,s=t.memoizedProps.value;Rs(xn,r._currentValue),r._currentValue=s;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Rs(Jn,1&Jn.current),t.flags|=128,null):0!==(i&t.child.childLanes)?No(e,t,i):(Rs(Jn,1&Jn.current),null!==(e=Wo(e,t,i))?e.sibling:null);Rs(Jn,1&Jn.current);break;case 19:if(r=0!==(i&t.childLanes),0!==(128&e.flags)){if(r)return Go(e,t,i);t.flags|=128}if(null!==(s=t.memoizedState)&&(s.rendering=null,s.tail=null,s.lastEffect=null),Rs(Jn,Jn.current),r)break;return null;case 22:case 23:return t.lanes=0,Co(e,t,i)}return Wo(e,t,i)}(e,t,i);vo=0!==(131072&e.flags)}else vo=!1,sn&&0!==(1048576&t.flags)&&Zs(t,qs,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Ho(e,t),e=t.pendingProps;var s=Is(t,Ss.current);Pn(t,i),s=fa(null,t,r,e,s,i);var a=ga();return t.flags|=1,"object"===typeof s&&null!==s&&"function"===typeof s.render&&void 0===s.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Os(r)?(a=!0,Ls(t)):a=!1,t.memoizedState=null!==s.state&&void 0!==s.state?s.state:null,Bn(t),s.updater=ro,t.stateNode=s,s._reactInternals=t,oo(t,r,e,i),t=Mo(null,t,r,!0,a,i)):(t.tag=0,sn&&a&&Js(t),yo(null,t,s,i),t=t.child),t;case 16:r=t.elementType;e:{switch(Ho(e,t),e=t.pendingProps,r=(s=r._init)(r._payload),t.type=r,s=t.tag=function(e){if("function"===typeof e)return Dh(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===M)return 11;if(e===O)return 14}return 2}(r),e=to(r,e),s){case 0:t=Eo(null,t,r,e,i);break e;case 1:t=So(null,t,r,e,i);break e;case 11:t=To(null,t,r,e,i);break e;case 14:t=xo(null,t,r,to(r.type,e),i);break e}throw Error(n(306,r,""))}return t;case 0:return r=t.type,s=t.pendingProps,Eo(e,t,r,s=t.elementType===r?s:to(r,s),i);case 1:return r=t.type,s=t.pendingProps,So(e,t,r,s=t.elementType===r?s:to(r,s),i);case 3:e:{if(Po(t),null===e)throw Error(n(387));r=t.pendingProps,s=(a=t.memoizedState).element,Nn(e,t),Gn(t,r,null,i);var o=t.memoizedState;if(r=o.element,a.isDehydrated){if(a={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=Io(e,t,r,i,s=lo(Error(n(423)),t));break e}if(r!==s){t=Io(e,t,r,i,s=lo(Error(n(424)),t));break e}for(rn=ls(t.stateNode.containerInfo.firstChild),tn=t,sn=!0,nn=null,i=Tn(t,null,r,i),t.child=i;i;)i.flags=-3&i.flags|4096,i=i.sibling}else{if(_n(),r===s){t=Wo(e,t,i);break e}yo(e,t,r,i)}t=t.child}return t;case 5:return $n(t),null===e&&hn(t),r=t.type,s=t.pendingProps,a=null!==e?e.memoizedProps:null,o=s.children,ts(r,s)?o=null:null!==a&&ts(r,a)&&(t.flags|=32),Ro(e,t),yo(e,t,o,i),t.child;case 6:return null===e&&hn(t),null;case 13:return No(e,t,i);case 4:return jn(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=yn(t,null,r,i):yo(e,t,r,i),t.child;case 11:return r=t.type,s=t.pendingProps,To(e,t,r,s=t.elementType===r?s:to(r,s),i);case 7:return yo(e,t,t.pendingProps,i),t.child;case 8:case 12:return yo(e,t,t.pendingProps.children,i),t.child;case 10:e:{if(r=t.type._context,s=t.pendingProps,a=t.memoizedProps,o=s.value,Rs(xn,r._currentValue),r._currentValue=o,null!==a)if(ar(a.value,o)){if(a.children===s.children&&!Ms.current){t=Wo(e,t,i);break e}}else for(null!==(a=t.child)&&(a.return=t);null!==a;){var l=a.dependencies;if(null!==l){o=a.child;for(var h=l.firstContext;null!==h;){if(h.context===r){if(1===a.tag){(h=kn(-1,i&-i)).tag=2;var c=a.updateQueue;if(null!==c){var u=(c=c.shared).pending;null===u?h.next=h:(h.next=u.next,u.next=h),c.pending=h}}a.lanes|=i,null!==(h=a.alternate)&&(h.lanes|=i),Mn(a.return,i,t),l.lanes|=i;break}h=h.next}}else if(10===a.tag)o=a.type===t.type?null:a.child;else if(18===a.tag){if(null===(o=a.return))throw Error(n(341));o.lanes|=i,null!==(l=o.alternate)&&(l.lanes|=i),Mn(o,i,t),o=a.sibling}else o=a.child;if(null!==o)o.return=a;else for(o=a;null!==o;){if(o===t){o=null;break}if(null!==(a=o.sibling)){a.return=o.return,o=a;break}o=o.return}a=o}yo(e,t,s.children,i),t=t.child}return t;case 9:return s=t.type,r=t.pendingProps.children,Pn(t,i),r=r(s=In(s)),t.flags|=1,yo(e,t,r,i),t.child;case 14:return s=to(r=t.type,t.pendingProps),xo(e,t,r,s=to(r.type,s),i);case 15:return Ao(e,t,t.type,t.pendingProps,i);case 17:return r=t.type,s=t.pendingProps,s=t.elementType===r?s:to(r,s),Ho(e,t),t.tag=1,Os(r)?(e=!0,Ls(t)):e=!1,Pn(t,i),no(t,r,s),oo(t,r,s,i),Mo(null,t,r,!0,e,i);case 19:return Go(e,t,i);case 22:return Co(e,t,i)}throw Error(n(156,t.tag))};var Kh="function"===typeof reportError?reportError:function(e){console.error(e)};function Yh(e){this._internalRoot=e}function jh(e){this._internalRoot=e}function Qh(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function $h(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Zh(){}function Jh(e,t,i,r,s){var n=i._reactRootContainer;if(n){var a=n;if("function"===typeof s){var o=s;s=function(){var e=Wh(a);o.call(e)}}Hh(t,a,e,s)}else a=function(e,t,i,r,s){if(s){if("function"===typeof r){var n=r;r=function(){var e=Wh(a);n.call(e)}}var a=Gh(t,r,e,0,null,!1,0,"",Zh);return e._reactRootContainer=a,e[_s]=a.current,zr(8===e.nodeType?e.parentNode:e),ch(),a}for(;s=e.lastChild;)e.removeChild(s);if("function"===typeof r){var o=r;r=function(){var e=Wh(l);o.call(e)}}var l=Vh(e,0,!1,null,0,!1,0,"",Zh);return e._reactRootContainer=l,e[_s]=l.current,zr(8===e.nodeType?e.parentNode:e),ch((function(){Hh(t,l,i,r)})),l}(i,t,e,s,r);return Wh(a)}jh.prototype.render=Yh.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(n(409));Hh(e,t,null,null)},jh.prototype.unmount=Yh.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;ch((function(){Hh(null,e,null,null)})),t[_s]=null}},jh.prototype.unstable_scheduleHydration=function(e){if(e){var t=Ct();e={blockedOn:null,target:e,priority:t};for(var i=0;i<wt.length&&0!==t&&t<wt[i].priority;i++);wt.splice(i,0,e),0===i&&Nt(e)}},Tt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var i=ut(t.pendingLanes);0!==i&&(bt(t,1|i),rh(t,$e()),0===(6&Ml)&&(Gl=$e()+500,zs()))}break;case 13:ch((function(){var t=Fn(e,1);if(null!==t){var i=eh();ih(t,e,1,i)}})),Xh(e,1)}},xt=function(e){if(13===e.tag){var t=Fn(e,134217728);if(null!==t)ih(t,e,134217728,eh());Xh(e,134217728)}},At=function(e){if(13===e.tag){var t=th(e),i=Fn(e,t);if(null!==i)ih(i,e,t,eh());Xh(e,t)}},Ct=function(){return vt},Rt=function(e,t){var i=vt;try{return vt=e,t()}finally{vt=i}},xe=function(e,t,i){switch(t){case"input":if(Z(e,i),t=i.name,"radio"===i.type&&null!=t){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<i.length;t++){var r=i[t];if(r!==e&&r.form===e.form){var s=ys(r);if(!s)throw Error(n(90));K(r),Z(r,s)}}}break;case"textarea":ne(e,i);break;case"select":null!=(t=i.value)&&ie(e,!!i.multiple,t,!1)}},Me=hh,Pe=ch;var ec={usingClientEntryPoint:!1,Events:[bs,vs,ys,Ee,Se,hh]},tc={findFiberByHostInstance:ms,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ic={bundleType:tc.bundleType,version:tc.version,rendererPackageName:tc.rendererPackageName,rendererConfig:tc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:y.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=qe(e))?null:e.stateNode},findFiberByHostInstance:tc.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var rc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!rc.isDisabled&&rc.supportsFiber)try{st=rc.inject(ic),nt=rc}catch(ce){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ec,t.createPortal=function(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Qh(t))throw Error(n(200));return function(e,t,i){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:x,key:null==r?null:""+r,children:e,containerInfo:t,implementation:i}}(e,t,null,i)},t.createRoot=function(e,t){if(!Qh(e))throw Error(n(299));var i=!1,r="",s=Kh;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(i=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(s=t.onRecoverableError)),t=Vh(e,1,!1,null,0,i,0,r,s),e[_s]=t.current,zr(8===e.nodeType?e.parentNode:e),new Yh(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(n(188));throw e=Object.keys(e).join(","),Error(n(268,e))}return e=null===(e=qe(t))?null:e.stateNode},t.flushSync=function(e){return ch(e)},t.hydrate=function(e,t,i){if(!$h(t))throw Error(n(200));return Jh(null,e,t,!0,i)},t.hydrateRoot=function(e,t,i){if(!Qh(e))throw Error(n(405));var r=null!=i&&i.hydratedSources||null,s=!1,a="",o=Kh;if(null!==i&&void 0!==i&&(!0===i.unstable_strictMode&&(s=!0),void 0!==i.identifierPrefix&&(a=i.identifierPrefix),void 0!==i.onRecoverableError&&(o=i.onRecoverableError)),t=Gh(t,null,e,1,null!=i?i:null,s,0,a,o),e[_s]=t.current,zr(e),r)for(e=0;e<r.length;e++)s=(s=(i=r[e])._getVersion)(i._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[i,s]:t.mutableSourceEagerHydrationData.push(i,s);return new jh(t)},t.render=function(e,t,i){if(!$h(t))throw Error(n(200));return Jh(null,e,t,!1,i)},t.unmountComponentAtNode=function(e){if(!$h(e))throw Error(n(40));return!!e._reactRootContainer&&(ch((function(){Jh(null,null,e,!1,(function(){e._reactRootContainer=null,e[_s]=null}))})),!0)},t.unstable_batchedUpdates=hh,t.unstable_renderSubtreeIntoContainer=function(e,t,i,r){if(!$h(i))throw Error(n(200));if(null==e||void 0===e._reactInternals)throw Error(n(38));return Jh(e,t,i,!1,r)},t.version="18.3.1-next-f1338f8080-20240426"},4391:(e,t,i)=>{"use strict";var r=i(7950);t.createRoot=r.createRoot,t.hydrateRoot=r.hydrateRoot},7950:(e,t,i)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=i(2730)},1153:(e,t,i)=>{"use strict";var r=i(5043),s=Symbol.for("react.element"),n=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,o=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function h(e,t,i){var r,n={},h=null,c=null;for(r in void 0!==i&&(h=""+i),void 0!==t.key&&(h=""+t.key),void 0!==t.ref&&(c=t.ref),t)a.call(t,r)&&!l.hasOwnProperty(r)&&(n[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===n[r]&&(n[r]=t[r]);return{$$typeof:s,type:e,key:h,ref:c,props:n,_owner:o.current}}t.jsx=h,t.jsxs=h},4202:(e,t)=>{"use strict";var i=Symbol.for("react.element"),r=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),l=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),_=Symbol.iterator;var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},f=Object.assign,g={};function m(e,t,i){this.props=e,this.context=t,this.refs=g,this.updater=i||p}function b(){}function v(e,t,i){this.props=e,this.context=t,this.refs=g,this.updater=i||p}m.prototype.isReactComponent={},m.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},m.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},b.prototype=m.prototype;var y=v.prototype=new b;y.constructor=v,f(y,m.prototype),y.isPureReactComponent=!0;var T=Array.isArray,x=Object.prototype.hasOwnProperty,A={current:null},C={key:!0,ref:!0,__self:!0,__source:!0};function R(e,t,r){var s,n={},a=null,o=null;if(null!=t)for(s in void 0!==t.ref&&(o=t.ref),void 0!==t.key&&(a=""+t.key),t)x.call(t,s)&&!C.hasOwnProperty(s)&&(n[s]=t[s]);var l=arguments.length-2;if(1===l)n.children=r;else if(1<l){for(var h=Array(l),c=0;c<l;c++)h[c]=arguments[c+2];n.children=h}if(e&&e.defaultProps)for(s in l=e.defaultProps)void 0===n[s]&&(n[s]=l[s]);return{$$typeof:i,type:e,key:a,ref:o,props:n,_owner:A.current}}function E(e){return"object"===typeof e&&null!==e&&e.$$typeof===i}var S=/\/+/g;function M(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function P(e,t,s,n,a){var o=typeof e;"undefined"!==o&&"boolean"!==o||(e=null);var l=!1;if(null===e)l=!0;else switch(o){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case i:case r:l=!0}}if(l)return a=a(l=e),e=""===n?"."+M(l,0):n,T(a)?(s="",null!=e&&(s=e.replace(S,"$&/")+"/"),P(a,t,s,"",(function(e){return e}))):null!=a&&(E(a)&&(a=function(e,t){return{$$typeof:i,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(a,s+(!a.key||l&&l.key===a.key?"":(""+a.key).replace(S,"$&/")+"/")+e)),t.push(a)),1;if(l=0,n=""===n?".":n+":",T(e))for(var h=0;h<e.length;h++){var c=n+M(o=e[h],h);l+=P(o,t,s,c,a)}else if(c=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=_&&e[_]||e["@@iterator"])?e:null}(e),"function"===typeof c)for(e=c.call(e),h=0;!(o=e.next()).done;)l+=P(o=o.value,t,s,c=n+M(o,h++),a);else if("object"===o)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function I(e,t,i){if(null==e)return e;var r=[],s=0;return P(e,r,"","",(function(e){return t.call(i,e,s++)})),r}function O(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var D={current:null},w={transition:null},F={ReactCurrentDispatcher:D,ReactCurrentBatchConfig:w,ReactCurrentOwner:A};function L(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:I,forEach:function(e,t,i){I(e,(function(){t.apply(this,arguments)}),i)},count:function(e){var t=0;return I(e,(function(){t++})),t},toArray:function(e){return I(e,(function(e){return e}))||[]},only:function(e){if(!E(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=m,t.Fragment=s,t.Profiler=a,t.PureComponent=v,t.StrictMode=n,t.Suspense=c,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=F,t.act=L,t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var s=f({},e.props),n=e.key,a=e.ref,o=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,o=A.current),void 0!==t.key&&(n=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(h in t)x.call(t,h)&&!C.hasOwnProperty(h)&&(s[h]=void 0===t[h]&&void 0!==l?l[h]:t[h])}var h=arguments.length-2;if(1===h)s.children=r;else if(1<h){l=Array(h);for(var c=0;c<h;c++)l[c]=arguments[c+2];s.children=l}return{$$typeof:i,type:e.type,key:n,ref:a,props:s,_owner:o}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:o,_context:e},e.Consumer=e},t.createElement=R,t.createFactory=function(e){var t=R.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:h,render:e}},t.isValidElement=E,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:O}},t.memo=function(e,t){return{$$typeof:u,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=w.transition;w.transition={};try{e()}finally{w.transition=t}},t.unstable_act=L,t.useCallback=function(e,t){return D.current.useCallback(e,t)},t.useContext=function(e){return D.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return D.current.useDeferredValue(e)},t.useEffect=function(e,t){return D.current.useEffect(e,t)},t.useId=function(){return D.current.useId()},t.useImperativeHandle=function(e,t,i){return D.current.useImperativeHandle(e,t,i)},t.useInsertionEffect=function(e,t){return D.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return D.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return D.current.useMemo(e,t)},t.useReducer=function(e,t,i){return D.current.useReducer(e,t,i)},t.useRef=function(e){return D.current.useRef(e)},t.useState=function(e){return D.current.useState(e)},t.useSyncExternalStore=function(e,t,i){return D.current.useSyncExternalStore(e,t,i)},t.useTransition=function(){return D.current.useTransition()},t.version="18.3.1"},5043:(e,t,i)=>{"use strict";e.exports=i(4202)},579:(e,t,i)=>{"use strict";e.exports=i(1153)},7234:(e,t)=>{"use strict";function i(e,t){var i=e.length;e.push(t);e:for(;0<i;){var r=i-1>>>1,s=e[r];if(!(0<n(s,t)))break e;e[r]=t,e[i]=s,i=r}}function r(e){return 0===e.length?null:e[0]}function s(e){if(0===e.length)return null;var t=e[0],i=e.pop();if(i!==t){e[0]=i;e:for(var r=0,s=e.length,a=s>>>1;r<a;){var o=2*(r+1)-1,l=e[o],h=o+1,c=e[h];if(0>n(l,i))h<s&&0>n(c,l)?(e[r]=c,e[h]=i,r=h):(e[r]=l,e[o]=i,r=o);else{if(!(h<s&&0>n(c,i)))break e;e[r]=c,e[h]=i,r=h}}}return t}function n(e,t){var i=e.sortIndex-t.sortIndex;return 0!==i?i:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var a=performance;t.unstable_now=function(){return a.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var h=[],c=[],u=1,d=null,_=3,p=!1,f=!1,g=!1,m="function"===typeof setTimeout?setTimeout:null,b="function"===typeof clearTimeout?clearTimeout:null,v="undefined"!==typeof setImmediate?setImmediate:null;function y(e){for(var t=r(c);null!==t;){if(null===t.callback)s(c);else{if(!(t.startTime<=e))break;s(c),t.sortIndex=t.expirationTime,i(h,t)}t=r(c)}}function T(e){if(g=!1,y(e),!f)if(null!==r(h))f=!0,w(x);else{var t=r(c);null!==t&&F(T,t.startTime-e)}}function x(e,i){f=!1,g&&(g=!1,b(E),E=-1),p=!0;var n=_;try{for(y(i),d=r(h);null!==d&&(!(d.expirationTime>i)||e&&!P());){var a=d.callback;if("function"===typeof a){d.callback=null,_=d.priorityLevel;var o=a(d.expirationTime<=i);i=t.unstable_now(),"function"===typeof o?d.callback=o:d===r(h)&&s(h),y(i)}else s(h);d=r(h)}if(null!==d)var l=!0;else{var u=r(c);null!==u&&F(T,u.startTime-i),l=!1}return l}finally{d=null,_=n,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var A,C=!1,R=null,E=-1,S=5,M=-1;function P(){return!(t.unstable_now()-M<S)}function I(){if(null!==R){var e=t.unstable_now();M=e;var i=!0;try{i=R(!0,e)}finally{i?A():(C=!1,R=null)}}else C=!1}if("function"===typeof v)A=function(){v(I)};else if("undefined"!==typeof MessageChannel){var O=new MessageChannel,D=O.port2;O.port1.onmessage=I,A=function(){D.postMessage(null)}}else A=function(){m(I,0)};function w(e){R=e,C||(C=!0,A())}function F(e,i){E=m((function(){e(t.unstable_now())}),i)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){f||p||(f=!0,w(x))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):S=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return _},t.unstable_getFirstCallbackNode=function(){return r(h)},t.unstable_next=function(e){switch(_){case 1:case 2:case 3:var t=3;break;default:t=_}var i=_;_=t;try{return e()}finally{_=i}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var i=_;_=e;try{return t()}finally{_=i}},t.unstable_scheduleCallback=function(e,s,n){var a=t.unstable_now();switch("object"===typeof n&&null!==n?n="number"===typeof(n=n.delay)&&0<n?a+n:a:n=a,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return e={id:u++,callback:s,priorityLevel:e,startTime:n,expirationTime:o=n+o,sortIndex:-1},n>a?(e.sortIndex=n,i(c,e),null===r(h)&&e===r(c)&&(g?(b(E),E=-1):g=!0,F(T,n-a))):(e.sortIndex=o,i(h,e),f||p||(f=!0,w(x))),e},t.unstable_shouldYield=P,t.unstable_wrapCallback=function(e){var t=_;return function(){var i=_;_=t;try{return e.apply(this,arguments)}finally{_=i}}}},8853:(e,t,i)=>{"use strict";e.exports=i(7234)},8139:(e,t)=>{var i;!function(){"use strict";var r={}.hasOwnProperty;function s(){for(var e="",t=0;t<arguments.length;t++){var i=arguments[t];i&&(e=a(e,n(i)))}return e}function n(e){if("string"===typeof e||"number"===typeof e)return e;if("object"!==typeof e)return"";if(Array.isArray(e))return s.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var t="";for(var i in e)r.call(e,i)&&e[i]&&(t=a(t,i));return t}function a(e,t){return t?e?e+" "+t:e+t:e}e.exports?(s.default=s,e.exports=s):void 0===(i=function(){return s}.apply(t,[]))||(e.exports=i)}()},1837:(e,t,i)=>{"use strict";i.d(t,{R:()=>a,h:()=>n});var r=i(3333),s=i(8274);class n{get isDisposed(){return this._isDisposed}constructor(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=arguments.length>7?arguments[7]:void 0,h=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,e&&e.getScene?this._engine=e.getScene().getEngine():this._engine=e,this._updatable=i,this._instanced=a,this._divisor=l||1,this._label=h,t instanceof r.n?(this._data=null,this._buffer=t):(this._data=t,this._buffer=null),this.byteStride=o?s:s*Float32Array.BYTES_PER_ELEMENT,n||this.create()}createVertexBuffer(e,t,i,r,s){let n=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6?arguments[6]:void 0;const l=n?t:t*Float32Array.BYTES_PER_ELEMENT,h=r?n?r:r*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new a(this._engine,this,e,this._updatable,!0,h,void 0===s?this._instanced:s,l,i,void 0,void 0,!0,this._divisor||o)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!e&&this._buffer||(e=e||this._data,e&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e),this._data=e):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(e,this._label),this._data=e):this._buffer=this._engine.createVertexBuffer(e,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.capacity>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.capacity,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.capacity,void 0,this._label));s.V.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(e){this.create(e)}updateDirectly(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e,r?t:t*Float32Array.BYTES_PER_ELEMENT,i?i*this.byteStride:void 0),this._data=0===t&&void 0===i?e:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class a{get isDisposed(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(e){const t=0!=e;this._instanceDivisor=e,t!==this._instanced&&(this._instanced=t,this._computeHashCode())}get _maxVerticesCount(){const e=this.getData();return e?Array.isArray(e)?e.length/(this.byteStride/4)-this.byteOffset/4:(e.byteLength-this.byteOffset)/this.byteStride:0}constructor(e,t,i,r,s,o,l,h,c,u){let d=arguments.length>10&&void 0!==arguments[10]&&arguments[10],_=arguments.length>11&&void 0!==arguments[11]&&arguments[11],p=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,f=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let g=!1;if(this.engine=e,"object"===typeof r&&null!==r?(g=r.updatable??!1,s=r.postponeInternalCreation,o=r.stride,l=r.instanced,h=r.offset,c=r.size,u=r.type,d=r.normalized??!1,_=r.useBytes??!1,p=r.divisor??1,f=r.takeBufferOwnership??!1,this._label=r.label):g=!!r,t instanceof n?(this._buffer=t,this._ownsBuffer=f):(this._buffer=new n(e,t,g,o,s,l,_,p,this._label),this._ownsBuffer=!0),this.uniqueId=a._Counter++,this._kind=i,void 0===u){const e=this.getData();this.type=e?a.GetDataType(e):a.FLOAT}else this.type=u;const m=a.GetTypeByteLength(this.type);_?(this._size=c||(o?o/m:a.DeduceStride(i)),this.byteStride=o||this._buffer.byteStride||this._size*m,this.byteOffset=h||0):(this._size=c||o||a.DeduceStride(i),this.byteStride=o?o*m:this._buffer.byteStride||this._size*m,this.byteOffset=(h||0)*m),this.normalized=d,this._instanced=void 0!==l&&l,this._instanceDivisor=l?p:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){this._buffer?._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(e,t){const i=this.getData();return i?a.GetFloatData(i,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,e,t):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/a.GetTypeByteLength(this.type)}getOffset(){return this.byteOffset/a.GetTypeByteLength(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*a.GetTypeByteLength(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(e){this._buffer.create(e),this._alignBuffer()}update(e){this._buffer.update(e),this._alignBuffer()}updateDirectly(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(e,t,void 0,i),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(e,t){a.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,e,this.normalized,t)}_alignBuffer(){}static DeduceStride(e){switch(e){case a.UVKind:case a.UV2Kind:case a.UV3Kind:case a.UV4Kind:case a.UV5Kind:case a.UV6Kind:return 2;case a.NormalKind:case a.PositionKind:return 3;case a.ColorKind:case a.ColorInstanceKind:case a.MatricesIndicesKind:case a.MatricesIndicesExtraKind:case a.MatricesWeightsKind:case a.MatricesWeightsExtraKind:case a.TangentKind:return 4;default:throw new Error("Invalid kind '"+e+"'")}}static GetDataType(e){return e instanceof Int8Array?a.BYTE:e instanceof Uint8Array?a.UNSIGNED_BYTE:e instanceof Int16Array?a.SHORT:e instanceof Uint16Array?a.UNSIGNED_SHORT:e instanceof Int32Array?a.INT:e instanceof Uint32Array?a.UNSIGNED_INT:a.FLOAT}static GetTypeByteLength(e){switch(e){case a.BYTE:case a.UNSIGNED_BYTE:return 1;case a.SHORT:case a.UNSIGNED_SHORT:return 2;case a.INT:case a.UNSIGNED_INT:case a.FLOAT:return 4;default:throw new Error(`Invalid type '${e}'`)}}static ForEach(e,t,i,r,s,n,o,l){if(e instanceof Array){let s=t/4;const a=i/4;for(let t=0;t<n;t+=r){for(let i=0;i<r;i++)l(e[s+i],t+i);s+=a}}else{const h=e instanceof ArrayBuffer?new DataView(e):new DataView(e.buffer,e.byteOffset,e.byteLength),c=a.GetTypeByteLength(s);for(let e=0;e<n;e+=r){let n=t;for(let t=0;t<r;t++){l(a._GetFloatValue(h,s,n,o),e+t),n+=c}t+=i}}}static _GetFloatValue(e,t,i,r){switch(t){case a.BYTE:{let t=e.getInt8(i);return r&&(t=Math.max(t/127,-1)),t}case a.UNSIGNED_BYTE:{let t=e.getUint8(i);return r&&(t/=255),t}case a.SHORT:{let t=e.getInt16(i,!0);return r&&(t=Math.max(t/32767,-1)),t}case a.UNSIGNED_SHORT:{let t=e.getUint16(i,!0);return r&&(t/=65535),t}case a.INT:return e.getInt32(i,!0);case a.UNSIGNED_INT:return e.getUint32(i,!0);case a.FLOAT:return e.getFloat32(i,!0);default:throw new Error(`Invalid component type ${t}`)}}static GetFloatData(e,t,i,r,n,o,l,h){const c=t*a.GetTypeByteLength(i),u=l*t;if(i!==a.FLOAT||n!==c){const s=new Float32Array(u);return a.ForEach(e,r,n,t,i,u,o,((e,t)=>s[t]=e)),s}if(!(e instanceof Array||e instanceof Float32Array)||0!==r||e.length!==u){if(e instanceof Array){const t=r/4;return e.slice(t,t+u)}if(e instanceof ArrayBuffer)return new Float32Array(e,r,u);{const t=e.byteOffset+r;if(0!==(3&t)&&(s.V.Warn("Float array must be aligned to 4-bytes border"),h=!0),h){const i=new Uint8Array(u*Float32Array.BYTES_PER_ELEMENT),r=new Uint8Array(e.buffer,t,i.length);return i.set(r),new Float32Array(i.buffer)}return new Float32Array(e.buffer,t,u)}}return h?e.slice():e}}a._Counter=0,a.BYTE=5120,a.UNSIGNED_BYTE=5121,a.SHORT=5122,a.UNSIGNED_SHORT=5123,a.INT=5124,a.UNSIGNED_INT=5125,a.FLOAT=5126,a.PositionKind="position",a.NormalKind="normal",a.TangentKind="tangent",a.UVKind="uv",a.UV2Kind="uv2",a.UV3Kind="uv3",a.UV4Kind="uv4",a.UV5Kind="uv5",a.UV6Kind="uv6",a.ColorKind="color",a.ColorInstanceKind="instanceColor",a.MatricesIndicesKind="matricesIndices",a.MatricesWeightsKind="matricesWeights",a.MatricesIndicesExtraKind="matricesIndicesExtra",a.MatricesWeightsExtraKind="matricesWeightsExtra"},3333:(e,t,i)=>{"use strict";i.d(t,{n:()=>r});class r{get underlyingResource(){return null}constructor(){this.references=0,this.capacity=0,this.is32Bits=!1,this.uniqueId=r._Counter++}}r._Counter=0},9770:(e,t,i)=>{"use strict";i.d(t,{G:()=>n});var r=i(5968),s=i(1837);class n{constructor(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.ray=null,this.originMesh=null,this.aimTransform=null,this.gripTransform=null}getNormal(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.pickedMesh||t&&!this.pickedMesh.isVerticesDataPresent(s.R.NormalKind))return null;let i,n=this.pickedMesh.getIndices();0===n?.length&&(n=null);const a=r.AA.Vector3[0],o=r.AA.Vector3[1],l=r.AA.Vector3[2];if(t){const e=this.pickedMesh.getVerticesData(s.R.NormalKind);let t=n?r.Pq.FromArrayToRef(e,3*n[3*this.faceId],a):a.copyFromFloats(e[3*this.faceId*3],e[3*this.faceId*3+1],e[3*this.faceId*3+2]),h=n?r.Pq.FromArrayToRef(e,3*n[3*this.faceId+1],o):o.copyFromFloats(e[3*(3*this.faceId+1)],e[3*(3*this.faceId+1)+1],e[3*(3*this.faceId+1)+2]),c=n?r.Pq.FromArrayToRef(e,3*n[3*this.faceId+2],l):l.copyFromFloats(e[3*(3*this.faceId+2)],e[3*(3*this.faceId+2)+1],e[3*(3*this.faceId+2)+2]);t=t.scale(this.bu),h=h.scale(this.bv),c=c.scale(1-this.bu-this.bv),i=new r.Pq(t.x+h.x+c.x,t.y+h.y+c.y,t.z+h.z+c.z)}else{const e=this.pickedMesh.getVerticesData(s.R.PositionKind),t=n?r.Pq.FromArrayToRef(e,3*n[3*this.faceId],a):a.copyFromFloats(e[3*this.faceId*3],e[3*this.faceId*3+1],e[3*this.faceId*3+2]),h=n?r.Pq.FromArrayToRef(e,3*n[3*this.faceId+1],o):o.copyFromFloats(e[3*(3*this.faceId+1)],e[3*(3*this.faceId+1)+1],e[3*(3*this.faceId+1)+2]),c=n?r.Pq.FromArrayToRef(e,3*n[3*this.faceId+2],l):l.copyFromFloats(e[3*(3*this.faceId+2)],e[3*(3*this.faceId+2)+1],e[3*(3*this.faceId+2)+2]),u=t.subtract(h),d=c.subtract(h);i=r.Pq.Cross(u,d)}const h=(e,t)=>{let i=e.getWorldMatrix();e.nonUniformScaling&&(r.AA.Matrix[0].copyFrom(i),i=r.AA.Matrix[0],i.setTranslationFromFloats(0,0,0),i.invert(),i.transposeToRef(r.AA.Matrix[1]),i=r.AA.Matrix[1]),r.Pq.TransformNormalToRef(t,i,t)};if(e&&h(this.pickedMesh,i),this.ray){const t=r.AA.Vector3[0].copyFrom(i);e||h(this.pickedMesh,t),r.Pq.Dot(t,this.ray.direction)>0&&i.negateInPlace()}return i.normalize(),i}getTextureCoordinates(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s.R.UVKind;if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(e))return null;const t=this.pickedMesh.getIndices();if(!t)return null;const i=this.pickedMesh.getVerticesData(e);if(!i)return null;let n=r.I9.FromArray(i,2*t[3*this.faceId]),a=r.I9.FromArray(i,2*t[3*this.faceId+1]),o=r.I9.FromArray(i,2*t[3*this.faceId+2]);return n=n.scale(this.bu),a=a.scale(this.bv),o=o.scale(1-this.bu-this.bv),new r.I9(n.x+a.x+o.x,n.y+a.y+o.y)}}},8458:(e,t,i)=>{"use strict";i.d(t,{rX:()=>r});let r=!1},9776:(e,t,i)=>{"use strict";var r=i(8665),s=i(8274),n=i(242),a=i(7999),o=i(8846),l=i(3961);o.$.prototype._partialLoadFile=function(e,t,i,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(e,(e=>{i[t]=e,i._internalCount++,6===i._internalCount&&r(i)}),void 0,void 0,!0,((e,t)=>{s&&e&&s(e.status+" "+e.statusText,t)}))},o.$.prototype._cascadeLoadFiles=function(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const s=[];s._internalCount=0;for(let n=0;n<6;n++)this._partialLoadFile(i[n],n,s,t,r)},o.$.prototype._cascadeLoadImgs=function(e,t,i,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5?arguments[5]:void 0;const a=[];a._internalCount=0;for(let o=0;o<6;o++)this._partialLoadImg(r[o],o,a,e,t,i,s,n)},o.$.prototype._partialLoadImg=function(e,t,i,r,s,o){let l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,h=arguments.length>7?arguments[7]:void 0;const c=(0,a.z)();(0,n.W$)(e,(e=>{i[t]=e,i._internalCount++,r&&r.removePendingData(c),6===i._internalCount&&o&&o(s,i)}),((e,t)=>{r&&r.removePendingData(c),l&&l(e,t)}),r?r.offlineProvider:null,h),r&&r.addPendingData(c)},o.$.prototype.createCubeTextureBase=function(e,t,i,n){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,h=arguments.length>6?arguments[6]:void 0,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,u=arguments.length>8&&void 0!==arguments[8]&&arguments[8],d=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,_=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,p=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,f=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,g=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,m=arguments.length>14&&void 0!==arguments[14]&&arguments[14],b=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const v=p||new r.h(this,7);v.isCube=!0,v.url=e,v.generateMipMaps=!n,v._lodGenerationScale=d,v._lodGenerationOffset=_,v._useSRGBBuffer=!!m&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!n),v!==p&&(v.label=e.substring(0,60)),this._doNotHandleContextLost||(v._extension=c,v._files=i,v._buffer=b);const y=e;this._transformTextureUrl&&!p&&(e=this._transformTextureUrl(e));const T=e.split("?")[0],x=T.lastIndexOf("."),A=c||(x>-1?T.substring(x).toLowerCase():""),C=(0,l.g)(A),R=(r,l)=>{e===y?o&&r&&o(r.status+" "+r.statusText,l):(s.V.Warn(`Failed to load ${e}, falling back to the ${y}`),this.createCubeTextureBase(y,t,i,!!n,a,o,h,c,u,d,_,v,f,g,m,b))};if(C)C.then((r=>{const n=e=>{f&&f(v,e),r.loadCubeData(e,v,u,a,o)};b?n(b):i&&6===i.length?r.supportCascades?this._cascadeLoadFiles(t,(e=>n(e.map((e=>new Uint8Array(e))))),i,o):o?o("Textures type does not support cascades."):s.V.Warn("Texture loader does not support cascades."):this._loadFile(e,(e=>n(new Uint8Array(e))),void 0,void 0,!0,R)}));else{if(!i||0===i.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(t,v,((e,t)=>{g&&g(e,t)}),i,o)}return this._internalTexturesCache.push(v),v}},5627:(e,t,i)=>{"use strict";i(8846).$.prototype.createDepthStencilTexture=function(e,t,i){if(t.isCube){const i=e.width||e;return this._createDepthStencilCubeTexture(i,t)}return this._createDepthStencilTexture(e,t,i)}},6952:(e,t,i)=>{"use strict";var r=i(5887),s=i(8665),n=i(8274),a=i(4780);r.w.prototype._createDepthStencilCubeTexture=function(e,t){const i=new s.h(this,12);if(i.isCube=!0,1===this.webGLVersion)return n.V.Error("Depth cube texture is not supported by WebGL 1."),i;const r={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...t},a=this._gl;this._bindTextureDirectly(a.TEXTURE_CUBE_MAP,i,!0),this._setupDepthStencilTexture(i,e,r.bilinearFiltering,r.comparisonFunction);for(let s=0;s<6;s++)r.generateStencil?a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,a.DEPTH24_STENCIL8,e,e,0,a.DEPTH_STENCIL,a.UNSIGNED_INT_24_8,null):a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,a.DEPTH_COMPONENT24,e,e,0,a.DEPTH_COMPONENT,a.UNSIGNED_INT,null);return this._bindTextureDirectly(a.TEXTURE_CUBE_MAP,null),this._internalTexturesCache.push(i),i},r.w.prototype._setCubeMapTextureParams=function(e,t,i){const r=this._gl;r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MIN_FILTER,t?r.LINEAR_MIPMAP_LINEAR:r.LINEAR),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),e.samplingMode=t?3:2,t&&this.getCaps().textureMaxLevel&&void 0!==i&&i>0&&(r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MAX_LEVEL,i),e._maxLodLevel=i),this._bindTextureDirectly(r.TEXTURE_CUBE_MAP,null)},r.w.prototype.createCubeTexture=function(e,t,i,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6?arguments[6]:void 0,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,c=arguments.length>8&&void 0!==arguments[8]&&arguments[8],u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,d=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,_=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,p=arguments.length>13&&void 0!==arguments[13]&&arguments[13],f=arguments.length>14&&void 0!==arguments[14]?arguments[14]:null;const g=this._gl;return this.createCubeTextureBase(e,t,i,!!r,s,o,l,h,c,u,d,_,(e=>this._bindTextureDirectly(g.TEXTURE_CUBE_MAP,e,!0)),((e,t)=>{const i=this.needPOTTextures?(0,a.R)(t[0].width,this._caps.maxCubemapTextureSize):t[0].width,o=i,h=[g.TEXTURE_CUBE_MAP_POSITIVE_X,g.TEXTURE_CUBE_MAP_POSITIVE_Y,g.TEXTURE_CUBE_MAP_POSITIVE_Z,g.TEXTURE_CUBE_MAP_NEGATIVE_X,g.TEXTURE_CUBE_MAP_NEGATIVE_Y,g.TEXTURE_CUBE_MAP_NEGATIVE_Z];this._bindTextureDirectly(g.TEXTURE_CUBE_MAP,e,!0),this._unpackFlipY(!1);const c=l?this._getInternalFormat(l,e._useSRGBBuffer):e._useSRGBBuffer?this._glSRGBExtensionValues.SRGB8_ALPHA8:g.RGBA;let u=l?this._getInternalFormat(l):g.RGBA;e._useSRGBBuffer&&1===this.webGLVersion&&(u=c);for(let r=0;r<h.length;r++)if(t[r].width!==i||t[r].height!==o){if(this._prepareWorkingCanvas(),!this._workingCanvas||!this._workingContext)return void n.V.Warn("Cannot create canvas to resize texture.");this._workingCanvas.width=i,this._workingCanvas.height=o,this._workingContext.drawImage(t[r],0,0,t[r].width,t[r].height,0,0,i,o),g.texImage2D(h[r],0,c,u,g.UNSIGNED_BYTE,this._workingCanvas)}else g.texImage2D(h[r],0,c,u,g.UNSIGNED_BYTE,t[r]);r||g.generateMipmap(g.TEXTURE_CUBE_MAP),this._setCubeMapTextureParams(e,!r),e.width=i,e.height=o,e.isReady=!0,l&&(e.format=l),e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear(),s&&s()}),!!p,f)},r.w.prototype.generateMipMapsForCubemap=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.generateMipMaps){const i=this._gl;this._bindTextureDirectly(i.TEXTURE_CUBE_MAP,e,!0),i.generateMipmap(i.TEXTURE_CUBE_MAP),t&&this._bindTextureDirectly(i.TEXTURE_CUBE_MAP,null)}}},6371:(e,t,i)=>{"use strict";var r=i(5887);r.w.prototype._readTexturePixelsSync=function(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],o=arguments.length>7&&void 0!==arguments[7]&&arguments[7],l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const c=this._gl;if(!c)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){const e=c.createFramebuffer();if(!e)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=e}c.bindFramebuffer(c.FRAMEBUFFER,this._dummyFramebuffer),r>-1?c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_CUBE_MAP_POSITIVE_X+r,e._hardwareTexture?.underlyingResource,s):c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,e._hardwareTexture?.underlyingResource,s);let u=void 0!==e.type?this._getWebGLTextureType(e.type):c.UNSIGNED_BYTE;if(o)n||(n=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0;switch(e){case 3:{const e=(ArrayBuffer,new Int8Array(t));return r&&e.set(new Int8Array(r)),e}case 0:{const e=(ArrayBuffer,new Uint8Array(t));return r&&e.set(new Uint8Array(r)),e}case 4:{const e=t instanceof ArrayBuffer?new Int16Array(t):new Int16Array(i?t/2:t);return r&&e.set(new Int16Array(r)),e}case 5:case 8:case 9:case 10:case 2:{const e=t instanceof ArrayBuffer?new Uint16Array(t):new Uint16Array(i?t/2:t);return r&&e.set(new Uint16Array(r)),e}case 6:{const e=t instanceof ArrayBuffer?new Int32Array(t):new Int32Array(i?t/4:t);return r&&e.set(new Int32Array(r)),e}case 7:case 11:case 12:case 13:case 14:case 15:{const e=t instanceof ArrayBuffer?new Uint32Array(t):new Uint32Array(i?t/4:t);return r&&e.set(new Uint32Array(r)),e}case 1:{const e=t instanceof ArrayBuffer?new Float32Array(t):new Float32Array(i?t/4:t);return r&&e.set(new Float32Array(r)),e}}const s=(ArrayBuffer,new Uint8Array(t));return r&&s.set(new Uint8Array(r)),s}(e.type,4*t*i));else if(u===c.UNSIGNED_BYTE)n||(n=new Uint8Array(4*t*i)),u=c.UNSIGNED_BYTE;else n||(n=new Float32Array(4*t*i)),u=c.FLOAT;return a&&this.flushFramebuffer(),c.readPixels(l,h,t,i,c.RGBA,u,n),c.bindFramebuffer(c.FRAMEBUFFER,this._currentFramebuffer),n},r.w.prototype._readTexturePixels=function(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],o=arguments.length>7&&void 0!==arguments[7]&&arguments[7],l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;return Promise.resolve(this._readTexturePixelsSync(e,t,i,r,s,n,a,o,l,h))}},9289:(e,t,i)=>{"use strict";var r=i(8665),s=i(8274),n=i(5887);class a{get depthStencilTexture(){return this._depthStencilTexture}get depthStencilTextureWithStencil(){return this._depthStencilTextureWithStencil}get isCube(){return this._isCube}get isMulti(){return this._isMulti}get is2DArray(){return this.layers>0}get is3D(){return this.depth>0}get size(){return this.width}get width(){return this._size.width||this._size}get height(){return this._size.height||this._size}get layers(){return this._size.layers||0}get depth(){return this._size.depth||0}get texture(){return this._textures?.[0]??null}get textures(){return this._textures}get faceIndices(){return this._faceIndices}get layerIndices(){return this._layerIndices}get samples(){return this._samples}setSamples(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.samples===e&&!i)return e;const r=this._isMulti?this._engine.updateMultipleRenderTargetTextureSampleCount(this,e,t):this._engine.updateRenderTargetTextureSampleCount(this,e);return this._samples=e,r}constructor(e,t,i,r,s){this._textures=null,this._faceIndices=null,this._layerIndices=null,this._samples=1,this._attachments=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._depthStencilTextureWithStencil=!1,this._isMulti=e,this._isCube=t,this._size=i,this._engine=r,this._depthStencilTexture=null,this.label=s}setTextures(e){Array.isArray(e)?this._textures=e:this._textures=e?[e]:null}setTexture(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._textures||(this._textures=[]),this._textures[t]!==e&&(this._textures[t]&&i&&this._textures[t].dispose(),this._textures[t]=e)}setLayerAndFaceIndices(e,t){this._layerIndices=e,this._faceIndices=t}setLayerAndFaceIndex(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;this._layerIndices||(this._layerIndices=[]),this._faceIndices||(this._faceIndices=[]),void 0!==t&&t>=0&&(this._layerIndices[e]=t),void 0!==i&&i>=0&&(this._faceIndices[e]=i)}createDepthStencilTexture(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,n=arguments.length>5?arguments[5]:void 0;return this._depthStencilTexture?.dispose(),this._depthStencilTextureWithStencil=i,this._depthStencilTextureLabel=n,this._depthStencilTexture=this._engine.createDepthStencilTexture(this._size,{bilinearFiltering:t,comparisonFunction:e,generateStencil:i,isCube:this._isCube,samples:r,depthTextureFormat:s,label:n},this),this._depthStencilTexture}_shareDepth(e){this.shareDepth(e)}shareDepth(e){this._depthStencilTexture&&(e._depthStencilTexture&&e._depthStencilTexture.dispose(),e._depthStencilTexture=this._depthStencilTexture,e._depthStencilTextureWithStencil=this._depthStencilTextureWithStencil,this._depthStencilTexture.incrementReferences())}_swapAndDie(e){this.texture&&this.texture._swapAndDie(e),this._textures=null,this.dispose(!0)}_cloneRenderTargetWrapper(){let e=null;if(this._isMulti){const t=this.textures;if(t&&t.length>0){let i=!1,r=t.length,s=-1;const n=t[t.length-1]._source;14!==n&&12!==n||(i=!0,s=t[t.length-1].format,r--);const a=[],o=[],l=[],h=[],c=[],u=[],d=[],_={};for(let e=0;e<r;++e){const i=t[e];a.push(i.samplingMode),o.push(i.type),l.push(i.format);void 0!==_[i.uniqueId]?(h.push(-1),d.push(0)):(_[i.uniqueId]=e,i.is2DArray?(h.push(35866),d.push(i.depth)):i.isCube?(h.push(34067),d.push(0)):i.is3D?(h.push(32879),d.push(i.depth)):(h.push(3553),d.push(0))),this._faceIndices&&c.push(this._faceIndices[e]??0),this._layerIndices&&u.push(this._layerIndices[e]??0)}const p={samplingModes:a,generateMipMaps:t[0].generateMipMaps,generateDepthBuffer:this._generateDepthBuffer,generateStencilBuffer:this._generateStencilBuffer,generateDepthTexture:i,depthTextureFormat:s,types:o,formats:l,textureCount:r,targetTypes:h,faceIndex:c,layerIndex:u,layerCounts:d,label:this.label},f={width:this.width,height:this.height,depth:this.depth};e=this._engine.createMultipleRenderTarget(f,p);for(let g=0;g<r;++g){if(-1!==h[g])continue;const i=_[t[g].uniqueId];e.setTexture(e.textures[i],g)}}}else{const t={};if(t.generateDepthBuffer=this._generateDepthBuffer,t.generateMipMaps=this.texture?.generateMipMaps??!1,t.generateStencilBuffer=this._generateStencilBuffer,t.samplingMode=this.texture?.samplingMode,t.type=this.texture?.type,t.format=this.texture?.format,t.noColorAttachment=!this._textures,t.label=this.label,this.isCube)e=this._engine.createRenderTargetCubeTexture(this.width,t);else{const i={width:this.width,height:this.height,layers:this.is2DArray||this.is3D?this.texture?.depth:void 0};e=this._engine.createRenderTargetTexture(i,t)}e.texture&&(e.texture.isReady=!0)}return e}_swapRenderTargetWrapper(e){if(this._textures&&e._textures)for(let t=0;t<this._textures.length;++t)this._textures[t]._swapAndDie(e._textures[t],!1),e._textures[t].isReady=!0;this._depthStencilTexture&&e._depthStencilTexture&&(this._depthStencilTexture._swapAndDie(e._depthStencilTexture),e._depthStencilTexture.isReady=!0),this._textures=null,this._depthStencilTexture=null}_rebuild(){const e=this._cloneRenderTargetWrapper();if(e){if(this._depthStencilTexture){const t=this._depthStencilTexture.samplingMode,i=this._depthStencilTexture.format,r=2===t||3===t||11===t;e.createDepthStencilTexture(this._depthStencilTexture._comparisonFunction,r,this._depthStencilTextureWithStencil,this._depthStencilTexture.samples,i,this._depthStencilTextureLabel)}this.samples>1&&e.setSamples(this.samples),e._swapRenderTargetWrapper(this),e.dispose()}}releaseTextures(){if(this._textures)for(let e=0;e<this._textures?.length;++e)this._textures[e].dispose();this._textures=null}dispose(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]||(this._depthStencilTexture?.dispose(),this._depthStencilTexture=null,this.releaseTextures()),this._engine._releaseRenderTargetWrapper(this)}}class o extends a{constructor(e,t,i,r,s){super(e,t,i,r),this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._disposeOnlyFramebuffers=!1,this._currentLOD=0,this._context=s}_cloneRenderTargetWrapper(){let e=null;return this._colorTextureArray&&this._depthStencilTextureArray?(e=this._engine.createMultiviewRenderTargetTexture(this.width,this.height),e.texture.isReady=!0):e=super._cloneRenderTargetWrapper(),e}_swapRenderTargetWrapper(e){super._swapRenderTargetWrapper(e),e._framebuffer=this._framebuffer,e._depthStencilBuffer=this._depthStencilBuffer,e._MSAAFramebuffer=this._MSAAFramebuffer,e._colorTextureArray=this._colorTextureArray,e._depthStencilTextureArray=this._depthStencilTextureArray,this._framebuffer=this._depthStencilBuffer=this._MSAAFramebuffer=this._colorTextureArray=this._depthStencilTextureArray=null}createDepthStencilTexture(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,n=arguments.length>5?arguments[5]:void 0;if(this._depthStencilBuffer){const e=this._engine,t=e._currentFramebuffer,i=this._context;e._bindUnboundFramebuffer(this._framebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,null),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,null),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.STENCIL_ATTACHMENT,i.RENDERBUFFER,null),e._bindUnboundFramebuffer(t),i.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null}return super.createDepthStencilTexture(e,t,i,r,s,n)}shareDepth(e){super.shareDepth(e);const t=this._context,i=this._depthStencilBuffer,r=e._MSAAFramebuffer||e._framebuffer,s=this._engine;e._depthStencilBuffer&&e._depthStencilBuffer!==i&&t.deleteRenderbuffer(e._depthStencilBuffer),e._depthStencilBuffer=i;const n=e._generateStencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;s._bindUnboundFramebuffer(r),t.framebufferRenderbuffer(t.FRAMEBUFFER,n,t.RENDERBUFFER,i),s._bindUnboundFramebuffer(null)}_bindTextureRenderTarget(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!e._hardwareTexture)return;const s=this._framebuffer,n=this._engine,a=n._currentFramebuffer;if(n._bindUnboundFramebuffer(s),n.webGLVersion>1){const s=this._context,n=s["COLOR_ATTACHMENT"+t];e.is2DArray||e.is3D?(i=i??this.layerIndices?.[t]??0,s.framebufferTextureLayer(s.FRAMEBUFFER,n,e._hardwareTexture.underlyingResource,r,i)):e.isCube?(i=i??this.faceIndices?.[t]??0,s.framebufferTexture2D(s.FRAMEBUFFER,n,s.TEXTURE_CUBE_MAP_POSITIVE_X+i,e._hardwareTexture.underlyingResource,r)):s.framebufferTexture2D(s.FRAMEBUFFER,n,s.TEXTURE_2D,e._hardwareTexture.underlyingResource,r)}else{const s=this._context,n=s["COLOR_ATTACHMENT"+t+"_WEBGL"],a=void 0!==i?s.TEXTURE_CUBE_MAP_POSITIVE_X+i:s.TEXTURE_2D;s.framebufferTexture2D(s.FRAMEBUFFER,n,a,e._hardwareTexture.underlyingResource,r)}n._bindUnboundFramebuffer(a)}setTexture(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super.setTexture(e,t,i),this._bindTextureRenderTarget(e,t)}setLayerAndFaceIndices(e,t){if(super.setLayerAndFaceIndices(e,t),!this.textures||!this.layerIndices||!this.faceIndices)return;const i=this._attachments?.length??this.textures.length;for(let r=0;r<i;r++){const e=this.textures[r];e&&(e.is2DArray||e.is3D?this._bindTextureRenderTarget(e,r,this.layerIndices[r]):e.isCube?this._bindTextureRenderTarget(e,r,this.faceIndices[r]):this._bindTextureRenderTarget(e,r))}}setLayerAndFaceIndex(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;if(super.setLayerAndFaceIndex(e,t,i),!this.textures||!this.layerIndices||!this.faceIndices)return;const r=this.textures[e];r.is2DArray||r.is3D?this._bindTextureRenderTarget(this.textures[e],e,this.layerIndices[e]):r.isCube&&this._bindTextureRenderTarget(this.textures[e],e,this.faceIndices[e])}dispose(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._disposeOnlyFramebuffers;const t=this._context;e||(this._colorTextureArray&&(this._context.deleteTexture(this._colorTextureArray),this._colorTextureArray=null),this._depthStencilTextureArray&&(this._context.deleteTexture(this._depthStencilTextureArray),this._depthStencilTextureArray=null)),this._framebuffer&&(t.deleteFramebuffer(this._framebuffer),this._framebuffer=null),this._depthStencilBuffer&&(t.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null),this._MSAAFramebuffer&&(t.deleteFramebuffer(this._MSAAFramebuffer),this._MSAAFramebuffer=null),super.dispose(e)}}i(5627);n.w.prototype._createHardwareRenderTargetWrapper=function(e,t,i){const r=new o(e,t,i,this,this._gl);return this._renderTargetWrapperCache.push(r),r},n.w.prototype.createRenderTargetTexture=function(e,t){const i=this._createHardwareRenderTargetWrapper(!1,!1,e);let r,s,n=!0,a=!1,o=!1,l=1;void 0!==t&&"object"===typeof t&&(n=t.generateDepthBuffer??!0,a=!!t.generateStencilBuffer,o=!!t.noColorAttachment,r=t.colorAttachment,l=t.samples??1,s=t.label);const h=r||(o?null:this._createInternalTexture(e,t,!0,5)),c=e.width||e,u=e.height||e,d=this._currentFramebuffer,_=this._gl,p=_.createFramebuffer();return this._bindUnboundFramebuffer(p),i._depthStencilBuffer=this._setupFramebufferDepthAttachments(a,n,c,u),!h||h.is2DArray||h.is3D||_.framebufferTexture2D(_.FRAMEBUFFER,_.COLOR_ATTACHMENT0,_.TEXTURE_2D,h._hardwareTexture.underlyingResource,0),this._bindUnboundFramebuffer(d),i.label=s??"RenderTargetWrapper",i._framebuffer=p,i._generateDepthBuffer=n,i._generateStencilBuffer=a,i.setTextures(h),this.updateRenderTargetTextureSampleCount(i,l),i},n.w.prototype._createDepthStencilTexture=function(e,t,i){const n=this._gl,a=e.layers||0,o=e.depth||0;let l=n.TEXTURE_2D;0!==a?l=n.TEXTURE_2D_ARRAY:0!==o&&(l=n.TEXTURE_3D);const h=new r.h(this,12);if(h.label=t.label,!this._caps.depthTextureExtension)return s.V.Error("Depth texture is not supported by your browser or hardware."),h;const c={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...t};if(this._bindTextureDirectly(l,h,!0),this._setupDepthStencilTexture(h,e,0!==c.comparisonFunction&&c.bilinearFiltering,c.comparisonFunction,c.samples),void 0!==c.depthTextureFormat){if(15!==c.depthTextureFormat&&16!==c.depthTextureFormat&&17!==c.depthTextureFormat&&13!==c.depthTextureFormat&&14!==c.depthTextureFormat&&18!==c.depthTextureFormat)return s.V.Error(`Depth texture ${c.depthTextureFormat} format is not supported.`),h;h.format=c.depthTextureFormat}else h.format=c.generateStencil?13:16;const u=17===h.format||13===h.format||18===h.format;let d=n.UNSIGNED_INT;15===h.format?d=n.UNSIGNED_SHORT:17===h.format||13===h.format?d=n.UNSIGNED_INT_24_8:14===h.format?d=n.FLOAT:18===h.format&&(d=n.FLOAT_32_UNSIGNED_INT_24_8_REV);const _=u?n.DEPTH_STENCIL:n.DEPTH_COMPONENT,p=this._getInternalFormatFromDepthTextureFormat(h.format,!0,u);return h.is2DArray?n.texImage3D(l,0,p,h.width,h.height,a,0,_,d,null):h.is3D?n.texImage3D(l,0,p,h.width,h.height,o,0,_,d,null):n.texImage2D(l,0,p,h.width,h.height,0,_,d,null),this._bindTextureDirectly(l,null),this._internalTexturesCache.push(h),i._depthStencilBuffer&&(n.deleteRenderbuffer(i._depthStencilBuffer),i._depthStencilBuffer=null),this._bindUnboundFramebuffer(i._MSAAFramebuffer??i._framebuffer),i._generateStencilBuffer=u,i._depthStencilTextureWithStencil=u,i._depthStencilBuffer=this._setupFramebufferDepthAttachments(i._generateStencilBuffer,i._generateDepthBuffer,i.width,i.height,i.samples,h.format),this._bindUnboundFramebuffer(null),h},n.w.prototype.updateRenderTargetTextureSampleCount=function(e,t){if(this.webGLVersion<2||!e)return 1;if(e.samples===t)return t;const i=this._gl;t=Math.min(t,this.getCaps().maxMSAASamples),e._depthStencilBuffer&&(i.deleteRenderbuffer(e._depthStencilBuffer),e._depthStencilBuffer=null),e._MSAAFramebuffer&&(i.deleteFramebuffer(e._MSAAFramebuffer),e._MSAAFramebuffer=null);const r=e.texture?._hardwareTexture;r?.releaseMSAARenderBuffers();const s=i.createFramebuffer();if(!s)throw new Error("Unable to create multi sampled framebuffer");if(e._MSAAFramebuffer=s,e.texture&&t>1&&"function"===typeof i.renderbufferStorageMultisample){this._bindUnboundFramebuffer(e._MSAAFramebuffer);const s=this._createRenderBuffer(e.texture.width,e.texture.height,t,-1,this._getRGBABufferInternalSizedFormat(e.texture.type,e.texture.format,e.texture._useSRGBBuffer),i.COLOR_ATTACHMENT0,!1);if(!s)throw new Error("Unable to create multi sampled framebuffer");r?.addMSAARenderBuffer(s)}this._bindUnboundFramebuffer(e._MSAAFramebuffer??e._framebuffer),e.texture&&(e.texture.samples=t),e._samples=t;const n=e._depthStencilTexture?e._depthStencilTexture.format:void 0;return e._depthStencilBuffer=this._setupFramebufferDepthAttachments(e._generateStencilBuffer,e._generateDepthBuffer,e.width,e.height,t,n),this._bindUnboundFramebuffer(null),t},n.w.prototype._setupDepthStencilTexture=function(e,t,i,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const n=t.width||t,a=t.height||t,o=t.layers||0,l=t.depth||0;e.baseWidth=n,e.baseHeight=a,e.width=n,e.height=a,e.is2DArray=o>0,e.depth=o||l,e.isReady=!0,e.samples=s,e.generateMipMaps=!1,e.samplingMode=i?2:1,e.type=0,e._comparisonFunction=r;const h=this._gl,c=this._getTextureTarget(e),u=this._getSamplingParameters(e.samplingMode,!1);h.texParameteri(c,h.TEXTURE_MAG_FILTER,u.mag),h.texParameteri(c,h.TEXTURE_MIN_FILTER,u.min),h.texParameteri(c,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(c,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),this.webGLVersion>1&&(0===r?(h.texParameteri(c,h.TEXTURE_COMPARE_FUNC,515),h.texParameteri(c,h.TEXTURE_COMPARE_MODE,h.NONE)):(h.texParameteri(c,h.TEXTURE_COMPARE_FUNC,r),h.texParameteri(c,h.TEXTURE_COMPARE_MODE,h.COMPARE_REF_TO_TEXTURE)))}},9422:(e,t,i)=>{"use strict";var r=i(8665),s=i(8274);i(5887).w.prototype.createRenderTargetCubeTexture=function(e,t){const i=this._createHardwareRenderTargetWrapper(!1,!0,e),n={generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5,...t};n.generateStencilBuffer=n.generateDepthBuffer&&n.generateStencilBuffer,(1!==n.type||this._caps.textureFloatLinearFiltering)&&(2!==n.type||this._caps.textureHalfFloatLinearFiltering)||(n.samplingMode=1);const a=this._gl,o=new r.h(this,5);this._bindTextureDirectly(a.TEXTURE_CUBE_MAP,o,!0);const l=this._getSamplingParameters(n.samplingMode,n.generateMipMaps);1!==n.type||this._caps.textureFloat||(n.type=0,s.V.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MAG_FILTER,l.mag),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MIN_FILTER,l.min),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);for(let r=0;r<6;r++)a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,this._getRGBABufferInternalSizedFormat(n.type,n.format),e,e,0,this._getInternalFormat(n.format),this._getWebGLTextureType(n.type),null);const h=a.createFramebuffer();return this._bindUnboundFramebuffer(h),i._depthStencilBuffer=this._setupFramebufferDepthAttachments(n.generateStencilBuffer,n.generateDepthBuffer,e,e),n.generateMipMaps&&a.generateMipmap(a.TEXTURE_CUBE_MAP),this._bindTextureDirectly(a.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),i._framebuffer=h,i._generateDepthBuffer=n.generateDepthBuffer,i._generateStencilBuffer=n.generateStencilBuffer,o.width=e,o.height=e,o.isReady=!0,o.isCube=!0,o.samples=1,o.generateMipMaps=n.generateMipMaps,o.samplingMode=n.samplingMode,o.type=n.type,o.format=n.format,this._internalTexturesCache.push(o),i.setTextures(o),i}},4504:(e,t,i)=>{"use strict";i.d(t,{nO:()=>C,pB:()=>x,M0:()=>A,Iq:()=>O,J:()=>D});class r{constructor(){this.children=[]}isValid(e){return!0}process(e,t){let i="";if(this.line){let r=this.line;const s=t.processor;if(s){s.lineProcessor&&(r=s.lineProcessor(r,t.isFragment,t.processingContext));const i=t.processor?.attributeKeywordName??"attribute",n=t.isFragment&&t.processor?.varyingFragmentKeywordName?t.processor?.varyingFragmentKeywordName:!t.isFragment&&t.processor?.varyingVertexKeywordName?t.processor?.varyingVertexKeywordName:"varying";if(!t.isFragment&&s.attributeProcessor&&this.line.startsWith(i))r=s.attributeProcessor(this.line,e,t.processingContext);else if(s.varyingProcessor&&(s.varyingCheck?.(this.line,t.isFragment)||!s.varyingCheck&&this.line.startsWith(n)))r=s.varyingProcessor(this.line,t.isFragment,e,t.processingContext);else if(s.uniformProcessor&&s.uniformRegexp&&s.uniformRegexp.test(this.line))t.lookForClosingBracketForUniformBuffer||(r=s.uniformProcessor(this.line,t.isFragment,e,t.processingContext));else if(s.uniformBufferProcessor&&s.uniformBufferRegexp&&s.uniformBufferRegexp.test(this.line))t.lookForClosingBracketForUniformBuffer||(r=s.uniformBufferProcessor(this.line,t.isFragment,t.processingContext),t.lookForClosingBracketForUniformBuffer=!0);else if(s.textureProcessor&&s.textureRegexp&&s.textureRegexp.test(this.line))r=s.textureProcessor(this.line,t.isFragment,e,t.processingContext);else if((s.uniformProcessor||s.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!t.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?s.uniformProcessor&&(r=s.uniformProcessor(this.line,t.isFragment,e,t.processingContext)):s.uniformBufferProcessor&&(r=s.uniformBufferProcessor(this.line,t.isFragment,t.processingContext),t.lookForClosingBracketForUniformBuffer=!0)}t.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(t.lookForClosingBracketForUniformBuffer=!1,s.endOfUniformBufferProcessor&&(r=s.endOfUniformBufferProcessor(this.line,t.isFragment,t.processingContext)))}i+=r+"\n"}return this.children.forEach((r=>{i+=r.process(e,t)})),this.additionalDefineKey&&(e[this.additionalDefineKey]=this.additionalDefineValue||"true"),i}}class s{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(e){this._lines.length=0;for(const t of e){if(!t||"\r"===t)continue;if("#"===t[0]){this._lines.push(t);continue}const e=t.trim();if(!e)continue;if(e.startsWith("//")){this._lines.push(t);continue}const i=e.indexOf(";");if(-1===i)this._lines.push(e);else if(i===e.length-1)e.length>1&&this._lines.push(e);else{const e=t.split(";");for(let t=0;t<e.length;t++){let i=e[t];i&&(i=i.trim(),i&&this._lines.push(i+(t!==e.length-1?";":"")))}}}}}class n extends r{process(e,t){for(let i=0;i<this.children.length;i++){const r=this.children[i];if(r.isValid(e))return r.process(e,t)}return""}}class a extends r{isValid(e){return this.testExpression.isTrue(e)}}class o{isTrue(e){return!0}static postfixToInfix(e){const t=[];for(const i of e)if(void 0===o._OperatorPriority[i])t.push(i);else{const e=t[t.length-1],r=t[t.length-2];t.length-=2,t.push(`(${r}${i}${e})`)}return t[t.length-1]}static infixToPostfix(e){const t=o._InfixToPostfixCache.get(e);if(t)return t.accessTime=Date.now(),t.result;if(!e.includes("&&")&&!e.includes("||")&&!e.includes(")")&&!e.includes("("))return[e];const i=[];let r=-1;const s=()=>{c=c.trim(),""!==c&&(i.push(c),c="")},n=e=>{r<o._Stack.length-1&&(o._Stack[++r]=e)},a=()=>o._Stack[r],l=()=>-1===r?"!!INVALID EXPRESSION!!":o._Stack[r--];let h=0,c="";for(;h<e.length;){const t=e.charAt(h),u=h<e.length-1?e.substr(h,2):"";if("("===t)c="",n(t);else if(")"===t){for(s();-1!==r&&"("!==a();)i.push(l());l()}else if(o._OperatorPriority[u]>1){for(s();-1!==r&&o._OperatorPriority[a()]>=o._OperatorPriority[u];)i.push(l());n(u),h++}else c+=t;h++}for(s();-1!==r;)"("===a()?l():i.push(l());return o._InfixToPostfixCache.size>=o.InfixToPostfixCacheLimitSize&&o.ClearCache(),o._InfixToPostfixCache.set(e,{result:i,accessTime:Date.now()}),i}static ClearCache(){const e=Array.from(o._InfixToPostfixCache.entries()).sort(((e,t)=>e[1].accessTime-t[1].accessTime));for(let t=0;t<o.InfixToPostfixCacheCleanupSize;t++)o._InfixToPostfixCache.delete(e[t][0])}}o.InfixToPostfixCacheLimitSize=5e4,o.InfixToPostfixCacheCleanupSize=25e3,o._InfixToPostfixCache=new Map,o._OperatorPriority={")":0,"(":1,"||":2,"&&":3},o._Stack=["","","","","","","","","","","","","","","","","","","",""];class l extends o{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=e,this.not=t}isTrue(e){let t=void 0!==e[this.define];return this.not&&(t=!t),t}}class h extends o{isTrue(e){return this.leftOperand.isTrue(e)||this.rightOperand.isTrue(e)}}class c extends o{isTrue(e){return this.leftOperand.isTrue(e)&&this.rightOperand.isTrue(e)}}class u extends o{constructor(e,t,i){super(),this.define=e,this.operand=t,this.testValue=i}isTrue(e){let t=e[this.define];void 0===t&&(t=this.define);let i=!1;const r=parseInt(t),s=parseInt(this.testValue);switch(this.operand){case">":i=r>s;break;case"<":i=r<s;break;case"<=":i=r<=s;break;case">=":i=r>=s;break;case"==":i=r===s;break;case"!=":i=r!==s}return i}}var d=i(6984),_=i(2528);const p=/defined\s*?\((.+?)\)/g,f=/defined\s*?\[(.+?)\]/g,g=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,m=/__decl__/,b=/light\{X\}.(\w*)/g,v=/\{X\}/g,y=[],T=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function x(e){e.processor&&e.processor.initializeShaders&&e.processor.initializeShaders(e.processingContext)}function A(e,t,i,r){t.processor?.preProcessShaderCode&&(e=t.processor.preProcessShaderCode(e,t.isFragment)),O(e,t,(e=>{t.processCodeAfterIncludes&&(e=t.processCodeAfterIncludes(t.isFragment?"fragment":"vertex",e,t.defines));const s=function(e,t,i){let r=function(e,t){if(t.processor?.noPrecision)return e;const i=t.shouldUseHighPrecisionShader;-1===e.indexOf("precision highp float")?e=i?"precision highp float;\n"+e:"precision mediump float;\n"+e:i||(e=e.replace("precision highp float","precision mediump float"));return e}(e,t);if(!t.processor)return r;if(0===t.processor.shaderLanguage&&-1!==r.indexOf("#version 3")&&(r=r.replace("#version 300 es",""),!t.processor.parseGLES3))return r;const s=t.defines,n=I(t,i);t.processor.preProcessor&&(r=t.processor.preProcessor(r,s,n,t.isFragment,t.processingContext));r=P(r,n,t),t.processor.postProcessor&&(r=t.processor.postProcessor(r,s,t.isFragment,t.processingContext,i?{drawBuffersExtensionDisabled:!i.getCaps().drawBuffersExtension}:{}));i?._features.needShaderCodeInlining&&(r=i.inlineShaderCode(r));return r}(e,t,r);i(s,e)}))}function C(e,t,i){return i.processor&&i.processor.finalizeShaders?i.processor.finalizeShaders(e,t,i.processingContext):{vertexCode:e,fragmentCode:t}}function R(e){const t=/defined\((.+)\)/.exec(e);if(t&&t.length)return new l(t[1].trim(),"!"===e[0]);const i=["==","!=",">=","<=","<",">"];let r="",s=0;for(r of i)if(s=e.indexOf(r),s>-1)break;if(-1===s)return new l(e);const n=e.substring(0,s).trim(),a=e.substring(s+r.length).trim();return new u(n,r,a)}function E(e,t){const i=new a,r=e.substring(0,t);let s=e.substring(t);return s=s.substring(0,(s.indexOf("//")+1||s.length+1)-1).trim(),i.testExpression="#ifdef"===r?new l(s):"#ifndef"===r?new l(s,!0):function(e){e=e.replace(p,"defined[$1]");const t=o.infixToPostfix(e),i=[];for(const s of t)if("||"!==s&&"&&"!==s)i.push(s);else if(i.length>=2){let e=i[i.length-1],t=i[i.length-2];i.length-=2;const r="&&"==s?new c:new h;"string"===typeof e&&(e=e.replace(f,"defined($1)")),"string"===typeof t&&(t=t.replace(f,"defined($1)")),r.leftOperand="string"===typeof t?R(t):t,r.rightOperand="string"===typeof e?R(e):e,i.push(r)}let r=i[i.length-1];return"string"===typeof r&&(r=r.replace(f,"defined($1)")),"string"===typeof r?R(r):r}(s),i}function S(e,t,i){let s=e.currentLine;for(;M(e,i);){s=e.currentLine;const n=s.substring(0,5).toLowerCase();if("#else"===n){const i=new r;return t.children.push(i),void M(e,i)}if("#elif"===n){const e=E(s,5);t.children.push(e),i=e}}}function M(e,t){for(;e.canRead;){e.lineIndex++;const i=e.currentLine;if(i.indexOf("#")>=0){const r=T.exec(i);if(r&&r.length){switch(r[0]){case"#ifdef":{const r=new n;t.children.push(r);const s=E(i,6);r.children.push(s),S(e,r,s);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const r=new n;t.children.push(r);const s=E(i,7);r.children.push(s),S(e,r,s);break}case"#if":{const r=new n,s=E(i,3);t.children.push(r),r.children.push(s),S(e,r,s);break}}continue}}const s=new r;if(s.line=i,t.children.push(s),"#"===i[0]&&"d"===i[1]){const e=i.replace(";","").split(" ");s.additionalDefineKey=e[1],3===e.length&&(s.additionalDefineValue=e[2])}}return!1}function P(e,t,i){const n=new r,a=new s;return a.lineIndex=-1,a.lines=e.split("\n"),M(a,n),n.process(t,i)}function I(e,t){const i=e.defines,r={};for(const s of i){const e=s.replace("#define","").replace(";","").trim().split(" ");r[e[0]]=e.length>1?e[1]:""}return 0===e.processor?.shaderLanguage&&(r.GL_ES="true"),r.__VERSION__=e.version,r[e.platformName]="true",(0,_.xt)(r,t?.isNDCHalfZRange,t?.useReverseDepthBuffer,t?.useExactSrgbConversions),r}function O(e,t,i){let r;for(y.length=0;null!==(r=g.exec(e));)y.push(r);let s=String(e),n=[e],a=!1;for(const o of y){let e=o[1];if(-1!==e.indexOf("__decl__")&&(e=e.replace(m,""),t.supportsUniformBuffers&&(e=e.replace("Vertex","Ubo").replace("Fragment","Ubo")),e+="Declaration"),!t.includesShadersStore[e]){const r=t.shadersRepository+"ShadersInclude/"+e+".fx";return void D.loadFile(r,(r=>{t.includesShadersStore[e]=r,O(n.join(""),t,i)}))}{let i=t.includesShadersStore[e];if(o[2]){const e=o[3].split(",");for(let t=0;t<e.length;t+=2){const r=new RegExp(e[t],"g"),s=e[t+1];i=i.replace(r,s)}}if(o[4]){const e=o[5];if(-1!==e.indexOf("..")){const r=e.split(".."),s=parseInt(r[0]);let n=parseInt(r[1]),a=i.slice(0);i="",isNaN(n)&&(n=t.indexParameters[r[1]]);for(let e=s;e<n;e++)t.supportsUniformBuffers||(a=a.replace(b,((e,t)=>t+"{X}"))),i+=a.replace(v,e.toString())+"\n"}else t.supportsUniformBuffers||(i=i.replace(b,((e,t)=>t+"{X}"))),i=i.replace(v,e)}const r=[];for(const e of n){const t=e.split(o[0]);for(let e=0;e<t.length-1;e++)r.push(t[e]),r.push(i);r.push(t[t.length-1])}n=r,a=a||i.indexOf("#include<")>=0||i.indexOf("#include <")>=0}}y.length=0,s=n.join(""),a?O(s.toString(),t,i):i(s)}const D={loadFile:(e,t,i,r,s,n)=>{throw(0,d.n)("FileTools")}}},7829:(e,t,i)=>{"use strict";i.d(t,{d:()=>r});class r{get underlyingResource(){return this._webGLTexture}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;if(this._MSAARenderBuffers=null,this._context=t,!e&&(e=t.createTexture(),!e))throw new Error("Unable to create webGL texture");this.set(e)}setUsage(){}set(e){this._webGLTexture=e}reset(){this._webGLTexture=null,this._MSAARenderBuffers=null}addMSAARenderBuffer(e){this._MSAARenderBuffers||(this._MSAARenderBuffers=[]),this._MSAARenderBuffers.push(e)}releaseMSAARenderBuffers(){if(this._MSAARenderBuffers){for(const e of this._MSAARenderBuffers)this._context.deleteRenderbuffer(e);this._MSAARenderBuffers=null}}getMSAARenderBuffer(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._MSAARenderBuffers?.[e]??null}release(){this.releaseMSAARenderBuffers(),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()}}},2528:(e,t,i)=>{"use strict";i.d(t,{W0:()=>a,iL:()=>n,sg:()=>s,xt:()=>o});var r=i(6984);i(8315);const s={};function n(e,t){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(t?t+"\n":"")+e}function a(e,t,i,n,a,o,l){const h=l||s.loadFile;if(h){return h(e,t,i,n,a,o)}throw(0,r.n)("FileTools")}function o(e,t,i,r){if(e)return t?e.IS_NDC_HALF_ZRANGE="":delete e.IS_NDC_HALF_ZRANGE,i?e.USE_REVERSE_DEPTHBUFFER="":delete e.USE_REVERSE_DEPTHBUFFER,void(r?e.USE_EXACT_SRGB_CONVERSIONS="":delete e.USE_EXACT_SRGB_CONVERSIONS);{let e="";return t&&(e+="#define IS_NDC_HALF_ZRANGE"),i&&(e&&(e+="\n"),e+="#define USE_REVERSE_DEPTHBUFFER"),r&&(e&&(e+="\n"),e+="#define USE_EXACT_SRGB_CONVERSIONS"),e}}},8846:(e,t,i)=>{"use strict";i.d(t,{$:()=>v});var r=i(4072),s=i(8274),n=i(4909),a=i(2788),o=i(2132);class l{constructor(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,e&&this.reset()}get isDirty(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty}get zOffset(){return this._zOffset}set zOffset(e){this._zOffset!==e&&(this._zOffset=e,this._isZOffsetDirty=!0)}get zOffsetUnits(){return this._zOffsetUnits}set zOffsetUnits(e){this._zOffsetUnits!==e&&(this._zOffsetUnits=e,this._isZOffsetDirty=!0)}get cullFace(){return this._cullFace}set cullFace(e){this._cullFace!==e&&(this._cullFace=e,this._isCullFaceDirty=!0)}get cull(){return this._cull}set cull(e){this._cull!==e&&(this._cull=e,this._isCullDirty=!0)}get depthFunc(){return this._depthFunc}set depthFunc(e){this._depthFunc!==e&&(this._depthFunc=e,this._isDepthFuncDirty=!0)}get depthMask(){return this._depthMask}set depthMask(e){this._depthMask!==e&&(this._depthMask=e,this._isDepthMaskDirty=!0)}get depthTest(){return this._depthTest}set depthTest(e){this._depthTest!==e&&(this._depthTest=e,this._isDepthTestDirty=!0)}get frontFace(){return this._frontFace}set frontFace(e){this._frontFace!==e&&(this._frontFace=e,this._isFrontFaceDirty=!0)}reset(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._zOffsetUnits=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1}apply(e){this.isDirty&&(this._isCullDirty&&(this.cull?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(e.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(e.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(e.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset||this.zOffsetUnits?(e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(this.zOffset,this.zOffsetUnits)):e.disable(e.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(e.frontFace(this.frontFace),this._isFrontFaceDirty=!1))}}class h{get isDirty(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty}get func(){return this._func}set func(e){this._func!==e&&(this._func=e,this._isStencilFuncDirty=!0)}get funcRef(){return this._funcRef}set funcRef(e){this._funcRef!==e&&(this._funcRef=e,this._isStencilFuncDirty=!0)}get funcMask(){return this._funcMask}set funcMask(e){this._funcMask!==e&&(this._funcMask=e,this._isStencilFuncDirty=!0)}get opStencilFail(){return this._opStencilFail}set opStencilFail(e){this._opStencilFail!==e&&(this._opStencilFail=e,this._isStencilOpDirty=!0)}get opDepthFail(){return this._opDepthFail}set opDepthFail(e){this._opDepthFail!==e&&(this._opDepthFail=e,this._isStencilOpDirty=!0)}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(e){this._opStencilDepthPass!==e&&(this._opStencilDepthPass=e,this._isStencilOpDirty=!0)}get mask(){return this._mask}set mask(e){this._mask!==e&&(this._mask=e,this._isStencilMaskDirty=!0)}get enabled(){return this._enabled}set enabled(e){this._enabled!==e&&(this._enabled=e,this._isStencilTestDirty=!0)}constructor(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,e&&this.reset()}reset(){this.stencilMaterial=void 0,this.stencilGlobal?.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0}apply(e){if(!e)return;const t=!this.useStencilGlobalOnly&&!!this.stencilMaterial?.enabled;this.enabled=t?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.func=t?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=t?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=t?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=t?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=t?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=t?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=t?this.stencilMaterial.mask:this.stencilGlobal.mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(e.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(e.stencilFunc(this.func,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(e.stencilOp(this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),this._isStencilOpDirty=!1))}}class c{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=c.ALWAYS,this.funcRef=1,this.funcMask=255,this.opStencilFail=c.KEEP,this.opDepthFail=c.KEEP,this.opStencilDepthPass=c.REPLACE}get stencilFunc(){return this.func}set stencilFunc(e){this.func=e}get stencilFuncRef(){return this.funcRef}set stencilFuncRef(e){this.funcRef=e}get stencilFuncMask(){return this.funcMask}set stencilFuncMask(e){this.funcMask=e}get stencilOpStencilFail(){return this.opStencilFail}set stencilOpStencilFail(e){this.opStencilFail=e}get stencilOpDepthFail(){return this.opDepthFail}set stencilOpDepthFail(e){this.opDepthFail=e}get stencilOpStencilDepthPass(){return this.opStencilDepthPass}set stencilOpStencilDepthPass(e){this.opStencilDepthPass=e}get stencilMask(){return this.mask}set stencilMask(e){this.mask=e}get stencilTest(){return this.enabled}set stencilTest(e){this.enabled=e}}c.ALWAYS=519,c.KEEP=7680,c.REPLACE=7681;class u{constructor(){this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}get isDirty(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty||this._isBlendEquationParametersDirty}get alphaBlend(){return this._alphaBlend}set alphaBlend(e){this._alphaBlend!==e&&(this._alphaBlend=e,this._isAlphaBlendDirty=!0)}setAlphaBlendConstants(e,t,i,r){this._blendConstants[0]===e&&this._blendConstants[1]===t&&this._blendConstants[2]===i&&this._blendConstants[3]===r||(this._blendConstants[0]=e,this._blendConstants[1]=t,this._blendConstants[2]=i,this._blendConstants[3]=r,this._isBlendConstantsDirty=!0)}setAlphaBlendFunctionParameters(e,t,i,r){this._blendFunctionParameters[0]===e&&this._blendFunctionParameters[1]===t&&this._blendFunctionParameters[2]===i&&this._blendFunctionParameters[3]===r||(this._blendFunctionParameters[0]=e,this._blendFunctionParameters[1]=t,this._blendFunctionParameters[2]=i,this._blendFunctionParameters[3]=r,this._isBlendFunctionParametersDirty=!0)}setAlphaEquationParameters(e,t){this._blendEquationParameters[0]===e&&this._blendEquationParameters[1]===t||(this._blendEquationParameters[0]=e,this._blendEquationParameters[1]=t,this._isBlendEquationParametersDirty=!0)}reset(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1}apply(e){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?e.enable(e.BLEND):e.disable(e.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(e.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(e.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(e.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))}}var d=i(6984),_=i(8665),p=i(8315),f=i(5491),g=i(2528),m=i(3961);function b(e,t){if((0,p.BA)()){const{requestAnimationFrame:i}=t||window;if("function"===typeof i)return i(e)}else if("function"===typeof requestAnimationFrame)return requestAnimationFrame(e);return setTimeout(e,16)}class v{get frameId(){return this._frameId}get isWebGPU(){return this._isWebGPU}_getShaderProcessor(e){return this._shaderProcessor}get shaderPlatformName(){return this._shaderPlatformName}_clearEmptyResources(){this._emptyTexture=null,this._emptyCubeTexture=null,this._emptyTexture3D=null,this._emptyTexture2DArray=null}get useReverseDepthBuffer(){return this._useReverseDepthBuffer}set useReverseDepthBuffer(e){e!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=e,this._depthCullingState.depthFunc=e?518:515)}setColorWrite(e){e!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=e)}getColorWrite(){return this._colorWrite}get depthCullingState(){return this._depthCullingState}get alphaState(){return this._alphaState}get stencilState(){return this._stencilState}get stencilStateComposer(){return this._stencilStateComposer}_getGlobalDefines(e){if(e)return this.isNDCHalfZRange?e.IS_NDC_HALF_ZRANGE="":delete e.IS_NDC_HALF_ZRANGE,this.useReverseDepthBuffer?e.USE_REVERSE_DEPTHBUFFER="":delete e.USE_REVERSE_DEPTHBUFFER,void(this.useExactSrgbConversions?e.USE_EXACT_SRGB_CONVERSIONS="":delete e.USE_EXACT_SRGB_CONVERSIONS);{let e="";return this.isNDCHalfZRange&&(e+="#define IS_NDC_HALF_ZRANGE"),this.useReverseDepthBuffer&&(e&&(e+="\n"),e+="#define USE_REVERSE_DEPTHBUFFER"),this.useExactSrgbConversions&&(e&&(e+="\n"),e+="#define USE_EXACT_SRGB_CONVERSIONS"),e}}_rebuildInternalTextures(){const e=this._internalTexturesCache.slice();for(const t of e)t._rebuild()}_rebuildRenderTargetWrappers(){const e=this._renderTargetWrapperCache.slice();for(const t of e)t._rebuild()}_rebuildEffects(){for(const e in this._compiledEffects){const t=this._compiledEffects[e];t._pipelineContext=null,t._prepareEffect()}n.M.ResetCache()}_rebuildGraphicsResources(){this.wipeCaches(!0),this._rebuildEffects(),this._rebuildComputeEffects?.(),this._rebuildBuffers(),this._rebuildInternalTextures(),this._rebuildTextures(),this._rebuildRenderTargetWrappers(),this.wipeCaches(!0)}_flagContextRestored(){s.V.Warn(this.name+" context successfully restored."),this.onContextRestoredObservable.notifyObservers(this),this._contextWasLost=!1}_restoreEngineAfterContextLost(e){setTimeout((async()=>{this._clearEmptyResources();const t=this._depthCullingState.depthTest,i=this._depthCullingState.depthFunc,r=this._depthCullingState.depthMask,s=this._stencilState.stencilTest;await e(),this._rebuildGraphicsResources(),this._depthCullingState.depthTest=t,this._depthCullingState.depthFunc=i,this._depthCullingState.depthMask=r,this._stencilState.stencilTest=s,this._flagContextRestored()}),0)}get isDisposed(){return this._isDisposed}get snapshotRendering(){return!1}set snapshotRendering(e){}get snapshotRenderingMode(){return 0}set snapshotRenderingMode(e){}getClassName(){return"AbstractEngine"}get emptyTexture(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture}get emptyTexture3D(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D}get emptyTexture2DArray(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray}get emptyCubeTexture(){if(!this._emptyCubeTexture){const e=new Uint8Array(4),t=[e,e,e,e,e,e];this._emptyCubeTexture=this.createRawCubeTexture(t,1,5,0,!1,!1,1)}return this._emptyCubeTexture}get activeRenderLoops(){return this._activeRenderLoops}stopRenderLoop(e){if(!e)return this._activeRenderLoops.length=0,void this._cancelFrame();const t=this._activeRenderLoops.indexOf(e);t>=0&&(this._activeRenderLoops.splice(t,1),0==this._activeRenderLoops.length&&this._cancelFrame())}_cancelFrame(){if(0!==this._frameHandler){const e=this._frameHandler;if(this._frameHandler=0,(0,p.BA)()){const{cancelAnimationFrame:t}=this.getHostWindow()||window;if("function"===typeof t)return t(e)}else if("function"===typeof cancelAnimationFrame)return cancelAnimationFrame(e);return clearTimeout(e)}}beginFrame(){this.onBeginFrameObservable.notifyObservers(this)}endFrame(){this._frameId++,this.onEndFrameObservable.notifyObservers(this)}_renderLoop(){if(this._frameHandler=0,!this._contextWasLost){let e=!0;(this._isDisposed||!this.renderEvenInBackground&&this._windowIsBackground)&&(e=!1),e&&(this.beginFrame(),this._renderViews()||this._renderFrame(),this.endFrame())}this._activeRenderLoops.length>0&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}_renderFrame(){for(let e=0;e<this._activeRenderLoops.length;e++){(0,this._activeRenderLoops[e])()}}_renderViews(){return!1}_queueNewFrame(e,t){return b(e,t)}runRenderLoop(e){-1===this._activeRenderLoops.indexOf(e)&&(this._activeRenderLoops.push(e),1===this._activeRenderLoops.length&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))}getDepthBuffer(){return this._depthCullingState.depthTest}setDepthBuffer(e){this._depthCullingState.depthTest=e}setZOffset(e){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-e:e}getZOffset(){const e=this._depthCullingState.zOffset;return this.useReverseDepthBuffer?-e:e}setZOffsetUnits(e){this._depthCullingState.zOffsetUnits=this.useReverseDepthBuffer?-e:e}getZOffsetUnits(){const e=this._depthCullingState.zOffsetUnits;return this.useReverseDepthBuffer?-e:e}getHostWindow(){return(0,p.BA)()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null}get compatibilityMode(){return this._compatibilityMode}set compatibilityMode(e){this._compatibilityMode=!0}_rebuildTextures(){for(const e of this.scenes)e._rebuildTextures();for(const e of this._virtualScenes)e._rebuildTextures()}_releaseRenderTargetWrapper(e){const t=this._renderTargetWrapperCache.indexOf(e);-1!==t&&this._renderTargetWrapperCache.splice(t,1)}get currentViewport(){return this._cachedViewport}setViewport(e,t,i){const r=t||this.getRenderWidth(),s=i||this.getRenderHeight(),n=e.x||0,a=e.y||0;this._cachedViewport=e,this._viewport(n*r,a*s,r*e.width,s*e.height)}createCanvasImage(){return document.createElement("img")}get description(){let e=this.name+this.version;return this._caps.parallelShaderCompile&&(e+=" - Parallel shader compilation"),e}_createTextureBase(e,t,i,n){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,h=arguments.length>7?arguments[7]:void 0,c=arguments.length>8?arguments[8]:void 0,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,d=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,p=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,f=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,g=arguments.length>13?arguments[13]:void 0,b=arguments.length>14?arguments[14]:void 0,y=arguments.length>15?arguments[15]:void 0;const T="data:"===(e=e||"").substr(0,5),x="blob:"===e.substr(0,5),A=T&&-1!==e.indexOf(";base64,"),C=d||new _.h(this,1);C!==d&&(C.label=e.substring(0,60));const R=e;!this._transformTextureUrl||A||d||u||(e=this._transformTextureUrl(e)),R!==e&&(C._originalUrl=R);const E=e.lastIndexOf(".");let S=f||(E>-1?e.substring(E).toLowerCase():"");S.indexOf("?")>-1&&(S=S.split("?")[0]);const M=(0,m.g)(S,g);n&&n.addPendingData(C),C.url=e,C.generateMipMaps=!t,C.samplingMode=a,C.invertY=i,C._useSRGBBuffer=this._getUseSRGBBuffer(!!y,t),this._doNotHandleContextLost||(C._buffer=u);let P=null;o&&!d&&(P=C.onLoadedObservable.add(o)),d||this._internalTexturesCache.push(C);const I=(i,d)=>{n&&n.removePendingData(C),e===R?(P&&C.onLoadedObservable.remove(P),r.q.UseFallbackTexture&&e!==r.q.FallbackTexture&&this._createTextureBase(r.q.FallbackTexture,t,C.invertY,n,a,null,l,h,c,u,C),i=(i||"Unknown error")+(r.q.UseFallbackTexture?" - Fallback texture was used":""),C.onErrorObservable.notifyObservers({message:i,exception:d}),l&&l(i,d)):(s.V.Warn(`Failed to load ${e}, falling back to ${R}`),this._createTextureBase(R,t,C.invertY,n,a,o,l,h,c,u,C,p,f,g,b,y))};if(M){const t=async e=>{(await M).loadData(e,C,((e,t,i,r,s,o)=>{o?I("TextureLoader failed to load data"):h(C,S,n,{width:e,height:t},C.invertY,!i,r,(()=>(s(),!1)),a)}),b)};u?u instanceof ArrayBuffer?t(new Uint8Array(u)):ArrayBuffer.isView(u)?t(u):l&&l("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(e,(e=>t(new Uint8Array(e))),void 0,n?n.offlineProvider:void 0,!0,((e,t)=>{I("Unable to load "+(e&&e.responseURL,t))}))}else{const i=e=>{x&&!this._doNotHandleContextLost&&(C._buffer=e),h(C,S,n,e,C.invertY,t,!1,c,a)};!T||A?u&&("string"===typeof u.decoding||u.close)?i(u):v._FileToolsLoadImage(e||"",i,I,n?n.offlineProvider:null,g,C.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):"string"===typeof u||u instanceof ArrayBuffer||ArrayBuffer.isView(u)||u instanceof Blob?v._FileToolsLoadImage(u,i,I,n?n.offlineProvider:null,g,C.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):u&&i(u)}return C}_rebuildBuffers(){for(const e of this._uniformBuffers)e._rebuildAfterContextLost()}get _shouldUseHighPrecisionShader(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)}getHostDocument(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:(0,p.Nf)()?document:null}getLoadedTexturesCache(){return this._internalTexturesCache}clearInternalTexturesCache(){this._internalTexturesCache.length=0}getCaps(){return this._caps}resetTextureCache(){for(const e in this._boundTexturesCache)Object.prototype.hasOwnProperty.call(this._boundTexturesCache,e)&&(this._boundTexturesCache[e]=null);this._currentTextureChannel=-1}get name(){return this._name}set name(e){this._name=e}static get NpmPackage(){return"babylonjs@7.24.0"}static get Version(){return"7.24.0"}getRenderingCanvas(){return this._renderingCanvas}getAudioContext(){return this._audioContext}getAudioDestination(){return this._audioDestination}setHardwareScalingLevel(e){this._hardwareScalingLevel=e,this.resize()}getHardwareScalingLevel(){return this._hardwareScalingLevel}get doNotHandleContextLost(){return this._doNotHandleContextLost}set doNotHandleContextLost(e){this._doNotHandleContextLost=e}get isStencilEnable(){return this._isStencilEnable}getCreationOptions(){return this._creationOptions}constructor(e,t,i){this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new l,this._stencilStateComposer=new h,this._stencilState=new c,this._alphaState=new u,this._alphaMode=1,this._alphaEquation=0,this._activeRequests=[],this._badOS=!1,this._badDesktopOS=!1,this._compatibilityMode=!0,this._internalTexturesCache=new Array,this._currentRenderTarget=null,this._boundTexturesCache={},this._activeChannel=0,this._currentTextureChannel=-1,this._viewportCached={x:0,y:0,z:0,w:0},this._isWebGPU=!1,this.onCanvasBlurObservable=new f.cP,this.onCanvasFocusObservable=new f.cP,this.onNewSceneAddedObservable=new f.cP,this.onResizeObservable=new f.cP,this.onCanvasPointerOutObservable=new f.cP,this.disablePerformanceMonitorInBackground=!1,this.disableVertexArrayObjects=!1,this._frameId=0,this.hostInformation={isMobile:!1},this.isFullscreen=!1,this.enableOfflineSupport=!1,this.disableManifestCheck=!1,this.disableContextMenu=!0,this.currentRenderPassId=0,this.isPointerLock=!1,this.postProcesses=[],this.canvasTabIndex=1,this._contextWasLost=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.hasOriginBottomLeft=!0,this._renderTargetWrapperCache=new Array,this._compiledEffects={},this._isDisposed=!1,this.scenes=[],this._virtualScenes=new Array,this.onBeforeTextureInitObservable=new f.cP,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this._frameHandler=0,this._activeRenderLoops=new Array,this._windowIsBackground=!1,this._boundRenderFunction=()=>this._renderLoop(),this.onBeforeShaderCompilationObservable=new f.cP,this.onAfterShaderCompilationObservable=new f.cP,this.onBeginFrameObservable=new f.cP,this.onEndFrameObservable=new f.cP,this._transformTextureUrl=null,this._uniformBuffers=new Array,this._storageBuffers=new Array,this._highPrecisionShadersAllowed=!0,this.onContextLostObservable=new f.cP,this.onContextRestoredObservable=new f.cP,this._name="",this.premultipliedAlpha=!0,this.adaptToDeviceRatio=!1,this._lastDevicePixelRatio=1,this._doNotHandleContextLost=!1,this.cullBackFaces=null,this._renderPassNames=["main"],this._fps=60,this._deltaTime=0,this._deterministicLockstep=!1,this._lockstepMaxSteps=4,this._timeStep=1/60,this.onDisposeObservable=new f.cP,r.q.Instances.push(this),this.startTime=o.j.Now,this._stencilStateComposer.stencilGlobal=this._stencilState,a.I.SetMatrixPrecision(!!t.useHighPrecisionMatrix),(0,p.XD)()&&navigator.userAgent&&(this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),this.adaptToDeviceRatio=i??!1,t.antialias=e??t.antialias,t.deterministicLockstep=t.deterministicLockstep??!1,t.lockstepMaxSteps=t.lockstepMaxSteps??4,t.timeStep=t.timeStep??1/60,t.audioEngine=t.audioEngine??!0,t.stencil=t.stencil??!0,this._audioContext=t.audioEngineOptions?.audioContext??null,this._audioDestination=t.audioEngineOptions?.audioDestination??null,this.premultipliedAlpha=t.premultipliedAlpha??!0,this._doNotHandleContextLost=!!t.doNotHandleContextLost,this._isStencilEnable=!!t.stencil,this.useExactSrgbConversions=t.useExactSrgbConversions??!1;const s=(0,p.BA)()&&window.devicePixelRatio||1,n=t.limitDeviceRatio||s;i=i||t.adaptToDeviceRatio||!1,this._hardwareScalingLevel=i?1/Math.min(n,s):1,this._lastDevicePixelRatio=s,this._creationOptions=t}resize(){let e,t,i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.adaptToDeviceRatio){const e=(0,p.BA)()&&window.devicePixelRatio||1,t=this._lastDevicePixelRatio/e;this._lastDevicePixelRatio=e,this._hardwareScalingLevel*=t}if((0,p.BA)()&&(0,p.Nf)())if(this._renderingCanvas){const i=this._renderingCanvas.getBoundingClientRect?this._renderingCanvas.getBoundingClientRect():{width:this._renderingCanvas.width*this._hardwareScalingLevel,height:this._renderingCanvas.height*this._hardwareScalingLevel};e=this._renderingCanvas.clientWidth||i.width||this._renderingCanvas.width||100,t=this._renderingCanvas.clientHeight||i.height||this._renderingCanvas.height||100}else e=window.innerWidth,t=window.innerHeight;else e=this._renderingCanvas?this._renderingCanvas.width:100,t=this._renderingCanvas?this._renderingCanvas.height:100;this.setSize(e/this._hardwareScalingLevel,t/this._hardwareScalingLevel,i)}setSize(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._renderingCanvas)return!1;if(e|=0,t|=0,!i&&this._renderingCanvas.width===e&&this._renderingCanvas.height===t)return!1;if(this._renderingCanvas.width=e,this._renderingCanvas.height=t,this.scenes){for(let e=0;e<this.scenes.length;e++){const t=this.scenes[e];for(let e=0;e<t.cameras.length;e++){t.cameras[e]._currentRenderId=0}}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0}createRawTexture(e,t,i,r,s,n,a,o,l,h,c){throw(0,d.n)("engine.rawTexture")}createRawCubeTexture(e,t,i,r,s,n,a,o){throw(0,d.n)("engine.rawTexture")}createRawTexture3D(e,t,i,r,s,n,a,o,l,h,c){throw(0,d.n)("engine.rawTexture")}createRawTexture2DArray(e,t,i,r,s,n,a,o,l,h,c){throw(0,d.n)("engine.rawTexture")}_sharedInit(e){this._renderingCanvas=e}_setupMobileChecks(){navigator&&navigator.userAgent&&(this._checkForMobile=()=>{const e=navigator.userAgent;this.hostInformation.isMobile=-1!==e.indexOf("Mobile")||-1!==e.indexOf("Mac")&&(0,p.Nf)()&&"ontouchend"in document},this._checkForMobile(),(0,p.BA)()&&window.addEventListener("resize",this._checkForMobile))}createVideoElement(e){return document.createElement("video")}_reportDrawCall(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this._drawCalls?.addCount(e,!1)}getFps(){return this._fps}getDeltaTime(){return this._deltaTime}isDeterministicLockStep(){return this._deterministicLockstep}getLockstepMaxSteps(){return this._lockstepMaxSteps}getTimeStep(){return 1e3*this._timeStep}_createImageBitmapFromSource(e,t){throw new Error("createImageBitmapFromSource is not implemented")}createImageBitmap(e,t){return createImageBitmap(e,t)}resizeImageBitmap(e,t,i){throw new Error("resizeImageBitmap is not implemented")}getFontOffset(e){throw new Error("getFontOffset is not implemented")}static _CreateCanvas(e,t){if("undefined"===typeof document)return new OffscreenCanvas(e,t);const i=document.createElement("canvas");return i.width=e,i.height=t,i}createCanvas(e,t){return v._CreateCanvas(e,t)}static _FileToolsLoadImage(e,t,i,r,s,n){throw(0,d.n)("FileTools")}_loadFile(e,t,i,r,s,n){const a=(0,g.W0)(e,t,i,r,s,n);return this._activeRequests.push(a),a.onCompleteObservable.add((()=>{const e=this._activeRequests.indexOf(a);-1!==e&&this._activeRequests.splice(e,1)})),a}static _FileToolsLoadFile(e,t,i,r,s,n){if(g.sg.loadFile)return g.sg.loadFile(e,t,i,r,s,n);throw(0,d.n)("FileTools")}dispose(){for(this.releaseEffects(),this._isDisposed=!0,this.stopRenderLoop(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._renderingCanvas=null,this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();this.releaseComputeEffects?.(),n.M.ResetCache();for(const t of this._activeRequests)t.abort();this._boundRenderFunction=null,this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onNewSceneAddedObservable.clear(),(0,p.BA)()&&window.removeEventListener("resize",this._checkForMobile);const e=r.q.Instances.indexOf(this);e>=0&&r.q.Instances.splice(e,1),r.q.Instances.length||(r.q.OnEnginesDisposedObservable.notifyObservers(this),r.q.OnEnginesDisposedObservable.clear()),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()}static DefaultLoadingScreenFactory(e){throw(0,d.n)("LoadingScreen")}static MarkAllMaterialsAsDirty(e,t){for(let i=0;i<r.q.Instances.length;i++){const s=r.q.Instances[i];for(let i=0;i<s.scenes.length;i++)s.scenes[i].markAllMaterialsAsDirty(e,t)}}}v._RenderPassIdCounter=0,v._RescalePostProcessFactory=null,v.CollisionsEpsilon=.001,v.QueueNewFrame=b},4072:(e,t,i)=>{"use strict";i.d(t,{q:()=>s});var r=i(5491);class s{static get LastCreatedEngine(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]}static get LastCreatedScene(){return this._LastCreatedScene}}s.Instances=[],s.OnEnginesDisposedObservable=new r.cP,s._LastCreatedScene=null,s.UseFallbackTexture=!0,s.FallbackTexture=""},2788:(e,t,i)=>{"use strict";i.d(t,{I:()=>r});class r{static SetMatrixPrecision(e){if(r.MatrixTrackPrecisionChange=!1,e&&!r.MatrixUse64Bits&&r.MatrixTrackedMatrices)for(let t=0;t<r.MatrixTrackedMatrices.length;++t){const e=r.MatrixTrackedMatrices[t],i=e._m;e._m=new Array(16);for(let t=0;t<16;++t)e._m[t]=i[t]}r.MatrixUse64Bits=e,r.MatrixCurrentType=r.MatrixUse64Bits?Array:Float32Array,r.MatrixTrackedMatrices=null}}r.MatrixUse64Bits=!1,r.MatrixTrackPrecisionChange=!0,r.MatrixCurrentType=Float32Array,r.MatrixTrackedMatrices=[]},4453:(e,t,i)=>{"use strict";i.d(t,{l:()=>r});class r{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?r.ShadersRepository:r.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?r.ShadersStore:r.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?r.IncludesShadersStore:r.IncludesShadersStoreWGSL}}r.ShadersRepository="src/Shaders/",r.ShadersStore={},r.IncludesShadersStore={},r.ShadersRepositoryWGSL="src/ShadersWGSL/",r.ShadersStoreWGSL={},r.IncludesShadersStoreWGSL={}},2731:(e,t,i)=>{"use strict";i.d(t,{tI:()=>d,bS:()=>b,tg:()=>_,YM:()=>p,C5:()=>m,GX:()=>u,kf:()=>h,EX:()=>c,Cm:()=>l,N5:()=>o});class r{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.engine._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(e){e&&this.program&&e(this.program)}setEngine(e){this.engine=e}_fillEffectInformation(e,t,i,r,s,n,a,o){const l=this.engine;if(l.supportsUniformBuffers)for(const c in t)e.bindUniformBlock(c,t[c]);let h;for(this.engine.getUniforms(this,i).forEach(((e,t)=>{r[i[t]]=e})),this._uniforms=r,h=0;h<s.length;h++){null==e.getUniform(s[h])&&(s.splice(h,1),h--)}s.forEach(((e,t)=>{n[e]=t}));for(const c of l.getAttributes(this,a))o.push(c)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(e,t){const i=this._valueCache[e],r=t.updateFlag;return(void 0===i||i!==r)&&(this._valueCache[e]=r,!0)}_cacheFloat2(e,t,i){let r=this._valueCache[e];if(!r||2!==r.length)return r=[t,i],this._valueCache[e]=r,!0;let s=!1;return r[0]!==t&&(r[0]=t,s=!0),r[1]!==i&&(r[1]=i,s=!0),s}_cacheFloat3(e,t,i,r){let s=this._valueCache[e];if(!s||3!==s.length)return s=[t,i,r],this._valueCache[e]=s,!0;let n=!1;return s[0]!==t&&(s[0]=t,n=!0),s[1]!==i&&(s[1]=i,n=!0),s[2]!==r&&(s[2]=r,n=!0),n}_cacheFloat4(e,t,i,r,s){let n=this._valueCache[e];if(!n||4!==n.length)return n=[t,i,r,s],this._valueCache[e]=n,!0;let a=!1;return n[0]!==t&&(n[0]=t,a=!0),n[1]!==i&&(n[1]=i,a=!0),n[2]!==r&&(n[2]=r,a=!0),n[3]!==s&&(n[3]=s,a=!0),a}setInt(e,t){const i=this._valueCache[e];void 0!==i&&i===t||this.engine.setInt(this._uniforms[e],t)&&(this._valueCache[e]=t)}setInt2(e,t,i){this._cacheFloat2(e,t,i)&&(this.engine.setInt2(this._uniforms[e],t,i)||(this._valueCache[e]=null))}setInt3(e,t,i,r){this._cacheFloat3(e,t,i,r)&&(this.engine.setInt3(this._uniforms[e],t,i,r)||(this._valueCache[e]=null))}setInt4(e,t,i,r,s){this._cacheFloat4(e,t,i,r,s)&&(this.engine.setInt4(this._uniforms[e],t,i,r,s)||(this._valueCache[e]=null))}setIntArray(e,t){this._valueCache[e]=null,this.engine.setIntArray(this._uniforms[e],t)}setIntArray2(e,t){this._valueCache[e]=null,this.engine.setIntArray2(this._uniforms[e],t)}setIntArray3(e,t){this._valueCache[e]=null,this.engine.setIntArray3(this._uniforms[e],t)}setIntArray4(e,t){this._valueCache[e]=null,this.engine.setIntArray4(this._uniforms[e],t)}setUInt(e,t){const i=this._valueCache[e];void 0!==i&&i===t||this.engine.setUInt(this._uniforms[e],t)&&(this._valueCache[e]=t)}setUInt2(e,t,i){this._cacheFloat2(e,t,i)&&(this.engine.setUInt2(this._uniforms[e],t,i)||(this._valueCache[e]=null))}setUInt3(e,t,i,r){this._cacheFloat3(e,t,i,r)&&(this.engine.setUInt3(this._uniforms[e],t,i,r)||(this._valueCache[e]=null))}setUInt4(e,t,i,r,s){this._cacheFloat4(e,t,i,r,s)&&(this.engine.setUInt4(this._uniforms[e],t,i,r,s)||(this._valueCache[e]=null))}setUIntArray(e,t){this._valueCache[e]=null,this.engine.setUIntArray(this._uniforms[e],t)}setUIntArray2(e,t){this._valueCache[e]=null,this.engine.setUIntArray2(this._uniforms[e],t)}setUIntArray3(e,t){this._valueCache[e]=null,this.engine.setUIntArray3(this._uniforms[e],t)}setUIntArray4(e,t){this._valueCache[e]=null,this.engine.setUIntArray4(this._uniforms[e],t)}setArray(e,t){this._valueCache[e]=null,this.engine.setArray(this._uniforms[e],t)}setArray2(e,t){this._valueCache[e]=null,this.engine.setArray2(this._uniforms[e],t)}setArray3(e,t){this._valueCache[e]=null,this.engine.setArray3(this._uniforms[e],t)}setArray4(e,t){this._valueCache[e]=null,this.engine.setArray4(this._uniforms[e],t)}setMatrices(e,t){t&&(this._valueCache[e]=null,this.engine.setMatrices(this._uniforms[e],t))}setMatrix(e,t){this._cacheMatrix(e,t)&&(this.engine.setMatrices(this._uniforms[e],t.asArray())||(this._valueCache[e]=null))}setMatrix3x3(e,t){this._valueCache[e]=null,this.engine.setMatrix3x3(this._uniforms[e],t)}setMatrix2x2(e,t){this._valueCache[e]=null,this.engine.setMatrix2x2(this._uniforms[e],t)}setFloat(e,t){const i=this._valueCache[e];void 0!==i&&i===t||this.engine.setFloat(this._uniforms[e],t)&&(this._valueCache[e]=t)}setVector2(e,t){this._cacheFloat2(e,t.x,t.y)&&(this.engine.setFloat2(this._uniforms[e],t.x,t.y)||(this._valueCache[e]=null))}setFloat2(e,t,i){this._cacheFloat2(e,t,i)&&(this.engine.setFloat2(this._uniforms[e],t,i)||(this._valueCache[e]=null))}setVector3(e,t){this._cacheFloat3(e,t.x,t.y,t.z)&&(this.engine.setFloat3(this._uniforms[e],t.x,t.y,t.z)||(this._valueCache[e]=null))}setFloat3(e,t,i,r){this._cacheFloat3(e,t,i,r)&&(this.engine.setFloat3(this._uniforms[e],t,i,r)||(this._valueCache[e]=null))}setVector4(e,t){this._cacheFloat4(e,t.x,t.y,t.z,t.w)&&(this.engine.setFloat4(this._uniforms[e],t.x,t.y,t.z,t.w)||(this._valueCache[e]=null))}setQuaternion(e,t){this._cacheFloat4(e,t.x,t.y,t.z,t.w)&&(this.engine.setFloat4(this._uniforms[e],t.x,t.y,t.z,t.w)||(this._valueCache[e]=null))}setFloat4(e,t,i,r,s){this._cacheFloat4(e,t,i,r,s)&&(this.engine.setFloat4(this._uniforms[e],t,i,r,s)||(this._valueCache[e]=null))}setColor3(e,t){this._cacheFloat3(e,t.r,t.g,t.b)&&(this.engine.setFloat3(this._uniforms[e],t.r,t.g,t.b)||(this._valueCache[e]=null))}setColor4(e,t,i){this._cacheFloat4(e,t.r,t.g,t.b,i)&&(this.engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,i)||(this._valueCache[e]=null))}setDirectColor4(e,t){this._cacheFloat4(e,t.r,t.g,t.b,t.a)&&(this.engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,t.a)||(this._valueCache[e]=null))}_getVertexShaderCode(){return this.vertexShader?this.engine._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.engine._getShaderSource(this.fragmentShader):null}}var s=i(2528);const n=new WeakMap,a={_webGLVersion:2,cachedPipelines:{}};function o(e){let t=n.get(e);if(!t){if(!e)return a;t={_webGLVersion:e.TEXTURE_BINDING_3D?2:1,_context:e,cachedPipelines:{}},n.set(e,t)}return t}function l(e){n.delete(e)}function h(e,t,i,r,s,n){const a=o(r);n||(n=a._createShaderProgramInjection??d);return n(e,g(t,"vertex",r,a._contextWasLost),g(i,"fragment",r,a._contextWasLost),r,s,a.validateShaderPrograms)}function c(e,t,i,r,s){let n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6?arguments[6]:void 0;const l=o(s);a||(a=l._createShaderProgramInjection??d);const h=l._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return a(e,f(t,"vertex",r,h,s,l._contextWasLost),f(i,"fragment",r,h,s,l._contextWasLost),s,n,l.validateShaderPrograms)}function u(e,t){const i=new r,s=o(e);return s.parallelShaderCompile&&(i.isParallelCompiled=!0),i.context=s._context,i}function d(e,t,i,r){let s=arguments.length>5?arguments[5]:void 0;const n=r.createProgram();if(e.program=n,!n)throw new Error("Unable to create program");return r.attachShader(n,t),r.attachShader(n,i),r.linkProgram(n),e.context=r,e.vertexShader=t,e.fragmentShader=i,e.isParallelCompiled||_(e,r,s),n}function _(e,t,i){const r=e.context,s=e.vertexShader,n=e.fragmentShader,a=e.program;if(!r.getProgramParameter(a,r.LINK_STATUS)){if(!t.getShaderParameter(s,t.COMPILE_STATUS)){const i=t.getShaderInfoLog(s);if(i)throw e.vertexCompilationError=i,new Error("VERTEX SHADER "+i)}if(!t.getShaderParameter(n,t.COMPILE_STATUS)){const i=t.getShaderInfoLog(n);if(i)throw e.fragmentCompilationError=i,new Error("FRAGMENT SHADER "+i)}const i=r.getProgramInfoLog(a);if(i)throw e.programLinkError=i,new Error(i)}if(i){r.validateProgram(a);if(!r.getProgramParameter(a,r.VALIDATE_STATUS)){const t=r.getProgramInfoLog(a);if(t)throw e.programValidationError=t,new Error(t)}}r.deleteShader(s),r.deleteShader(n),e.vertexShader=void 0,e.fragmentShader=void 0,e.onCompiled&&(e.onCompiled(),e.onCompiled=void 0)}function p(e,t,i,r,s,n,a,l,u){let d=arguments.length>10?arguments[10]:void 0,_=arguments.length>11?arguments[11]:void 0,p=arguments.length>12?arguments[12]:void 0;const f=o(e.context);_||(_=f.createRawShaderProgramInjection??h),p||(p=f.createShaderProgramInjection??c);const g=e;g.program=r?_(g,t,i,g.context,u):p(g,t,i,l,g.context,u),g.program.__SPECTOR_rebuildProgram=a,d()}function f(e,t,i,r,n,a){return g((0,s.iL)(e,i,r),t,n,a)}function g(e,t,i,r){const s=i.createShader("vertex"===t?i.VERTEX_SHADER:i.FRAGMENT_SHADER);if(!s){let e=i.NO_ERROR,s=i.NO_ERROR;for(;(s=i.getError())!==i.NO_ERROR;)e=s;throw new Error(`Something went wrong while creating a gl ${t} shader object. gl error=${e}, gl isContextLost=${i.isContextLost()}, _contextWasLost=${r}`)}return i.shaderSource(s,e),i.compileShader(s),s}function m(e,t){t.useProgram(e)}function b(e,t){const i=e;if(!i.isParallelCompiled)return void t(e);const r=i.onCompiled;i.onCompiled=()=>{r?.(),t(e)}}},5887:(e,t,i)=>{"use strict";i.d(t,{w:()=>b});var r=i(2731);var s=i(8274),n=i(8315);class a{constructor(){this.shaderLanguage=0}postProcessor(e,t,i,r,s){if(s.drawBuffersExtensionDisabled){const t=/#extension.+GL_EXT_draw_buffers.+(enable|require)/g;e=e.replace(t,"")}return e}}const o=/(flat\s)?\s*varying\s*.*/;class l{constructor(){this.shaderLanguage=0}attributeProcessor(e){return e.replace("attribute","in")}varyingCheck(e,t){return o.test(e)}varyingProcessor(e,t){return e.replace("varying",t?"in":"out")}postProcessor(e,t,i){const r=-1!==e.search(/#extension.+GL_EXT_draw_buffers.+require/);if(e=(e=e.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),i){const t=-1!==e.search(/layout *\(location *= *0\) *out/g);e=(e=(e=(e=(e=(e=(e=e.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(r||t?"":"layout(location = 0) out vec4 glFragColor;\n")+"void main(")}else{if(-1!==t.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+e}return e}}var h=i(4116),c=i(4780),u=i(8846),d=i(7829),_=i(8665),p=i(4909),f=i(2528),g=i(2542);class m{}class b extends u.${get name(){return this._name}set name(e){this._name=e}get version(){return this._webGLVersion}static get ShadersRepository(){return p.M.ShadersRepository}static set ShadersRepository(e){p.M.ShadersRepository=e}get supportsUniformBuffers(){return this.webGLVersion>1&&!this.disableUniformBuffers}get needPOTTextures(){return this._webGLVersion<2||this.forcePOTTextures}get _supportsHardwareTextureRescaling(){return!1}set framebufferDimensionsObject(e){this._framebufferDimensionsObject=e}snapshotRenderingReset(){this.snapshotRendering=!1}constructor(e,t,i,n){if(i=i||{},super(t??i.antialias,i,n),this._name="WebGL",this.forcePOTTextures=!1,this.validateShaderPrograms=!1,this.disableUniformBuffers=!1,this._webGLVersion=1,this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},!e)return;let o=null;if(e.getContext){if(o=e,this._renderingCanvas=o,void 0===i.preserveDrawingBuffer&&(i.preserveDrawingBuffer=!1),void 0===i.xrCompatible&&(i.xrCompatible=!1),navigator&&navigator.userAgent){this._setupMobileChecks();const e=navigator.userAgent;for(const t of b.ExceptionList){const r=t.key,s=t.targets;if(new RegExp(r).test(e)){if(t.capture&&t.captureConstraint){const i=t.capture,r=t.captureConstraint,s=new RegExp(i).exec(e);if(s&&s.length>0){if(parseInt(s[s.length-1])>=r)continue}}for(const e of s)switch(e){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":i.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1}}}}if(this._doNotHandleContextLost||(this._onContextLost=e=>{e.preventDefault(),this._contextWasLost=!0,s.V.Warn("WebGL context lost."),this.onContextLostObservable.notifyObservers(this)},this._onContextRestored=()=>{this._restoreEngineAfterContextLost((()=>this._initGLContext()))},o.addEventListener("webglcontextlost",this._onContextLost,!1),o.addEventListener("webglcontextrestored",this._onContextRestored,!1),i.powerPreference=i.powerPreference||"high-performance"),this._badDesktopOS&&(i.xrCompatible=!1),!i.disableWebGL2Support)try{this._gl=o.getContext("webgl2",i)||o.getContext("experimental-webgl2",i),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch(u){}if(!this._gl){if(!o)throw new Error("The provided canvas is null or undefined.");try{this._gl=o.getContext("webgl",i)||o.getContext("experimental-webgl",i)}catch(u){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=e,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";const t=this._gl.getContextAttributes();t&&(i.stencil=t.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==i.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=i.useHighPrecisionFloats),this.resize(),this._initGLContext(),this._initFeatures();for(let r=0;r<this._caps.maxVertexAttribs;r++)this._currentBufferPointers[r]=new m;this._shaderProcessor=this.webGLVersion>1?new l:new a;const h=`Babylon.js v${b.Version}`;s.V.Log(h+` - ${this.description}`),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",h);const c=(0,r.N5)(this._gl);c.validateShaderPrograms=this.validateShaderPrograms,c.parallelShaderCompile=this._caps.parallelShaderCompile}_clearEmptyResources(){this._dummyFramebuffer=null,super._clearEmptyResources()}_getShaderProcessingContext(e){return null}areAllEffectsReady(){for(const e in this._compiledEffects){if(!this._compiledEffects[e].isReady())return!1}return!0}_initGLContext(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),supportFloatTexturesResolve:!1,rg11b10ufColorRenderable:!1,colorBufferHalfFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_half_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),texelFetch:1!==this._webGLVersion,blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_ARRAY_TEXTURE_LAYERS):128,disableMorphTargetTexture:!1},this._caps.supportFloatTexturesResolve=this._caps.colorBufferFloat,this._caps.rg11b10ufColorRenderable=this._caps.colorBufferFloat,this._glVersion=this._gl.getParameter(this._gl.VERSION);const e=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=e&&(this._glRenderer=this._gl.getParameter(e.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(e.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=(this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)??0)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=null!==this._maxMSAASamplesOverride?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES);else{const e=this._gl.getExtension("WEBGL_draw_buffers");if(null!==e){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=e.drawBuffersWEBGL.bind(e),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(let t=0;t<16;t++)this._gl["COLOR_ATTACHMENT"+t+"_WEBGL"]=e["COLOR_ATTACHMENT"+t+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{const e=this._gl.getExtension("WEBGL_depth_texture");null!=e&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=e.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{const e=this._gl.getExtension("OES_vertex_array_object");null!=e&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=e.createVertexArrayOES.bind(e),this._gl.bindVertexArray=e.bindVertexArrayOES.bind(e),this._gl.deleteVertexArray=e.deleteVertexArrayOES.bind(e))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{const e=this._gl.getExtension("ANGLE_instanced_arrays");null!=e?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=e.drawArraysInstancedANGLE.bind(e),this._gl.drawElementsInstanced=e.drawElementsInstancedANGLE.bind(e),this._gl.vertexAttribDivisor=e.vertexAttribDivisorANGLE.bind(e)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){const e=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),t=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);e&&t&&(this._caps.highPrecisionShaderSupported=0!==e.precision&&0!==t.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{const e=this._gl.getExtension("EXT_blend_minmax");null!=e&&(this._caps.blendMinMax=!0,this._gl.MAX=e.MAX_EXT,this._gl.MIN=e.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:WebGL2RenderingContext.SRGB,SRGB8:WebGL2RenderingContext.SRGB8,SRGB8_ALPHA8:WebGL2RenderingContext.SRGB8_ALPHA8};else{const e=this._gl.getExtension("EXT_sRGB");null!=e&&(this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:e.SRGB_EXT,SRGB8:e.SRGB_ALPHA_EXT,SRGB8_ALPHA8:e.SRGB_ALPHA_EXT})}this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&!(!this._creationOptions||!this._creationOptions.forceSRGBBufferSupportState)}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(let t=0;t<this._maxSimultaneousTextures;t++)this._nextFreeTextureSlots.push(t);"Mali-G72"===this._glRenderer&&(this._caps.disableMorphTargetTexture=!0)}_initFeatures(){this._features={forceBitmapOverHTMLImageElement:"undefined"===typeof HTMLImageElement,supportRenderAndCopyToLodForFloatTextures:1!==this._webGLVersion,supportDepthStencilTexture:1!==this._webGLVersion,supportShadowSamplers:1!==this._webGLVersion,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:1!==this._webGLVersion,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:1!==this._webGLVersion,basisNeedsPOT:1===this._webGLVersion,support3DTextures:1!==this._webGLVersion,needTypeSuffixInShaderConstants:1!==this._webGLVersion,supportMSAA:1!==this._webGLVersion,supportSSAO2:1!==this._webGLVersion,supportIBLShadows:1!==this._webGLVersion,supportExtendedTextureFormats:1!==this._webGLVersion,supportSwitchCaseInShader:1!==this._webGLVersion,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,supportSpriteInstancing:!0,forceVertexBufferStrideAndOffsetMultiple4Bytes:!1,_checkNonFloatVertexBuffersDontRecreatePipelineContext:!1,_collectUbosUpdatedInFrame:!1}}get webGLVersion(){return this._webGLVersion}getClassName(){return"ThinEngine"}_prepareWorkingCanvas(){if(this._workingCanvas)return;this._workingCanvas=this.createCanvas(1,1);const e=this._workingCanvas.getContext("2d");e&&(this._workingContext=e)}getInfo(){return this.getGlInfo()}getGlInfo(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}}extractDriverInfo(){const e=this.getGlInfo();return e&&e.renderer?e.renderer:""}getRenderWidth(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth}getRenderHeight(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight}clear(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const s=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=s;let n=0;if(t&&e){let t=!0;if(this._currentRenderTarget){const i=this._currentRenderTarget.texture?.format;if(8===i||9===i||10===i||11===i){const i=this._currentRenderTarget.texture?.type;7===i||5===i?(b._TempClearColorUint32[0]=255*e.r,b._TempClearColorUint32[1]=255*e.g,b._TempClearColorUint32[2]=255*e.b,b._TempClearColorUint32[3]=255*e.a,this._gl.clearBufferuiv(this._gl.COLOR,0,b._TempClearColorUint32),t=!1):(b._TempClearColorInt32[0]=255*e.r,b._TempClearColorInt32[1]=255*e.g,b._TempClearColorInt32[2]=255*e.b,b._TempClearColorInt32[3]=255*e.a,this._gl.clearBufferiv(this._gl.COLOR,0,b._TempClearColorInt32),t=!1)}}t&&(this._gl.clearColor(e.r,e.g,e.b,void 0!==e.a?e.a:1),n|=this._gl.COLOR_BUFFER_BIT)}i&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),n|=this._gl.DEPTH_BUFFER_BIT),r&&(this._gl.clearStencil(0),n|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(n)}_viewport(e,t,i,r){e===this._viewportCached.x&&t===this._viewportCached.y&&i===this._viewportCached.z&&r===this._viewportCached.w||(this._viewportCached.x=e,this._viewportCached.y=t,this._viewportCached.z=i,this._viewportCached.w=r,this._gl.viewport(e,t,i,r))}endFrame(){super.endFrame(),this._badOS&&this.flushFramebuffer()}get performanceMonitor(){throw new Error("Not Supported by ThinEngine")}bindFramebuffer(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const l=e;this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=e,this._bindUnboundFramebuffer(l._framebuffer);const h=this._gl;e.isMulti||(e.is2DArray||e.is3D?(h.framebufferTextureLayer(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,e.texture._hardwareTexture?.underlyingResource,a,o),l._currentLOD=a):e.isCube?h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_CUBE_MAP_POSITIVE_X+t,e.texture._hardwareTexture?.underlyingResource,a):l._currentLOD!==a&&(h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,e.texture._hardwareTexture?.underlyingResource,a),l._currentLOD=a));const c=e._depthStencilTexture;if(c){e.is3D&&(e.texture.width===c.width&&e.texture.height===c.height&&e.texture.depth===c.depth||s.V.Warn("Depth/Stencil attachment for 3D target must have same dimensions as color attachment"));const i=e._depthStencilTextureWithStencil?h.DEPTH_STENCIL_ATTACHMENT:h.DEPTH_ATTACHMENT;e.is2DArray||e.is3D?h.framebufferTextureLayer(h.FRAMEBUFFER,i,c._hardwareTexture?.underlyingResource,a,o):e.isCube?h.framebufferTexture2D(h.FRAMEBUFFER,i,h.TEXTURE_CUBE_MAP_POSITIVE_X+t,c._hardwareTexture?.underlyingResource,a):h.framebufferTexture2D(h.FRAMEBUFFER,i,h.TEXTURE_2D,c._hardwareTexture?.underlyingResource,a)}l._MSAAFramebuffer&&this._bindUnboundFramebuffer(l._MSAAFramebuffer),this._cachedViewport&&!n?this.setViewport(this._cachedViewport,i,r):(i||(i=e.width,a&&(i/=Math.pow(2,a))),r||(r=e.height,a&&(r/=Math.pow(2,a))),this._viewport(0,0,i,r)),this.wipeCaches()}setState(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4?arguments[4]:void 0,n=arguments.length>5?arguments[5]:void 0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;(this._depthCullingState.cull!==e||i)&&(this._depthCullingState.cull=e);const o=this.cullBackFaces??s??1?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==o||i)&&(this._depthCullingState.cullFace=o),this.setZOffset(t),this.setZOffsetUnits(a);const l=r?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==l||i)&&(this._depthCullingState.frontFace=l),this._stencilStateComposer.stencilMaterial=n}_bindUnboundFramebuffer(e){this._currentFramebuffer!==e&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,e),this._currentFramebuffer=e)}_currentFrameBufferIsDefaultFrameBuffer(){return null===this._currentFramebuffer}generateMipmaps(e){const t=this._getTextureTarget(e);this._bindTextureDirectly(t,e,!0),this._gl.generateMipmap(t),this._bindTextureDirectly(t,null)}unBindFramebuffer(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0;const r=e;this._currentRenderTarget=null;const s=this._gl;if(r._MSAAFramebuffer){if(e.isMulti)return void this.unBindMultiColorAttachmentFramebuffer(e,t,i);s.bindFramebuffer(s.READ_FRAMEBUFFER,r._MSAAFramebuffer),s.bindFramebuffer(s.DRAW_FRAMEBUFFER,r._framebuffer),s.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,s.COLOR_BUFFER_BIT,s.NEAREST)}!e.texture?.generateMipMaps||t||e.isCube||this.generateMipmaps(e.texture),i&&(r._MSAAFramebuffer&&this._bindUnboundFramebuffer(r._framebuffer),i()),this._bindUnboundFramebuffer(null)}flushFramebuffer(){this._gl.flush()}restoreDefaultFramebuffer(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()}_resetVertexBufferBinding(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null}createVertexBuffer(e,t,i){return this._createVertexBuffer(e,this._gl.STATIC_DRAW)}_createVertexBuffer(e,t){const i=this._gl.createBuffer();if(!i)throw new Error("Unable to create vertex buffer");const r=new h.A(i);return this.bindArrayBuffer(r),"number"!==typeof e?e instanceof Array?(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),t),r.capacity=4*e.length):(this._gl.bufferData(this._gl.ARRAY_BUFFER,e,t),r.capacity=e.byteLength):(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Uint8Array(e),t),r.capacity=e),this._resetVertexBufferBinding(),r.references=1,r}createDynamicVertexBuffer(e,t){return this._createVertexBuffer(e,this._gl.DYNAMIC_DRAW)}_resetIndexBufferBinding(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null}createIndexBuffer(e,t,i){const r=this._gl.createBuffer(),s=new h.A(r);if(!r)throw new Error("Unable to create index buffer");this.bindIndexBuffer(s);const n=this._normalizeIndexData(e);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,n,t?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),s.references=1,s.is32Bits=4===n.BYTES_PER_ELEMENT,s}_normalizeIndexData(e){if(2===e.BYTES_PER_ELEMENT)return e;if(this._caps.uintIndices){if(e instanceof Uint32Array)return e;for(let t=0;t<e.length;t++)if(e[t]>=65535)return new Uint32Array(e);return new Uint16Array(e)}return new Uint16Array(e)}bindArrayBuffer(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(e,this._gl.ARRAY_BUFFER)}bindUniformBlock(e,t,i){const r=e.program,s=this._gl.getUniformBlockIndex(r,t);this._gl.uniformBlockBinding(r,s,i)}bindIndexBuffer(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(e,this._gl.ELEMENT_ARRAY_BUFFER)}_bindBuffer(e,t){(this._vaoRecordInProgress||this._currentBoundBuffer[t]!==e)&&(this._gl.bindBuffer(t,e?e.underlyingResource:null),this._currentBoundBuffer[t]=e)}updateArrayBuffer(e){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,e)}_vertexAttribPointer(e,t,i,r,s,n,a){const o=this._currentBufferPointers[t];if(!o)return;let l=!1;o.active?(o.buffer!==e&&(o.buffer=e,l=!0),o.size!==i&&(o.size=i,l=!0),o.type!==r&&(o.type=r,l=!0),o.normalized!==s&&(o.normalized=s,l=!0),o.stride!==n&&(o.stride=n,l=!0),o.offset!==a&&(o.offset=a,l=!0)):(l=!0,o.active=!0,o.index=t,o.size=i,o.type=r,o.normalized=s,o.stride=n,o.offset=a,o.buffer=e),(l||this._vaoRecordInProgress)&&(this.bindArrayBuffer(e),r===this._gl.UNSIGNED_INT||r===this._gl.INT?this._gl.vertexAttribIPointer(t,i,r,n,a):this._gl.vertexAttribPointer(t,i,r,s,n,a))}_bindIndexBufferWithCache(e){null!=e&&this._cachedIndexBuffer!==e&&(this._cachedIndexBuffer=e,this.bindIndexBuffer(e),this._uintIndicesCurrentlySet=e.is32Bits)}_bindVertexBuffersAttributes(e,t,i){const r=t.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(let s=0;s<r.length;s++){const n=t.getAttributeLocation(s);if(n>=0){const t=r[s];let a=null;if(i&&(a=i[t]),a||(a=e[t]),!a)continue;this._gl.enableVertexAttribArray(n),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[n]=!0);const o=a.getBuffer();o&&(this._vertexAttribPointer(o,n,a.getSize(),a.type,a.normalized,a.byteStride,a.byteOffset),a.getIsInstanced()&&(this._gl.vertexAttribDivisor(n,a.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(n),this._currentInstanceBuffers.push(o))))}}}recordVertexArrayObject(e,t,i,r){const s=this._gl.createVertexArray();if(!s)throw new Error("Unable to create VAO");return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(s),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(e,i,r),this.bindIndexBuffer(t),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),s}bindVertexArrayObject(e,t){this._cachedVertexArrayObject!==e&&(this._cachedVertexArrayObject=e,this._gl.bindVertexArray(e),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=t&&t.is32Bits,this._mustWipeVertexAttributes=!0)}bindBuffersDirectly(e,t,i,r,s){if(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==s){this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=s;const t=s.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();let n=0;for(let a=0;a<t;a++)if(a<i.length){const t=s.getAttributeLocation(a);t>=0&&(this._gl.enableVertexAttribArray(t),this._vertexAttribArraysEnabled[t]=!0,this._vertexAttribPointer(e,t,i[a],this._gl.FLOAT,!1,r,n)),n+=4*i[a]}}this._bindIndexBufferWithCache(t)}_unbindVertexArrayObject(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))}bindBuffers(e,t,i,r){this._cachedVertexBuffers===e&&this._cachedEffectForVertexBuffers===i||(this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=i,this._bindVertexBuffersAttributes(e,i,r)),this._bindIndexBufferWithCache(t)}unbindInstanceAttributes(){let e;for(let t=0,i=this._currentInstanceLocations.length;t<i;t++){const i=this._currentInstanceBuffers[t];e!=i&&i.references&&(e=i,this.bindArrayBuffer(i));const r=this._currentInstanceLocations[t];this._gl.vertexAttribDivisor(r,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0}releaseVertexArrayObject(e){this._gl.deleteVertexArray(e)}_releaseBuffer(e){return e.references--,0===e.references&&(this._deleteBuffer(e),!0)}_deleteBuffer(e){this._gl.deleteBuffer(e.underlyingResource)}updateAndBindInstancesBuffer(e,t,i){if(this.bindArrayBuffer(e),t&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t),void 0!==i[0].index)this.bindInstancesBuffer(e,i,!0);else for(let r=0;r<4;r++){const t=i[r];this._vertexAttribArraysEnabled[t]||(this._gl.enableVertexAttribArray(t),this._vertexAttribArraysEnabled[t]=!0),this._vertexAttribPointer(e,t,4,this._gl.FLOAT,!1,64,16*r),this._gl.vertexAttribDivisor(t,1),this._currentInstanceLocations.push(t),this._currentInstanceBuffers.push(e)}}bindInstancesBuffer(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.bindArrayBuffer(e);let r=0;if(i)for(let s=0;s<t.length;s++){r+=4*t[s].attributeSize}for(let s=0;s<t.length;s++){const i=t[s];void 0===i.index&&(i.index=this._currentEffect.getAttributeLocationByName(i.attributeName)),i.index<0||(this._vertexAttribArraysEnabled[i.index]||(this._gl.enableVertexAttribArray(i.index),this._vertexAttribArraysEnabled[i.index]=!0),this._vertexAttribPointer(e,i.index,i.attributeSize,i.attributeType||this._gl.FLOAT,i.normalized||!1,r,i.offset),this._gl.vertexAttribDivisor(i.index,void 0===i.divisor?1:i.divisor),this._currentInstanceLocations.push(i.index),this._currentInstanceBuffers.push(e))}}disableInstanceAttributeByName(e){if(!this._currentEffect)return;const t=this._currentEffect.getAttributeLocationByName(e);this.disableInstanceAttribute(t)}disableInstanceAttribute(e){let t,i=!1;for(;-1!==(t=this._currentInstanceLocations.indexOf(e));)this._currentInstanceLocations.splice(t,1),this._currentInstanceBuffers.splice(t,1),i=!0,t=this._currentInstanceLocations.indexOf(e);i&&(this._gl.vertexAttribDivisor(e,0),this.disableAttributeByIndex(e))}disableAttributeByIndex(e){this._gl.disableVertexAttribArray(e),this._vertexAttribArraysEnabled[e]=!1,this._currentBufferPointers[e].active=!1}draw(e,t,i,r){this.drawElementsType(e?0:1,t,i,r)}drawPointClouds(e,t,i){this.drawArraysType(2,e,t,i)}drawUnIndexed(e,t,i,r){this.drawArraysType(e?0:1,t,i,r)}drawElementsType(e,t,i,r){this.applyStates(),this._reportDrawCall();const s=this._drawMode(e),n=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,a=this._uintIndicesCurrentlySet?4:2;r?this._gl.drawElementsInstanced(s,i,n,t*a,r):this._gl.drawElements(s,i,n,t*a)}drawArraysType(e,t,i,r){this.applyStates(),this._reportDrawCall();const s=this._drawMode(e);r?this._gl.drawArraysInstanced(s,t,i,r):this._gl.drawArrays(s,t,i)}_drawMode(e){switch(e){case 0:default:return this._gl.TRIANGLES;case 2:case 3:return this._gl.POINTS;case 1:case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN}}_releaseEffect(e){this._compiledEffects[e._key]&&delete this._compiledEffects[e._key];const t=e.getPipelineContext();t&&this._deletePipelineContext(t)}_deletePipelineContext(e){const t=e;t&&t.program&&(t.program.__SPECTOR_rebuildProgram=null,(0,g.mO)(t),this._gl.deleteProgram(t.program))}_getGlobalDefines(e){return(0,f.xt)(e,this.isNDCHalfZRange,this.useReverseDepthBuffer,this.useExactSrgbConversions)}createEffect(e,t,i,s,n,a,o,l,h){let c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,u=arguments.length>10?arguments[10]:void 0;const d="string"===typeof e?e:e.vertexToken||e.vertexSource||e.vertexElement||e.vertex,_="string"===typeof e?e:e.fragmentToken||e.fragmentSource||e.fragmentElement||e.fragment,f=this._getGlobalDefines();let g=n??t.defines??"";f&&(g+=f);const m=d+"+"+_+"@"+g;if(this._compiledEffects[m]){const e=this._compiledEffects[m];return o&&e.isReady()&&o(e),e._refCount++,e}this._gl&&(0,r.N5)(this._gl);const b=new p.M(e,t,i,s,this,n,a,o,l,h,m,t.shaderLanguage??c,t.extraInitializationsAsync??u);return this._compiledEffects[m]=b,b}_getShaderSource(e){return this._gl.getShaderSource(e)}createRawShaderProgram(e,t,i,s){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const a=(0,r.N5)(this._gl);return a._contextWasLost=this._contextWasLost,a.validateShaderPrograms=this.validateShaderPrograms,(0,r.kf)(e,t,i,s||this._gl,n)}createShaderProgram(e,t,i,s,n){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;const o=(0,r.N5)(this._gl);return o._contextWasLost=this._contextWasLost,o.validateShaderPrograms=this.validateShaderPrograms,(0,r.EX)(e,t,i,s,n||this._gl,a)}inlineShaderCode(e){return e}createPipelineContext(e){if(this._gl){(0,r.N5)(this._gl).parallelShaderCompile=this._caps.parallelShaderCompile}const t=(0,r.GX)(this._gl,e);return t.engine=this,t}createMaterialContext(){}createDrawContext(){}_finalizePipelineContext(e){return(0,r.tg)(e,this._gl,this.validateShaderPrograms)}_preparePipelineContext(e,t,i,s,n,a,o,l,h,c,u){const d=(0,r.N5)(this._gl);return d._contextWasLost=this._contextWasLost,d.validateShaderPrograms=this.validateShaderPrograms,d._createShaderProgramInjection=this._createShaderProgram.bind(this),d.createRawShaderProgramInjection=this.createRawShaderProgram.bind(this),d.createShaderProgramInjection=this.createShaderProgram.bind(this),d.loadFileInjection=this._loadFile.bind(this),(0,r.YM)(e,t,i,s,n,a,o,l,h,c,u)}_createShaderProgram(e,t,i,s){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return(0,r.tI)(e,t,i,s,n)}_isRenderingStateCompiled(e){const t=e;return!this._isDisposed&&!t._isDisposed&&(!!this._gl.getProgramParameter(t.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(t),!0))}_executeWhenRenderingStateIsCompiled(e,t){(0,r.bS)(e,t)}getUniforms(e,t){const i=new Array,r=e;for(let s=0;s<t.length;s++)i.push(this._gl.getUniformLocation(r.program,t[s]));return i}getAttributes(e,t){const i=[],r=e;for(let n=0;n<t.length;n++)try{i.push(this._gl.getAttribLocation(r.program,t[n]))}catch(s){i.push(-1)}return i}enableEffect(e){(e=null!==e&&function(e){return void 0===e.getPipelineContext}(e)?e.effect:e)&&e!==this._currentEffect&&(this._stencilStateComposer.stencilMaterial=void 0,this.bindSamplers(e),this._currentEffect=e,e.onBind&&e.onBind(e),e._onBindObservable&&e._onBindObservable.notifyObservers(e))}setInt(e,t){return!!e&&(this._gl.uniform1i(e,t),!0)}setInt2(e,t,i){return!!e&&(this._gl.uniform2i(e,t,i),!0)}setInt3(e,t,i,r){return!!e&&(this._gl.uniform3i(e,t,i,r),!0)}setInt4(e,t,i,r,s){return!!e&&(this._gl.uniform4i(e,t,i,r,s),!0)}setIntArray(e,t){return!!e&&(this._gl.uniform1iv(e,t),!0)}setIntArray2(e,t){return!(!e||t.length%2!==0)&&(this._gl.uniform2iv(e,t),!0)}setIntArray3(e,t){return!(!e||t.length%3!==0)&&(this._gl.uniform3iv(e,t),!0)}setIntArray4(e,t){return!(!e||t.length%4!==0)&&(this._gl.uniform4iv(e,t),!0)}setUInt(e,t){return!!e&&(this._gl.uniform1ui(e,t),!0)}setUInt2(e,t,i){return!!e&&(this._gl.uniform2ui(e,t,i),!0)}setUInt3(e,t,i,r){return!!e&&(this._gl.uniform3ui(e,t,i,r),!0)}setUInt4(e,t,i,r,s){return!!e&&(this._gl.uniform4ui(e,t,i,r,s),!0)}setUIntArray(e,t){return!!e&&(this._gl.uniform1uiv(e,t),!0)}setUIntArray2(e,t){return!(!e||t.length%2!==0)&&(this._gl.uniform2uiv(e,t),!0)}setUIntArray3(e,t){return!(!e||t.length%3!==0)&&(this._gl.uniform3uiv(e,t),!0)}setUIntArray4(e,t){return!(!e||t.length%4!==0)&&(this._gl.uniform4uiv(e,t),!0)}setArray(e,t){return!!e&&(!(t.length<1)&&(this._gl.uniform1fv(e,t),!0))}setArray2(e,t){return!(!e||t.length%2!==0)&&(this._gl.uniform2fv(e,t),!0)}setArray3(e,t){return!(!e||t.length%3!==0)&&(this._gl.uniform3fv(e,t),!0)}setArray4(e,t){return!(!e||t.length%4!==0)&&(this._gl.uniform4fv(e,t),!0)}setMatrices(e,t){return!!e&&(this._gl.uniformMatrix4fv(e,!1,t),!0)}setMatrix3x3(e,t){return!!e&&(this._gl.uniformMatrix3fv(e,!1,t),!0)}setMatrix2x2(e,t){return!!e&&(this._gl.uniformMatrix2fv(e,!1,t),!0)}setFloat(e,t){return!!e&&(this._gl.uniform1f(e,t),!0)}setFloat2(e,t,i){return!!e&&(this._gl.uniform2f(e,t,i),!0)}setFloat3(e,t,i,r){return!!e&&(this._gl.uniform3f(e,t,i,r),!0)}setFloat4(e,t,i,r,s){return!!e&&(this._gl.uniform4f(e,t,i,r,s),!0)}applyStates(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;const e=this._colorWrite;this._gl.colorMask(e,e,e,e)}}wipeCaches(e){this.preventCacheWipeBetweenFrames&&!e||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),e&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))}_getSamplingParameters(e,t){const i=this._gl;let r=i.NEAREST,s=i.NEAREST;switch(e){case 11:r=i.LINEAR,s=t?i.LINEAR_MIPMAP_NEAREST:i.LINEAR;break;case 3:r=i.LINEAR,s=t?i.LINEAR_MIPMAP_LINEAR:i.LINEAR;break;case 8:r=i.NEAREST,s=t?i.NEAREST_MIPMAP_LINEAR:i.NEAREST;break;case 4:r=i.NEAREST,s=t?i.NEAREST_MIPMAP_NEAREST:i.NEAREST;break;case 5:r=i.NEAREST,s=t?i.LINEAR_MIPMAP_NEAREST:i.LINEAR;break;case 6:r=i.NEAREST,s=t?i.LINEAR_MIPMAP_LINEAR:i.LINEAR;break;case 7:r=i.NEAREST,s=i.LINEAR;break;case 1:r=i.NEAREST,s=i.NEAREST;break;case 9:r=i.LINEAR,s=t?i.NEAREST_MIPMAP_NEAREST:i.NEAREST;break;case 10:r=i.LINEAR,s=t?i.NEAREST_MIPMAP_LINEAR:i.NEAREST;break;case 2:r=i.LINEAR,s=i.LINEAR;break;case 12:r=i.LINEAR,s=i.NEAREST}return{min:s,mag:r}}_createTexture(){const e=this._gl.createTexture();if(!e)throw new Error("Unable to create texture");return e}_createHardwareTexture(){return new d.d(this._createTexture(),this._gl)}_createInternalTexture(e,t){let i,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=!1,a=0,o=3,l=5,h=!1,c=1;void 0!==t&&"object"===typeof t?(n=!!t.generateMipMaps,a=void 0===t.type?0:t.type,o=void 0===t.samplingMode?3:t.samplingMode,l=void 0===t.format?5:t.format,h=void 0!==t.useSRGBBuffer&&t.useSRGBBuffer,c=t.samples??1,i=t.label):n=!!t,h&&(h=this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU)),(1!==a||this._caps.textureFloatLinearFiltering)&&(2!==a||this._caps.textureHalfFloatLinearFiltering)||(o=1),1!==a||this._caps.textureFloat||(a=0,s.V.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));const u=this._gl,d=new _.h(this,r),p=e.width||e,f=e.height||e,g=e.depth||0,m=e.layers||0,b=this._getSamplingParameters(o,n),v=0!==m?u.TEXTURE_2D_ARRAY:0!==g?u.TEXTURE_3D:u.TEXTURE_2D,y=this._getRGBABufferInternalSizedFormat(a,l,h),T=this._getInternalFormat(l),x=this._getWebGLTextureType(a);return this._bindTextureDirectly(v,d),0!==m?(d.is2DArray=!0,u.texImage3D(v,0,y,p,f,m,0,T,x,null)):0!==g?(d.is3D=!0,u.texImage3D(v,0,y,p,f,g,0,T,x,null)):u.texImage2D(v,0,y,p,f,0,T,x,null),u.texParameteri(v,u.TEXTURE_MAG_FILTER,b.mag),u.texParameteri(v,u.TEXTURE_MIN_FILTER,b.min),u.texParameteri(v,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(v,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),n&&this._gl.generateMipmap(v),this._bindTextureDirectly(v,null),d._useSRGBBuffer=h,d.baseWidth=p,d.baseHeight=f,d.width=p,d.height=f,d.depth=m,d.isReady=!0,d.samples=c,d.generateMipMaps=n,d.samplingMode=o,d.type=a,d.format=l,d.label=i,this._internalTexturesCache.push(d),d}_getUseSRGBBuffer(e,t){return e&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||t)}createTexture(e,t,i,r){var s=this;let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,u=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,d=arguments.length>11?arguments[11]:void 0,p=arguments.length>12?arguments[12]:void 0,f=arguments.length>13?arguments[13]:void 0,g=arguments.length>14?arguments[14]:void 0;return this._createTextureBase(e,t,i,r,n,a,o,(function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return s._prepareWebGLTexture(...t,c)}),((e,t,i,s,n,a)=>{const o=this._gl,l=i.width===e&&i.height===t;n._creationFlags=f??0;const h=this._getTexImageParametersForCreateTexture(n.format,n._useSRGBBuffer);if(l)return o.texImage2D(o.TEXTURE_2D,0,h.internalFormat,h.format,h.type,i),!1;const c=this._caps.maxTextureSize;if(i.width>c||i.height>c||!this._supportsHardwareTextureRescaling)return this._prepareWorkingCanvas(),!(!this._workingCanvas||!this._workingContext)&&(this._workingCanvas.width=e,this._workingCanvas.height=t,this._workingContext.drawImage(i,0,0,i.width,i.height,0,0,e,t),o.texImage2D(o.TEXTURE_2D,0,h.internalFormat,h.format,h.type,this._workingCanvas),n.width=e,n.height=t,!1);{const e=new _.h(this,2);this._bindTextureDirectly(o.TEXTURE_2D,e,!0),o.texImage2D(o.TEXTURE_2D,0,h.internalFormat,h.format,h.type,i),this._rescaleTexture(e,n,r,h.format,(()=>{this._releaseTexture(e),this._bindTextureDirectly(o.TEXTURE_2D,n,!0),a()}))}return!0}),l,h,c,u,d,p,g)}_getTexImageParametersForCreateTexture(e,t){let i,r;return 1===this.webGLVersion?(i=this._getInternalFormat(e,t),r=i):(i=this._getInternalFormat(e,!1),r=this._getRGBABufferInternalSizedFormat(0,e,t)),{internalFormat:r,format:i,type:this._gl.UNSIGNED_BYTE}}_rescaleTexture(e,t,i,r,s){}_unpackFlipY(e){this._unpackFlipYCached!==e&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,e?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=e))}_getUnpackAlignement(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)}_getTextureTarget(e){return e.isCube?this._gl.TEXTURE_CUBE_MAP:e.is3D?this._gl.TEXTURE_3D:e.is2DArray||e.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D}updateTextureSamplingMode(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=this._getTextureTarget(t),s=this._getSamplingParameters(e,t.useMipMaps||i);this._setTextureParameterInteger(r,this._gl.TEXTURE_MAG_FILTER,s.mag,t),this._setTextureParameterInteger(r,this._gl.TEXTURE_MIN_FILTER,s.min),i&&(t.generateMipMaps=!0,this._gl.generateMipmap(r)),this._bindTextureDirectly(r,null),t.samplingMode=e}updateTextureDimensions(e,t,i){}updateTextureWrappingMode(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const s=this._getTextureTarget(e);null!==t&&(this._setTextureParameterInteger(s,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t),e),e._cachedWrapU=t),null!==i&&(this._setTextureParameterInteger(s,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(i),e),e._cachedWrapV=i),(e.is2DArray||e.is3D)&&null!==r&&(this._setTextureParameterInteger(s,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(r),e),e._cachedWrapR=r),this._bindTextureDirectly(s,null)}_uploadCompressedDataToTextureDirectly(e,t,i,r,s){let n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const o=this._gl;let l=o.TEXTURE_2D;if(e.isCube&&(l=o.TEXTURE_CUBE_MAP_POSITIVE_X+n),e._useSRGBBuffer)switch(t){case 37492:case 36196:this._caps.etc2?t=o.COMPRESSED_SRGB8_ETC2:e._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?t=o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:e._useSRGBBuffer=!1;break;case 36492:t=o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:t=o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?t=o.COMPRESSED_SRGB_S3TC_DXT1_EXT:e._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?t=o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:e._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?t=o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:e._useSRGBBuffer=!1;break;default:e._useSRGBBuffer=!1}this._gl.compressedTexImage2D(l,a,t,i,r,0,s)}_uploadDataToTextureDirectly(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4?arguments[4]:void 0,n=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const a=this._gl,o=this._getWebGLTextureType(e.type),l=this._getInternalFormat(e.format),h=void 0===s?this._getRGBABufferInternalSizedFormat(e.type,e.format,e._useSRGBBuffer):this._getInternalFormat(s,e._useSRGBBuffer);this._unpackFlipY(e.invertY);let c=a.TEXTURE_2D;e.isCube&&(c=a.TEXTURE_CUBE_MAP_POSITIVE_X+i);const u=Math.round(Math.log(e.width)*Math.LOG2E),d=Math.round(Math.log(e.height)*Math.LOG2E),_=n?e.width:Math.pow(2,Math.max(u-r,0)),p=n?e.height:Math.pow(2,Math.max(d-r,0));a.texImage2D(c,r,h,_,p,0,l,o,t)}updateTextureData(e,t,i,r,s,n){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,l=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const h=this._gl,c=this._getWebGLTextureType(e.type),u=this._getInternalFormat(e.format);this._unpackFlipY(e.invertY);let d=h.TEXTURE_2D,_=h.TEXTURE_2D;e.isCube&&(_=h.TEXTURE_CUBE_MAP_POSITIVE_X+a,d=h.TEXTURE_CUBE_MAP),this._bindTextureDirectly(d,e,!0),h.texSubImage2D(_,o,i,r,s,n,u,c,t),l&&this._gl.generateMipmap(_),this._bindTextureDirectly(d,null)}_uploadArrayBufferViewToTexture(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const s=this._gl,n=e.isCube?s.TEXTURE_CUBE_MAP:s.TEXTURE_2D;this._bindTextureDirectly(n,e,!0),this._uploadDataToTextureDirectly(e,t,i,r),this._bindTextureDirectly(n,null,!0)}_prepareWebGLTextureContinuation(e,t,i,r,s){const n=this._gl;if(!n)return;const a=this._getSamplingParameters(s,!i);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,a.mag),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,a.min),i||r||n.generateMipmap(n.TEXTURE_2D),this._bindTextureDirectly(n.TEXTURE_2D,null),t&&t.removePendingData(e),e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear()}_prepareWebGLTexture(e,t,i,r,s,n,a,o,l,h){const u=this.getCaps().maxTextureSize,d=Math.min(u,this.needPOTTextures?(0,c.R)(r.width,u):r.width),_=Math.min(u,this.needPOTTextures?(0,c.R)(r.height,u):r.height),p=this._gl;p&&(e._hardwareTexture?(this._bindTextureDirectly(p.TEXTURE_2D,e,!0),this._unpackFlipY(void 0===s||!!s),e.baseWidth=r.width,e.baseHeight=r.height,e.width=d,e.height=_,e.isReady=!0,e.type=-1!==e.type?e.type:0,e.format=-1!==e.format?e.format:h??(".jpg"!==t||e._useSRGBBuffer?5:4),o(d,_,r,t,e,(()=>{this._prepareWebGLTextureContinuation(e,i,n,a,l)}))||this._prepareWebGLTextureContinuation(e,i,n,a,l)):i&&i.removePendingData(e))}_getInternalFormatFromDepthTextureFormat(e,t,i){const r=this._gl;if(!t)return r.STENCIL_INDEX8;let s=i?r.DEPTH_STENCIL:r.DEPTH_COMPONENT;return this.webGLVersion>1?15===e?s=r.DEPTH_COMPONENT16:16===e?s=r.DEPTH_COMPONENT24:17===e||13===e?s=i?r.DEPTH24_STENCIL8:r.DEPTH_COMPONENT24:14===e?s=r.DEPTH_COMPONENT32F:18===e&&(s=i?r.DEPTH32F_STENCIL8:r.DEPTH_COMPONENT32F):s=r.DEPTH_COMPONENT16,s}_setupFramebufferDepthAttachments(e,t,i,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,n=arguments.length>5?arguments[5]:void 0;const a=this._gl;n=n??(e?13:14);const o=this._getInternalFormatFromDepthTextureFormat(n,t,e);return e&&t?this._createRenderBuffer(i,r,s,a.DEPTH_STENCIL,o,a.DEPTH_STENCIL_ATTACHMENT):t?this._createRenderBuffer(i,r,s,o,o,a.DEPTH_ATTACHMENT):e?this._createRenderBuffer(i,r,s,o,o,a.STENCIL_ATTACHMENT):null}_createRenderBuffer(e,t,i,r,s,n){let a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];const o=this._gl.createRenderbuffer();return this._updateRenderBuffer(o,e,t,i,r,s,n,a)}_updateRenderBuffer(e,t,i,r,s,n,a){let o=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const l=this._gl;return l.bindRenderbuffer(l.RENDERBUFFER,e),r>1&&l.renderbufferStorageMultisample?l.renderbufferStorageMultisample(l.RENDERBUFFER,r,n,t,i):l.renderbufferStorage(l.RENDERBUFFER,s,t,i),l.framebufferRenderbuffer(l.FRAMEBUFFER,a,l.RENDERBUFFER,e),o&&l.bindRenderbuffer(l.RENDERBUFFER,null),e}_releaseTexture(e){this._deleteTexture(e._hardwareTexture),this.unbindAllTextures();const t=this._internalTexturesCache.indexOf(e);-1!==t&&this._internalTexturesCache.splice(t,1),e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureLow&&e._lodTextureLow.dispose(),e._irradianceTexture&&e._irradianceTexture.dispose()}_deleteTexture(e){e?.release()}_setProgram(e){this._currentProgram!==e&&((0,r.C5)(e,this._gl),this._currentProgram=e)}bindSamplers(e){const t=e.getPipelineContext();this._setProgram(t.program);const i=e.getSamplers();for(let r=0;r<i.length;r++){const t=e.getUniform(i[r]);t&&(this._boundUniforms[r]=t)}this._currentEffect=null}_activateCurrentTexture(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)}_bindTextureDirectly(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=!1;const a=t&&t._associatedChannel>-1;i&&a&&(this._activeChannel=t._associatedChannel);if(this._boundTexturesCache[this._activeChannel]!==t||r){if(this._activateCurrentTexture(),t&&t.isMultiview)throw s.V.Error(["_bindTextureDirectly called with a multiview texture!",e,t]),"_bindTextureDirectly called with a multiview texture!";this._gl.bindTexture(e,t?._hardwareTexture?.underlyingResource??null),this._boundTexturesCache[this._activeChannel]=t,t&&(t._associatedChannel=this._activeChannel)}else i&&(n=!0,this._activateCurrentTexture());return a&&!i&&this._bindSamplerUniformToChannel(t._associatedChannel,this._activeChannel),n}_bindTexture(e,t,i){if(void 0===e)return;t&&(t._associatedChannel=e),this._activeChannel=e;const r=t?this._getTextureTarget(t):this._gl.TEXTURE_2D;this._bindTextureDirectly(r,t)}unbindAllTextures(){for(let e=0;e<this._maxSimultaneousTextures;e++)this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))}setTexture(e,t,i,r){void 0!==e&&(t&&(this._boundUniforms[e]=t),this._setTexture(e,i))}_bindSamplerUniformToChannel(e,t){const i=this._boundUniforms[e];i&&i._currentState!==t&&(this._gl.uniform1i(i,t),i._currentState=t)}_getTextureWrapMode(e){switch(e){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT}_setTexture(e,t){let i,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!t)return null!=this._boundTexturesCache[e]&&(this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(t.video){this._activeChannel=e;const i=t.getInternalTexture();i&&(i._associatedChannel=e),t.update()}else if(4===t.delayLoadState)return t.delayLoad(),!1;i=s?t.depthStencilTexture:t.isReady()?t.getInternalTexture():t.isCube?this.emptyCubeTexture:t.is3D?this.emptyTexture3D:t.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!r&&i&&(i._associatedChannel=e);let n=!0;this._boundTexturesCache[e]===i&&(r||this._bindSamplerUniformToChannel(i._associatedChannel,e),n=!1),this._activeChannel=e;const a=this._getTextureTarget(i);if(n&&this._bindTextureDirectly(a,i,r),i&&!i.isMultiview){if(i.isCube&&i._cachedCoordinatesMode!==t.coordinatesMode){i._cachedCoordinatesMode=t.coordinatesMode;const e=3!==t.coordinatesMode&&5!==t.coordinatesMode?1:0;t.wrapU=e,t.wrapV=e}i._cachedWrapU!==t.wrapU&&(i._cachedWrapU=t.wrapU,this._setTextureParameterInteger(a,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t.wrapU),i)),i._cachedWrapV!==t.wrapV&&(i._cachedWrapV=t.wrapV,this._setTextureParameterInteger(a,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(t.wrapV),i)),i.is3D&&i._cachedWrapR!==t.wrapR&&(i._cachedWrapR=t.wrapR,this._setTextureParameterInteger(a,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(t.wrapR),i)),this._setAnisotropicLevel(a,i,t.anisotropicFilteringLevel)}return!0}setTextureArray(e,t,i,r){if(void 0!==e&&t){this._textureUnits&&this._textureUnits.length===i.length||(this._textureUnits=new Int32Array(i.length));for(let t=0;t<i.length;t++){const r=i[t].getInternalTexture();r?(this._textureUnits[t]=e+t,r._associatedChannel=e+t):this._textureUnits[t]=-1}this._gl.uniform1iv(t,this._textureUnits);for(let e=0;e<i.length;e++)this._setTexture(this._textureUnits[e],i[e],!0)}}_setAnisotropicLevel(e,t,i){const r=this._caps.textureAnisotropicFilterExtension;11!==t.samplingMode&&3!==t.samplingMode&&2!==t.samplingMode&&(i=1),r&&t._cachedAnisotropicFilteringLevel!==i&&(this._setTextureParameterFloat(e,r.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(i,this._caps.maxAnisotropy),t),t._cachedAnisotropicFilteringLevel=i)}_setTextureParameterFloat(e,t,i,r){this._bindTextureDirectly(e,r,!0,!0),this._gl.texParameterf(e,t,i)}_setTextureParameterInteger(e,t,i,r){r&&this._bindTextureDirectly(e,r,!0,!0),this._gl.texParameteri(e,t,i)}unbindAllAttributes(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(let e=0;e<this._caps.maxVertexAttribs;e++)this.disableAttributeByIndex(e)}else for(let e=0,t=this._vertexAttribArraysEnabled.length;e<t;e++)e>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[e]||this.disableAttributeByIndex(e)}releaseEffects(){const e=Object.keys(this._compiledEffects);for(const t of e){this._compiledEffects[t].dispose()}this._compiledEffects={}}dispose(){(0,n.BA)()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),super.dispose(),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.unbindAllAttributes(),this._boundUniforms={},this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers.length=0,this._currentProgram=null,this._creationOptions.loseContextOnDispose&&this._gl.getExtension("WEBGL_lose_context")?.loseContext(),(0,r.Cm)(this._gl)}attachContextLostEvent(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",e,!1)}attachContextRestoredEvent(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",e,!1)}getError(){return this._gl.getError()}_canRenderToFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)}_canRenderToHalfFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)}_canRenderToFramebuffer(e){const t=this._gl;for(;t.getError()!==t.NO_ERROR;);let i=!0;const r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(e),1,1,0,t.RGBA,this._getWebGLTextureType(e),null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST);const s=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,s),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0);const n=t.checkFramebufferStatus(t.FRAMEBUFFER);if(i=i&&n===t.FRAMEBUFFER_COMPLETE,i=i&&t.getError()===t.NO_ERROR,i&&(t.clear(t.COLOR_BUFFER_BIT),i=i&&t.getError()===t.NO_ERROR),i){t.bindFramebuffer(t.FRAMEBUFFER,null);const e=t.RGBA,r=t.UNSIGNED_BYTE,s=new Uint8Array(4);t.readPixels(0,0,1,1,e,r,s),i=i&&t.getError()===t.NO_ERROR}for(t.deleteTexture(r),t.deleteFramebuffer(s),t.bindFramebuffer(t.FRAMEBUFFER,null);!i&&t.getError()!==t.NO_ERROR;);return i}_getWebGLTextureType(e){if(1===this._webGLVersion){switch(e){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(e){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE}_getInternalFormat(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=t?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA;switch(e){case 0:i=this._gl.ALPHA;break;case 1:i=this._gl.LUMINANCE;break;case 2:i=this._gl.LUMINANCE_ALPHA;break;case 6:i=this._gl.RED;break;case 7:i=this._gl.RG;break;case 4:i=t?this._glSRGBExtensionValues.SRGB:this._gl.RGB;break;case 5:i=t?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA}if(this._webGLVersion>1)switch(e){case 8:i=this._gl.RED_INTEGER;break;case 9:i=this._gl.RG_INTEGER;break;case 10:i=this._gl.RGB_INTEGER;break;case 11:i=this._gl.RGBA_INTEGER}return i}_getRGBABufferInternalSizedFormat(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(1===this._webGLVersion){if(void 0!==t)switch(t){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return i?this._glSRGBExtensionValues.SRGB:this._gl.RGB}return this._gl.RGBA}switch(e){case 3:switch(t){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(t){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return i?this._glSRGBExtensionValues.SRGB8:this._gl.RGB8;case 5:return i?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(t){case 8:return this._gl.R16I;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;default:return this._gl.RGBA16I}case 5:switch(t){case 8:return this._gl.R16UI;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;default:return this._gl.RGBA16UI}case 6:switch(t){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;default:return this._gl.RGBA32I}case 7:switch(t){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;default:return this._gl.RGBA32UI}case 1:switch(t){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;default:return this._gl.RGBA32F}case 2:switch(t){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(t){case 5:default:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI}}return i?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8}readPixels(e,t,i,r){let s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const a=s?4:3,o=s?this._gl.RGBA:this._gl.RGB,l=new Uint8Array(r*i*a);return n&&this.flushFramebuffer(),this._gl.readPixels(e,t,i,r,o,this._gl.UNSIGNED_BYTE,l),Promise.resolve(l)}static get IsSupportedAsync(){return Promise.resolve(this.isSupported())}static get IsSupported(){return this.isSupported()}static isSupported(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{const e=u.$._CreateCanvas(1,1),t=e.getContext("webgl")||e.getContext("experimental-webgl");this._IsSupported=null!=t&&!!window.WebGLRenderingContext}catch(e){this._IsSupported=!1}return this._IsSupported}static get HasMajorPerformanceCaveat(){if(null===this._HasMajorPerformanceCaveat)try{const e=u.$._CreateCanvas(1,1),t=e.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||e.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!t}catch(e){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat}}b._TempClearColorUint32=new Uint32Array(4),b._TempClearColorInt32=new Int32Array(4),b.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/12\\d\\..+?Mobile",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}],b._ConcatenateShader=f.iL,b._IsSupported=null,b._HasMajorPerformanceCaveat=null},1321:(e,t,i)=>{"use strict";var r;i.d(t,{s:()=>s}),function(e){e[e.PointerMove=0]="PointerMove",e[e.PointerDown=1]="PointerDown",e[e.PointerUp=2]="PointerUp"}(r||(r={}));class s{}s.DOM_DELTA_PIXEL=0,s.DOM_DELTA_LINE=1,s.DOM_DELTA_PAGE=2},4585:(e,t,i)=>{"use strict";i.d(t,{Bu:()=>n,TB:()=>r,W0:()=>s});class r{}r.KEYDOWN=1,r.KEYUP=2;class s{constructor(e,t){this.type=e,this.event=t}}class n extends s{get skipOnPointerObservable(){return this.skipOnKeyboardObservable}set skipOnPointerObservable(e){this.skipOnKeyboardObservable=e}constructor(e,t){super(e,t),this.type=e,this.event=t,this.skipOnKeyboardObservable=!1}}},3781:(e,t,i)=>{"use strict";i.d(t,{Zp:()=>s,mx:()=>o,tT:()=>a});var r=i(5968);class s{}s.POINTERDOWN=1,s.POINTERUP=2,s.POINTERMOVE=4,s.POINTERWHEEL=8,s.POINTERPICK=16,s.POINTERTAP=32,s.POINTERDOUBLETAP=64;class n{constructor(e,t){this.type=e,this.event=t}}class a extends n{constructor(e,t,i,s){super(e,t),this.ray=null,this.originalPickingInfo=null,this.skipOnPointerObservable=!1,this.localPosition=new r.I9(i,s)}}class o extends n{get pickInfo(){return this._pickInfo||this._generatePickInfo(),this._pickInfo}constructor(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(e,t),this._pickInfo=i,this._inputManager=r}_generatePickInfo(){this._inputManager&&(this._pickInfo=this._inputManager._pickMove(this.event),this._inputManager._setRayOnPointerInfo(this._pickInfo,this.event),this._inputManager=null)}}},5556:(e,t,i)=>{"use strict";i.d(t,{c:()=>r});class r{static CompareLightsPriority(e,t){return e.shadowEnabled!==t.shadowEnabled?(t.shadowEnabled?1:0)-(e.shadowEnabled?1:0):t.renderPriority-e.renderPriority}}r.FALLOFF_DEFAULT=0,r.FALLOFF_PHYSICAL=1,r.FALLOFF_GLTF=2,r.FALLOFF_STANDARD=3,r.LIGHTMAP_DEFAULT=0,r.LIGHTMAP_SPECULAR=1,r.LIGHTMAP_SHADOWSONLY=2,r.INTENSITYMODE_AUTOMATIC=0,r.INTENSITYMODE_LUMINOUSPOWER=1,r.INTENSITYMODE_LUMINOUSINTENSITY=2,r.INTENSITYMODE_ILLUMINANCE=3,r.INTENSITYMODE_LUMINANCE=4,r.LIGHTTYPEID_POINTLIGHT=0,r.LIGHTTYPEID_DIRECTIONALLIGHT=1,r.LIGHTTYPEID_SPOTLIGHT=2,r.LIGHTTYPEID_HEMISPHERICLIGHT=3},6141:(e,t,i)=>{"use strict";i.r(t),i.d(t,{_DDSTextureLoader:()=>n});var r=i(1322),s=i(561);i(6952);class n{constructor(){this.supportCascades=!0}loadCubeData(e,t,i,n){const a=t.getEngine();let o,l=!1,h=1e3;if(Array.isArray(e))for(let r=0;r<e.length;r++){const i=e[r];o=s.D.GetDDSInfo(i),t.width=o.width,t.height=o.height,l=(o.isRGB||o.isLuminance||o.mipmapCount>1)&&t.generateMipMaps,a._unpackFlipY(o.isCompressed),s.D.UploadDDSLevels(a,t,i,o,l,6,-1,r),o.isFourCC||1!==o.mipmapCount?h=o.mipmapCount-1:a.generateMipMapsForCubemap(t)}else{const n=e;o=s.D.GetDDSInfo(n),t.width=o.width,t.height=o.height,i&&(o.sphericalPolynomial=new r.Q),l=(o.isRGB||o.isLuminance||o.mipmapCount>1)&&t.generateMipMaps,a._unpackFlipY(o.isCompressed),s.D.UploadDDSLevels(a,t,n,o,l,6),o.isFourCC||1!==o.mipmapCount?h=o.mipmapCount-1:a.generateMipMapsForCubemap(t,!1)}a._setCubeMapTextureParams(t,l,h),t.isReady=!0,t.onLoadedObservable.notifyObservers(t),t.onLoadedObservable.clear(),n&&n({isDDS:!0,width:t.width,info:o,data:e,texture:t})}loadData(e,t,i){const r=s.D.GetDDSInfo(e),n=(r.isRGB||r.isLuminance||r.mipmapCount>1)&&t.generateMipMaps&&Math.max(r.width,r.height)>>r.mipmapCount-1===1;i(r.width,r.height,n,r.isFourCC,(()=>{s.D.UploadDDSLevels(t.getEngine(),t,e,r,n,1)}))}}},7189:(e,t,i)=>{"use strict";i.r(t),i.d(t,{_ENVTextureLoader:()=>T});var r=i(543),s=i(5968),n=i(7559),a=i(1322),o=i(8665),l=i(1119),h=(i(4742),i(6976)),c=i(8274);i(921),i(9422),i(6371),i(1335),i(1909);const u="image/png",d=2,_=[134,22,135,150,246,214,150,54];function p(e){const t=new DataView(e.buffer,e.byteOffset,e.byteLength);let i=0;for(let a=0;a<_.length;a++)if(t.getUint8(i++)!==_[a])return c.V.Error("Not a babylon environment map"),null;let r="",s=0;for(;s=t.getUint8(i++);)r+=String.fromCharCode(s);let n=JSON.parse(r);return n=f(n),n.specular&&(n.specular.specularDataPosition=i,n.specular.lodGenerationScale=n.specular.lodGenerationScale||.8),n}function f(e){if(e.version>d)throw new Error(`Unsupported babylon environment map version "${e.version}". Latest supported version is "${d}".`);return 2===e.version?e:e={...e,version:2,imageType:u}}function g(e,t){const i=(t=f(t)).specular;let r=n.X.Log2(t.width);if(r=Math.round(r)+1,i.mipmaps.length!==6*r)throw new Error(`Unsupported specular mipmaps number "${i.mipmaps.length}"`);const s=new Array(r);for(let n=0;n<r;n++){s[n]=new Array(6);for(let t=0;t<6;t++){const r=i.mipmaps[6*n+t];s[n][t]=new Uint8Array(e.buffer,e.byteOffset+i.specularDataPosition+r.position,r.length)}}return s}function m(e,t,i){const r=(i=f(i)).specular;if(!r)return Promise.resolve();e._lodGenerationScale=r.lodGenerationScale;return v(e,g(t,i),i.imageType)}function b(e,t,i,r,s,n,a,o,l,h,c){return new Promise(((u,d)=>{if(i){const i=t.createTexture(null,!0,!0,null,1,null,(e=>{d(e)}),e);r?.onEffectCreatedObservable.addOnce((o=>{o.executeWhenCompiled((()=>{r.externalTextureSamplerBinding=!0,r.onApply=r=>{r._bindTexture("textureSampler",i),r.setFloat2("scale",1,t._features.needsInvertingBitmap&&e instanceof ImageBitmap?-1:1)},t.scenes.length&&(t.scenes[0].postProcessManager.directRender([r],h,!0,n,a),t.restoreDefaultFramebuffer(),i.dispose(),URL.revokeObjectURL(s),u())}))}))}else{if(t._uploadImageToTexture(c,e,n,a),o){const i=l[a];i&&t._uploadImageToTexture(i._texture,e,n,0)}u()}}))}async function v(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:u;if(!r.S0.IsExponentOfTwo(e.width))throw new Error("Texture size must be a power of two");const a=n.X.ILog2(e.width)+1,c=e.getEngine();let d=!1,_=!1,p=null,f=null,g=null;const m=c.getCaps();e.format=5,e.type=0,e.generateMipMaps=!0,e._cachedAnisotropicFilteringLevel=null,c.updateTextureSamplingMode(3,e),m.textureLOD?c._features.supportRenderAndCopyToLodForFloatTextures?m.textureHalfFloatRender&&m.textureHalfFloatLinearFiltering?(d=!0,e.type=2):m.textureFloatRender&&m.textureFloatLinearFiltering&&(d=!0,e.type=1):d=!1:(d=!1,_=!0,g={});let v=0;if(d)c.isWebGPU?(v=1,await i.e(944).then(i.bind(i,9944))):await i.e(685).then(i.bind(i,7685)),p=new h.w("rgbdDecode","rgbdDecode",null,null,1,null,3,c,!1,void 0,e.type,void 0,null,!1,void 0,v),e._isRGBD=!1,e.invertY=!1,f=c.createRenderTargetCubeTexture(e.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:3,type:e.type,format:5});else if(e._isRGBD=!0,e.invertY=!0,_){const t=3,i=e._lodGenerationScale,r=e._lodGenerationOffset;for(let s=0;s<t;s++){const n=(a-1)*i+r,h=r+(n-r)*(1-s/(t-1)),u=Math.round(Math.min(Math.max(h,0),n)),d=new o.h(c,2);d.isCube=!0,d.invertY=!0,d.generateMipMaps=!1,c.updateTextureSamplingMode(2,d);const _=new l.t(null);switch(_._isCube=!0,_._texture=d,g[u]=_,s){case 0:e._lodTextureLow=_;break;case 1:e._lodTextureMid=_;break;case 2:e._lodTextureHigh=_}}}const y=[];for(let i=0;i<t.length;i++)for(let r=0;r<6;r++){const n=t[i][r],a=new Blob([n],{type:s}),o=URL.createObjectURL(a);let l;if(c._features.forceBitmapOverHTMLImageElement)l=c.createImageBitmap(a,{premultiplyAlpha:"none"}).then((t=>b(t,c,d,p,o,r,i,_,g,f,e)));else{const t=new Image;t.src=o,l=new Promise(((s,n)=>{t.onload=()=>{b(t,c,d,p,o,r,i,_,g,f,e).then((()=>s())).catch((e=>{n(e)}))},t.onerror=e=>{n(e)}}))}y.push(l)}if(t.length<a){let i;const r=Math.pow(2,a-1-t.length),s=r*r*4;switch(e.type){case 0:i=new Uint8Array(s);break;case 2:i=new Uint16Array(s);break;case 1:i=new Float32Array(s)}for(let n=t.length;n<a;n++)for(let t=0;t<6;t++)c._uploadArrayBufferViewToTexture(e,i,t,n)}return Promise.all(y).then((()=>{f&&(c._releaseTexture(e),f._swapAndDie(e)),p&&p.dispose(),_&&(e._lodTextureHigh&&e._lodTextureHigh._texture&&(e._lodTextureHigh._texture.isReady=!0),e._lodTextureMid&&e._lodTextureMid._texture&&(e._lodTextureMid._texture.isReady=!0),e._lodTextureLow&&e._lodTextureLow._texture&&(e._lodTextureLow._texture.isReady=!0))}))}function y(e,t){const i=(t=f(t)).irradiance;if(!i)return;const r=new a.Q;s.Pq.FromArrayToRef(i.x,0,r.x),s.Pq.FromArrayToRef(i.y,0,r.y),s.Pq.FromArrayToRef(i.z,0,r.z),s.Pq.FromArrayToRef(i.xx,0,r.xx),s.Pq.FromArrayToRef(i.yy,0,r.yy),s.Pq.FromArrayToRef(i.zz,0,r.zz),s.Pq.FromArrayToRef(i.yz,0,r.yz),s.Pq.FromArrayToRef(i.zx,0,r.zx),s.Pq.FromArrayToRef(i.xy,0,r.xy),e._sphericalPolynomial=r}class T{constructor(){this.supportCascades=!1}loadCubeData(e,t,i,r,s){if(Array.isArray(e))return;const n=p(e);if(n){t.width=n.width,t.height=n.width;try{y(t,n),m(t,e,n).then((()=>{t.isReady=!0,t.onLoadedObservable.notifyObservers(t),t.onLoadedObservable.clear(),r&&r()}),(e=>{s?.("Can not upload environment levels",e)}))}catch(a){s?.("Can not upload environment file",a)}}else s&&s("Can not parse the environment file",null)}loadData(){throw".env not supported in 2d."}}},8598:(e,t,i)=>{"use strict";i.r(t),i.d(t,{_KTXTextureLoader:()=>p});var r=i(8274);class s{constructor(e,t){if(this.data=e,this.isInvalid=!1,!s.IsValid(e))return this.isInvalid=!0,void r.V.Error("texture missing KTX identifier");const i=Uint32Array.BYTES_PER_ELEMENT,n=new DataView(this.data.buffer,this.data.byteOffset+12,13*i),a=67305985===n.getUint32(0,!0);return this.glType=n.getUint32(1*i,a),this.glTypeSize=n.getUint32(2*i,a),this.glFormat=n.getUint32(3*i,a),this.glInternalFormat=n.getUint32(4*i,a),this.glBaseInternalFormat=n.getUint32(5*i,a),this.pixelWidth=n.getUint32(6*i,a),this.pixelHeight=n.getUint32(7*i,a),this.pixelDepth=n.getUint32(8*i,a),this.numberOfArrayElements=n.getUint32(9*i,a),this.numberOfFaces=n.getUint32(10*i,a),this.numberOfMipmapLevels=n.getUint32(11*i,a),this.bytesOfKeyValueData=n.getUint32(12*i,a),0!==this.glType?(r.V.Error("only compressed formats currently supported"),void(this.isInvalid=!0)):(this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),0===this.pixelHeight||0!==this.pixelDepth?(r.V.Error("only 2D textures currently supported"),void(this.isInvalid=!0)):0!==this.numberOfArrayElements?(r.V.Error("texture arrays not currently supported"),void(this.isInvalid=!0)):this.numberOfFaces!==t?(r.V.Error("number of faces expected"+t+", but found "+this.numberOfFaces),void(this.isInvalid=!0)):void(this.loadType=s.COMPRESSED_2D))}uploadLevels(e,t){switch(this.loadType){case s.COMPRESSED_2D:this._upload2DCompressedLevels(e,t);case s.TEX_2D:case s.COMPRESSED_3D:case s.TEX_3D:}}_upload2DCompressedLevels(e,t){let i=s.HEADER_LEN+this.bytesOfKeyValueData,r=this.pixelWidth,n=this.pixelHeight;const a=t?this.numberOfMipmapLevels:1;for(let s=0;s<a;s++){const t=new Int32Array(this.data.buffer,this.data.byteOffset+i,1)[0];i+=4;for(let a=0;a<this.numberOfFaces;a++){const o=new Uint8Array(this.data.buffer,this.data.byteOffset+i,t);e.getEngine()._uploadCompressedDataToTextureDirectly(e,e.format,r,n,o,a,s),i+=t,i+=3-(t+3)%4}r=Math.max(1,.5*r),n=Math.max(1,.5*n)}}static IsValid(e){if(e.byteLength>=12){const t=new Uint8Array(e.buffer,e.byteOffset,12);if(171===t[0]&&75===t[1]&&84===t[2]&&88===t[3]&&32===t[4]&&49===t[5]&&49===t[6]&&187===t[7]&&13===t[8]&&10===t[9]&&26===t[10]&&10===t[11])return!0}return!1}}s.HEADER_LEN=64,s.COMPRESSED_2D=0,s.COMPRESSED_3D=1,s.TEX_2D=2,s.TEX_3D=3;class n{constructor(e){this._pendingActions=new Array,this._workerInfos=e.map((e=>({workerPromise:Promise.resolve(e),idle:!0})))}dispose(){for(const e of this._workerInfos)e.workerPromise.then((e=>{e.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(e){this._executeOnIdleWorker(e)||this._pendingActions.push(e)}_executeOnIdleWorker(e){for(const t of this._workerInfos)if(t.idle)return this._execute(t,e),!0;return!1}_execute(e,t){e.idle=!1,e.workerPromise.then((i=>{t(i,(()=>{const t=this._pendingActions.shift();t?this._execute(e,t):e.idle=!0}))}))}}class a extends n{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.DefaultOptions;super([]),this._maxWorkers=e,this._createWorkerAsync=t,this._options=i}push(e){if(!this._executeOnIdleWorker(e))if(this._workerInfos.length<this._maxWorkers){const t={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(t),this._execute(t,e)}else this._pendingActions.push(e)}_execute(e,t){e.timeoutId&&(clearTimeout(e.timeoutId),delete e.timeoutId),super._execute(e,((i,r)=>{t(i,(()=>{r(),e.idle&&(e.timeoutId=setTimeout((()=>{e.workerPromise.then((e=>{e.terminate()}));const t=this._workerInfos.indexOf(e);-1!==t&&this._workerInfos.splice(t,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}a.DefaultOptions={idleTimeElapsedBeforeRelease:1e3};var o,l,h,c=i(543);function u(e,t){const i=t?.jsDecoderModule||KTX2DECODER;e&&(e.wasmUASTCToASTC&&(i.LiteTranscoder_UASTC_ASTC.WasmModuleURL=e.wasmUASTCToASTC),e.wasmUASTCToBC7&&(i.LiteTranscoder_UASTC_BC7.WasmModuleURL=e.wasmUASTCToBC7),e.wasmUASTCToRGBA_UNORM&&(i.LiteTranscoder_UASTC_RGBA_UNORM.WasmModuleURL=e.wasmUASTCToRGBA_UNORM),e.wasmUASTCToRGBA_SRGB&&(i.LiteTranscoder_UASTC_RGBA_SRGB.WasmModuleURL=e.wasmUASTCToRGBA_SRGB),e.wasmUASTCToR8_UNORM&&(i.LiteTranscoder_UASTC_R8_UNORM.WasmModuleURL=e.wasmUASTCToR8_UNORM),e.wasmUASTCToRG8_UNORM&&(i.LiteTranscoder_UASTC_RG8_UNORM.WasmModuleURL=e.wasmUASTCToRG8_UNORM),e.jsMSCTranscoder&&(i.MSCTranscoder.JSModuleURL=e.jsMSCTranscoder),e.wasmMSCTranscoder&&(i.MSCTranscoder.WasmModuleURL=e.wasmMSCTranscoder),e.wasmZSTDDecoder&&(i.ZSTDDecoder.WasmModuleURL=e.wasmZSTDDecoder)),t&&(t.wasmUASTCToASTC&&(i.LiteTranscoder_UASTC_ASTC.WasmBinary=t.wasmUASTCToASTC),t.wasmUASTCToBC7&&(i.LiteTranscoder_UASTC_BC7.WasmBinary=t.wasmUASTCToBC7),t.wasmUASTCToRGBA_UNORM&&(i.LiteTranscoder_UASTC_RGBA_UNORM.WasmBinary=t.wasmUASTCToRGBA_UNORM),t.wasmUASTCToRGBA_SRGB&&(i.LiteTranscoder_UASTC_RGBA_SRGB.WasmBinary=t.wasmUASTCToRGBA_SRGB),t.wasmUASTCToR8_UNORM&&(i.LiteTranscoder_UASTC_R8_UNORM.WasmBinary=t.wasmUASTCToR8_UNORM),t.wasmUASTCToRG8_UNORM&&(i.LiteTranscoder_UASTC_RG8_UNORM.WasmBinary=t.wasmUASTCToRG8_UNORM),t.jsMSCTranscoder&&(i.MSCTranscoder.JSModule=t.jsMSCTranscoder),t.wasmMSCTranscoder&&(i.MSCTranscoder.WasmBinary=t.wasmMSCTranscoder),t.wasmZSTDDecoder&&(i.ZSTDDecoder.WasmBinary=t.wasmZSTDDecoder))}function d(e){let t;"undefined"===typeof e&&"undefined"!==typeof KTX2DECODER&&(e=KTX2DECODER),onmessage=i=>{if(i.data)switch(i.data.action){case"init":{const r=i.data.urls;r&&(r.jsDecoderModule&&"undefined"===typeof e&&(importScripts(r.jsDecoderModule),e=KTX2DECODER),u(r)),i.data.wasmBinaries&&u(void 0,{...i.data.wasmBinaries,jsDecoderModule:e}),t=new e.KTX2Decoder,postMessage({action:"init"});break}case"setDefaultDecoderOptions":e.KTX2Decoder.DefaultDecoderOptions=i.data.options;break;case"decode":t.decode(i.data.data,i.data.caps,i.data.options).then((e=>{const t=[];for(let i=0;i<e.mipmaps.length;++i){const r=e.mipmaps[i];r&&r.data&&t.push(r.data.buffer)}postMessage({action:"decoded",success:!0,decodedData:e},t)})).catch((e=>{postMessage({action:"decoded",success:!1,msg:e})}))}}}!function(e){e[e.ETC1S=0]="ETC1S",e[e.UASTC4x4=1]="UASTC4x4"}(o||(o={})),function(e){e[e.ASTC_4X4_RGBA=0]="ASTC_4X4_RGBA",e[e.BC7_RGBA=1]="BC7_RGBA",e[e.BC3_RGBA=2]="BC3_RGBA",e[e.BC1_RGB=3]="BC1_RGB",e[e.PVRTC1_4_RGBA=4]="PVRTC1_4_RGBA",e[e.PVRTC1_4_RGB=5]="PVRTC1_4_RGB",e[e.ETC2_RGBA=6]="ETC2_RGBA",e[e.ETC1_RGB=7]="ETC1_RGB",e[e.RGBA32=8]="RGBA32",e[e.R8=9]="R8",e[e.RG8=10]="RG8"}(l||(l={})),function(e){e[e.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",e[e.COMPRESSED_RGBA_ASTC_4X4_KHR=37808]="COMPRESSED_RGBA_ASTC_4X4_KHR",e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.RGBA8Format=32856]="RGBA8Format",e[e.R8Format=33321]="R8Format",e[e.RG8Format=33323]="RG8Format"}(h||(h={}));class _{static GetDefaultNumWorkers(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}static _Initialize(e){if(_._WorkerPoolPromise||_._DecoderModulePromise)return;const t={jsDecoderModule:c.S0.GetBabylonScriptURL(this.URLConfig.jsDecoderModule,!0),wasmUASTCToASTC:c.S0.GetBabylonScriptURL(this.URLConfig.wasmUASTCToASTC,!0),wasmUASTCToBC7:c.S0.GetBabylonScriptURL(this.URLConfig.wasmUASTCToBC7,!0),wasmUASTCToRGBA_UNORM:c.S0.GetBabylonScriptURL(this.URLConfig.wasmUASTCToRGBA_UNORM,!0),wasmUASTCToRGBA_SRGB:c.S0.GetBabylonScriptURL(this.URLConfig.wasmUASTCToRGBA_SRGB,!0),wasmUASTCToR8_UNORM:c.S0.GetBabylonScriptURL(this.URLConfig.wasmUASTCToR8_UNORM,!0),wasmUASTCToRG8_UNORM:c.S0.GetBabylonScriptURL(this.URLConfig.wasmUASTCToRG8_UNORM,!0),jsMSCTranscoder:c.S0.GetBabylonScriptURL(this.URLConfig.jsMSCTranscoder,!0),wasmMSCTranscoder:c.S0.GetBabylonScriptURL(this.URLConfig.wasmMSCTranscoder,!0),wasmZSTDDecoder:c.S0.GetBabylonScriptURL(this.URLConfig.wasmZSTDDecoder,!0)};e&&"function"===typeof Worker&&"undefined"!==typeof URL?_._WorkerPoolPromise=new Promise((i=>{const r=`${u}(${d})()`,s=URL.createObjectURL(new Blob([r],{type:"application/javascript"}));i(new a(e,(()=>function(e,t,i){return new Promise(((r,s)=>{const n=t=>{e.removeEventListener("error",n),e.removeEventListener("message",a),s(t)},a=t=>{"init"===t.data.action&&(e.removeEventListener("error",n),e.removeEventListener("message",a),r(e))};e.addEventListener("error",n),e.addEventListener("message",a),e.postMessage({action:"init",urls:i,wasmBinaries:t})}))}(new Worker(s),void 0,t))))})):"undefined"===typeof _._KTX2DecoderModule?_._DecoderModulePromise=c.S0.LoadBabylonScriptAsync(t.jsDecoderModule).then((()=>(_._KTX2DecoderModule=KTX2DECODER,_._KTX2DecoderModule.MSCTranscoder.UseFromWorkerThread=!1,_._KTX2DecoderModule.WASMMemoryManager.LoadBinariesFromCurrentThread=!0,u(t,_._KTX2DecoderModule),new _._KTX2DecoderModule.KTX2Decoder))):(_._KTX2DecoderModule.MSCTranscoder.UseFromWorkerThread=!1,_._KTX2DecoderModule.WASMMemoryManager.LoadBinariesFromCurrentThread=!0,_._DecoderModulePromise=Promise.resolve(new _._KTX2DecoderModule.KTX2Decoder))}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_.DefaultNumWorkers;this._engine=e;const i="object"===typeof t&&t.workerPool||_.WorkerPool;if(i)_._WorkerPoolPromise=Promise.resolve(i);else{"object"===typeof t?_._KTX2DecoderModule=t?.binariesAndModulesContainer?.jsDecoderModule:"undefined"!==typeof KTX2DECODER&&(_._KTX2DecoderModule=KTX2DECODER);const e="number"===typeof t?t:t.numWorkers??_.DefaultNumWorkers;_._Initialize(e)}}_uploadAsync(e,t,i){const r=this._engine.getCaps(),s={astc:!!r.astc,bptc:!!r.bptc,s3tc:!!r.s3tc,pvrtc:!!r.pvrtc,etc2:!!r.etc2,etc1:!!r.etc1};if(_._WorkerPoolPromise)return _._WorkerPoolPromise.then((r=>new Promise(((n,a)=>{r.push(((r,o)=>{const l=e=>{r.removeEventListener("error",l),r.removeEventListener("message",h),a(e),o()},h=e=>{if("decoded"===e.data.action){if(r.removeEventListener("error",l),r.removeEventListener("message",h),e.data.success)try{this._createTexture(e.data.decodedData,t,i),n()}catch(s){a({message:s})}else a({message:e.data.msg});o()}};r.addEventListener("error",l),r.addEventListener("message",h),r.postMessage({action:"setDefaultDecoderOptions",options:_.DefaultDecoderOptions._getKTX2DecoderOptions()});const c=new Uint8Array(e.byteLength);c.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),r.postMessage({action:"decode",data:c,caps:s,options:i},[c.buffer])}))}))));if(_._DecoderModulePromise)return _._DecoderModulePromise.then((i=>(_.DefaultDecoderOptions.isDirty&&(_._KTX2DecoderModule.KTX2Decoder.DefaultDecoderOptions=_.DefaultDecoderOptions._getKTX2DecoderOptions()),new Promise(((s,n)=>{i.decode(e,r).then((e=>{this._createTexture(e,t),s()})).catch((e=>{n({message:e})}))})))));throw new Error("KTX2 decoder module is not available")}_createTexture(e,t,i){this._engine._bindTextureDirectly(3553,t),i&&(i.transcodedFormat=e.transcodedFormat,i.isInGammaSpace=e.isInGammaSpace,i.hasAlpha=e.hasAlpha,i.transcoderName=e.transcoderName);let r=!0;switch(e.transcodedFormat){case 32856:t.type=0,t.format=5;break;case 33321:t.type=0,t.format=6;break;case 33323:t.type=0,t.format=7;break;default:t.format=e.transcodedFormat,r=!1}if(t._gammaSpace=e.isInGammaSpace,t.generateMipMaps=e.mipmaps.length>1,e.errors)throw new Error("KTX2 container - could not transcode the data. "+e.errors);for(let s=0;s<e.mipmaps.length;++s){const i=e.mipmaps[s];if(!i||!i.data)throw new Error("KTX2 container - could not transcode one of the image");r?(t.width=i.width,t.height=i.height,this._engine._uploadDataToTextureDirectly(t,i.data,0,s,void 0,!0)):this._engine._uploadCompressedDataToTextureDirectly(t,e.transcodedFormat,i.width,i.height,i.data,0,s)}t._extension=".ktx2",t.width=e.mipmaps[0].width,t.height=e.mipmaps[0].height,t.isReady=!0,this._engine._bindTextureDirectly(3553,null)}static IsValid(e){if(e.byteLength>=12){const t=new Uint8Array(e.buffer,e.byteOffset,12);if(171===t[0]&&75===t[1]&&84===t[2]&&88===t[3]&&32===t[4]&&50===t[5]&&48===t[6]&&187===t[7]&&13===t[8]&&10===t[9]&&26===t[10]&&10===t[11])return!0}return!1}}_.URLConfig={jsDecoderModule:"https://cdn.babylonjs.com/babylon.ktx2Decoder.js",wasmUASTCToASTC:null,wasmUASTCToBC7:null,wasmUASTCToRGBA_UNORM:null,wasmUASTCToRGBA_SRGB:null,wasmUASTCToR8_UNORM:null,wasmUASTCToRG8_UNORM:null,jsMSCTranscoder:null,wasmMSCTranscoder:null,wasmZSTDDecoder:null},_.DefaultNumWorkers=_.GetDefaultNumWorkers(),_.DefaultDecoderOptions=new class{constructor(){this._isDirty=!0,this._useRGBAIfOnlyBC1BC3AvailableWhenUASTC=!0,this._ktx2DecoderOptions={}}get isDirty(){return this._isDirty}get useRGBAIfASTCBC7NotAvailableWhenUASTC(){return this._useRGBAIfASTCBC7NotAvailableWhenUASTC}set useRGBAIfASTCBC7NotAvailableWhenUASTC(e){this._useRGBAIfASTCBC7NotAvailableWhenUASTC!==e&&(this._useRGBAIfASTCBC7NotAvailableWhenUASTC=e,this._isDirty=!0)}get useRGBAIfOnlyBC1BC3AvailableWhenUASTC(){return this._useRGBAIfOnlyBC1BC3AvailableWhenUASTC}set useRGBAIfOnlyBC1BC3AvailableWhenUASTC(e){this._useRGBAIfOnlyBC1BC3AvailableWhenUASTC!==e&&(this._useRGBAIfOnlyBC1BC3AvailableWhenUASTC=e,this._isDirty=!0)}get forceRGBA(){return this._forceRGBA}set forceRGBA(e){this._forceRGBA!==e&&(this._forceRGBA=e,this._isDirty=!0)}get forceR8(){return this._forceR8}set forceR8(e){this._forceR8!==e&&(this._forceR8=e,this._isDirty=!0)}get forceRG8(){return this._forceRG8}set forceRG8(e){this._forceRG8!==e&&(this._forceRG8=e,this._isDirty=!0)}get bypassTranscoders(){return this._bypassTranscoders}set bypassTranscoders(e){this._bypassTranscoders!==e&&(this._bypassTranscoders=e,this._isDirty=!0)}_getKTX2DecoderOptions(){if(!this._isDirty)return this._ktx2DecoderOptions;this._isDirty=!1;const e={useRGBAIfASTCBC7NotAvailableWhenUASTC:this._useRGBAIfASTCBC7NotAvailableWhenUASTC,forceRGBA:this._forceRGBA,forceR8:this._forceR8,forceRG8:this._forceRG8,bypassTranscoders:this._bypassTranscoders};return this.useRGBAIfOnlyBC1BC3AvailableWhenUASTC&&(e.transcodeFormatDecisionTree={UASTC:{transcodeFormat:[l.BC1_RGB,l.BC3_RGBA],yes:{transcodeFormat:l.RGBA32,engineFormat:32856,roundToMultiple4:!1}}}),this._ktx2DecoderOptions=e,e}};i(6952);class p{constructor(){this.supportCascades=!1}loadCubeData(e,t,i,r){if(Array.isArray(e))return;t._invertVScale=!t.invertY;const n=t.getEngine(),a=new s(e,6),o=a.numberOfMipmapLevels>1&&t.generateMipMaps;n._unpackFlipY(!0),a.uploadLevels(t,t.generateMipMaps),t.width=a.pixelWidth,t.height=a.pixelHeight,n._setCubeMapTextureParams(t,o,a.numberOfMipmapLevels-1),t.isReady=!0,t.onLoadedObservable.notifyObservers(t),t.onLoadedObservable.clear(),r&&r()}loadData(e,t,i,n){if(s.IsValid(e)){t._invertVScale=!t.invertY;const r=new s(e,1),n=function(e){switch(e){case 35916:return 33776;case 35918:return 33778;case 35919:return 33779;case 37493:return 37492;case 37497:return 37496;case 37495:return 37494;case 37840:return 37808;case 36493:return 36492}return null}(r.glInternalFormat);n?(t.format=n,t._useSRGBBuffer=t.getEngine()._getUseSRGBBuffer(!0,t.generateMipMaps),t._gammaSpace=!0):t.format=r.glInternalFormat,i(r.pixelWidth,r.pixelHeight,t.generateMipMaps,!0,(()=>{r.uploadLevels(t,t.generateMipMaps)}),r.isInvalid)}else if(_.IsValid(e)){new _(t.getEngine())._uploadAsync(e,t,n).then((()=>{i(t.width,t.height,t.generateMipMaps,!0,(()=>{}),!1)}),(e=>{r.V.Warn(`Failed to load KTX2 texture data: ${e.message}`),i(0,0,!1,!1,(()=>{}),!0)}))}else r.V.Error("texture missing KTX identifier"),i(0,0,!1,!1,(()=>{}),!0)}}},3961:(e,t,i)=>{"use strict";function r(e,t){return e.endsWith(".dds")?Promise.resolve().then(i.bind(i,6141)).then((e=>new e._DDSTextureLoader)):e.endsWith(".basis")?i.e(140).then(i.bind(i,4140)).then((e=>new e._BasisTextureLoader)):e.endsWith(".env")?Promise.resolve().then(i.bind(i,7189)).then((e=>new e._ENVTextureLoader)):e.endsWith(".hdr")?i.e(853).then(i.bind(i,4853)).then((e=>new e._HDRTextureLoader)):e.endsWith(".ktx")||e.endsWith(".ktx2")||"image/ktx"===t||"image/ktx2"===t?Promise.resolve().then(i.bind(i,8598)).then((e=>new e._KTXTextureLoader)):e.endsWith(".tga")?i.e(677).then(i.bind(i,677)).then((e=>new e._TGATextureLoader)):e.endsWith(".exr")?i.e(116).then(i.bind(i,8116)).then((e=>new e._ExrTextureLoader)):null}i.d(t,{g:()=>r})},1119:(e,t,i)=>{"use strict";i.d(t,{t:()=>d});var r=i(6379),s=i(7376),n=i(5491),a=i(5968),o=i(4072),l=i(7999),h=(i(242),i(3518));class c{get wrapU(){return this._wrapU}set wrapU(e){this._wrapU=e}get wrapV(){return this._wrapV}set wrapV(e){this._wrapV=e}get coordinatesMode(){return 0}get isCube(){return!!this._texture&&this._texture.isCube}set isCube(e){this._texture&&(this._texture.isCube=e)}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(e){this._texture&&(this._texture.is3D=e)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(e){this._texture&&(this._texture.is2DArray=e)}getClassName(){return"ThinTexture"}static _IsRenderTargetWrapper(e){return void 0!==e?.shareDepth}constructor(e){this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=h.o.Zero(),this._cachedBaseSize=h.o.Zero(),this._initialSamplingMode=2,this._texture=c._IsRenderTargetWrapper(e)?e.texture:e,this._texture&&(this._engine=this._texture.getEngine())}isReady(){return 4===this.delayLoadState?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady}delayLoad(){}getInternalTexture(){return this._texture}getSize(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize}getBaseSize(){return this.isReady()&&this._texture?this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize):(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize)}get samplingMode(){return this._texture?this._texture.samplingMode:this._initialSamplingMode}updateSamplingMode(e){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(e,this._texture)}releaseInternalTexture(){this._texture&&(this._texture.dispose(),this._texture=null)}dispose(){this._texture&&(this.releaseInternalTexture(),this._engine=null)}}var u=i(818);i(6371);class d extends c{set hasAlpha(e){this._hasAlpha!==e&&(this._hasAlpha=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this))))}get hasAlpha(){return this._hasAlpha}set getAlphaFromRGB(e){this._getAlphaFromRGB!==e&&(this._getAlphaFromRGB=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this))))}get getAlphaFromRGB(){return this._getAlphaFromRGB}set coordinatesIndex(e){this._coordinatesIndex!==e&&(this._coordinatesIndex=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this))))}get coordinatesIndex(){return this._coordinatesIndex}set coordinatesMode(e){this._coordinatesMode!==e&&(this._coordinatesMode=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this))))}get coordinatesMode(){return this._coordinatesMode}get wrapU(){return this._wrapU}set wrapU(e){this._wrapU=e}get wrapV(){return this._wrapV}set wrapV(e){this._wrapV=e}get isCube(){return this._texture?this._texture.isCube:this._isCube}set isCube(e){this._texture?this._texture.isCube=e:this._isCube=e}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(e){this._texture&&(this._texture.is3D=e)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(e){this._texture&&(this._texture.is2DArray=e)}get gammaSpace(){return this._texture?(null===this._texture._gammaSpace&&(this._texture._gammaSpace=this._gammaSpace),this._texture._gammaSpace&&!this._texture._useSRGBBuffer):this._gammaSpace}set gammaSpace(e){if(this._texture){if(this._texture._gammaSpace===e)return;this._texture._gammaSpace=e}else{if(this._gammaSpace===e)return;this._gammaSpace=e}this.getScene()?.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this)))}get isRGBD(){return null!=this._texture&&this._texture._isRGBD}set isRGBD(e){e!==this.isRGBD&&(this._texture&&(this._texture._isRGBD=e),this.getScene()?.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this))))}get noMipmap(){return!1}get lodGenerationOffset(){return this._texture?this._texture._lodGenerationOffset:0}set lodGenerationOffset(e){this._texture&&(this._texture._lodGenerationOffset=e)}get lodGenerationScale(){return this._texture?this._texture._lodGenerationScale:0}set lodGenerationScale(e){this._texture&&(this._texture._lodGenerationScale=e)}get linearSpecularLOD(){return!!this._texture&&this._texture._linearSpecularLOD}set linearSpecularLOD(e){this._texture&&(this._texture._linearSpecularLOD=e)}get irradianceTexture(){return this._texture?this._texture._irradianceTexture:null}set irradianceTexture(e){this._texture&&(this._texture._irradianceTexture=e)}get uid(){return this._uid||(this._uid=(0,l.z)()),this._uid}toString(){return this.name}getClassName(){return"BaseTexture"}set onDispose(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}get isBlocking(){return!0}get loadingError(){return this._loadingError}get errorObject(){return this._errorObject}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(null),this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this._getAlphaFromRGB=!1,this.level=1,this._coordinatesIndex=0,this.optimizeUVAllocation=!0,this._coordinatesMode=0,this.wrapR=1,this.anisotropicFilteringLevel=d.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this._isCube=!1,this._gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this.isRenderTarget=!1,this._prefiltered=!1,this._forceSerialize=!1,this.animations=[],this.onDisposeObservable=new n.cP,this._onDisposeObserver=null,this._scene=null,this._uid=null,this._parentContainer=null,this._loadingError=!1,e?d._IsScene(e)?this._scene=e:this._engine=e:this._scene=o.q.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this),this._engine=this._scene.getEngine()),this._texture=t,this._uid=null}getScene(){return this._scene}_getEngine(){return this._engine}getTextureMatrix(){return a.uq.IdentityReadOnly}getReflectionTextureMatrix(){return a.uq.IdentityReadOnly}getRefractionTextureMatrix(){return this.getReflectionTextureMatrix()}isReadyOrNotBlocking(){return!this.isBlocking||this.isReady()||this.loadingError}scale(e){}get canRescale(){return!1}_getFromCache(e,t,i,r,s,n){const a=this._getEngine();if(!a)return null;const o=a._getUseSRGBBuffer(!!s,t),l=a.getLoadedTexturesCache();for(let h=0;h<l.length;h++){const a=l[h];if((void 0===s||o===a._useSRGBBuffer)&&(void 0===r||r===a.invertY)&&a.url===e&&a.generateMipMaps===!t&&(!i||i===a.samplingMode)&&(void 0===n||n===a.isCube))return a.incrementReferences(),a}return null}_rebuild(){}clone(){return null}get textureType(){return this._texture&&void 0!==this._texture.type?this._texture.type:0}get textureFormat(){return this._texture&&void 0!==this._texture.format?this._texture.format:5}_markAllSubMeshesAsTexturesDirty(){const e=this.getScene();e&&e.markAllMaterialsAsDirty(1)}readPixels(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Number.MAX_VALUE,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Number.MAX_VALUE;if(!this._texture)return null;const h=this._getEngine();if(!h)return null;const c=this.getSize();let u=c.width,d=c.height;0!==t&&(u/=Math.pow(2,t),d/=Math.pow(2,t),u=Math.round(u),d=Math.round(d)),o=Math.min(u,o),l=Math.min(d,l);try{return this._texture.isCube?h._readTexturePixels(this._texture,o,l,e,t,i,r,s,n,a):h._readTexturePixels(this._texture,o,l,-1,t,i,r,s,n,a)}catch(_){return null}}_readPixelsSync(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!this._texture)return null;const n=this.getSize();let a=n.width,o=n.height;const l=this._getEngine();if(!l)return null;0!=t&&(a/=Math.pow(2,t),o/=Math.pow(2,t),a=Math.round(a),o=Math.round(o));try{return this._texture.isCube?l._readTexturePixelsSync(this._texture,a,o,e,t,i,r,s):l._readTexturePixelsSync(this._texture,a,o,-1,t,i,r,s)}catch(h){return null}}get _lodTextureHigh(){return this._texture?this._texture._lodTextureHigh:null}get _lodTextureMid(){return this._texture?this._texture._lodTextureMid:null}get _lodTextureLow(){return this._texture?this._texture._lodTextureLow:null}dispose(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene.removePendingData(this);const e=this._scene.textures.indexOf(this);if(e>=0&&this._scene.textures.splice(e,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){const e=this._parentContainer.textures.indexOf(this);e>-1&&this._parentContainer.textures.splice(e,1),this._parentContainer=null}}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.metadata=null,super.dispose()}serialize(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.name&&!e)return null;const t=u.p.Serialize(this);return u.p.AppendSerializedAnimations(this,t),t}static WhenAllReady(e,t){let i=e.length;if(0!==i)for(let r=0;r<e.length;r++){const s=e[r];if(s.isReady())0===--i&&t();else{const e=s.onLoadObservable;e?e.addOnce((()=>{0===--i&&t()})):0===--i&&t()}}else t()}static _IsScene(e){return"Scene"===e.getClassName()}}d.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,(0,r.Cg)([(0,s.lK)()],d.prototype,"uniqueId",void 0),(0,r.Cg)([(0,s.lK)()],d.prototype,"name",void 0),(0,r.Cg)([(0,s.lK)()],d.prototype,"metadata",void 0),(0,r.Cg)([(0,s.lK)("hasAlpha")],d.prototype,"_hasAlpha",void 0),(0,r.Cg)([(0,s.lK)("getAlphaFromRGB")],d.prototype,"_getAlphaFromRGB",void 0),(0,r.Cg)([(0,s.lK)()],d.prototype,"level",void 0),(0,r.Cg)([(0,s.lK)("coordinatesIndex")],d.prototype,"_coordinatesIndex",void 0),(0,r.Cg)([(0,s.lK)()],d.prototype,"optimizeUVAllocation",void 0),(0,r.Cg)([(0,s.lK)("coordinatesMode")],d.prototype,"_coordinatesMode",void 0),(0,r.Cg)([(0,s.lK)()],d.prototype,"wrapU",null),(0,r.Cg)([(0,s.lK)()],d.prototype,"wrapV",null),(0,r.Cg)([(0,s.lK)()],d.prototype,"wrapR",void 0),(0,r.Cg)([(0,s.lK)()],d.prototype,"anisotropicFilteringLevel",void 0),(0,r.Cg)([(0,s.lK)()],d.prototype,"isCube",null),(0,r.Cg)([(0,s.lK)()],d.prototype,"is3D",null),(0,r.Cg)([(0,s.lK)()],d.prototype,"is2DArray",null),(0,r.Cg)([(0,s.lK)()],d.prototype,"gammaSpace",null),(0,r.Cg)([(0,s.lK)()],d.prototype,"invertZ",void 0),(0,r.Cg)([(0,s.lK)()],d.prototype,"lodLevelInAlpha",void 0),(0,r.Cg)([(0,s.lK)()],d.prototype,"lodGenerationOffset",null),(0,r.Cg)([(0,s.lK)()],d.prototype,"lodGenerationScale",null),(0,r.Cg)([(0,s.lK)()],d.prototype,"linearSpecularLOD",null),(0,r.Cg)([(0,s.uM)()],d.prototype,"irradianceTexture",null),(0,r.Cg)([(0,s.lK)()],d.prototype,"isRenderTarget",void 0)},1335:(e,t,i)=>{"use strict";var r=i(4854),s=i(1119);s.t.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(s.t.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=r.d.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((e=>{this._texture._sphericalPolynomial=e,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(e){this._texture&&(this._texture._sphericalPolynomial=e)},enumerable:!0,configurable:!0})},8665:(e,t,i)=>{"use strict";i.d(t,{h:()=>a});var r,s=i(5491);class n{get wrapU(){return this._cachedWrapU}set wrapU(e){this._cachedWrapU=e}get wrapV(){return this._cachedWrapV}set wrapV(e){this._cachedWrapV=e}get wrapR(){return this._cachedWrapR}set wrapR(e){this._cachedWrapR=e}get anisotropicFilteringLevel(){return this._cachedAnisotropicFilteringLevel}set anisotropicFilteringLevel(e){this._cachedAnisotropicFilteringLevel=e}get comparisonFunction(){return this._comparisonFunction}set comparisonFunction(e){this._comparisonFunction=e}get useMipMaps(){return this._useMipMaps}set useMipMaps(e){this._useMipMaps=e}constructor(){this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}setParameters(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return this._cachedWrapU=e,this._cachedWrapV=t,this._cachedWrapR=i,this._cachedAnisotropicFilteringLevel=r,this.samplingMode=s,this._comparisonFunction=n,this}compareSampler(e){return this._cachedWrapU===e._cachedWrapU&&this._cachedWrapV===e._cachedWrapV&&this._cachedWrapR===e._cachedWrapR&&this._cachedAnisotropicFilteringLevel===e._cachedAnisotropicFilteringLevel&&this.samplingMode===e.samplingMode&&this._comparisonFunction===e._comparisonFunction&&this._useMipMaps===e._useMipMaps}}!function(e){e[e.Unknown=0]="Unknown",e[e.Url=1]="Url",e[e.Temp=2]="Temp",e[e.Raw=3]="Raw",e[e.Dynamic=4]="Dynamic",e[e.RenderTarget=5]="RenderTarget",e[e.MultiRenderTarget=6]="MultiRenderTarget",e[e.Cube=7]="Cube",e[e.CubeRaw=8]="CubeRaw",e[e.CubePrefiltered=9]="CubePrefiltered",e[e.Raw3D=10]="Raw3D",e[e.Raw2DArray=11]="Raw2DArray",e[e.DepthStencil=12]="DepthStencil",e[e.CubeRawRGBD=13]="CubeRawRGBD",e[e.Depth=14]="Depth"}(r||(r={}));class a extends n{get useMipMaps(){return this.generateMipMaps}set useMipMaps(e){this.generateMipMaps=e}get uniqueId(){return this._uniqueId}_setUniqueId(e){this._uniqueId=e}getEngine(){return this._engine}get source(){return this._source}constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new s.cP,this.onErrorObservable=new s.cP,this.onRebuildCallback=null,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=0,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._cachedCoordinatesMode=null,this._isDisabled=!1,this._compression=null,this._sphericalPolynomial=null,this._sphericalPolynomialPromise=null,this._sphericalPolynomialComputed=!1,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._useSRGBBuffer=!1,this._creationFlags=0,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._hardwareTexture=null,this._maxLodLevel=null,this._references=1,this._gammaSpace=null,this._premulAlpha=!1,this._dynamicTextureSource=null,this._engine=e,this._source=t,this._uniqueId=a._Counter++,i||(this._hardwareTexture=e._createHardwareTexture())}incrementReferences(){this._references++}updateSize(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this._engine.updateTextureDimensions(this,e,t,i),this.width=e,this.height=t,this.depth=i,this.baseWidth=e,this.baseHeight=t,this.baseDepth=i,this._size=e*t*i}_rebuild(){if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback){const e=this.onRebuildCallback(this),t=t=>{t._swapAndDie(this,!1),this.isReady=e.isReady};return void(e.isAsync?e.proxy.then(t):t(e.proxy))}let e;switch(this.source){case 2:case 12:case 14:break;case 1:return void(e=this._engine.createTexture(this._originalUrl??this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,(e=>{e._swapAndDie(this,!1),this.isReady=!0}),null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer));case 3:e=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,this._creationFlags,this._useSRGBBuffer),e._swapAndDie(this,!1),this.isReady=!0;break;case 10:e=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),e._swapAndDie(this,!1),this.isReady=!0;break;case 11:e=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),e._swapAndDie(this,!1),this.isReady=!0;break;case 4:e=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode),e._swapAndDie(this,!1),this._dynamicTextureSource&&this._engine.updateDynamicTexture(this,this._dynamicTextureSource,this.invertY,this._premulAlpha,this.format,!0);break;case 7:return void(e=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,(()=>{e._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer,ArrayBuffer.isView(this._buffer)?this._buffer:null));case 8:e=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this._originalFormat??this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),e._swapAndDie(this,!1),this.isReady=!0;break;case 13:return;case 9:return e=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,(e=>{e&&e._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension),void(e._sphericalPolynomial=this._sphericalPolynomial)}}_swapAndDie(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._hardwareTexture?.setUsage(e._source,this.generateMipMaps,this.is2DArray,this.isCube,this.is3D,this.width,this.height,this.depth),e._hardwareTexture=this._hardwareTexture,t&&(e._isRGBD=this._isRGBD),this._lodTextureHigh&&(e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(e._lodTextureLow&&e._lodTextureLow.dispose(),e._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(e._irradianceTexture&&e._irradianceTexture.dispose(),e._irradianceTexture=this._irradianceTexture);const i=this._engine.getLoadedTexturesCache();let r=i.indexOf(this);-1!==r&&i.splice(r,1),r=i.indexOf(e),-1===r&&i.push(e)}dispose(){this._references--,this.onLoadedObservable.clear(),this.onErrorObservable.clear(),0===this._references&&(this._engine._releaseTexture(this),this._hardwareTexture=null,this._dynamicTextureSource=null)}}a._Counter=0},1078:(e,t,i)=>{"use strict";i.d(t,{$:()=>u});var r=i(5491),s=i(5968),n=i(5415),a=i(7637),o=i(507);i(9289),i(9422);i(5887).w.prototype.setDepthStencilTexture=function(e,t,i,r){void 0!==e&&(t&&(this._boundUniforms[e]=t),i&&i.depthStencilTexture?this._setTexture(e,i,!1,!0,r):this._setTexture(e,null,void 0,void 0,r))};var l=i(4654),h=i(1909),c=i(4780);i(4909).M.prototype.setDepthStencilTexture=function(e,t){this._engine.setDepthStencilTexture(this._samplers[e],this._uniforms[e],t,e)};class u extends n.g{get renderList(){return this._renderList}set renderList(e){this._unObserveRenderList&&(this._unObserveRenderList(),this._unObserveRenderList=null),e&&(this._unObserveRenderList=(0,l.lL)(e,this._renderListHasChanged)),this._renderList=e}get postProcesses(){return this._postProcesses}get _prePassEnabled(){return!!this._prePassRenderTarget&&this._prePassRenderTarget.enabled}set onAfterUnbind(e){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(e)}set onBeforeRender(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)}set onAfterRender(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)}set onClear(e){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(e)}get renderPassIds(){return this._renderPassIds}get currentRefreshId(){return this._currentRefreshId}setMaterialForRendering(e,t){let i;i=Array.isArray(e)?e:[e];for(let r=0;r<i.length;++r)for(let e=0;e<this._renderPassIds.length;++e)i[r].setMaterialForRenderPass(this._renderPassIds[e],void 0!==t?Array.isArray(t)?t[e]:t:void 0)}get isMulti(){return this._renderTarget?.isMulti??!1}get renderTargetOptions(){return this._renderTargetOptions}get renderTarget(){return this._renderTarget}_onRatioRescale(){this._sizeRatio&&this.resize(this._initialSizeParameter)}set boundingBoxSize(e){if(this._boundingBoxSize&&this._boundingBoxSize.equals(e))return;this._boundingBoxSize=e;const t=this.getScene();t&&t.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}get depthStencilTexture(){return this._renderTarget?._depthStencilTexture??null}constructor(e,t,i){let a,l=arguments.length>3&&void 0!==arguments[3]&&arguments[3],h=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,u=arguments.length>6&&void 0!==arguments[6]&&arguments[6],d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:n.g.TRILINEAR_SAMPLINGMODE,_=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],p=arguments.length>9&&void 0!==arguments[9]&&arguments[9],f=arguments.length>10&&void 0!==arguments[10]&&arguments[10],g=arguments.length>11&&void 0!==arguments[11]?arguments[11]:5,m=arguments.length>12&&void 0!==arguments[12]&&arguments[12],b=arguments.length>13?arguments[13]:void 0,v=arguments.length>14?arguments[14]:void 0,y=arguments.length>15&&void 0!==arguments[15]&&arguments[15],T=arguments.length>16&&void 0!==arguments[16]&&arguments[16],x=!0;if("object"===typeof l){const e=l;l=!!e.generateMipMaps,h=e.doNotChangeAspectRatio??!0,c=e.type??0,u=!!e.isCube,d=e.samplingMode??n.g.TRILINEAR_SAMPLINGMODE,_=e.generateDepthBuffer??!0,p=!!e.generateStencilBuffer,f=!!e.isMulti,g=e.format??5,m=!!e.delayAllocation,b=e.samples,v=e.creationFlags,y=!!e.noColorAttachment,T=!!e.useSRGBBuffer,a=e.colorAttachment,x=e.gammaSpace??x}if(super(null,i,!l,void 0,d,void 0,void 0,void 0,void 0,g),this._unObserveRenderList=null,this._renderListHasChanged=(e,t)=>{const i=this._renderList?this._renderList.length:0;(0===t&&i>0||0===i)&&this.getScene()?.meshes.forEach((e=>{e._markSubMeshesAsLightDirty()}))},this.renderParticles=!0,this.renderSprites=!1,this.forceLayerMaskCheck=!1,this.ignoreCameraViewport=!1,this.onBeforeBindObservable=new r.cP,this.onAfterUnbindObservable=new r.cP,this.onBeforeRenderObservable=new r.cP,this.onAfterRenderObservable=new r.cP,this.onClearObservable=new r.cP,this.onResizeObservable=new r.cP,this._cleared=!1,this.skipInitialClear=!1,this._currentRefreshId=-1,this._refreshRate=1,this._samples=1,this._canRescale=!0,this._renderTarget=null,this.boundingBoxPosition=s.Pq.Zero(),!(i=this.getScene()))return;const A=this.getScene().getEngine();this._gammaSpace=x,this._coordinatesMode=n.g.PROJECTION_MODE,this.renderList=[],this.name=e,this.isRenderTarget=!0,this._initialSizeParameter=t,this._renderPassIds=[],this._isCubeData=u,this._processSizeParameter(t),this.renderPassId=this._renderPassIds[0],this._resizeObserver=A.onResizeObservable.add((()=>{})),this._generateMipMaps=!!l,this._doNotChangeAspectRatio=h,this._renderingManager=new o.m(i),this._renderingManager._useSceneAutoClearSetup=!0,f||(this._renderTargetOptions={generateMipMaps:l,type:c,format:this._format??void 0,samplingMode:this.samplingMode,generateDepthBuffer:_,generateStencilBuffer:p,samples:b,creationFlags:v,noColorAttachment:y,useSRGBBuffer:T,colorAttachment:a,label:this.name},this.samplingMode===n.g.NEAREST_SAMPLINGMODE&&(this.wrapU=n.g.CLAMP_ADDRESSMODE,this.wrapV=n.g.CLAMP_ADDRESSMODE),m||(u?(this._renderTarget=i.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions),this.coordinatesMode=n.g.INVCUBIC_MODE,this._textureMatrix=s.uq.Identity()):this._renderTarget=i.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==b&&(this.samples=b)))}createDepthStencilTexture(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,n=arguments.length>5?arguments[5]:void 0;this._renderTarget?.createDepthStencilTexture(e,t,i,r,s,n)}_releaseRenderPassId(){if(this._scene){const e=this._scene.getEngine();for(let t=0;t<this._renderPassIds.length;++t)e.releaseRenderPassId(this._renderPassIds[t])}this._renderPassIds=[]}_createRenderPassId(){this._releaseRenderPassId();const e=this._scene.getEngine(),t=this._isCubeData?6:this.getRenderLayers()||1;for(let i=0;i<t;++i)this._renderPassIds[i]=e.createRenderPassId(`RenderTargetTexture - ${this.name}#${i}`)}_processSizeParameter(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.ratio){this._sizeRatio=e.ratio;const t=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(t.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(t.getRenderHeight(),this._sizeRatio)}}else this._size=e;t&&this._createRenderPassId()}get samples(){return this._renderTarget?.samples??this._samples}set samples(e){this._renderTarget&&(this._samples=this._renderTarget.setSamples(e))}resetRefreshCounter(){this._currentRefreshId=-1}get refreshRate(){return this._refreshRate}set refreshRate(e){this._refreshRate=e,this.resetRefreshCounter()}addPostProcess(e){if(!this._postProcessManager){const e=this.getScene();if(!e)return;this._postProcessManager=new a.X(e),this._postProcesses=new Array}this._postProcesses.push(e),this._postProcesses[0].autoClear=!1}clearPostProcesses(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._postProcesses){if(e)for(const e of this._postProcesses)e.dispose();this._postProcesses=[]}}removePostProcess(e){if(!this._postProcesses)return;const t=this._postProcesses.indexOf(e);-1!==t&&(this._postProcesses.splice(t,1),this._postProcesses.length>0&&(this._postProcesses[0].autoClear=!1))}_shouldRender(){return-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)}getRenderSize(){return this.getRenderWidth()}getRenderWidth(){return this._size.width?this._size.width:this._size}getRenderHeight(){return this._size.width?this._size.height:this._size}getRenderLayers(){const e=this._size.layers;if(e)return e;const t=this._size.depth;return t||0}disableRescaling(){this._canRescale=!1}get canRescale(){return this._canRescale}scale(e){const t=Math.max(1,this.getRenderSize()*e);this.resize(t)}getReflectionTextureMatrix(){return this.isCube?this._textureMatrix:super.getReflectionTextureMatrix()}resize(e){const t=this.isCube;this._renderTarget?.dispose(),this._renderTarget=null;const i=this.getScene();i&&(this._processSizeParameter(e,!1),this._renderTarget=t?i.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):i.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==this._renderTargetOptions.samples&&(this.samples=this._renderTargetOptions.samples),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))}render(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._render(e,t)}isReadyForRendering(){return this._render(!1,!1,!0)}_render(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=this.getScene();if(!r)return i;const s=r.getEngine();if(void 0!==this.useCameraPostProcesses&&(e=this.useCameraPostProcesses),this._waitingRenderList){if(!this.renderListPredicate){this.renderList=[];for(let e=0;e<this._waitingRenderList.length;e++){const t=this._waitingRenderList[e],i=r.getMeshById(t);i&&this.renderList.push(i)}}this._waitingRenderList=void 0}if(this.renderListPredicate){this.renderList?this.renderList.length=0:this.renderList=[];const e=this.getScene();if(!e)return i;const t=e.meshes;for(let i=0;i<t.length;i++){const e=t[i];this.renderListPredicate(e)&&this.renderList.push(e)}}const n=s.currentRenderPassId;this.onBeforeBindObservable.notifyObservers(this);const a=this.activeCamera??r.activeCamera,o=r.activeCamera;a&&(a!==r.activeCamera&&(r.setTransformMatrix(a.getViewMatrix(),a.getProjectionMatrix(!0)),r.activeCamera=a),s.setViewport(a.rigParent?a.rigParent.viewport:a.viewport,this.getRenderWidth(),this.getRenderHeight())),this._defaultRenderListPrepared=!1;let l=i;if(i){r.getViewMatrix()||r.updateTransformMatrix();const e=this.is2DArray||this.is3D?this.getRenderLayers():this.isCube?6:1;for(let t=0;t<e&&l;t++){let e=null;const n=this.renderList?this.renderList:r.getActiveMeshes().data,a=this.renderList?this.renderList.length:r.getActiveMeshes().length;s.currentRenderPassId=this._renderPassIds[t],this.onBeforeRenderObservable.notifyObservers(t),this.getCustomRenderList&&(e=this.getCustomRenderList(t,n,a)),e||(e=n),this._doNotChangeAspectRatio||r.updateTransformMatrix(!0);for(let t=0;t<e.length&&l;++t){const r=e[t];if(r.isEnabled()&&!r.isBlocked&&r.isVisible&&r.subMeshes)if(this.customIsReadyFunction){if(!this.customIsReadyFunction(r,this.refreshRate,i)){l=!1;continue}}else if(!r.isReady(!0)){l=!1;continue}}this.onAfterRenderObservable.notifyObservers(t),(this.is2DArray||this.is3D||this.isCube)&&(r.incrementRenderId(),r.resetCachedMaterial())}}else if(!this.is2DArray&&!this.is3D||this.isMulti)if(this.isCube&&!this.isMulti)for(let h=0;h<6;h++)this._renderToTarget(h,e,t,void 0,a),r.incrementRenderId(),r.resetCachedMaterial();else this._renderToTarget(0,e,t,void 0,a);else for(let h=0;h<this.getRenderLayers();h++)this._renderToTarget(0,e,t,h,a),r.incrementRenderId(),r.resetCachedMaterial();return this.onAfterUnbindObservable.notifyObservers(this),s.currentRenderPassId=n,o&&(r.activeCamera=o,this.activeCamera&&this.activeCamera!==r.activeCamera&&r.setTransformMatrix(r.activeCamera.getViewMatrix(),r.activeCamera.getProjectionMatrix(!0)),s.setViewport(r.activeCamera.viewport)),r.resetCachedMaterial(),l}_bestReflectionRenderTargetDimension(e,t){const i=e*t,r=(0,c.OG)(i+16384/(128+i));return Math.min((0,c.C4)(e),r)}_prepareRenderingManager(e,t,i,r){const s=this.getScene();if(!s)return;this._renderingManager.reset();const n=s.getRenderId();for(let a=0;a<t;a++){const t=e[a];if(t&&!t.isBlocked){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(t,this.refreshRate,!1)){this.resetRefreshCounter();continue}}else if(!t.isReady(0===this.refreshRate)){this.resetRefreshCounter();continue}if(!t._internalAbstractMeshDataInfo._currentLODIsUpToDate&&s.activeCamera&&(t._internalAbstractMeshDataInfo._currentLOD=s.customLODSelector?s.customLODSelector(t,this.activeCamera||s.activeCamera):t.getLOD(this.activeCamera||s.activeCamera),t._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0),!t._internalAbstractMeshDataInfo._currentLOD)continue;let e,a=t._internalAbstractMeshDataInfo._currentLOD;if(a._preActivateForIntermediateRendering(n),e=!(!r||!i)&&0===(t.layerMask&i.layerMask),t.isEnabled()&&t.isVisible&&t.subMeshes&&!e){if(a!==t&&a._activate(n,!0),t._activate(n,!0)&&t.subMeshes.length){t.isAnInstance?t._internalAbstractMeshDataInfo._actAsRegularMesh&&(a=t):a._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,a._internalAbstractMeshDataInfo._isActiveIntermediate=!0;for(let e=0;e<a.subMeshes.length;e++){const t=a.subMeshes[e];this._renderingManager.dispatch(t,a)}}t._postActivate()}}}for(let a=0;a<s.particleSystems.length;a++){const e=s.particleSystems[a],t=e.emitter;e.isStarted()&&t&&(!t.position||t.isEnabled())&&this._renderingManager.dispatchParticles(e)}}_bindFrameBuffer(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=this.getScene();if(!i)return;const r=i.getEngine();this._renderTarget&&r.bindFramebuffer(this._renderTarget,this.isCube?e:void 0,void 0,void 0,this.ignoreCameraViewport,0,t)}_unbindFrameBuffer(e,t){this._renderTarget&&e.unBindFramebuffer(this._renderTarget,this.isCube,(()=>{this.onAfterRenderObservable.notifyObservers(t)}))}_prepareFrame(e,t,i,r){this._postProcessManager?this._prePassEnabled||this._postProcessManager._prepareFrame(this._texture,this._postProcesses):r&&e.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(t,i)}_renderToTarget(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const n=this.getScene();if(!n)return;const a=n.getEngine();a._debugPushGroup?.(`render to face #${e} layer #${r}`,1),this._prepareFrame(n,e,r,t),this.is2DArray||this.is3D?(a.currentRenderPassId=this._renderPassIds[r],this.onBeforeRenderObservable.notifyObservers(r)):(a.currentRenderPassId=this._renderPassIds[e],this.onBeforeRenderObservable.notifyObservers(e));if(a.snapshotRendering&&1===a.snapshotRenderingMode)this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(a):this.skipInitialClear||a.clear(this.clearColor||n.clearColor,!0,!0,!0);else{let o=null;const l=this.renderList?this.renderList:n.getActiveMeshes().data,c=this.renderList?this.renderList.length:n.getActiveMeshes().length;this.getCustomRenderList&&(o=this.getCustomRenderList(this.is2DArray||this.is3D?r:e,l,c)),o?this._prepareRenderingManager(o,o.length,s,this.forceLayerMaskCheck):(this._defaultRenderListPrepared||(this._prepareRenderingManager(l,c,s,!this.renderList||this.forceLayerMaskCheck),this._defaultRenderListPrepared=!0),o=l);for(const t of n._beforeRenderTargetClearStage)t.action(this,e,r);this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(a):this.skipInitialClear||a.clear(this.clearColor||n.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||n.updateTransformMatrix(!0);for(const t of n._beforeRenderTargetDrawStage)t.action(this,e,r);this._renderingManager.render(this.customRenderFunction,o,this.renderParticles,this.renderSprites);for(const t of n._afterRenderTargetDrawStage)t.action(this,e,r);const u=this._texture?.generateMipMaps??!1;this._texture&&(this._texture.generateMipMaps=!1),this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,e,this._postProcesses,this.ignoreCameraViewport):t&&n.postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,e);for(const t of n._afterRenderTargetPostProcessStage)t.action(this,e,r);this._texture&&(this._texture.generateMipMaps=u),this._doNotChangeAspectRatio||n.updateTransformMatrix(!0),i&&(0,h.yp)(this.getRenderWidth(),this.getRenderHeight(),a)}this._unbindFrameBuffer(a,e),this._texture&&this.isCube&&5===e&&a.generateMipMapsForCubemap(this._texture,!0),a._debugPopGroup?.(1)}setRenderingOrder(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(e,t,i,r)}setRenderingAutoClearDepthStencil(e,t){this._renderingManager.setRenderingAutoClearDepthStencil(e,t),this._renderingManager._useSceneAutoClearSetup=!1}clone(){const e=this.getSize(),t=new u(this.name,e,this.getScene(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer,void 0,this._renderTargetOptions.format,void 0,this._renderTargetOptions.samples);return t.hasAlpha=this.hasAlpha,t.level=this.level,t.coordinatesMode=this.coordinatesMode,this.renderList&&(t.renderList=this.renderList.slice(0)),t}serialize(){if(!this.name)return null;const e=super.serialize();if(e.renderTargetSize=this.getRenderSize(),e.renderList=[],this.renderList)for(let t=0;t<this.renderList.length;t++)e.renderList.push(this.renderList[t].id);return e}disposeFramebufferObjects(){this._renderTarget?.dispose(!0)}releaseInternalTexture(){this._renderTarget?.releaseTextures(),this._texture=null}dispose(){this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterRenderObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this.onBeforeRenderObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this._prePassRenderTarget&&this._prePassRenderTarget.dispose(),this._releaseRenderPassId(),this.clearPostProcesses(!0),this._resizeObserver&&(this.getScene().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.renderList=null;const e=this.getScene();if(!e)return;let t=e.customRenderTargets.indexOf(this);t>=0&&e.customRenderTargets.splice(t,1);for(const i of e.cameras)t=i.customRenderTargets.indexOf(this),t>=0&&i.customRenderTargets.splice(t,1);this._renderTarget?.dispose(),this._renderTarget=null,this._texture=null,super.dispose()}_rebuild(){this.refreshRate===u.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=u.REFRESHRATE_RENDER_ONCE),this._postProcessManager&&this._postProcessManager._rebuild()}freeRenderingGroups(){this._renderingManager&&this._renderingManager.freeRenderingGroups()}getViewCount(){return 1}}u.REFRESHRATE_RENDER_ONCE=0,u.REFRESHRATE_RENDER_ONEVERYFRAME=1,u.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,n.g._CreateRenderTargetTexture=(e,t,i,r,s)=>new u(e,t,i,r)},5415:(e,t,i)=>{"use strict";i.d(t,{g:()=>v});var r=i(6379),s=i(7376),n=i(5491),a=i(5968),o=i(1119),l=i(4141),h=i(6984),c=i(9581),u=i(5010),d=i(5017),_=i(7524);function p(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=t.width,s=t.height;if(e instanceof Float32Array){let t=e.byteLength/e.BYTES_PER_ELEMENT;const i=new Uint8Array(t);for(;--t>=0;){let r=e[t];r<0?r=0:r>1&&(r=1),i[t]=255*r}e=i}const n=document.createElement("canvas");n.width=r,n.height=s;const a=n.getContext("2d");if(!a)return null;const o=a.createImageData(r,s);if(o.data.set(e),a.putImageData(o,0,0),i){const e=document.createElement("canvas");e.width=r,e.height=s;const t=e.getContext("2d");return t?(t.translate(0,s),t.scale(1,-1),t.drawImage(n,0,0),e.toDataURL("image/png")):null}return n.toDataURL("image/png")}function f(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=e.getInternalTexture();if(!r)return null;const s=e._readPixelsSync(t,i);return s?p(s,e.getSize(),r.invertY):null}async function g(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=e.getInternalTexture();if(!r)return null;const s=await e.readPixels(t,i);return s?p(s,e.getSize(),r.invertY):null}var m=i(8458),b=i(818);class v extends o.t{static _CreateVideoTexture(e,t,i){arguments.length>5&&void 0!==arguments[5]||v.TRILINEAR_SAMPLINGMODE;throw(0,h.n)("VideoTexture")}get noMipmap(){return this._noMipmap}get mimeType(){return this._mimeType}set isBlocking(e){this._isBlocking=e}get isBlocking(){return this._isBlocking}get invertY(){return this._invertY}constructor(e,t,i,r){let s,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:v.TRILINEAR_SAMPLINGMODE,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,u=arguments.length>8&&void 0!==arguments[8]&&arguments[8],d=arguments.length>9?arguments[9]:void 0,_=arguments.length>10?arguments[10]:void 0,p=arguments.length>11?arguments[11]:void 0,f=arguments.length>12?arguments[12]:void 0,g=arguments.length>13?arguments[13]:void 0;super(t),this.url=null,this.uOffset=0,this.vOffset=0,this.uScale=1,this.vScale=1,this.uAng=0,this.vAng=0,this.wAng=0,this.uRotationCenter=.5,this.vRotationCenter=.5,this.wRotationCenter=.5,this.homogeneousRotationInUVTransform=!1,this.inspectableCustomProperties=null,this._noMipmap=!1,this._invertY=!1,this._rowGenerationMatrix=null,this._cachedTextureMatrix=null,this._projectionModeMatrix=null,this._t0=null,this._t1=null,this._t2=null,this._cachedUOffset=-1,this._cachedVOffset=-1,this._cachedUScale=0,this._cachedVScale=0,this._cachedUAng=-1,this._cachedVAng=-1,this._cachedWAng=-1,this._cachedReflectionProjectionMatrixId=-1,this._cachedURotationCenter=-1,this._cachedVRotationCenter=-1,this._cachedWRotationCenter=-1,this._cachedHomogeneousRotationInUVTransform=!1,this._cachedIdentity3x2=!0,this._cachedReflectionTextureMatrix=null,this._cachedReflectionUOffset=-1,this._cachedReflectionVOffset=-1,this._cachedReflectionUScale=0,this._cachedReflectionVScale=0,this._cachedReflectionCoordinatesMode=-1,this._buffer=null,this._deleteBuffer=!1,this._format=null,this._delayedOnLoad=null,this._delayedOnError=null,this.onLoadObservable=new n.cP,this._isBlocking=!0,this.name=e||"",this.url=e;let b=!1,y=null,T=!0;"object"===typeof i&&null!==i?(s=i.noMipmap??!1,r=i.invertY??!m.rX,a=i.samplingMode??v.TRILINEAR_SAMPLINGMODE,o=i.onLoad??null,l=i.onError??null,h=i.buffer??null,u=i.deleteBuffer??!1,d=i.format,_=i.mimeType,p=i.loaderOptions,f=i.creationFlags,b=i.useSRGBBuffer??!1,y=i.internalTexture??null,T=i.gammaSpace??T):s=!!i,this._gammaSpace=T,this._noMipmap=s,this._invertY=void 0===r?!m.rX:r,this._initialSamplingMode=a,this._buffer=h,this._deleteBuffer=u,this._mimeType=_,this._loaderOptions=p,this._creationFlags=f,this._useSRGBBuffer=b,this._forcedExtension=g,d&&(this._format=d);const x=this.getScene(),A=this._getEngine();if(!A)return;A.onBeforeTextureInitObservable.notifyObservers(this);const C=()=>{this._texture&&(this._texture._invertVScale&&(this.vScale*=-1,this.vOffset+=1),null!==this._texture._cachedWrapU&&(this.wrapU=this._texture._cachedWrapU,this._texture._cachedWrapU=null),null!==this._texture._cachedWrapV&&(this.wrapV=this._texture._cachedWrapV,this._texture._cachedWrapV=null),null!==this._texture._cachedWrapR&&(this.wrapR=this._texture._cachedWrapR,this._texture._cachedWrapR=null)),this.onLoadObservable.hasObservers()&&this.onLoadObservable.notifyObservers(this),o&&o(),!this.isBlocking&&x&&x.resetCachedMaterial()},R=(e,t)=>{this._loadingError=!0,this._errorObject={message:e,exception:t},l&&l(e,t),v.OnTextureLoadErrorObservable.notifyObservers(this)};if(!this.url&&!y)return this._delayedOnLoad=C,void(this._delayedOnError=R);if(this._texture=y??this._getFromCache(this.url,s,a,this._invertY,b,this.isCube),this._texture)if(this._texture.isReady)c._.SetImmediate((()=>C()));else{const e=this._texture.onLoadedObservable.add(C);this._texture.onErrorObservable.add((t=>{R(t.message,t.exception),this._texture?.onLoadedObservable.remove(e)}))}else if(x&&x.useDelayedTextureLoading)this.delayLoadState=4,this._delayedOnLoad=C,this._delayedOnError=R;else{try{this._texture=A.createTexture(this.url,s,this._invertY,x,a,C,R,this._buffer,void 0,this._format,this._forcedExtension,_,p,f,b)}catch(E){throw R("error loading",E),E}u&&(this._buffer=null)}}updateURL(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;this.url&&(this.releaseInternalTexture(),this.getScene().markAllMaterialsAsDirty(1,(e=>e.hasTexture(this)))),this.name&&!this.name.startsWith("data:")||(this.name=e),this.url=e,this._buffer=t,this._forcedExtension=r,this.delayLoadState=4,i&&(this._delayedOnLoad=i),this.delayLoad()}delayLoad(){if(4!==this.delayLoadState)return;const e=this.getScene();e&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer,this.isCube),this._texture?this._delayedOnLoad&&(this._texture.isReady?c._.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=e.getEngine().createTexture(this.url,this._noMipmap,this._invertY,e,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}_prepareRowForTextureGeneration(e,t,i,r){e*=this._cachedUScale,t*=this._cachedVScale,e-=this.uRotationCenter*this._cachedUScale,t-=this.vRotationCenter*this._cachedVScale,i-=this.wRotationCenter,a.Pq.TransformCoordinatesFromFloatsToRef(e,t,i,this._rowGenerationMatrix,r),r.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,r.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,r.z+=this.wRotationCenter}getTextureMatrix(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*e===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*e,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,this._cachedTextureMatrix&&this._rowGenerationMatrix||(this._cachedTextureMatrix=a.uq.Zero(),this._rowGenerationMatrix=new a.uq,this._t0=a.Pq.Zero(),this._t1=a.Pq.Zero(),this._t2=a.Pq.Zero()),a.uq.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(a.uq.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,a.AA.Matrix[0]),a.uq.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,a.AA.Matrix[1]),a.uq.ScalingToRef(this._cachedUScale,this._cachedVScale,0,a.AA.Matrix[2]),a.uq.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,a.AA.Matrix[3]),a.AA.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(a.AA.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(a.AA.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(a.AA.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),a.uq.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));const t=this.getScene();if(!t)return this._cachedTextureMatrix;const i=this._cachedIdentity3x2;return this._cachedIdentity3x2=this._cachedTextureMatrix.isIdentityAs3x2(),this.optimizeUVAllocation&&i!==this._cachedIdentity3x2&&t.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this))),this._cachedTextureMatrix}getReflectionTextureMatrix(){const e=this.getScene();if(!e)return this._cachedReflectionTextureMatrix;if(this.uOffset===this._cachedReflectionUOffset&&this.vOffset===this._cachedReflectionVOffset&&this.uScale===this._cachedReflectionUScale&&this.vScale===this._cachedReflectionVScale&&this.coordinatesMode===this._cachedReflectionCoordinatesMode){if(this.coordinatesMode!==v.PROJECTION_MODE)return this._cachedReflectionTextureMatrix;if(this._cachedReflectionProjectionMatrixId===e.getProjectionMatrix().updateFlag)return this._cachedReflectionTextureMatrix}this._cachedReflectionTextureMatrix||(this._cachedReflectionTextureMatrix=a.uq.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=a.uq.Zero());const t=this._cachedReflectionCoordinatesMode!==this.coordinatesMode;switch(this._cachedReflectionUOffset=this.uOffset,this._cachedReflectionVOffset=this.vOffset,this._cachedReflectionUScale=this.uScale,this._cachedReflectionVScale=this.vScale,this._cachedReflectionCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case v.PLANAR_MODE:a.uq.IdentityToRef(this._cachedReflectionTextureMatrix),this._cachedReflectionTextureMatrix[0]=this.uScale,this._cachedReflectionTextureMatrix[5]=this.vScale,this._cachedReflectionTextureMatrix[12]=this.uOffset,this._cachedReflectionTextureMatrix[13]=this.vOffset;break;case v.PROJECTION_MODE:{a.uq.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);const t=e.getProjectionMatrix();this._cachedReflectionProjectionMatrixId=t.updateFlag,t.multiplyToRef(this._projectionModeMatrix,this._cachedReflectionTextureMatrix);break}default:a.uq.IdentityToRef(this._cachedReflectionTextureMatrix)}return t&&e.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this))),this._cachedReflectionTextureMatrix}clone(){const e={noMipmap:this._noMipmap,invertY:this._invertY,samplingMode:this.samplingMode,onLoad:void 0,onError:void 0,buffer:this._texture?this._texture._buffer:void 0,deleteBuffer:this._deleteBuffer,format:this.textureFormat,mimeType:this.mimeType,loaderOptions:this._loaderOptions,creationFlags:this._creationFlags,useSRGBBuffer:this._useSRGBBuffer};return b.p.Clone((()=>new v(this._texture?this._texture.url:null,this.getScene(),e)),this)}serialize(){const e=this.name;v.SerializeBuffers||this.name.startsWith("data:")&&(this.name=""),this.name.startsWith("data:")&&this.url===this.name&&(this.url="");const t=super.serialize(v._SerializeInternalTextureUniqueId);return t?((v.SerializeBuffers||v.ForceSerializeBuffers)&&("string"===typeof this._buffer&&"data:"===this._buffer.substr(0,5)?(t.base64String=this._buffer,t.name=t.name.replace("data:","")):this.url&&this.url.startsWith("data:")&&this._buffer instanceof Uint8Array?t.base64String="data:image/png;base64,"+(0,_.EL)(this._buffer):(v.ForceSerializeBuffers||this.url&&this.url.startsWith("blob:")||this._forceSerialize)&&(t.base64String=!this._engine||this._engine._features.supportSyncTextureRead?f(this):g(this))),t.invertY=this._invertY,t.samplingMode=this.samplingMode,t._creationFlags=this._creationFlags,t._useSRGBBuffer=this._useSRGBBuffer,v._SerializeInternalTextureUniqueId&&(t.internalTextureUniqueId=this._texture?.uniqueId??void 0),t.noMipmap=this._noMipmap,this.name=e,t):null}getClassName(){return"Texture"}dispose(){super.dispose(),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null,this._buffer=null}static Parse(e,t,i){if(e.customType){const r=u.n.Instantiate(e.customType).Parse(e,t,i);return e.samplingMode&&r.updateSamplingMode&&r._samplingMode&&r._samplingMode!==e.samplingMode&&r.updateSamplingMode(e.samplingMode),r}if(e.isCube&&!e.isRenderTarget)return v._CubeTextureParser(e,t,i);const r=void 0!==e.internalTextureUniqueId;if(!e.name&&!e.isRenderTarget&&!r)return null;let s;if(r){const i=t.getEngine().getLoadedTexturesCache();for(const t of i)if(t.uniqueId===e.internalTextureUniqueId){s=t;break}}const n=t=>{if(t&&t._texture&&(t._texture._cachedWrapU=null,t._texture._cachedWrapV=null,t._texture._cachedWrapR=null),e.samplingMode){const i=e.samplingMode;t&&t.samplingMode!==i&&t.updateSamplingMode(i)}if(t&&e.animations)for(let i=0;i<e.animations.length;i++){const r=e.animations[i],s=(0,l.n9)("BABYLON.Animation");s&&t.animations.push(s.Parse(r))}r&&!s&&t?._texture?._setUniqueId(e.internalTextureUniqueId)};return b.p.Parse((()=>{let r=!0;if(e.noMipmap&&(r=!1),e.mirrorPlane){const i=v._CreateMirror(e.name,e.renderTargetSize,t,r);return i._waitingRenderList=e.renderList,i.mirrorPlane=d.Z.FromArray(e.mirrorPlane),n(i),i}if(e.isRenderTarget){let i=null;if(e.isCube){if(t.reflectionProbes)for(let r=0;r<t.reflectionProbes.length;r++){const i=t.reflectionProbes[r];if(i.name===e.name)return i.cubeTexture}}else i=v._CreateRenderTargetTexture(e.name,e.renderTargetSize,t,r,e._creationFlags??0),i._waitingRenderList=e.renderList;return n(i),i}if(e.isVideo){const s=v._CreateVideoTexture(i+(e.url||e.name),i+(e.src||e.url),t,r,e.invertY,e.samplingMode,e.settings||{});return n(s),s}{let a;if(e.base64String&&!s)a=v.CreateFromBase64String(e.base64String,e.base64String,t,!r,e.invertY,e.samplingMode,(()=>{n(a)}),e._creationFlags??0,e._useSRGBBuffer??!1),a.name=e.name;else{let o;o=e.name&&(e.name.indexOf("://")>0||e.name.startsWith("data:"))?e.name:i+e.name,e.url&&(e.url.startsWith("data:")||v.UseSerializedUrlIfAny)&&(o=e.url);const l={noMipmap:!r,invertY:e.invertY,samplingMode:e.samplingMode,onLoad:()=>{n(a)},internalTexture:s};a=new v(o,t,l)}return a}}),e,t)}static CreateFromBase64String(e,t,i,r,s){let n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:v.TRILINEAR_SAMPLINGMODE;return new v("data:"+t,i,r,s,n,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,e,!1,arguments.length>8&&void 0!==arguments[8]?arguments[8]:5,void 0,void 0,arguments.length>9?arguments[9]:void 0,arguments.length>10?arguments[10]:void 0)}static LoadFromDataString(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4?arguments[4]:void 0,n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:v.TRILINEAR_SAMPLINGMODE,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:5,c=arguments.length>10?arguments[10]:void 0,u=arguments.length>11?arguments[11]:void 0;return"data:"!==e.substr(0,5)&&(e="data:"+e),new v(e,i,s,n,a,o,l,t,r,h,void 0,void 0,c,u)}}v.SerializeBuffers=!0,v.ForceSerializeBuffers=!1,v.OnTextureLoadErrorObservable=new n.cP,v._SerializeInternalTextureUniqueId=!1,v._CubeTextureParser=(e,t,i)=>{throw(0,h.n)("CubeTexture")},v._CreateMirror=(e,t,i,r)=>{throw(0,h.n)("MirrorTexture")},v._CreateRenderTargetTexture=(e,t,i,r,s)=>{throw(0,h.n)("RenderTargetTexture")},v.NEAREST_SAMPLINGMODE=1,v.NEAREST_NEAREST_MIPLINEAR=8,v.BILINEAR_SAMPLINGMODE=2,v.LINEAR_LINEAR_MIPNEAREST=11,v.TRILINEAR_SAMPLINGMODE=3,v.LINEAR_LINEAR_MIPLINEAR=3,v.NEAREST_NEAREST_MIPNEAREST=4,v.NEAREST_LINEAR_MIPNEAREST=5,v.NEAREST_LINEAR_MIPLINEAR=6,v.NEAREST_LINEAR=7,v.NEAREST_NEAREST=1,v.LINEAR_NEAREST_MIPNEAREST=9,v.LINEAR_NEAREST_MIPLINEAR=10,v.LINEAR_LINEAR=2,v.LINEAR_NEAREST=12,v.EXPLICIT_MODE=0,v.SPHERICAL_MODE=1,v.PLANAR_MODE=2,v.CUBIC_MODE=3,v.PROJECTION_MODE=4,v.SKYBOX_MODE=5,v.INVCUBIC_MODE=6,v.EQUIRECTANGULAR_MODE=7,v.FIXED_EQUIRECTANGULAR_MODE=8,v.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,v.CLAMP_ADDRESSMODE=0,v.WRAP_ADDRESSMODE=1,v.MIRROR_ADDRESSMODE=2,v.UseSerializedUrlIfAny=!1,(0,r.Cg)([(0,s.lK)()],v.prototype,"url",void 0),(0,r.Cg)([(0,s.lK)()],v.prototype,"uOffset",void 0),(0,r.Cg)([(0,s.lK)()],v.prototype,"vOffset",void 0),(0,r.Cg)([(0,s.lK)()],v.prototype,"uScale",void 0),(0,r.Cg)([(0,s.lK)()],v.prototype,"vScale",void 0),(0,r.Cg)([(0,s.lK)()],v.prototype,"uAng",void 0),(0,r.Cg)([(0,s.lK)()],v.prototype,"vAng",void 0),(0,r.Cg)([(0,s.lK)()],v.prototype,"wAng",void 0),(0,r.Cg)([(0,s.lK)()],v.prototype,"uRotationCenter",void 0),(0,r.Cg)([(0,s.lK)()],v.prototype,"vRotationCenter",void 0),(0,r.Cg)([(0,s.lK)()],v.prototype,"wRotationCenter",void 0),(0,r.Cg)([(0,s.lK)()],v.prototype,"homogeneousRotationInUVTransform",void 0),(0,r.Cg)([(0,s.lK)()],v.prototype,"isBlocking",null),(0,l.Y5)("BABYLON.Texture",v),b.p._TextureParser=v.Parse},6291:(e,t,i)=>{"use strict";i.d(t,{E:()=>r});class r{static GetEffect(e){return void 0===e.getPipelineContext?e.effect:e}constructor(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=e.createDrawContext(),t&&(this.materialContext=e.createMaterialContext())}setEffect(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.effect=e,void 0!==t&&(this.defines=t),i&&this.drawContext?.reset()}dispose(){this.drawContext?.dispose()}}},2542:(e,t,i)=>{"use strict";i.d(t,{b4:()=>h,bu:()=>u,mO:()=>c,uR:()=>_});var r=i(8315),s=i(2731),n=i(4453),a=i(8274),o=i(4504),l=i(2528);function h(e,t){return(0,s.N5)(t).cachedPipelines[e]}function c(e){const t=e._name,i=e.context;if(t&&i){const e=(0,s.N5)(i),r=e.cachedPipelines[t];r?.dispose(),delete e.cachedPipelines[t]}}function u(e,t,i,s,n,a,l){let h,c;const u=(0,r.BA)()?a?.getHostDocument():null;h="string"===typeof t?t:t.vertexSource?"source:"+t.vertexSource:t.vertexElement?u?.getElementById(t.vertexElement)||t.vertexElement:t.vertex||t,c="string"===typeof t?t:t.fragmentSource?"source:"+t.fragmentSource:t.fragmentElement?u?.getElementById(t.fragmentElement)||t.fragmentElement:t.fragment||t;const _=[void 0,void 0],p=()=>{if(_[0]&&_[1]){e.isFragment=!0;const[r,h]=_;(0,o.M0)(h,e,((a,h)=>{l&&(l._fragmentSourceCodeBeforeMigration=h),i&&(a=i("fragment",a));const c=(0,o.nO)(r,a,e);e=null;const u=function(e,t,i,r){if(i){return{vertexSourceCode:(1===r?"//":"")+"#define SHADER_NAME vertex:"+(i.vertexElement||i.vertex||i.spectorName||i)+"\n"+e,fragmentSourceCode:(1===r?"//":"")+"#define SHADER_NAME fragment:"+(i.fragmentElement||i.fragment||i.spectorName||i)+"\n"+t}}return{vertexSourceCode:e,fragmentSourceCode:t}}(c.vertexCode,c.fragmentCode,t,n);s?.(u.vertexSourceCode,u.fragmentSourceCode)}),a)}};d(h,"Vertex","",(t=>{(0,o.pB)(e),(0,o.M0)(t,e,((e,r)=>{l&&(l._rawVertexSourceCode=t,l._vertexSourceCodeBeforeMigration=r),i&&(e=i("vertex",e)),_[0]=e,p()}),a)}),n),d(c,"Fragment","Pixel",(e=>{l&&(l._rawFragmentSourceCode=e),_[1]=e,p()}),n)}function d(e,t,i,s,a,o){if("undefined"!==typeof HTMLElement&&e instanceof HTMLElement){return void s((0,r.Zl)(e))}if("source:"===e.substr(0,7))return void s(e.substr(7));if("base64:"===e.substr(0,7)){return void s(window.atob(e.substr(7)))}const h=n.l.GetShadersStore(a);if(h[e+t+"Shader"])return void s(h[e+t+"Shader"]);if(i&&h[e+i+"Shader"])return void s(h[e+i+"Shader"]);let c;if(c="."===e[0]||"/"===e[0]||e.indexOf("http")>-1?e:n.l.GetShadersRepository(a)+e,!(o=o||l.W0))throw new Error("loadFileInjection is not defined");o(c+"."+t.toLowerCase()+".fx",s)}const _=(e,t,i,r)=>{try{const n=e.existingPipelineContext||t(e.shaderProcessingContext);if(n._name=e.name,e.name&&e.context){(0,s.N5)(e.context).cachedPipelines[e.name]=n}return i(n,e.vertex,e.fragment,!!e.createAsRaw,"","",e.rebuildRebind,e.defines,e.transformFeedbackVaryings,"",(()=>{r(n,(()=>{e.onRenderingStateCompiled?.(n)}))})),n}catch(n){throw a.V.Error("Error compiling effect"),n}}},4909:(e,t,i)=>{"use strict";i.d(t,{M:()=>o});var r=i(5491),s=i(8274),n=i(4453),a=i(2542);class o{static get ShadersRepository(){return n.l.ShadersRepository}static set ShadersRepository(e){n.l.ShadersRepository=e}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new r.cP),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4?arguments[4]:void 0,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,d=arguments.length>9?arguments[9]:void 0,_=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",p=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,f=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new r.cP,this.onErrorObservable=new r.cP,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=e,this._key=_;const g=this._key.replace(/\r/g,"").replace(/\n/g,"|");let m;if(t.attributes){const e=t;if(this._engine=i,this._attributesNames=e.attributes,this._uniformsNames=e.uniformsNames.concat(e.samplers),this._samplerList=e.samplers.slice(),this.defines=e.defines,this.onError=e.onError,this.onCompiled=e.onCompiled,this._fallbacks=e.fallbacks,this._indexParameters=e.indexParameters,this._transformFeedbackVaryings=e.transformFeedbackVaryings||null,this._multiTarget=!!e.multiTarget,this._shaderLanguage=e.shaderLanguage??0,e.uniformBuffersNames){this._uniformBuffersNamesList=e.uniformBuffersNames.slice();for(let t=0;t<e.uniformBuffersNames.length;t++)this._uniformBuffersNames[e.uniformBuffersNames[t]]=t}this._processFinalCode=e.processFinalCode??null,this._processCodeAfterIncludes=e.processCodeAfterIncludes??void 0,m=e.existingPipelineContext}else this._engine=n,this.defines=null==l?"":l,this._uniformsNames=i.concat(s),this._samplerList=s?s.slice():[],this._attributesNames=t,this._uniformBuffersNamesList=[],this._shaderLanguage=p,this.onError=u,this.onCompiled=c,this._indexParameters=d,this._fallbacks=h;"WEBGL2"===this._engine.shaderPlatformName&&(m=(0,a.b4)(g,this._engine._gl)??m),this._attributeLocationByName={},this.uniqueId=o._UniqueIdSeed++,m?(this._pipelineContext=m,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,f)}async _processShaderCodeAsync(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3?arguments[3]:void 0;r&&await r(),this._processingContext=i||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const s={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:e??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:n.l.GetShadersRepository(this._shaderLanguage),includesShadersStore:n.l.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,a.bu)(s,this.name,this._processFinalCode,((e,i)=>{this._vertexSourceCode=e,this._fragmentSourceCode=i,this._prepareEffect(t)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(e){return this._attributes[e]}getAttributeLocationByName(e){return this._attributeLocationByName[e]}getAttributesCount(){return this._attributes.length}getUniformIndex(e){return this._uniformsNames.indexOf(e)}getUniform(e){return this._uniforms[e]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}executeWhenCompiled(e){this.isReady()?e(this):(this.onCompileObservable.add((t=>{e(t)})),this._pipelineContext&&!this._pipelineContext.isAsync||setTimeout((()=>{this._checkIsReady(null)}),16))}_checkIsReady(e){try{if(this._isReadyInternal())return}catch(t){return void this._processCompilationErrors(t,e)}this._isDisposed||setTimeout((()=>{this._checkIsReady(e)}),16)}get vertexSourceCode(){return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:this._pipelineContext?._getVertexShaderCode()??this._vertexSourceCode}get fragmentSourceCode(){return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:this._pipelineContext?._getFragmentShaderCode()??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(e,t,i,r){this._isReady=!1,this._vertexSourceCodeOverride=e,this._fragmentSourceCodeOverride=t,this.onError=(e,t)=>{r&&r(t)},this.onCompiled=()=>{const e=this.getEngine().scenes;if(e)for(let t=0;t<e.length;t++)e[t].markAllMaterialsAsDirty(63);this._pipelineContext._handlesSpectorRebuildCallback?.(i)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(e){if(this._pipelineContext=e,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let t=0;t<this._attributesNames.length;t++){const e=this._attributesNames[t];this._attributeLocationByName[e]=this._attributes[t]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh()}_prepareEffect(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=this._pipelineContext;this._isReady=!1;try{const i=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),r=i?null:this.defines,s=i?this._vertexSourceCodeOverride:this._vertexSourceCode,n=i?this._fragmentSourceCodeOverride:this._fragmentSourceCode,o=this._engine;this._pipelineContext=(0,a.uR)({existingPipelineContext:e?t:null,vertex:s,fragment:n,context:"WEBGL2"===o.shaderPlatformName?o._gl:void 0,rebuildRebind:(e,t,i,r)=>this._rebuildProgram(e,t,i,r),defines:r,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:i,parallelShaderCompile:o._caps.parallelShaderCompile,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:i=>{t&&!e&&this._engine._deletePipelineContext(t),i&&this._onRenderingStateCompiled(i)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContext.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(t)}catch(i){this._processCompilationErrors(i,t)}}_getShaderCodeAndErrorLine(e,t,i){const r=i?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let s=null;if(t&&e){const n=t.match(r);if(n&&2===n.length){const t=parseInt(n[1]),r=e.split("\n",-1);r.length>=t&&(s=`Offending line [${t}] in ${i?"fragment":"vertex"} code: ${r[t-1]}`)}}return[e,s]}_processCompilationErrors(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=e.message;const i=this._attributesNames,r=this._fallbacks;if(s.V.Error("Unable to compile effect:"),s.V.Error("Uniforms: "+this._uniformsNames.map((function(e){return" "+e}))),s.V.Error("Attributes: "+i.map((function(e){return" "+e}))),s.V.Error("Defines:\n"+this.defines),o.LogShaderCodeOnCompilationError){let e=null,t=null,i=null;this._pipelineContext?._getVertexShaderCode()&&([i,e]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),i&&(s.V.Error("Vertex code:"),s.V.Error(i))),this._pipelineContext?._getFragmentShaderCode()&&([i,t]=this._getShaderCodeAndErrorLine(this._pipelineContext?._getFragmentShaderCode(),this._compilationError,!0),i&&(s.V.Error("Fragment code:"),s.V.Error(i))),e&&s.V.Error(e),t&&s.V.Error(t)}s.V.Error("Error: "+this._compilationError);const n=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)};t&&(this._pipelineContext=t,this._isReady=!0,n()),r?(this._pipelineContext=null,r.hasMoreFallbacks?(this._allFallbacksProcessed=!1,s.V.Error("Trying next fallback."),this.defines=r.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,n(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,t||n())}get isSupported(){return""===this._compilationError}_bindTexture(e,t){this._engine._bindTexture(this._samplers[e],t,e)}setTexture(e,t){this._engine.setTexture(this._samplers[e],this._uniforms[e],t,e)}setTextureArray(e,t){const i=e+"Ex";if(-1===this._samplerList.indexOf(i+"0")){const r=this._samplerList.indexOf(e);for(let e=1;e<t.length;e++){const t=i+(e-1).toString();this._samplerList.splice(r+e,0,t)}let s=0;for(const e of this._samplerList)this._samplers[e]=s,s+=1}this._engine.setTextureArray(this._samplers[e],this._uniforms[e],t,e)}bindUniformBuffer(e,t){const i=this._uniformBuffersNames[t];void 0===i||o._BaseCache[i]===e&&this._engine._features.useUBOBindingCache||(o._BaseCache[i]=e,this._engine.bindUniformBufferBase(e,i,t))}bindUniformBlock(e,t){this._engine.bindUniformBlock(this._pipelineContext,e,t)}setInt(e,t){return this._pipelineContext.setInt(e,t),this}setInt2(e,t,i){return this._pipelineContext.setInt2(e,t,i),this}setInt3(e,t,i,r){return this._pipelineContext.setInt3(e,t,i,r),this}setInt4(e,t,i,r,s){return this._pipelineContext.setInt4(e,t,i,r,s),this}setIntArray(e,t){return this._pipelineContext.setIntArray(e,t),this}setIntArray2(e,t){return this._pipelineContext.setIntArray2(e,t),this}setIntArray3(e,t){return this._pipelineContext.setIntArray3(e,t),this}setIntArray4(e,t){return this._pipelineContext.setIntArray4(e,t),this}setUInt(e,t){return this._pipelineContext.setUInt(e,t),this}setUInt2(e,t,i){return this._pipelineContext.setUInt2(e,t,i),this}setUInt3(e,t,i,r){return this._pipelineContext.setUInt3(e,t,i,r),this}setUInt4(e,t,i,r,s){return this._pipelineContext.setUInt4(e,t,i,r,s),this}setUIntArray(e,t){return this._pipelineContext.setUIntArray(e,t),this}setUIntArray2(e,t){return this._pipelineContext.setUIntArray2(e,t),this}setUIntArray3(e,t){return this._pipelineContext.setUIntArray3(e,t),this}setUIntArray4(e,t){return this._pipelineContext.setUIntArray4(e,t),this}setFloatArray(e,t){return this._pipelineContext.setArray(e,t),this}setFloatArray2(e,t){return this._pipelineContext.setArray2(e,t),this}setFloatArray3(e,t){return this._pipelineContext.setArray3(e,t),this}setFloatArray4(e,t){return this._pipelineContext.setArray4(e,t),this}setArray(e,t){return this._pipelineContext.setArray(e,t),this}setArray2(e,t){return this._pipelineContext.setArray2(e,t),this}setArray3(e,t){return this._pipelineContext.setArray3(e,t),this}setArray4(e,t){return this._pipelineContext.setArray4(e,t),this}setMatrices(e,t){return this._pipelineContext.setMatrices(e,t),this}setMatrix(e,t){return this._pipelineContext.setMatrix(e,t),this}setMatrix3x3(e,t){return this._pipelineContext.setMatrix3x3(e,t),this}setMatrix2x2(e,t){return this._pipelineContext.setMatrix2x2(e,t),this}setFloat(e,t){return this._pipelineContext.setFloat(e,t),this}setBool(e,t){return this._pipelineContext.setInt(e,t?1:0),this}setVector2(e,t){return this._pipelineContext.setVector2(e,t),this}setFloat2(e,t,i){return this._pipelineContext.setFloat2(e,t,i),this}setVector3(e,t){return this._pipelineContext.setVector3(e,t),this}setFloat3(e,t,i,r){return this._pipelineContext.setFloat3(e,t,i,r),this}setVector4(e,t){return this._pipelineContext.setVector4(e,t),this}setQuaternion(e,t){return this._pipelineContext.setQuaternion(e,t),this}setFloat4(e,t,i,r,s){return this._pipelineContext.setFloat4(e,t,i,r,s),this}setColor3(e,t){return this._pipelineContext.setColor3(e,t),this}setColor4(e,t,i){return this._pipelineContext.setColor4(e,t,i),this}setDirectColor4(e,t){return this._pipelineContext.setDirectColor4(e,t),this}dispose(){this._refCount--,this._refCount>0||(this._pipelineContext&&(0,a.mO)(this._pipelineContext),this._engine._releaseEffect(this),this._isDisposed=!0)}static RegisterShader(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;t&&(n.l.GetShadersStore(r)[`${e}PixelShader`]=t),i&&(n.l.GetShadersStore(r)[`${e}VertexShader`]=i)}static ResetCache(){o._BaseCache={}}}o.LogShaderCodeOnCompilationError=!0,o._UniqueIdSeed=0,o._BaseCache={},o.ShadersStore=n.l.ShadersStore,o.IncludesShadersStore=n.l.IncludesShadersStore},3390:(e,t,i)=>{"use strict";i.d(t,{p:()=>d});var r=i(6379),s=i(7376),n=i(5491),a=i(6760),o=i(818);function l(e){e.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")}class h{constructor(){this._dirty=!0,this._tempColor=new a.ov(0,0,0,0),this._globalCurve=new a.ov(0,0,0,0),this._highlightsCurve=new a.ov(0,0,0,0),this._midtonesCurve=new a.ov(0,0,0,0),this._shadowsCurve=new a.ov(0,0,0,0),this._positiveCurve=new a.ov(0,0,0,0),this._negativeCurve=new a.ov(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}get globalHue(){return this._globalHue}set globalHue(e){this._globalHue=e,this._dirty=!0}get globalDensity(){return this._globalDensity}set globalDensity(e){this._globalDensity=e,this._dirty=!0}get globalSaturation(){return this._globalSaturation}set globalSaturation(e){this._globalSaturation=e,this._dirty=!0}get globalExposure(){return this._globalExposure}set globalExposure(e){this._globalExposure=e,this._dirty=!0}get highlightsHue(){return this._highlightsHue}set highlightsHue(e){this._highlightsHue=e,this._dirty=!0}get highlightsDensity(){return this._highlightsDensity}set highlightsDensity(e){this._highlightsDensity=e,this._dirty=!0}get highlightsSaturation(){return this._highlightsSaturation}set highlightsSaturation(e){this._highlightsSaturation=e,this._dirty=!0}get highlightsExposure(){return this._highlightsExposure}set highlightsExposure(e){this._highlightsExposure=e,this._dirty=!0}get midtonesHue(){return this._midtonesHue}set midtonesHue(e){this._midtonesHue=e,this._dirty=!0}get midtonesDensity(){return this._midtonesDensity}set midtonesDensity(e){this._midtonesDensity=e,this._dirty=!0}get midtonesSaturation(){return this._midtonesSaturation}set midtonesSaturation(e){this._midtonesSaturation=e,this._dirty=!0}get midtonesExposure(){return this._midtonesExposure}set midtonesExposure(e){this._midtonesExposure=e,this._dirty=!0}get shadowsHue(){return this._shadowsHue}set shadowsHue(e){this._shadowsHue=e,this._dirty=!0}get shadowsDensity(){return this._shadowsDensity}set shadowsDensity(e){this._shadowsDensity=e,this._dirty=!0}get shadowsSaturation(){return this._shadowsSaturation}set shadowsSaturation(e){this._shadowsSaturation=e,this._dirty=!0}get shadowsExposure(){return this._shadowsExposure}set shadowsExposure(e){this._shadowsExposure=e,this._dirty=!0}getClassName(){return"ColorCurves"}static Bind(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vCameraColorCurvePositive",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vCameraColorCurveNeutral",s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"vCameraColorCurveNegative";e._dirty&&(e._dirty=!1,e._getColorGradingDataToRef(e._globalHue,e._globalDensity,e._globalSaturation,e._globalExposure,e._globalCurve),e._getColorGradingDataToRef(e._highlightsHue,e._highlightsDensity,e._highlightsSaturation,e._highlightsExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._highlightsCurve),e._getColorGradingDataToRef(e._midtonesHue,e._midtonesDensity,e._midtonesSaturation,e._midtonesExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._midtonesCurve),e._getColorGradingDataToRef(e._shadowsHue,e._shadowsDensity,e._shadowsSaturation,e._shadowsExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._shadowsCurve),e._highlightsCurve.subtractToRef(e._midtonesCurve,e._positiveCurve),e._midtonesCurve.subtractToRef(e._shadowsCurve,e._negativeCurve)),t&&(t.setFloat4(i,e._positiveCurve.r,e._positiveCurve.g,e._positiveCurve.b,e._positiveCurve.a),t.setFloat4(r,e._midtonesCurve.r,e._midtonesCurve.g,e._midtonesCurve.b,e._midtonesCurve.a),t.setFloat4(s,e._negativeCurve.r,e._negativeCurve.g,e._negativeCurve.b,e._negativeCurve.a))}_getColorGradingDataToRef(e,t,i,r,s){null!=e&&(e=h._Clamp(e,0,360),t=h._Clamp(t,-100,100),i=h._Clamp(i,-100,100),r=h._Clamp(r,-100,100),t=h._ApplyColorGradingSliderNonlinear(t),t*=.5,r=h._ApplyColorGradingSliderNonlinear(r),t<0&&(t*=-1,e=(e+180)%360),h._FromHSBToRef(e,t,50+.25*r,s),s.scaleToRef(2,s),s.a=1+.01*i)}static _ApplyColorGradingSliderNonlinear(e){e/=100;let t=Math.abs(e);return t=Math.pow(t,2),e<0&&(t*=-1),t*=100,t}static _FromHSBToRef(e,t,i,r){let s=h._Clamp(e,0,360);const n=h._Clamp(t/100,0,1),a=h._Clamp(i/100,0,1);if(0===n)r.r=a,r.g=a,r.b=a;else{s/=60;const e=Math.floor(s),t=s-e,i=a*(1-n),o=a*(1-n*t),l=a*(1-n*(1-t));switch(e){case 0:r.r=a,r.g=l,r.b=i;break;case 1:r.r=o,r.g=a,r.b=i;break;case 2:r.r=i,r.g=a,r.b=l;break;case 3:r.r=i,r.g=o,r.b=a;break;case 4:r.r=l,r.g=i,r.b=a;break;default:r.r=a,r.g=i,r.b=o}}r.a=1}static _Clamp(e,t,i){return Math.min(Math.max(e,t),i)}clone(){return o.p.Clone((()=>new h),this)}serialize(){return o.p.Serialize(this)}static Parse(e){return o.p.Parse((()=>new h),e,null,null)}}h.PrepareUniforms=l,(0,r.Cg)([(0,s.lK)()],h.prototype,"_globalHue",void 0),(0,r.Cg)([(0,s.lK)()],h.prototype,"_globalDensity",void 0),(0,r.Cg)([(0,s.lK)()],h.prototype,"_globalSaturation",void 0),(0,r.Cg)([(0,s.lK)()],h.prototype,"_globalExposure",void 0),(0,r.Cg)([(0,s.lK)()],h.prototype,"_highlightsHue",void 0),(0,r.Cg)([(0,s.lK)()],h.prototype,"_highlightsDensity",void 0),(0,r.Cg)([(0,s.lK)()],h.prototype,"_highlightsSaturation",void 0),(0,r.Cg)([(0,s.lK)()],h.prototype,"_highlightsExposure",void 0),(0,r.Cg)([(0,s.lK)()],h.prototype,"_midtonesHue",void 0),(0,r.Cg)([(0,s.lK)()],h.prototype,"_midtonesDensity",void 0),(0,r.Cg)([(0,s.lK)()],h.prototype,"_midtonesSaturation",void 0),(0,r.Cg)([(0,s.lK)()],h.prototype,"_midtonesExposure",void 0),o.p._ColorCurvesParser=h.Parse;var c=i(4780);var u=i(4141);class d{constructor(){this.colorCurves=new h,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=d.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCenterX=0,this.vignetteCenterY=0,this.vignetteWeight=1.5,this.vignetteColor=new a.ov(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=d.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._ditheringEnabled=!1,this._ditheringIntensity=1/255,this._skipFinalColorClamp=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new n.cP}get colorCurvesEnabled(){return this._colorCurvesEnabled}set colorCurvesEnabled(e){this._colorCurvesEnabled!==e&&(this._colorCurvesEnabled=e,this._updateParameters())}get colorGradingTexture(){return this._colorGradingTexture}set colorGradingTexture(e){this._colorGradingTexture!==e&&(this._colorGradingTexture=e,this._updateParameters())}get colorGradingEnabled(){return this._colorGradingEnabled}set colorGradingEnabled(e){this._colorGradingEnabled!==e&&(this._colorGradingEnabled=e,this._updateParameters())}get colorGradingWithGreenDepth(){return this._colorGradingWithGreenDepth}set colorGradingWithGreenDepth(e){this._colorGradingWithGreenDepth!==e&&(this._colorGradingWithGreenDepth=e,this._updateParameters())}get colorGradingBGR(){return this._colorGradingBGR}set colorGradingBGR(e){this._colorGradingBGR!==e&&(this._colorGradingBGR=e,this._updateParameters())}get exposure(){return this._exposure}set exposure(e){this._exposure!==e&&(this._exposure=e,this._updateParameters())}get toneMappingEnabled(){return this._toneMappingEnabled}set toneMappingEnabled(e){this._toneMappingEnabled!==e&&(this._toneMappingEnabled=e,this._updateParameters())}get toneMappingType(){return this._toneMappingType}set toneMappingType(e){this._toneMappingType!==e&&(this._toneMappingType=e,this._updateParameters())}get contrast(){return this._contrast}set contrast(e){this._contrast!==e&&(this._contrast=e,this._updateParameters())}get vignetteCentreY(){return this.vignetteCenterY}set vignetteCentreY(e){this.vignetteCenterY=e}get vignetteCentreX(){return this.vignetteCenterX}set vignetteCentreX(e){this.vignetteCenterX=e}get vignetteBlendMode(){return this._vignetteBlendMode}set vignetteBlendMode(e){this._vignetteBlendMode!==e&&(this._vignetteBlendMode=e,this._updateParameters())}get vignetteEnabled(){return this._vignetteEnabled}set vignetteEnabled(e){this._vignetteEnabled!==e&&(this._vignetteEnabled=e,this._updateParameters())}get ditheringEnabled(){return this._ditheringEnabled}set ditheringEnabled(e){this._ditheringEnabled!==e&&(this._ditheringEnabled=e,this._updateParameters())}get ditheringIntensity(){return this._ditheringIntensity}set ditheringIntensity(e){this._ditheringIntensity!==e&&(this._ditheringIntensity=e,this._updateParameters())}get skipFinalColorClamp(){return this._skipFinalColorClamp}set skipFinalColorClamp(e){this._skipFinalColorClamp!==e&&(this._skipFinalColorClamp=e,this._updateParameters())}get applyByPostProcess(){return this._applyByPostProcess}set applyByPostProcess(e){this._applyByPostProcess!==e&&(this._applyByPostProcess=e,this._updateParameters())}get isEnabled(){return this._isEnabled}set isEnabled(e){this._isEnabled!==e&&(this._isEnabled=e,this._updateParameters())}_updateParameters(){this.onUpdateParameters.notifyObservers(this)}getClassName(){return"ImageProcessingConfiguration"}prepareDefines(e){if((arguments.length>1&&void 0!==arguments[1]&&arguments[1])!==this.applyByPostProcess||!this._isEnabled)return e.VIGNETTE=!1,e.TONEMAPPING=0,e.CONTRAST=!1,e.EXPOSURE=!1,e.COLORCURVES=!1,e.COLORGRADING=!1,e.COLORGRADING3D=!1,e.DITHER=!1,e.IMAGEPROCESSING=!1,e.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,void(e.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);if(e.VIGNETTE=this.vignetteEnabled,e.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===d._VIGNETTEMODE_MULTIPLY,e.VIGNETTEBLENDMODEOPAQUE=!e.VIGNETTEBLENDMODEMULTIPLY,this._toneMappingEnabled)switch(this._toneMappingType){case d.TONEMAPPING_KHR_PBR_NEUTRAL:e.TONEMAPPING=3;break;case d.TONEMAPPING_ACES:e.TONEMAPPING=2;break;default:e.TONEMAPPING=1}else e.TONEMAPPING=0;e.CONTRAST=1!==this.contrast,e.EXPOSURE=1!==this.exposure,e.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,e.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,e.COLORGRADING?e.COLORGRADING3D=this.colorGradingTexture.is3D:e.COLORGRADING3D=!1,e.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,e.SAMPLER3DBGRMAP=this.colorGradingBGR,e.DITHER=this._ditheringEnabled,e.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,e.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,e.IMAGEPROCESSING=e.VIGNETTE||!!e.TONEMAPPING||e.CONTRAST||e.EXPOSURE||e.COLORCURVES||e.COLORGRADING||e.DITHER}isReady(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()}bind(e,t){if(this._colorCurvesEnabled&&this.colorCurves&&h.Bind(this.colorCurves,e),this._vignetteEnabled||this._ditheringEnabled){const i=1/e.getEngine().getRenderWidth(),r=1/e.getEngine().getRenderHeight();if(e.setFloat2("vInverseScreenSize",i,r),this._ditheringEnabled&&e.setFloat("ditherIntensity",.5*this._ditheringIntensity),this._vignetteEnabled){const s=null!=t?t:r/i;let n=Math.tan(.5*this.vignetteCameraFov),a=n*s;const o=Math.sqrt(a*n);a=(0,c.zF)(a,o,this.vignetteStretch),n=(0,c.zF)(n,o,this.vignetteStretch),e.setFloat4("vignetteSettings1",a,n,-a*this.vignetteCenterX,-n*this.vignetteCenterY);const l=-2*this.vignetteWeight;e.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,l)}}if(e.setFloat("exposureLinear",this.exposure),e.setFloat("contrast",this.contrast),this.colorGradingTexture){e.setTexture("txColorTransform",this.colorGradingTexture);const t=this.colorGradingTexture.getSize().height;e.setFloat4("colorTransformSettings",(t-1)/t,.5/t,t,this.colorGradingTexture.level)}}clone(){return o.p.Clone((()=>new d),this)}serialize(){return o.p.Serialize(this)}static Parse(e){const t=o.p.Parse((()=>new d),e,null,null);return void 0!==e.vignetteCentreX&&(t.vignetteCenterX=e.vignetteCentreX),void 0!==e.vignetteCentreY&&(t.vignetteCenterY=e.vignetteCentreY),t}static get VIGNETTEMODE_MULTIPLY(){return this._VIGNETTEMODE_MULTIPLY}static get VIGNETTEMODE_OPAQUE(){return this._VIGNETTEMODE_OPAQUE}}d.TONEMAPPING_STANDARD=0,d.TONEMAPPING_ACES=1,d.TONEMAPPING_KHR_PBR_NEUTRAL=2,d.PrepareUniforms=function(e,t){t.EXPOSURE&&e.push("exposureLinear"),t.CONTRAST&&e.push("contrast"),t.COLORGRADING&&e.push("colorTransformSettings"),(t.VIGNETTE||t.DITHER)&&e.push("vInverseScreenSize"),t.VIGNETTE&&(e.push("vignetteSettings1"),e.push("vignetteSettings2")),t.COLORCURVES&&l(e),t.DITHER&&e.push("ditherIntensity")},d.PrepareSamplers=function(e,t){t.COLORGRADING&&e.push("txColorTransform")},d._VIGNETTEMODE_MULTIPLY=0,d._VIGNETTEMODE_OPAQUE=1,(0,r.Cg)([(0,s.wL)()],d.prototype,"colorCurves",void 0),(0,r.Cg)([(0,s.lK)()],d.prototype,"_colorCurvesEnabled",void 0),(0,r.Cg)([(0,s.uM)("colorGradingTexture")],d.prototype,"_colorGradingTexture",void 0),(0,r.Cg)([(0,s.lK)()],d.prototype,"_colorGradingEnabled",void 0),(0,r.Cg)([(0,s.lK)()],d.prototype,"_colorGradingWithGreenDepth",void 0),(0,r.Cg)([(0,s.lK)()],d.prototype,"_colorGradingBGR",void 0),(0,r.Cg)([(0,s.lK)()],d.prototype,"_exposure",void 0),(0,r.Cg)([(0,s.lK)()],d.prototype,"_toneMappingEnabled",void 0),(0,r.Cg)([(0,s.lK)()],d.prototype,"_toneMappingType",void 0),(0,r.Cg)([(0,s.lK)()],d.prototype,"_contrast",void 0),(0,r.Cg)([(0,s.lK)()],d.prototype,"vignetteStretch",void 0),(0,r.Cg)([(0,s.lK)()],d.prototype,"vignetteCenterX",void 0),(0,r.Cg)([(0,s.lK)()],d.prototype,"vignetteCenterY",void 0),(0,r.Cg)([(0,s.lK)()],d.prototype,"vignetteWeight",void 0),(0,r.Cg)([(0,s.qK)()],d.prototype,"vignetteColor",void 0),(0,r.Cg)([(0,s.lK)()],d.prototype,"vignetteCameraFov",void 0),(0,r.Cg)([(0,s.lK)()],d.prototype,"_vignetteBlendMode",void 0),(0,r.Cg)([(0,s.lK)()],d.prototype,"_vignetteEnabled",void 0),(0,r.Cg)([(0,s.lK)()],d.prototype,"_ditheringEnabled",void 0),(0,r.Cg)([(0,s.lK)()],d.prototype,"_ditheringIntensity",void 0),(0,r.Cg)([(0,s.lK)()],d.prototype,"_skipFinalColorClamp",void 0),(0,r.Cg)([(0,s.lK)()],d.prototype,"_applyByPostProcess",void 0),(0,r.Cg)([(0,s.lK)()],d.prototype,"_isEnabled",void 0),o.p._ImageProcessingConfigurationParser=d.Parse,(0,u.Y5)("BABYLON.ImageProcessingConfiguration",d)},4990:(e,t,i)=>{"use strict";i.d(t,{D:()=>o});var r=i(8274),s=i(543),n=i(5887),a=i(4116);n.w.prototype.createUniformBuffer=function(e,t){const i=this._gl.createBuffer();if(!i)throw new Error("Unable to create uniform buffer");const r=new a.A(i);return this.bindUniformBuffer(r),e instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,e,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(e),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),r.references=1,r},n.w.prototype.createDynamicUniformBuffer=function(e,t){const i=this._gl.createBuffer();if(!i)throw new Error("Unable to create dynamic uniform buffer");const r=new a.A(i);return this.bindUniformBuffer(r),e instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,e,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(e),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),r.references=1,r},n.w.prototype.updateUniformBuffer=function(e,t,i,r){this.bindUniformBuffer(e),void 0===i&&(i=0),void 0===r?t instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,i,t):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,i,new Float32Array(t)):t instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,t.subarray(i,i+r)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(t).subarray(i,i+r)),this.bindUniformBuffer(null)},n.w.prototype.bindUniformBuffer=function(e){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,e?e.underlyingResource:null)},n.w.prototype.bindUniformBufferBase=function(e,t,i){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,t,e?e.underlyingResource:null)},n.w.prototype.bindUniformBlock=function(e,t,i){const r=e.program,s=this._gl.getUniformBlockIndex(r,t);4294967295!==s&&this._gl.uniformBlockBinding(r,s,i)};class o{constructor(e,t,i,r){let s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._valueCache={},this._engine=e,this._noUBO=!e.supportsUniformBuffers||s,this._dynamic=i,this._name=r??"no-name",this._data=t||[],this._uniformLocations={},this._uniformSizes={},this._uniformArraySizes={},this._uniformLocationPointer=0,this._needSync=!1,this._engine._features.trackUbosInFrame&&(this._buffers=[],this._bufferIndex=-1,this._createBufferOnWrite=!1,this._currentFrameId=0),this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateFloatArray=this._updateFloatArrayForEffect,this.updateArray=this._updateArrayForEffect,this.updateIntArray=this._updateIntArrayForEffect,this.updateUIntArray=this._updateUIntArrayForEffect,this.updateMatrix=this._updateMatrixForEffect,this.updateMatrices=this._updateMatricesForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect,this.updateDirectColor4=this._updateDirectColor4ForEffect,this.updateInt=this._updateIntForEffect,this.updateInt2=this._updateInt2ForEffect,this.updateInt3=this._updateInt3ForEffect,this.updateInt4=this._updateInt4ForEffect,this.updateUInt=this._updateUIntForEffect,this.updateUInt2=this._updateUInt2ForEffect,this.updateUInt3=this._updateUInt3ForEffect,this.updateUInt4=this._updateUInt4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateFloatArray=this._updateFloatArrayForUniform,this.updateArray=this._updateArrayForUniform,this.updateIntArray=this._updateIntArrayForUniform,this.updateUIntArray=this._updateUIntArrayForUniform,this.updateMatrix=this._updateMatrixForUniform,this.updateMatrices=this._updateMatricesForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform,this.updateDirectColor4=this._updateDirectColor4ForUniform,this.updateInt=this._updateIntForUniform,this.updateInt2=this._updateInt2ForUniform,this.updateInt3=this._updateInt3ForUniform,this.updateInt4=this._updateInt4ForUniform,this.updateUInt=this._updateUIntForUniform,this.updateUInt2=this._updateUInt2ForUniform,this.updateUInt3=this._updateUInt3ForUniform,this.updateUInt4=this._updateUInt4ForUniform)}get useUbo(){return!this._noUBO}get isSync(){return!this._needSync}isDynamic(){return void 0!==this._dynamic}getData(){return this._bufferData}getBuffer(){return this._buffer}_fillAlignment(e){let t;if(t=e<=2?e:4,this._uniformLocationPointer%t!==0){const e=this._uniformLocationPointer;this._uniformLocationPointer+=t-this._uniformLocationPointer%t;const i=this._uniformLocationPointer-e;for(let t=0;t<i;t++)this._data.push(0)}}addUniform(e,t){let i,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!this._noUBO&&void 0===this._uniformLocations[e]){if(r>0){if(t instanceof Array)throw"addUniform should not be use with Array in UBO: "+e;if(this._fillAlignment(4),this._uniformArraySizes[e]={strideSize:t,arraySize:r},16==t)t*=r;else{t=t*r+(4-t)*r}i=[];for(let e=0;e<t;e++)i.push(0)}else{if(t instanceof Array)i=t,t=i.length;else{i=[];for(let e=0;e<t;e++)i.push(0)}this._fillAlignment(t)}this._uniformSizes[e]=t,this._uniformLocations[e]=this._uniformLocationPointer,this._uniformLocationPointer+=t;for(let e=0;e<t;e++)this._data.push(i[e]);this._needSync=!0}}addMatrix(e,t){this.addUniform(e,Array.prototype.slice.call(t.asArray()))}addFloat2(e,t,i){const r=[t,i];this.addUniform(e,r)}addFloat3(e,t,i,r){const s=[t,i,r];this.addUniform(e,s)}addColor3(e,t){const i=[t.r,t.g,t.b];this.addUniform(e,i)}addColor4(e,t,i){const r=[t.r,t.g,t.b,i];this.addUniform(e,r)}addVector3(e,t){const i=[t.x,t.y,t.z];this.addUniform(e,i)}addMatrix3x3(e){this.addUniform(e,12)}addMatrix2x2(e){this.addUniform(e,8)}create(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)}_getNames(){const e=[];let t=0;for(const i in this._uniformLocations)if(e.push(i),10===++t)break;return e.join(",")}_rebuild(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()):this._buffer=this._engine.createUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()),this._engine._features.trackUbosInFrame&&(this._buffers.push([this._buffer,this._engine._features.checkUbosContentBeforeUpload?this._bufferData.slice():void 0]),this._bufferIndex=this._buffers.length-1,this._createBufferOnWrite=!1))}_rebuildAfterContextLost(){this._engine._features.trackUbosInFrame&&(this._buffers=[],this._currentFrameId=0),this._rebuild()}get _numBuffers(){return this._buffers.length}get _indexBuffer(){return this._bufferIndex}get name(){return this._name}get currentEffect(){return this._currentEffect}_buffersEqual(e,t){for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}_copyBuffer(e,t){for(let i=0;i<e.length;++i)t[i]=e[i]}update(){if(!this._noUBO)if(this.bindUniformBuffer(),this._buffer)if(this._dynamic||this._needSync){if(this._buffers&&this._buffers.length>1&&this._buffers[this._bufferIndex][1]){if(this._buffersEqual(this._bufferData,this._buffers[this._bufferIndex][1]))return this._needSync=!1,void(this._createBufferOnWrite=this._engine._features.trackUbosInFrame);this._copyBuffer(this._bufferData,this._buffers[this._bufferIndex][1])}this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._engine._features._collectUbosUpdatedInFrame&&(o._UpdatedUbosInFrame[this._name]||(o._UpdatedUbosInFrame[this._name]=0),o._UpdatedUbosInFrame[this._name]++),this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame}else this._createBufferOnWrite=this._engine._features.trackUbosInFrame;else this.create()}_createNewBuffer(){this._bufferIndex+1<this._buffers.length?(this._bufferIndex++,this._buffer=this._buffers[this._bufferIndex][0],this._createBufferOnWrite=!1,this._needSync=!0):this._rebuild()}_checkNewFrame(){this._engine._features.trackUbosInFrame&&this._currentFrameId!==this._engine.frameId&&(this._currentFrameId=this._engine.frameId,this._createBufferOnWrite=!1,this._buffers&&this._buffers.length>0?(this._needSync=0!==this._bufferIndex,this._bufferIndex=0,this._buffer=this._buffers[this._bufferIndex][0]):this._bufferIndex=-1)}updateUniform(e,t,i){this._checkNewFrame();let s=this._uniformLocations[e];if(void 0===s){if(this._buffer)return void r.V.Error("Cannot add an uniform after UBO has been created. uniformName="+e);this.addUniform(e,i),s=this._uniformLocations[e]}if(this._buffer||this.create(),this._dynamic)for(let r=0;r<i;r++)this._bufferData[s+r]=t[r];else{let e=!1;for(let r=0;r<i;r++)(16===i&&!this._engine._features.uniformBufferHardCheckMatrix||this._bufferData[s+r]!==Math.fround(t[r]))&&(e=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[s+r]=t[r]);this._needSync=this._needSync||e}}updateUniformArray(e,t,i){this._checkNewFrame();const n=this._uniformLocations[e];if(void 0===n)return void r.V.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform and make sure that uniform buffers are supported by the current engine.");this._buffer||this.create();const a=this._uniformArraySizes[e];if(this._dynamic)for(let r=0;r<i;r++)this._bufferData[n+r]=t[r];else{let e=!1,r=0,o=0;for(let l=0;l<i;l++)if(this._bufferData[n+4*o+r]!==s.S0.FloatRound(t[l])&&(e=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[n+4*o+r]=t[l]),r++,r===a.strideSize){for(;r<4;r++)this._bufferData[n+4*o+r]=0;r=0,o++}this._needSync=this._needSync||e}}_cacheMatrix(e,t){this._checkNewFrame();const i=this._valueCache[e],r=t.updateFlag;return(void 0===i||i!==r)&&(this._valueCache[e]=r,!0)}_updateMatrix3x3ForUniform(e,t){for(let i=0;i<3;i++)o._TempBuffer[4*i]=t[3*i],o._TempBuffer[4*i+1]=t[3*i+1],o._TempBuffer[4*i+2]=t[3*i+2],o._TempBuffer[4*i+3]=0;this.updateUniform(e,o._TempBuffer,12)}_updateMatrix3x3ForEffect(e,t){this._currentEffect.setMatrix3x3(e,t)}_updateMatrix2x2ForEffect(e,t){this._currentEffect.setMatrix2x2(e,t)}_updateMatrix2x2ForUniform(e,t){for(let i=0;i<2;i++)o._TempBuffer[4*i]=t[2*i],o._TempBuffer[4*i+1]=t[2*i+1],o._TempBuffer[4*i+2]=0,o._TempBuffer[4*i+3]=0;this.updateUniform(e,o._TempBuffer,8)}_updateFloatForEffect(e,t){this._currentEffect.setFloat(e,t)}_updateFloatForUniform(e,t){o._TempBuffer[0]=t,this.updateUniform(e,o._TempBuffer,1)}_updateFloat2ForEffect(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setFloat2(e+r,t,i)}_updateFloat2ForUniform(e,t,i){o._TempBuffer[0]=t,o._TempBuffer[1]=i,this.updateUniform(e,o._TempBuffer,2)}_updateFloat3ForEffect(e,t,i,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setFloat3(e+s,t,i,r)}_updateFloat3ForUniform(e,t,i,r){o._TempBuffer[0]=t,o._TempBuffer[1]=i,o._TempBuffer[2]=r,this.updateUniform(e,o._TempBuffer,3)}_updateFloat4ForEffect(e,t,i,r,s){let n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setFloat4(e+n,t,i,r,s)}_updateFloat4ForUniform(e,t,i,r,s){o._TempBuffer[0]=t,o._TempBuffer[1]=i,o._TempBuffer[2]=r,o._TempBuffer[3]=s,this.updateUniform(e,o._TempBuffer,4)}_updateFloatArrayForEffect(e,t){this._currentEffect.setFloatArray(e,t)}_updateFloatArrayForUniform(e,t){this.updateUniformArray(e,t,t.length)}_updateArrayForEffect(e,t){this._currentEffect.setArray(e,t)}_updateArrayForUniform(e,t){this.updateUniformArray(e,t,t.length)}_updateIntArrayForEffect(e,t){this._currentEffect.setIntArray(e,t)}_updateIntArrayForUniform(e,t){o._TempBufferInt32View.set(t),this.updateUniformArray(e,o._TempBuffer,t.length)}_updateUIntArrayForEffect(e,t){this._currentEffect.setUIntArray(e,t)}_updateUIntArrayForUniform(e,t){o._TempBufferUInt32View.set(t),this.updateUniformArray(e,o._TempBuffer,t.length)}_updateMatrixForEffect(e,t){this._currentEffect.setMatrix(e,t)}_updateMatrixForUniform(e,t){this._cacheMatrix(e,t)&&this.updateUniform(e,t.asArray(),16)}_updateMatricesForEffect(e,t){this._currentEffect.setMatrices(e,t)}_updateMatricesForUniform(e,t){this.updateUniform(e,t,t.length)}_updateVector3ForEffect(e,t){this._currentEffect.setVector3(e,t)}_updateVector3ForUniform(e,t){o._TempBuffer[0]=t.x,o._TempBuffer[1]=t.y,o._TempBuffer[2]=t.z,this.updateUniform(e,o._TempBuffer,3)}_updateVector4ForEffect(e,t){this._currentEffect.setVector4(e,t)}_updateVector4ForUniform(e,t){o._TempBuffer[0]=t.x,o._TempBuffer[1]=t.y,o._TempBuffer[2]=t.z,o._TempBuffer[3]=t.w,this.updateUniform(e,o._TempBuffer,4)}_updateColor3ForEffect(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setColor3(e+i,t)}_updateColor3ForUniform(e,t){o._TempBuffer[0]=t.r,o._TempBuffer[1]=t.g,o._TempBuffer[2]=t.b,this.updateUniform(e,o._TempBuffer,3)}_updateColor4ForEffect(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setColor4(e+r,t,i)}_updateDirectColor4ForEffect(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setDirectColor4(e+i,t)}_updateColor4ForUniform(e,t,i){o._TempBuffer[0]=t.r,o._TempBuffer[1]=t.g,o._TempBuffer[2]=t.b,o._TempBuffer[3]=i,this.updateUniform(e,o._TempBuffer,4)}_updateDirectColor4ForUniform(e,t){o._TempBuffer[0]=t.r,o._TempBuffer[1]=t.g,o._TempBuffer[2]=t.b,o._TempBuffer[3]=t.a,this.updateUniform(e,o._TempBuffer,4)}_updateIntForEffect(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setInt(e+i,t)}_updateIntForUniform(e,t){o._TempBufferInt32View[0]=t,this.updateUniform(e,o._TempBuffer,1)}_updateInt2ForEffect(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setInt2(e+r,t,i)}_updateInt2ForUniform(e,t,i){o._TempBufferInt32View[0]=t,o._TempBufferInt32View[1]=i,this.updateUniform(e,o._TempBuffer,2)}_updateInt3ForEffect(e,t,i,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setInt3(e+s,t,i,r)}_updateInt3ForUniform(e,t,i,r){o._TempBufferInt32View[0]=t,o._TempBufferInt32View[1]=i,o._TempBufferInt32View[2]=r,this.updateUniform(e,o._TempBuffer,3)}_updateInt4ForEffect(e,t,i,r,s){let n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setInt4(e+n,t,i,r,s)}_updateInt4ForUniform(e,t,i,r,s){o._TempBufferInt32View[0]=t,o._TempBufferInt32View[1]=i,o._TempBufferInt32View[2]=r,o._TempBufferInt32View[3]=s,this.updateUniform(e,o._TempBuffer,4)}_updateUIntForEffect(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setUInt(e+i,t)}_updateUIntForUniform(e,t){o._TempBufferUInt32View[0]=t,this.updateUniform(e,o._TempBuffer,1)}_updateUInt2ForEffect(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setUInt2(e+r,t,i)}_updateUInt2ForUniform(e,t,i){o._TempBufferUInt32View[0]=t,o._TempBufferUInt32View[1]=i,this.updateUniform(e,o._TempBuffer,2)}_updateUInt3ForEffect(e,t,i,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setUInt3(e+s,t,i,r)}_updateUInt3ForUniform(e,t,i,r){o._TempBufferUInt32View[0]=t,o._TempBufferUInt32View[1]=i,o._TempBufferUInt32View[2]=r,this.updateUniform(e,o._TempBuffer,3)}_updateUInt4ForEffect(e,t,i,r,s){let n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setUInt4(e+n,t,i,r,s)}_updateUInt4ForUniform(e,t,i,r,s){o._TempBufferUInt32View[0]=t,o._TempBufferUInt32View[1]=i,o._TempBufferUInt32View[2]=r,o._TempBufferUInt32View[3]=s,this.updateUniform(e,o._TempBuffer,4)}setTexture(e,t){this._currentEffect.setTexture(e,t)}setTextureArray(e,t){this._currentEffect.setTextureArray(e,t)}bindTexture(e,t){this._currentEffect._bindTexture(e,t)}updateUniformDirectly(e,t){this.updateUniform(e,t,t.length),this.update()}bindToEffect(e,t){this._currentEffect=e,this._currentEffectName=t}bindUniformBuffer(){!this._noUBO&&this._buffer&&this._currentEffect&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName)}unbindEffect(){this._currentEffect=void 0,this._currentEffectName=void 0}setDataBuffer(e){if(!this._buffers)return this._buffer===e;for(let t=0;t<this._buffers.length;++t){if(this._buffers[t][0]===e)return this._bufferIndex=t,this._buffer=e,this._createBufferOnWrite=!1,this._currentEffect=void 0,!0}return!1}dispose(){if(this._noUBO)return;const e=this._engine._uniformBuffers,t=e.indexOf(this);if(-1!==t&&(e[t]=e[e.length-1],e.pop()),this._engine._features.trackUbosInFrame&&this._buffers)for(let i=0;i<this._buffers.length;++i){const e=this._buffers[i][0];this._engine._releaseBuffer(e)}else this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}}o._UpdatedUbosInFrame={},o._MAX_UNIFORM_SIZE=256,o._TempBuffer=new Float32Array(o._MAX_UNIFORM_SIZE),o._TempBufferInt32View=new Int32Array(o._TempBuffer.buffer),o._TempBufferUInt32View=new Uint32Array(o._TempBuffer.buffer)},6750:(e,t,i)=>{"use strict";i.d(t,{_0:()=>a});var r,s,n=i(5968);!function(e){e[e.LOCAL=0]="LOCAL",e[e.WORLD=1]="WORLD",e[e.BONE=2]="BONE"}(r||(r={}));class a{}a.X=new n.Pq(1,0,0),a.Y=new n.Pq(0,1,0),a.Z=new n.Pq(0,0,1),function(e){e[e.X=0]="X",e[e.Y=1]="Y",e[e.Z=2]="Z"}(s||(s={}))},6760:(e,t,i)=>{"use strict";i.d(t,{IG:()=>p,ov:()=>_,v9:()=>d});var r=i(4654),s=i(4141),n=i(9082),a=i(7559),o=i(852);function l(e){return Math.pow(e,n.tk)}function h(e){return e<=.04045?.0773993808*e:Math.pow(.947867299*(e+.055),2.4)}function c(e){return Math.pow(e,n.rv)}function u(e){return e<=.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}class d{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.r=e,this.g=t,this.b=i}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"}getClassName(){return"Color3"}getHashCode(){let e=255*this.r|0;return e=397*e^255*this.g,e=397*e^255*this.b,e}toArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,this}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return d.FromArrayToRef(e,t,this),this}toColor4(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return new _(this.r,this.g,this.b,e)}asArray(){return[this.r,this.g,this.b]}toLuminance(){return.3*this.r+.59*this.g+.11*this.b}multiply(e){return new d(this.r*e.r,this.g*e.g,this.b*e.b)}multiplyToRef(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,t}multiplyInPlace(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyByFloats(e,t,i){return new d(this.r*e,this.g*t,this.b*i)}divide(e){throw new ReferenceError("Can not divide a color")}divideToRef(e,t){throw new ReferenceError("Can not divide a color")}divideInPlace(e){throw new ReferenceError("Can not divide a color")}minimizeInPlace(e){return this.minimizeInPlaceFromFloats(e.r,e.g,e.b)}maximizeInPlace(e){return this.maximizeInPlaceFromFloats(e.r,e.g,e.b)}minimizeInPlaceFromFloats(e,t,i){return this.r=Math.min(e,this.r),this.g=Math.min(t,this.g),this.b=Math.min(i,this.b),this}maximizeInPlaceFromFloats(e,t,i){return this.r=Math.max(e,this.r),this.g=Math.max(t,this.g),this.b=Math.max(i,this.b),this}floorToRef(e){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(e){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}equals(e){return e&&this.r===e.r&&this.g===e.g&&this.b===e.b}equalsFloats(e,t,i){return this.equalsToFloats(e,t,i)}equalsToFloats(e,t,i){return this.r===e&&this.g===t&&this.b===i}equalsWithEpsilon(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.bH;return a.X.WithinEpsilon(this.r,e.r,t)&&a.X.WithinEpsilon(this.g,e.g,t)&&a.X.WithinEpsilon(this.b,e.b,t)}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(e){throw new ReferenceError("Can not negate a color")}scale(e){return new d(this.r*e,this.g*e,this.b*e)}scaleInPlace(e){return this.r*=e,this.g*=e,this.b*=e,this}scaleToRef(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,t}scaleAndAddToRef(e,t){return t.r+=this.r*e,t.g+=this.g*e,t.b+=this.b*e,t}clampToRef(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2?arguments[2]:void 0;return i.r=(0,o.OQ)(this.r,e,t),i.g=(0,o.OQ)(this.g,e,t),i.b=(0,o.OQ)(this.b,e,t),i}add(e){return new d(this.r+e.r,this.g+e.g,this.b+e.b)}addInPlace(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addInPlaceFromFloats(e,t,i){return this.r+=e,this.g+=t,this.b+=i,this}addToRef(e,t){return t.r=this.r+e.r,t.g=this.g+e.g,t.b=this.b+e.b,t}subtract(e){return new d(this.r-e.r,this.g-e.g,this.b-e.b)}subtractToRef(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,t}subtractInPlace(e){return this.r-=e.r,this.g-=e.g,this.b-=e.b,this}subtractFromFloats(e,t,i){return new d(this.r-e,this.g-t,this.b-i)}subtractFromFloatsToRef(e,t,i,r){return r.r=this.r-e,r.g=this.g-t,r.b=this.b-i,r}clone(){return new d(this.r,this.g,this.b)}copyFrom(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyFromFloats(e,t,i){return this.r=e,this.g=t,this.b=i,this}set(e,t,i){return this.copyFromFloats(e,t,i)}setAll(e){return this.r=this.g=this.b=e,this}toHexString(){const e=Math.round(255*this.r),t=Math.round(255*this.g),i=Math.round(255*this.b);return"#"+(0,o.Db)(e)+(0,o.Db)(t)+(0,o.Db)(i)}toHSV(){return this.toHSVToRef(new d)}toHSVToRef(e){const t=this.r,i=this.g,r=this.b,s=Math.max(t,i,r),n=Math.min(t,i,r);let a=0,o=0;const l=s,h=s-n;return 0!==s&&(o=h/s),s!=n&&(s==t?(a=(i-r)/h,i<r&&(a+=6)):s==i?a=(r-t)/h+2:s==r&&(a=(t-i)/h+4),a*=60),e.r=a,e.g=o,e.b=l,e}toLinearSpace(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=new d;return this.toLinearSpaceToRef(t,e),t}toLinearSpaceToRef(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(e.r=h(this.r),e.g=h(this.g),e.b=h(this.b)):(e.r=l(this.r),e.g=l(this.g),e.b=l(this.b)),this}toGammaSpace(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=new d;return this.toGammaSpaceToRef(t,e),t}toGammaSpaceToRef(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(e.r=u(this.r),e.g=u(this.g),e.b=u(this.b)):(e.r=c(this.r),e.g=c(this.g),e.b=c(this.b)),this}static HSVtoRGBToRef(e,t,i,r){const s=i*t,n=e/60,a=s*(1-Math.abs(n%2-1));let o=0,l=0,h=0;n>=0&&n<=1?(o=s,l=a):n>=1&&n<=2?(o=a,l=s):n>=2&&n<=3?(l=s,h=a):n>=3&&n<=4?(l=a,h=s):n>=4&&n<=5?(o=a,h=s):n>=5&&n<=6&&(o=s,h=a);const c=i-s;return r.r=o+c,r.g=l+c,r.b=h+c,r}static FromHSV(e,t,i){const r=new d(0,0,0);return d.HSVtoRGBToRef(e,t,i,r),r}static FromHexString(e){if("#"!==e.substring(0,1)||7!==e.length)return new d(0,0,0);const t=parseInt(e.substring(1,3),16),i=parseInt(e.substring(3,5),16),r=parseInt(e.substring(5,7),16);return d.FromInts(t,i,r)}static FromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new d(e[t],e[t+1],e[t+2])}static FromArrayToRef(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;i.r=e[t],i.g=e[t+1],i.b=e[t+2]}static FromInts(e,t,i){return new d(e/255,t/255,i/255)}static Lerp(e,t,i){const r=new d(0,0,0);return d.LerpToRef(e,t,i,r),r}static LerpToRef(e,t,i,r){r.r=e.r+(t.r-e.r)*i,r.g=e.g+(t.g-e.g)*i,r.b=e.b+(t.b-e.b)*i}static Hermite(e,t,i,r,s){const n=s*s,a=s*n,o=2*a-3*n+1,l=-2*a+3*n,h=a-2*n+s,c=a-n,u=e.r*o+i.r*l+t.r*h+r.r*c,_=e.g*o+i.g*l+t.g*h+r.g*c,p=e.b*o+i.b*l+t.b*h+r.b*c;return new d(u,_,p)}static Hermite1stDerivative(e,t,i,r,s){const n=d.Black();return this.Hermite1stDerivativeToRef(e,t,i,r,s,n),n}static Hermite1stDerivativeToRef(e,t,i,r,s,n){const a=s*s;n.r=6*(a-s)*e.r+(3*a-4*s+1)*t.r+6*(-a+s)*i.r+(3*a-2*s)*r.r,n.g=6*(a-s)*e.g+(3*a-4*s+1)*t.g+6*(-a+s)*i.g+(3*a-2*s)*r.g,n.b=6*(a-s)*e.b+(3*a-4*s+1)*t.b+6*(-a+s)*i.b+(3*a-2*s)*r.b}static Red(){return new d(1,0,0)}static Green(){return new d(0,1,0)}static Blue(){return new d(0,0,1)}static Black(){return new d(0,0,0)}static get BlackReadOnly(){return d._BlackReadOnly}static White(){return new d(1,1,1)}static Purple(){return new d(.5,0,.5)}static Magenta(){return new d(1,0,1)}static Yellow(){return new d(1,1,0)}static Gray(){return new d(.5,.5,.5)}static Teal(){return new d(0,1,1)}static Random(){return new d(Math.random(),Math.random(),Math.random())}}d._BlackReadOnly=d.Black(),Object.defineProperties(d.prototype,{dimension:{value:[3]},rank:{value:1}});class _{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.r=e,this.g=t,this.b=i,this.a=r}asArray(){return[this.r,this.g,this.b,this.a]}toArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e[t+3]=this.a,this}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this.a=e[t+3],this}equals(e){return e&&this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a}add(e){return new _(this.r+e.r,this.g+e.g,this.b+e.b,this.a+e.a)}addToRef(e,t){return t.r=this.r+e.r,t.g=this.g+e.g,t.b=this.b+e.b,t.a=this.a+e.a,t}addInPlace(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this.a+=e.a,this}addInPlaceFromFloats(e,t,i,r){return this.r+=e,this.g+=t,this.b+=i,this.a+=r,this}subtract(e){return new _(this.r-e.r,this.g-e.g,this.b-e.b,this.a-e.a)}subtractToRef(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,t.a=this.a-e.a,t}subtractInPlace(e){return this.r-=e.r,this.g-=e.g,this.b-=e.b,this.a-=e.a,this}subtractFromFloats(e,t,i,r){return new _(this.r-e,this.g-t,this.b-i,this.a-r)}subtractFromFloatsToRef(e,t,i,r,s){return s.r=this.r-e,s.g=this.g-t,s.b=this.b-i,s.a=this.a-r,s}scale(e){return new _(this.r*e,this.g*e,this.b*e,this.a*e)}scaleInPlace(e){return this.r*=e,this.g*=e,this.b*=e,this.a*=e,this}scaleToRef(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,t.a=this.a*e,t}scaleAndAddToRef(e,t){return t.r+=this.r*e,t.g+=this.g*e,t.b+=this.b*e,t.a+=this.a*e,t}clampToRef(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2?arguments[2]:void 0;return i.r=(0,o.OQ)(this.r,e,t),i.g=(0,o.OQ)(this.g,e,t),i.b=(0,o.OQ)(this.b,e,t),i.a=(0,o.OQ)(this.a,e,t),i}multiply(e){return new _(this.r*e.r,this.g*e.g,this.b*e.b,this.a*e.a)}multiplyToRef(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,t.a=this.a*e.a,t}multiplyInPlace(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this.a*=e.a,this}multiplyByFloats(e,t,i,r){return new _(this.r*e,this.g*t,this.b*i,this.a*r)}divide(e){throw new ReferenceError("Can not divide a color")}divideToRef(e,t){throw new ReferenceError("Can not divide a color")}divideInPlace(e){throw new ReferenceError("Can not divide a color")}minimizeInPlace(e){return this.r=Math.min(this.r,e.r),this.g=Math.min(this.g,e.g),this.b=Math.min(this.b,e.b),this.a=Math.min(this.a,e.a),this}maximizeInPlace(e){return this.r=Math.max(this.r,e.r),this.g=Math.max(this.g,e.g),this.b=Math.max(this.b,e.b),this.a=Math.max(this.a,e.a),this}minimizeInPlaceFromFloats(e,t,i,r){return this.r=Math.min(e,this.r),this.g=Math.min(t,this.g),this.b=Math.min(i,this.b),this.a=Math.min(r,this.a),this}maximizeInPlaceFromFloats(e,t,i,r){return this.r=Math.max(e,this.r),this.g=Math.max(t,this.g),this.b=Math.max(i,this.b),this.a=Math.max(r,this.a),this}floorToRef(e){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(e){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(e){throw new ReferenceError("Can not negate a color")}equalsWithEpsilon(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.bH;return a.X.WithinEpsilon(this.r,e.r,t)&&a.X.WithinEpsilon(this.g,e.g,t)&&a.X.WithinEpsilon(this.b,e.b,t)&&a.X.WithinEpsilon(this.a,e.a,t)}equalsToFloats(e,t,i,r){return this.r===e&&this.g===t&&this.b===i&&this.a===r}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"}getClassName(){return"Color4"}getHashCode(){let e=255*this.r|0;return e=397*e^255*this.g,e=397*e^255*this.b,e=397*e^255*this.a,e}clone(){return(new _).copyFrom(this)}copyFrom(e){return this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a,this}copyFromFloats(e,t,i,r){return this.r=e,this.g=t,this.b=i,this.a=r,this}set(e,t,i,r){return this.copyFromFloats(e,t,i,r)}setAll(e){return this.r=this.g=this.b=this.a=e,this}toHexString(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=Math.round(255*this.r),i=Math.round(255*this.g),r=Math.round(255*this.b);if(e)return"#"+(0,o.Db)(t)+(0,o.Db)(i)+(0,o.Db)(r);const s=Math.round(255*this.a);return"#"+(0,o.Db)(t)+(0,o.Db)(i)+(0,o.Db)(r)+(0,o.Db)(s)}toLinearSpace(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=new _;return this.toLinearSpaceToRef(t,e),t}toLinearSpaceToRef(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(e.r=h(this.r),e.g=h(this.g),e.b=h(this.b)):(e.r=l(this.r),e.g=l(this.g),e.b=l(this.b)),e.a=this.a,this}toGammaSpace(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=new _;return this.toGammaSpaceToRef(t,e),t}toGammaSpaceToRef(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(e.r=u(this.r),e.g=u(this.g),e.b=u(this.b)):(e.r=c(this.r),e.g=c(this.g),e.b=c(this.b)),e.a=this.a,this}static FromHexString(e){if("#"!==e.substring(0,1)||9!==e.length&&7!==e.length)return new _(0,0,0,0);const t=parseInt(e.substring(1,3),16),i=parseInt(e.substring(3,5),16),r=parseInt(e.substring(5,7),16),s=9===e.length?parseInt(e.substring(7,9),16):255;return _.FromInts(t,i,r,s)}static Lerp(e,t,i){return _.LerpToRef(e,t,i,new _)}static LerpToRef(e,t,i,r){return r.r=e.r+(t.r-e.r)*i,r.g=e.g+(t.g-e.g)*i,r.b=e.b+(t.b-e.b)*i,r.a=e.a+(t.a-e.a)*i,r}static Hermite(e,t,i,r,s){const n=s*s,a=s*n,o=2*a-3*n+1,l=-2*a+3*n,h=a-2*n+s,c=a-n,u=e.r*o+i.r*l+t.r*h+r.r*c,d=e.g*o+i.g*l+t.g*h+r.g*c,p=e.b*o+i.b*l+t.b*h+r.b*c,f=e.a*o+i.a*l+t.a*h+r.a*c;return new _(u,d,p,f)}static Hermite1stDerivative(e,t,i,r,s){const n=new _;return this.Hermite1stDerivativeToRef(e,t,i,r,s,n),n}static Hermite1stDerivativeToRef(e,t,i,r,s,n){const a=s*s;n.r=6*(a-s)*e.r+(3*a-4*s+1)*t.r+6*(-a+s)*i.r+(3*a-2*s)*r.r,n.g=6*(a-s)*e.g+(3*a-4*s+1)*t.g+6*(-a+s)*i.g+(3*a-2*s)*r.g,n.b=6*(a-s)*e.b+(3*a-4*s+1)*t.b+6*(-a+s)*i.b+(3*a-2*s)*r.b,n.a=6*(a-s)*e.a+(3*a-4*s+1)*t.a+6*(-a+s)*i.a+(3*a-2*s)*r.a}static FromColor3(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new _(e.r,e.g,e.b,t)}static FromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new _(e[t],e[t+1],e[t+2],e[t+3])}static FromArrayToRef(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;i.r=e[t],i.g=e[t+1],i.b=e[t+2],i.a=e[t+3]}static FromInts(e,t,i,r){return new _(e/255,t/255,i/255,r/255)}static CheckColors4(e,t){if(e.length===3*t){const t=[];for(let i=0;i<e.length;i+=3){const r=i/3*4;t[r]=e[i],t[r+1]=e[i+1],t[r+2]=e[i+2],t[r+3]=1}return t}return e}}Object.defineProperties(_.prototype,{dimension:{value:[4]},rank:{value:1}});class p{}p.Color3=(0,r.mI)(3,d.Black),p.Color4=(0,r.mI)(3,(()=>new _(0,0,0,0))),(0,s.Y5)("BABYLON.Color3",d),(0,s.Y5)("BABYLON.Color4",_)},9082:(e,t,i)=>{"use strict";i.d(t,{a6:()=>n,bH:()=>a,rv:()=>r,tk:()=>s});const r=1/2.2,s=2.2,n=(1+Math.sqrt(5))/2,a=.001},1989:(e,t,i)=>{"use strict";i.d(t,{P:()=>s});var r=i(5017);class s{static GetPlanes(e){const t=[];for(let i=0;i<6;i++)t.push(new r.Z(0,0,0,0));return s.GetPlanesToRef(e,t),t}static GetNearPlaneToRef(e,t){const i=e.m;t.normal.x=i[3]+i[2],t.normal.y=i[7]+i[6],t.normal.z=i[11]+i[10],t.d=i[15]+i[14],t.normalize()}static GetFarPlaneToRef(e,t){const i=e.m;t.normal.x=i[3]-i[2],t.normal.y=i[7]-i[6],t.normal.z=i[11]-i[10],t.d=i[15]-i[14],t.normalize()}static GetLeftPlaneToRef(e,t){const i=e.m;t.normal.x=i[3]+i[0],t.normal.y=i[7]+i[4],t.normal.z=i[11]+i[8],t.d=i[15]+i[12],t.normalize()}static GetRightPlaneToRef(e,t){const i=e.m;t.normal.x=i[3]-i[0],t.normal.y=i[7]-i[4],t.normal.z=i[11]-i[8],t.d=i[15]-i[12],t.normalize()}static GetTopPlaneToRef(e,t){const i=e.m;t.normal.x=i[3]-i[1],t.normal.y=i[7]-i[5],t.normal.z=i[11]-i[9],t.d=i[15]-i[13],t.normalize()}static GetBottomPlaneToRef(e,t){const i=e.m;t.normal.x=i[3]+i[1],t.normal.y=i[7]+i[5],t.normal.z=i[11]+i[9],t.d=i[15]+i[13],t.normalize()}static GetPlanesToRef(e,t){s.GetNearPlaneToRef(e,t[0]),s.GetFarPlaneToRef(e,t[1]),s.GetLeftPlaneToRef(e,t[2]),s.GetRightPlaneToRef(e,t[3]),s.GetTopPlaneToRef(e,t[4]),s.GetBottomPlaneToRef(e,t[5])}static IsPointInFrustum(e,t){for(let i=0;i<6;i++)if(t[i].dotCoordinate(e)<0)return!1;return!0}}},8386:(e,t,i)=>{"use strict";i.d(t,{v9:()=>r.v9,ov:()=>r.ov,IG:()=>r.IG,AA:()=>s.AA});i(6750);var r=i(6760),s=(i(9082),i(1989),i(200),i(5017),i(3518),i(5968));i(4857)},200:(e,t,i)=>{"use strict";i.d(t,{Cu:()=>c,jj:()=>d,tO:()=>u,vr:()=>o});var r,s=i(7559),n=i(5968),a=i(9082);!function(e){e[e.CW=0]="CW",e[e.CCW=1]="CCW"}(r||(r={}));class o{static Interpolate(e,t,i,r,s){const n=1-3*r+3*t,a=3*r-6*t,o=3*t;let l=e;for(let h=0;h<5;h++){const t=l*l;l-=(n*(t*l)+a*t+o*l-e)*(1/(3*n*t+2*a*l+o)),l=Math.min(1,Math.max(0,l))}return 3*Math.pow(1-l,2)*l*i+3*(1-l)*Math.pow(l,2)*s+Math.pow(l,3)}}class l{constructor(e){this._radians=e,this._radians<0&&(this._radians+=2*Math.PI)}degrees(){return 180*this._radians/Math.PI}radians(){return this._radians}static BetweenTwoPoints(e,t){const i=t.subtract(e),r=Math.atan2(i.y,i.x);return new l(r)}static BetweenTwoVectors(e,t){let i=e.lengthSquared()*t.lengthSquared();if(0===i)return new l(Math.PI/2);i=Math.sqrt(i);let r=e.dot(t)/i;r=s.X.Clamp(r,-1,1);const n=Math.acos(r);return new l(n)}static FromRadians(e){return new l(e)}static FromDegrees(e){return new l(e*Math.PI/180)}}class h{constructor(e,t,i){this.startPoint=e,this.midPoint=t,this.endPoint=i;const r=Math.pow(t.x,2)+Math.pow(t.y,2),s=(Math.pow(e.x,2)+Math.pow(e.y,2)-r)/2,a=(r-Math.pow(i.x,2)-Math.pow(i.y,2))/2,o=(e.x-t.x)*(t.y-i.y)-(t.x-i.x)*(e.y-t.y);this.centerPoint=new n.I9((s*(t.y-i.y)-a*(e.y-t.y))/o,((e.x-t.x)*a-(t.x-i.x)*s)/o),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=l.BetweenTwoPoints(this.centerPoint,this.startPoint);const h=this.startAngle.degrees();let c=l.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),u=l.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();c-h>180&&(c-=360),c-h<-180&&(c+=360),u-c>180&&(u-=360),u-c<-180&&(u+=360),this.orientation=c-h<0?0:1,this.angle=l.FromDegrees(0===this.orientation?h-u:u-h)}}class c{constructor(e,t){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new n.I9(e,t))}addLineTo(e,t){if(this.closed)return this;const i=new n.I9(e,t),r=this._points[this._points.length-1];return this._points.push(i),this._length+=i.subtract(r).length(),this}addArcTo(e,t,i,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const a=this._points[this._points.length-1],o=new n.I9(e,t),l=new n.I9(i,r),c=new h(a,o,l);let u=c.angle.radians()/s;0===c.orientation&&(u*=-1);let d=c.startAngle.radians()+u;for(let n=0;n<s;n++){const e=Math.cos(d)*c.radius+c.centerPoint.x,t=Math.sin(d)*c.radius+c.centerPoint.y;this.addLineTo(e,t),d+=u}return this}addQuadraticCurveTo(e,t,i,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const n=(e,t,i,r)=>(1-e)*(1-e)*t+2*e*(1-e)*i+e*e*r,a=this._points[this._points.length-1];for(let o=0;o<=s;o++){const l=o/s,h=n(l,a.x,e,i),c=n(l,a.y,t,r);this.addLineTo(h,c)}return this}addBezierCurveTo(e,t,i,r,s,n){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:36;if(this.closed)return this;const o=(e,t,i,r,s)=>(1-e)*(1-e)*(1-e)*t+3*e*(1-e)*(1-e)*i+3*e*e*(1-e)*r+e*e*e*s,l=this._points[this._points.length-1];for(let h=0;h<=a;h++){const c=h/a,u=o(c,l.x,e,i,s),d=o(c,l.y,t,r,n);this.addLineTo(u,d)}return this}isPointInside(e){let t=!1;const i=this._points.length;for(let r=i-1,s=0;s<i;r=s++){let i=this._points[r],n=this._points[s],a=n.x-i.x,o=n.y-i.y;if(Math.abs(o)>Number.EPSILON){if(o<0&&(i=this._points[s],a=-a,n=this._points[r],o=-o),e.y<i.y||e.y>n.y)continue;if(e.y===i.y&&e.x===i.x)return!0;{const r=o*(e.x-i.x)-a*(e.y-i.y);if(0===r)return!0;if(r<0)continue;t=!t}}else{if(e.y!==i.y)continue;if(n.x<=e.x&&e.x<=i.x||i.x<=e.x&&e.x<=n.x)return!0}}return t}close(){return this.closed=!0,this}length(){let e=this._length;if(this.closed){const t=this._points[this._points.length-1];e+=this._points[0].subtract(t).length()}return e}area(){const e=this._points.length;let t=0;for(let i=e-1,r=0;r<e;i=r++)t+=this._points[i].x*this._points[r].y-this._points[r].x*this._points[i].y;return.5*t}getPoints(){return this._points}getPointAtLengthPosition(e){if(e<0||e>1)return n.I9.Zero();const t=e*this.length();let i=0;for(let r=0;r<this._points.length;r++){const e=(r+1)%this._points.length,s=this._points[r],a=this._points[e].subtract(s),o=a.length()+i;if(t>=i&&t<=o){const e=a.normalize(),r=t-i;return new n.I9(s.x+e.x*r,s.y+e.y*r)}i=o}return n.I9.Zero()}static StartingAt(e,t){return new c(e,t)}}class u{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.path=e,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array,this._pointAtData={id:0,point:n.Pq.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:n.uq.Identity()};for(let s=0;s<e.length;s++)this._curve[s]=e[s].clone();this._raw=i||!1,this._alignTangentsWithPath=r,this._compute(t,r)}getCurve(){return this._curve}getPoints(){return this._curve}length(){return this._distances[this._distances.length-1]}getTangents(){return this._tangents}getNormals(){return this._normals}getBinormals(){return this._binormals}getDistances(){return this._distances}getPointAt(e){return this._updatePointAtData(e).point}getTangentAt(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(e,t),t?n.Pq.TransformCoordinates(n.Pq.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]}getNormalAt(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(e,t),t?n.Pq.TransformCoordinates(n.Pq.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]}getBinormalAt(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(e,t),t?n.Pq.TransformCoordinates(n.Pq.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]}getDistanceAt(e){return this.length()*e}getPreviousPointIndexAt(e){return this._updatePointAtData(e),this._pointAtData.previousPointArrayIndex}getSubPositionAt(e){return this._updatePointAtData(e),this._pointAtData.subPosition}getClosestPositionTo(e){let t=Number.MAX_VALUE,i=0;for(let r=0;r<this._curve.length-1;r++){const s=this._curve[r+0],a=this._curve[r+1].subtract(s).normalize(),o=this._distances[r+1]-this._distances[r+0],l=Math.min(Math.max(n.Pq.Dot(a,e.subtract(s).normalize()),0)*n.Pq.Distance(s,e)/o,1),h=n.Pq.Distance(s.add(a.scale(l*o)),e);h<t&&(t=h,i=(this._distances[r+0]+o*l)/this.length())}return i}slice(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(e<0&&(e=1- -1*e%1),t<0&&(t=1- -1*t%1),e>t){const i=e;e=t,t=i}const i=this.getCurve(),r=this.getPointAt(e);let s=this.getPreviousPointIndexAt(e);const n=this.getPointAt(t),a=this.getPreviousPointIndexAt(t)+1,o=[];return 0!==e&&(s++,o.push(r)),o.push(...i.slice(s,a)),1===t&&1!==e||o.push(n),new u(o,this.getNormalAt(e),this._raw,this._alignTangentsWithPath)}update(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(let r=0;r<e.length;r++)this._curve[r].x=e[r].x,this._curve[r].y=e[r].y,this._curve[r].z=e[r].z;return this._compute(t,i),this}_compute(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=this._curve.length;if(i<2)return;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[i-1]=this._curve[i-1].subtract(this._curve[i-2]),this._raw||this._tangents[i-1].normalize();const r=this._tangents[0],s=this._normalVector(r,e);let a,o,l,h,c;this._normals[0]=s,this._raw||this._normals[0].normalize(),this._binormals[0]=n.Pq.Cross(r,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(let u=1;u<i;u++)a=this._getLastNonNullVector(u),u<i-1&&(o=this._getFirstNonNullVector(u),this._tangents[u]=t?o:a.add(o),this._tangents[u].normalize()),this._distances[u]=this._distances[u-1]+this._curve[u].subtract(this._curve[u-1]).length(),l=this._tangents[u],c=this._binormals[u-1],this._normals[u]=n.Pq.Cross(c,l),this._raw||(0===this._normals[u].length()?(h=this._normals[u-1],this._normals[u]=h.clone()):this._normals[u].normalize()),this._binormals[u]=n.Pq.Cross(l,this._normals[u]),this._raw||this._binormals[u].normalize();this._pointAtData.id=NaN}_getFirstNonNullVector(e){let t=1,i=this._curve[e+t].subtract(this._curve[e]);for(;0===i.length()&&e+t+1<this._curve.length;)t++,i=this._curve[e+t].subtract(this._curve[e]);return i}_getLastNonNullVector(e){let t=1,i=this._curve[e].subtract(this._curve[e-t]);for(;0===i.length()&&e>t+1;)t++,i=this._curve[e].subtract(this._curve[e-t]);return i}_normalVector(e,t){let i,r=e.length();if(0===r&&(r=1),void 0===t||null===t){let t;t=s.X.WithinEpsilon(Math.abs(e.y)/r,1,a.bH)?s.X.WithinEpsilon(Math.abs(e.x)/r,1,a.bH)?s.X.WithinEpsilon(Math.abs(e.z)/r,1,a.bH)?n.Pq.Zero():new n.Pq(0,0,1):new n.Pq(1,0,0):new n.Pq(0,-1,0),i=n.Pq.Cross(e,t)}else i=n.Pq.Cross(e,t),n.Pq.CrossToRef(i,e,i);return i.normalize(),i}_updatePointAtData(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._pointAtData.id===e)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=e;const i=this.getPoints();if(e<=0)return this._setPointAtData(0,0,i[0],0,t);if(e>=1)return this._setPointAtData(1,1,i[i.length-1],i.length-1,t);let r,s=i[0],a=0;const o=e*this.length();for(let l=1;l<i.length;l++){r=i[l];const h=n.Pq.Distance(s,r);if(a+=h,a===o)return this._setPointAtData(e,1,r,l,t);if(a>o){const i=(a-o)/h,n=s.subtract(r),c=r.add(n.scaleInPlace(i));return this._setPointAtData(e,1-i,c,l-1,t)}s=r}return this._pointAtData}_setPointAtData(e,t,i,r,s){return this._pointAtData.point=i,this._pointAtData.position=e,this._pointAtData.subPosition=t,this._pointAtData.previousPointArrayIndex=r,this._pointAtData.interpolateReady=s,s&&this._updateInterpolationMatrix(),this._pointAtData}_updateInterpolationMatrix(){this._pointAtData.interpolationMatrix=n.uq.Identity();const e=this._pointAtData.previousPointArrayIndex;if(e!==this._tangents.length-1){const t=e+1,i=this._tangents[e].clone(),r=this._normals[e].clone(),s=this._binormals[e].clone(),a=this._tangents[t].clone(),o=this._normals[t].clone(),l=this._binormals[t].clone(),h=n.PT.RotationQuaternionFromAxis(r,s,i),c=n.PT.RotationQuaternionFromAxis(o,l,a);n.PT.Slerp(h,c,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}}}class d{static CreateQuadraticBezier(e,t,i,r){r=r>2?r:3;const s=[],a=(e,t,i,r)=>(1-e)*(1-e)*t+2*e*(1-e)*i+e*e*r;for(let o=0;o<=r;o++)s.push(new n.Pq(a(o/r,e.x,t.x,i.x),a(o/r,e.y,t.y,i.y),a(o/r,e.z,t.z,i.z)));return new d(s)}static CreateCubicBezier(e,t,i,r,s){s=s>3?s:4;const a=[],o=(e,t,i,r,s)=>(1-e)*(1-e)*(1-e)*t+3*e*(1-e)*(1-e)*i+3*e*e*(1-e)*r+e*e*e*s;for(let l=0;l<=s;l++)a.push(new n.Pq(o(l/s,e.x,t.x,i.x,r.x),o(l/s,e.y,t.y,i.y,r.y),o(l/s,e.z,t.z,i.z,r.z)));return new d(a)}static CreateHermiteSpline(e,t,i,r,s){const a=[],o=1/s;for(let l=0;l<=s;l++)a.push(n.Pq.Hermite(e,t,i,r,l*o));return new d(a)}static CreateCatmullRomSpline(e,t,i){const r=[],s=1/t;let a=0;if(i){const i=e.length;for(let o=0;o<i;o++){a=0;for(let l=0;l<t;l++)r.push(n.Pq.CatmullRom(e[o%i],e[(o+1)%i],e[(o+2)%i],e[(o+3)%i],a)),a+=s}r.push(r[0])}else{const i=[];i.push(e[0].clone()),Array.prototype.push.apply(i,e),i.push(e[e.length-1].clone());let o=0;for(;o<i.length-3;o++){a=0;for(let e=0;e<t;e++)r.push(n.Pq.CatmullRom(i[o],i[o+1],i[o+2],i[o+3],a)),a+=s}o--,r.push(n.Pq.CatmullRom(i[o],i[o+1],i[o+2],i[o+3],a))}return new d(r)}static ArcThru3Points(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:32,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const o=[],l=t.subtract(e),h=i.subtract(t),c=e.subtract(i),u=n.Pq.Cross(l,h),_=u.length();if(_<Math.pow(10,-8))return new d(o);const p=l.lengthSquared(),f=h.lengthSquared(),g=c.lengthSquared(),m=u.lengthSquared(),b=.5*l.length()*h.length()*c.length()/_,v=-.5*f*n.Pq.Dot(l,c)/m,y=-.5*g*n.Pq.Dot(l,h)/m,T=-.5*p*n.Pq.Dot(h,c)/m,x=e.scale(v).add(t.scale(y)).add(i.scale(T)),A=e.subtract(x).normalize(),C=n.Pq.Cross(u,A).normalize();if(a){const t=2*Math.PI/r;for(let e=0;e<=2*Math.PI;e+=t)o.push(x.add(A.scale(b*Math.cos(e)).add(C.scale(b*Math.sin(e)))));o.push(e)}else{const t=1/r;let a=0,l=n.Pq.Zero();do{l=x.add(A.scale(b*Math.cos(a)).add(C.scale(b*Math.sin(a)))),o.push(l),a+=t}while(!l.equalsWithEpsilon(i,b*t*1.1));o.push(i),s&&o.push(e)}return new d(o)}constructor(e){this._length=0,this._points=e,this._length=this._computeLength(e)}getPoints(){return this._points}length(){return this._length}continue(e){const t=this._points[this._points.length-1],i=this._points.slice(),r=e.getPoints();for(let s=1;s<r.length;s++)i.push(r[s].subtract(r[0]).add(t));return new d(i)}_computeLength(e){let t=0;for(let i=1;i<e.length;i++)t+=e[i].subtract(e[i-1]).length();return t}}},5017:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var r=i(5968);class s{constructor(e,t,i,s){this.normal=new r.Pq(e,t,i),this.d=s}asArray(){return[this.normal.x,this.normal.y,this.normal.z,this.d]}clone(){return new s(this.normal.x,this.normal.y,this.normal.z,this.d)}getClassName(){return"Plane"}getHashCode(){let e=this.normal.getHashCode();return e=397*e^this.d,e}normalize(){const e=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z);let t=0;return 0!==e&&(t=1/e),this.normal.x*=t,this.normal.y*=t,this.normal.z*=t,this.d*=t,this}transform(e){const t=s._TmpMatrix;e.invertToRef(t);const i=t.m,r=this.normal.x,n=this.normal.y,a=this.normal.z,o=this.d,l=r*i[0]+n*i[1]+a*i[2]+o*i[3],h=r*i[4]+n*i[5]+a*i[6]+o*i[7],c=r*i[8]+n*i[9]+a*i[10]+o*i[11],u=r*i[12]+n*i[13]+a*i[14]+o*i[15];return new s(l,h,c,u)}dotCoordinate(e){return this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z+this.d}copyFromPoints(e,t,i){const r=t.x-e.x,s=t.y-e.y,n=t.z-e.z,a=i.x-e.x,o=i.y-e.y,l=i.z-e.z,h=s*l-n*o,c=n*a-r*l,u=r*o-s*a,d=Math.sqrt(h*h+c*c+u*u);let _;return _=0!==d?1/d:0,this.normal.x=h*_,this.normal.y=c*_,this.normal.z=u*_,this.d=-(this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z),this}isFrontFacingTo(e,t){return r.Pq.Dot(this.normal,e)<=t}signedDistanceTo(e){return r.Pq.Dot(e,this.normal)+this.d}static FromArray(e){return new s(e[0],e[1],e[2],e[3])}static FromPoints(e,t,i){const r=new s(0,0,0,0);return r.copyFromPoints(e,t,i),r}static FromPositionAndNormal(e,t){const i=new s(0,0,0,0);return this.FromPositionAndNormalToRef(e,t,i)}static FromPositionAndNormalToRef(e,t,i){return i.normal.copyFrom(t),i.normal.normalize(),i.d=-e.dot(i.normal),i}static SignedDistanceToPlaneFromPositionAndNormal(e,t,i){const s=-(t.x*e.x+t.y*e.y+t.z*e.z);return r.Pq.Dot(i,t)+s}}s._TmpMatrix=r.uq.Identity()},852:(e,t,i)=>{"use strict";function r(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1401298e-51;return Math.abs(e-t)<=i}function s(e,t){return e===t?e:Math.random()*(t-e)+e}function n(e,t,i){return e+(t-e)*i}function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(i,Math.max(t,e))}function o(e){return e-=2*Math.PI*Math.floor((e+Math.PI)/(2*Math.PI))}function l(e){const t=e.toString(16);return e<=15?("0"+t).toUpperCase():t.toUpperCase()}i.d(t,{Db:()=>l,Mj:()=>r,OQ:()=>a,VD:()=>s,cP:()=>n,ed:()=>o})},7559:(e,t,i)=>{"use strict";i.d(t,{X:()=>s});var r=i(852);class s{static Sign(e){return 0===(e=+e)||isNaN(e)?e:e>0?1:-1}static Log2(e){return Math.log(e)*Math.LOG2E}static ILog2(e){if(Math.log2)return Math.floor(Math.log2(e));if(e<0)return NaN;if(0===e)return-1/0;let t=0;if(e<1){for(;e<1;)t++,e*=2;t=-t}else if(e>1)for(;e>1;)t++,e=Math.floor(e/2);return t}static Repeat(e,t){return e-Math.floor(e/t)*t}static Normalize(e,t,i){return(e-t)/(i-t)}static Denormalize(e,t,i){return e*(i-t)+t}static DeltaAngle(e,t){let i=s.Repeat(t-e,360);return i>180&&(i-=360),i}static PingPong(e,t){const i=s.Repeat(e,2*t);return t-Math.abs(i-t)}static SmoothStep(e,t,i){let r=s.Clamp(i);return r=-2*r*r*r+3*r*r,t*r+e*(1-r)}static MoveTowards(e,t,i){let r=0;return r=Math.abs(t-e)<=i?t:e+s.Sign(t-e)*i,r}static MoveTowardsAngle(e,t,i){const r=s.DeltaAngle(e,t);let n=0;return-i<r&&r<i?n=t:(t=e+r,n=s.MoveTowards(e,t,i)),n}static LerpAngle(e,t,i){let n=s.Repeat(t-e,360);return n>180&&(n-=360),e+n*(0,r.OQ)(i)}static InverseLerp(e,t,i){let s=0;return s=e!=t?(0,r.OQ)((i-e)/(t-e)):0,s}static Hermite(e,t,i,r,s){const n=s*s,a=s*n;return e*(2*a-3*n+1)+i*(-2*a+3*n)+t*(a-2*n+s)+r*(a-n)}static Hermite1stDerivative(e,t,i,r,s){const n=s*s;return 6*(n-s)*e+(3*n-4*s+1)*t+6*(-n+s)*i+(3*n-2*s)*r}static RangeToPercent(e,t,i){return(e-t)/(i-t)}static PercentToRange(e,t,i){return(i-t)*e+t}static HCF(e,t){const i=e%t;return 0===i?t:s.HCF(t,i)}}s.TwoPi=2*Math.PI,s.WithinEpsilon=r.Mj,s.ToHex=r.Db,s.Clamp=r.OQ,s.Lerp=r.cP,s.RandomRange=r.VD,s.NormalizeRadians=r.ed},3518:(e,t,i)=>{"use strict";i.d(t,{o:()=>r});class r{constructor(e,t){this.width=e,this.height=t}toString(){return`{W: ${this.width}, H: ${this.height}}`}getClassName(){return"Size"}getHashCode(){let e=0|this.width;return e=397*e^this.height,e}copyFrom(e){this.width=e.width,this.height=e.height}copyFromFloats(e,t){return this.width=e,this.height=t,this}set(e,t){return this.copyFromFloats(e,t)}multiplyByFloats(e,t){return new r(this.width*e,this.height*t)}clone(){return new r(this.width,this.height)}equals(e){return!!e&&(this.width===e.width&&this.height===e.height)}get surface(){return this.width*this.height}static Zero(){return new r(0,0)}add(e){return new r(this.width+e.width,this.height+e.height)}subtract(e){return new r(this.width-e.width,this.height-e.height)}scale(e){return new r(this.width*e,this.height*e)}static Lerp(e,t,i){const s=e.width+(t.width-e.width)*i,n=e.height+(t.height-e.height)*i;return new r(s,n)}}},5968:(e,t,i)=>{"use strict";i.d(t,{AA:()=>g,I9:()=>c,IU:()=>d,PT:()=>_,Pq:()=>u,uq:()=>p});var r=i(9082),s=i(4654),n=i(4141),a=i(2788),o=i(4072),l=i(852);const h=e=>parseInt(e.toString().replace(/\W/g,""));class c{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=e,this.y=t}toString(){return`{X: ${this.x} Y: ${this.y}}`}getClassName(){return"Vector2"}getHashCode(){let e=h(this.x);return e=397*e^h(this.y),e}toArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,this}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return c.FromArrayToRef(e,t,this),this}asArray(){return[this.x,this.y]}copyFrom(e){return this.x=e.x,this.y=e.y,this}copyFromFloats(e,t){return this.x=e,this.y=t,this}set(e,t){return this.copyFromFloats(e,t)}setAll(e){return this.copyFromFloats(e,e)}add(e){return new c(this.x+e.x,this.y+e.y)}addToRef(e,t){return t.x=this.x+e.x,t.y=this.y+e.y,t}addInPlace(e){return this.x+=e.x,this.y+=e.y,this}addInPlaceFromFloats(e,t){return this.x+=e,this.y+=t,this}addVector3(e){return new c(this.x+e.x,this.y+e.y)}subtract(e){return new c(this.x-e.x,this.y-e.y)}subtractToRef(e,t){return t.x=this.x-e.x,t.y=this.y-e.y,t}subtractInPlace(e){return this.x-=e.x,this.y-=e.y,this}multiplyInPlace(e){return this.x*=e.x,this.y*=e.y,this}multiply(e){return new c(this.x*e.x,this.y*e.y)}multiplyToRef(e,t){return t.x=this.x*e.x,t.y=this.y*e.y,t}multiplyByFloats(e,t){return new c(this.x*e,this.y*t)}divide(e){return new c(this.x/e.x,this.y/e.y)}divideToRef(e,t){return t.x=this.x/e.x,t.y=this.y/e.y,t}divideInPlace(e){return this.x=this.x/e.x,this.y=this.y/e.y,this}minimizeInPlace(e){return this.minimizeInPlaceFromFloats(e.x,e.y)}maximizeInPlace(e){return this.maximizeInPlaceFromFloats(e.x,e.y)}minimizeInPlaceFromFloats(e,t){return this.x=Math.min(e,this.x),this.y=Math.min(t,this.y),this}maximizeInPlaceFromFloats(e,t){return this.x=Math.max(e,this.x),this.y=Math.max(t,this.y),this}subtractFromFloats(e,t){return new c(this.x-e,this.y-t)}subtractFromFloatsToRef(e,t,i){return i.x=this.x-e,i.y=this.y-t,i}negate(){return new c(-this.x,-this.y)}negateInPlace(){return this.x*=-1,this.y*=-1,this}negateToRef(e){return e.x=-this.x,e.y=-this.y,e}scaleInPlace(e){return this.x*=e,this.y*=e,this}scale(e){return new c(this.x*e,this.y*e)}scaleToRef(e,t){return t.x=this.x*e,t.y=this.y*e,t}scaleAndAddToRef(e,t){return t.x+=this.x*e,t.y+=this.y*e,t}equals(e){return e&&this.x===e.x&&this.y===e.y}equalsWithEpsilon(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.bH;return e&&(0,l.Mj)(this.x,e.x,t)&&(0,l.Mj)(this.y,e.y,t)}equalsToFloats(e,t){return this.x===e&&this.y===t}floor(){return new c(Math.floor(this.x),Math.floor(this.y))}floorToRef(e){return e.x=Math.floor(this.x),e.y=Math.floor(this.y),e}fract(){return new c(this.x-Math.floor(this.x),this.y-Math.floor(this.y))}fractToRef(e){return e.x=this.x-Math.floor(this.x),e.y=this.y-Math.floor(this.y),e}rotateToRef(e,t){const i=Math.cos(e),r=Math.sin(e),s=i*this.x-r*this.y,n=r*this.x+i*this.y;return t.x=s,t.y=n,t}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSquared(){return this.x*this.x+this.y*this.y}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(e){return 0===e||1===e?this:this.scaleInPlace(1/e)}normalizeToNew(){const e=new c;return this.normalizeToRef(e),e}normalizeToRef(e){const t=this.length();return 0===t&&(e.x=this.x,e.y=this.y),this.scaleToRef(1/t,e)}clone(){return new c(this.x,this.y)}dot(e){return this.x*e.x+this.y*e.y}static Zero(){return new c(0,0)}static One(){return new c(1,1)}static Random(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new c((0,l.VD)(e,t),(0,l.VD)(e,t))}static RandomToRef(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).copyFromFloats((0,l.VD)(e,t),(0,l.VD)(e,t))}static get ZeroReadOnly(){return c._ZeroReadOnly}static FromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new c(e[t],e[t+1])}static FromArrayToRef(e,t,i){return i.x=e[t],i.y=e[t+1],i}static FromFloatsToRef(e,t,i){return i.copyFromFloats(e,t),i}static CatmullRom(e,t,i,r,s){const n=s*s,a=s*n,o=.5*(2*t.x+(-e.x+i.x)*s+(2*e.x-5*t.x+4*i.x-r.x)*n+(-e.x+3*t.x-3*i.x+r.x)*a),l=.5*(2*t.y+(-e.y+i.y)*s+(2*e.y-5*t.y+4*i.y-r.y)*n+(-e.y+3*t.y-3*i.y+r.y)*a);return new c(o,l)}static ClampToRef(e,t,i,r){return r.x=(0,l.OQ)(e.x,t.x,i.x),r.y=(0,l.OQ)(e.y,t.y,i.y),r}static Clamp(e,t,i){const r=(0,l.OQ)(e.x,t.x,i.x),s=(0,l.OQ)(e.y,t.y,i.y);return new c(r,s)}static Hermite(e,t,i,r,s){const n=s*s,a=s*n,o=2*a-3*n+1,l=-2*a+3*n,h=a-2*n+s,u=a-n,d=e.x*o+i.x*l+t.x*h+r.x*u,_=e.y*o+i.y*l+t.y*h+r.y*u;return new c(d,_)}static Hermite1stDerivative(e,t,i,r,s){return this.Hermite1stDerivativeToRef(e,t,i,r,s,new c)}static Hermite1stDerivativeToRef(e,t,i,r,s,n){const a=s*s;return n.x=6*(a-s)*e.x+(3*a-4*s+1)*t.x+6*(-a+s)*i.x+(3*a-2*s)*r.x,n.y=6*(a-s)*e.y+(3*a-4*s+1)*t.y+6*(-a+s)*i.y+(3*a-2*s)*r.y,n}static Lerp(e,t,i){return c.LerpToRef(e,t,i,new c)}static LerpToRef(e,t,i,r){return r.x=e.x+(t.x-e.x)*i,r.y=e.y+(t.y-e.y)*i,r}static Dot(e,t){return e.x*t.x+e.y*t.y}static Normalize(e){return c.NormalizeToRef(e,new c)}static NormalizeToRef(e,t){return e.normalizeToRef(t),t}static Minimize(e,t){const i=e.x<t.x?e.x:t.x,r=e.y<t.y?e.y:t.y;return new c(i,r)}static Maximize(e,t){const i=e.x>t.x?e.x:t.x,r=e.y>t.y?e.y:t.y;return new c(i,r)}static Transform(e,t){return c.TransformToRef(e,t,new c)}static TransformToRef(e,t,i){const r=t.m,s=e.x*r[0]+e.y*r[4]+r[12],n=e.x*r[1]+e.y*r[5]+r[13];return i.x=s,i.y=n,i}static PointInTriangle(e,t,i,r){const s=.5*(-i.y*r.x+t.y*(-i.x+r.x)+t.x*(i.y-r.y)+i.x*r.y),n=s<0?-1:1,a=(t.y*r.x-t.x*r.y+(r.y-t.y)*e.x+(t.x-r.x)*e.y)*n,o=(t.x*i.y-t.y*i.x+(t.y-i.y)*e.x+(i.x-t.x)*e.y)*n;return a>0&&o>0&&a+o<2*s*n}static Distance(e,t){return Math.sqrt(c.DistanceSquared(e,t))}static DistanceSquared(e,t){const i=e.x-t.x,r=e.y-t.y;return i*i+r*r}static Center(e,t){return c.CenterToRef(e,t,new c)}static CenterToRef(e,t,i){return i.copyFromFloats((e.x+t.x)/2,(e.y+t.y)/2)}static DistanceOfPointFromSegment(e,t,i){const r=c.DistanceSquared(t,i);if(0===r)return c.Distance(e,t);const s=i.subtract(t),n=Math.max(0,Math.min(1,c.Dot(e.subtract(t),s)/r)),a=t.add(s.multiplyByFloats(n,n));return c.Distance(e,a)}}c._ZeroReadOnly=c.Zero(),Object.defineProperties(c.prototype,{dimension:{value:[2]},rank:{value:1}});class u{get x(){return this._x}set x(e){this._x=e,this._isDirty=!0}get y(){return this._y}set y(e){this._y=e,this._isDirty=!0}get z(){return this._z}set z(e){this._z=e,this._isDirty=!0}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._isDirty=!0,this._x=e,this._y=t,this._z=i}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z}}`}getClassName(){return"Vector3"}getHashCode(){let e=h(this._x);return e=397*e^h(this._y),e=397*e^h(this._z),e}asArray(){return[this._x,this._y,this._z]}toArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,this}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return u.FromArrayToRef(e,t,this),this}toQuaternion(){return _.RotationYawPitchRoll(this._y,this._x,this._z)}addInPlace(e){return this._x+=e._x,this._y+=e._y,this._z+=e._z,this._isDirty=!0,this}addInPlaceFromFloats(e,t,i){return this._x+=e,this._y+=t,this._z+=i,this._isDirty=!0,this}add(e){return new u(this._x+e._x,this._y+e._y,this._z+e._z)}addToRef(e,t){return t._x=this._x+e._x,t._y=this._y+e._y,t._z=this._z+e._z,t._isDirty=!0,t}subtractInPlace(e){return this._x-=e._x,this._y-=e._y,this._z-=e._z,this._isDirty=!0,this}subtract(e){return new u(this._x-e._x,this._y-e._y,this._z-e._z)}subtractToRef(e,t){return this.subtractFromFloatsToRef(e._x,e._y,e._z,t)}subtractFromFloats(e,t,i){return new u(this._x-e,this._y-t,this._z-i)}subtractFromFloatsToRef(e,t,i,r){return r._x=this._x-e,r._y=this._y-t,r._z=this._z-i,r._isDirty=!0,r}negate(){return new u(-this._x,-this._y,-this._z)}negateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}negateToRef(e){return e._x=-1*this._x,e._y=-1*this._y,e._z=-1*this._z,e._isDirty=!0,e}scaleInPlace(e){return this._x*=e,this._y*=e,this._z*=e,this._isDirty=!0,this}scale(e){return new u(this._x*e,this._y*e,this._z*e)}scaleToRef(e,t){return t._x=this._x*e,t._y=this._y*e,t._z=this._z*e,t._isDirty=!0,t}getNormalToRef(e){const t=this.length();let i=Math.acos(this.y/t);const r=Math.atan2(this.z,this.x);i>Math.PI/2?i-=Math.PI/2:i+=Math.PI/2;const s=t*Math.sin(i)*Math.cos(r),n=t*Math.cos(i),a=t*Math.sin(i)*Math.sin(r);return e.set(s,n,a),e}applyRotationQuaternionToRef(e,t){const i=this._x,r=this._y,s=this._z,n=e._x,a=e._y,o=e._z,l=e._w,h=2*(a*s-o*r),c=2*(o*i-n*s),u=2*(n*r-a*i);return t._x=i+l*h+a*u-o*c,t._y=r+l*c+o*h-n*u,t._z=s+l*u+n*c-a*h,t._isDirty=!0,t}applyRotationQuaternionInPlace(e){return this.applyRotationQuaternionToRef(e,this)}applyRotationQuaternion(e){return this.applyRotationQuaternionToRef(e,new u)}scaleAndAddToRef(e,t){return t._x+=this._x*e,t._y+=this._y*e,t._z+=this._z*e,t._isDirty=!0,t}projectOnPlane(e,t){return this.projectOnPlaneToRef(e,t,new u)}projectOnPlaneToRef(e,t,i){const r=e.normal,s=e.d,n=f.Vector3[0];this.subtractToRef(t,n),n.normalize();const a=u.Dot(n,r);if(Math.abs(a)<1e-10)i.setAll(1/0);else{const e=-(u.Dot(t,r)+s)/a,o=n.scaleInPlace(e);t.addToRef(o,i)}return i}equals(e){return e&&this._x===e._x&&this._y===e._y&&this._z===e._z}equalsWithEpsilon(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.bH;return e&&(0,l.Mj)(this._x,e._x,t)&&(0,l.Mj)(this._y,e._y,t)&&(0,l.Mj)(this._z,e._z,t)}equalsToFloats(e,t,i){return this._x===e&&this._y===t&&this._z===i}multiplyInPlace(e){return this._x*=e._x,this._y*=e._y,this._z*=e._z,this._isDirty=!0,this}multiply(e){return this.multiplyByFloats(e._x,e._y,e._z)}multiplyToRef(e,t){return t._x=this._x*e._x,t._y=this._y*e._y,t._z=this._z*e._z,t._isDirty=!0,t}multiplyByFloats(e,t,i){return new u(this._x*e,this._y*t,this._z*i)}divide(e){return new u(this._x/e._x,this._y/e._y,this._z/e._z)}divideToRef(e,t){return t._x=this._x/e._x,t._y=this._y/e._y,t._z=this._z/e._z,t._isDirty=!0,t}divideInPlace(e){return this._x=this._x/e._x,this._y=this._y/e._y,this._z=this._z/e._z,this._isDirty=!0,this}minimizeInPlace(e){return this.minimizeInPlaceFromFloats(e._x,e._y,e._z)}maximizeInPlace(e){return this.maximizeInPlaceFromFloats(e._x,e._y,e._z)}minimizeInPlaceFromFloats(e,t,i){return e<this._x&&(this.x=e),t<this._y&&(this.y=t),i<this._z&&(this.z=i),this}maximizeInPlaceFromFloats(e,t,i){return e>this._x&&(this.x=e),t>this._y&&(this.y=t),i>this._z&&(this.z=i),this}isNonUniformWithinEpsilon(e){const t=Math.abs(this._x),i=Math.abs(this._y);if(!(0,l.Mj)(t,i,e))return!0;const r=Math.abs(this._z);return!(0,l.Mj)(t,r,e)||!(0,l.Mj)(i,r,e)}get isNonUniform(){const e=Math.abs(this._x);if(e!==Math.abs(this._y))return!0;return e!==Math.abs(this._z)}floorToRef(e){return e._x=Math.floor(this._x),e._y=Math.floor(this._y),e._z=Math.floor(this._z),e._isDirty=!0,e}floor(){return new u(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}fractToRef(e){return e._x=this.x-Math.floor(this._x),e._y=this.y-Math.floor(this._y),e._z=this.z-Math.floor(this._z),e._isDirty=!0,e}fract(){return new u(this.x-Math.floor(this._x),this.y-Math.floor(this._y),this.z-Math.floor(this._z))}length(){return Math.sqrt(this.lengthSquared())}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z}get hasAZeroComponent(){return this._x*this._y*this._z===0}normalize(){return this.normalizeFromLength(this.length())}reorderInPlace(e){if("xyz"===(e=e.toLowerCase()))return this;const t=f.Vector3[0].copyFrom(this);return this.x=t[e[0]],this.y=t[e[1]],this.z=t[e[2]],this}rotateByQuaternionToRef(e,t){return e.toRotationMatrix(f.Matrix[0]),u.TransformCoordinatesToRef(this,f.Matrix[0],t),t}rotateByQuaternionAroundPointToRef(e,t,i){return this.subtractToRef(t,f.Vector3[0]),f.Vector3[0].rotateByQuaternionToRef(e,f.Vector3[0]),t.addToRef(f.Vector3[0],i),i}cross(e){return u.CrossToRef(this,e,new u)}normalizeFromLength(e){return 0===e||1===e?this:this.scaleInPlace(1/e)}normalizeToNew(){return this.normalizeToRef(new u)}normalizeToRef(e){const t=this.length();return 0===t||1===t?(e._x=this._x,e._y=this._y,e._z=this._z,e._isDirty=!0,e):this.scaleToRef(1/t,e)}clone(){return new u(this._x,this._y,this._z)}copyFrom(e){return this.copyFromFloats(e._x,e._y,e._z)}copyFromFloats(e,t,i){return this._x=e,this._y=t,this._z=i,this._isDirty=!0,this}set(e,t,i){return this.copyFromFloats(e,t,i)}setAll(e){return this._x=this._y=this._z=e,this._isDirty=!0,this}static GetClipFactor(e,t,i,r){const s=u.Dot(e,i);return(s-r)/(s-u.Dot(t,i))}static GetAngleBetweenVectors(e,t,i){const r=e.normalizeToRef(f.Vector3[1]),s=t.normalizeToRef(f.Vector3[2]);let n=u.Dot(r,s);n=(0,l.OQ)(n,-1,1);const a=Math.acos(n),o=f.Vector3[3];return u.CrossToRef(r,s,o),u.Dot(o,i)>0?isNaN(a)?0:a:isNaN(a)?-Math.PI:-Math.acos(n)}static GetAngleBetweenVectorsOnPlane(e,t,i){f.Vector3[0].copyFrom(e);const r=f.Vector3[0];f.Vector3[1].copyFrom(t);const s=f.Vector3[1];f.Vector3[2].copyFrom(i);const n=f.Vector3[2],a=f.Vector3[3],o=f.Vector3[4];r.normalize(),s.normalize(),n.normalize(),u.CrossToRef(n,r,a),u.CrossToRef(a,n,o);const h=Math.atan2(u.Dot(s,a),u.Dot(s,o));return(0,l.ed)(h)}static PitchYawRollToMoveBetweenPointsToRef(e,t,i){const r=g.Vector3[0];return t.subtractToRef(e,r),i._y=Math.atan2(r.x,r.z)||0,i._x=Math.atan2(Math.sqrt(r.x**2+r.z**2),r.y)||0,i._z=0,i._isDirty=!0,i}static PitchYawRollToMoveBetweenPoints(e,t){const i=u.Zero();return u.PitchYawRollToMoveBetweenPointsToRef(e,t,i)}static SlerpToRef(e,t,i,s){i=(0,l.OQ)(i,0,1);const n=f.Vector3[0],a=f.Vector3[1];n.copyFrom(e);const o=n.length();n.normalizeFromLength(o),a.copyFrom(t);const h=a.length();a.normalizeFromLength(h);const c=u.Dot(n,a);let d,_;if(c<1-r.bH){const e=Math.acos(c),t=1/Math.sin(e);d=Math.sin((1-i)*e)*t,_=Math.sin(i*e)*t}else d=1-i,_=i;return n.scaleInPlace(d),a.scaleInPlace(_),s.copyFrom(n).addInPlace(a),s.scaleInPlace((0,l.cP)(o,h,i)),s}static SmoothToRef(e,t,i,r,s){return u.SlerpToRef(e,t,0===r?1:i/r,s),s}static FromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new u(e[t],e[t+1],e[t+2])}static FromFloatArray(e,t){return u.FromArray(e,t)}static FromArrayToRef(e,t,i){return i._x=e[t],i._y=e[t+1],i._z=e[t+2],i._isDirty=!0,i}static FromFloatArrayToRef(e,t,i){return u.FromArrayToRef(e,t,i)}static FromFloatsToRef(e,t,i,r){return r.copyFromFloats(e,t,i),r}static Zero(){return new u(0,0,0)}static One(){return new u(1,1,1)}static Up(){return new u(0,1,0)}static get UpReadOnly(){return u._UpReadOnly}static get DownReadOnly(){return u._DownReadOnly}static get RightReadOnly(){return u._RightReadOnly}static get LeftReadOnly(){return u._LeftReadOnly}static get LeftHandedForwardReadOnly(){return u._LeftHandedForwardReadOnly}static get RightHandedForwardReadOnly(){return u._RightHandedForwardReadOnly}static get LeftHandedBackwardReadOnly(){return u._LeftHandedBackwardReadOnly}static get RightHandedBackwardReadOnly(){return u._RightHandedBackwardReadOnly}static get ZeroReadOnly(){return u._ZeroReadOnly}static get OneReadOnly(){return u._OneReadOnly}static Down(){return new u(0,-1,0)}static Forward(){return new u(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?-1:1)}static Backward(){return new u(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?1:-1)}static Right(){return new u(1,0,0)}static Left(){return new u(-1,0,0)}static Random(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new u((0,l.VD)(e,t),(0,l.VD)(e,t),(0,l.VD)(e,t))}static RandomToRef(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).copyFromFloats((0,l.VD)(e,t),(0,l.VD)(e,t),(0,l.VD)(e,t))}static TransformCoordinates(e,t){const i=u.Zero();return u.TransformCoordinatesToRef(e,t,i),i}static TransformCoordinatesToRef(e,t,i){return u.TransformCoordinatesFromFloatsToRef(e._x,e._y,e._z,t,i),i}static TransformCoordinatesFromFloatsToRef(e,t,i,r,s){const n=r.m,a=e*n[0]+t*n[4]+i*n[8]+n[12],o=e*n[1]+t*n[5]+i*n[9]+n[13],l=e*n[2]+t*n[6]+i*n[10]+n[14],h=1/(e*n[3]+t*n[7]+i*n[11]+n[15]);return s._x=a*h,s._y=o*h,s._z=l*h,s._isDirty=!0,s}static TransformNormal(e,t){const i=u.Zero();return u.TransformNormalToRef(e,t,i),i}static TransformNormalToRef(e,t,i){return this.TransformNormalFromFloatsToRef(e._x,e._y,e._z,t,i),i}static TransformNormalFromFloatsToRef(e,t,i,r,s){const n=r.m;return s._x=e*n[0]+t*n[4]+i*n[8],s._y=e*n[1]+t*n[5]+i*n[9],s._z=e*n[2]+t*n[6]+i*n[10],s._isDirty=!0,s}static CatmullRom(e,t,i,r,s){const n=s*s,a=s*n,o=.5*(2*t._x+(-e._x+i._x)*s+(2*e._x-5*t._x+4*i._x-r._x)*n+(-e._x+3*t._x-3*i._x+r._x)*a),l=.5*(2*t._y+(-e._y+i._y)*s+(2*e._y-5*t._y+4*i._y-r._y)*n+(-e._y+3*t._y-3*i._y+r._y)*a),h=.5*(2*t._z+(-e._z+i._z)*s+(2*e._z-5*t._z+4*i._z-r._z)*n+(-e._z+3*t._z-3*i._z+r._z)*a);return new u(o,l,h)}static Clamp(e,t,i){const r=new u;return u.ClampToRef(e,t,i,r),r}static ClampToRef(e,t,i,r){let s=e._x;s=s>i._x?i._x:s,s=s<t._x?t._x:s;let n=e._y;n=n>i._y?i._y:n,n=n<t._y?t._y:n;let a=e._z;return a=a>i._z?i._z:a,a=a<t._z?t._z:a,r.copyFromFloats(s,n,a),r}static CheckExtends(e,t,i){t.minimizeInPlace(e),i.maximizeInPlace(e)}static Hermite(e,t,i,r,s){const n=s*s,a=s*n,o=2*a-3*n+1,l=-2*a+3*n,h=a-2*n+s,c=a-n,d=e._x*o+i._x*l+t._x*h+r._x*c,_=e._y*o+i._y*l+t._y*h+r._y*c,p=e._z*o+i._z*l+t._z*h+r._z*c;return new u(d,_,p)}static Hermite1stDerivative(e,t,i,r,s){const n=new u;return this.Hermite1stDerivativeToRef(e,t,i,r,s,n),n}static Hermite1stDerivativeToRef(e,t,i,r,s,n){const a=s*s;return n._x=6*(a-s)*e._x+(3*a-4*s+1)*t._x+6*(-a+s)*i._x+(3*a-2*s)*r._x,n._y=6*(a-s)*e._y+(3*a-4*s+1)*t._y+6*(-a+s)*i._y+(3*a-2*s)*r._y,n._z=6*(a-s)*e._z+(3*a-4*s+1)*t._z+6*(-a+s)*i._z+(3*a-2*s)*r._z,n._isDirty=!0,n}static Lerp(e,t,i){const r=new u(0,0,0);return u.LerpToRef(e,t,i,r),r}static LerpToRef(e,t,i,r){return r._x=e._x+(t._x-e._x)*i,r._y=e._y+(t._y-e._y)*i,r._z=e._z+(t._z-e._z)*i,r._isDirty=!0,r}static Dot(e,t){return e._x*t._x+e._y*t._y+e._z*t._z}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z}static Cross(e,t){const i=new u;return u.CrossToRef(e,t,i),i}static CrossToRef(e,t,i){const r=e._y*t._z-e._z*t._y,s=e._z*t._x-e._x*t._z,n=e._x*t._y-e._y*t._x;return i.copyFromFloats(r,s,n),i}static Normalize(e){const t=u.Zero();return u.NormalizeToRef(e,t),t}static NormalizeToRef(e,t){return e.normalizeToRef(t),t}static Project(e,t,i,r){const s=new u;return u.ProjectToRef(e,t,i,r,s),s}static ProjectToRef(e,t,i,r,s){const n=r.width,a=r.height,l=r.x,h=r.y,c=f.Matrix[1],d=o.q.LastCreatedEngine?.isNDCHalfZRange,_=d?1:.5,g=d?0:.5;p.FromValuesToRef(n/2,0,0,0,0,-a/2,0,0,0,0,_,0,l+n/2,a/2+h,g,1,c);const m=f.Matrix[0];return t.multiplyToRef(i,m),m.multiplyToRef(c,m),u.TransformCoordinatesToRef(e,m,s),s}static Reflect(e,t){return this.ReflectToRef(e,t,new u)}static ReflectToRef(e,t,i){const r=g.Vector3[0];return r.copyFrom(t).scaleInPlace(2*u.Dot(e,t)),i.copyFrom(e).subtractInPlace(r)}static _UnprojectFromInvertedMatrixToRef(e,t,i){u.TransformCoordinatesToRef(e,t,i);const r=t.m,s=e._x*r[3]+e._y*r[7]+e._z*r[11]+r[15];return(0,l.Mj)(s,1)&&i.scaleInPlace(1/s),i}static UnprojectFromTransform(e,t,i,r,s){return this.Unproject(e,t,i,r,s,p.IdentityReadOnly)}static Unproject(e,t,i,r,s,n){const a=new u;return u.UnprojectToRef(e,t,i,r,s,n,a),a}static UnprojectToRef(e,t,i,r,s,n,a){return u.UnprojectFloatsToRef(e._x,e._y,e._z,t,i,r,s,n,a),a}static UnprojectFloatsToRef(e,t,i,r,s,n,a,l,h){const c=f.Matrix[0];n.multiplyToRef(a,c),c.multiplyToRef(l,c),c.invert();const d=f.Vector3[0];return d.x=e/r*2-1,d.y=-(t/s*2-1),o.q.LastCreatedEngine?.isNDCHalfZRange?d.z=i:d.z=2*i-1,u._UnprojectFromInvertedMatrixToRef(d,c,h),h}static Minimize(e,t){const i=new u;return i.copyFrom(e),i.minimizeInPlace(t),i}static Maximize(e,t){const i=new u;return i.copyFrom(e),i.maximizeInPlace(t),i}static Distance(e,t){return Math.sqrt(u.DistanceSquared(e,t))}static DistanceSquared(e,t){const i=e._x-t._x,r=e._y-t._y,s=e._z-t._z;return i*i+r*r+s*s}static ProjectOnTriangleToRef(e,t,i,s,n){const a=f.Vector3[0],o=f.Vector3[1],h=f.Vector3[2],c=f.Vector3[3],d=f.Vector3[4];i.subtractToRef(t,a),s.subtractToRef(t,o),s.subtractToRef(i,h);const _=a.length(),p=o.length(),g=h.length();if(_<r.bH||p<r.bH||g<r.bH)return n.copyFrom(t),u.Distance(e,t);e.subtractToRef(t,d),u.CrossToRef(a,o,c);const m=c.length();if(m<r.bH)return n.copyFrom(t),u.Distance(e,t);c.normalizeFromLength(m);let b=d.length();if(b<r.bH)return n.copyFrom(t),0;d.normalizeFromLength(b);const v=u.Dot(c,d),y=f.Vector3[5],T=f.Vector3[6];y.copyFrom(c).scaleInPlace(-b*v),T.copyFrom(e).addInPlace(y);const x=f.Vector3[4],A=f.Vector3[5],C=f.Vector3[7],R=f.Vector3[8];x.copyFrom(a).scaleInPlace(1/_),R.copyFrom(o).scaleInPlace(1/p),x.addInPlace(R).scaleInPlace(-1),A.copyFrom(a).scaleInPlace(-1/_),R.copyFrom(h).scaleInPlace(1/g),A.addInPlace(R).scaleInPlace(-1),C.copyFrom(h).scaleInPlace(-1/g),R.copyFrom(o).scaleInPlace(-1/p),C.addInPlace(R).scaleInPlace(-1);const E=f.Vector3[9];let S;E.copyFrom(T).subtractInPlace(t),u.CrossToRef(x,E,R),S=u.Dot(R,c);const M=S;E.copyFrom(T).subtractInPlace(i),u.CrossToRef(A,E,R),S=u.Dot(R,c);const P=S;E.copyFrom(T).subtractInPlace(s),u.CrossToRef(C,E,R),S=u.Dot(R,c);const I=S,O=f.Vector3[10];let D,w;M>0&&P<0?(O.copyFrom(a),D=t,w=i):P>0&&I<0?(O.copyFrom(h),D=i,w=s):(O.copyFrom(o).scaleInPlace(-1),D=s,w=t);const F=f.Vector3[9],L=f.Vector3[4];D.subtractToRef(T,R),w.subtractToRef(T,F),u.CrossToRef(R,F,L);if(!(u.Dot(L,c)<0))return n.copyFrom(T),Math.abs(b*v);const B=f.Vector3[5];u.CrossToRef(O,L,B),B.normalize();const N=f.Vector3[9];N.copyFrom(D).subtractInPlace(T);const k=N.length();if(k<r.bH)return n.copyFrom(D),u.Distance(e,D);N.normalizeFromLength(k);const U=u.Dot(B,N),V=f.Vector3[7];V.copyFrom(T).addInPlace(B.scaleInPlace(k*U)),R.copyFrom(V).subtractInPlace(D),b=O.length(),O.normalizeFromLength(b);let z=u.Dot(R,O)/Math.max(b,r.bH);return z=(0,l.OQ)(z,0,1),V.copyFrom(D).addInPlace(O.scaleInPlace(z*b)),n.copyFrom(V),u.Distance(e,V)}static Center(e,t){return u.CenterToRef(e,t,u.Zero())}static CenterToRef(e,t,i){return i.copyFromFloats((e._x+t._x)/2,(e._y+t._y)/2,(e._z+t._z)/2)}static RotationFromAxis(e,t,i){const r=new u;return u.RotationFromAxisToRef(e,t,i,r),r}static RotationFromAxisToRef(e,t,i,r){const s=f.Quaternion[0];return _.RotationQuaternionFromAxisToRef(e,t,i,s),s.toEulerAnglesToRef(r),r}}u._UpReadOnly=u.Up(),u._DownReadOnly=u.Down(),u._LeftHandedForwardReadOnly=u.Forward(!1),u._RightHandedForwardReadOnly=u.Forward(!0),u._LeftHandedBackwardReadOnly=u.Backward(!1),u._RightHandedBackwardReadOnly=u.Backward(!0),u._RightReadOnly=u.Right(),u._LeftReadOnly=u.Left(),u._ZeroReadOnly=u.Zero(),u._OneReadOnly=u.One(),Object.defineProperties(u.prototype,{dimension:{value:[3]},rank:{value:1}});class d{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.x=e,this.y=t,this.z=i,this.w=r}toString(){return`{X: ${this.x} Y: ${this.y} Z: ${this.z} W: ${this.w}}`}getClassName(){return"Vector4"}getHashCode(){let e=h(this.x);return e=397*e^h(this.y),e=397*e^h(this.z),e=397*e^h(this.w),e}asArray(){return[this.x,this.y,this.z,this.w]}toArray(e,t){return void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,this}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return d.FromArrayToRef(e,t,this),this}addInPlace(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addInPlaceFromFloats(e,t,i,r){return this.x+=e,this.y+=t,this.z+=i,this.w+=r,this}add(e){return new d(this.x+e.x,this.y+e.y,this.z+e.z,this.w+e.w)}addToRef(e,t){return t.x=this.x+e.x,t.y=this.y+e.y,t.z=this.z+e.z,t.w=this.w+e.w,t}subtractInPlace(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subtract(e){return new d(this.x-e.x,this.y-e.y,this.z-e.z,this.w-e.w)}subtractToRef(e,t){return t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z,t.w=this.w-e.w,t}subtractFromFloats(e,t,i,r){return new d(this.x-e,this.y-t,this.z-i,this.w-r)}subtractFromFloatsToRef(e,t,i,r,s){return s.x=this.x-e,s.y=this.y-t,s.z=this.z-i,s.w=this.w-r,s}negate(){return new d(-this.x,-this.y,-this.z,-this.w)}negateInPlace(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this}negateToRef(e){return e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=-this.w,e}scaleInPlace(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}scale(e){return new d(this.x*e,this.y*e,this.z*e,this.w*e)}scaleToRef(e,t){return t.x=this.x*e,t.y=this.y*e,t.z=this.z*e,t.w=this.w*e,t}scaleAndAddToRef(e,t){return t.x+=this.x*e,t.y+=this.y*e,t.z+=this.z*e,t.w+=this.w*e,t}equals(e){return e&&this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w}equalsWithEpsilon(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.bH;return e&&(0,l.Mj)(this.x,e.x,t)&&(0,l.Mj)(this.y,e.y,t)&&(0,l.Mj)(this.z,e.z,t)&&(0,l.Mj)(this.w,e.w,t)}equalsToFloats(e,t,i,r){return this.x===e&&this.y===t&&this.z===i&&this.w===r}multiplyInPlace(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiply(e){return new d(this.x*e.x,this.y*e.y,this.z*e.z,this.w*e.w)}multiplyToRef(e,t){return t.x=this.x*e.x,t.y=this.y*e.y,t.z=this.z*e.z,t.w=this.w*e.w,t}multiplyByFloats(e,t,i,r){return new d(this.x*e,this.y*t,this.z*i,this.w*r)}divide(e){return new d(this.x/e.x,this.y/e.y,this.z/e.z,this.w/e.w)}divideToRef(e,t){return t.x=this.x/e.x,t.y=this.y/e.y,t.z=this.z/e.z,t.w=this.w/e.w,t}divideInPlace(e){return this.divideToRef(e,this)}minimizeInPlace(e){return e.x<this.x&&(this.x=e.x),e.y<this.y&&(this.y=e.y),e.z<this.z&&(this.z=e.z),e.w<this.w&&(this.w=e.w),this}maximizeInPlace(e){return e.x>this.x&&(this.x=e.x),e.y>this.y&&(this.y=e.y),e.z>this.z&&(this.z=e.z),e.w>this.w&&(this.w=e.w),this}minimizeInPlaceFromFloats(e,t,i,r){return this.x=Math.min(e,this.x),this.y=Math.min(t,this.y),this.z=Math.min(i,this.z),this.w=Math.min(r,this.w),this}maximizeInPlaceFromFloats(e,t,i,r){return this.x=Math.max(e,this.x),this.y=Math.max(t,this.y),this.z=Math.max(i,this.z),this.w=Math.max(r,this.w),this}floorToRef(e){return e.x=Math.floor(this.x),e.y=Math.floor(this.y),e.z=Math.floor(this.z),e.w=Math.floor(this.w),e}floor(){return new d(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))}fractToRef(e){return e.x=this.x-Math.floor(this.x),e.y=this.y-Math.floor(this.y),e.z=this.z-Math.floor(this.z),e.w=this.w-Math.floor(this.w),e}fract(){return new d(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(e){return 0===e||1===e?this:this.scaleInPlace(1/e)}normalizeToNew(){return this.normalizeToRef(new d)}normalizeToRef(e){const t=this.length();return 0===t||1===t?(e.x=this.x,e.y=this.y,e.z=this.z,e.w=this.w,e):this.scaleToRef(1/t,e)}toVector3(){return new u(this.x,this.y,this.z)}clone(){return new d(this.x,this.y,this.z,this.w)}copyFrom(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}copyFromFloats(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}set(e,t,i,r){return this.copyFromFloats(e,t,i,r)}setAll(e){return this.x=this.y=this.z=this.w=e,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}static FromArray(e,t){return t||(t=0),new d(e[t],e[t+1],e[t+2],e[t+3])}static FromArrayToRef(e,t,i){return i.x=e[t],i.y=e[t+1],i.z=e[t+2],i.w=e[t+3],i}static FromFloatArrayToRef(e,t,i){return d.FromArrayToRef(e,t,i),i}static FromFloatsToRef(e,t,i,r,s){return s.x=e,s.y=t,s.z=i,s.w=r,s}static Zero(){return new d(0,0,0,0)}static One(){return new d(1,1,1,1)}static Random(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new d((0,l.VD)(e,t),(0,l.VD)(e,t),(0,l.VD)(e,t),(0,l.VD)(e,t))}static RandomToRef(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2?arguments[2]:void 0;return i.x=(0,l.VD)(e,t),i.y=(0,l.VD)(e,t),i.z=(0,l.VD)(e,t),i.w=(0,l.VD)(e,t),i}static Clamp(e,t,i){return d.ClampToRef(e,t,i,new d)}static ClampToRef(e,t,i,r){return r.x=(0,l.OQ)(e.x,t.x,i.x),r.y=(0,l.OQ)(e.y,t.y,i.y),r.z=(0,l.OQ)(e.z,t.z,i.z),r.w=(0,l.OQ)(e.w,t.w,i.w),r}static CheckExtends(e,t,i){t.minimizeInPlace(e),i.maximizeInPlace(e)}static get ZeroReadOnly(){return d._ZeroReadOnly}static Normalize(e){return d.NormalizeToRef(e,new d)}static NormalizeToRef(e,t){return e.normalizeToRef(t),t}static Minimize(e,t){const i=new d;return i.copyFrom(e),i.minimizeInPlace(t),i}static Maximize(e,t){const i=new d;return i.copyFrom(e),i.maximizeInPlace(t),i}static Distance(e,t){return Math.sqrt(d.DistanceSquared(e,t))}static DistanceSquared(e,t){const i=e.x-t.x,r=e.y-t.y,s=e.z-t.z,n=e.w-t.w;return i*i+r*r+s*s+n*n}static Center(e,t){return d.CenterToRef(e,t,new d)}static CenterToRef(e,t,i){return i.x=(e.x+t.x)/2,i.y=(e.y+t.y)/2,i.z=(e.z+t.z)/2,i.w=(e.w+t.w)/2,i}static TransformCoordinates(e,t){return d.TransformCoordinatesToRef(e,t,new d)}static TransformCoordinatesToRef(e,t,i){return d.TransformCoordinatesFromFloatsToRef(e._x,e._y,e._z,t,i),i}static TransformCoordinatesFromFloatsToRef(e,t,i,r,s){const n=r.m,a=e*n[0]+t*n[4]+i*n[8]+n[12],o=e*n[1]+t*n[5]+i*n[9]+n[13],l=e*n[2]+t*n[6]+i*n[10]+n[14],h=e*n[3]+t*n[7]+i*n[11]+n[15];return s.x=a,s.y=o,s.z=l,s.w=h,s}static TransformNormal(e,t){return d.TransformNormalToRef(e,t,new d)}static TransformNormalToRef(e,t,i){const r=t.m,s=e.x*r[0]+e.y*r[4]+e.z*r[8],n=e.x*r[1]+e.y*r[5]+e.z*r[9],a=e.x*r[2]+e.y*r[6]+e.z*r[10];return i.x=s,i.y=n,i.z=a,i.w=e.w,i}static TransformNormalFromFloatsToRef(e,t,i,r,s,n){const a=s.m;return n.x=e*a[0]+t*a[4]+i*a[8],n.y=e*a[1]+t*a[5]+i*a[9],n.z=e*a[2]+t*a[6]+i*a[10],n.w=r,n}static FromVector3(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new d(e._x,e._y,e._z,t)}static Dot(e,t){return e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w}}d._ZeroReadOnly=d.Zero(),Object.defineProperties(d.prototype,{dimension:{value:[4]},rank:{value:1}});class _{get x(){return this._x}set x(e){this._x=e,this._isDirty=!0}get y(){return this._y}set y(e){this._y=e,this._isDirty=!0}get z(){return this._z}set z(e){this._z=e,this._isDirty=!0}get w(){return this._w}set w(e){this._w=e,this._isDirty=!0}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this._isDirty=!0,this._x=e,this._y=t,this._z=i,this._w=r}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z} W: ${this._w}}`}getClassName(){return"Quaternion"}getHashCode(){let e=h(this._x);return e=397*e^h(this._y),e=397*e^h(this._z),e=397*e^h(this._w),e}asArray(){return[this._x,this._y,this._z,this._w]}toArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,this}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return _.FromArrayToRef(e,t,this)}equals(e){return e&&this._x===e._x&&this._y===e._y&&this._z===e._z&&this._w===e._w}equalsWithEpsilon(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.bH;return e&&(0,l.Mj)(this._x,e._x,t)&&(0,l.Mj)(this._y,e._y,t)&&(0,l.Mj)(this._z,e._z,t)&&(0,l.Mj)(this._w,e._w,t)}clone(){return new _(this._x,this._y,this._z,this._w)}copyFrom(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._w=e._w,this._isDirty=!0,this}copyFromFloats(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._isDirty=!0,this}set(e,t,i,r){return this.copyFromFloats(e,t,i,r)}setAll(e){return this.copyFromFloats(e,e,e,e)}add(e){return new _(this._x+e._x,this._y+e._y,this._z+e._z,this._w+e._w)}addInPlace(e){return this._x+=e._x,this._y+=e._y,this._z+=e._z,this._w+=e._w,this._isDirty=!0,this}addToRef(e,t){return t._x=this._x+e._x,t._y=this._y+e._y,t._z=this._z+e._z,t._w=this._w+e._w,t._isDirty=!0,t}addInPlaceFromFloats(e,t,i,r){return this._x+=e,this._y+=t,this._z+=i,this._w+=r,this._isDirty=!0,this}subtractToRef(e,t){return t._x=this._x-e._x,t._y=this._y-e._y,t._z=this._z-e._z,t._w=this._w-e._w,t._isDirty=!0,t}subtractFromFloats(e,t,i,r){return this.subtractFromFloatsToRef(e,t,i,r,new _)}subtractFromFloatsToRef(e,t,i,r,s){return s._x=this._x-e,s._y=this._y-t,s._z=this._z-i,s._w=this._w-r,s._isDirty=!0,s}subtract(e){return new _(this._x-e._x,this._y-e._y,this._z-e._z,this._w-e._w)}subtractInPlace(e){return this._x-=e._x,this._y-=e._y,this._z-=e._z,this._w-=e._w,this._isDirty=!0,this}scale(e){return new _(this._x*e,this._y*e,this._z*e,this._w*e)}scaleToRef(e,t){return t._x=this._x*e,t._y=this._y*e,t._z=this._z*e,t._w=this._w*e,t._isDirty=!0,t}scaleInPlace(e){return this._x*=e,this._y*=e,this._z*=e,this._w*=e,this._isDirty=!0,this}scaleAndAddToRef(e,t){return t._x+=this._x*e,t._y+=this._y*e,t._z+=this._z*e,t._w+=this._w*e,t._isDirty=!0,t}multiply(e){const t=new _(0,0,0,1);return this.multiplyToRef(e,t),t}multiplyToRef(e,t){const i=this._x*e._w+this._y*e._z-this._z*e._y+this._w*e._x,r=-this._x*e._z+this._y*e._w+this._z*e._x+this._w*e._y,s=this._x*e._y-this._y*e._x+this._z*e._w+this._w*e._z,n=-this._x*e._x-this._y*e._y-this._z*e._z+this._w*e._w;return t.copyFromFloats(i,r,s,n),t}multiplyInPlace(e){return this.multiplyToRef(e,this)}multiplyByFloats(e,t,i,r){return this._x*=e,this._y*=t,this._z*=i,this._w*=r,this._isDirty=!0,this}divide(e){throw new ReferenceError("Can not divide a quaternion")}divideToRef(e,t){throw new ReferenceError("Can not divide a quaternion")}divideInPlace(e){throw new ReferenceError("Can not divide a quaternion")}minimizeInPlace(){throw new ReferenceError("Can not minimize a quaternion")}minimizeInPlaceFromFloats(){throw new ReferenceError("Can not minimize a quaternion")}maximizeInPlace(){throw new ReferenceError("Can not maximize a quaternion")}maximizeInPlaceFromFloats(){throw new ReferenceError("Can not maximize a quaternion")}negate(){return this.negateToRef(new _)}negateInPlace(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._w=-this._w,this._isDirty=!0,this}negateToRef(e){return e._x=-this._x,e._y=-this._y,e._z=-this._z,e._w=-this._w,e._isDirty=!0,e}equalsToFloats(e,t,i,r){return this._x===e&&this._y===t&&this._z===i&&this._w===r}floorToRef(e){throw new ReferenceError("Can not floor a quaternion")}floor(){throw new ReferenceError("Can not floor a quaternion")}fractToRef(e){throw new ReferenceError("Can not fract a quaternion")}fract(){throw new ReferenceError("Can not fract a quaternion")}conjugateToRef(e){return e.copyFromFloats(-this._x,-this._y,-this._z,this._w),e}conjugateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}conjugate(){return new _(-this._x,-this._y,-this._z,this._w)}invert(){const e=this.conjugate(),t=this.lengthSquared();return 0==t||1==t||e.scaleInPlace(1/t),e}invertInPlace(){this.conjugateInPlace();const e=this.lengthSquared();return 0==e||1==e||this.scaleInPlace(1/e),this}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this.lengthSquared())}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(e){return 0===e||1===e?this:this.scaleInPlace(1/e)}normalizeToNew(){const e=new _(0,0,0,1);return this.normalizeToRef(e),e}normalizeToRef(e){const t=this.length();return 0===t||1===t?e.copyFromFloats(this._x,this._y,this._z,this._w):this.scaleToRef(1/t,e)}toEulerAngles(){const e=u.Zero();return this.toEulerAnglesToRef(e),e}toEulerAnglesToRef(e){const t=this._z,i=this._x,r=this._y,s=this._w,n=r*t-i*s,a=.4999999;if(n<-a)e._y=2*Math.atan2(r,s),e._x=Math.PI/2,e._z=0,e._isDirty=!0;else if(n>a)e._y=2*Math.atan2(r,s),e._x=-Math.PI/2,e._z=0,e._isDirty=!0;else{const a=s*s,o=t*t,l=i*i,h=r*r;e._z=Math.atan2(2*(i*r+t*s),-o-l+h+a),e._x=Math.asin(-2*n),e._y=Math.atan2(2*(t*i+r*s),o-l-h+a),e._isDirty=!0}return e}toAlphaBetaGammaToRef(e){const t=this._z,i=this._x,r=this._y,s=this._w,n=Math.sqrt(i*i+r*r),a=Math.sqrt(t*t+s*s),o=2*Math.atan2(n,a),l=2*Math.atan2(t,s),h=2*Math.atan2(r,i),c=(l+h)/2,u=(l-h)/2;return e.set(u,o,c),e}toRotationMatrix(e){return p.FromQuaternionToRef(this,e),e}fromRotationMatrix(e){return _.FromRotationMatrixToRef(e,this),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}static FromRotationMatrix(e){const t=new _;return _.FromRotationMatrixToRef(e,t),t}static FromRotationMatrixToRef(e,t){const i=e.m,r=i[0],s=i[4],n=i[8],a=i[1],o=i[5],l=i[9],h=i[2],c=i[6],u=i[10],d=r+o+u;let _;return d>0?(_=.5/Math.sqrt(d+1),t._w=.25/_,t._x=(c-l)*_,t._y=(n-h)*_,t._z=(a-s)*_,t._isDirty=!0):r>o&&r>u?(_=2*Math.sqrt(1+r-o-u),t._w=(c-l)/_,t._x=.25*_,t._y=(s+a)/_,t._z=(n+h)/_,t._isDirty=!0):o>u?(_=2*Math.sqrt(1+o-r-u),t._w=(n-h)/_,t._x=(s+a)/_,t._y=.25*_,t._z=(l+c)/_,t._isDirty=!0):(_=2*Math.sqrt(1+u-r-o),t._w=(a-s)/_,t._x=(n+h)/_,t._y=(l+c)/_,t._z=.25*_,t._isDirty=!0),t}static Dot(e,t){return e._x*t._x+e._y*t._y+e._z*t._z+e._w*t._w}static AreClose(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1;const r=_.Dot(e,t);return 1-r*r<=i}static SmoothToRef(e,t,i,r,s){let n=0===r?1:i/r;return n=(0,l.OQ)(n,0,1),_.SlerpToRef(e,t,n,s),s}static Zero(){return new _(0,0,0,0)}static Inverse(e){return new _(-e._x,-e._y,-e._z,e._w)}static InverseToRef(e,t){return t.set(-e._x,-e._y,-e._z,e._w),t}static Identity(){return new _(0,0,0,1)}static IsIdentity(e){return e&&0===e._x&&0===e._y&&0===e._z&&1===e._w}static RotationAxis(e,t){return _.RotationAxisToRef(e,t,new _)}static RotationAxisToRef(e,t,i){i._w=Math.cos(t/2);const r=Math.sin(t/2)/e.length();return i._x=e._x*r,i._y=e._y*r,i._z=e._z*r,i._isDirty=!0,i}static FromArray(e,t){return t||(t=0),new _(e[t],e[t+1],e[t+2],e[t+3])}static FromArrayToRef(e,t,i){return i._x=e[t],i._y=e[t+1],i._z=e[t+2],i._w=e[t+3],i._isDirty=!0,i}static FromFloatsToRef(e,t,i,r,s){return s.copyFromFloats(e,t,i,r),s}static FromEulerAngles(e,t,i){const r=new _;return _.RotationYawPitchRollToRef(t,e,i,r),r}static FromEulerAnglesToRef(e,t,i,r){return _.RotationYawPitchRollToRef(t,e,i,r),r}static FromEulerVector(e){const t=new _;return _.RotationYawPitchRollToRef(e._y,e._x,e._z,t),t}static FromEulerVectorToRef(e,t){return _.RotationYawPitchRollToRef(e._y,e._x,e._z,t),t}static FromUnitVectorsToRef(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r.bH;const n=u.Dot(e,t)+1;return n<s?Math.abs(e.x)>Math.abs(e.z)?i.set(-e.y,e.x,0,0):i.set(0,-e.z,e.y,0):(u.CrossToRef(e,t,g.Vector3[0]),i.set(g.Vector3[0].x,g.Vector3[0].y,g.Vector3[0].z,n)),i.normalize()}static RotationYawPitchRoll(e,t,i){const r=new _;return _.RotationYawPitchRollToRef(e,t,i,r),r}static RotationYawPitchRollToRef(e,t,i,r){const s=.5*i,n=.5*t,a=.5*e,o=Math.sin(s),l=Math.cos(s),h=Math.sin(n),c=Math.cos(n),u=Math.sin(a),d=Math.cos(a);return r._x=d*h*l+u*c*o,r._y=u*c*l-d*h*o,r._z=d*c*o-u*h*l,r._w=d*c*l+u*h*o,r._isDirty=!0,r}static RotationAlphaBetaGamma(e,t,i){const r=new _;return _.RotationAlphaBetaGammaToRef(e,t,i,r),r}static RotationAlphaBetaGammaToRef(e,t,i,r){const s=.5*(i+e),n=.5*(i-e),a=.5*t;return r._x=Math.cos(n)*Math.sin(a),r._y=Math.sin(n)*Math.sin(a),r._z=Math.sin(s)*Math.cos(a),r._w=Math.cos(s)*Math.cos(a),r._isDirty=!0,r}static RotationQuaternionFromAxis(e,t,i){const r=new _(0,0,0,0);return _.RotationQuaternionFromAxisToRef(e,t,i,r),r}static RotationQuaternionFromAxisToRef(e,t,i,r){const s=f.Matrix[0];return e=e.normalizeToRef(f.Vector3[0]),t=t.normalizeToRef(f.Vector3[1]),i=i.normalizeToRef(f.Vector3[2]),p.FromXYZAxesToRef(e,t,i,s),_.FromRotationMatrixToRef(s,r),r}static FromLookDirectionLH(e,t){const i=new _;return _.FromLookDirectionLHToRef(e,t,i),i}static FromLookDirectionLHToRef(e,t,i){const r=f.Matrix[0];return p.LookDirectionLHToRef(e,t,r),_.FromRotationMatrixToRef(r,i),i}static FromLookDirectionRH(e,t){const i=new _;return _.FromLookDirectionRHToRef(e,t,i),i}static FromLookDirectionRHToRef(e,t,i){const r=f.Matrix[0];return p.LookDirectionRHToRef(e,t,r),_.FromRotationMatrixToRef(r,i)}static Slerp(e,t,i){const r=_.Identity();return _.SlerpToRef(e,t,i,r),r}static SlerpToRef(e,t,i,r){let s,n,a=e._x*t._x+e._y*t._y+e._z*t._z+e._w*t._w,o=!1;if(a<0&&(o=!0,a=-a),a>.999999)n=1-i,s=o?-i:i;else{const e=Math.acos(a),t=1/Math.sin(e);n=Math.sin((1-i)*e)*t,s=o?-Math.sin(i*e)*t:Math.sin(i*e)*t}return r._x=n*e._x+s*t._x,r._y=n*e._y+s*t._y,r._z=n*e._z+s*t._z,r._w=n*e._w+s*t._w,r._isDirty=!0,r}static Hermite(e,t,i,r,s){const n=s*s,a=s*n,o=2*a-3*n+1,l=-2*a+3*n,h=a-2*n+s,c=a-n,u=e._x*o+i._x*l+t._x*h+r._x*c,d=e._y*o+i._y*l+t._y*h+r._y*c,p=e._z*o+i._z*l+t._z*h+r._z*c,f=e._w*o+i._w*l+t._w*h+r._w*c;return new _(u,d,p,f)}static Hermite1stDerivative(e,t,i,r,s){const n=new _;return this.Hermite1stDerivativeToRef(e,t,i,r,s,n),n}static Hermite1stDerivativeToRef(e,t,i,r,s,n){const a=s*s;return n._x=6*(a-s)*e._x+(3*a-4*s+1)*t._x+6*(-a+s)*i._x+(3*a-2*s)*r._x,n._y=6*(a-s)*e._y+(3*a-4*s+1)*t._y+6*(-a+s)*i._y+(3*a-2*s)*r._y,n._z=6*(a-s)*e._z+(3*a-4*s+1)*t._z+6*(-a+s)*i._z+(3*a-2*s)*r._z,n._w=6*(a-s)*e._w+(3*a-4*s+1)*t._w+6*(-a+s)*i._w+(3*a-2*s)*r._w,n._isDirty=!0,n}static Normalize(e){const t=_.Zero();return _.NormalizeToRef(e,t),t}static NormalizeToRef(e,t){return e.normalizeToRef(t),t}static Clamp(e,t,i){const r=new _;return _.ClampToRef(e,t,i,r),r}static ClampToRef(e,t,i,r){return r.copyFromFloats((0,l.OQ)(e.x,t.x,i.x),(0,l.OQ)(e.y,t.y,i.y),(0,l.OQ)(e.z,t.z,i.z),(0,l.OQ)(e.w,t.w,i.w))}static Random(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new _((0,l.VD)(e,t),(0,l.VD)(e,t),(0,l.VD)(e,t),(0,l.VD)(e,t))}static RandomToRef(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).copyFromFloats((0,l.VD)(e,t),(0,l.VD)(e,t),(0,l.VD)(e,t),(0,l.VD)(e,t))}static Minimize(){throw new ReferenceError("Quaternion.Minimize does not make sense")}static Maximize(){throw new ReferenceError("Quaternion.Maximize does not make sense")}static Distance(e,t){return Math.sqrt(_.DistanceSquared(e,t))}static DistanceSquared(e,t){const i=e.x-t.x,r=e.y-t.y,s=e.z-t.z,n=e.w-t.w;return i*i+r*r+s*s+n*n}static Center(e,t){return _.CenterToRef(e,t,_.Zero())}static CenterToRef(e,t,i){return i.copyFromFloats((e.x+t.x)/2,(e.y+t.y)/2,(e.z+t.z)/2,(e.w+t.w)/2)}}Object.defineProperties(_.prototype,{dimension:{value:[4]},rank:{value:1}});class p{static get Use64Bits(){return a.I.MatrixUse64Bits}get m(){return this._m}markAsUpdated(){this.updateFlag=p._UpdateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0}_updateIdentityStatus(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._isIdentity=e,this._isIdentity3x2=e||i,this._isIdentityDirty=!this._isIdentity&&t,this._isIdentity3x2Dirty=!this._isIdentity3x2&&r}constructor(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,a.I.MatrixTrackPrecisionChange&&a.I.MatrixTrackedMatrices.push(this),this._m=new a.I.MatrixCurrentType(16),this.markAsUpdated()}isIdentity(){if(this._isIdentityDirty){this._isIdentityDirty=!1;const e=this._m;this._isIdentity=1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&0===e[12]&&0===e[13]&&0===e[14]&&1===e[15]}return this._isIdentity}isIdentityAs3x2(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this._m[0]||1!==this._m[5]||1!==this._m[15]||0!==this._m[1]||0!==this._m[2]||0!==this._m[3]||0!==this._m[4]||0!==this._m[6]||0!==this._m[7]||0!==this._m[8]||0!==this._m[9]||0!==this._m[10]||0!==this._m[11]||0!==this._m[12]||0!==this._m[13]||0!==this._m[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2}determinant(){if(!0===this._isIdentity)return 1;const e=this._m,t=e[0],i=e[1],r=e[2],s=e[3],n=e[4],a=e[5],o=e[6],l=e[7],h=e[8],c=e[9],u=e[10],d=e[11],_=e[12],p=e[13],f=e[14],g=e[15],m=u*g-f*d,b=c*g-p*d,v=c*f-p*u,y=h*g-_*d,T=h*f-u*_,x=h*p-_*c;return t*+(a*m-o*b+l*v)+i*-(n*m-o*y+l*T)+r*+(n*b-a*y+l*x)+s*-(n*v-a*T+o*x)}toString(){return`{${this.m[0]}, ${this.m[1]}, ${this.m[2]}, ${this.m[3]}\n${this.m[4]}, ${this.m[5]}, ${this.m[6]}, ${this.m[7]}\n${this.m[8]}, ${this.m[9]}, ${this.m[10]}, ${this.m[11]}\n${this.m[12]}, ${this.m[13]}, ${this.m[14]}, ${this.m[15]}}`}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!e)return this._m;const i=this._m;for(let r=0;r<16;r++)e[t+r]=i[r];return this}asArray(){return this._m}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return p.FromArrayToRef(e,t,this)}copyFromFloats(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return p.FromArrayToRef(t,0,this)}set(){const e=this._m;for(let t=0;t<16;t++)e[t]=t<0||arguments.length<=t?void 0:arguments[t];return this.markAsUpdated(),this}setAll(e){const t=this._m;for(let i=0;i<16;i++)t[i]=e;return this.markAsUpdated(),this}invert(){return this.invertToRef(this),this}reset(){return p.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this}add(e){const t=new p;return this.addToRef(e,t),t}addToRef(e,t){const i=this._m,r=t._m,s=e.m;for(let n=0;n<16;n++)r[n]=i[n]+s[n];return t.markAsUpdated(),t}addToSelf(e){const t=this._m,i=e.m;return t[0]+=i[0],t[1]+=i[1],t[2]+=i[2],t[3]+=i[3],t[4]+=i[4],t[5]+=i[5],t[6]+=i[6],t[7]+=i[7],t[8]+=i[8],t[9]+=i[9],t[10]+=i[10],t[11]+=i[11],t[12]+=i[12],t[13]+=i[13],t[14]+=i[14],t[15]+=i[15],this.markAsUpdated(),this}addInPlace(e){const t=this._m,i=e.m;for(let r=0;r<16;r++)t[r]+=i[r];return this.markAsUpdated(),this}addInPlaceFromFloats(){const e=this._m;for(let t=0;t<16;t++)e[t]+=t<0||arguments.length<=t?void 0:arguments[t];return this.markAsUpdated(),this}subtract(e){const t=this._m,i=e.m;for(let r=0;r<16;r++)t[r]-=i[r];return this.markAsUpdated(),this}subtractToRef(e,t){const i=this._m,r=e.m,s=t._m;for(let n=0;n<16;n++)s[n]=i[n]-r[n];return t.markAsUpdated(),t}subtractInPlace(e){const t=this._m,i=e.m;for(let r=0;r<16;r++)t[r]-=i[r];return this.markAsUpdated(),this}subtractFromFloats(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.subtractFromFloatsToRef(...t,new p)}subtractFromFloatsToRef(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];const r=t.pop(),s=this._m,n=r._m,a=t;for(let o=0;o<16;o++)n[o]=s[o]-a[o];return r.markAsUpdated(),r}invertToRef(e){if(!0===this._isIdentity)return p.IdentityToRef(e),e;const t=this._m,i=t[0],r=t[1],s=t[2],n=t[3],a=t[4],o=t[5],l=t[6],h=t[7],c=t[8],u=t[9],d=t[10],_=t[11],f=t[12],g=t[13],m=t[14],b=t[15],v=d*b-m*_,y=u*b-g*_,T=u*m-g*d,x=c*b-f*_,A=c*m-d*f,C=c*g-f*u,R=+(o*v-l*y+h*T),E=-(a*v-l*x+h*A),S=+(a*y-o*x+h*C),M=-(a*T-o*A+l*C),P=i*R+r*E+s*S+n*M;if(0===P)return e.copyFrom(this),e;const I=1/P,O=l*b-m*h,D=o*b-g*h,w=o*m-g*l,F=a*b-f*h,L=a*m-f*l,B=a*g-f*o,N=l*_-d*h,k=o*_-u*h,U=o*d-u*l,V=a*_-c*h,z=a*d-c*l,G=a*u-c*o,H=-(r*v-s*y+n*T),W=+(i*v-s*x+n*A),q=-(i*y-r*x+n*C),X=+(i*T-r*A+s*C),K=+(r*O-s*D+n*w),Y=-(i*O-s*F+n*L),j=+(i*D-r*F+n*B),Q=-(i*w-r*L+s*B),$=-(r*N-s*k+n*U),Z=+(i*N-s*V+n*z),J=-(i*k-r*V+n*G),ee=+(i*U-r*z+s*G);return p.FromValuesToRef(R*I,H*I,K*I,$*I,E*I,W*I,Y*I,Z*I,S*I,q*I,j*I,J*I,M*I,X*I,Q*I,ee*I,e),e}addAtIndex(e,t){return this._m[e]+=t,this.markAsUpdated(),this}multiplyAtIndex(e,t){return this._m[e]*=t,this.markAsUpdated(),this}setTranslationFromFloats(e,t,i){return this._m[12]=e,this._m[13]=t,this._m[14]=i,this.markAsUpdated(),this}addTranslationFromFloats(e,t,i){return this._m[12]+=e,this._m[13]+=t,this._m[14]+=i,this.markAsUpdated(),this}setTranslation(e){return this.setTranslationFromFloats(e._x,e._y,e._z)}getTranslation(){return new u(this._m[12],this._m[13],this._m[14])}getTranslationToRef(e){return e.x=this._m[12],e.y=this._m[13],e.z=this._m[14],e}removeRotationAndScaling(){const e=this.m;return p.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,e[12],e[13],e[14],e[15],this),this._updateIdentityStatus(0===e[12]&&0===e[13]&&0===e[14]&&1===e[15]),this}copyFrom(e){e.copyToArray(this._m);const t=e;return this.updateFlag=t.updateFlag,this._updateIdentityStatus(t._isIdentity,t._isIdentityDirty,t._isIdentity3x2,t._isIdentity3x2Dirty),this}copyToArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=this._m;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],this}multiply(e){const t=new p;return this.multiplyToRef(e,t),t}multiplyInPlace(e){const t=this._m,i=e.m;for(let r=0;r<16;r++)t[r]*=i[r];return this.markAsUpdated(),this}multiplyByFloats(){const e=this._m;for(let t=0;t<16;t++)e[t]*=t<0||arguments.length<=t?void 0:arguments[t];return this.markAsUpdated(),this}multiplyByFloatsToRef(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];const r=t.pop(),s=this._m,n=r._m,a=t;for(let o=0;o<16;o++)n[o]=s[o]*a[o];return r.markAsUpdated(),r}multiplyToRef(e,t){return this._isIdentity?(t.copyFrom(e),t):e._isIdentity?(t.copyFrom(this),t):(this.multiplyToArray(e,t._m,0),t.markAsUpdated(),t)}multiplyToArray(e,t,i){const r=this._m,s=e.m,n=r[0],a=r[1],o=r[2],l=r[3],h=r[4],c=r[5],u=r[6],d=r[7],_=r[8],p=r[9],f=r[10],g=r[11],m=r[12],b=r[13],v=r[14],y=r[15],T=s[0],x=s[1],A=s[2],C=s[3],R=s[4],E=s[5],S=s[6],M=s[7],P=s[8],I=s[9],O=s[10],D=s[11],w=s[12],F=s[13],L=s[14],B=s[15];return t[i]=n*T+a*R+o*P+l*w,t[i+1]=n*x+a*E+o*I+l*F,t[i+2]=n*A+a*S+o*O+l*L,t[i+3]=n*C+a*M+o*D+l*B,t[i+4]=h*T+c*R+u*P+d*w,t[i+5]=h*x+c*E+u*I+d*F,t[i+6]=h*A+c*S+u*O+d*L,t[i+7]=h*C+c*M+u*D+d*B,t[i+8]=_*T+p*R+f*P+g*w,t[i+9]=_*x+p*E+f*I+g*F,t[i+10]=_*A+p*S+f*O+g*L,t[i+11]=_*C+p*M+f*D+g*B,t[i+12]=m*T+b*R+v*P+y*w,t[i+13]=m*x+b*E+v*I+y*F,t[i+14]=m*A+b*S+v*O+y*L,t[i+15]=m*C+b*M+v*D+y*B,this}divide(e){return this.divideToRef(e,new p)}divideToRef(e,t){const i=this._m,r=e.m,s=t._m;for(let n=0;n<16;n++)s[n]=i[n]/r[n];return t.markAsUpdated(),t}divideInPlace(e){const t=this._m,i=e.m;for(let r=0;r<16;r++)t[r]/=i[r];return this.markAsUpdated(),this}minimizeInPlace(e){const t=this._m,i=e.m;for(let r=0;r<16;r++)t[r]=Math.min(t[r],i[r]);return this.markAsUpdated(),this}minimizeInPlaceFromFloats(){const e=this._m;for(let t=0;t<16;t++)e[t]=Math.min(e[t],t<0||arguments.length<=t?void 0:arguments[t]);return this.markAsUpdated(),this}maximizeInPlace(e){const t=this._m,i=e.m;for(let r=0;r<16;r++)t[r]=Math.min(t[r],i[r]);return this.markAsUpdated(),this}maximizeInPlaceFromFloats(){const e=this._m;for(let t=0;t<16;t++)e[t]=Math.min(e[t],t<0||arguments.length<=t?void 0:arguments[t]);return this.markAsUpdated(),this}negate(){return this.negateToRef(new p)}negateInPlace(){const e=this._m;for(let t=0;t<16;t++)e[t]=-e[t];return this.markAsUpdated(),this}negateToRef(e){const t=this._m,i=e._m;for(let r=0;r<16;r++)i[r]=-t[r];return e.markAsUpdated(),e}equals(e){const t=e;if(!t)return!1;if((this._isIdentity||t._isIdentity)&&!this._isIdentityDirty&&!t._isIdentityDirty)return this._isIdentity&&t._isIdentity;const i=this.m,r=t.m;return i[0]===r[0]&&i[1]===r[1]&&i[2]===r[2]&&i[3]===r[3]&&i[4]===r[4]&&i[5]===r[5]&&i[6]===r[6]&&i[7]===r[7]&&i[8]===r[8]&&i[9]===r[9]&&i[10]===r[10]&&i[11]===r[11]&&i[12]===r[12]&&i[13]===r[13]&&i[14]===r[14]&&i[15]===r[15]}equalsWithEpsilon(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=this._m,r=e.m;for(let s=0;s<16;s++)if(!(0,l.Mj)(i[s],r[s],t))return!1;return!0}equalsToFloats(){const e=this._m;for(let t=0;t<16;t++)if(e[t]!=(t<0||arguments.length<=t?void 0:arguments[t]))return!1;return!0}floor(){return this.floorToRef(new p)}floorToRef(e){const t=this._m,i=e._m;for(let r=0;r<16;r++)i[r]=Math.floor(t[r]);return e.markAsUpdated(),e}fract(){return this.fractToRef(new p)}fractToRef(e){const t=this._m,i=e._m;for(let r=0;r<16;r++)i[r]=t[r]-Math.floor(t[r]);return e.markAsUpdated(),e}clone(){const e=new p;return e.copyFrom(this),e}getClassName(){return"Matrix"}getHashCode(){let e=h(this._m[0]);for(let t=1;t<16;t++)e=397*e^h(this._m[t]);return e}decomposeToTransformNode(e){return e.rotationQuaternion=e.rotationQuaternion||new _,this.decompose(e.scaling,e.rotationQuaternion,e.position)}decompose(e,t,i,r){let s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(this._isIdentity)return i&&i.setAll(0),e&&e.setAll(1),t&&t.copyFromFloats(0,0,0,1),!0;const n=this._m;if(i&&i.copyFromFloats(n[12],n[13],n[14]),(e=e||f.Vector3[0]).x=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]),e.y=Math.sqrt(n[4]*n[4]+n[5]*n[5]+n[6]*n[6]),e.z=Math.sqrt(n[8]*n[8]+n[9]*n[9]+n[10]*n[10]),r){const t=(s?r.absoluteScaling.x:r.scaling.x)<0?-1:1,i=(s?r.absoluteScaling.y:r.scaling.y)<0?-1:1,n=(s?r.absoluteScaling.z:r.scaling.z)<0?-1:1;e.x*=t,e.y*=i,e.z*=n}else this.determinant()<=0&&(e.y*=-1);if(0===e._x||0===e._y||0===e._z)return t&&t.copyFromFloats(0,0,0,1),!1;if(t){const i=1/e._x,r=1/e._y,s=1/e._z;p.FromValuesToRef(n[0]*i,n[1]*i,n[2]*i,0,n[4]*r,n[5]*r,n[6]*r,0,n[8]*s,n[9]*s,n[10]*s,0,0,0,0,1,f.Matrix[0]),_.FromRotationMatrixToRef(f.Matrix[0],t)}return!0}getRow(e){if(e<0||e>3)return null;const t=4*e;return new d(this._m[t+0],this._m[t+1],this._m[t+2],this._m[t+3])}getRowToRef(e,t){if(e>=0&&e<=3){const i=4*e;t.x=this._m[i+0],t.y=this._m[i+1],t.z=this._m[i+2],t.w=this._m[i+3]}return t}setRow(e,t){return this.setRowFromFloats(e,t.x,t.y,t.z,t.w)}transpose(){const e=new p;return p.TransposeToRef(this,e),e}transposeToRef(e){return p.TransposeToRef(this,e),e}setRowFromFloats(e,t,i,r,s){if(e<0||e>3)return this;const n=4*e;return this._m[n+0]=t,this._m[n+1]=i,this._m[n+2]=r,this._m[n+3]=s,this.markAsUpdated(),this}scale(e){const t=new p;return this.scaleToRef(e,t),t}scaleToRef(e,t){for(let i=0;i<16;i++)t._m[i]=this._m[i]*e;return t.markAsUpdated(),t}scaleAndAddToRef(e,t){for(let i=0;i<16;i++)t._m[i]+=this._m[i]*e;return t.markAsUpdated(),t}scaleInPlace(e){const t=this._m;for(let i=0;i<16;i++)t[i]*=e;return this.markAsUpdated(),this}toNormalMatrix(e){const t=f.Matrix[0];this.invertToRef(t),t.transposeToRef(e);const i=e._m;return p.FromValuesToRef(i[0],i[1],i[2],0,i[4],i[5],i[6],0,i[8],i[9],i[10],0,0,0,0,1,e),e}getRotationMatrix(){const e=new p;return this.getRotationMatrixToRef(e),e}getRotationMatrixToRef(e){const t=f.Vector3[0];if(!this.decompose(t))return p.IdentityToRef(e),e;const i=this._m,r=1/t._x,s=1/t._y,n=1/t._z;return p.FromValuesToRef(i[0]*r,i[1]*r,i[2]*r,0,i[4]*s,i[5]*s,i[6]*s,0,i[8]*n,i[9]*n,i[10]*n,0,0,0,0,1,e),e}toggleModelMatrixHandInPlace(){const e=this._m;return e[2]*=-1,e[6]*=-1,e[8]*=-1,e[9]*=-1,e[14]*=-1,this.markAsUpdated(),this}toggleProjectionMatrixHandInPlace(){const e=this._m;return e[8]*=-1,e[9]*=-1,e[10]*=-1,e[11]*=-1,this.markAsUpdated(),this}static FromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=new p;return p.FromArrayToRef(e,t,i),i}static FromArrayToRef(e,t,i){for(let r=0;r<16;r++)i._m[r]=e[r+t];return i.markAsUpdated(),i}static FromFloat32ArrayToRefScaled(e,t,i,r){return r._m[0]=e[0+t]*i,r._m[1]=e[1+t]*i,r._m[2]=e[2+t]*i,r._m[3]=e[3+t]*i,r._m[4]=e[4+t]*i,r._m[5]=e[5+t]*i,r._m[6]=e[6+t]*i,r._m[7]=e[7+t]*i,r._m[8]=e[8+t]*i,r._m[9]=e[9+t]*i,r._m[10]=e[10+t]*i,r._m[11]=e[11+t]*i,r._m[12]=e[12+t]*i,r._m[13]=e[13+t]*i,r._m[14]=e[14+t]*i,r._m[15]=e[15+t]*i,r.markAsUpdated(),r}static get IdentityReadOnly(){return p._IdentityReadOnly}static FromValuesToRef(e,t,i,r,s,n,a,o,l,h,c,u,d,_,p,f,g){const m=g._m;m[0]=e,m[1]=t,m[2]=i,m[3]=r,m[4]=s,m[5]=n,m[6]=a,m[7]=o,m[8]=l,m[9]=h,m[10]=c,m[11]=u,m[12]=d,m[13]=_,m[14]=p,m[15]=f,g.markAsUpdated()}static FromValues(e,t,i,r,s,n,a,o,l,h,c,u,d,_,f,g){const m=new p,b=m._m;return b[0]=e,b[1]=t,b[2]=i,b[3]=r,b[4]=s,b[5]=n,b[6]=a,b[7]=o,b[8]=l,b[9]=h,b[10]=c,b[11]=u,b[12]=d,b[13]=_,b[14]=f,b[15]=g,m.markAsUpdated(),m}static Compose(e,t,i){const r=new p;return p.ComposeToRef(e,t,i,r),r}static ComposeToRef(e,t,i,r){const s=r._m,n=t._x,a=t._y,o=t._z,l=t._w,h=n+n,c=a+a,u=o+o,d=n*h,_=n*c,p=n*u,f=a*c,g=a*u,m=o*u,b=l*h,v=l*c,y=l*u,T=e._x,x=e._y,A=e._z;return s[0]=(1-(f+m))*T,s[1]=(_+y)*T,s[2]=(p-v)*T,s[3]=0,s[4]=(_-y)*x,s[5]=(1-(d+m))*x,s[6]=(g+b)*x,s[7]=0,s[8]=(p+v)*A,s[9]=(g-b)*A,s[10]=(1-(d+f))*A,s[11]=0,s[12]=i._x,s[13]=i._y,s[14]=i._z,s[15]=1,r.markAsUpdated(),r}static Identity(){const e=p.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return e._updateIdentityStatus(!0),e}static IdentityToRef(e){return p.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,e),e._updateIdentityStatus(!0),e}static Zero(){const e=p.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return e._updateIdentityStatus(!1),e}static RotationX(e){const t=new p;return p.RotationXToRef(e,t),t}static Invert(e){const t=new p;return e.invertToRef(t),t}static RotationXToRef(e,t){const i=Math.sin(e),r=Math.cos(e);return p.FromValuesToRef(1,0,0,0,0,r,i,0,0,-i,r,0,0,0,0,1,t),t._updateIdentityStatus(1===r&&0===i),t}static RotationY(e){const t=new p;return p.RotationYToRef(e,t),t}static RotationYToRef(e,t){const i=Math.sin(e),r=Math.cos(e);return p.FromValuesToRef(r,0,-i,0,0,1,0,0,i,0,r,0,0,0,0,1,t),t._updateIdentityStatus(1===r&&0===i),t}static RotationZ(e){const t=new p;return p.RotationZToRef(e,t),t}static RotationZToRef(e,t){const i=Math.sin(e),r=Math.cos(e);return p.FromValuesToRef(r,i,0,0,-i,r,0,0,0,0,1,0,0,0,0,1,t),t._updateIdentityStatus(1===r&&0===i),t}static RotationAxis(e,t){const i=new p;return p.RotationAxisToRef(e,t,i),i}static RotationAxisToRef(e,t,i){const r=Math.sin(-t),s=Math.cos(-t),n=1-s;e=e.normalizeToRef(f.Vector3[0]);const a=i._m;return a[0]=e._x*e._x*n+s,a[1]=e._x*e._y*n-e._z*r,a[2]=e._x*e._z*n+e._y*r,a[3]=0,a[4]=e._y*e._x*n+e._z*r,a[5]=e._y*e._y*n+s,a[6]=e._y*e._z*n-e._x*r,a[7]=0,a[8]=e._z*e._x*n-e._y*r,a[9]=e._z*e._y*n+e._x*r,a[10]=e._z*e._z*n+s,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,i.markAsUpdated(),i}static RotationAlignToRef(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const n=u.Dot(t,e),a=i._m;if(n<-1+r.bH)a[0]=-1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=s?1:-1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=s?-1:1,a[11]=0;else{const i=u.Cross(t,e),r=1/(1+n);a[0]=i._x*i._x*r+n,a[1]=i._y*i._x*r-i._z,a[2]=i._z*i._x*r+i._y,a[3]=0,a[4]=i._x*i._y*r+i._z,a[5]=i._y*i._y*r+n,a[6]=i._z*i._y*r-i._x,a[7]=0,a[8]=i._x*i._z*r-i._y,a[9]=i._y*i._z*r+i._x,a[10]=i._z*i._z*r+n,a[11]=0}return a[12]=0,a[13]=0,a[14]=0,a[15]=1,i.markAsUpdated(),i}static RotationYawPitchRoll(e,t,i){const r=new p;return p.RotationYawPitchRollToRef(e,t,i,r),r}static RotationYawPitchRollToRef(e,t,i,r){return _.RotationYawPitchRollToRef(e,t,i,f.Quaternion[0]),f.Quaternion[0].toRotationMatrix(r),r}static Scaling(e,t,i){const r=new p;return p.ScalingToRef(e,t,i,r),r}static ScalingToRef(e,t,i,r){return p.FromValuesToRef(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1,r),r._updateIdentityStatus(1===e&&1===t&&1===i),r}static Translation(e,t,i){const r=new p;return p.TranslationToRef(e,t,i,r),r}static TranslationToRef(e,t,i,r){return p.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,e,t,i,1,r),r._updateIdentityStatus(0===e&&0===t&&0===i),r}static Lerp(e,t,i){const r=new p;return p.LerpToRef(e,t,i,r),r}static LerpToRef(e,t,i,r){const s=r._m,n=e.m,a=t.m;for(let o=0;o<16;o++)s[o]=n[o]*(1-i)+a[o]*i;return r.markAsUpdated(),r}static DecomposeLerp(e,t,i){const r=new p;return p.DecomposeLerpToRef(e,t,i,r),r}static DecomposeLerpToRef(e,t,i,r){const s=f.Vector3[0],n=f.Quaternion[0],a=f.Vector3[1];e.decompose(s,n,a);const o=f.Vector3[2],l=f.Quaternion[1],h=f.Vector3[3];t.decompose(o,l,h);const c=f.Vector3[4];u.LerpToRef(s,o,i,c);const d=f.Quaternion[2];_.SlerpToRef(n,l,i,d);const g=f.Vector3[5];return u.LerpToRef(a,h,i,g),p.ComposeToRef(c,d,g,r),r}static LookAtLH(e,t,i){const r=new p;return p.LookAtLHToRef(e,t,i,r),r}static LookAtLHToRef(e,t,i,r){const s=f.Vector3[0],n=f.Vector3[1],a=f.Vector3[2];t.subtractToRef(e,a),a.normalize(),u.CrossToRef(i,a,s);const o=s.lengthSquared();0===o?s.x=1:s.normalizeFromLength(Math.sqrt(o)),u.CrossToRef(a,s,n),n.normalize();const l=-u.Dot(s,e),h=-u.Dot(n,e),c=-u.Dot(a,e);return p.FromValuesToRef(s._x,n._x,a._x,0,s._y,n._y,a._y,0,s._z,n._z,a._z,0,l,h,c,1,r),r}static LookAtRH(e,t,i){const r=new p;return p.LookAtRHToRef(e,t,i,r),r}static LookAtRHToRef(e,t,i,r){const s=f.Vector3[0],n=f.Vector3[1],a=f.Vector3[2];e.subtractToRef(t,a),a.normalize(),u.CrossToRef(i,a,s);const o=s.lengthSquared();0===o?s.x=1:s.normalizeFromLength(Math.sqrt(o)),u.CrossToRef(a,s,n),n.normalize();const l=-u.Dot(s,e),h=-u.Dot(n,e),c=-u.Dot(a,e);return p.FromValuesToRef(s._x,n._x,a._x,0,s._y,n._y,a._y,0,s._z,n._z,a._z,0,l,h,c,1,r),r}static LookDirectionLH(e,t){const i=new p;return p.LookDirectionLHToRef(e,t,i),i}static LookDirectionLHToRef(e,t,i){const r=f.Vector3[0];r.copyFrom(e),r.scaleInPlace(-1);const s=f.Vector3[1];return u.CrossToRef(t,r,s),p.FromValuesToRef(s._x,s._y,s._z,0,t._x,t._y,t._z,0,r._x,r._y,r._z,0,0,0,0,1,i),i}static LookDirectionRH(e,t){const i=new p;return p.LookDirectionRHToRef(e,t,i),i}static LookDirectionRHToRef(e,t,i){const r=f.Vector3[2];return u.CrossToRef(t,e,r),p.FromValuesToRef(r._x,r._y,r._z,0,t._x,t._y,t._z,0,e._x,e._y,e._z,0,0,0,0,1,i),i}static OrthoLH(e,t,i,r,s){const n=new p;return p.OrthoLHToRef(e,t,i,r,n,s),n}static OrthoLHToRef(e,t,i,r,s,n){const a=2/e,o=2/t,l=2/(r-i),h=-(r+i)/(r-i);return p.FromValuesToRef(a,0,0,0,0,o,0,0,0,0,l,0,0,0,h,1,s),n&&s.multiplyToRef(m,s),s._updateIdentityStatus(1===a&&1===o&&1===l&&0===h),s}static OrthoOffCenterLH(e,t,i,r,s,n,a){const o=new p;return p.OrthoOffCenterLHToRef(e,t,i,r,s,n,o,a),o}static OrthoOffCenterLHToRef(e,t,i,r,s,n,a,o){const l=2/(t-e),h=2/(r-i),c=2/(n-s),u=-(n+s)/(n-s),d=(e+t)/(e-t),_=(r+i)/(i-r);return p.FromValuesToRef(l,0,0,0,0,h,0,0,0,0,c,0,d,_,u,1,a),o&&a.multiplyToRef(m,a),a.markAsUpdated(),a}static ObliqueOffCenterLHToRef(e,t,i,r,s,n,a,o,l,h,c){const u=-a*Math.cos(o),d=-a*Math.sin(o);return p.TranslationToRef(0,0,-l,f.Matrix[1]),p.FromValuesToRef(1,0,0,0,0,1,0,0,u,d,1,0,0,0,0,1,f.Matrix[0]),f.Matrix[1].multiplyToRef(f.Matrix[0],f.Matrix[0]),p.TranslationToRef(0,0,l,f.Matrix[1]),f.Matrix[0].multiplyToRef(f.Matrix[1],f.Matrix[0]),p.OrthoOffCenterLHToRef(e,t,i,r,s,n,h,c),f.Matrix[0].multiplyToRef(h,h),h}static OrthoOffCenterRH(e,t,i,r,s,n,a){const o=new p;return p.OrthoOffCenterRHToRef(e,t,i,r,s,n,o,a),o}static OrthoOffCenterRHToRef(e,t,i,r,s,n,a,o){return p.OrthoOffCenterLHToRef(e,t,i,r,s,n,a,o),a._m[10]*=-1,a}static ObliqueOffCenterRHToRef(e,t,i,r,s,n,a,o,l,h,c){const u=a*Math.cos(o),d=a*Math.sin(o);return p.TranslationToRef(0,0,l,f.Matrix[1]),p.FromValuesToRef(1,0,0,0,0,1,0,0,u,d,1,0,0,0,0,1,f.Matrix[0]),f.Matrix[1].multiplyToRef(f.Matrix[0],f.Matrix[0]),p.TranslationToRef(0,0,-l,f.Matrix[1]),f.Matrix[0].multiplyToRef(f.Matrix[1],f.Matrix[0]),p.OrthoOffCenterRHToRef(e,t,i,r,s,n,h,c),f.Matrix[0].multiplyToRef(h,h),h}static PerspectiveLH(e,t,i,r,s){let n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const a=new p,o=2*i/e,l=2*i/t,h=(r+i)/(r-i),c=-2*r*i/(r-i),u=Math.tan(n);return p.FromValuesToRef(o,0,0,0,0,l,0,u,0,0,h,1,0,0,c,0,a),s&&a.multiplyToRef(m,a),a._updateIdentityStatus(!1),a}static PerspectiveFovLH(e,t,i,r,s){let n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const o=new p;return p.PerspectiveFovLHToRef(e,t,i,r,o,!0,s,n,a),o}static PerspectiveFovLHToRef(e,t,i,r,s){let n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=arguments.length>6?arguments[6]:void 0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,l=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const h=i,c=r,u=1/Math.tan(.5*e),d=n?u/t:u,_=n?u:u*t,f=l&&0===h?-1:0!==c?(c+h)/(c-h):1,g=l&&0===h?2*c:0!==c?-2*c*h/(c-h):-2*h,b=Math.tan(o);return p.FromValuesToRef(d,0,0,0,0,_,0,b,0,0,f,1,0,0,g,0,s),a&&s.multiplyToRef(m,s),s._updateIdentityStatus(!1),s}static PerspectiveFovReverseLHToRef(e,t,i,r,s){let n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=arguments.length>6?arguments[6]:void 0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const l=1/Math.tan(.5*e),h=n?l/t:l,c=n?l:l*t,u=Math.tan(o);return p.FromValuesToRef(h,0,0,0,0,c,0,u,0,0,-i,1,0,0,1,0,s),a&&s.multiplyToRef(m,s),s._updateIdentityStatus(!1),s}static PerspectiveFovRH(e,t,i,r,s){let n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const o=new p;return p.PerspectiveFovRHToRef(e,t,i,r,o,!0,s,n,a),o}static PerspectiveFovRHToRef(e,t,i,r,s){let n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=arguments.length>6?arguments[6]:void 0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,l=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const h=i,c=r,u=1/Math.tan(.5*e),d=n?u/t:u,_=n?u:u*t,f=l&&0===h?1:0!==c?-(c+h)/(c-h):-1,g=l&&0===h?2*c:0!==c?-2*c*h/(c-h):-2*h,b=Math.tan(o);return p.FromValuesToRef(d,0,0,0,0,_,0,b,0,0,f,-1,0,0,g,0,s),a&&s.multiplyToRef(m,s),s._updateIdentityStatus(!1),s}static PerspectiveFovReverseRHToRef(e,t,i,r,s){let n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=arguments.length>6?arguments[6]:void 0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const l=1/Math.tan(.5*e),h=n?l/t:l,c=n?l:l*t,u=Math.tan(o);return p.FromValuesToRef(h,0,0,0,0,c,0,u,0,0,-i,-1,0,0,-1,0,s),a&&s.multiplyToRef(m,s),s._updateIdentityStatus(!1),s}static GetFinalMatrix(e,t,i,r,s,n){const a=e.width,o=e.height,l=e.x,h=e.y,c=p.FromValues(a/2,0,0,0,0,-o/2,0,0,0,0,n-s,0,l+a/2,o/2+h,s,1),u=new p;return t.multiplyToRef(i,u),u.multiplyToRef(r,u),u.multiplyToRef(c,u)}static GetAsMatrix2x2(e){const t=e.m,i=[t[0],t[1],t[4],t[5]];return a.I.MatrixUse64Bits?i:new Float32Array(i)}static GetAsMatrix3x3(e){const t=e.m,i=[t[0],t[1],t[2],t[4],t[5],t[6],t[8],t[9],t[10]];return a.I.MatrixUse64Bits?i:new Float32Array(i)}static Transpose(e){const t=new p;return p.TransposeToRef(e,t),t}static TransposeToRef(e,t){const i=e.m,r=i[0],s=i[4],n=i[8],a=i[12],o=i[1],l=i[5],h=i[9],c=i[13],u=i[2],d=i[6],_=i[10],p=i[14],f=i[3],g=i[7],m=i[11],b=i[15],v=t._m;return v[0]=r,v[1]=s,v[2]=n,v[3]=a,v[4]=o,v[5]=l,v[6]=h,v[7]=c,v[8]=u,v[9]=d,v[10]=_,v[11]=p,v[12]=f,v[13]=g,v[14]=m,v[15]=b,t.markAsUpdated(),t._updateIdentityStatus(e._isIdentity,e._isIdentityDirty),t}static Reflection(e){const t=new p;return p.ReflectionToRef(e,t),t}static ReflectionToRef(e,t){e.normalize();const i=e.normal.x,r=e.normal.y,s=e.normal.z,n=-2*i,a=-2*r,o=-2*s;return p.FromValuesToRef(n*i+1,a*i,o*i,0,n*r,a*r+1,o*r,0,n*s,a*s,o*s+1,0,n*e.d,a*e.d,o*e.d,1,t),t}static FromXYZAxesToRef(e,t,i,r){return p.FromValuesToRef(e._x,e._y,e._z,0,t._x,t._y,t._z,0,i._x,i._y,i._z,0,0,0,0,1,r),r}static FromQuaternionToRef(e,t){const i=e._x*e._x,r=e._y*e._y,s=e._z*e._z,n=e._x*e._y,a=e._z*e._w,o=e._z*e._x,l=e._y*e._w,h=e._y*e._z,c=e._x*e._w;return t._m[0]=1-2*(r+s),t._m[1]=2*(n+a),t._m[2]=2*(o-l),t._m[3]=0,t._m[4]=2*(n-a),t._m[5]=1-2*(s+i),t._m[6]=2*(h+c),t._m[7]=0,t._m[8]=2*(o+l),t._m[9]=2*(h-c),t._m[10]=1-2*(r+i),t._m[11]=0,t._m[12]=0,t._m[13]=0,t._m[14]=0,t._m[15]=1,t.markAsUpdated(),t}}p._UpdateFlagSeed=0,p._IdentityReadOnly=p.Identity(),Object.defineProperties(p.prototype,{dimension:{value:[4,4]},rank:{value:2}});class f{}f.Vector3=(0,s.ln)(11,u.Zero),f.Matrix=(0,s.ln)(2,p.Identity),f.Quaternion=(0,s.ln)(3,_.Zero);class g{}g.Vector2=(0,s.ln)(3,c.Zero),g.Vector3=(0,s.ln)(13,u.Zero),g.Vector4=(0,s.ln)(3,d.Zero),g.Quaternion=(0,s.ln)(3,_.Zero),g.Matrix=(0,s.ln)(8,p.Identity),(0,n.Y5)("BABYLON.Vector2",c),(0,n.Y5)("BABYLON.Vector3",u),(0,n.Y5)("BABYLON.Vector4",d),(0,n.Y5)("BABYLON.Matrix",p);const m=p.FromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1)},4857:(e,t,i)=>{"use strict";i.d(t,{L:()=>r});class r{constructor(e,t,i,r){this.x=e,this.y=t,this.width=i,this.height=r}toGlobal(e,t){return new r(this.x*e,this.y*t,this.width*e,this.height*t)}toGlobalToRef(e,t,i){return i.x=this.x*e,i.y=this.y*t,i.width=this.width*e,i.height=this.height*t,this}clone(){return new r(this.x,this.y,this.width,this.height)}}},1322:(e,t,i)=>{"use strict";i.d(t,{O:()=>h,Q:()=>c});var r=i(5968),s=i(8386);const n=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],a=[()=>1,e=>e.y,e=>e.z,e=>e.x,e=>e.x*e.y,e=>e.y*e.z,e=>3*e.z*e.z-1,e=>e.x*e.z,e=>e.x*e.x-e.y*e.y],o=(e,t)=>n[e]*a[e](t),l=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4];class h{constructor(){this.preScaled=!1,this.l00=r.Pq.Zero(),this.l1_1=r.Pq.Zero(),this.l10=r.Pq.Zero(),this.l11=r.Pq.Zero(),this.l2_2=r.Pq.Zero(),this.l2_1=r.Pq.Zero(),this.l20=r.Pq.Zero(),this.l21=r.Pq.Zero(),this.l22=r.Pq.Zero()}addLight(e,t,i){s.AA.Vector3[0].set(t.r,t.g,t.b);const r=s.AA.Vector3[0],n=s.AA.Vector3[1];r.scaleToRef(i,n),n.scaleToRef(o(0,e),s.AA.Vector3[2]),this.l00.addInPlace(s.AA.Vector3[2]),n.scaleToRef(o(1,e),s.AA.Vector3[2]),this.l1_1.addInPlace(s.AA.Vector3[2]),n.scaleToRef(o(2,e),s.AA.Vector3[2]),this.l10.addInPlace(s.AA.Vector3[2]),n.scaleToRef(o(3,e),s.AA.Vector3[2]),this.l11.addInPlace(s.AA.Vector3[2]),n.scaleToRef(o(4,e),s.AA.Vector3[2]),this.l2_2.addInPlace(s.AA.Vector3[2]),n.scaleToRef(o(5,e),s.AA.Vector3[2]),this.l2_1.addInPlace(s.AA.Vector3[2]),n.scaleToRef(o(6,e),s.AA.Vector3[2]),this.l20.addInPlace(s.AA.Vector3[2]),n.scaleToRef(o(7,e),s.AA.Vector3[2]),this.l21.addInPlace(s.AA.Vector3[2]),n.scaleToRef(o(8,e),s.AA.Vector3[2]),this.l22.addInPlace(s.AA.Vector3[2])}scaleInPlace(e){this.l00.scaleInPlace(e),this.l1_1.scaleInPlace(e),this.l10.scaleInPlace(e),this.l11.scaleInPlace(e),this.l2_2.scaleInPlace(e),this.l2_1.scaleInPlace(e),this.l20.scaleInPlace(e),this.l21.scaleInPlace(e),this.l22.scaleInPlace(e)}convertIncidentRadianceToIrradiance(){this.l00.scaleInPlace(l[0]),this.l1_1.scaleInPlace(l[1]),this.l10.scaleInPlace(l[2]),this.l11.scaleInPlace(l[3]),this.l2_2.scaleInPlace(l[4]),this.l2_1.scaleInPlace(l[5]),this.l20.scaleInPlace(l[6]),this.l21.scaleInPlace(l[7]),this.l22.scaleInPlace(l[8])}convertIrradianceToLambertianRadiance(){this.scaleInPlace(1/Math.PI)}preScaleForRendering(){this.preScaled=!0,this.l00.scaleInPlace(n[0]),this.l1_1.scaleInPlace(n[1]),this.l10.scaleInPlace(n[2]),this.l11.scaleInPlace(n[3]),this.l2_2.scaleInPlace(n[4]),this.l2_1.scaleInPlace(n[5]),this.l20.scaleInPlace(n[6]),this.l21.scaleInPlace(n[7]),this.l22.scaleInPlace(n[8])}updateFromArray(e){return r.Pq.FromArrayToRef(e[0],0,this.l00),r.Pq.FromArrayToRef(e[1],0,this.l1_1),r.Pq.FromArrayToRef(e[2],0,this.l10),r.Pq.FromArrayToRef(e[3],0,this.l11),r.Pq.FromArrayToRef(e[4],0,this.l2_2),r.Pq.FromArrayToRef(e[5],0,this.l2_1),r.Pq.FromArrayToRef(e[6],0,this.l20),r.Pq.FromArrayToRef(e[7],0,this.l21),r.Pq.FromArrayToRef(e[8],0,this.l22),this}updateFromFloatsArray(e){return r.Pq.FromFloatsToRef(e[0],e[1],e[2],this.l00),r.Pq.FromFloatsToRef(e[3],e[4],e[5],this.l1_1),r.Pq.FromFloatsToRef(e[6],e[7],e[8],this.l10),r.Pq.FromFloatsToRef(e[9],e[10],e[11],this.l11),r.Pq.FromFloatsToRef(e[12],e[13],e[14],this.l2_2),r.Pq.FromFloatsToRef(e[15],e[16],e[17],this.l2_1),r.Pq.FromFloatsToRef(e[18],e[19],e[20],this.l20),r.Pq.FromFloatsToRef(e[21],e[22],e[23],this.l21),r.Pq.FromFloatsToRef(e[24],e[25],e[26],this.l22),this}static FromArray(e){return(new h).updateFromArray(e)}static FromPolynomial(e){const t=new h;return t.l00=e.xx.scale(.376127).add(e.yy.scale(.376127)).add(e.zz.scale(.376126)),t.l1_1=e.y.scale(.977204),t.l10=e.z.scale(.977204),t.l11=e.x.scale(.977204),t.l2_2=e.xy.scale(1.16538),t.l2_1=e.yz.scale(1.16538),t.l20=e.zz.scale(1.34567).subtract(e.xx.scale(.672834)).subtract(e.yy.scale(.672834)),t.l21=e.zx.scale(1.16538),t.l22=e.xx.scale(1.16538).subtract(e.yy.scale(1.16538)),t.l1_1.scaleInPlace(-1),t.l11.scaleInPlace(-1),t.l2_1.scaleInPlace(-1),t.l21.scaleInPlace(-1),t.scaleInPlace(Math.PI),t}}class c{constructor(){this.x=r.Pq.Zero(),this.y=r.Pq.Zero(),this.z=r.Pq.Zero(),this.xx=r.Pq.Zero(),this.yy=r.Pq.Zero(),this.zz=r.Pq.Zero(),this.xy=r.Pq.Zero(),this.yz=r.Pq.Zero(),this.zx=r.Pq.Zero()}get preScaledHarmonics(){return this._harmonics||(this._harmonics=h.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics}addAmbient(e){s.AA.Vector3[0].copyFromFloats(e.r,e.g,e.b);const t=s.AA.Vector3[0];this.xx.addInPlace(t),this.yy.addInPlace(t),this.zz.addInPlace(t)}scaleInPlace(e){this.x.scaleInPlace(e),this.y.scaleInPlace(e),this.z.scaleInPlace(e),this.xx.scaleInPlace(e),this.yy.scaleInPlace(e),this.zz.scaleInPlace(e),this.yz.scaleInPlace(e),this.zx.scaleInPlace(e),this.xy.scaleInPlace(e)}updateFromHarmonics(e){return this._harmonics=e,this.x.copyFrom(e.l11),this.x.scaleInPlace(1.02333).scaleInPlace(-1),this.y.copyFrom(e.l1_1),this.y.scaleInPlace(1.02333).scaleInPlace(-1),this.z.copyFrom(e.l10),this.z.scaleInPlace(1.02333),this.xx.copyFrom(e.l00),s.AA.Vector3[0].copyFrom(e.l20).scaleInPlace(.247708),s.AA.Vector3[1].copyFrom(e.l22).scaleInPlace(.429043),this.xx.scaleInPlace(.886277).subtractInPlace(s.AA.Vector3[0]).addInPlace(s.AA.Vector3[1]),this.yy.copyFrom(e.l00),this.yy.scaleInPlace(.886277).subtractInPlace(s.AA.Vector3[0]).subtractInPlace(s.AA.Vector3[1]),this.zz.copyFrom(e.l00),s.AA.Vector3[0].copyFrom(e.l20).scaleInPlace(.495417),this.zz.scaleInPlace(.886277).addInPlace(s.AA.Vector3[0]),this.yz.copyFrom(e.l2_1),this.yz.scaleInPlace(.858086).scaleInPlace(-1),this.zx.copyFrom(e.l21),this.zx.scaleInPlace(.858086).scaleInPlace(-1),this.xy.copyFrom(e.l2_2),this.xy.scaleInPlace(.858086),this.scaleInPlace(1/Math.PI),this}static FromHarmonics(e){return(new c).updateFromHarmonics(e)}static FromArray(e){const t=new c;return r.Pq.FromArrayToRef(e[0],0,t.x),r.Pq.FromArrayToRef(e[1],0,t.y),r.Pq.FromArrayToRef(e[2],0,t.z),r.Pq.FromArrayToRef(e[3],0,t.xx),r.Pq.FromArrayToRef(e[4],0,t.yy),r.Pq.FromArrayToRef(e[5],0,t.zz),r.Pq.FromArrayToRef(e[6],0,t.yz),r.Pq.FromArrayToRef(e[7],0,t.zx),r.Pq.FromArrayToRef(e[8],0,t.xy),t}}},4116:(e,t,i)=>{"use strict";i.d(t,{A:()=>s});var r=i(3333);class s extends r.n{constructor(e){super(),this._buffer=e}get underlyingResource(){return this._buffer}}},4854:(e,t,i)=>{"use strict";i.d(t,{d:()=>h});var r=i(5968),s=i(7559),n=i(1322),a=i(9082),o=i(6760);class l{constructor(e,t,i,r){this.name=e,this.worldAxisForNormal=t,this.worldAxisForFileX=i,this.worldAxisForFileY=r}}class h{static ConvertCubeMapTextureToSphericalPolynomial(e){if(!e.isCube)return null;e.getScene()?.getEngine().flushFramebuffer();const t=e.getSize().width,i=e.readPixels(0,void 0,void 0,!1),r=e.readPixels(1,void 0,void 0,!1);let s,n;e.isRenderTarget?(s=e.readPixels(3,void 0,void 0,!1),n=e.readPixels(2,void 0,void 0,!1)):(s=e.readPixels(2,void 0,void 0,!1),n=e.readPixels(3,void 0,void 0,!1));const a=e.readPixels(4,void 0,void 0,!1),o=e.readPixels(5,void 0,void 0,!1),l=e.gammaSpace;let h=0;return 1!=e.textureType&&2!=e.textureType||(h=1),new Promise((e=>{Promise.all([r,i,s,n,a,o]).then((i=>{let[r,s,n,a,o,c]=i;const u={size:t,right:s,left:r,up:n,down:a,front:o,back:c,format:5,type:h,gammaSpace:l};e(this.ConvertCubeMapToSphericalPolynomial(u))}))}))}static _AreaElement(e,t){return Math.atan2(e*t,Math.sqrt(e*e+t*t+1))}static ConvertCubeMapToSphericalPolynomial(e){const t=new n.O;let i=0;const r=2/e.size,l=r,h=.5*r,c=h-1;for(let n=0;n<6;n++){const u=this._FileFaces[n],d=e[u.name];let _=c;const p=5===e.format?4:3;for(let n=0;n<e.size;n++){let f=c;for(let l=0;l<e.size;l++){const c=u.worldAxisForFileX.scale(f).add(u.worldAxisForFileY.scale(_)).add(u.worldAxisForNormal);c.normalize();const g=this._AreaElement(f-h,_-h)-this._AreaElement(f-h,_+h)-this._AreaElement(f+h,_-h)+this._AreaElement(f+h,_+h);let m=d[n*e.size*p+l*p+0],b=d[n*e.size*p+l*p+1],v=d[n*e.size*p+l*p+2];isNaN(m)&&(m=0),isNaN(b)&&(b=0),isNaN(v)&&(v=0),0===e.type&&(m/=255,b/=255,v/=255),e.gammaSpace&&(m=Math.pow(s.X.Clamp(m),a.tk),b=Math.pow(s.X.Clamp(b),a.tk),v=Math.pow(s.X.Clamp(v),a.tk));const y=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const e=Math.max(m,b,v);if(e>y){const t=y/e;m*=t,b*=t,v*=t}}else m=s.X.Clamp(m,0,y),b=s.X.Clamp(b,0,y),v=s.X.Clamp(v,0,y);const T=new o.v9(m,b,v);t.addLight(c,T,g),i+=g,f+=r}_+=l}}const u=6*(4*Math.PI)/6/i;return t.scaleInPlace(u),t.convertIncidentRadianceToIrradiance(),t.convertIrradianceToLambertianRadiance(),n.Q.FromHarmonics(t)}}h._FileFaces=[new l("right",new r.Pq(1,0,0),new r.Pq(0,0,-1),new r.Pq(0,-1,0)),new l("left",new r.Pq(-1,0,0),new r.Pq(0,0,1),new r.Pq(0,-1,0)),new l("up",new r.Pq(0,1,0),new r.Pq(1,0,0),new r.Pq(0,0,1)),new l("down",new r.Pq(0,-1,0),new r.Pq(1,0,0),new r.Pq(0,0,-1)),new l("front",new r.Pq(0,0,1),new r.Pq(1,0,0),new r.Pq(0,-1,0)),new l("back",new r.Pq(0,0,-1),new r.Pq(-1,0,0),new r.Pq(0,-1,0))],h.MAX_HDRI_VALUE=4096,h.PRESERVE_CLAMPED_COLORS=!1},4654:(e,t,i)=>{"use strict";function r(e,t){const i=[];for(let r=0;r<e;++r)i.push(t());return i}function s(e,t){return r(e,t)}i.d(t,{lL:()=>a,ln:()=>s,mI:()=>r});const n=["push","splice","pop","shift","unshift"];function a(e,t){const i=n.map((i=>function(e,t,i){const r=e[t];if("function"!==typeof r)return null;const s=function(){const r=e.length,n=s.previous.apply(e,arguments);return i(t,r),n};return r.next=s,s.previous=r,e[t]=s,()=>{const i=s.previous;if(!i)return;const r=s.next;r?(i.next=r,r.previous=i):(i.next=void 0,e[t]=i),s.next=void 0,s.previous=void 0}}(e,i,t)));return()=>{i.forEach((e=>{e?.()}))}}},561:(e,t,i)=>{"use strict";i.d(t,{D:()=>p});var r=i(7559),s=i(8274),n=i(4854),a=i(1063);i(9776),i(6952);const o=131072,l=131072;function h(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}const c=h("DXT1"),u=h("DXT3"),d=h("DXT5"),_=h("DX10");class p{static GetDDSInfo(e){const t=new Int32Array(e.buffer,e.byteOffset,31),i=new Int32Array(e.buffer,e.byteOffset,35);let r=1;t[2]&o&&(r=Math.max(1,t[7]));const s=t[21],n=s===_?i[32]:0;let a=0;switch(s){case 113:a=2;break;case 116:a=1;break;case _:if(10===n){a=2;break}if(2===n){a=1;break}}return{width:t[4],height:t[3],mipmapCount:r,isFourCC:4===(4&t[20]),isRGB:64===(64&t[20]),isLuminance:(t[20]&l)===l,isCube:512===(512&t[28]),isCompressed:s===c||s===u||s===d,dxgiFormat:n,textureType:a}}static _GetHalfFloatAsFloatRGBAArrayBuffer(e,t,i,r,s,n){const o=new Float32Array(r),l=new Uint16Array(s,i);let h=0;for(let c=0;c<t;c++)for(let t=0;t<e;t++){const i=4*(t+c*e);o[h]=(0,a.SX)(l[i]),o[h+1]=(0,a.SX)(l[i+1]),o[h+2]=(0,a.SX)(l[i+2]),p.StoreLODInAlphaChannel?o[h+3]=n:o[h+3]=(0,a.SX)(l[i+3]),h+=4}return o}static _GetHalfFloatRGBAArrayBuffer(e,t,i,r,s,n){if(p.StoreLODInAlphaChannel){const o=new Uint16Array(r),l=new Uint16Array(s,i);let h=0;for(let i=0;i<t;i++)for(let t=0;t<e;t++){const r=4*(t+i*e);o[h]=l[r],o[h+1]=l[r+1],o[h+2]=l[r+2],o[h+3]=(0,a.LZ)(n),h+=4}return o}return new Uint16Array(s,i,r)}static _GetFloatRGBAArrayBuffer(e,t,i,r,s,n){if(p.StoreLODInAlphaChannel){const a=new Float32Array(r),o=new Float32Array(s,i);let l=0;for(let i=0;i<t;i++)for(let t=0;t<e;t++){const r=4*(t+i*e);a[l]=o[r],a[l+1]=o[r+1],a[l+2]=o[r+2],a[l+3]=n,l+=4}return a}return new Float32Array(s,i,r)}static _GetFloatAsHalfFloatRGBAArrayBuffer(e,t,i,r,s,n){const o=new Uint16Array(r),l=new Float32Array(s,i);let h=0;for(let c=0;c<t;c++)for(let t=0;t<e;t++)o[h]=(0,a.LZ)(l[h]),o[h+1]=(0,a.LZ)(l[h+1]),o[h+2]=(0,a.LZ)(l[h+2]),p.StoreLODInAlphaChannel?o[h+3]=(0,a.LZ)(n):o[h+3]=(0,a.LZ)(l[h+3]),h+=4;return o}static _GetFloatAsUIntRGBAArrayBuffer(e,t,i,s,n,a){const o=new Uint8Array(s),l=new Float32Array(n,i);let h=0;for(let c=0;c<t;c++)for(let t=0;t<e;t++){const i=4*(t+c*e);o[h]=255*r.X.Clamp(l[i]),o[h+1]=255*r.X.Clamp(l[i+1]),o[h+2]=255*r.X.Clamp(l[i+2]),p.StoreLODInAlphaChannel?o[h+3]=a:o[h+3]=255*r.X.Clamp(l[i+3]),h+=4}return o}static _GetHalfFloatAsUIntRGBAArrayBuffer(e,t,i,s,n,o){const l=new Uint8Array(s),h=new Uint16Array(n,i);let c=0;for(let u=0;u<t;u++)for(let t=0;t<e;t++){const i=4*(t+u*e);l[c]=255*r.X.Clamp((0,a.SX)(h[i])),l[c+1]=255*r.X.Clamp((0,a.SX)(h[i+1])),l[c+2]=255*r.X.Clamp((0,a.SX)(h[i+2])),p.StoreLODInAlphaChannel?l[c+3]=o:l[c+3]=255*r.X.Clamp((0,a.SX)(h[i+3])),c+=4}return l}static _GetRGBAArrayBuffer(e,t,i,r,s,n,a,o,l){const h=new Uint8Array(r),c=new Uint8Array(s,i);let u=0;for(let d=0;d<t;d++)for(let t=0;t<e;t++){const i=4*(t+d*e);h[u]=c[i+n],h[u+1]=c[i+a],h[u+2]=c[i+o],h[u+3]=c[i+l],u+=4}return h}static _ExtractLongWordOrder(e){return 0===e||255===e||-16777216===e?0:1+p._ExtractLongWordOrder(e>>8)}static _GetRGBArrayBuffer(e,t,i,r,s,n,a,o){const l=new Uint8Array(r),h=new Uint8Array(s,i);let c=0;for(let u=0;u<t;u++)for(let t=0;t<e;t++){const i=3*(t+u*e);l[c]=h[i+n],l[c+1]=h[i+a],l[c+2]=h[i+o],c+=3}return l}static _GetLuminanceArrayBuffer(e,t,i,r,s){const n=new Uint8Array(r),a=new Uint8Array(s,i);let o=0;for(let l=0;l<t;l++)for(let t=0;t<e;t++){const i=t+l*e;n[o]=a[i],o++}return n}static UploadDDSLevels(e,t,i,r,a,l){let h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:-1,f=arguments.length>7?arguments[7]:void 0,g=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],m=null;r.sphericalPolynomial&&(m=[]);const b=!!e.getCaps().s3tc;t.generateMipMaps=a;const v=new Int32Array(i.buffer,i.byteOffset,31);let y,T,x,A,C,R,E,S=0,M=0,P=1;if(542327876!==v[0])return void s.V.Error("Invalid magic number in DDS header");if(!r.isFourCC&&!r.isRGB&&!r.isLuminance)return void s.V.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");if(r.isCompressed&&!b)return void s.V.Error("Compressed textures are not supported on this platform.");let I=v[22];A=v[1]+4;let O=!1;if(r.isFourCC)switch(y=v[21],y){case c:P=8,M=33777;break;case u:P=16,M=33778;break;case d:P=16,M=33779;break;case 113:O=!0,I=64;break;case 116:O=!0,I=128;break;case _:{A+=20;let e=!1;switch(r.dxgiFormat){case 10:O=!0,I=64,e=!0;break;case 2:O=!0,I=128,e=!0;break;case 88:r.isRGB=!0,r.isFourCC=!1,I=32,e=!0}if(e)break}default:return void s.V.Error(["Unsupported FourCC code:",(D=y,String.fromCharCode(255&D,D>>8&255,D>>16&255,D>>24&255))])}var D;const w=p._ExtractLongWordOrder(v[23]),F=p._ExtractLongWordOrder(v[24]),L=p._ExtractLongWordOrder(v[25]),B=p._ExtractLongWordOrder(v[26]);O&&(M=e._getRGBABufferInternalSizedFormat(r.textureType)),R=1,v[2]&o&&!1!==a&&(R=Math.max(1,v[7]));const N=f||0,k=e.getCaps();for(let s=N;s<l;s++){for(T=v[4],x=v[3],E=0;E<R;++E){if(-1===h||h===E){const n=-1===h?E:0;if(!r.isCompressed&&r.isFourCC){t.format=5,S=T*x*4;let r=null;if(e._badOS||e._badDesktopOS||!k.textureHalfFloat&&!k.textureFloat)128===I?(r=p._GetFloatAsUIntRGBAArrayBuffer(T,x,i.byteOffset+A,S,i.buffer,n),m&&0==n&&m.push(p._GetFloatRGBAArrayBuffer(T,x,i.byteOffset+A,S,i.buffer,n))):64===I&&(r=p._GetHalfFloatAsUIntRGBAArrayBuffer(T,x,i.byteOffset+A,S,i.buffer,n),m&&0==n&&m.push(p._GetHalfFloatAsFloatRGBAArrayBuffer(T,x,i.byteOffset+A,S,i.buffer,n))),t.type=0;else{const e=k.textureFloat&&(g&&k.textureFloatLinearFiltering||!g),s=k.textureHalfFloat&&(g&&k.textureHalfFloatLinearFiltering||!g),a=(128===I||64===I&&!s)&&e?1:(64===I||128===I&&!e)&&s?2:0;let o,l=null;if(128===I)switch(a){case 1:o=p._GetFloatRGBAArrayBuffer,l=null;break;case 2:o=p._GetFloatAsHalfFloatRGBAArrayBuffer,l=p._GetFloatRGBAArrayBuffer;break;case 0:o=p._GetFloatAsUIntRGBAArrayBuffer,l=p._GetFloatRGBAArrayBuffer}else switch(a){case 1:o=p._GetHalfFloatAsFloatRGBAArrayBuffer,l=null;break;case 2:o=p._GetHalfFloatRGBAArrayBuffer,l=p._GetHalfFloatAsFloatRGBAArrayBuffer;break;case 0:o=p._GetHalfFloatAsUIntRGBAArrayBuffer,l=p._GetHalfFloatAsFloatRGBAArrayBuffer}t.type=a,r=o(T,x,i.byteOffset+A,S,i.buffer,n),m&&0==n&&m.push(l?l(T,x,i.byteOffset+A,S,i.buffer,n):r)}r&&e._uploadDataToTextureDirectly(t,r,s,n)}else if(r.isRGB)t.type=0,24===I?(t.format=4,S=T*x*3,C=p._GetRGBArrayBuffer(T,x,i.byteOffset+A,S,i.buffer,w,F,L),e._uploadDataToTextureDirectly(t,C,s,n)):(t.format=5,S=T*x*4,C=p._GetRGBAArrayBuffer(T,x,i.byteOffset+A,S,i.buffer,w,F,L,B),e._uploadDataToTextureDirectly(t,C,s,n));else if(r.isLuminance){const r=e._getUnpackAlignement(),a=T;S=Math.floor((T+r-1)/r)*r*(x-1)+a,C=p._GetLuminanceArrayBuffer(T,x,i.byteOffset+A,S,i.buffer),t.format=1,t.type=0,e._uploadDataToTextureDirectly(t,C,s,n)}else S=Math.max(4,T)/4*Math.max(4,x)/4*P,C=new Uint8Array(i.buffer,i.byteOffset+A,S),t.type=0,e._uploadCompressedDataToTextureDirectly(t,M,T,x,C,s,n)}A+=I?T*x*(I/8):S,T*=.5,x*=.5,T=Math.max(1,T),x=Math.max(1,x)}if(void 0!==f)break}m&&m.length>0?r.sphericalPolynomial=n.d.ConvertCubeMapToSphericalPolynomial({size:v[4],right:m[0],left:m[1],up:m[2],down:m[3],front:m[4],back:m[5],format:5,type:1,gammaSpace:!1}):r.sphericalPolynomial=void 0}}p.StoreLODInAlphaChannel=!1},8451:(e,t,i)=>{"use strict";i.d(t,{B:()=>n,K:()=>a});const r={},s={};function n(e){const t=e.getClassName();return s[t]||(s[t]={}),s[t]}function a(e){const t=e.getClassName();if(r[t])return r[t];r[t]={};const i=r[t];let n=e,a=t;for(;a;){const e=s[a];for(const s in e)i[s]=e[s];let t,r=!1;do{if(t=Object.getPrototypeOf(n),!t.getClassName){r=!0;break}if(t.getClassName()!==a)break;n=t}while(t);if(r)break;a=t.getClassName(),n=t}return i}},7376:(e,t,i)=>{"use strict";i.d(t,{$z:()=>n,Cx:()=>b,GG:()=>m,P_:()=>u,WM:()=>c,Y9:()=>h,bR:()=>g,jT:()=>l,lK:()=>a,n1:()=>f,qK:()=>p,uM:()=>o,wL:()=>_,xG:()=>d});var r=i(8451);function s(e,t){return(i,s)=>{const n=(0,r.B)(i);n[s]||(n[s]={type:e,sourceName:t})}}function n(e){return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(i,r)=>{const s=t||"_"+r;Object.defineProperty(i,r,{get:function(){return this[s]},set:function(t){"function"===typeof this.equals&&this.equals(t)||this[s]!==t&&(this[s]=t,i[e].apply(this))},enumerable:!0,configurable:!0})}}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)}function a(e){return s(0,e)}function o(e){return s(1,e)}function l(e){return s(2,e)}function h(e){return s(3,e)}function c(e){return s(4,e)}function u(e){return s(5,e)}function d(e){return s(6,e)}function _(e){return s(7,e)}function p(e){return s(8,e)}function f(e){return s(9,e)}function g(e){return s(10,e)}function m(e){return s(12,e)}function b(e,t,i,r){const s=i.value;i.value=function(){let i=s;if("undefined"!==typeof _native&&_native[t]){const e=_native[t];i=r?function(){return r(...arguments)?e(...arguments):s(...arguments)}:e}return e[t]=i,i(...arguments)}}b.filter=function(e){return(t,i,r)=>b(t,i,r,e)}},818:(e,t,i)=>{"use strict";i.d(t,{p:()=>h});var r=i(6984),s=i(5387),n=i(6760),a=i(5968),o=i(8451);const l=function(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const n=e();s.Y&&s.Y.HasTags(t)&&s.Y.AddTagsTo(n,s.Y.GetTags(t,!0));const a=(0,o.K)(n),l={};for(const s in a){const e=a[s],o=t[s],c=e.type;if(void 0!==o&&null!==o&&("uniqueId"!==s||h.AllowLoadingUniqueId))switch(c){case 0:case 6:case 11:n[s]=o;break;case 1:r.cloneTexturesOnlyOnce&&l[o.uniqueId]?n[s]=l[o.uniqueId]:(n[s]=i||o.isRenderTarget?o:o.clone(),l[o.uniqueId]=n[s]);break;case 2:case 3:case 4:case 5:case 7:case 10:case 12:n[s]=i?o:o.clone()}}return n};class h{static AppendSerializedAnimations(e,t){if(e.animations){t.animations=[];for(let i=0;i<e.animations.length;i++){const r=e.animations[i];t.animations.push(r.serialize())}}}static Serialize(e,t){t||(t={}),s.Y&&(t.tags=s.Y.GetTags(e));const i=(0,o.K)(e);for(const r in i){const s=i[r],n=s.sourceName||r,a=s.type,o=e[r];if(void 0!==o&&null!==o&&("uniqueId"!==r||h.AllowLoadingUniqueId))switch(a){case 0:t[n]=o;break;case 1:case 3:case 7:case 9:t[n]=o.serialize();break;case 2:case 4:case 5:case 8:case 10:case 12:t[n]=o.asArray();break;case 6:case 11:t[n]=o.id}}return t}static ParseProperties(e,t,i,r){r||(r="");const s=(0,o.K)(t);for(const o in s){const l=s[o],c=e[l.sourceName||o],u=l.type;if(void 0!==c&&null!==c&&("uniqueId"!==o||h.AllowLoadingUniqueId)){const e=t;switch(u){case 0:e[o]=c;break;case 1:i&&(e[o]=h._TextureParser(c,i,r));break;case 2:e[o]=n.v9.FromArray(c);break;case 3:e[o]=h._FresnelParametersParser(c);break;case 4:e[o]=a.I9.FromArray(c);break;case 5:e[o]=a.Pq.FromArray(c);break;case 6:i&&(e[o]=i.getLastMeshById(c));break;case 7:e[o]=h._ColorCurvesParser(c);break;case 8:e[o]=n.ov.FromArray(c);break;case 9:e[o]=h._ImageProcessingConfigurationParser(c);break;case 10:e[o]=a.PT.FromArray(c);break;case 11:i&&(e[o]=i.getCameraById(c));break;case 12:e[o]=a.uq.FromArray(c)}}}}static Parse(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const n=e();return s.Y&&s.Y.AddTagsTo(n,t.tags),h.ParseProperties(t,n,i,r),n}static Clone(e,t){return l(e,t,!1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}static Instanciate(e,t){return l(e,t,!0)}}h.AllowLoadingUniqueId=!1,h._ImageProcessingConfigurationParser=e=>{throw(0,r.n)("ImageProcessingConfiguration")},h._FresnelParametersParser=e=>{throw(0,r.n)("FresnelParameters")},h._ColorCurvesParser=e=>{throw(0,r.n)("ColorCurves")},h._TextureParser=(e,t,i)=>{throw(0,r.n)("Texture")}},5918:(e,t,i)=>{"use strict";i.d(t,{r:()=>n});var r=i(8274);const s=(e,t,i)=>e?e.getClassName&&"Mesh"===e.getClassName()?null:!e.getClassName||"SubMesh"!==e.getClassName()&&"PhysicsBody"!==e.getClassName()?e.clone?e.clone():Array.isArray(e)?e.slice():i&&"object"===typeof e?{...e}:null:e.clone(t):null;class n{static DeepCopy(e,t,i,n){let a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const o=function(e){const t=[];do{Object.getOwnPropertyNames(e).forEach((function(e){-1===t.indexOf(e)&&t.push(e)}))}while(e=Object.getPrototypeOf(e));return t}(e);for(const h of o){if("_"===h[0]&&(!n||-1===n.indexOf(h)))continue;if(h.endsWith("Observable"))continue;if(i&&-1!==i.indexOf(h))continue;const o=e[h],c=typeof o;if("function"!==c)try{if("object"===c)if(o instanceof Uint8Array)t[h]=Uint8Array.from(o);else if(o instanceof Array){if(t[h]=[],o.length>0)if("object"==typeof o[0])for(let e=0;e<o.length;e++){const i=s(o[e],t,a);-1===t[h].indexOf(i)&&t[h].push(i)}else t[h]=o.slice(0)}else t[h]=s(o,t,a);else t[h]=o}catch(l){r.V.Warn(l.message)}}}}},6984:(e,t,i)=>{"use strict";i.d(t,{n:()=>s});const r={};function s(e){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!r[e])return r[e]=!0,`${e} needs to be imported before as it contains a side-effect required by your code.`}},8315:(e,t,i)=>{"use strict";function r(){return"undefined"!==typeof window}function s(){return"undefined"!==typeof navigator}function n(){return"undefined"!==typeof document}function a(e){let t="",i=e.firstChild;for(;i;)3===i.nodeType&&(t+=i.textContent),i=i.nextSibling;return t}i.d(t,{BA:()=>r,Nf:()=>n,XD:()=>s,Zl:()=>a})},1909:(e,t,i)=>{"use strict";i.d(t,{dq:()=>b,yp:()=>m});var r=i(5887),s=i(1837),n=i(4857),a=i(5491),o=i(4909),l=i(6291);i(5921);const h={positions:[1,1,-1,1,-1,-1,1,-1],indices:[0,1,2,0,2,3]};class c{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:h;this._fullscreenViewport=new n.L(0,0,1,1);const i=t.positions??h.positions,r=t.indices??h.indices;this.engine=e,this._vertexBuffers={[s.R.PositionKind]:new s.R(e,i,s.R.PositionKind,!1,!1,2)},this._indexBuffer=e.createIndexBuffer(r),this._onContextRestoredObserver=e.onContextRestoredObservable.add((()=>{this._indexBuffer=e.createIndexBuffer(r);for(const e in this._vertexBuffers){this._vertexBuffers[e]._rebuild()}}))}setViewport(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._fullscreenViewport;this.engine.setViewport(e)}bindBuffers(e){this.engine.bindBuffers(this._vertexBuffers,this._indexBuffer,e)}applyEffectWrapper(e){this.engine.setState(!0),this.engine.depthCullingState.depthTest=!1,this.engine.stencilState.stencilTest=!1,this.engine.enableEffect(e._drawWrapper),this.bindBuffers(e.effect),e.onApplyObservable.notifyObservers({})}saveStates(){this._savedStateDepthTest=this.engine.depthCullingState.depthTest,this._savedStateStencilTest=this.engine.stencilState.stencilTest}restoreStates(){this.engine.depthCullingState.depthTest=this._savedStateDepthTest,this.engine.stencilState.stencilTest=this._savedStateStencilTest}draw(){this.engine.drawElementsType(0,0,6)}_isRenderTargetTexture(e){return void 0!==e.renderTarget}render(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!e.effect.isReady())return;this.saveStates(),this.setViewport();const i=null===t?null:this._isRenderTargetTexture(t)?t.renderTarget:t;i&&this.engine.bindFramebuffer(i),this.applyEffectWrapper(e),this.draw(),i&&this.engine.unBindFramebuffer(i),this.restoreStates()}dispose(){const e=this._vertexBuffers[s.R.PositionKind];e&&(e.dispose(),delete this._vertexBuffers[s.R.PositionKind]),this._indexBuffer&&this.engine._releaseBuffer(this._indexBuffer),this._onContextRestoredObserver&&(this.engine.onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}}class u{get effect(){return this._drawWrapper.effect}set effect(e){this._drawWrapper.effect=e}constructor(e){let t;this.onApplyObservable=new a.cP;const i=e.uniformNames||[];e.vertexShader?t={fragmentSource:e.fragmentShader,vertexSource:e.vertexShader,spectorName:e.name||"effectWrapper"}:(i.push("scale"),t={fragmentSource:e.fragmentShader,vertex:"postprocess",spectorName:e.name||"effectWrapper"},this.onApplyObservable.add((()=>{this.effect.setFloat2("scale",1,1)})));const r=e.defines?e.defines.join("\n"):"";this._drawWrapper=new l.E(e.engine),e.useShaderStore?(t.fragment=t.fragmentSource,t.vertex||(t.vertex=t.vertexSource),delete t.fragmentSource,delete t.vertexSource,this.effect=e.engine.createEffect(t,e.attributeNames||["position"],i,e.samplerNames,r,void 0,e.onCompiled,void 0,void 0,e.shaderLanguage,e.extraInitializationsAsync)):(this.effect=new o.M(t,e.attributeNames||["position"],i,e.samplerNames,e.engine,r,void 0,e.onCompiled,void 0,void 0,void 0,e.shaderLanguage,e.extraInitializationsAsync),this._onContextRestoredObserver=e.engine.onContextRestoredObservable.add((()=>{this.effect._pipelineContext=null,this.effect._prepareEffect()})))}dispose(){this._onContextRestoredObserver&&(this.effect.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null),this.effect.dispose()}}var d=i(543),_=i(2379),p=i(7559),f=i(4072);let g;async function m(e,t,i,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",n=arguments.length>5?arguments[5]:void 0,a=arguments.length>6?arguments[6]:void 0;const o=await i.readPixels(0,0,e,t);v(e,t,new Uint8Array(o.buffer),r,s,n,!0,void 0,a)}function b(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",s=arguments.length>4?arguments[4]:void 0,n=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=arguments.length>7?arguments[7]:void 0;return new Promise((l=>{v(e,t,i,(e=>l(e)),r,s,n,a,o)}))}function v(e,t,i,s){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",a=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=arguments.length>7&&void 0!==arguments[7]&&arguments[7],h=arguments.length>8?arguments[8]:void 0;const m=function(){if(!g){let t,i=null;const s={preserveDrawingBuffer:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};try{t=new OffscreenCanvas(100,100),i=new r.w(t,!1,s)}catch(e){t=document.createElement("canvas"),i=new r.w(t,!1,s)}f.q.Instances.pop(),f.q.OnEnginesDisposedObservable.add((e=>{i&&e!==i&&!i.isDisposed&&0===f.q.Instances.length&&y()})),i.getCaps().parallelShaderCompile=void 0;const n=new c(i),a=new u({engine:i,name:_.passPixelShader.name,fragmentShader:_.passPixelShader.shader,samplerNames:["textureSampler"]});g={canvas:t,engine:i,renderer:n,wrapper:a}}return g}();if(m.engine.setSize(e,t,!0),i instanceof Float32Array){const e=new Uint8Array(i.length);let t=i.length;for(;t--;){const r=i[t];e[t]=Math.round(255*p.X.Clamp(r))}i=e}const b=m.engine.createRawTexture(i,e,t,5,!1,!o,1);m.renderer.setViewport(),m.renderer.applyEffectWrapper(m.wrapper),m.wrapper.effect._bindTexture("textureSampler",b),m.renderer.draw(),l?d.S0.ToBlob(m.canvas,(e=>{const t=new FileReader;t.onload=e=>{const t=e.target.result;s&&s(t)},t.readAsArrayBuffer(e)}),n,h):d.S0.EncodeScreenshotCanvasData(m.canvas,s,n,a,h),b.dispose()}function y(){g&&(g.wrapper.dispose(),g.renderer.dispose(),g.engine.dispose()),g=null}d.S0.DumpData=v,d.S0.DumpDataAsync=b,d.S0.DumpFramebuffer=m},3702:(e,t,i)=>{"use strict";i.d(t,{Cf:()=>r,bu:()=>n,tG:()=>s});class r extends Error{}r._setPrototypeOf=Object.setPrototypeOf||((e,t)=>(e.__proto__=t,e));const s={MeshInvalidPositionsError:0,UnsupportedTextureError:1e3,GLTFLoaderUnexpectedMagicError:2e3,SceneLoaderError:3e3,LoadFileError:4e3,RequestFileError:4001,ReadFileError:4002};class n extends r{constructor(e,t,i){super(e),this.errorCode=t,this.innerError=i,this.name="RuntimeError",r._setPrototypeOf(this,n.prototype)}}},242:(e,t,i)=>{"use strict";i.d(t,{rz:()=>P,eC:()=>v,f2:()=>S,zU:()=>C,W$:()=>x,NJ:()=>A,sh:()=>R,M1:()=>y});var r=i(4861),s=i(8315),n=i(5491);class a{}a.FilesToLoad={};var o=i(3702),l=i(7524),h=i(4504),c=i(4072),u=i(8274),d=i(9581),_=i(2528),p=i(8846);const f=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i);class g extends o.bu{constructor(e,t){super(e,o.tG.LoadFileError),this.name="LoadFileError",o.Cf._setPrototypeOf(this,g.prototype),t instanceof r.u?this.request=t:this.file=t}}class m extends o.bu{constructor(e,t){super(e,o.tG.RequestFileError),this.request=t,this.name="RequestFileError",o.Cf._setPrototypeOf(this,m.prototype)}}class b extends o.bu{constructor(e,t){super(e,o.tG.ReadFileError),this.file=t,this.name="ReadFileError",o.Cf._setPrototypeOf(this,b.prototype)}}const v={DefaultRetryStrategy:class{static ExponentialBackoff(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;return(i,r,s)=>0!==r.status||s>=e||-1!==i.indexOf("file:")?-1:Math.pow(2,s)*t}}.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:e=>e,ScriptBaseUrl:"",ScriptPreprocessUrl:e=>e,CleanUrl:e=>e=e.replace(/#/gm,"%23")},y=(e,t)=>{if((!e||0!==e.indexOf("data:"))&&v.CorsBehavior)if("string"===typeof v.CorsBehavior||v.CorsBehavior instanceof String)t.crossOrigin=v.CorsBehavior;else{const i=v.CorsBehavior(e);i&&(t.crossOrigin=i)}},T={getRequiredSize:null},x=function(e,t,i,s){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",o=arguments.length>5?arguments[5]:void 0;const h=c.q.LastCreatedEngine;if("undefined"===typeof HTMLImageElement&&!h?._features.forceBitmapOverHTMLImageElement)return i("LoadImage is only supported in web or BabylonNative environments."),null;let u,d=!1;e instanceof ArrayBuffer||ArrayBuffer.isView(e)?"undefined"!==typeof Blob&&"undefined"!==typeof URL?(u=URL.createObjectURL(new Blob([e],{type:n})),d=!0):u=`data:${n};base64,`+(0,l.EL)(e):e instanceof Blob?(u=URL.createObjectURL(e),d=!0):(u=v.CleanUrl(e),u=v.PreprocessUrl(u));const _=t=>{if(i){const r=u||e.toString();i(`Error while trying to load image: ${0===r.indexOf("http")||r.length<=128?r:r.slice(0,128)+"..."}`,t)}};if(h?._features.forceBitmapOverHTMLImageElement)return C(u,(r=>{h.createImageBitmap(new Blob([r],{type:n}),{premultiplyAlpha:"none",...o}).then((e=>{t(e),d&&URL.revokeObjectURL(u)})).catch((t=>{i&&i("Error while trying to load image: "+e,t)}))}),void 0,s||void 0,!0,((e,t)=>{_(t)})),null;const p=new Image;if(T.getRequiredSize){const t=T.getRequiredSize(e);t.width&&(p.width=t.width),t.height&&(p.height=t.height)}y(u,p);const f=[],g=()=>{f.forEach((e=>{e.target.removeEventListener(e.name,e.handler)})),f.length=0};f.push({target:p,name:"load",handler:()=>{g(),t(p),d&&p.src&&URL.revokeObjectURL(p.src)}}),f.push({target:p,name:"error",handler:e=>{g(),_(e),d&&p.src&&URL.revokeObjectURL(p.src)}}),f.push({target:document,name:"securitypolicyviolation",handler:e=>{if(e.blockedURI!==p.src||"report"===e.disposition)return;g();const t=new Error(`CSP violation of policy ${e.effectiveDirective} ${e.blockedURI}. Current policy is ${e.originalPolicy}`);c.q.UseFallbackTexture=!1,_(t),d&&p.src&&URL.revokeObjectURL(p.src),p.src=""}}),f.forEach((e=>{e.target.addEventListener(e.name,e.handler)}));const m="blob:"===u.substring(0,5),b="data:"===u.substring(0,5),x=()=>{m||b||!r.u.IsCustomRequestAvailable?p.src=u:C(u,((e,t,i)=>{const r=new Blob([e],{type:!n&&i?i:n}),s=URL.createObjectURL(r);d=!0,p.src=s}),void 0,s||void 0,!0,((e,t)=>{_(t)}))},A=()=>{s&&s.loadImage(u,p)};if(!m&&!b&&s&&s.enableTexturesOffline)s.open(A,x);else{if(-1!==u.indexOf("file:")){const e=decodeURIComponent(u.substring(5).toLowerCase());if(a.FilesToLoad[e]&&"undefined"!==typeof URL){try{let t;try{t=URL.createObjectURL(a.FilesToLoad[e])}catch(R){t=URL.createObjectURL(a.FilesToLoad[e])}p.src=t,d=!0}catch(E){p.src=""}return p}}x()}return p},A=(e,t,i,r,s)=>{const a=new FileReader,o={onCompleteObservable:new n.cP,abort:()=>a.abort()};return a.onloadend=()=>o.onCompleteObservable.notifyObservers(o),s&&(a.onerror=()=>{s(new b(`Unable to read ${e.name}`,e))}),a.onload=e=>{t(e.target.result)},i&&(a.onprogress=i),r?a.readAsArrayBuffer(e):a.readAsText(e),o},C=(e,t,i,r,s,l,h)=>{if(e.name)return A(e,t,i,s,l?e=>{l(void 0,e)}:void 0);const c=e;if(-1!==c.indexOf("file:")){let e=decodeURIComponent(c.substring(5).toLowerCase());0===e.indexOf("./")&&(e=e.substring(2));const r=a.FilesToLoad[e];if(r)return A(r,t,i,s,l?e=>l(void 0,new g(e.message,e.file)):void 0)}const{match:_,type:p}=M(c);if(_){const e={onCompleteObservable:new n.cP,abort:()=>()=>{}};try{const e=s?P(c):I(c);t(e,void 0,p)}catch(o){l?l(void 0,o):u.V.Error(o.message||"Failed to parse the Data URL")}return d._.SetImmediate((()=>{e.onCompleteObservable.notifyObservers(e)})),e}return R(c,((e,i)=>{t(e,i?.responseURL,i?.getResponseHeader("content-type"))}),i,r,s,l?e=>{l(e.request,new g(e.message,e.request))}:void 0,h)},R=(e,t,i,a,o,l,h)=>{e=v.CleanUrl(e),e=v.PreprocessUrl(e);const c=v.BaseUrl+e;let d=!1;const _={onCompleteObservable:new n.cP,abort:()=>d=!0},p=()=>{let e,n=new r.u,a=null;const p=()=>{n&&(i&&n.removeEventListener("progress",i),e&&n.removeEventListener("readystatechange",e),n.removeEventListener("loadend",f))};let f=()=>{p(),_.onCompleteObservable.notifyObservers(_),_.onCompleteObservable.clear(),i=void 0,e=null,f=null,l=void 0,h=void 0,t=void 0};_.abort=()=>{d=!0,f&&f(),n&&n.readyState!==(XMLHttpRequest.DONE||4)&&n.abort(),null!==a&&(clearTimeout(a),a=null),n=null};const g=e=>{const t=e.message||"Unknown error";l&&n?l(new m(t,n)):u.V.Error(t)},b=u=>{if(n){if(n.open("GET",c),h)try{h(n)}catch(_){return void g(_)}o&&(n.responseType="arraybuffer"),i&&n.addEventListener("progress",i),f&&n.addEventListener("loadend",f),e=()=>{if(!d&&n&&n.readyState===(XMLHttpRequest.DONE||4)){if(e&&n.removeEventListener("readystatechange",e),n.status>=200&&n.status<300||0===n.status&&(!(0,s.BA)()||E())){try{t&&t(o?n.response:n.responseText,n)}catch(_){g(_)}return}const i=v.DefaultRetryStrategy;if(i){const e=i(c,n,u);if(-1!==e)return p(),n=new r.u,void(a=setTimeout((()=>b(u+1)),e))}const h=new m("Error status: "+n.status+" "+n.statusText+" - Unable to load "+c,n);l&&l(h)}},n.addEventListener("readystatechange",e),n.send()}};b(0)};if(a&&a.enableSceneOffline){const r=e=>{e&&e.status>400?l&&l(e):p()},s=()=>{a&&a.loadFile(v.BaseUrl+e,(e=>{!d&&t&&t(e),_.onCompleteObservable.notifyObservers(_)}),i?e=>{!d&&i&&i(e)}:void 0,r,o)};a.open(s,r)}else p();return _},E=()=>"undefined"!==typeof location&&"file:"===location.protocol,S=e=>f.test(e),M=e=>{const t=f.exec(e);if(null===t||0===t.length)return{match:!1,type:""};return{match:!0,type:t[0].replace("data:","").replace("base64,","")}};function P(e){return(0,l.yS)(e.split(",")[1])}const I=e=>(0,l.AV)(e.split(",")[1]);let O;p.$._FileToolsLoadImage=x,_.sg.loadFile=C,h.J.loadFile=C;((e,t,i,r,s,n,a,o,l,h)=>{O={DecodeBase64UrlToBinary:e,DecodeBase64UrlToString:t,DefaultRetryStrategy:i.DefaultRetryStrategy,BaseUrl:i.BaseUrl,CorsBehavior:i.CorsBehavior,PreprocessUrl:i.PreprocessUrl,IsBase64DataUrl:r,IsFileURL:s,LoadFile:n,LoadImage:a,ReadFile:o,RequestFile:l,SetCorsBehavior:h},Object.defineProperty(O,"DefaultRetryStrategy",{get:function(){return i.DefaultRetryStrategy},set:function(e){i.DefaultRetryStrategy=e}}),Object.defineProperty(O,"BaseUrl",{get:function(){return i.BaseUrl},set:function(e){i.BaseUrl=e}}),Object.defineProperty(O,"PreprocessUrl",{get:function(){return i.PreprocessUrl},set:function(e){i.PreprocessUrl=e}}),Object.defineProperty(O,"CorsBehavior",{get:function(){return i.CorsBehavior},set:function(e){i.CorsBehavior=e}})})(P,I,v,S,E,C,x,A,R,y)},7999:(e,t,i)=>{"use strict";function r(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}i.d(t,{z:()=>r})},5010:(e,t,i)=>{"use strict";i.d(t,{n:()=>n});var r=i(8274),s=i(4141);class n{static Instantiate(e){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[e])return this.RegisteredExternalClasses[e];const t=(0,s.n9)(e);if(t)return t;r.V.Warn(e+" not found, you may have missed an import.");const i=e.split(".");let n=window||this;for(let r=0,s=i.length;r<s;r++)n=n[i[r]];return"function"!==typeof n?null:n}}n.RegisteredExternalClasses={}},8274:(e,t,i)=>{"use strict";i.d(t,{V:()=>r});class r{static _CheckLimit(e,t){let i=r._LogLimitOutputs[e];return i?i.current++:(i={limit:t,current:1},r._LogLimitOutputs[e]=i),i.current<=i.limit}static _GenerateLimitMessage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const i=r._LogLimitOutputs[e];if(!i||!r.MessageLimitReached)return;const s=this._Levels[t];i.current===i.limit&&r[s.name](r.MessageLimitReached.replace(/%LIMIT%/g,""+i.limit).replace(/%TYPE%/g,s.name??""))}static _AddLogEntry(e){r._LogCache=e+r._LogCache,r.OnNewCacheEntry&&r.OnNewCacheEntry(e)}static _FormatMessage(e){const t=e=>e<10?"0"+e:""+e,i=new Date;return"["+t(i.getHours())+":"+t(i.getMinutes())+":"+t(i.getSeconds())+"]: "+e}static _LogDisabled(e,t){}static _LogEnabled(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;const s=Array.isArray(t)?t[0]:t;if(void 0!==i&&!r._CheckLimit(s,i))return;const n=r._FormatMessage(s),a=this._Levels[e],o=Array.isArray(t)?t.slice(1):[];a.logFunc&&a.logFunc("BJS - "+n,...o);const l=`<div style='color:${a.color}'>${n}</div><br>`;r._AddLogEntry(l),r._GenerateLimitMessage(s,e)}static get LogCache(){return r._LogCache}static ClearLogCache(){r._LogCache="",r._LogLimitOutputs={},r.errorsCount=0}static set LogLevels(e){r.Log=r._LogDisabled,r.Warn=r._LogDisabled,r.Error=r._LogDisabled,[r.MessageLogLevel,r.WarningLogLevel,r.ErrorLogLevel].forEach((t=>{if((e&t)===t){const e=this._Levels[t];r[e.name]=r._LogEnabled.bind(r,t)}}))}}r.NoneLogLevel=0,r.MessageLogLevel=1,r.WarningLogLevel=2,r.ErrorLogLevel=4,r.AllLogLevel=7,r.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",r._LogCache="",r._LogLimitOutputs={},r._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],r.errorsCount=0,r.Log=r._LogEnabled.bind(r,r.MessageLogLevel),r.Warn=r._LogEnabled.bind(r,r.WarningLogLevel),r.Error=r._LogEnabled.bind(r,r.ErrorLogLevel)},5491:(e,t,i)=>{"use strict";i.d(t,{cP:()=>n});class r{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;this.initialize(e,t,i,r)}initialize(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return this.mask=e,this.skipNextObservers=t,this.target=i,this.currentTarget=r,this}}class s{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=e,this.mask=t,this.scope=i,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){this._remove&&this._remove()}}class n{static FromPromise(e,t){const i=new n;return e.then((e=>{i.notifyObservers(e)})).catch((e=>{if(!t)throw e;t.notifyObservers(e)})),i}get observers(){return this._observers}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=t,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new r(0),e&&(this._onObserverAdded=e)}add(e){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!e)return null;const r=new s(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);return r.unregisterOnNextCall=i,t?this._observers.unshift(r):this._observers.push(r),this._onObserverAdded&&this._onObserverAdded(r),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(r,this._lastNotifiedValue),r._remove=()=>{this.remove(r)},r}addOnce(e){return this.add(e,void 0,void 0,void 0,!0)}remove(e){if(!e)return!1;e._remove=null;return-1!==this._observers.indexOf(e)&&(this._deferUnregister(e),!0)}removeCallback(e,t){for(let i=0;i<this._observers.length;i++){const r=this._observers[i];if(!r._willBeUnregistered&&(r.callback===e&&(!t||t===r.scope)))return this._deferUnregister(r),!0}return!1}_deferUnregister(e){e._willBeUnregistered||(this._numObserversMarkedAsDeleted++,e.unregisterOnNextCall=!1,e._willBeUnregistered=!0,setTimeout((()=>{this._remove(e)}),0))}_remove(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!e)return!1;const i=this._observers.indexOf(e);return-1!==i&&(t&&this._numObserversMarkedAsDeleted--,this._observers.splice(i,1),!0)}makeObserverTopPriority(e){this._remove(e,!1),this._observers.unshift(e)}makeObserverBottomPriority(e){this._remove(e,!1),this._observers.push(e)}notifyObservers(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=e),!this._observers.length)return!0;const n=this._eventState;n.mask=t,n.target=i,n.currentTarget=r,n.skipNextObservers=!1,n.lastReturnValue=e,n.userInfo=s;for(const a of this._observers)if(!a._willBeUnregistered&&(a.mask&t&&(a.unregisterOnNextCall&&this._deferUnregister(a),a.scope?n.lastReturnValue=a.callback.apply(a.scope,[e,n]):n.lastReturnValue=a.callback(e,n)),n.skipNextObservers))return!1;return!0}notifyObserver(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=t),e._willBeUnregistered)return;const r=this._eventState;r.mask=i,r.skipNextObservers=!1,e.unregisterOnNextCall&&this._deferUnregister(e),e.callback(t,r)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const e=this._observers.pop();e&&(e._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const e=new n;return e._observers=this._observers.slice(0),e}hasSpecificMask(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const t of this._observers)if(t.mask&e||t.mask===e)return!0;return!1}}},3341:(e,t,i)=>{"use strict";i.d(t,{A:()=>s});var r=i(2132);class s{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(e,t){s.Enabled&&(this._current+=e,t&&this._fetchResult())}beginMonitoring(){s.Enabled&&(this._startMonitoringTime=r.j.Now)}endMonitoring(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!s.Enabled)return;e&&this.fetchNewFrame();const t=r.j.Now;this._current=t-this._startMonitoringTime,e&&this._fetchResult()}endFrame(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const e=r.j.Now;e-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=e,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}s.Enabled=!0},2132:(e,t,i)=>{"use strict";i.d(t,{j:()=>s});var r=i(8315);class s{static get Now(){return(0,r.BA)()&&window.performance&&window.performance.now?window.performance.now():Date.now()}}},921:(e,t,i)=>{"use strict";i.d(t,{G:()=>n});var r=i(6976),s=(i(9289),i(1063));class n{static ExpandRGBDTexture(e){const t=e._texture;if(!t||!e.isRGBD)return;const s=t.getEngine(),n=s.getCaps(),a=t.isReady;let o=!1;n.textureHalfFloatRender&&n.textureHalfFloatLinearFiltering?(o=!0,t.type=2):n.textureFloatRender&&n.textureFloatLinearFiltering&&(o=!0,t.type=1),o&&(t.isReady=!1,t._isRGBD=!1,t.invertY=!1);const l=async()=>{const n=s.isWebGPU,a=n?1:0;t.isReady=!1,this._ShaderImported||(this._ShaderImported=!0,n?await Promise.all([i.e(944).then(i.bind(i,9944)),i.e(480).then(i.bind(i,6480))]):await Promise.all([i.e(685).then(i.bind(i,7685)),i.e(409).then(i.bind(i,3409))]));const o=new r.w("rgbdDecode","rgbdDecode",null,null,1,null,3,s,!1,void 0,t.type,void 0,null,!1,void 0,a);o.externalTextureSamplerBinding=!0;const l=s.createRenderTargetTexture(t.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:t.samplingMode,type:t.type,format:5});o.onEffectCreatedObservable.addOnce((i=>{i.executeWhenCompiled((()=>{o.onApply=e=>{e._bindTexture("textureSampler",t),e.setFloat2("scale",1,1)},e.getScene().postProcessManager.directRender([o],l,!0),s.restoreDefaultFramebuffer(),s._releaseTexture(t),o&&o.dispose(),l._swapAndDie(t),t.isReady=!0}))}))};o&&(a?l():e.onLoadObservable.addOnce(l))}static EncodeTextureToRGBD(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(0,s.Qs)("rgbdEncode",e,t,i,1,5)}}n._ShaderImported=!1},20:(e,t,i)=>{"use strict";i.d(t,{L:()=>r,b:()=>s});class r{constructor(e){this.length=0,this.data=new Array(e),this._id=r._GlobalId++}push(e){this.data[this.length++]=e,this.length>this.data.length&&(this.data.length*=2)}forEach(e){for(let t=0;t<this.length;t++)e(this.data[t])}sort(e){this.data.sort(e)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(let t=0;t<e.length;t++)this.data[this.length++]=(e.data||e)[t]}}indexOf(e){const t=this.data.indexOf(e);return t>=this.length?-1:t}contains(e){return-1!==this.indexOf(e)}}r._GlobalId=0;class s extends r{constructor(){super(...arguments),this._duplicateId=0}push(e){super.push(e),e.__smartArrayFlags||(e.__smartArrayFlags={}),e.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(e){return(!e.__smartArrayFlags||e.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(e),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(let t=0;t<e.length;t++){const i=(e.data||e)[t];this.pushNoDuplicate(i)}}}}},7524:(e,t,i)=>{"use strict";i.d(t,{AV:()=>s,EL:()=>r,yS:()=>n});const r=e=>{const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let i,r,s,n,a,o,l,h="",c=0;const u=ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e);for(;c<u.length;)i=u[c++],r=c<u.length?u[c++]:Number.NaN,s=c<u.length?u[c++]:Number.NaN,n=i>>2,a=(3&i)<<4|r>>4,o=(15&r)<<2|s>>6,l=63&s,isNaN(r)?o=l=64:isNaN(s)&&(l=64),h+=t.charAt(n)+t.charAt(a)+t.charAt(o)+t.charAt(l);return h},s=e=>atob(e),n=e=>{const t=s(e),i=t.length,r=new Uint8Array(new ArrayBuffer(i));for(let s=0;s<i;s++)r[s]=t.charCodeAt(s);return r.buffer}},5387:(e,t,i)=>{"use strict";i.d(t,{Y:()=>s});class r{static Eval(e,t){return"true"===(e=e.match(/\([^()]*\)/g)?e.replace(/\([^()]*\)/g,(e=>(e=e.slice(1,e.length-1),r._HandleParenthesisContent(e,t)))):r._HandleParenthesisContent(e,t))||"false"!==e&&r.Eval(e,t)}static _HandleParenthesisContent(e,t){let i;t=t||(e=>"true"===e);const s=e.split("||");for(const n in s)if(Object.prototype.hasOwnProperty.call(s,n)){let e=r._SimplifyNegation(s[n].trim());const a=e.split("&&");if(a.length>1)for(let s=0;s<a.length;++s){const n=r._SimplifyNegation(a[s].trim());if(i="true"!==n&&"false"!==n?"!"===n[0]?!t(n.substring(1)):t(n):"true"===n,!i){e="false";break}}if(i||"true"===e){i=!0;break}i="true"!==e&&"false"!==e?"!"===e[0]?!t(e.substring(1)):t(e):"true"===e}return i?"true":"false"}static _SimplifyNegation(e){return"!true"===(e=(e=e.replace(/^[\s!]+/,(e=>(e=e.replace(/[\s]/g,(()=>""))).length%2?"!":""))).trim())?e="false":"!false"===e&&(e="true"),e}}class s{static EnableFor(e){e._tags=e._tags||{},e.hasTags=()=>s.HasTags(e),e.addTags=t=>s.AddTagsTo(e,t),e.removeTags=t=>s.RemoveTagsFrom(e,t),e.matchesTagsQuery=t=>s.MatchesQuery(e,t)}static DisableFor(e){delete e._tags,delete e.hasTags,delete e.addTags,delete e.removeTags,delete e.matchesTagsQuery}static HasTags(e){if(!e._tags)return!1;const t=e._tags;for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i))return!0;return!1}static GetTags(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!e._tags)return null;if(t){const t=[];for(const i in e._tags)Object.prototype.hasOwnProperty.call(e._tags,i)&&!0===e._tags[i]&&t.push(i);return t.join(" ")}return e._tags}static AddTagsTo(e,t){if(!t)return;if("string"!==typeof t)return;t.split(" ").forEach((function(t){s._AddTagTo(e,t)}))}static _AddTagTo(e,t){""!==(t=t.trim())&&"true"!==t&&"false"!==t&&(t.match(/[\s]/)||t.match(/^([!]|([|]|[&]){2})/)||(s.EnableFor(e),e._tags[t]=!0))}static RemoveTagsFrom(e,t){if(!s.HasTags(e))return;const i=t.split(" ");for(const r in i)s._RemoveTagFrom(e,i[r])}static _RemoveTagFrom(e,t){delete e._tags[t]}static MatchesQuery(e,t){return void 0===t||(""===t?s.HasTags(e):r.Eval(t,(t=>s.HasTags(e)&&e._tags[t])))}}},1063:(e,t,i)=>{"use strict";i.d(t,{Qs:()=>_,SX:()=>m,LZ:()=>g});i(5415),i(1078);var r=i(6976),s=i(8846),n=i(4141),a=i(818);class o extends r.w{getClassName(){return"PassPostProcess"}constructor(e,t){super(e,"pass",null,null,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>5?arguments[5]:void 0,void 0,arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,void 0,null,arguments.length>7&&void 0!==arguments[7]&&arguments[7])}_gatherImports(e,t){e?(this._webGPUReady=!0,t.push(Promise.all([i.e(470).then(i.bind(i,470))]))):t.push(Promise.all([Promise.resolve().then(i.bind(i,2379))])),super._gatherImports(e,t)}static _Parse(e,t,i,r){return a.p.Parse((()=>new o(e.name,e.options,t,e.renderTargetSamplingMode,e._engine,e.reusable)),e,i,r)}}(0,n.Y5)("BABYLON.PassPostProcess",o);r.w;s.$._RescalePostProcessFactory=e=>new o("rescale",1,null,2,e,!1,0);var l=i(4453);const h="lodPixelShader",c="#extension GL_EXT_shader_texture_lod : enable\nprecision highp float;const float GammaEncodePowerApprox=1.0/2.2;varying vec2 vUV;uniform sampler2D textureSampler;uniform float lod;uniform vec2 texSize;uniform bool gamma;void main(void)\n{gl_FragColor=textureLod(textureSampler,vUV,lod);if (!gamma) {gl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(GammaEncodePowerApprox));}}\n";l.l.ShadersStore[h]=c;const u="lodCubePixelShader",d="precision highp float;const float GammaEncodePowerApprox=1.0/2.2;varying vec2 vUV;uniform samplerCube textureSampler;uniform float lod;uniform bool gamma;void main(void)\n{vec2 uv=vUV*2.0-1.0;\n#ifdef POSITIVEX\ngl_FragColor=textureCube(textureSampler,vec3(1.001,uv.y,uv.x),lod);\n#endif\n#ifdef NEGATIVEX\ngl_FragColor=textureCube(textureSampler,vec3(-1.001,uv.y,uv.x),lod);\n#endif\n#ifdef POSITIVEY\ngl_FragColor=textureCube(textureSampler,vec3(uv.y,1.001,uv.x),lod);\n#endif\n#ifdef NEGATIVEY\ngl_FragColor=textureCube(textureSampler,vec3(uv.y,-1.001,uv.x),lod);\n#endif\n#ifdef POSITIVEZ\ngl_FragColor=textureCube(textureSampler,vec3(uv,1.001),lod);\n#endif\n#ifdef NEGATIVEZ\ngl_FragColor=textureCube(textureSampler,vec3(uv,-1.001),lod);\n#endif\nif (!gamma) {gl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(GammaEncodePowerApprox));}}\n";l.l.ShadersStore[u]=d;function _(e,t,i,s,n,a,o,l){const h=t.getEngine();return t.isReady=!1,n=n??t.samplingMode,s=s??t.type,a=a??t.format,o=o??t.width,l=l??t.height,-1===s&&(s=0),new Promise((c=>{const u=new r.w("postprocess",e,null,null,1,null,n,h,!1,void 0,s,void 0,null,!1,a);u.externalTextureSamplerBinding=!0;const d=h.createRenderTargetTexture({width:o,height:l},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:n,type:s,format:a});u.onEffectCreatedObservable.addOnce((e=>{e.executeWhenCompiled((()=>{u.onApply=e=>{e._bindTexture("textureSampler",t),e.setFloat2("scale",1,1)},i.postProcessManager.directRender([u],d,!0),h.restoreDefaultFramebuffer(),h._releaseTexture(t),u&&u.dispose(),d._swapAndDie(t),t.type=s,t.format=5,t.isReady=!0,c(t)}))}))}))}let p,f;function g(e){p||(p=new Float32Array(1),f=new Int32Array(p.buffer)),p[0]=e;const t=f[0];let i=t>>16&32768,r=t>>12&2047;const s=t>>23&255;return s<103?i:s>142?(i|=31744,i|=(255==s?0:1)&&8388607&t,i):s<113?(r|=2048,i|=(r>>114-s)+(r>>113-s&1),i):(i|=s-112<<10|r>>1,i+=1&r,i)}function m(e){const t=(32768&e)>>15,i=(31744&e)>>10,r=1023&e;return 0===i?(t?-1:1)*Math.pow(2,-14)*(r/Math.pow(2,10)):31==i?r?NaN:1/0*(t?-1:1):(t?-1:1)*Math.pow(2,i-15)*(1+r/Math.pow(2,10))}},9581:(e,t,i)=>{"use strict";i.d(t,{_:()=>s});var r=i(8315);class s{static SetImmediate(e){(0,r.BA)()&&window.setImmediate?window.setImmediate(e):setTimeout(e,1)}}},4780:(e,t,i)=>{"use strict";function r(e){let t=1;do{t*=2}while(t<e);return t===e}function s(e,t,i){return e*(1-i)+t*i}function n(e){const t=a(e),i=o(e);return t-e>e-i?i:t}function a(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}function o(e){return e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,(e|=e>>16)-(e>>1)}function l(e,t){let i;switch(arguments.length>2&&void 0!==arguments[2]?arguments[2]:2){case 1:i=o(e);break;case 2:i=n(e);break;default:i=a(e)}return Math.min(i,t)}i.d(t,{C4:()=>o,L8:()=>r,OG:()=>n,R:()=>l,zF:()=>s})},543:(e,t,i)=>{"use strict";i.d(t,{LV:()=>m,S0:()=>g});var r=i(5491),s=i(8315),n=i(8274),a=i(5918),o=i(2132),l=i(6984),h=i(4861),c=i(4072),u=i(242),d=i(9581),_=i(5010),p=i(7999),f=i(4780);class g{static get BaseUrl(){return u.eC.BaseUrl}static set BaseUrl(e){u.eC.BaseUrl=e}static get CleanUrl(){return u.eC.CleanUrl}static set CleanUrl(e){u.eC.CleanUrl=e}static IsAbsoluteUrl(e){return 0===e.indexOf("//")||-1!==e.indexOf("://")&&(-1!==e.indexOf(".")&&(-1!==e.indexOf("/")&&(!(e.indexOf(":")>e.indexOf("/"))&&(e.indexOf("://")<e.indexOf(".")||(0===e.indexOf("data:")||0===e.indexOf("blob:"))))))}static set ScriptBaseUrl(e){u.eC.ScriptBaseUrl=e}static get ScriptBaseUrl(){return u.eC.ScriptBaseUrl}static set ScriptPreprocessUrl(e){u.eC.ScriptPreprocessUrl=e}static get ScriptPreprocessUrl(){return u.eC.ScriptPreprocessUrl}static get DefaultRetryStrategy(){return u.eC.DefaultRetryStrategy}static set DefaultRetryStrategy(e){u.eC.DefaultRetryStrategy=e}static get CorsBehavior(){return u.eC.CorsBehavior}static set CorsBehavior(e){u.eC.CorsBehavior=e}static get UseFallbackTexture(){return c.q.UseFallbackTexture}static set UseFallbackTexture(e){c.q.UseFallbackTexture=e}static get RegisteredExternalClasses(){return _.n.RegisteredExternalClasses}static set RegisteredExternalClasses(e){_.n.RegisteredExternalClasses=e}static get fallbackTexture(){return c.q.FallbackTexture}static set fallbackTexture(e){c.q.FallbackTexture=e}static FetchToRef(e,t,i,r,s,n){const a=4*((Math.abs(e)*i%i|0)+(Math.abs(t)*r%r|0)*i);n.r=s[a]/255,n.g=s[a+1]/255,n.b=s[a+2]/255,n.a=s[a+3]/255}static Mix(e,t,i){return 0}static Instantiate(e){return _.n.Instantiate(e)}static SetImmediate(e){d._.SetImmediate(e)}static IsExponentOfTwo(e){return!0}static FloatRound(e){return Math.fround(e)}static GetFilename(e){const t=e.lastIndexOf("/");return t<0?e:e.substring(t+1)}static GetFolderPath(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=e.lastIndexOf("/");return i<0?t?e:"":e.substring(0,i+1)}static ToDegrees(e){return 180*e/Math.PI}static ToRadians(e){return e*Math.PI/180}static SmoothAngleChange(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.9;const r=this.ToRadians(e),s=this.ToRadians(t);return this.ToDegrees(Math.atan2((1-i)*Math.sin(s)+i*Math.sin(r),(1-i)*Math.cos(s)+i*Math.cos(r)))}static MakeArray(e,t){return!0===t||void 0!==e&&null!=e?Array.isArray(e)?e:[e]:null}static GetPointerPrefix(e){let t="pointer";return(0,s.BA)()&&!window.PointerEvent&&(t="mouse"),!e._badDesktopOS||e._badOS||document&&"ontouchend"in document||(t="mouse"),t}static SetCorsBehavior(e,t){(0,u.M1)(e,t)}static SetReferrerPolicyBehavior(e,t){t.referrerPolicy=e}static get PreprocessUrl(){return u.eC.PreprocessUrl}static set PreprocessUrl(e){u.eC.PreprocessUrl=e}static LoadImage(e,t,i,r,s,n){return(0,u.W$)(e,t,i,r,s,n)}static LoadFile(e,t,i,r,s,n){return(0,u.zU)(e,t,i,r,s,n)}static LoadFileAsync(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Promise(((i,r)=>{(0,u.zU)(e,(e=>{i(e)}),void 0,void 0,t,((e,t)=>{r(t)}))}))}static GetBabylonScriptURL(e,t){if(!e)return"";if(g.ScriptBaseUrl&&e.startsWith(g._DefaultCdnUrl)){const t="/"===g.ScriptBaseUrl[g.ScriptBaseUrl.length-1]?g.ScriptBaseUrl.substring(0,g.ScriptBaseUrl.length-1):g.ScriptBaseUrl;e=e.replace(g._DefaultCdnUrl,t)}return e=g.ScriptPreprocessUrl(e),t&&(e=g.GetAbsoluteUrl(e)),e}static LoadBabylonScript(e,t,i,r){e=g.GetBabylonScriptURL(e),g.LoadScript(e,t,i)}static LoadBabylonScriptAsync(e){return e=g.GetBabylonScriptURL(e),g.LoadScriptAsync(e)}static LoadScript(e,t,i,r){if("function"===typeof importScripts){try{importScripts(e),t()}catch(o){i?.(`Unable to load script '${e}' in worker`,o)}return}if(!(0,s.BA)())return void i?.(`Cannot load script '${e}' outside of a window or a worker`);const n=document.getElementsByTagName("head")[0],a=document.createElement("script");a.setAttribute("type","text/javascript"),a.setAttribute("src",e),r&&(a.id=r),a.onload=()=>{t&&t()},a.onerror=t=>{i&&i(`Unable to load script '${e}'`,t)},n.appendChild(a)}static LoadScriptAsync(e,t){return new Promise(((i,r)=>{this.LoadScript(e,(()=>{i()}),((e,t)=>{r(t||new Error(e))}),t)}))}static ReadFileAsDataURL(e,t,i){const s=new FileReader,n={onCompleteObservable:new r.cP,abort:()=>s.abort()};return s.onloadend=()=>{n.onCompleteObservable.notifyObservers(n)},s.onload=e=>{t(e.target.result)},s.onprogress=i,s.readAsDataURL(e),n}static ReadFile(e,t,i,r,s){return(0,u.NJ)(e,t,i,r,s)}static FileAsURL(e){const t=new Blob([e]);return window.URL.createObjectURL(t)}static Format(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return e.toFixed(t)}static DeepCopy(e,t,i,r){a.r.DeepCopy(e,t,i,r)}static IsEmpty(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}static RegisterTopRootEvents(e,t){for(let r=0;r<t.length;r++){const s=t[r];e.addEventListener(s.name,s.handler,!1);try{window.parent&&window.parent.addEventListener(s.name,s.handler,!1)}catch(i){}}}static UnregisterTopRootEvents(e,t){for(let r=0;r<t.length;r++){const s=t[r];e.removeEventListener(s.name,s.handler);try{e.parent&&e.parent.removeEventListener(s.name,s.handler)}catch(i){}}}static async DumpFramebuffer(e,t,i,r){throw(0,l.n)("DumpTools")}static DumpData(e,t,i,r){throw(0,l.n)("DumpTools")}static DumpDataAsync(e,t,i){throw(0,l.n)("DumpTools")}static _IsOffScreenCanvas(e){return void 0!==e.convertToBlob}static ToBlob(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",r=arguments.length>3?arguments[3]:void 0;g._IsOffScreenCanvas(e)||e.toBlob||(e.toBlob=function(e,t,i){setTimeout((()=>{const r=atob(this.toDataURL(t,i).split(",")[1]),s=r.length,n=new Uint8Array(s);for(let e=0;e<s;e++)n[e]=r.charCodeAt(e);e(new Blob([n]))}))}),g._IsOffScreenCanvas(e)?e.convertToBlob({type:i,quality:r}).then((e=>t(e))):e.toBlob((function(e){t(e)}),i,r)}static DownloadBlob(e,t){if("download"in document.createElement("a")){if(!t){const e=new Date;t="screenshot_"+((e.getFullYear()+"-"+(e.getMonth()+1)).slice(2)+"-"+e.getDate()+"_"+e.getHours()+"-"+("0"+e.getMinutes()).slice(-2))+".png"}g.Download(e,t)}else if(e&&"undefined"!==typeof URL){const t=URL.createObjectURL(e),i=window.open("");if(!i)return;const r=i.document.createElement("img");r.onload=function(){URL.revokeObjectURL(t)},r.src=t,i.document.body.appendChild(r)}}static EncodeScreenshotCanvasData(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",r=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;if("string"!==typeof r&&t){if(t){if(g._IsOffScreenCanvas(e))return void e.convertToBlob({type:i,quality:s}).then((e=>{const i=new FileReader;i.readAsDataURL(e),i.onloadend=()=>{const e=i.result;t(e)}}));const r=e.toDataURL(i,s);t(r)}}else this.ToBlob(e,(function(e){e&&g.DownloadBlob(e,r),t&&t("")}),i,s)}static Download(e,t){if("undefined"===typeof URL)return;const i=window.URL.createObjectURL(e),r=document.createElement("a");document.body.appendChild(r),r.style.display="none",r.href=i,r.download=t,r.addEventListener("click",(()=>{r.parentElement&&r.parentElement.removeChild(r)})),r.click(),window.URL.revokeObjectURL(i)}static BackCompatCameraNoPreventDefault(e){return"boolean"===typeof e[0]?e[0]:"boolean"===typeof e[1]&&e[1]}static CreateScreenshot(e,t,i,r){throw(0,l.n)("ScreenshotTools")}static CreateScreenshotAsync(e,t,i){throw(0,l.n)("ScreenshotTools")}static CreateScreenshotUsingRenderTarget(e,t,i,r){throw(0,l.n)("ScreenshotTools")}static CreateScreenshotUsingRenderTargetAsync(e,t,i){throw(0,l.n)("ScreenshotTools")}static RandomId(){return(0,p.z)()}static IsBase64(e){return(0,u.f2)(e)}static DecodeBase64(e){return(0,u.rz)(e)}static get errorsCount(){return n.V.errorsCount}static Log(e){n.V.Log(e)}static Warn(e){n.V.Warn(e)}static Error(e){n.V.Error(e)}static get LogCache(){return n.V.LogCache}static ClearLogCache(){n.V.ClearLogCache()}static set LogLevels(e){n.V.LogLevels=e}static set PerformanceLogLevel(e){return(e&g.PerformanceUserMarkLogLevel)===g.PerformanceUserMarkLogLevel?(g.StartPerformanceCounter=g._StartUserMark,void(g.EndPerformanceCounter=g._EndUserMark)):(e&g.PerformanceConsoleLogLevel)===g.PerformanceConsoleLogLevel?(g.StartPerformanceCounter=g._StartPerformanceConsole,void(g.EndPerformanceCounter=g._EndPerformanceConsole)):(g.StartPerformanceCounter=g._StartPerformanceCounterDisabled,void(g.EndPerformanceCounter=g._EndPerformanceCounterDisabled))}static _StartPerformanceCounterDisabled(e,t){}static _EndPerformanceCounterDisabled(e,t){}static _StartUserMark(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!g._Performance){if(!(0,s.BA)())return;g._Performance=window.performance}t&&g._Performance.mark&&g._Performance.mark(e+"-Begin")}static _EndUserMark(e){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&g._Performance.mark&&(g._Performance.mark(e+"-End"),g._Performance.measure(e,e+"-Begin",e+"-End"))}static _StartPerformanceConsole(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t&&(g._StartUserMark(e,t),console.time&&console.time(e))}static _EndPerformanceConsole(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t&&(g._EndUserMark(e,t),console.timeEnd(e))}static get Now(){return o.j.Now}static GetClassName(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=null;if(!t&&e.getClassName)i=e.getClassName();else{if(e instanceof Object){i=(t?e:Object.getPrototypeOf(e)).constructor.__bjsclassName__}i||(i=typeof e)}return i}static First(e,t){for(const i of e)if(t(i))return i;return null}static getFullClassName(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=null,r=null;if(!t&&e.getClassName)i=e.getClassName();else{if(e instanceof Object){const s=t?e:Object.getPrototypeOf(e);i=s.constructor.__bjsclassName__,r=s.constructor.__bjsmoduleName__}i||(i=typeof e)}return i?(null!=r?r+".":"")+i:null}static DelayAsync(e){return new Promise((t=>{setTimeout((()=>{t()}),e)}))}static IsSafari(){return!!(0,s.XD)()&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}}g.UseCustomRequestHeaders=!1,g.CustomRequestHeaders=h.u.CustomRequestHeaders,g.GetDOMTextContent=s.Zl,g._DefaultCdnUrl="https://cdn.babylonjs.com",g.GetAbsoluteUrl="object"===typeof document?e=>{const t=document.createElement("a");return t.href=e,t.href}:"function"===typeof URL&&"object"===typeof location?e=>new URL(e,location.origin).href:()=>{throw new Error("Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.")},g.NoneLogLevel=n.V.NoneLogLevel,g.MessageLogLevel=n.V.MessageLogLevel,g.WarningLogLevel=n.V.WarningLogLevel,g.ErrorLogLevel=n.V.ErrorLogLevel,g.AllLogLevel=n.V.AllLogLevel,g.IsWindowObjectExist=s.BA,g.PerformanceNoneLogLevel=0,g.PerformanceUserMarkLogLevel=1,g.PerformanceConsoleLogLevel=2,g.StartPerformanceCounter=g._StartPerformanceCounterDisabled,g.EndPerformanceCounter=g._EndPerformanceCounterDisabled;class m{constructor(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.iterations=e,this.index=r-1,this._done=!1,this._fn=t,this._successCallback=i}executeNext(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())}breakLoop(){this._done=!0,this._successCallback()}static Run(e,t,i){const r=new m(e,t,i,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return r.executeNext(),r}static SyncAsyncForLoop(e,t,i,r,s){let n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return m.Run(Math.ceil(e/t),(r=>{s&&s()?r.breakLoop():setTimeout((()=>{for(let n=0;n<t;++n){const a=r.index*t+n;if(a>=e)break;if(i(a),s&&s()){r.breakLoop();break}}r.executeNext()}),n)}),r)}}g.Mix=f.zF,g.IsExponentOfTwo=f.L8,c.q.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z"},4141:(e,t,i)=>{"use strict";i.d(t,{Y5:()=>s,n9:()=>n});const r={};function s(e,t){r[e]=t}function n(e){return r[e]}},1179:(e,t,i)=>{"use strict";i.d(t,{K:()=>r});class r{static get UniqueId(){const e=this._UniqueIdCounter;return this._UniqueIdCounter++,e}}r._UniqueIdCounter=1},4861:(e,t,i)=>{"use strict";i.d(t,{u:()=>r});class r{constructor(){this._xhr="undefined"!==typeof _native&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest,this._requestURL=""}static get IsCustomRequestAvailable(){return Object.keys(r.CustomRequestHeaders).length>0||r.CustomRequestModifiers.length>0}_injectCustomRequestHeaders(){if(!this._shouldSkipRequestModifications(this._requestURL))for(const e in r.CustomRequestHeaders){const t=r.CustomRequestHeaders[e];t&&this._xhr.setRequestHeader(e,t)}}_shouldSkipRequestModifications(e){return r.SkipRequestModificationForBabylonCDN&&(e.includes("preview.babylonjs.com")||e.includes("cdn.babylonjs.com"))}get onprogress(){return this._xhr.onprogress}set onprogress(e){this._xhr.onprogress=e}get readyState(){return this._xhr.readyState}get status(){return this._xhr.status}get statusText(){return this._xhr.statusText}get response(){return this._xhr.response}get responseURL(){return this._xhr.responseURL}get responseText(){return this._xhr.responseText}get responseType(){return this._xhr.responseType}set responseType(e){this._xhr.responseType=e}get timeout(){return this._xhr.timeout}set timeout(e){this._xhr.timeout=e}addEventListener(e,t,i){this._xhr.addEventListener(e,t,i)}removeEventListener(e,t,i){this._xhr.removeEventListener(e,t,i)}abort(){this._xhr.abort()}send(e){r.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(e)}open(e,t){for(const i of r.CustomRequestModifiers){if(this._shouldSkipRequestModifications(t))return;i(this._xhr,t)}t=(t=t.replace("file:http:","http:")).replace("file:https:","https:"),this._requestURL=t,this._xhr.open(e,t,!0)}setRequestHeader(e,t){this._xhr.setRequestHeader(e,t)}getResponseHeader(e){return this._xhr.getResponseHeader(e)}}r.CustomRequestHeaders={},r.CustomRequestModifiers=new Array,r.SkipRequestModificationForBabylonCDN=!0},6976:(e,t,i)=>{"use strict";i.d(t,{w:()=>p});var r=i(6379),s=i(20),n=i(5491),a=i(5968),o=i(4909),l=(i(5921),i(9289),i(7376)),h=i(818),c=i(4141),u=i(6291),d=i(8846),_=i(4780);d.$.prototype.setTextureFromPostProcess=function(e,t,i){let r=null;t&&(t._forcedOutputTexture?r=t._forcedOutputTexture:t._textures.data[t._currentRenderTextureInd]&&(r=t._textures.data[t._currentRenderTextureInd])),this._bindTexture(e,r?.texture??null,i)},d.$.prototype.setTextureFromPostProcessOutput=function(e,t,i){this._bindTexture(e,t?._outputTexture?.texture??null,i)},o.M.prototype.setTextureFromPostProcess=function(e,t){this._engine.setTextureFromPostProcess(this._samplers[e],t,e)},o.M.prototype.setTextureFromPostProcessOutput=function(e,t){this._engine.setTextureFromPostProcessOutput(this._samplers[e],t,e)};class p{static RegisterShaderCodeProcessing(e,t){t?p._CustomShaderCodeProcessing[e??""]=t:delete p._CustomShaderCodeProcessing[e??""]}static _GetShaderCodeProcessing(e){return p._CustomShaderCodeProcessing[e]??p._CustomShaderCodeProcessing[""]}get samples(){return this._samples}set samples(e){this._samples=Math.min(e,this._engine.getCaps().maxMSAASamples),this._textures.forEach((e=>{e.setSamples(this._samples)}))}get shaderLanguage(){return this._shaderLanguage}getEffectName(){return this._fragmentUrl}set onActivate(e){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),e&&(this._onActivateObserver=this.onActivateObservable.add(e))}set onSizeChanged(e){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(e)}set onApply(e){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(e)}set onBeforeRender(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)}set onAfterRender(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)}get inputTexture(){return this._textures.data[this._currentRenderTextureInd]}set inputTexture(e){this._forcedOutputTexture=e}restoreDefaultInputTexture(){this._forcedOutputTexture&&(this._forcedOutputTexture=null,this.markTextureDirty())}getCamera(){return this._camera}get texelSize(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.copyFromFloats(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)}constructor(e,t,i,r,o,l){let h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,c=arguments.length>7?arguments[7]:void 0,d=arguments.length>8?arguments[8]:void 0,_=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,p=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,f=arguments.length>11&&void 0!==arguments[11]?arguments[11]:"postprocess",g=arguments.length>12?arguments[12]:void 0,m=arguments.length>13&&void 0!==arguments[13]&&arguments[13],b=arguments.length>14&&void 0!==arguments[14]?arguments[14]:5,v=arguments.length>15?arguments[15]:void 0,y=arguments.length>16?arguments[16]:void 0;this._parentContainer=null,this.width=-1,this.height=-1,this.nodeMaterialSource=null,this._outputTexture=null,this.autoClear=!0,this.forceAutoClearInAlphaMode=!1,this.alphaMode=0,this.animations=[],this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=1,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._shadersLoaded=!1,this._webGPUReady=!1,this._reusable=!1,this._renderId=0,this.externalTextureSamplerBinding=!1,this._textures=new s.L(2),this._textureCache=[],this._currentRenderTextureInd=0,this._scaleRatio=new a.I9(1,1),this._texelSize=a.I9.Zero(),this.onEffectCreatedObservable=new n.cP(void 0,!0),this.onActivateObservable=new n.cP,this.onSizeChangedObservable=new n.cP,this.onApplyObservable=new n.cP,this.onBeforeRenderObservable=new n.cP,this.onAfterRenderObservable=new n.cP,this._importPromises=[],this.name=e;let T=1,x=null;if(i&&!Array.isArray(i)){const e=i;i=e.uniforms??null,r=e.samplers??null,T=e.size??1,l=e.camera??null,h=e.samplingMode??1,c=e.engine,d=e.reusable,_=e.defines??null,p=e.textureType??0,f=e.vertexUrl??"postprocess",g=e.indexParameters,m=e.blockCompilation??!1,b=e.textureFormat??5,v=e.shaderLanguage??0,x=e.uniformBuffers??null}else o&&(T="number"===typeof o?o:{width:o.width,height:o.height});null!=l?(this._camera=l,this._scene=l.getScene(),l.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):c&&(this._engine=c,this._engine.postProcesses.push(this)),this._options=T,this.renderTargetSamplingMode=h||1,this._reusable=d||!1,this._textureType=p,this._textureFormat=b,this._shaderLanguage=v||0,this._samplers=r||[],this._samplers.push("textureSampler"),this._fragmentUrl=t,this._vertexUrl=f,this._parameters=i||[],this._parameters.push("scale"),this._uniformBuffers=x||[],this._indexParameters=g,this._drawWrapper=new u.E(this._engine),this._webGPUReady=1===this._shaderLanguage,this._postConstructor(m,_,y)}_gatherImports(){let e=arguments.length>1?arguments[1]:void 0;arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this._webGPUReady?e.push(Promise.all([i.e(70).then(i.bind(i,9070))])):e.push(Promise.all([Promise.resolve().then(i.bind(i,5921))]))}_postConstructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0;const r=this.getEngine().isWebGPU&&!p.ForceGLSL;this._gatherImports(r,this._importPromises),i&&i(r,this._importPromises),r&&this._webGPUReady&&(this._shaderLanguage=1),e||this.updateEffect(t)}getClassName(){return"PostProcess"}getEngine(){return this._engine}getEffect(){return this._drawWrapper.effect}shareOutputWith(e){return this._disposeTextures(),this._shareOutputWithPostProcess=e,this}useOwnOutput(){0==this._textures.length&&(this._textures=new s.L(2)),this._shareOutputWithPostProcess=null}updateEffect(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,n=arguments.length>5?arguments[5]:void 0,a=arguments.length>6?arguments[6]:void 0,o=arguments.length>7?arguments[7]:void 0;const l=p._GetShaderCodeProcessing(this.name);if(l?.defineCustomBindings){const r=t?.slice()??[];r.push(...this._parameters);const s=i?.slice()??[];s.push(...this._samplers),e=l.defineCustomBindings(this.name,e,r,s),t=r,i=s}this._postProcessDefines=e,this._drawWrapper.effect=this._engine.createEffect({vertex:a??this._vertexUrl,fragment:o??this._fragmentUrl},{attributes:["position"],uniformsNames:t||this._parameters,uniformBuffersNames:this._uniformBuffers,samplers:i||this._samplers,defines:null!==e?e:"",fallbacks:null,onCompiled:s??null,onError:n??null,indexParameters:r||this._indexParameters,processCodeAfterIncludes:l?.processCodeAfterIncludes?(e,t)=>l.processCodeAfterIncludes(this.name,e,t):null,processFinalCode:l?.processFinalCode?(e,t)=>l.processFinalCode(this.name,e,t):null,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{await Promise.all(this._importPromises),this._shadersLoaded=!0}},this._engine),this.onEffectCreatedObservable.notifyObservers(this._drawWrapper.effect)}isReusable(){return this._reusable}markTextureDirty(){this.width=-1}_createRenderTargetTexture(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(let s=0;s<this._textureCache.length;s++)if(this._textureCache[s].texture.width===e.width&&this._textureCache[s].texture.height===e.height&&this._textureCache[s].postProcessChannel===i&&this._textureCache[s].texture._generateDepthBuffer===t.generateDepthBuffer&&this._textureCache[s].texture.samples===t.samples)return this._textureCache[s].texture;const r=this._engine.createRenderTargetTexture(e,t);return this._textureCache.push({texture:r,postProcessChannel:i,lastUsedRenderId:-1}),r}_flushTextureCache(){const e=this._renderId;for(let t=this._textureCache.length-1;t>=0;t--)if(e-this._textureCache[t].lastUsedRenderId>100){let e=!1;for(let i=0;i<this._textures.length;i++)if(this._textures.data[i]===this._textureCache[t].texture){e=!0;break}e||(this._textureCache[t].texture.dispose(),this._textureCache.splice(t,1))}}resize(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._textures.length>0&&this._textures.reset(),this.width=e,this.height=t;let n=null;if(i)for(let l=0;l<i._postProcesses.length;l++)if(null!==i._postProcesses[l]){n=i._postProcesses[l];break}const a={width:this.width,height:this.height},o={generateMipMaps:r,generateDepthBuffer:s||n===this,generateStencilBuffer:(s||n===this)&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat,samples:this._samples,label:"PostProcessRTT-"+this.name};this._textures.push(this._createRenderTargetTexture(a,o,0)),this._reusable&&this._textures.push(this._createRenderTargetTexture(a,o,1)),this._texelSize.copyFromFloats(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}_getTarget(){let e;if(this._shareOutputWithPostProcess)e=this._shareOutputWithPostProcess.inputTexture;else if(this._forcedOutputTexture)e=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height;else{let t;e=this.inputTexture;for(let i=0;i<this._textureCache.length;i++)if(this._textureCache[i].texture===e){t=this._textureCache[i];break}t&&(t.lastUsedRenderId=this._renderId)}return e}activate(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0;const r=(e=e||this._camera).getScene(),s=r.getEngine(),n=s.getCaps().maxTextureSize,a=(t?t.width:this._engine.getRenderWidth(!0))*this._options|0,o=(t?t.height:this._engine.getRenderHeight(!0))*this._options|0;let l=this._options.width||a,h=this._options.height||o;const c=7!==this.renderTargetSamplingMode&&1!==this.renderTargetSamplingMode&&2!==this.renderTargetSamplingMode;let u=null;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){const e=s.currentViewport;e&&(l*=e.width,h*=e.height)}(c||this.alwaysForcePOT)&&(this._options.width||(l=s.needPOTTextures?(0,_.R)(l,n,this.scaleMode):l),this._options.height||(h=s.needPOTTextures?(0,_.R)(h,n,this.scaleMode):h)),this.width===l&&this.height===h&&(u=this._getTarget())||this.resize(l,h,e,c,i),this._textures.forEach((e=>{e.samples!==this.samples&&this._engine.updateRenderTargetTextureSampleCount(e,this.samples)})),this._flushTextureCache(),this._renderId++}return u||(u=this._getTarget()),this.enablePixelPerfectMode?(this._scaleRatio.copyFromFloats(a/l,o/h),this._engine.bindFramebuffer(u,0,a,o,this.forceFullscreenViewport)):(this._scaleRatio.copyFromFloats(1,1),this._engine.bindFramebuffer(u,0,void 0,void 0,this.forceFullscreenViewport)),this._engine._debugInsertMarker?.(`post process ${this.name} input`),this.onActivateObservable.notifyObservers(e),this.autoClear&&(0===this.alphaMode||this.forceAutoClearInAlphaMode)&&this._engine.clear(this.clearColor?this.clearColor:r.clearColor,r._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),u}get isSupported(){return this._drawWrapper.effect.isSupported}get aspectRatio(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height}isReady(){return this._drawWrapper.effect?.isReady()??!1}apply(){if(!this._drawWrapper.effect?.isReady())return null;let e;return this._engine.enableEffect(this._drawWrapper),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this._engine.setAlphaMode(this.alphaMode),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),e=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this.externalTextureSamplerBinding||this._drawWrapper.effect._bindTexture("textureSampler",e?.texture),this._drawWrapper.effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._drawWrapper.effect),p._GetShaderCodeProcessing(this.name)?.bindCustomBindings?.(this.name,this._drawWrapper.effect),this._drawWrapper.effect}_disposeTextures(){this._shareOutputWithPostProcess||this._forcedOutputTexture?this._disposeTextureCache():(this._disposeTextureCache(),this._textures.dispose())}_disposeTextureCache(){for(let e=this._textureCache.length-1;e>=0;e--)this._textureCache[e].texture.dispose();this._textureCache.length=0}setPrePassRenderer(e){return!!this._prePassEffectConfiguration&&(this._prePassEffectConfiguration=e.addEffectConfiguration(this._prePassEffectConfiguration),this._prePassEffectConfiguration.enabled=!0,!0)}dispose(e){let t;if(e=e||this._camera,this._disposeTextures(),this._scene&&(t=this._scene.postProcesses.indexOf(this),-1!==t&&this._scene.postProcesses.splice(t,1)),this._parentContainer){const e=this._parentContainer.postProcesses.indexOf(this);e>-1&&this._parentContainer.postProcesses.splice(e,1),this._parentContainer=null}if(t=this._engine.postProcesses.indexOf(this),-1!==t&&this._engine.postProcesses.splice(t,1),e){if(e.detachPostProcess(this),t=e._postProcesses.indexOf(this),0===t&&e._postProcesses.length>0){const e=this._camera._getFirstPostProcess();e&&e.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear(),this.onEffectCreatedObservable.clear()}}serialize(){const e=h.p.Serialize(this),t=this.getCamera()||this._scene&&this._scene.activeCamera;return e.customType="BABYLON."+this.getClassName(),e.cameraId=t?t.id:null,e.reusable=this._reusable,e.textureType=this._textureType,e.fragmentUrl=this._fragmentUrl,e.parameters=this._parameters,e.samplers=this._samplers,e.options=this._options,e.defines=this._postProcessDefines,e.textureFormat=this._textureFormat,e.vertexUrl=this._vertexUrl,e.indexParameters=this._indexParameters,e}clone(){const e=this.serialize();e._engine=this._engine,e.cameraId=null;const t=p.Parse(e,this._scene,"");return t?(t.onActivateObservable=this.onActivateObservable.clone(),t.onSizeChangedObservable=this.onSizeChangedObservable.clone(),t.onApplyObservable=this.onApplyObservable.clone(),t.onBeforeRenderObservable=this.onBeforeRenderObservable.clone(),t.onAfterRenderObservable=this.onAfterRenderObservable.clone(),t._prePassEffectConfiguration=this._prePassEffectConfiguration,t):null}static Parse(e,t,i){const r=(0,c.n9)(e.customType);if(!r||!r._Parse)return null;const s=t?t.getCameraById(e.cameraId):null;return r._Parse(e,s,t,i)}static _Parse(e,t,i,r){return h.p.Parse((()=>new p(e.name,e.fragmentUrl,e.parameters,e.samplers,e.options,t,e.renderTargetSamplingMode,e._engine,e.reusable,e.defines,e.textureType,e.vertexUrl,e.indexParameters,!1,e.textureFormat)),e,i,r)}}p.ForceGLSL=!1,p._CustomShaderCodeProcessing={},(0,r.Cg)([(0,l.lK)()],p.prototype,"uniqueId",void 0),(0,r.Cg)([(0,l.lK)()],p.prototype,"name",void 0),(0,r.Cg)([(0,l.lK)()],p.prototype,"width",void 0),(0,r.Cg)([(0,l.lK)()],p.prototype,"height",void 0),(0,r.Cg)([(0,l.lK)()],p.prototype,"renderTargetSamplingMode",void 0),(0,r.Cg)([(0,l.qK)()],p.prototype,"clearColor",void 0),(0,r.Cg)([(0,l.lK)()],p.prototype,"autoClear",void 0),(0,r.Cg)([(0,l.lK)()],p.prototype,"forceAutoClearInAlphaMode",void 0),(0,r.Cg)([(0,l.lK)()],p.prototype,"alphaMode",void 0),(0,r.Cg)([(0,l.lK)()],p.prototype,"alphaConstants",void 0),(0,r.Cg)([(0,l.lK)()],p.prototype,"enablePixelPerfectMode",void 0),(0,r.Cg)([(0,l.lK)()],p.prototype,"forceFullscreenViewport",void 0),(0,r.Cg)([(0,l.lK)()],p.prototype,"scaleMode",void 0),(0,r.Cg)([(0,l.lK)()],p.prototype,"alwaysForcePOT",void 0),(0,r.Cg)([(0,l.lK)("samples")],p.prototype,"_samples",void 0),(0,r.Cg)([(0,l.lK)()],p.prototype,"adaptScaleToCurrentViewport",void 0),(0,c.Y5)("BABYLON.PostProcess",p)},7637:(e,t,i)=>{"use strict";i.d(t,{X:()=>n});var r=i(1837),s=i(5491);class n{constructor(e){this._vertexBuffers={},this.onBeforeRenderObservable=new s.cP,this._scene=e}_prepareBuffers(){if(this._vertexBuffers[r.R.PositionKind])return;const e=[];e.push(1,1),e.push(-1,1),e.push(-1,-1),e.push(1,-1),this._vertexBuffers[r.R.PositionKind]=new r.R(this._scene.getEngine(),e,r.R.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const e=[];e.push(0),e.push(1),e.push(2),e.push(0),e.push(2),e.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(e)}_rebuild(){const e=this._vertexBuffers[r.R.PositionKind];e&&(e._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=this._scene.activeCamera;return!!i&&(t=t||i._postProcesses.filter((e=>null!=e)),!(!t||0===t.length||!this._scene.postProcessesEnabled)&&(t[0].activate(i,e,null!==t&&void 0!==t),!0))}directRender(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const a=this._scene.getEngine();for(let o=0;o<e.length;o++){o<e.length-1?e[o+1].activate(this._scene.activeCamera,t?.texture):(t?a.bindFramebuffer(t,r,void 0,void 0,i,s):n||a.restoreDefaultFramebuffer(),a._debugInsertMarker?.(`post process ${e[o].name} output`));const l=e[o],h=l.apply();h&&(l.onBeforeRenderObservable.notifyObservers(h),this._prepareBuffers(),a.bindBuffers(this._vertexBuffers,this._indexBuffer,h),a.drawElementsType(0,0,6),l.onAfterRenderObservable.notifyObservers(h))}a.setDepthBuffer(!0),a.setDepthWrite(!0)}_finalizeFrame(e,t,i,r){let s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const n=this._scene.activeCamera;if(!n)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(r=r||n._postProcesses.filter((e=>null!=e))).length||!this._scene.postProcessesEnabled)return;const a=this._scene.getEngine();for(let o=0,l=r.length;o<l;o++){const h=r[o];if(o<l-1?h._outputTexture=r[o+1].activate(n,t?.texture):(t?(a.bindFramebuffer(t,i,void 0,void 0,s),h._outputTexture=t):(a.restoreDefaultFramebuffer(),h._outputTexture=null),a._debugInsertMarker?.(`post process ${r[o].name} output`)),e)break;const c=h.apply();c&&(h.onBeforeRenderObservable.notifyObservers(c),this._prepareBuffers(),a.bindBuffers(this._vertexBuffers,this._indexBuffer,c),a.drawElementsType(0,0,6),h.onAfterRenderObservable.notifyObservers(c))}a.setDepthBuffer(!0),a.setDepthWrite(!0),a.setAlphaMode(0)}dispose(){const e=this._vertexBuffers[r.R.PositionKind];e&&(e.dispose(),this._vertexBuffers[r.R.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},507:(e,t,i)=>{"use strict";i.d(t,{m:()=>o});var r=i(20),s=i(5968);class n{set opaqueSortCompareFn(e){this._opaqueSortCompareFn=e||n.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(e){this._alphaTestSortCompareFn=e||n.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(e){this._transparentSortCompareFn=e||n.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=e,this._opaqueSubMeshes=new r.L(256),this._transparentSubMeshes=new r.L(256),this._alphaTestSubMeshes=new r.L(256),this._depthOnlySubMeshes=new r.L(256),this._particleSystems=new r.L(256),this._spriteManagers=new r.L(256),this._empty=!0,this._edgesRenderers=new r.b(16),this._scene=t,this.opaqueSortCompareFn=i,this.alphaTestSortCompareFn=s,this.transparentSortCompareFn=n}render(e,t,i,r){if(e)return void e(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const s=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(s.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),s.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const n=s.getStencilBuffer();if(s.setStencilBuffer(!1),t&&this._renderSprites(),i&&this._renderParticles(r),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(s.setStencilBuffer(n),this._scene.useOrderIndependentTransparency){const e=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);e.length&&this._renderTransparent(e)}else this._renderTransparent(this._transparentSubMeshes);s.setAlphaMode(0)}if(s.setStencilBuffer(!1),this._edgesRenderers.length){for(let e=0;e<this._edgesRenderers.length;e++)this._edgesRenderers.data[e].render();s.setAlphaMode(0)}s.setStencilBuffer(n)}_renderOpaqueSorted(e){n._RenderSorted(e,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(e){n._RenderSorted(e,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(e){n._RenderSorted(e,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(e,t,i,r){let a,o=0;const l=i?i.globalPosition:n._ZeroVector;if(r)for(;o<e.length;o++)a=e.data[o],a._alphaIndex=a.getMesh().alphaIndex,a._distanceToCamera=s.Pq.Distance(a.getBoundingInfo().boundingSphere.centerWorld,l);const h=e.length===e.data.length?e.data:e.data.slice(0,e.length);t&&h.sort(t);const c=h[0].getMesh().getScene();for(o=0;o<h.length;o++)if(a=h[o],!c._activeMeshesFrozenButKeepClipping||a.isInFrustum(c._frustumPlanes)){if(r){const e=a.getMaterial();if(e&&e.needDepthPrePass){const t=e.getScene().getEngine();t.setColorWrite(!1),t.setAlphaMode(0),a.render(!1),t.setColorWrite(!0)}}a.render(r)}}static defaultTransparentSortCompare(e,t){return e._alphaIndex>t._alphaIndex?1:e._alphaIndex<t._alphaIndex?-1:n.backToFrontSortCompare(e,t)}static backToFrontSortCompare(e,t){return e._distanceToCamera<t._distanceToCamera?1:e._distanceToCamera>t._distanceToCamera?-1:0}static frontToBackSortCompare(e,t){return e._distanceToCamera<t._distanceToCamera?-1:e._distanceToCamera>t._distanceToCamera?1:0}static PainterSortCompare(e,t){const i=e.getMesh(),r=t.getMesh();return i.material&&r.material?i.material.uniqueId-r.material.uniqueId:i.uniqueId-r.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(e,t,i){void 0===t&&(t=e.getMesh()),void 0===i&&(i=e.getMaterial()),null!==i&&void 0!==i&&(i.needAlphaBlendingForMesh(t)?this._transparentSubMeshes.push(e):i.needAlphaTesting()?(i.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._alphaTestSubMeshes.push(e)):(i.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._opaqueSubMeshes.push(e)),t._renderingGroup=this,t._edgesRenderer&&t.isEnabled()&&t.isVisible&&t._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(t._edgesRenderer),this._empty=!1)}dispatchSprites(e){this._spriteManagers.push(e),this._empty=!1}dispatchParticles(e){this._particleSystems.push(e),this._empty=!1}_renderParticles(e){if(0===this._particleSystems.length)return;const t=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let i=0;i<this._particleSystems.length;i++){const r=this._particleSystems.data[i];if(0===(t&&t.layerMask&r.layerMask))continue;const s=r.emitter;s.position&&e&&-1===e.indexOf(s)||this._scene._activeParticles.addCount(r.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const e=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let t=0;t<this._spriteManagers.length;t++){const i=this._spriteManagers.data[t];0!==(e&&e.layerMask&i.layerMask)&&i.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}n._ZeroVector=s.Pq.Zero();class a{}class o{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(e){e!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=e,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const e of this._scene.meshes)if(e.subMeshes)for(const t of e.subMeshes)t._wasDispatched=!1;if(this._scene.spriteManagers)for(const e of this._scene.spriteManagers)e._wasDispatched=!1;for(const e of this._scene.particleSystems)e._wasDispatched=!1}constructor(e){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new a,this._maintainStateBetweenFrames=!1,this._scene=e;for(let t=o.MIN_RENDERINGGROUPS;t<o.MAX_RENDERINGGROUPS;t++)this._autoClearDepthStencil[t]={autoClear:!0,depth:!0,stencil:!0}}getRenderingGroup(e){const t=e||0;return this._prepareRenderingGroup(t),this._renderingGroups[t]}_clearDepthStencilBuffer(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,e,t),this._depthStencilBufferAlreadyCleaned=!0)}render(e,t,i,r){const s=this._renderingGroupInfo;if(s.scene=this._scene,s.camera=this._scene.activeCamera,this._scene.spriteManagers&&r)for(let n=0;n<this._scene.spriteManagers.length;n++){const e=this._scene.spriteManagers[n];this.dispatchSprites(e)}for(let n=o.MIN_RENDERINGGROUPS;n<o.MAX_RENDERINGGROUPS;n++){this._depthStencilBufferAlreadyCleaned=n===o.MIN_RENDERINGGROUPS;const a=this._renderingGroups[n];if(!a||a._empty)continue;const l=1<<n;if(s.renderingGroupId=n,this._scene.onBeforeRenderingGroupObservable.notifyObservers(s,l),o.AUTOCLEAR){const e=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(n):this._autoClearDepthStencil[n];e&&e.autoClear&&this._clearDepthStencilBuffer(e.depth,e.stencil)}for(const e of this._scene._beforeRenderingGroupDrawStage)e.action(n);a.render(e,r,i,t);for(const e of this._scene._afterRenderingGroupDrawStage)e.action(n);this._scene.onAfterRenderingGroupObservable.notifyObservers(s,l)}}reset(){if(!this.maintainStateBetweenFrames)for(let e=o.MIN_RENDERINGGROUPS;e<o.MAX_RENDERINGGROUPS;e++){const t=this._renderingGroups[e];t&&t.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let e=o.MIN_RENDERINGGROUPS;e<o.MAX_RENDERINGGROUPS;e++){const t=this._renderingGroups[e];t&&t.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let e=o.MIN_RENDERINGGROUPS;e<o.MAX_RENDERINGGROUPS;e++){const t=this._renderingGroups[e];t&&t.dispose()}}_prepareRenderingGroup(e){void 0===this._renderingGroups[e]&&(this._renderingGroups[e]=new n(e,this._scene,this._customOpaqueSortCompareFn[e],this._customAlphaTestSortCompareFn[e],this._customTransparentSortCompareFn[e]))}dispatchSprites(e){this.maintainStateBetweenFrames&&e._wasDispatched||(e._wasDispatched=!0,this.getRenderingGroup(e.renderingGroupId).dispatchSprites(e))}dispatchParticles(e){this.maintainStateBetweenFrames&&e._wasDispatched||(e._wasDispatched=!0,this.getRenderingGroup(e.renderingGroupId).dispatchParticles(e))}dispatch(e,t,i){void 0===t&&(t=e.getMesh()),this.maintainStateBetweenFrames&&e._wasDispatched||(e._wasDispatched=!0,this.getRenderingGroup(t.renderingGroupId).dispatch(e,t,i))}setRenderingOrder(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[e]=t,this._customAlphaTestSortCompareFn[e]=i,this._customTransparentSortCompareFn[e]=r,this._renderingGroups[e]){const t=this._renderingGroups[e];t.opaqueSortCompareFn=this._customOpaqueSortCompareFn[e],t.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[e],t.transparentSortCompareFn=this._customTransparentSortCompareFn[e]}}setRenderingAutoClearDepthStencil(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[e]={autoClear:t,depth:i,stencil:r}}getAutoClearDepthStencilSetup(e){return this._autoClearDepthStencil[e]}}o.MAX_RENDERINGGROUPS=4,o.MIN_RENDERINGGROUPS=0,o.AUTOCLEAR=!0},2379:(e,t,i)=>{"use strict";i.r(t),i.d(t,{passPixelShader:()=>n});const r="passPixelShader",s="varying vec2 vUV;uniform sampler2D textureSampler;\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) \n{gl_FragColor=texture2D(textureSampler,vUV);}";i(4453).l.ShadersStore[r]=s;const n={name:r,shader:s}},5921:(e,t,i)=>{"use strict";i.r(t),i.d(t,{postprocessVertexShader:()=>n});const r="postprocessVertexShader",s="attribute vec2 position;uniform vec2 scale;varying vec2 vUV;const vec2 madd=vec2(0.5,0.5);\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvUV=(position*madd+madd)*scale;gl_Position=vec4(position,0.0,1.0);\n#define CUSTOM_VERTEX_MAIN_END\n}";i(4453).l.ShadersStore[r]=s;const n={name:r,shader:s}},4742:(e,t,i)=>{"use strict";i.d(t,{Z:()=>Z});var r=i(543),s=i(2132),n=i(5491),a=i(20);class o{constructor(){this._count=0,this._data={}}copyFrom(e){this.clear(),e.forEach(((e,t)=>this.add(e,t)))}get(e){const t=this._data[e];if(void 0!==t)return t}getOrAddWithFactory(e,t){let i=this.get(e);return void 0!==i||(i=t(e),i&&this.add(e,i)),i}getOrAdd(e,t){const i=this.get(e);return void 0!==i?i:(this.add(e,t),t)}contains(e){return void 0!==this._data[e]}add(e,t){return void 0===this._data[e]&&(this._data[e]=t,++this._count,!0)}set(e,t){return void 0!==this._data[e]&&(this._data[e]=t,!0)}getAndRemove(e){const t=this.get(e);return void 0!==t?(delete this._data[e],--this._count,t):null}remove(e){return!!this.contains(e)&&(delete this._data[e],--this._count,!0)}clear(){this._data={},this._count=0}get count(){return this._count}forEach(e){for(const t in this._data){e(t,this._data[t])}}first(e){for(const t in this._data){const i=e(t,this._data[t]);if(i)return i}return null}}var l=i(5387),h=i(5968),c=i(4141);class u{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.particleSystems=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[]}static AddParser(e,t){this._BabylonFileParsers[e]=t}static GetParser(e){return this._BabylonFileParsers[e]?this._BabylonFileParsers[e]:null}static AddIndividualParser(e,t){this._IndividualBabylonFileParsers[e]=t}static GetIndividualParser(e){return this._IndividualBabylonFileParsers[e]?this._IndividualBabylonFileParsers[e]:null}static Parse(e,t,i,r){for(const s in this._BabylonFileParsers)Object.prototype.hasOwnProperty.call(this._BabylonFileParsers,s)&&this._BabylonFileParsers[s](e,t,i,r)}get environmentTexture(){return this._environmentTexture}set environmentTexture(e){this._environmentTexture=e}getNodes(){let e=[];return e=e.concat(this.meshes),e=e.concat(this.lights),e=e.concat(this.cameras),e=e.concat(this.transformNodes),this.skeletons.forEach((t=>e=e.concat(t.bones))),e}}u._BabylonFileParsers={},u._IndividualBabylonFileParsers={},(0,c.Y5)("BABYLON.AbstractScene",u);var d=i(3390),_=i(4990),p=i(9770);class f{constructor(e,t,i,r,s,n){this.source=e,this.pointerX=t,this.pointerY=i,this.meshUnderPointer=r,this.sourceEvent=s,this.additionalData=n}static CreateNew(e,t,i){const r=e.getScene();return new f(e,r.pointerX,r.pointerY,r.meshUnderPointer||e,t,i)}static CreateNewFromSprite(e,t,i,r){return new f(e,t.pointerX,t.pointerY,t.meshUnderPointer,i,r)}static CreateNewFromScene(e,t){return new f(null,e.pointerX,e.pointerY,e.meshUnderPointer,t)}static CreateNewFromPrimitive(e,t,i,r){return new f(e,t.x,t.y,null,i,r)}}var g=i(7637),m=i(507),b=i(6736),v=i(8315),y=i(4072),T=i(6984),x=i(3781);class A{constructor(){this.hoverCursor="",this.actions=[],this.isRecursive=!1,this.disposeWhenUnowned=!0}static get HasTriggers(){for(const e in A.Triggers)if(Object.prototype.hasOwnProperty.call(A.Triggers,e))return!0;return!1}static get HasPickTriggers(){for(const e in A.Triggers)if(Object.prototype.hasOwnProperty.call(A.Triggers,e)){const t=parseInt(e);if(t>=1&&t<=7)return!0}return!1}static HasSpecificTrigger(e){for(const t in A.Triggers)if(Object.prototype.hasOwnProperty.call(A.Triggers,t)){if(parseInt(t)===e)return!0}return!1}}A.Triggers={};var C,R,E,S,M,P,I,O=i(4585);!function(e){e[e.Generic=0]="Generic",e[e.Keyboard=1]="Keyboard",e[e.Mouse=2]="Mouse",e[e.Touch=3]="Touch",e[e.DualShock=4]="DualShock",e[e.Xbox=5]="Xbox",e[e.Switch=6]="Switch",e[e.DualSense=7]="DualSense"}(C||(C={})),function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.LeftClick=2]="LeftClick",e[e.MiddleClick=3]="MiddleClick",e[e.RightClick=4]="RightClick",e[e.BrowserBack=5]="BrowserBack",e[e.BrowserForward=6]="BrowserForward",e[e.MouseWheelX=7]="MouseWheelX",e[e.MouseWheelY=8]="MouseWheelY",e[e.MouseWheelZ=9]="MouseWheelZ",e[e.Move=12]="Move"}(R||(R={})),function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.LeftClick=2]="LeftClick",e[e.MiddleClick=3]="MiddleClick",e[e.RightClick=4]="RightClick",e[e.BrowserBack=5]="BrowserBack",e[e.BrowserForward=6]="BrowserForward",e[e.MouseWheelX=7]="MouseWheelX",e[e.MouseWheelY=8]="MouseWheelY",e[e.MouseWheelZ=9]="MouseWheelZ",e[e.DeltaHorizontal=10]="DeltaHorizontal",e[e.DeltaVertical=11]="DeltaVertical"}(E||(E={})),function(e){e[e.Cross=0]="Cross",e[e.Circle=1]="Circle",e[e.Square=2]="Square",e[e.Triangle=3]="Triangle",e[e.L1=4]="L1",e[e.R1=5]="R1",e[e.L2=6]="L2",e[e.R2=7]="R2",e[e.Share=8]="Share",e[e.Options=9]="Options",e[e.L3=10]="L3",e[e.R3=11]="R3",e[e.DPadUp=12]="DPadUp",e[e.DPadDown=13]="DPadDown",e[e.DPadLeft=14]="DPadLeft",e[e.DPadRight=15]="DPadRight",e[e.Home=16]="Home",e[e.TouchPad=17]="TouchPad",e[e.LStickXAxis=18]="LStickXAxis",e[e.LStickYAxis=19]="LStickYAxis",e[e.RStickXAxis=20]="RStickXAxis",e[e.RStickYAxis=21]="RStickYAxis"}(S||(S={})),function(e){e[e.Cross=0]="Cross",e[e.Circle=1]="Circle",e[e.Square=2]="Square",e[e.Triangle=3]="Triangle",e[e.L1=4]="L1",e[e.R1=5]="R1",e[e.L2=6]="L2",e[e.R2=7]="R2",e[e.Create=8]="Create",e[e.Options=9]="Options",e[e.L3=10]="L3",e[e.R3=11]="R3",e[e.DPadUp=12]="DPadUp",e[e.DPadDown=13]="DPadDown",e[e.DPadLeft=14]="DPadLeft",e[e.DPadRight=15]="DPadRight",e[e.Home=16]="Home",e[e.TouchPad=17]="TouchPad",e[e.LStickXAxis=18]="LStickXAxis",e[e.LStickYAxis=19]="LStickYAxis",e[e.RStickXAxis=20]="RStickXAxis",e[e.RStickYAxis=21]="RStickYAxis"}(M||(M={})),function(e){e[e.A=0]="A",e[e.B=1]="B",e[e.X=2]="X",e[e.Y=3]="Y",e[e.LB=4]="LB",e[e.RB=5]="RB",e[e.LT=6]="LT",e[e.RT=7]="RT",e[e.Back=8]="Back",e[e.Start=9]="Start",e[e.LS=10]="LS",e[e.RS=11]="RS",e[e.DPadUp=12]="DPadUp",e[e.DPadDown=13]="DPadDown",e[e.DPadLeft=14]="DPadLeft",e[e.DPadRight=15]="DPadRight",e[e.Home=16]="Home",e[e.LStickXAxis=17]="LStickXAxis",e[e.LStickYAxis=18]="LStickYAxis",e[e.RStickXAxis=19]="RStickXAxis",e[e.RStickYAxis=20]="RStickYAxis"}(P||(P={})),function(e){e[e.B=0]="B",e[e.A=1]="A",e[e.Y=2]="Y",e[e.X=3]="X",e[e.L=4]="L",e[e.R=5]="R",e[e.ZL=6]="ZL",e[e.ZR=7]="ZR",e[e.Minus=8]="Minus",e[e.Plus=9]="Plus",e[e.LS=10]="LS",e[e.RS=11]="RS",e[e.DPadUp=12]="DPadUp",e[e.DPadDown=13]="DPadDown",e[e.DPadLeft=14]="DPadLeft",e[e.DPadRight=15]="DPadRight",e[e.Home=16]="Home",e[e.Capture=17]="Capture",e[e.LStickXAxis=18]="LStickXAxis",e[e.LStickYAxis=19]="LStickYAxis",e[e.RStickXAxis=20]="RStickXAxis",e[e.RStickYAxis=21]="RStickYAxis"}(I||(I={}));var D=i(1321);class w{static CreateDeviceEvent(e,t,i,r,s,n,a){switch(e){case C.Keyboard:return this._CreateKeyboardEvent(i,r,s,n);case C.Mouse:if(i===R.MouseWheelX||i===R.MouseWheelY||i===R.MouseWheelZ)return this._CreateWheelEvent(e,t,i,r,s,n);case C.Touch:return this._CreatePointerEvent(e,t,i,r,s,n,a);default:throw`Unable to generate event for device ${C[e]}`}}static _CreatePointerEvent(e,t,i,r,s,n,a){const o=this._CreateMouseEvent(e,t,i,r,s,n);e===C.Mouse?(o.deviceType=C.Mouse,o.pointerId=1,o.pointerType="mouse"):(o.deviceType=C.Touch,o.pointerId=a??t,o.pointerType="touch");let l=0;return l+=s.pollInput(e,t,R.LeftClick),l+=2*s.pollInput(e,t,R.RightClick),l+=4*s.pollInput(e,t,R.MiddleClick),o.buttons=l,i===R.Move?o.type="pointermove":i>=R.LeftClick&&i<=R.RightClick&&(o.type=1===r?"pointerdown":"pointerup",o.button=i-2),o}static _CreateWheelEvent(e,t,i,r,s,n){const a=this._CreateMouseEvent(e,t,i,r,s,n);switch(a.pointerId=1,a.type="wheel",a.deltaMode=D.s.DOM_DELTA_PIXEL,a.deltaX=0,a.deltaY=0,a.deltaZ=0,i){case R.MouseWheelX:a.deltaX=r;break;case R.MouseWheelY:a.deltaY=r;break;case R.MouseWheelZ:a.deltaZ=r}return a}static _CreateMouseEvent(e,t,i,r,s,n){const a=this._CreateEvent(n),o=s.pollInput(e,t,R.Horizontal),l=s.pollInput(e,t,R.Vertical);return n?(a.movementX=0,a.movementY=0,a.offsetX=a.movementX-n.getBoundingClientRect().x,a.offsetY=a.movementY-n.getBoundingClientRect().y):(a.movementX=s.pollInput(e,t,10),a.movementY=s.pollInput(e,t,11),a.offsetX=0,a.offsetY=0),this._CheckNonCharacterKeys(a,s),a.clientX=o,a.clientY=l,a.x=o,a.y=l,a.deviceType=e,a.deviceSlot=t,a.inputIndex=i,a}static _CreateKeyboardEvent(e,t,i,r){const s=this._CreateEvent(r);return this._CheckNonCharacterKeys(s,i),s.deviceType=C.Keyboard,s.deviceSlot=0,s.inputIndex=e,s.type=1===t?"keydown":"keyup",s.key=String.fromCharCode(e),s.keyCode=e,s}static _CheckNonCharacterKeys(e,t){const i=t.isDeviceAvailable(C.Keyboard),r=i&&1===t.pollInput(C.Keyboard,0,18),s=i&&1===t.pollInput(C.Keyboard,0,17),n=i&&(1===t.pollInput(C.Keyboard,0,91)||1===t.pollInput(C.Keyboard,0,92)||1===t.pollInput(C.Keyboard,0,93)),a=i&&1===t.pollInput(C.Keyboard,0,16);e.altKey=r,e.ctrlKey=s,e.metaKey=n,e.shiftKey=a}static _CreateEvent(e){const t={preventDefault:()=>{}};return t.target=e,t}}class F{constructor(e,t,i){this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(e,t,((e,t,r,s)=>{const n=w.CreateDeviceEvent(e,t,r,s,this);i(e,t,n)})):this._createDummyNativeInput()}pollInput(e,t,i){return this._nativeInput.pollInput(e,t,i)}isDeviceAvailable(e){return e===C.Mouse||e===C.Touch}dispose(){this._nativeInput.dispose()}_createDummyNativeInput(){return{pollInput:()=>0,isDeviceAvailable:()=>!1,dispose:()=>{}}}}const L=Object.keys(R).length/2;class B{constructor(e,t,i,s){this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._usingSafari=r.S0.IsSafari(),this._usingMacOS=(0,v.XD)()&&/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),this._keyboardDownEvent=e=>{},this._keyboardUpEvent=e=>{},this._keyboardBlurEvent=e=>{},this._pointerMoveEvent=e=>{},this._pointerDownEvent=e=>{},this._pointerUpEvent=e=>{},this._pointerCancelEvent=e=>{},this._pointerWheelEvent=e=>{},this._pointerBlurEvent=e=>{},this._pointerMacOSChromeOutEvent=e=>{},this._eventsAttached=!1,this._mouseId=-1,this._isUsingFirefox=(0,v.XD)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Firefox"),this._isUsingChromium=(0,v.XD)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Chrome"),this._maxTouchPoints=0,this._pointerInputClearObserver=null,this._gamepadConnectedEvent=e=>{},this._gamepadDisconnectedEvent=e=>{},this._eventPrefix=r.S0.GetPointerPrefix(e),this._engine=e,this._onDeviceConnected=t,this._onDeviceDisconnected=i,this._onInputChanged=s,this._mouseId=this._isUsingFirefox?0:1,this._enableEvents(),this._usingMacOS&&(this._metaKeys=[]),this._engine._onEngineViewChanged||(this._engine._onEngineViewChanged=()=>{this._enableEvents()})}pollInput(e,t,i){const s=this._inputs[e][t];if(!s)throw`Unable to find device ${C[e]}`;e>=C.DualShock&&e<=C.DualSense&&this._updateDevice(e,t,i);const n=s[i];if(void 0===n)throw`Unable to find input ${i} for device ${C[e]} in slot ${t}`;return i===R.Move&&r.S0.Warn("Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data."),n}isDeviceAvailable(e){return void 0!==this._inputs[e]}dispose(){this._onDeviceConnected=()=>{},this._onDeviceDisconnected=()=>{},this._onInputChanged=()=>{},delete this._engine._onEngineViewChanged,this._elementToAttachTo&&this._disableEvents()}_enableEvents(){const e=this?._engine.getInputElement();if(e&&(!this._eventsAttached||this._elementToAttachTo!==e)){if(this._disableEvents(),this._inputs)for(const e of this._inputs)if(e)for(const t in e){const i=e[+t];if(i)for(let e=0;e<i.length;e++)i[e]=0}this._elementToAttachTo=e,this._elementToAttachTo.tabIndex=-1!==this._elementToAttachTo.tabIndex?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._eventsAttached=!0,this._checkForConnectedDevices()}}_disableEvents(){this._elementToAttachTo&&(this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent),this._usingMacOS&&this._isUsingChromium&&this._elementToAttachTo.removeEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)),this._pointerInputClearObserver&&this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver),this._eventsAttached=!1}_checkForConnectedDevices(){if(navigator.getGamepads){const e=navigator.getGamepads();for(const t of e)t&&this._addGamePad(t)}"function"===typeof matchMedia&&matchMedia("(pointer:fine)").matches&&this._addPointerDevice(C.Mouse,0,0,0)}_addGamePad(e){const t=this._getGamepadDeviceType(e.id),i=e.index;this._gamepads=this._gamepads||new Array(e.index+1),this._registerDevice(t,i,e.buttons.length+e.axes.length),this._gamepads[i]=t}_addPointerDevice(e,t,i,r){this._pointerActive||(this._pointerActive=!0),this._registerDevice(e,t,L);const s=this._inputs[e][t];s[0]=i,s[1]=r}_registerDevice(e,t,i){if(void 0===t)throw`Unable to register device ${C[e]} to undefined slot.`;if(this._inputs[e]||(this._inputs[e]={}),!this._inputs[e][t]){const r=new Array(i);r.fill(0),this._inputs[e][t]=r,this._onDeviceConnected(e,t)}}_unregisterDevice(e,t){this._inputs[e][t]&&(delete this._inputs[e][t],this._onDeviceDisconnected(e,t))}_handleKeyActions(){this._keyboardDownEvent=e=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(C.Keyboard,0,255));const t=this._inputs[C.Keyboard][0];if(t){t[e.keyCode]=1;const i=e;i.inputIndex=e.keyCode,this._usingMacOS&&e.metaKey&&"Meta"!==e.key&&(this._metaKeys.includes(e.keyCode)||this._metaKeys.push(e.keyCode)),this._onInputChanged(C.Keyboard,0,i)}},this._keyboardUpEvent=e=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(C.Keyboard,0,255));const t=this._inputs[C.Keyboard][0];if(t){t[e.keyCode]=0;const i=e;if(i.inputIndex=e.keyCode,this._usingMacOS&&"Meta"===e.key&&this._metaKeys.length>0){for(const e of this._metaKeys){const i=w.CreateDeviceEvent(C.Keyboard,0,e,0,this,this._elementToAttachTo);t[e]=0,this._onInputChanged(C.Keyboard,0,i)}this._metaKeys.splice(0,this._metaKeys.length)}this._onInputChanged(C.Keyboard,0,i)}},this._keyboardBlurEvent=()=>{if(this._keyboardActive){const e=this._inputs[C.Keyboard][0];for(let t=0;t<e.length;t++)if(0!==e[t]){e[t]=0;const i=w.CreateDeviceEvent(C.Keyboard,0,t,0,this,this._elementToAttachTo);this._onInputChanged(C.Keyboard,0,i)}this._usingMacOS&&this._metaKeys.splice(0,this._metaKeys.length)}},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)}_handlePointerActions(){this._maxTouchPoints=(0,v.XD)()&&navigator.maxTouchPoints||2,this._activeTouchIds||(this._activeTouchIds=new Array(this._maxTouchPoints));for(let r=0;r<this._maxTouchPoints;r++)this._activeTouchIds[r]=-1;this._pointerMoveEvent=e=>{const t=this._getPointerType(e);let i=t===C.Mouse?0:this._activeTouchIds.indexOf(e.pointerId);if(t===C.Touch&&-1===i){const s=this._activeTouchIds.indexOf(-1);if(!(s>=0))return void r.S0.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);i=s,this._activeTouchIds[s]=e.pointerId,this._onDeviceConnected(t,i)}this._inputs[t]||(this._inputs[t]={}),this._inputs[t][i]||this._addPointerDevice(t,i,e.clientX,e.clientY);const s=this._inputs[t][i];if(s){const r=e;r.inputIndex=R.Move,s[R.Horizontal]=e.clientX,s[R.Vertical]=e.clientY,t===C.Touch&&0===s[R.LeftClick]&&(s[R.LeftClick]=1),void 0===e.pointerId&&(e.pointerId=this._mouseId),this._onInputChanged(t,i,r),this._usingSafari||-1===e.button||(r.inputIndex=e.button+2,s[e.button+2]=s[e.button+2]?0:1,this._onInputChanged(t,i,r))}},this._pointerDownEvent=e=>{const t=this._getPointerType(e);let i=t===C.Mouse?0:e.pointerId;if(t===C.Touch){let t=this._activeTouchIds.indexOf(e.pointerId);if(-1===t&&(t=this._activeTouchIds.indexOf(-1)),!(t>=0))return void r.S0.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);i=t,this._activeTouchIds[t]=e.pointerId}this._inputs[t]||(this._inputs[t]={}),this._inputs[t][i]?t===C.Touch&&this._onDeviceConnected(t,i):this._addPointerDevice(t,i,e.clientX,e.clientY);const s=this._inputs[t][i];if(s){const r=s[R.Horizontal],a=s[R.Vertical];if(t===C.Mouse){if(void 0===e.pointerId&&(e.pointerId=this._mouseId),!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(this._mouseId)}catch(n){}}else if(e.pointerId&&!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(e.pointerId)}catch(n){}s[R.Horizontal]=e.clientX,s[R.Vertical]=e.clientY,s[e.button+2]=1;const o=e;o.inputIndex=e.button+2,this._onInputChanged(t,i,o),r===e.clientX&&a===e.clientY||(o.inputIndex=R.Move,this._onInputChanged(t,i,o))}},this._pointerUpEvent=e=>{const t=this._getPointerType(e),i=t===C.Mouse?0:this._activeTouchIds.indexOf(e.pointerId);if(t===C.Touch){if(-1===i)return;this._activeTouchIds[i]=-1}const r=this._inputs[t]?.[i];if(r&&0!==r[e.button+2]){const s=r[R.Horizontal],n=r[R.Vertical];r[R.Horizontal]=e.clientX,r[R.Vertical]=e.clientY,r[e.button+2]=0;const a=e;void 0===e.pointerId&&(e.pointerId=this._mouseId),s===e.clientX&&n===e.clientY||(a.inputIndex=R.Move,this._onInputChanged(t,i,a)),a.inputIndex=e.button+2,t===C.Mouse&&this._mouseId>=0&&this._elementToAttachTo.hasPointerCapture?.(this._mouseId)?this._elementToAttachTo.releasePointerCapture(this._mouseId):e.pointerId&&this._elementToAttachTo.hasPointerCapture?.(e.pointerId)&&this._elementToAttachTo.releasePointerCapture(e.pointerId),this._onInputChanged(t,i,a),t===C.Touch&&this._onDeviceDisconnected(t,i)}},this._pointerCancelEvent=e=>{if("mouse"===e.pointerType){const e=this._inputs[C.Mouse][0];this._mouseId>=0&&this._elementToAttachTo.hasPointerCapture?.(this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let t=R.LeftClick;t<=R.BrowserForward;t++)if(1===e[t]){e[t]=0;const i=w.CreateDeviceEvent(C.Mouse,0,t,0,this,this._elementToAttachTo);this._onInputChanged(C.Mouse,0,i)}}else{const t=this._activeTouchIds.indexOf(e.pointerId);if(-1===t)return;this._elementToAttachTo.hasPointerCapture?.(e.pointerId)&&this._elementToAttachTo.releasePointerCapture(e.pointerId),this._inputs[C.Touch][t][R.LeftClick]=0;const i=w.CreateDeviceEvent(C.Touch,t,R.LeftClick,0,this,this._elementToAttachTo,e.pointerId);this._onInputChanged(C.Touch,t,i),this._activeTouchIds[t]=-1,this._onDeviceDisconnected(C.Touch,t)}},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";let e=!1;const t=function(){};try{const i=Object.defineProperty({},"passive",{get:function(){e=!0}});this._elementToAttachTo.addEventListener("test",t,i),this._elementToAttachTo.removeEventListener("test",t,i)}catch(i){}this._pointerBlurEvent=()=>{if(this.isDeviceAvailable(C.Mouse)){const e=this._inputs[C.Mouse][0];this._mouseId>=0&&this._elementToAttachTo.hasPointerCapture?.(this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let t=R.LeftClick;t<=R.BrowserForward;t++)if(1===e[t]){e[t]=0;const i=w.CreateDeviceEvent(C.Mouse,0,t,0,this,this._elementToAttachTo);this._onInputChanged(C.Mouse,0,i)}}if(this.isDeviceAvailable(C.Touch)){const e=this._inputs[C.Touch];for(let t=0;t<this._activeTouchIds.length;t++){const i=this._activeTouchIds[t];if(this._elementToAttachTo.hasPointerCapture?.(i)&&this._elementToAttachTo.releasePointerCapture(i),-1!==i&&1===e[t]?.[R.LeftClick]){e[t][R.LeftClick]=0;const r=w.CreateDeviceEvent(C.Touch,t,R.LeftClick,0,this,this._elementToAttachTo,i);this._onInputChanged(C.Touch,t,r),this._activeTouchIds[t]=-1,this._onDeviceDisconnected(C.Touch,t)}}}},this._pointerWheelEvent=e=>{const t=C.Mouse;this._inputs[t]||(this._inputs[t]=[]),this._inputs[t][0]||(this._pointerActive=!0,this._registerDevice(t,0,L));const i=this._inputs[t][0];if(i){i[R.MouseWheelX]=e.deltaX||0,i[R.MouseWheelY]=e.deltaY||e.wheelDelta||0,i[R.MouseWheelZ]=e.deltaZ||0;const r=e;void 0===e.pointerId&&(e.pointerId=this._mouseId),0!==i[R.MouseWheelX]&&(r.inputIndex=R.MouseWheelX,this._onInputChanged(t,0,r)),0!==i[R.MouseWheelY]&&(r.inputIndex=R.MouseWheelY,this._onInputChanged(t,0,r)),0!==i[R.MouseWheelZ]&&(r.inputIndex=R.MouseWheelZ,this._onInputChanged(t,0,r))}},this._usingMacOS&&this._isUsingChromium&&(this._pointerMacOSChromeOutEvent=e=>{e.buttons>1&&this._pointerCancelEvent(e)},this._elementToAttachTo.addEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent)),this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,!!e&&{passive:!1}),this._pointerInputClearObserver=this._engine.onEndFrameObservable.add((()=>{if(this.isDeviceAvailable(C.Mouse)){const e=this._inputs[C.Mouse][0];e[R.MouseWheelX]=0,e[R.MouseWheelY]=0,e[R.MouseWheelZ]=0}}))}_handleGamepadActions(){this._gamepadConnectedEvent=e=>{this._addGamePad(e.gamepad)},this._gamepadDisconnectedEvent=e=>{if(this._gamepads){const t=this._getGamepadDeviceType(e.gamepad.id),i=e.gamepad.index;this._unregisterDevice(t,i),delete this._gamepads[i]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)}_updateDevice(e,t,i){const r=navigator.getGamepads()[t];if(r&&e===this._gamepads[t]){const s=this._inputs[e][t];i>=r.buttons.length?s[i]=r.axes[i-r.buttons.length].valueOf():s[i]=r.buttons[i].value}}_getGamepadDeviceType(e){return-1!==e.indexOf("054c")?-1!==e.indexOf("0ce6")?C.DualSense:C.DualShock:-1!==e.indexOf("Xbox One")||-1!==e.search("Xbox 360")||-1!==e.search("xinput")?C.Xbox:-1!==e.indexOf("057e")?C.Switch:C.Generic}_getPointerType(e){let t=C.Mouse;return("touch"===e.pointerType||"pen"===e.pointerType||e.touches)&&(t=C.Touch),t}}class N{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.deviceType=t,this.deviceSlot=i,this.onInputChangedObservable=new n.cP,this._deviceInputSystem=e}getInput(e){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,e)}}class k{constructor(e){this._registeredManagers=new Array,this._refCount=0,this.registerManager=e=>{for(let t=0;t<this._devices.length;t++){const i=this._devices[t];for(const r in i){const i=+r;e._addDevice(new N(this._deviceInputSystem,t,i))}}this._registeredManagers.push(e)},this.unregisterManager=e=>{const t=this._registeredManagers.indexOf(e);t>-1&&this._registeredManagers.splice(t,1)};const t=Object.keys(C).length/2;this._devices=new Array(t);const i=(e,t)=>{this._devices[e]||(this._devices[e]=new Array),this._devices[e][t]||(this._devices[e][t]=t);for(const i of this._registeredManagers){const r=new N(this._deviceInputSystem,e,t);i._addDevice(r)}},r=(e,t)=>{this._devices[e]?.[t]&&delete this._devices[e][t];for(const i of this._registeredManagers)i._removeDevice(e,t)},s=(e,t,i)=>{if(i)for(const r of this._registeredManagers)r._onInputChanged(e,t,i)};"undefined"!==typeof _native?this._deviceInputSystem=new F(i,r,s):this._deviceInputSystem=new B(e,i,r,s)}dispose(){this._deviceInputSystem.dispose()}}class U{getDeviceSource(e,t){if(void 0===t){if(void 0===this._firstDevice[e])return null;t=this._firstDevice[e]}return this._devices[e]&&void 0!==this._devices[e][t]?this._devices[e][t]:null}getDeviceSources(e){return this._devices[e]?this._devices[e].filter((e=>!!e)):[]}constructor(e){const t=Object.keys(C).length/2;this._devices=new Array(t),this._firstDevice=new Array(t),this._engine=e,this._engine._deviceSourceManager||(this._engine._deviceSourceManager=new k(e)),this._engine._deviceSourceManager._refCount++,this.onDeviceConnectedObservable=new n.cP((e=>{for(const t of this._devices)if(t)for(const i of t)i&&this.onDeviceConnectedObservable.notifyObserver(e,i)})),this.onDeviceDisconnectedObservable=new n.cP,this._engine._deviceSourceManager.registerManager(this),this._onDisposeObserver=e.onDisposeObservable.add((()=>{this.dispose()}))}dispose(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._engine._deviceSourceManager&&(this._engine._deviceSourceManager.unregisterManager(this),--this._engine._deviceSourceManager._refCount<1&&(this._engine._deviceSourceManager.dispose(),delete this._engine._deviceSourceManager)),this._engine.onDisposeObservable.remove(this._onDisposeObserver)}_addDevice(e){this._devices[e.deviceType]||(this._devices[e.deviceType]=new Array),this._devices[e.deviceType][e.deviceSlot]||(this._devices[e.deviceType][e.deviceSlot]=e,this._updateFirstDevices(e.deviceType)),this.onDeviceConnectedObservable.notifyObservers(e)}_removeDevice(e,t){const i=this._devices[e]?.[t];this.onDeviceDisconnectedObservable.notifyObservers(i),this._devices[e]?.[t]&&delete this._devices[e][t],this._updateFirstDevices(e)}_onInputChanged(e,t,i){this._devices[e]?.[t]?.onInputChangedObservable.notifyObservers(i)}_updateFirstDevices(e){switch(e){case C.Keyboard:case C.Mouse:this._firstDevice[e]=0;break;case C.Touch:case C.DualSense:case C.DualShock:case C.Xbox:case C.Switch:case C.Generic:{delete this._firstDevice[e];const t=this._devices[e];if(t)for(let i=0;i<t.length;i++)if(t[i]){this._firstDevice[e]=i;break}break}}}}class V{constructor(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}get singleClick(){return this._singleClick}get doubleClick(){return this._doubleClick}get hasSwiped(){return this._hasSwiped}get ignore(){return this._ignore}set singleClick(e){this._singleClick=e}set doubleClick(e){this._doubleClick=e}set hasSwiped(e){this._hasSwiped=e}set ignore(e){this._ignore=e}}class z{constructor(e){this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._totalPointersPressed=0,this._doubleClickOccured=!1,this._isSwiping=!1,this._swipeButtonPressed=-1,this._skipPointerTap=!1,this._isMultiTouchGesture=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new h.I9(0,0),this._previousStartingPointerPosition=new h.I9(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._movePointerInfo=null,this._cameraObserverCount=0,this._delayedClicks=[null,null,null,null,null],this._deviceSourceManager=null,this._scene=e||y.q.LastCreatedScene,this._scene}get meshUnderPointer(){return this._movePointerInfo&&(this._movePointerInfo._generatePickInfo(),this._movePointerInfo=null),this._pointerOverMesh}getMeshUnderPointerByPointerId(e){return this._meshUnderPointerId[e]||null}get unTranslatedPointer(){return new h.I9(this._unTranslatedPointerX,this._unTranslatedPointerY)}get pointerX(){return this._pointerX}set pointerX(e){this._pointerX=e}get pointerY(){return this._pointerY}set pointerY(e){this._pointerY=e}_updatePointerPosition(e){const t=this._scene.getEngine().getInputElementClientRect();t&&(this._pointerX=e.clientX-t.left,this._pointerY=e.clientY-t.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)}_processPointerMove(e,t){const i=this._scene,r=i.getEngine(),s=r.getInputElement();s&&(s.tabIndex=r.canvasTabIndex,i.doNotHandleCursors||(s.style.cursor=i.defaultCursor)),this._setCursorAndPointerOverMesh(e,t,i);for(const o of i._pointerMoveStage){e=e||this._pickMove(t);const i=!!e?.pickedMesh;e=o.action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,i,s)}const n=t.inputIndex>=R.MouseWheelX&&t.inputIndex<=R.MouseWheelZ?x.Zp.POINTERWHEEL:x.Zp.POINTERMOVE;let a;i.onPointerMove&&(e=e||this._pickMove(t),i.onPointerMove(t,e,n)),e?(a=new x.mx(n,t,e),this._setRayOnPointerInfo(e,t)):(a=new x.mx(n,t,null,this),this._movePointerInfo=a),i.onPointerObservable.hasObservers()&&i.onPointerObservable.notifyObservers(a,n)}_setRayOnPointerInfo(e,t){const i=this._scene;e&&i._pickingAvailable&&(e.ray||(e.ray=i.createPickingRay(t.offsetX,t.offsetY,h.uq.Identity(),i.activeCamera)))}_addCameraPointerObserver(e,t){return this._cameraObserverCount++,this._scene.onPointerObservable.add(e,t)}_removeCameraPointerObserver(e){return this._cameraObserverCount--,this._scene.onPointerObservable.remove(e)}_checkForPicking(){return!!(this._scene.onPointerObservable.observers.length>this._cameraObserverCount||this._scene.onPointerPick)}_checkPrePointerObservable(e,t,i){const r=this._scene,s=new x.tT(i,t,this._unTranslatedPointerX,this._unTranslatedPointerY);return e&&(s.originalPickingInfo=e,s.ray=e.ray,"xr-near"===t.pointerType&&e.originMesh&&(s.nearInteractionPickingInfo=e)),r.onPrePointerObservable.notifyObservers(s,i),!!s.skipOnPointerObservable}_pickMove(e){const t=this._scene,i=t.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,t.pointerMovePredicate,t.pointerMoveFastCheck,t.cameraToUseForPointers,t.pointerMoveTrianglePredicate);return this._setCursorAndPointerOverMesh(i,e,t),i}_setCursorAndPointerOverMesh(e,t,i){const r=i.getEngine().getInputElement();if(e?.pickedMesh){if(this.setPointerOverMesh(e.pickedMesh,t.pointerId,e,t),!i.doNotHandleCursors&&r&&this._pointerOverMesh){const e=this._pointerOverMesh._getActionManagerForTrigger();e&&e.hasPointerTriggers&&(r.style.cursor=e.hoverCursor||i.hoverCursor)}}else this.setPointerOverMesh(null,t.pointerId,e,t)}simulatePointerMove(e,t){const i=new PointerEvent("pointermove",t);i.inputIndex=R.Move,this._checkPrePointerObservable(e,i,x.Zp.POINTERMOVE)||this._processPointerMove(e,i)}simulatePointerDown(e,t){const i=new PointerEvent("pointerdown",t);i.inputIndex=i.button+2,this._checkPrePointerObservable(e,i,x.Zp.POINTERDOWN)||this._processPointerDown(e,i)}_processPointerDown(e,t){const i=this._scene;if(e?.pickedMesh){this._pickedDownMesh=e.pickedMesh;const r=e.pickedMesh._getActionManagerForTrigger();if(r){if(r.hasPickTriggers)switch(r.processTrigger(5,f.CreateNew(e.pickedMesh,t,e)),t.button){case 0:r.processTrigger(2,f.CreateNew(e.pickedMesh,t,e));break;case 1:r.processTrigger(4,f.CreateNew(e.pickedMesh,t,e));break;case 2:r.processTrigger(3,f.CreateNew(e.pickedMesh,t,e))}r.hasSpecificTrigger(8)&&window.setTimeout((()=>{const e=i.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,(e=>e.isPickable&&e.isVisible&&e.isReady()&&e.actionManager&&e.actionManager.hasSpecificTrigger(8)&&e===this._pickedDownMesh),!1,i.cameraToUseForPointers);e?.pickedMesh&&r&&0!==this._totalPointersPressed&&Date.now()-this._startingPointerTime>z.LongPressDelay&&!this._isPointerSwiping()&&(this._startingPointerTime=0,r.processTrigger(8,f.CreateNew(e.pickedMesh,t)))}),z.LongPressDelay)}}else for(const n of i._pointerDownStage)e=n.action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,t,!1);let r;const s=x.Zp.POINTERDOWN;e?(i.onPointerDown&&i.onPointerDown(t,e,s),r=new x.mx(s,t,e),this._setRayOnPointerInfo(e,t)):r=new x.mx(s,t,null,this),i.onPointerObservable.hasObservers()&&i.onPointerObservable.notifyObservers(r,s)}_isPointerSwiping(){return this._isSwiping}simulatePointerUp(e,t,i){const r=new PointerEvent("pointerup",t);r.inputIndex=R.Move;const s=new V;i?s.doubleClick=!0:s.singleClick=!0,this._checkPrePointerObservable(e,r,x.Zp.POINTERUP)||this._processPointerUp(e,r,s)}_processPointerUp(e,t,i){const r=this._scene;if(e?.pickedMesh){if(this._pickedUpMesh=e.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(r.onPointerPick&&r.onPointerPick(t,e),i.singleClick&&!i.ignore&&r.onPointerObservable.observers.length>this._cameraObserverCount)){const i=x.Zp.POINTERPICK,s=new x.mx(i,t,e);this._setRayOnPointerInfo(e,t),r.onPointerObservable.notifyObservers(s,i)}const s=e.pickedMesh._getActionManagerForTrigger();if(s&&!i.ignore){s.processTrigger(7,f.CreateNew(e.pickedMesh,t,e)),!i.hasSwiped&&i.singleClick&&s.processTrigger(1,f.CreateNew(e.pickedMesh,t,e));const r=e.pickedMesh._getActionManagerForTrigger(6);i.doubleClick&&r&&r.processTrigger(6,f.CreateNew(e.pickedMesh,t,e))}}else if(!i.ignore)for(const s of r._pointerUpStage)e=s.action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,t,i.doubleClick);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){const e=this._pickedDownMesh._getActionManagerForTrigger(16);e&&e.processTrigger(16,f.CreateNew(this._pickedDownMesh,t))}if(!i.ignore){const s=new x.mx(x.Zp.POINTERUP,t,e);if(this._setRayOnPointerInfo(e,t),r.onPointerObservable.notifyObservers(s,x.Zp.POINTERUP),r.onPointerUp&&r.onPointerUp(t,e,x.Zp.POINTERUP),!i.hasSwiped&&!this._skipPointerTap&&!this._isMultiTouchGesture){let s=0;if(i.singleClick?s=x.Zp.POINTERTAP:i.doubleClick&&(s=x.Zp.POINTERDOUBLETAP),s){const i=new x.mx(s,t,e);r.onPointerObservable.hasObservers()&&r.onPointerObservable.hasSpecificMask(s)&&r.onPointerObservable.notifyObservers(i,s)}}}}isPointerCaptured(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._pointerCaptures[e]}attachControl(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const s=this._scene,n=s.getEngine();r||(r=n.getInputElement()),this._alreadyAttached&&this.detachControl(),r&&(this._alreadyAttachedTo=r),this._deviceSourceManager=new U(n),this._initActionManager=e=>{if(!this._meshPickProceed){const t=s.skipPointerUpPicking||0===s._registeredActions&&!this._checkForPicking()&&!s.onPointerUp?null:s.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,s.pointerUpPredicate,s.pointerUpFastCheck,s.cameraToUseForPointers,s.pointerUpTrianglePredicate);this._currentPickResult=t,t&&(e=t.hit&&t.pickedMesh?t.pickedMesh._getActionManagerForTrigger():null),this._meshPickProceed=!0}return e},this._delayedSimpleClick=(e,t,i)=>{if((Date.now()-this._previousStartingPointerTime>z.DoubleClickDelay&&!this._doubleClickOccured||e!==this._previousButtonPressed)&&(this._doubleClickOccured=!1,t.singleClick=!0,t.ignore=!1,this._delayedClicks[e])){const t=this._delayedClicks[e].evt,i=x.Zp.POINTERTAP,r=new x.mx(i,t,this._currentPickResult);s.onPointerObservable.hasObservers()&&s.onPointerObservable.hasSpecificMask(i)&&s.onPointerObservable.notifyObservers(r,i),this._delayedClicks[e]=null}},this._initClickEvent=(e,t,i,r)=>{const s=new V;this._currentPickResult=null;let n=null,a=e.hasSpecificMask(x.Zp.POINTERPICK)||t.hasSpecificMask(x.Zp.POINTERPICK)||e.hasSpecificMask(x.Zp.POINTERTAP)||t.hasSpecificMask(x.Zp.POINTERTAP)||e.hasSpecificMask(x.Zp.POINTERDOUBLETAP)||t.hasSpecificMask(x.Zp.POINTERDOUBLETAP);!a&&A&&(n=this._initActionManager(n,s),n&&(a=n.hasPickTriggers));let o=!1;if(a){const a=i.button;if(s.hasSwiped=this._isPointerSwiping(),!s.hasSwiped){let l=!z.ExclusiveDoubleClickMode;if(l||(l=!e.hasSpecificMask(x.Zp.POINTERDOUBLETAP)&&!t.hasSpecificMask(x.Zp.POINTERDOUBLETAP),l&&!A.HasSpecificTrigger(6)&&(n=this._initActionManager(n,s),n&&(l=!n.hasSpecificTrigger(6)))),l)(Date.now()-this._previousStartingPointerTime>z.DoubleClickDelay||a!==this._previousButtonPressed)&&(s.singleClick=!0,r(s,this._currentPickResult),o=!0);else{const e={evt:i,clickInfo:s,timeoutId:window.setTimeout(this._delayedSimpleClick.bind(this,a,s,r),z.DoubleClickDelay)};this._delayedClicks[a]=e}let h=e.hasSpecificMask(x.Zp.POINTERDOUBLETAP)||t.hasSpecificMask(x.Zp.POINTERDOUBLETAP);!h&&A.HasSpecificTrigger(6)&&(n=this._initActionManager(n,s),n&&(h=n.hasSpecificTrigger(6))),h&&(a===this._previousButtonPressed&&Date.now()-this._previousStartingPointerTime<z.DoubleClickDelay&&!this._doubleClickOccured?(s.hasSwiped||this._isPointerSwiping()?(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=a,z.ExclusiveDoubleClickMode?(this._delayedClicks[a]&&(clearTimeout(this._delayedClicks[a]?.timeoutId),this._delayedClicks[a]=null),r(s,this._previousPickResult)):r(s,this._currentPickResult)):(this._previousStartingPointerTime=0,this._doubleClickOccured=!0,s.doubleClick=!0,s.ignore=!1,z.ExclusiveDoubleClickMode&&this._delayedClicks[a]&&(clearTimeout(this._delayedClicks[a]?.timeoutId),this._delayedClicks[a]=null),r(s,this._currentPickResult)),o=!0):(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=a))}}o||r(s,this._currentPickResult)},this._onPointerMove=e=>{if(this._updatePointerPosition(e),this._isSwiping||-1===this._swipeButtonPressed||(this._isSwiping=Math.abs(this._startingPointerPosition.x-this._pointerX)>z.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>z.DragMovementThreshold),n.isPointerLock&&n._verifyPointerLock(),this._checkPrePointerObservable(null,e,e.inputIndex>=R.MouseWheelX&&e.inputIndex<=R.MouseWheelZ?x.Zp.POINTERWHEEL:x.Zp.POINTERMOVE))return;if(!s.cameraToUseForPointers&&!s.activeCamera)return;if(s.skipPointerMovePicking)return void this._processPointerMove(new p.G,e);s.pointerMovePredicate||(s.pointerMovePredicate=e=>e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(e.enablePointerMoveEvents||s.constantlyUpdateMeshUnderPointer||null!==e._getActionManagerForTrigger())&&(!s.cameraToUseForPointers||0!==(s.cameraToUseForPointers.layerMask&e.layerMask)));const t=s._registeredActions>0||s.constantlyUpdateMeshUnderPointer?this._pickMove(e):null;this._processPointerMove(t,e)},this._onPointerDown=e=>{if(this._totalPointersPressed++,this._pickedDownMesh=null,this._meshPickProceed=!1,z.ExclusiveDoubleClickMode)for(let i=0;i<this._delayedClicks.length;i++)if(this._delayedClicks[i])if(e.button===i)clearTimeout(this._delayedClicks[i]?.timeoutId);else{const e=this._delayedClicks[i].clickInfo;this._doubleClickOccured=!1,e.singleClick=!0,e.ignore=!1;const t=this._delayedClicks[i].evt,r=x.Zp.POINTERTAP,n=new x.mx(r,t,this._currentPickResult);s.onPointerObservable.hasObservers()&&s.onPointerObservable.hasSpecificMask(r)&&s.onPointerObservable.notifyObservers(n,r),this._delayedClicks[i]=null}if(this._updatePointerPosition(e),-1===this._swipeButtonPressed&&(this._swipeButtonPressed=e.button),s.preventDefaultOnPointerDown&&r&&(e.preventDefault(),r.focus()),this._startingPointerPosition.x=this._pointerX,this._startingPointerPosition.y=this._pointerY,this._startingPointerTime=Date.now(),this._checkPrePointerObservable(null,e,x.Zp.POINTERDOWN))return;if(!s.cameraToUseForPointers&&!s.activeCamera)return;let t;this._pointerCaptures[e.pointerId]=!0,s.pointerDownPredicate||(s.pointerDownPredicate=e=>e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(!s.cameraToUseForPointers||0!==(s.cameraToUseForPointers.layerMask&e.layerMask))),this._pickedDownMesh=null,t=s.skipPointerDownPicking||0===s._registeredActions&&!this._checkForPicking()&&!s.onPointerDown?new p.G:s.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,s.pointerDownPredicate,s.pointerDownFastCheck,s.cameraToUseForPointers,s.pointerDownTrianglePredicate),this._processPointerDown(t,e)},this._onPointerUp=e=>{0!==this._totalPointersPressed&&(this._totalPointersPressed--,this._pickedUpMesh=null,this._meshPickProceed=!1,this._updatePointerPosition(e),s.preventDefaultOnPointerUp&&r&&(e.preventDefault(),r.focus()),this._initClickEvent(s.onPrePointerObservable,s.onPointerObservable,e,((t,i)=>{if(s.onPrePointerObservable.hasObservers()&&(this._skipPointerTap=!1,!t.ignore)){if(this._checkPrePointerObservable(null,e,x.Zp.POINTERUP))return this._swipeButtonPressed===e.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1),void(0===e.buttons&&(this._pointerCaptures[e.pointerId]=!1));t.hasSwiped||(t.singleClick&&s.onPrePointerObservable.hasSpecificMask(x.Zp.POINTERTAP)&&this._checkPrePointerObservable(null,e,x.Zp.POINTERTAP)&&(this._skipPointerTap=!0),t.doubleClick&&s.onPrePointerObservable.hasSpecificMask(x.Zp.POINTERDOUBLETAP)&&this._checkPrePointerObservable(null,e,x.Zp.POINTERDOUBLETAP)&&(this._skipPointerTap=!0))}this._pointerCaptures[e.pointerId]?(0===e.buttons&&(this._pointerCaptures[e.pointerId]=!1),(s.cameraToUseForPointers||s.activeCamera)&&(s.pointerUpPredicate||(s.pointerUpPredicate=e=>e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(!s.cameraToUseForPointers||0!==(s.cameraToUseForPointers.layerMask&e.layerMask))),!this._meshPickProceed&&(A&&A.HasTriggers||this._checkForPicking()||s.onPointerUp)&&this._initActionManager(null,t),i||(i=this._currentPickResult),this._processPointerUp(i,e,t),this._previousPickResult=this._currentPickResult,this._swipeButtonPressed===e.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1))):this._swipeButtonPressed===e.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1)})))},this._onKeyDown=e=>{const t=O.TB.KEYDOWN;if(s.onPreKeyboardObservable.hasObservers()){const i=new O.Bu(t,e);if(s.onPreKeyboardObservable.notifyObservers(i,t),i.skipOnKeyboardObservable)return}if(s.onKeyboardObservable.hasObservers()){const i=new O.W0(t,e);s.onKeyboardObservable.notifyObservers(i,t)}s.actionManager&&s.actionManager.processTrigger(14,f.CreateNewFromScene(s,e))},this._onKeyUp=e=>{const t=O.TB.KEYUP;if(s.onPreKeyboardObservable.hasObservers()){const i=new O.Bu(t,e);if(s.onPreKeyboardObservable.notifyObservers(i,t),i.skipOnKeyboardObservable)return}if(s.onKeyboardObservable.hasObservers()){const i=new O.W0(t,e);s.onKeyboardObservable.notifyObservers(i,t)}s.actionManager&&s.actionManager.processTrigger(15,f.CreateNewFromScene(s,e))},this._deviceSourceManager.onDeviceConnectedObservable.add((r=>{r.deviceType===C.Mouse?r.onInputChangedObservable.add((s=>{this._originMouseEvent=s,s.inputIndex===R.LeftClick||s.inputIndex===R.MiddleClick||s.inputIndex===R.RightClick||s.inputIndex===R.BrowserBack||s.inputIndex===R.BrowserForward?t&&1===r.getInput(s.inputIndex)?this._onPointerDown(s):e&&0===r.getInput(s.inputIndex)&&this._onPointerUp(s):i&&(s.inputIndex===R.Move?this._onPointerMove(s):s.inputIndex!==R.MouseWheelX&&s.inputIndex!==R.MouseWheelY&&s.inputIndex!==R.MouseWheelZ||this._onPointerMove(s))})):r.deviceType===C.Touch?r.onInputChangedObservable.add((s=>{s.inputIndex===R.LeftClick&&(t&&1===r.getInput(s.inputIndex)?(this._onPointerDown(s),this._totalPointersPressed>1&&(this._isMultiTouchGesture=!0)):e&&0===r.getInput(s.inputIndex)&&(this._onPointerUp(s),0===this._totalPointersPressed&&(this._isMultiTouchGesture=!1))),i&&s.inputIndex===R.Move&&this._onPointerMove(s)})):r.deviceType===C.Keyboard&&r.onInputChangedObservable.add((e=>{"keydown"===e.type?this._onKeyDown(e):"keyup"===e.type&&this._onKeyUp(e)}))})),this._alreadyAttached=!0}detachControl(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)}setPointerOverMesh(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(this._meshUnderPointerId[t]===e&&(!e||!e._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting))return;const s=this._meshUnderPointerId[t];let n;s&&(n=s._getActionManagerForTrigger(10),n&&n.processTrigger(10,f.CreateNew(s,r,{pointerId:t}))),e?(this._meshUnderPointerId[t]=e,this._pointerOverMesh=e,n=e._getActionManagerForTrigger(9),n&&n.processTrigger(9,f.CreateNew(e,r,{pointerId:t,pickResult:i}))):(delete this._meshUnderPointerId[t],this._pointerOverMesh=null)}getPointerOverMesh(){return this.meshUnderPointer}_invalidateMesh(e){this._pointerOverMesh===e&&(this._pointerOverMesh=null),this._pickedDownMesh===e&&(this._pickedDownMesh=null),this._pickedUpMesh===e&&(this._pickedUpMesh=null);for(const t in this._meshUnderPointerId)this._meshUnderPointerId[t]===e&&delete this._meshUnderPointerId[t]}}z.DragMovementThreshold=10,z.LongPressDelay=500,z.DoubleClickDelay=300,z.ExclusiveDoubleClickMode=!1;var G=i(3341),H=i(6760),W=i(1989),q=i(1179),X=i(242),K=i(5556),Y=i(4654);class j{constructor(){this.pointerDownFastCheck=!1,this.pointerUpFastCheck=!1,this.pointerMoveFastCheck=!1,this.skipPointerMovePicking=!1,this.skipPointerDownPicking=!1,this.skipPointerUpPicking=!1}}var Q,$=i(8274);!function(e){e[e.BackwardCompatible=0]="BackwardCompatible",e[e.Intermediate=1]="Intermediate",e[e.Aggressive=2]="Aggressive"}(Q||(Q={}));class Z extends u{static DefaultMaterialFactory(e){throw(0,T.n)("StandardMaterial")}static CollisionCoordinatorFactory(){throw(0,T.n)("DefaultCollisionCoordinator")}get environmentTexture(){return this._environmentTexture}set environmentTexture(e){this._environmentTexture!==e&&(this._environmentTexture=e,this.markAllMaterialsAsDirty(1))}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}get performancePriority(){return this._performancePriority}set performancePriority(e){if(e!==this._performancePriority){switch(this._performancePriority=e,e){case 0:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.skipPointerMovePicking=!1,this.autoClear=!0;break;case 1:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.skipPointerMovePicking=!0,this.autoClear=!1;break;case 2:this.skipFrustumClipping=!0,this._renderingManager.maintainStateBetweenFrames=!0,this.skipPointerMovePicking=!0,this.autoClear=!1}this.onScenePerformancePriorityChangedObservable.notifyObservers(e)}}set forceWireframe(e){this._forceWireframe!==e&&(this._forceWireframe=e,this.markAllMaterialsAsDirty(16))}get forceWireframe(){return this._forceWireframe}set skipFrustumClipping(e){this._skipFrustumClipping!==e&&(this._skipFrustumClipping=e)}get skipFrustumClipping(){return this._skipFrustumClipping}set forcePointsCloud(e){this._forcePointsCloud!==e&&(this._forcePointsCloud=e,this.markAllMaterialsAsDirty(16))}get forcePointsCloud(){return this._forcePointsCloud}get animationPropertiesOverride(){return this._animationPropertiesOverride}set animationPropertiesOverride(e){this._animationPropertiesOverride=e}set onDispose(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}set beforeRender(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),e&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e))}set afterRender(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),e&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(e))}set beforeCameraRender(e){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(e)}set afterCameraRender(e){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(e)}get pointerDownPredicate(){return this._pointerPickingConfiguration.pointerDownPredicate}set pointerDownPredicate(e){this._pointerPickingConfiguration.pointerDownPredicate=e}get pointerUpPredicate(){return this._pointerPickingConfiguration.pointerUpPredicate}set pointerUpPredicate(e){this._pointerPickingConfiguration.pointerUpPredicate=e}get pointerMovePredicate(){return this._pointerPickingConfiguration.pointerMovePredicate}set pointerMovePredicate(e){this._pointerPickingConfiguration.pointerMovePredicate=e}get pointerDownFastCheck(){return this._pointerPickingConfiguration.pointerDownFastCheck}set pointerDownFastCheck(e){this._pointerPickingConfiguration.pointerDownFastCheck=e}get pointerUpFastCheck(){return this._pointerPickingConfiguration.pointerUpFastCheck}set pointerUpFastCheck(e){this._pointerPickingConfiguration.pointerUpFastCheck=e}get pointerMoveFastCheck(){return this._pointerPickingConfiguration.pointerMoveFastCheck}set pointerMoveFastCheck(e){this._pointerPickingConfiguration.pointerMoveFastCheck=e}get skipPointerMovePicking(){return this._pointerPickingConfiguration.skipPointerMovePicking}set skipPointerMovePicking(e){this._pointerPickingConfiguration.skipPointerMovePicking=e}get skipPointerDownPicking(){return this._pointerPickingConfiguration.skipPointerDownPicking}set skipPointerDownPicking(e){this._pointerPickingConfiguration.skipPointerDownPicking=e}get skipPointerUpPicking(){return this._pointerPickingConfiguration.skipPointerUpPicking}set skipPointerUpPicking(e){this._pointerPickingConfiguration.skipPointerUpPicking=e}get unTranslatedPointer(){return this._inputManager.unTranslatedPointer}static get DragMovementThreshold(){return z.DragMovementThreshold}static set DragMovementThreshold(e){z.DragMovementThreshold=e}static get LongPressDelay(){return z.LongPressDelay}static set LongPressDelay(e){z.LongPressDelay=e}static get DoubleClickDelay(){return z.DoubleClickDelay}static set DoubleClickDelay(e){z.DoubleClickDelay=e}static get ExclusiveDoubleClickMode(){return z.ExclusiveDoubleClickMode}static set ExclusiveDoubleClickMode(e){z.ExclusiveDoubleClickMode=e}bindEyePosition(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vEyePosition",i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=this._forcedViewPosition?this._forcedViewPosition:this._mirroredCameraPosition?this._mirroredCameraPosition:this.activeCamera.globalPosition,s=this.useRightHandedSystem===(null!=this._mirroredCameraPosition);return h.AA.Vector4[0].set(r.x,r.y,r.z,s?-1:1),e&&(i?e.setFloat3(t,h.AA.Vector4[0].x,h.AA.Vector4[0].y,h.AA.Vector4[0].z):e.setVector4(t,h.AA.Vector4[0])),h.AA.Vector4[0]}finalizeSceneUbo(){const e=this.getSceneUniformBuffer(),t=this.bindEyePosition(null);return e.updateFloat4("vEyePosition",t.x,t.y,t.z,t.w),e.update(),e}set useRightHandedSystem(e){this._useRightHandedSystem!==e&&(this._useRightHandedSystem=e,this.markAllMaterialsAsDirty(16))}get useRightHandedSystem(){return this._useRightHandedSystem}setStepId(e){this._currentStepId=e}getStepId(){return this._currentStepId}getInternalStep(){return this._currentInternalStep}set fogEnabled(e){this._fogEnabled!==e&&(this._fogEnabled=e,this.markAllMaterialsAsDirty(16))}get fogEnabled(){return this._fogEnabled}set fogMode(e){this._fogMode!==e&&(this._fogMode=e,this.markAllMaterialsAsDirty(16))}get fogMode(){return this._fogMode}get prePass(){return!!this.prePassRenderer&&this.prePassRenderer.defaultRT.enabled}set shadowsEnabled(e){this._shadowsEnabled!==e&&(this._shadowsEnabled=e,this.markAllMaterialsAsDirty(2))}get shadowsEnabled(){return this._shadowsEnabled}set lightsEnabled(e){this._lightsEnabled!==e&&(this._lightsEnabled=e,this.markAllMaterialsAsDirty(2))}get lightsEnabled(){return this._lightsEnabled}get activeCameras(){return this._activeCameras}set activeCameras(e){this._unObserveActiveCameras&&(this._unObserveActiveCameras(),this._unObserveActiveCameras=null),e&&(this._unObserveActiveCameras=(0,Y.lL)(e,(()=>{this.onActiveCamerasChanged.notifyObservers(this)}))),this._activeCameras=e}get activeCamera(){return this._activeCamera}set activeCamera(e){e!==this._activeCamera&&(this._activeCamera=e,this.onActiveCameraChanged.notifyObservers(this))}get defaultMaterial(){return this._defaultMaterial||(this._defaultMaterial=Z.DefaultMaterialFactory(this)),this._defaultMaterial}set defaultMaterial(e){this._defaultMaterial=e}set texturesEnabled(e){this._texturesEnabled!==e&&(this._texturesEnabled=e,this.markAllMaterialsAsDirty(1))}get texturesEnabled(){return this._texturesEnabled}set skeletonsEnabled(e){this._skeletonsEnabled!==e&&(this._skeletonsEnabled=e,this.markAllMaterialsAsDirty(8))}get skeletonsEnabled(){return this._skeletonsEnabled}get collisionCoordinator(){return this._collisionCoordinator||(this._collisionCoordinator=Z.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator}get renderingManager(){return this._renderingManager}get frustumPlanes(){return this._frustumPlanes}_registerTransientComponents(){if(this._transientComponents.length>0){for(const e of this._transientComponents)e.register();this._transientComponents.length=0}}_addComponent(e){this._components.push(e),this._transientComponents.push(e);const t=e;t.addFromContainer&&t.serialize&&this._serializableComponents.push(t)}_getComponent(e){for(const t of this._components)if(t.name===e)return t;return null}constructor(e,t){super(),this._inputManager=new z(this),this.cameraToUseForPointers=null,this._isScene=!0,this._blockEntityCollection=!1,this.autoClear=!0,this.autoClearDepthAndStencil=!0,this.clearColor=new H.ov(.2,.2,.3,1),this.ambientColor=new H.v9(0,0,0),this.environmentIntensity=1,this._performancePriority=0,this.onScenePerformancePriorityChangedObservable=new n.cP,this._forceWireframe=!1,this._skipFrustumClipping=!1,this._forcePointsCloud=!1,this.animationsEnabled=!0,this._animationPropertiesOverride=null,this.useConstantAnimationDeltaTime=!1,this.constantlyUpdateMeshUnderPointer=!1,this.hoverCursor="pointer",this.defaultCursor="",this.doNotHandleCursors=!1,this.preventDefaultOnPointerDown=!0,this.preventDefaultOnPointerUp=!0,this.metadata=null,this.reservedDataStore=null,this.disableOfflineSupportExceptionRules=[],this.onDisposeObservable=new n.cP,this._onDisposeObserver=null,this.onBeforeRenderObservable=new n.cP,this._onBeforeRenderObserver=null,this.onAfterRenderObservable=new n.cP,this.onAfterRenderCameraObservable=new n.cP,this._onAfterRenderObserver=null,this.onBeforeAnimationsObservable=new n.cP,this.onAfterAnimationsObservable=new n.cP,this.onBeforeDrawPhaseObservable=new n.cP,this.onAfterDrawPhaseObservable=new n.cP,this.onReadyObservable=new n.cP,this.onBeforeCameraRenderObservable=new n.cP,this._onBeforeCameraRenderObserver=null,this.onAfterCameraRenderObservable=new n.cP,this._onAfterCameraRenderObserver=null,this.onBeforeActiveMeshesEvaluationObservable=new n.cP,this.onAfterActiveMeshesEvaluationObservable=new n.cP,this.onBeforeParticlesRenderingObservable=new n.cP,this.onAfterParticlesRenderingObservable=new n.cP,this.onDataLoadedObservable=new n.cP,this.onNewCameraAddedObservable=new n.cP,this.onCameraRemovedObservable=new n.cP,this.onNewLightAddedObservable=new n.cP,this.onLightRemovedObservable=new n.cP,this.onNewGeometryAddedObservable=new n.cP,this.onGeometryRemovedObservable=new n.cP,this.onNewTransformNodeAddedObservable=new n.cP,this.onTransformNodeRemovedObservable=new n.cP,this.onNewMeshAddedObservable=new n.cP,this.onMeshRemovedObservable=new n.cP,this.onNewSkeletonAddedObservable=new n.cP,this.onSkeletonRemovedObservable=new n.cP,this.onNewMaterialAddedObservable=new n.cP,this.onNewMultiMaterialAddedObservable=new n.cP,this.onMaterialRemovedObservable=new n.cP,this.onMultiMaterialRemovedObservable=new n.cP,this.onNewTextureAddedObservable=new n.cP,this.onTextureRemovedObservable=new n.cP,this.onBeforeRenderTargetsRenderObservable=new n.cP,this.onAfterRenderTargetsRenderObservable=new n.cP,this.onBeforeStepObservable=new n.cP,this.onAfterStepObservable=new n.cP,this.onActiveCameraChanged=new n.cP,this.onActiveCamerasChanged=new n.cP,this.onBeforeRenderingGroupObservable=new n.cP,this.onAfterRenderingGroupObservable=new n.cP,this.onMeshImportedObservable=new n.cP,this.onAnimationFileImportedObservable=new n.cP,this._registeredForLateAnimationBindings=new a.b(256),this._pointerPickingConfiguration=new j,this.onPrePointerObservable=new n.cP,this.onPointerObservable=new n.cP,this.onPreKeyboardObservable=new n.cP,this.onKeyboardObservable=new n.cP,this._useRightHandedSystem=!1,this._timeAccumulator=0,this._currentStepId=0,this._currentInternalStep=0,this._fogEnabled=!0,this._fogMode=Z.FOGMODE_NONE,this.fogColor=new H.v9(.2,.2,.3),this.fogDensity=.1,this.fogStart=0,this.fogEnd=1e3,this.needsPreviousWorldMatrices=!1,this._shadowsEnabled=!0,this._lightsEnabled=!0,this._unObserveActiveCameras=null,this._texturesEnabled=!0,this.physicsEnabled=!0,this.particlesEnabled=!0,this.spritesEnabled=!0,this._skeletonsEnabled=!0,this.lensFlaresEnabled=!0,this.collisionsEnabled=!0,this.gravity=new h.Pq(0,-9.807,0),this.postProcessesEnabled=!0,this.renderTargetsEnabled=!0,this.dumpNextRenderTargets=!1,this.customRenderTargets=[],this.importedMeshesFiles=[],this.probesEnabled=!0,this._meshesForIntersections=new a.b(256),this.proceduralTexturesEnabled=!0,this._totalVertices=new G.A,this._activeIndices=new G.A,this._activeParticles=new G.A,this._activeBones=new G.A,this._animationTime=0,this.animationTimeScale=1,this._renderId=0,this._frameId=0,this._executeWhenReadyTimeoutId=null,this._intermediateRendering=!1,this._defaultFrameBufferCleared=!1,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1,this._toBeDisposed=new Array(256),this._activeRequests=new Array,this._pendingData=new Array,this._isDisposed=!1,this.dispatchAllSubMeshesOfActiveMeshes=!1,this._activeMeshes=new a.L(256),this._processedMaterials=new a.L(256),this._renderTargets=new a.b(256),this._materialsRenderTargets=new a.b(256),this._activeParticleSystems=new a.L(256),this._activeSkeletons=new a.b(32),this._softwareSkinnedMeshes=new a.b(32),this._activeAnimatables=new Array,this._transformMatrix=h.uq.Zero(),this.requireLightSorting=!1,this._components=[],this._serializableComponents=[],this._transientComponents=[],this._beforeCameraUpdateStage=b.B.Create(),this._beforeClearStage=b.B.Create(),this._beforeRenderTargetClearStage=b.B.Create(),this._gatherRenderTargetsStage=b.B.Create(),this._gatherActiveCameraRenderTargetsStage=b.B.Create(),this._isReadyForMeshStage=b.B.Create(),this._beforeEvaluateActiveMeshStage=b.B.Create(),this._evaluateSubMeshStage=b.B.Create(),this._preActiveMeshStage=b.B.Create(),this._cameraDrawRenderTargetStage=b.B.Create(),this._beforeCameraDrawStage=b.B.Create(),this._beforeRenderTargetDrawStage=b.B.Create(),this._beforeRenderingGroupDrawStage=b.B.Create(),this._beforeRenderingMeshStage=b.B.Create(),this._afterRenderingMeshStage=b.B.Create(),this._afterRenderingGroupDrawStage=b.B.Create(),this._afterCameraDrawStage=b.B.Create(),this._afterCameraPostProcessStage=b.B.Create(),this._afterRenderTargetDrawStage=b.B.Create(),this._afterRenderTargetPostProcessStage=b.B.Create(),this._afterRenderStage=b.B.Create(),this._pointerMoveStage=b.B.Create(),this._pointerDownStage=b.B.Create(),this._pointerUpStage=b.B.Create(),this._geometriesByUniqueId=null,this._defaultMeshCandidates={data:[],length:0},this._defaultSubMeshCandidates={data:[],length:0},this._preventFreeActiveMeshesAndRenderingGroups=!1,this._activeMeshesFrozen=!1,this._activeMeshesFrozenButKeepClipping=!1,this._skipEvaluateActiveMeshesCompletely=!1,this._allowPostProcessClearColor=!0,this.getDeterministicFrameTime=()=>this._engine.getTimeStep(),this._registeredActions=0,this._blockMaterialDirtyMechanism=!1,this._perfCollector=null,this.activeCameras=[];const i={useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1,...t};e=this._engine=e||y.q.LastCreatedEngine,i.virtual?e._virtualScenes.push(this):(y.q._LastCreatedScene=this,e.scenes.push(this)),this._uid=null,this._renderingManager=new m.m(this),g.X&&(this.postProcessManager=new g.X(this)),(0,v.BA)()&&this.attachControl(),this._createUbo(),d.p&&(this._imageProcessingConfiguration=new d.p),this.setDefaultCandidateProviders(),i.useGeometryUniqueIdsMap&&(this._geometriesByUniqueId={}),this.useMaterialMeshMap=i.useMaterialMeshMap,this.useClonedMeshMap=i.useClonedMeshMap,t&&t.virtual||e.onNewSceneAddedObservable.notifyObservers(this)}getClassName(){return"Scene"}_getDefaultMeshCandidates(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates}_getDefaultSubMeshCandidates(e){return this._defaultSubMeshCandidates.data=e.subMeshes,this._defaultSubMeshCandidates.length=e.subMeshes.length,this._defaultSubMeshCandidates}setDefaultCandidateProviders(){this.getActiveMeshCandidates=()=>this._getDefaultMeshCandidates(),this.getActiveSubMeshCandidates=e=>this._getDefaultSubMeshCandidates(e),this.getIntersectingSubMeshCandidates=(e,t)=>this._getDefaultSubMeshCandidates(e),this.getCollidingSubMeshCandidates=(e,t)=>this._getDefaultSubMeshCandidates(e)}get meshUnderPointer(){return this._inputManager.meshUnderPointer}get pointerX(){return this._inputManager.pointerX}set pointerX(e){this._inputManager.pointerX=e}get pointerY(){return this._inputManager.pointerY}set pointerY(e){this._inputManager.pointerY=e}getCachedMaterial(){return this._cachedMaterial}getCachedEffect(){return this._cachedEffect}getCachedVisibility(){return this._cachedVisibility}isCachedMaterialInvalid(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return this._cachedEffect!==t||this._cachedMaterial!==e||this._cachedVisibility!==i}getEngine(){return this._engine}getTotalVertices(){return this._totalVertices.current}get totalVerticesPerfCounter(){return this._totalVertices}getActiveIndices(){return this._activeIndices.current}get totalActiveIndicesPerfCounter(){return this._activeIndices}getActiveParticles(){return this._activeParticles.current}get activeParticlesPerfCounter(){return this._activeParticles}getActiveBones(){return this._activeBones.current}get activeBonesPerfCounter(){return this._activeBones}getActiveMeshes(){return this._activeMeshes}getAnimationRatio(){return void 0!==this._animationRatio?this._animationRatio:1}getRenderId(){return this._renderId}getFrameId(){return this._frameId}incrementRenderId(){this._renderId++}_createUbo(){this.setSceneUniformBuffer(this.createSceneUniformBuffer())}simulatePointerMove(e,t){return this._inputManager.simulatePointerMove(e,t),this}simulatePointerDown(e,t){return this._inputManager.simulatePointerDown(e,t),this}simulatePointerUp(e,t,i){return this._inputManager.simulatePointerUp(e,t,i),this}isPointerCaptured(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._inputManager.isPointerCaptured(e)}attachControl(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._inputManager.attachControl(e,t,i)}detachControl(){this._inputManager.detachControl()}isReady(){let e,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this._isDisposed)return!1;const i=this.getEngine(),r=i.currentRenderPassId;i.currentRenderPassId=this.activeCamera?.renderPassId??r;let s=!0;for(this._pendingData.length>0&&(s=!1),this.prePassRenderer?.update(),this.useOrderIndependentTransparency&&this.depthPeelingRenderer&&s&&(s=this.depthPeelingRenderer.isReady()),t&&(this._processedMaterials.reset(),this._materialsRenderTargets.reset()),e=0;e<this.meshes.length;e++){const r=this.meshes[e];if(!r.subMeshes||0===r.subMeshes.length)continue;if(!r.isReady(!0)){s=!1;continue}const n=r.hasThinInstances||"InstancedMesh"===r.getClassName()||"InstancedLinesMesh"===r.getClassName()||i.getCaps().instancedArrays&&r.instances.length>0;for(const e of this._isReadyForMeshStage)e.action(r,n)||(s=!1);if(!t)continue;const a=r.material||this.defaultMaterial;if(a)if(a._storeEffectOnSubMeshes)for(const e of r.subMeshes){const t=e.getMaterial();t&&t.hasRenderTargetTextures&&null!=t.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(t)&&(this._processedMaterials.push(t),this._materialsRenderTargets.concatWithNoDuplicate(t.getRenderTargetTextures()))}else a.hasRenderTargetTextures&&null!=a.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(a)&&(this._processedMaterials.push(a),this._materialsRenderTargets.concatWithNoDuplicate(a.getRenderTargetTextures()))}if(t)for(e=0;e<this._materialsRenderTargets.length;++e){this._materialsRenderTargets.data[e].isReadyForRendering()||(s=!1)}for(e=0;e<this.geometries.length;e++){2===this.geometries[e].delayLoadState&&(s=!1)}if(this.activeCameras&&this.activeCameras.length>0)for(const n of this.activeCameras)n.isReady(!0)||(s=!1);else this.activeCamera&&(this.activeCamera.isReady(!0)||(s=!1));for(const n of this.particleSystems)n.isReady()||(s=!1);if(this.layers)for(const n of this.layers)n.isReady()||(s=!1);return i.areAllEffectsReady()||(s=!1),i.currentRenderPassId=r,s}resetCachedMaterial(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null}registerBeforeRender(e){this.onBeforeRenderObservable.add(e)}unregisterBeforeRender(e){this.onBeforeRenderObservable.removeCallback(e)}registerAfterRender(e){this.onAfterRenderObservable.add(e)}unregisterAfterRender(e){this.onAfterRenderObservable.removeCallback(e)}_executeOnceBeforeRender(e){const t=()=>{e(),setTimeout((()=>{this.unregisterBeforeRender(t)}))};this.registerBeforeRender(t)}executeOnceBeforeRender(e,t){void 0!==t?setTimeout((()=>{this._executeOnceBeforeRender(e)}),t):this._executeOnceBeforeRender(e)}addPendingData(e){this._pendingData.push(e)}removePendingData(e){const t=this.isLoading,i=this._pendingData.indexOf(e);-1!==i&&this._pendingData.splice(i,1),t&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)}getWaitingItemsCount(){return this._pendingData.length}get isLoading(){return this._pendingData.length>0}executeWhenReady(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.onReadyObservable.addOnce(e),null===this._executeWhenReadyTimeoutId&&this._checkIsReady(t)}whenReadyAsync(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise((t=>{this.executeWhenReady((()=>{t()}),e)}))}_checkIsReady(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._registerTransientComponents(),this.isReady(e)?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):void(this._executeWhenReadyTimeoutId=setTimeout((()=>{this.incrementRenderId(),this._checkIsReady(e)}),100))}get animatables(){return this._activeAnimatables}resetLastAnimationTimeFrame(){this._animationTimeLast=s.j.Now}getViewMatrix(){return this._viewMatrix}getProjectionMatrix(){return this._projectionMatrix}getTransformMatrix(){return this._transformMatrix}setTransformMatrix(e,t,i,r){i||r||!this._multiviewSceneUbo||(this._multiviewSceneUbo.dispose(),this._multiviewSceneUbo=null),this._viewUpdateFlag===e.updateFlag&&this._projectionUpdateFlag===t.updateFlag||(this._viewUpdateFlag=e.updateFlag,this._projectionUpdateFlag=t.updateFlag,this._viewMatrix=e,this._projectionMatrix=t,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?W.P.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=W.P.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(i,r):this._sceneUbo.useUbo&&(this._sceneUbo.updateMatrix("viewProjection",this._transformMatrix),this._sceneUbo.updateMatrix("view",this._viewMatrix),this._sceneUbo.updateMatrix("projection",this._projectionMatrix)))}getSceneUniformBuffer(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo}createSceneUniformBuffer(e){const t=new _.D(this._engine,void 0,!1,e??"scene");return t.addUniform("viewProjection",16),t.addUniform("view",16),t.addUniform("projection",16),t.addUniform("vEyePosition",4),t}setSceneUniformBuffer(e){this._sceneUbo=e,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1}getUniqueId(){return q.K.UniqueId}addMesh(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._blockEntityCollection||(this.meshes.push(e),e._resyncLightSources(),e.parent||e._addToSceneRootNodes(),this.onNewMeshAddedObservable.notifyObservers(e),t&&e.getChildMeshes().forEach((e=>{this.addMesh(e)})))}removeMesh(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=this.meshes.indexOf(e);return-1!==i&&(this.meshes.splice(i,1),e.parent||e._removeFromSceneRootNodes()),this._inputManager._invalidateMesh(e),this.onMeshRemovedObservable.notifyObservers(e),t&&e.getChildMeshes().forEach((e=>{this.removeMesh(e)})),i}addTransformNode(e){this._blockEntityCollection||e.getScene()===this&&-1!==e._indexInSceneTransformNodesArray||(e._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(e),e.parent||e._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(e))}removeTransformNode(e){const t=e._indexInSceneTransformNodesArray;if(-1!==t){if(t!==this.transformNodes.length-1){const e=this.transformNodes[this.transformNodes.length-1];this.transformNodes[t]=e,e._indexInSceneTransformNodesArray=t}e._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),e.parent||e._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(e),t}removeSkeleton(e){const t=this.skeletons.indexOf(e);return-1!==t&&(this.skeletons.splice(t,1),this.onSkeletonRemovedObservable.notifyObservers(e),this._executeActiveContainerCleanup(this._activeSkeletons)),t}removeMorphTargetManager(e){const t=this.morphTargetManagers.indexOf(e);return-1!==t&&this.morphTargetManagers.splice(t,1),t}removeLight(e){const t=this.lights.indexOf(e);if(-1!==t){for(const t of this.meshes)t._removeLightSource(e,!1);this.lights.splice(t,1),this.sortLightsByPriority(),e.parent||e._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(e),t}removeCamera(e){const t=this.cameras.indexOf(e);if(-1!==t&&(this.cameras.splice(t,1),e.parent||e._removeFromSceneRootNodes()),this.activeCameras){const t=this.activeCameras.indexOf(e);-1!==t&&this.activeCameras.splice(t,1)}return this.activeCamera===e&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(e),t}removeParticleSystem(e){const t=this.particleSystems.indexOf(e);return-1!==t&&(this.particleSystems.splice(t,1),this._executeActiveContainerCleanup(this._activeParticleSystems)),t}removeAnimation(e){const t=this.animations.indexOf(e);return-1!==t&&this.animations.splice(t,1),t}stopAnimation(e,t,i){}removeAnimationGroup(e){const t=this.animationGroups.indexOf(e);return-1!==t&&this.animationGroups.splice(t,1),t}removeMultiMaterial(e){const t=this.multiMaterials.indexOf(e);return-1!==t&&this.multiMaterials.splice(t,1),this.onMultiMaterialRemovedObservable.notifyObservers(e),t}removeMaterial(e){const t=e._indexInSceneMaterialArray;if(-1!==t&&t<this.materials.length){if(t!==this.materials.length-1){const e=this.materials[this.materials.length-1];this.materials[t]=e,e._indexInSceneMaterialArray=t}e._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(e),t}removeActionManager(e){const t=this.actionManagers.indexOf(e);return-1!==t&&this.actionManagers.splice(t,1),t}removeTexture(e){const t=this.textures.indexOf(e);return-1!==t&&this.textures.splice(t,1),this.onTextureRemovedObservable.notifyObservers(e),t}addLight(e){if(!this._blockEntityCollection){this.lights.push(e),this.sortLightsByPriority(),e.parent||e._addToSceneRootNodes();for(const t of this.meshes)-1===t.lightSources.indexOf(e)&&(t.lightSources.push(e),t._resyncLightSources());this.onNewLightAddedObservable.notifyObservers(e)}}sortLightsByPriority(){this.requireLightSorting&&this.lights.sort(K.c.CompareLightsPriority)}addCamera(e){this._blockEntityCollection||(this.cameras.push(e),this.onNewCameraAddedObservable.notifyObservers(e),e.parent||e._addToSceneRootNodes())}addSkeleton(e){this._blockEntityCollection||(this.skeletons.push(e),this.onNewSkeletonAddedObservable.notifyObservers(e))}addParticleSystem(e){this._blockEntityCollection||this.particleSystems.push(e)}addAnimation(e){this._blockEntityCollection||this.animations.push(e)}addAnimationGroup(e){this._blockEntityCollection||this.animationGroups.push(e)}addMultiMaterial(e){this._blockEntityCollection||(this.multiMaterials.push(e),this.onNewMultiMaterialAddedObservable.notifyObservers(e))}addMaterial(e){this._blockEntityCollection||e.getScene()===this&&-1!==e._indexInSceneMaterialArray||(e._indexInSceneMaterialArray=this.materials.length,this.materials.push(e),this.onNewMaterialAddedObservable.notifyObservers(e))}addMorphTargetManager(e){this._blockEntityCollection||this.morphTargetManagers.push(e)}addGeometry(e){this._blockEntityCollection||(this._geometriesByUniqueId&&(this._geometriesByUniqueId[e.uniqueId]=this.geometries.length),this.geometries.push(e))}addActionManager(e){this.actionManagers.push(e)}addTexture(e){this._blockEntityCollection||(this.textures.push(e),this.onNewTextureAddedObservable.notifyObservers(e))}switchActiveCamera(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._engine.getInputElement()&&(this.activeCamera&&this.activeCamera.detachControl(),this.activeCamera=e,t&&e.attachControl())}setActiveCameraById(e){const t=this.getCameraById(e);return t?(this.activeCamera=t,t):null}setActiveCameraByName(e){const t=this.getCameraByName(e);return t?(this.activeCamera=t,t):null}getAnimationGroupByName(e){for(let t=0;t<this.animationGroups.length;t++)if(this.animationGroups[t].name===e)return this.animationGroups[t];return null}_getMaterial(e,t){for(let i=0;i<this.materials.length;i++){const e=this.materials[i];if(t(e))return e}if(e)for(let i=0;i<this.multiMaterials.length;i++){const e=this.multiMaterials[i];if(t(e))return e}return null}getMaterialByUniqueID(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(t,(t=>t.uniqueId===e))}getMaterialById(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(t,(t=>t.id===e))}getMaterialByName(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(t,(t=>t.name===e))}getLastMaterialById(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(let i=this.materials.length-1;i>=0;i--)if(this.materials[i].id===e)return this.materials[i];if(t)for(let i=this.multiMaterials.length-1;i>=0;i--)if(this.multiMaterials[i].id===e)return this.multiMaterials[i];return null}getTextureByUniqueId(e){for(let t=0;t<this.textures.length;t++)if(this.textures[t].uniqueId===e)return this.textures[t];return null}getTextureByName(e){for(let t=0;t<this.textures.length;t++)if(this.textures[t].name===e)return this.textures[t];return null}getCameraById(e){for(let t=0;t<this.cameras.length;t++)if(this.cameras[t].id===e)return this.cameras[t];return null}getCameraByUniqueId(e){for(let t=0;t<this.cameras.length;t++)if(this.cameras[t].uniqueId===e)return this.cameras[t];return null}getCameraByName(e){for(let t=0;t<this.cameras.length;t++)if(this.cameras[t].name===e)return this.cameras[t];return null}getBoneById(e){for(let t=0;t<this.skeletons.length;t++){const i=this.skeletons[t];for(let t=0;t<i.bones.length;t++)if(i.bones[t].id===e)return i.bones[t]}return null}getBoneByName(e){for(let t=0;t<this.skeletons.length;t++){const i=this.skeletons[t];for(let t=0;t<i.bones.length;t++)if(i.bones[t].name===e)return i.bones[t]}return null}getLightByName(e){for(let t=0;t<this.lights.length;t++)if(this.lights[t].name===e)return this.lights[t];return null}getLightById(e){for(let t=0;t<this.lights.length;t++)if(this.lights[t].id===e)return this.lights[t];return null}getLightByUniqueId(e){for(let t=0;t<this.lights.length;t++)if(this.lights[t].uniqueId===e)return this.lights[t];return null}getParticleSystemById(e){for(let t=0;t<this.particleSystems.length;t++)if(this.particleSystems[t].id===e)return this.particleSystems[t];return null}getGeometryById(e){for(let t=0;t<this.geometries.length;t++)if(this.geometries[t].id===e)return this.geometries[t];return null}_getGeometryByUniqueId(e){if(this._geometriesByUniqueId){const t=this._geometriesByUniqueId[e];if(void 0!==t)return this.geometries[t]}else for(let t=0;t<this.geometries.length;t++)if(this.geometries[t].uniqueId===e)return this.geometries[t];return null}pushGeometry(e,t){return!(!t&&this._getGeometryByUniqueId(e.uniqueId))&&(this.addGeometry(e),this.onNewGeometryAddedObservable.notifyObservers(e),!0)}removeGeometry(e){let t;if(this._geometriesByUniqueId){if(t=this._geometriesByUniqueId[e.uniqueId],void 0===t)return!1}else if(t=this.geometries.indexOf(e),t<0)return!1;if(t!==this.geometries.length-1){const e=this.geometries[this.geometries.length-1];e&&(this.geometries[t]=e,this._geometriesByUniqueId&&(this._geometriesByUniqueId[e.uniqueId]=t))}return this._geometriesByUniqueId&&(this._geometriesByUniqueId[e.uniqueId]=void 0),this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(e),!0}getGeometries(){return this.geometries}getMeshById(e){for(let t=0;t<this.meshes.length;t++)if(this.meshes[t].id===e)return this.meshes[t];return null}getMeshesById(e){return this.meshes.filter((function(t){return t.id===e}))}getTransformNodeById(e){for(let t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].id===e)return this.transformNodes[t];return null}getTransformNodeByUniqueId(e){for(let t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].uniqueId===e)return this.transformNodes[t];return null}getTransformNodesById(e){return this.transformNodes.filter((function(t){return t.id===e}))}getMeshByUniqueId(e){for(let t=0;t<this.meshes.length;t++)if(this.meshes[t].uniqueId===e)return this.meshes[t];return null}getLastMeshById(e){for(let t=this.meshes.length-1;t>=0;t--)if(this.meshes[t].id===e)return this.meshes[t];return null}getLastTransformNodeById(e){for(let t=this.transformNodes.length-1;t>=0;t--)if(this.transformNodes[t].id===e)return this.transformNodes[t];return null}getLastEntryById(e){let t;for(t=this.meshes.length-1;t>=0;t--)if(this.meshes[t].id===e)return this.meshes[t];for(t=this.transformNodes.length-1;t>=0;t--)if(this.transformNodes[t].id===e)return this.transformNodes[t];for(t=this.cameras.length-1;t>=0;t--)if(this.cameras[t].id===e)return this.cameras[t];for(t=this.lights.length-1;t>=0;t--)if(this.lights[t].id===e)return this.lights[t];return null}getNodeById(e){const t=this.getMeshById(e);if(t)return t;const i=this.getTransformNodeById(e);if(i)return i;const r=this.getLightById(e);if(r)return r;const s=this.getCameraById(e);if(s)return s;const n=this.getBoneById(e);return n||null}getNodeByName(e){const t=this.getMeshByName(e);if(t)return t;const i=this.getTransformNodeByName(e);if(i)return i;const r=this.getLightByName(e);if(r)return r;const s=this.getCameraByName(e);if(s)return s;const n=this.getBoneByName(e);return n||null}getMeshByName(e){for(let t=0;t<this.meshes.length;t++)if(this.meshes[t].name===e)return this.meshes[t];return null}getTransformNodeByName(e){for(let t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].name===e)return this.transformNodes[t];return null}getLastSkeletonById(e){for(let t=this.skeletons.length-1;t>=0;t--)if(this.skeletons[t].id===e)return this.skeletons[t];return null}getSkeletonByUniqueId(e){for(let t=0;t<this.skeletons.length;t++)if(this.skeletons[t].uniqueId===e)return this.skeletons[t];return null}getSkeletonById(e){for(let t=0;t<this.skeletons.length;t++)if(this.skeletons[t].id===e)return this.skeletons[t];return null}getSkeletonByName(e){for(let t=0;t<this.skeletons.length;t++)if(this.skeletons[t].name===e)return this.skeletons[t];return null}getMorphTargetManagerById(e){for(let t=0;t<this.morphTargetManagers.length;t++)if(this.morphTargetManagers[t].uniqueId===e)return this.morphTargetManagers[t];return null}getMorphTargetById(e){for(let t=0;t<this.morphTargetManagers.length;++t){const i=this.morphTargetManagers[t];for(let t=0;t<i.numTargets;++t){const r=i.getTarget(t);if(r.id===e)return r}}return null}getMorphTargetByName(e){for(let t=0;t<this.morphTargetManagers.length;++t){const i=this.morphTargetManagers[t];for(let t=0;t<i.numTargets;++t){const r=i.getTarget(t);if(r.name===e)return r}}return null}getPostProcessByName(e){for(let t=0;t<this.postProcesses.length;++t){const i=this.postProcesses[t];if(i.name===e)return i}return null}isActiveMesh(e){return-1!==this._activeMeshes.indexOf(e)}get uid(){return this._uid||(this._uid=r.S0.RandomId()),this._uid}addExternalData(e,t){return this._externalData||(this._externalData=new o),this._externalData.add(e,t)}getExternalData(e){return this._externalData?this._externalData.get(e):null}getOrAddExternalDataWithFactory(e,t){return this._externalData||(this._externalData=new o),this._externalData.getOrAddWithFactory(e,t)}removeExternalData(e){return this._externalData.remove(e)}_evaluateSubMesh(e,t,i,r){if(r||e.isInFrustum(this._frustumPlanes)){for(const r of this._evaluateSubMeshStage)r.action(t,e);const i=e.getMaterial();null!==i&&void 0!==i&&(i.hasRenderTargetTextures&&null!=i.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(i)&&(this._processedMaterials.push(i),this._materialsRenderTargets.concatWithNoDuplicate(i.getRenderTargetTextures())),this._renderingManager.dispatch(e,t,i))}}freeProcessedMaterials(){this._processedMaterials.dispose()}get blockfreeActiveMeshesAndRenderingGroups(){return this._preventFreeActiveMeshesAndRenderingGroups}set blockfreeActiveMeshesAndRenderingGroups(e){this._preventFreeActiveMeshesAndRenderingGroups!==e&&(e&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=e)}freeActiveMeshes(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(let e=0;e<this.activeCameras.length;e++){const t=this.activeCameras[e];t&&t._activeMeshes&&t._activeMeshes.dispose()}}freeRenderingGroups(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(let e=0;e<this.textures.length;e++){const t=this.textures[e];t&&t.renderList&&t.freeRenderingGroups()}}_isInIntermediateRendering(){return this._intermediateRendering}freezeActiveMeshes(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.executeWhenReady((()=>{if(this.activeCamera){if(this._frustumPlanes||this.updateTransformMatrix(),this._evaluateActiveMeshes(),this._activeMeshesFrozen=!0,this._activeMeshesFrozenButKeepClipping=s,this._skipEvaluateActiveMeshesCompletely=e,r)for(let e=0;e<this._activeMeshes.length;e++)this._activeMeshes.data[e]._freeze();t&&t()}else i&&i("No active camera found")})),this}unfreezeActiveMeshes(){for(let e=0;e<this.meshes.length;e++){const t=this.meshes[e];t._internalAbstractMeshDataInfo&&(t._internalAbstractMeshDataInfo._isActive=!1)}for(let e=0;e<this._activeMeshes.length;e++)this._activeMeshes.data[e]._unFreeze();return this._activeMeshesFrozen=!1,this}_executeActiveContainerCleanup(e){(!this._engine.snapshotRendering||1!==this._engine.snapshotRenderingMode)&&this._activeMeshesFrozen&&this._activeMeshes.length||this.onBeforeRenderObservable.addOnce((()=>e.dispose()))}_evaluateActiveMeshes(){if(this._engine.snapshotRendering&&1===this._engine.snapshotRenderingMode)return void(this._activeMeshes.length>0&&(this.activeCamera?._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset()));if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely){const e=this._activeMeshes.length;for(let t=0;t<e;t++){this._activeMeshes.data[t].computeWorldMatrix()}}if(this._activeParticleSystems){const e=this._activeParticleSystems.length;for(let t=0;t<e;t++)this._activeParticleSystems.data[t].animate()}return void this._renderingManager.resetSprites()}if(!this.activeCamera)return;this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._materialsRenderTargets.reset();for(const i of this._beforeEvaluateActiveMeshStage)i.action();const e=this.getActiveMeshCandidates(),t=e.length;for(let i=0;i<t;i++){const t=e.data[i];if(t._internalAbstractMeshDataInfo._currentLODIsUpToDate=!1,t.isBlocked)continue;if(this._totalVertices.addCount(t.getTotalVertices(),!1),!t.isReady()||!t.isEnabled()||t.scaling.hasAZeroComponent)continue;t.computeWorldMatrix(),t.actionManager&&t.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(t);let r=this.customLODSelector?this.customLODSelector(t,this.activeCamera):t.getLOD(this.activeCamera);if(t._internalAbstractMeshDataInfo._currentLOD=r,t._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0,void 0!==r&&null!==r&&(r!==t&&0!==r.billboardMode&&r.computeWorldMatrix(),t._preActivate(),t.isVisible&&t.visibility>0&&0!==(t.layerMask&this.activeCamera.layerMask)&&(this._skipFrustumClipping||t.alwaysSelectAsActiveMesh||t.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(t),this.activeCamera._activeMeshes.push(t),r!==t&&r._activate(this._renderId,!1);for(const e of this._preActiveMeshStage)e.action(t);t._activate(this._renderId,!1)&&(t.isAnInstance?t._internalAbstractMeshDataInfo._actAsRegularMesh&&(r=t):r._internalAbstractMeshDataInfo._onlyForInstances=!1,r._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(t,r)),t._postActivate()}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(let e=0;e<this.particleSystems.length;e++){const t=this.particleSystems[e];if(!t.isStarted()||!t.emitter)continue;const i=t.emitter;i.position&&!i.isEnabled()||(this._activeParticleSystems.push(t),t.animate(),this._renderingManager.dispatchParticles(t))}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}_activeMesh(e,t){this._skeletonsEnabled&&null!==t.skeleton&&void 0!==t.skeleton&&(this._activeSkeletons.pushNoDuplicate(t.skeleton)&&(t.skeleton.prepare(),this._activeBones.addCount(t.skeleton.bones.length,!1)),t.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(t));let i=e.hasInstances||e.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||t.alwaysSelectAsActiveMesh;if(t&&t.subMeshes&&t.subMeshes.length>0){const r=this.getActiveSubMeshCandidates(t),s=r.length;i=i||1===s;for(let n=0;n<s;n++){const s=r.data[n];this._evaluateSubMesh(s,t,e,i)}}}updateTransformMatrix(e){const t=this.activeCamera;if(t)if(t._renderingMultiview){const i=t._rigCameras[0],r=t._rigCameras[1];this.setTransformMatrix(i.getViewMatrix(),i.getProjectionMatrix(e),r.getViewMatrix(),r.getProjectionMatrix(e))}else this.setTransformMatrix(t.getViewMatrix(),t.getProjectionMatrix(e))}_bindFrameBuffer(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e&&e._multiviewTexture?e._multiviewTexture._bindFrameBuffer():e&&e.outputRenderTarget?e.outputRenderTarget._bindFrameBuffer():this._engine._currentFrameBufferIsDefaultFrameBuffer()||this._engine.restoreDefaultFramebuffer(),t&&this._clearFrameBuffer(e)}_clearFrameBuffer(e){if(e&&e._multiviewTexture);else if(e&&e.outputRenderTarget&&!e._renderingMultiview){const t=e.outputRenderTarget;t.onClearObservable.hasObservers()?t.onClearObservable.notifyObservers(this._engine):t.skipInitialClear||e.isRightCamera||(this.autoClear&&this._engine.clear(t.clearColor||this.clearColor,!t._cleared,!0,!0),t._cleared=!0)}else this._defaultFrameBufferCleared?this._engine.clear(null,!1,!0,!0):(this._defaultFrameBufferCleared=!0,this._clear())}_renderForCamera(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(e&&e._skipRendering)return;const s=this._engine;if(this._activeCamera=e,!this.activeCamera)throw new Error("Active camera not set");if(s.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,!this.prePass&&i){let t=!0;e._renderingMultiview&&e.outputRenderTarget&&(t=e.outputRenderTarget.skipInitialClear,this.autoClear&&(this._defaultFrameBufferCleared=!1,e.outputRenderTarget.skipInitialClear=!1)),this._bindFrameBuffer(this._activeCamera),e._renderingMultiview&&e.outputRenderTarget&&(e.outputRenderTarget.skipInitialClear=t)}this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(let r=0;r<this._softwareSkinnedMeshes.length;r++){const e=this._softwareSkinnedMeshes.data[r];e.applySkeleton(e.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),this._renderTargets.concatWithNoDuplicate(this._materialsRenderTargets),e.customRenderTargets&&e.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(e.customRenderTargets),t&&t.customRenderTargets&&t.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(t.customRenderTargets),this.environmentTexture&&this.environmentTexture.isRenderTarget&&this._renderTargets.pushNoDuplicate(this.environmentTexture);for(const r of this._gatherActiveCameraRenderTargetsStage)r.action(this._renderTargets);let n=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){r.S0.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(let e=0;e<this._renderTargets.length;e++){const t=this._renderTargets.data[e];if(t._shouldRender()){this._renderId++;const e=t.activeCamera&&t.activeCamera!==this.activeCamera;t.render(e,this.dumpNextRenderTargets),n=!0}}r.S0.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(const e of this._cameraDrawRenderTargetStage)n=e.action(this.activeCamera)||n;this._intermediateRendering=!1}this._engine.currentRenderPassId=e.outputRenderTarget?.renderPassId??e.renderPassId??0,n&&!this.prePass&&(this._bindFrameBuffer(this._activeCamera,!1),this.updateTransformMatrix()),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),!this.postProcessManager||e._multiviewTexture||this.prePass||this.postProcessManager._prepareFrame();for(const r of this._beforeCameraDrawStage)r.action(this.activeCamera);this.onBeforeDrawPhaseObservable.notifyObservers(this),s.snapshotRendering&&1===s.snapshotRenderingMode&&this.finalizeSceneUbo(),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(const r of this._afterCameraDrawStage)r.action(this.activeCamera);if(this.postProcessManager&&!e._multiviewTexture){const t=e.outputRenderTarget?e.outputRenderTarget.renderTarget:void 0;this.postProcessManager._finalizeFrame(e.isIntermediate,t)}for(const r of this._afterCameraPostProcessStage)r.action(this.activeCamera);this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}_processSubCameras(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(0===e.cameraRigMode||e._renderingMultiview)return e._renderingMultiview&&!this._multiviewSceneUbo&&this._createMultiviewUbo(),this._renderForCamera(e,void 0,t),void this.onAfterRenderCameraObservable.notifyObservers(e);if(e._useMultiviewToSingleView)this._renderMultiviewToSingleView(e);else{this.onBeforeCameraRenderObservable.notifyObservers(e);for(let t=0;t<e._rigCameras.length;t++)this._renderForCamera(e._rigCameras[t],e)}this._activeCamera=e,this.updateTransformMatrix(),this.onAfterRenderCameraObservable.notifyObservers(e)}_checkIntersections(){for(let e=0;e<this._meshesForIntersections.length;e++){const t=this._meshesForIntersections.data[e];if(t.actionManager)for(let e=0;t.actionManager&&e<t.actionManager.actions.length;e++){const i=t.actionManager.actions[e];if(12===i.trigger||13===i.trigger){const e=i.getTriggerParameter(),r=e.mesh?e.mesh:e,s=r.intersectsMesh(t,e.usePreciseIntersection),n=t._intersectionsInProgress.indexOf(r);s&&-1===n?12===i.trigger?(i._executeCurrent(f.CreateNew(t,void 0,r)),t._intersectionsInProgress.push(r)):13===i.trigger&&t._intersectionsInProgress.push(r):!s&&n>-1&&(13===i.trigger&&i._executeCurrent(f.CreateNew(t,void 0,r)),t.actionManager.hasSpecificTrigger(13,(e=>{const t=e.mesh?e.mesh:e;return r===t}))&&13!==i.trigger||t._intersectionsInProgress.splice(n,1))}}}}_advancePhysicsEngineStep(e){}_animate(e){}animate(){if(this._engine.isDeterministicLockStep()){let e=Math.max(Z.MinDeltaTime,Math.min(this._engine.getDeltaTime(),Z.MaxDeltaTime))+this._timeAccumulator;const t=this._engine.getTimeStep(),i=1e3/t/1e3;let r=0;const s=this._engine.getLockstepMaxSteps();let n=Math.floor(e/t);for(n=Math.min(n,s);e>0&&r<n;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=t*i,this._animate(t),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(t),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,r++,e-=t;this._timeAccumulator=e<0?0:e}else{const e=this.useConstantAnimationDeltaTime?16:Math.max(Z.MinDeltaTime,Math.min(this._engine.getDeltaTime(),Z.MaxDeltaTime));this._animationRatio=.06*e,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(e)}}_clear(){(this.autoClearDepthAndStencil||this.autoClear)&&this._engine.clear(this.clearColor,this.autoClear||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil)}_checkCameraRenderTarget(e){if(e?.outputRenderTarget&&!e?.isRigCamera&&(e.outputRenderTarget._cleared=!1),e?.rigCameras?.length)for(let t=0;t<e.rigCameras.length;++t){const i=e.rigCameras[t].outputRenderTarget;i&&(i._cleared=!1)}}resetDrawCache(e){if(this.meshes)for(const t of this.meshes)t.resetDrawCache(e)}render(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.isDisposed)return;this.onReadyObservable.hasObservers()&&null===this._executeWhenReadyTimeoutId&&this._checkIsReady(),this._frameId++,this._defaultFrameBufferCleared=!1,this._checkCameraRenderTarget(this.activeCamera),this.activeCameras?.length&&this.activeCameras.forEach(this._checkCameraRenderTarget),this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),t||this.animate();for(const r of this._beforeCameraUpdateStage)r.action();if(e)if(this.activeCameras&&this.activeCameras.length>0)for(let r=0;r<this.activeCameras.length;r++){const e=this.activeCameras[r];if(e.update(),0!==e.cameraRigMode)for(let t=0;t<e._rigCameras.length;t++)e._rigCameras[t].update()}else if(this.activeCamera&&(this.activeCamera.update(),0!==this.activeCamera.cameraRigMode))for(let r=0;r<this.activeCamera._rigCameras.length;r++)this.activeCamera._rigCameras[r].update();this.onBeforeRenderObservable.notifyObservers(this);const i=this.getEngine();this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);const s=this.activeCameras?.length?this.activeCameras[0]:this.activeCamera;if(this.renderTargetsEnabled){r.S0.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(let e=0;e<this.customRenderTargets.length;e++){const t=this.customRenderTargets[e];if(t._shouldRender()){if(this._renderId++,this.activeCamera=t.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");i.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),t.render(s!==this.activeCamera,this.dumpNextRenderTargets)}}r.S0.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}this._engine.currentRenderPassId=s?.renderPassId??0,this.activeCamera=s,this._activeCamera&&22!==this._activeCamera.cameraRigMode&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(const r of this._beforeClearStage)r.action();this._clearFrameBuffer(this.activeCamera);for(const r of this._gatherRenderTargetsStage)r.action(this._renderTargets);if(this.activeCameras&&this.activeCameras.length>0)for(let r=0;r<this.activeCameras.length;r++)this._processSubCameras(this.activeCameras[r],r>0);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera,!!this.activeCamera.outputRenderTarget)}this._checkIntersections();for(const r of this._afterRenderStage)r.action();if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(let e=0;e<this._toBeDisposed.length;e++){const t=this._toBeDisposed[e];t&&t.dispose()}this._toBeDisposed.length=0}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0),this._engine.restoreDefaultFramebuffer()}freezeMaterials(){for(let e=0;e<this.materials.length;e++)this.materials[e].freeze()}unfreezeMaterials(){for(let e=0;e<this.materials.length;e++)this.materials[e].unfreeze()}dispose(){if(this.isDisposed)return;this.beforeRender=null,this.afterRender=null,this.metadata=null,this.skeletons.length=0,this.morphTargetManagers.length=0,this._transientComponents.length=0,this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear(),this.importedMeshesFiles=[],this.stopAllAnimations&&(this._activeAnimatables.forEach((e=>{e.onAnimationEndObservable.clear(),e.onAnimationEnd=null})),this.stopAllAnimations()),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this.activeCameras=null,this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._materialsRenderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed.length=0;const e=this._activeRequests.slice();for(const s of e)s.abort();this._activeRequests.length=0;try{this.onDisposeObservable.notifyObservers(this)}catch(r){$.V.Error("An error occurred while calling onDisposeObservable!",r)}this.detachControl();if(this._engine.getInputElement())for(let s=0;s<this.cameras.length;s++)this.cameras[s].detachControl();this._disposeList(this.animationGroups),this._disposeList(this.lights),this._disposeList(this.meshes,(e=>e.dispose(!0))),this._disposeList(this.transformNodes,(e=>e.dispose(!0)));const t=this.cameras;this._disposeList(t),this._defaultMaterial&&this._defaultMaterial.dispose(),this._disposeList(this.multiMaterials),this._disposeList(this.materials),this._disposeList(this.particleSystems),this._disposeList(this.postProcesses),this._disposeList(this.textures),this._disposeList(this.morphTargetManagers),this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),this._disposeList(this._components);let i=this._engine.scenes.indexOf(this);i>-1&&this._engine.scenes.splice(i,1),y.q._LastCreatedScene===this&&(this._engine.scenes.length>0?y.q._LastCreatedScene=this._engine.scenes[this._engine.scenes.length-1]:y.q._LastCreatedScene=null),i=this._engine._virtualScenes.indexOf(this),i>-1&&this._engine._virtualScenes.splice(i,1),this._engine.wipeCaches(!0),this.onDisposeObservable.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onAfterRenderCameraObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.onScenePerformancePriorityChangedObservable.clear(),this._isDisposed=!0}_disposeList(e,t){const i=e.slice(0);t=t??(e=>e.dispose());for(const r of i)t(r);e.length=0}get isDisposed(){return this._isDisposed}clearCachedVertexData(){for(let e=0;e<this.meshes.length;e++){const t=this.meshes[e].geometry;t&&t.clearCachedData()}}cleanCachedTextureBuffer(){for(const e of this.textures){e._buffer&&(e._buffer=null)}}getWorldExtends(e){const t=new h.Pq(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),i=new h.Pq(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return e=e||(()=>!0),this.meshes.filter(e).forEach((e=>{if(e.computeWorldMatrix(!0),!e.subMeshes||0===e.subMeshes.length||e.infiniteDistance)return;const r=e.getBoundingInfo(),s=r.boundingBox.minimumWorld,n=r.boundingBox.maximumWorld;h.Pq.CheckExtends(s,t,i),h.Pq.CheckExtends(n,t,i)})),{min:t,max:i}}createPickingRay(e,t,i,r){throw(0,T.n)("Ray")}createPickingRayToRef(e,t,i,r,s){throw(0,T.n)("Ray")}createPickingRayInCameraSpace(e,t,i){throw(0,T.n)("Ray")}createPickingRayInCameraSpaceToRef(e,t,i,r){throw(0,T.n)("Ray")}get _pickingAvailable(){return!1}pick(e,t,i,r,s,n){const a=(0,T.n)("Ray",!0);return a&&$.V.Warn(a),new p.G}pickWithBoundingInfo(e,t,i,r,s){const n=(0,T.n)("Ray",!0);return n&&$.V.Warn(n),new p.G}pickWithRay(e,t,i,r){throw(0,T.n)("Ray")}multiPick(e,t,i,r,s){throw(0,T.n)("Ray")}multiPickWithRay(e,t,i){throw(0,T.n)("Ray")}setPointerOverMesh(e,t,i){this._inputManager.setPointerOverMesh(e,t,i)}getPointerOverMesh(){return this._inputManager.getPointerOverMesh()}_rebuildGeometries(){for(const e of this.geometries)e._rebuild();for(const e of this.meshes)e._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(const e of this._components)e.rebuild();for(const e of this.particleSystems)e.rebuild();if(this.spriteManagers)for(const e of this.spriteManagers)e.rebuild()}_rebuildTextures(){for(const e of this.textures)e._rebuild(!0);this.markAllMaterialsAsDirty(1)}_getByTags(e,t,i){if(void 0===t)return e;const r=[];for(const s in e){const n=e[s];l.Y&&l.Y.MatchesQuery(n,t)&&(!i||i(n))&&r.push(n)}return r}getMeshesByTags(e,t){return this._getByTags(this.meshes,e,t)}getCamerasByTags(e,t){return this._getByTags(this.cameras,e,t)}getLightsByTags(e,t){return this._getByTags(this.lights,e,t)}getMaterialByTags(e,t){return this._getByTags(this.materials,e,t).concat(this._getByTags(this.multiMaterials,e,t))}getTransformNodesByTags(e,t){return this._getByTags(this.transformNodes,e,t)}setRenderingOrder(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(e,t,i,r)}setRenderingAutoClearDepthStencil(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._renderingManager.setRenderingAutoClearDepthStencil(e,t,i,r)}getAutoClearDepthStencilSetup(e){return this._renderingManager.getAutoClearDepthStencilSetup(e)}_forceBlockMaterialDirtyMechanism(e){this._blockMaterialDirtyMechanism=e}get blockMaterialDirtyMechanism(){return this._blockMaterialDirtyMechanism}set blockMaterialDirtyMechanism(e){this._blockMaterialDirtyMechanism!==e&&(this._blockMaterialDirtyMechanism=e,e||this.markAllMaterialsAsDirty(63))}markAllMaterialsAsDirty(e,t){if(!this._blockMaterialDirtyMechanism)for(const i of this.materials)t&&!t(i)||i.markAsDirty(e)}_loadFile(e,t,i,r,s,n,a){const o=(0,X.zU)(e,t,i,r?this.offlineProvider:void 0,s,n,a);return this._activeRequests.push(o),o.onCompleteObservable.add((e=>{this._activeRequests.splice(this._activeRequests.indexOf(e),1)})),o}_loadFileAsync(e,t,i,r,s){return new Promise(((n,a)=>{this._loadFile(e,(e=>{n(e)}),t,i,r,((e,t)=>{a(t)}),s)}))}_requestFile(e,t,i,r,s,n,a){const o=(0,X.sh)(e,t,i,r?this.offlineProvider:void 0,s,n,a);return this._activeRequests.push(o),o.onCompleteObservable.add((e=>{this._activeRequests.splice(this._activeRequests.indexOf(e),1)})),o}_requestFileAsync(e,t,i,r,s){return new Promise(((n,a)=>{this._requestFile(e,(e=>{n(e)}),t,i,r,(e=>{a(e)}),s)}))}_readFile(e,t,i,r,s){const n=(0,X.NJ)(e,t,i,r,s);return this._activeRequests.push(n),n.onCompleteObservable.add((e=>{this._activeRequests.splice(this._activeRequests.indexOf(e),1)})),n}_readFileAsync(e,t,i){return new Promise(((r,s)=>{this._readFile(e,(e=>{r(e)}),t,i,(e=>{s(e)}))}))}getPerfCollector(){throw(0,T.n)("performanceViewerSceneExtension")}setActiveCameraByID(e){return this.setActiveCameraById(e)}getMaterialByID(e){return this.getMaterialById(e)}getLastMaterialByID(e){return this.getLastMaterialById(e)}getTextureByUniqueID(e){return this.getTextureByUniqueId(e)}getCameraByID(e){return this.getCameraById(e)}getCameraByUniqueID(e){return this.getCameraByUniqueId(e)}getBoneByID(e){return this.getBoneById(e)}getLightByID(e){return this.getLightById(e)}getLightByUniqueID(e){return this.getLightByUniqueId(e)}getParticleSystemByID(e){return this.getParticleSystemById(e)}getGeometryByID(e){return this.getGeometryById(e)}getMeshByID(e){return this.getMeshById(e)}getMeshByUniqueID(e){return this.getMeshByUniqueId(e)}getLastMeshByID(e){return this.getLastMeshById(e)}getMeshesByID(e){return this.getMeshesById(e)}getTransformNodeByID(e){return this.getTransformNodeById(e)}getTransformNodeByUniqueID(e){return this.getTransformNodeByUniqueId(e)}getTransformNodesByID(e){return this.getTransformNodesById(e)}getNodeByID(e){return this.getNodeById(e)}getLastEntryByID(e){return this.getLastEntryById(e)}getLastSkeletonByID(e){return this.getLastSkeletonById(e)}}Z.FOGMODE_NONE=0,Z.FOGMODE_EXP=1,Z.FOGMODE_EXP2=2,Z.FOGMODE_LINEAR=3,Z.MinDeltaTime=1,Z.MaxDeltaTime=1e3,(0,c.Y5)("BABYLON.Scene",Z)},6736:(e,t,i)=>{"use strict";i.d(t,{B:()=>s,v:()=>r});class r{}r.NAME_EFFECTLAYER="EffectLayer",r.NAME_LAYER="Layer",r.NAME_LENSFLARESYSTEM="LensFlareSystem",r.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",r.NAME_PARTICLESYSTEM="ParticleSystem",r.NAME_GAMEPAD="Gamepad",r.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",r.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",r.NAME_PREPASSRENDERER="PrePassRenderer",r.NAME_DEPTHRENDERER="DepthRenderer",r.NAME_DEPTHPEELINGRENDERER="DepthPeelingRenderer",r.NAME_IBLSHADOWSRENDERER="IblShadowsRenderer",r.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",r.NAME_SPRITE="Sprite",r.NAME_SUBSURFACE="SubSurface",r.NAME_OUTLINERENDERER="Outline",r.NAME_PROCEDURALTEXTURE="ProceduralTexture",r.NAME_SHADOWGENERATOR="ShadowGenerator",r.NAME_OCTREE="Octree",r.NAME_PHYSICSENGINE="PhysicsEngine",r.NAME_AUDIO="Audio",r.NAME_FLUIDRENDERER="FluidRenderer",r.STEP_ISREADYFORMESH_EFFECTLAYER=0,r.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,r.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,r.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,r.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,r.STEP_BEFORECAMERADRAW_PREPASS=0,r.STEP_BEFORECAMERADRAW_EFFECTLAYER=1,r.STEP_BEFORECAMERADRAW_LAYER=2,r.STEP_BEFORERENDERTARGETDRAW_PREPASS=0,r.STEP_BEFORERENDERTARGETDRAW_LAYER=1,r.STEP_BEFORERENDERINGMESH_PREPASS=0,r.STEP_BEFORERENDERINGMESH_OUTLINE=1,r.STEP_AFTERRENDERINGMESH_PREPASS=0,r.STEP_AFTERRENDERINGMESH_OUTLINE=1,r.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,r.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,r.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,r.STEP_BEFORECAMERAUPDATE_GAMEPAD=1,r.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,r.STEP_BEFORECLEAR_PREPASS=1,r.STEP_BEFORERENDERTARGETCLEAR_PREPASS=0,r.STEP_AFTERRENDERTARGETDRAW_PREPASS=0,r.STEP_AFTERRENDERTARGETDRAW_LAYER=1,r.STEP_AFTERCAMERADRAW_PREPASS=0,r.STEP_AFTERCAMERADRAW_EFFECTLAYER=1,r.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=2,r.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=3,r.STEP_AFTERCAMERADRAW_LAYER=4,r.STEP_AFTERCAMERADRAW_FLUIDRENDERER=5,r.STEP_AFTERCAMERAPOSTPROCESS_LAYER=0,r.STEP_AFTERRENDERTARGETPOSTPROCESS_LAYER=0,r.STEP_AFTERRENDER_AUDIO=0,r.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,r.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,r.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,r.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,r.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,r.STEP_GATHERACTIVECAMERARENDERTARGETS_FLUIDRENDERER=1,r.STEP_POINTERMOVE_SPRITE=0,r.STEP_POINTERDOWN_SPRITE=0,r.STEP_POINTERUP_SPRITE=0;class s extends Array{constructor(e){super(...e)}static Create(){return Object.create(s.prototype)}registerStep(e,t,i){let r=0,s=Number.MAX_VALUE;for(;r<this.length;r++){if(s=this[r].index,e<s)break}this.splice(r,0,{index:e,component:t,action:i.bind(t)})}clear(){this.length=0}}},6379:(e,t,i)=>{"use strict";i.d(t,{Cg:()=>r});function r(e,t,i,r){var s,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)a=Reflect.decorate(e,t,i,r);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(a=(n<3?s(a):n>3?s(t,i,a):s(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a}Object.create;Object.create}},t={};function i(r){var s=t[r];if(void 0!==s)return s.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,i),n.exports}i.m=e,i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;i.t=function(r,s){if(1&s&&(r=this(r)),8&s)return r;if("object"===typeof r&&r){if(4&s&&r.__esModule)return r;if(16&s&&"function"===typeof r.then)return r}var n=Object.create(null);i.r(n);var a={};e=e||[null,t({}),t([]),t(t)];for(var o=2&s&&r;"object"==typeof o&&!~e.indexOf(o);o=t(o))Object.getOwnPropertyNames(o).forEach((e=>a[e]=()=>r[e]));return a.default=()=>r,i.d(n,a),n}})(),i.d=(e,t)=>{for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},i.f={},i.e=e=>Promise.all(Object.keys(i.f).reduce(((t,r)=>(i.f[r](e,t),t)),[])),i.u=e=>"static/js/"+e+"."+{1:"aeb61b35",70:"fcb0365f",72:"ccadfc7f",73:"317fda41",114:"9bb23502",116:"1091a774",140:"9c4d033c",160:"abb6b80a",176:"19a74ea7",264:"60a85158",289:"66d135a5",299:"9974a48c",351:"608f69ad",352:"e8fb760c",383:"4e689d43",386:"547883d0",409:"26916d1d",453:"61593348",470:"ce978644",480:"39bb54d3",516:"1767652b",541:"5a133bcb",571:"3e4cfe81",574:"d58711b1",605:"721c690e",677:"2b20d680",680:"b830d296",685:"984916cb",736:"64156be6",825:"408edf31",835:"22aa03dc",842:"a8e27adb",853:"1e028286",861:"9f223816",912:"471cea10",916:"524bb044",944:"0cc0f9d0",955:"4f882b3b",993:"7ac8a929"}[e]+".chunk.js",i.miniCssF=e=>{},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="babylonjs-check:";i.l=(r,s,n,a)=>{if(e[r])e[r].push(s);else{var o,l;if(void 0!==n)for(var h=document.getElementsByTagName("script"),c=0;c<h.length;c++){var u=h[c];if(u.getAttribute("src")==r||u.getAttribute("data-webpack")==t+n){o=u;break}}o||(l=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,i.nc&&o.setAttribute("nonce",i.nc),o.setAttribute("data-webpack",t+n),o.src=r),e[r]=[s];var d=(t,i)=>{o.onerror=o.onload=null,clearTimeout(_);var s=e[r];if(delete e[r],o.parentNode&&o.parentNode.removeChild(o),s&&s.forEach((e=>e(i))),t)return t(i)},_=setTimeout(d.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=d.bind(null,o.onerror),o.onload=d.bind(null,o.onload),l&&document.head.appendChild(o)}}})(),i.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.p="/",(()=>{var e={792:0};i.f.j=(t,r)=>{var s=i.o(e,t)?e[t]:void 0;if(0!==s)if(s)r.push(s[2]);else{var n=new Promise(((i,r)=>s=e[t]=[i,r]));r.push(s[2]=n);var a=i.p+i.u(t),o=new Error;i.l(a,(r=>{if(i.o(e,t)&&(0!==(s=e[t])&&(e[t]=void 0),s)){var n=r&&("load"===r.type?"missing":r.type),a=r&&r.target&&r.target.src;o.message="Loading chunk "+t+" failed.\n("+n+": "+a+")",o.name="ChunkLoadError",o.type=n,o.request=a,s[1](o)}}),"chunk-"+t,t)}};var t=(t,r)=>{var s,n,a=r[0],o=r[1],l=r[2],h=0;if(a.some((t=>0!==e[t]))){for(s in o)i.o(o,s)&&(i.m[s]=o[s]);if(l)l(i)}for(t&&t(r);h<a.length;h++)n=a[h],i.o(e,n)&&e[n]&&e[n][0](),e[n]=0},r=self.webpackChunkbabylonjs_check=self.webpackChunkbabylonjs_check||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})(),(()=>{"use strict";var e=i(5043),t=i.t(e,2),r=i(4391),s=i(6379),n=i(7376),a=i(5491),o=i(5968),l=i(4072),h=i(6984),c=i(818);class u{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new a.cP,this._onClonedObservable=new a.cP}}class d{static AddNodeConstructor(e,t){this._NodeConstructors[e]=t}static Construct(e,t,i,r){const s=this._NodeConstructors[e];return s?s(t,i,r):null}set accessibilityTag(e){this._accessibilityTag=e,this.onAccessibilityTagChangedObservable.notifyObservers(e)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}set doNotSerialize(e){this._nodeDataStorage._doNotSerialize=e}isDisposed(){return this._nodeDataStorage._isDisposed}set parent(e){if(this._parentNode===e)return;const t=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const t=this._parentNode._children.indexOf(this);-1!==t&&this._parentNode._children.splice(t,1),e||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=e,this._isDirty=!0,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),t||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(e){e.parentId=this.uniqueId}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const e=this._scene.rootNodes,t=e.length-1;e[this._nodeDataStorage._sceneRootNodesIndex]=e[t],e[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(e){this._animationPropertiesOverride=e}getClassName(){return"Node"}set onDispose(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._isDirty=!1,this._nodeDataStorage=new u,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new a.cP,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=o.uq.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.onDisposeObservable=new a.cP,this._onDisposeObserver=null,this._behaviors=new Array,this.name=e,this.id=e,this._scene=t||l.q.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),i&&this._addToSceneRootNodes()}getScene(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return-1!==this._behaviors.indexOf(e)||(e.init(),this._scene.isLoading&&!t?this._scene.onDataLoadedObservable.addOnce((()=>{e.attach(this)})):e.attach(this),this._behaviors.push(e)),this}removeBehavior(e){const t=this._behaviors.indexOf(e);return-1===t||(this._behaviors[t].detach(),this._behaviors.splice(t,1)),this}get behaviors(){return this._behaviors}getBehaviorByName(e){for(const t of this._behaviors)if(t.name===e)return t;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.computeWorldMatrix(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={}}updateCache(e){!e&&this.isSynchronized()||this._updateCache()}_getActionManagerForTrigger(e){return this.parent?this.parent._getActionManagerForTrigger(e,!1):null}_updateCache(e){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}isSynchronized(){return!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}isReady(){return this._nodeDataStorage._isReady}markAsDirty(e){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(){return!1===(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}_syncParentEnabledState(){this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach((e=>{e._syncParentEnabledState()}))}setEnabled(e){this._nodeDataStorage._isEnabled!==e&&(this._nodeDataStorage._isEnabled=e,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(e))}isDescendantOf(e){return!!this.parent&&(this.parent===e||this.parent.isDescendantOf(e))}_getDescendants(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0;if(this._children)for(let r=0;r<this._children.length;r++){const s=this._children[r];i&&!i(s)||e.push(s),t||s._getDescendants(e,!1,i)}}getDescendants(e,t){const i=[];return this._getDescendants(i,e,t),i}getChildMeshes(e,t){const i=[];return this._getDescendants(i,e,(e=>(!t||t(e))&&void 0!==e.cullingStrategy)),i}getChildren(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getDescendants(t,e)}_setReady(e){e!==this._nodeDataStorage._isReady&&(e?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}getAnimationByName(e){for(let t=0;t<this.animations.length;t++){const i=this.animations[t];if(i.name===e)return i}return null}createAnimationRange(e,t,i){if(!this._ranges[e]){this._ranges[e]=d._AnimationRangeFactory(e,t,i);for(let r=0,s=this.animations.length;r<s;r++)this.animations[r]&&this.animations[r].createRange(e,t,i)}}deleteAnimationRange(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let i=0,r=this.animations.length;i<r;i++)this.animations[i]&&this.animations[i].deleteRange(e,t);this._ranges[e]=null}getAnimationRange(e){return this._ranges[e]||null}clone(e,t,i){const r=c.p.Clone((()=>new d(e,this.getScene())),this);if(t&&(r.parent=t),!i){const t=this.getDescendants(!0);for(let i=0;i<t.length;i++){const s=t[i];s.clone(e+"."+s.name,r)}}return r}getAnimationRanges(){const e=[];let t;for(t in this._ranges)e.push(this._ranges[t]);return e}beginAnimation(e,t,i,r){const s=this.getAnimationRange(e);return s?this._scene.beginAnimation(this,s.from,s.to,t,i,r):null}serializeAnimationRanges(){const e=[];for(const t in this._ranges){const i=this._ranges[t];if(!i)continue;const r={};r.name=t,r.from=i.from,r.to=i.to,e.push(r)}return e}computeWorldMatrix(e){return this._worldMatrix||(this._worldMatrix=o.uq.Identity()),this._worldMatrix}dispose(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._nodeDataStorage._isDisposed=!0,!e){const i=this.getDescendants(!0);for(const r of i)r.dispose(e,t)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const i of this._behaviors)i.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(e,t,i){if(t.ranges)for(let r=0;r<t.ranges.length;r++){const i=t.ranges[r];e.createAnimationRange(i.name,i.from,i.to)}}getHierarchyBoundingVectors(){let e,t,i=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.getScene().incrementRenderId(),this.computeWorldMatrix(!0);const s=this;if(s.getBoundingInfo&&s.subMeshes){const i=s.getBoundingInfo();e=i.boundingBox.minimumWorld.clone(),t=i.boundingBox.maximumWorld.clone()}else e=new o.Pq(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t=new o.Pq(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(i){const i=this.getDescendants(!1);for(const s of i){const i=s;if(i.computeWorldMatrix(!0),r&&!r(i))continue;if(!i.getBoundingInfo||0===i.getTotalVertices())continue;const n=i.getBoundingInfo().boundingBox,a=n.minimumWorld,l=n.maximumWorld;o.Pq.CheckExtends(a,e,t),o.Pq.CheckExtends(l,e,t)}}return{min:e,max:t}}}d._AnimationRangeFactory=(e,t,i)=>{throw(0,h.n)("AnimationRange")},d._NodeConstructors={},(0,s.Cg)([(0,n.lK)()],d.prototype,"name",void 0),(0,s.Cg)([(0,n.lK)()],d.prototype,"id",void 0),(0,s.Cg)([(0,n.lK)()],d.prototype,"uniqueId",void 0),(0,s.Cg)([(0,n.lK)()],d.prototype,"state",void 0),(0,s.Cg)([(0,n.lK)()],d.prototype,"metadata",void 0);var _=i(543),p=i(5918),f=i(5387);function g(e,t,i){try{const r=e.next();r.done?t(r):r.value?r.value.then((()=>{r.value=void 0,t(r)}),i):t(r)}catch(M){i(M)}}function m(e,t,i,r,s){const n=()=>{let a;const o=e=>{e.done?i(e.value):void 0===a?a=!0:n()};do{a=void 0,s&&s.aborted?r(new Error("Aborted")):t(e,o,r),void 0===a&&(a=!1)}while(a)};n()}function b(e,t){let i;return m(e,g,(e=>i=e),(e=>{throw e}),t),i}function v(e,t,i){return new Promise(((r,s)=>{m(e,t,r,s,i)}))}var y=i(20),T=i(8274),x=i(4141),A=i(4857),C=i(1989);class R extends d{get position(){return this._position}set position(e){this._position=e}set upVector(e){this._upVector=e}get upVector(){return this._upVector}get screenArea(){let e=0,t=0;if(this.mode===R.PERSPECTIVE_CAMERA)this.fovMode===R.FOVMODE_VERTICAL_FIXED?(t=2*this.minZ*Math.tan(this.fov/2),e=this.getEngine().getAspectRatio(this)*t):(e=2*this.minZ*Math.tan(this.fov/2),t=e/this.getEngine().getAspectRatio(this));else{const i=this.getEngine().getRenderWidth()/2,r=this.getEngine().getRenderHeight()/2;e=(this.orthoRight??i)-(this.orthoLeft??-i),t=(this.orthoTop??r)-(this.orthoBottom??-r)}return e*t}set orthoLeft(e){this._orthoLeft=e;for(const t of this._rigCameras)t.orthoLeft=e}get orthoLeft(){return this._orthoLeft}set orthoRight(e){this._orthoRight=e;for(const t of this._rigCameras)t.orthoRight=e}get orthoRight(){return this._orthoRight}set orthoBottom(e){this._orthoBottom=e;for(const t of this._rigCameras)t.orthoBottom=e}get orthoBottom(){return this._orthoBottom}set orthoTop(e){this._orthoTop=e;for(const t of this._rigCameras)t.orthoTop=e}get orthoTop(){return this._orthoTop}set mode(e){this._mode=e;for(const t of this._rigCameras)t.mode=e}get mode(){return this._mode}get hasMoved(){return this._hasMoved}constructor(e,t,i){let r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super(e,i,!1),this._position=o.Pq.Zero(),this._upVector=o.Pq.Up(),this.oblique=null,this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.fov=.8,this.projectionPlaneTilt=0,this.minZ=1,this.maxZ=1e4,this.inertia=.9,this._mode=R.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new A.L(0,0,1,1),this.layerMask=268435455,this.fovMode=R.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=R.RIG_MODE_NONE,this.customRenderTargets=[],this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new a.cP,this.onProjectionMatrixChangedObservable=new a.cP,this.onAfterCheckInputsObservable=new a.cP,this.onRestoreStateObservable=new a.cP,this.isRigCamera=!1,this._hasMoved=!1,this._rigCameras=new Array,this._skipRendering=!1,this._projectionMatrix=new o.uq,this._postProcesses=new Array,this._activeMeshes=new y.L(256),this._globalPosition=o.Pq.Zero(),this._computedViewMatrix=o.uq.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=o.uq.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=o.PT.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.getScene().addCamera(this),r&&!this.getScene().activeCamera&&(this.getScene().activeCamera=this),this.position=t,this.renderPassId=this.getScene().getEngine().createRenderPassId(`Camera ${e}`)}storeState(){return this._stateStored=!0,this._storedFov=this.fov,this}hasStateStored(){return!!this._stateStored}_restoreStateValues(){return!!this._stateStored&&(this.fov=this._storedFov,!0)}restoreState(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}getClassName(){return"Camera"}toString(e){let t="Name: "+this.name;if(t+=", type: "+this.getClassName(),this.animations)for(let i=0;i<this.animations.length;i++)t+=", animation[0]: "+this.animations[i].toString(e);return t}applyVerticalCorrection(){const e=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-e.x:e.x}get globalPosition(){return this._globalPosition}getActiveMeshes(){return this._activeMeshes}isActiveMesh(e){return-1!==this._activeMeshes.indexOf(e)}isReady(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(e)for(const t of this._postProcesses)if(t&&!t.isReady())return!1;return super.isReady(e)}_initCache(){super._initCache(),this._cache.position=new o.Pq(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new o.Pq(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.minZ=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.obliqueAngle=void 0,this._cache.obliqueLength=void 0,this._cache.obliqueOffset=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}_updateCache(e){e||super._updateCache(),this._cache.position.copyFrom(this.position),this._cache.upVector.copyFrom(this.upVector)}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}_isSynchronizedViewMatrix(){return!!super._isSynchronized()&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())}_isSynchronizedProjectionMatrix(){let e=this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ;if(!e)return!1;const t=this.getEngine();return this.mode===R.PERSPECTIVE_CAMERA?e=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===t.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:(e=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===t.getRenderWidth()&&this._cache.renderHeight===t.getRenderHeight(),this.oblique&&(e=e&&this._cache.obliqueAngle===this.oblique.angle&&this._cache.obliqueLength===this.oblique.length&&this._cache.obliqueOffset===this.oblique.offset)),e}attachControl(e,t){}detachControl(e){}update(){this._hasMoved=!1,this._checkInputs(),this.cameraRigMode!==R.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}get rigCameras(){return this._rigCameras}get rigPostProcess(){return this._rigPostProcess}_getFirstPostProcess(){for(let e=0;e<this._postProcesses.length;e++)if(null!==this._postProcesses[e])return this._postProcesses[e];return null}_cascadePostProcessesToRigCams(){const e=this._getFirstPostProcess();e&&e.markTextureDirty();for(let t=0,i=this._rigCameras.length;t<i;t++){const e=this._rigCameras[t],i=e._rigPostProcess;if(i){"pass"===i.getEffectName()&&(e.isIntermediate=0===this._postProcesses.length),e._postProcesses=this._postProcesses.slice(0).concat(i),i.markTextureDirty()}else e._postProcesses=this._postProcesses.slice(0)}}attachPostProcess(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!e.isReusable()&&this._postProcesses.indexOf(e)>-1?(T.V.Error("You're trying to reuse a post process not defined as reusable."),0):(null==t||t<0?this._postProcesses.push(e):null===this._postProcesses[t]?this._postProcesses[t]=e:this._postProcesses.splice(t,0,e),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._postProcesses.indexOf(e))}detachPostProcess(e){const t=this._postProcesses.indexOf(e);-1!==t&&(this._postProcesses[t]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._cascadePostProcessesToRigCams()}getWorldMatrix(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}_getViewMatrix(){return o.uq.Identity()}getViewMatrix(e){return!e&&this._isSynchronizedViewMatrix()||(this._hasMoved=!0,this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.getScene().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}freezeProjectionMatrix(e){this._doNotComputeProjectionMatrix=!0,void 0!==e&&(this._projectionMatrix=e)}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}getProjectionMatrix(e){if(this._doNotComputeProjectionMatrix||!e&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const t=this.getEngine(),i=this.getScene(),r=t.useReverseDepthBuffer;if(this.mode===R.PERSPECTIVE_CAMERA){let e;this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=t.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.minZ<=0&&(this.minZ=.1),e=i.useRightHandedSystem?o.uq.PerspectiveFovRHToRef:o.uq.PerspectiveFovLHToRef,e(this.fov,t.getAspectRatio(this),r?this.maxZ:this.minZ,r?this.minZ:this.maxZ,this._projectionMatrix,this.fovMode===R.FOVMODE_VERTICAL_FIXED,t.isNDCHalfZRange,this.projectionPlaneTilt,r)}else{const e=t.getRenderWidth()/2,s=t.getRenderHeight()/2;i.useRightHandedSystem?this.oblique?o.uq.ObliqueOffCenterRHToRef(this.orthoLeft??-e,this.orthoRight??e,this.orthoBottom??-s,this.orthoTop??s,r?this.maxZ:this.minZ,r?this.minZ:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,t.isNDCHalfZRange):o.uq.OrthoOffCenterRHToRef(this.orthoLeft??-e,this.orthoRight??e,this.orthoBottom??-s,this.orthoTop??s,r?this.maxZ:this.minZ,r?this.minZ:this.maxZ,this._projectionMatrix,t.isNDCHalfZRange):this.oblique?o.uq.ObliqueOffCenterLHToRef(this.orthoLeft??-e,this.orthoRight??e,this.orthoBottom??-s,this.orthoTop??s,r?this.maxZ:this.minZ,r?this.minZ:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,t.isNDCHalfZRange):o.uq.OrthoOffCenterLHToRef(this.orthoLeft??-e,this.orthoRight??e,this.orthoBottom??-s,this.orthoTop??s,r?this.maxZ:this.minZ,r?this.minZ:this.maxZ,this._projectionMatrix,t.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.obliqueAngle=this.oblique?.angle,this._cache.obliqueLength=this.oblique?.length,this._cache.obliqueOffset=this.oblique?.offset,this._cache.renderWidth=t.getRenderWidth(),this._cache.renderHeight=t.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}_computeObliqueDistance(e){return(this.radius||(this.target?o.Pq.Distance(this.position,this.target):this.position.length()))+e}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?C.P.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=C.P.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}isInFrustum(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._updateFrustumPlanes(),t&&this.rigCameras.length>0){let t=!1;return this.rigCameras.forEach((i=>{i._updateFrustumPlanes(),t=t||e.isInFrustum(i._frustumPlanes)})),t}return e.isInFrustum(this._frustumPlanes)}isCompletelyInFrustum(e){return this._updateFrustumPlanes(),e.isCompletelyInFrustum(this._frustumPlanes)}getForwardRay(){throw(0,h.n)("Ray")}getForwardRayToRef(e){throw(0,h.n)("Ray")}dispose(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.getScene().stopAnimation(this),this.getScene().removeCamera(this);this._rigCameras.length>0;){const e=this._rigCameras.pop();e&&e.dispose()}if(this._parentContainer){const e=this._parentContainer.cameras.indexOf(this);e>-1&&this._parentContainer.cameras.splice(e,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==R.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let e=this._postProcesses.length;for(;--e>=0;){const t=this._postProcesses[e];t&&t.dispose(this)}}let i=this.customRenderTargets.length;for(;--i>=0;)this.customRenderTargets[i].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.getScene().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(e,t)}get isLeftCamera(){return this._isLeftCamera}get isRightCamera(){return this._isRightCamera}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}setCameraRigMode(e,t){if(this.cameraRigMode!==e){for(;this._rigCameras.length>0;){const e=this._rigCameras.pop();e&&e.dispose()}if(this.cameraRigMode=e,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=t.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=_.S0.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==R.RIG_MODE_NONE){const e=this.createRigCamera(this.name+"_L",0);e&&(e._isLeftCamera=!0);const t=this.createRigCamera(this.name+"_R",1);t&&(t._isRightCamera=!0),e&&t&&(this._rigCameras.push(e),this._rigCameras.push(t))}this._setRigMode(t),this._cascadePostProcessesToRigCams(),this.update()}}_setRigMode(e){}_getVRProjectionMatrix(){return o.uq.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}setCameraRigParameter(e,t){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[e]=t,"interaxialDistance"===e&&(this._cameraRigParams.stereoHalfAngle=_.S0.ToRadians(t/.0637))}createRigCamera(e,t){return null}_updateRigCameras(){for(let e=0;e<this._rigCameras.length;e++)this._rigCameras[e].minZ=this.minZ,this._rigCameras[e].maxZ=this.maxZ,this._rigCameras[e].fov=this.fov,this._rigCameras[e].upVector.copyFrom(this.upVector);this.cameraRigMode===R.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}_setupInputs(){}serialize(){const e=c.p.Serialize(this);return e.uniqueId=this.uniqueId,e.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(e),this.inputs&&this.inputs.serialize(e),c.p.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e.isEnabled=this.isEnabled(),e}clone(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=c.p.Clone(R.GetConstructorFromName(this.getClassName(),e,this.getScene(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return i.name=e,i.parent=t,this.onClonedObservable.notifyObservers(i),i}getDirection(e){const t=o.Pq.Zero();return this.getDirectionToRef(e,t),t}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}getDirectionToRef(e,t){o.Pq.TransformNormalToRef(e,this.getWorldMatrix(),t)}static GetConstructorFromName(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const n=d.Construct(e,t,i,{interaxial_distance:r,isStereoscopicSideBySide:s});return n||(()=>R._CreateDefaultParsedCamera(t,i))}computeWorldMatrix(){return this.getWorldMatrix()}static Parse(e,t){const i=e.type,r=R.GetConstructorFromName(i,e.name,t,e.interaxial_distance,e.isStereoscopicSideBySide),s=c.p.Parse(r,e,t);if(void 0!==e.parentId&&(s._waitingParentId=e.parentId),void 0!==e.parentInstanceIndex&&(s._waitingParentInstanceIndex=e.parentInstanceIndex),s.inputs&&(s.inputs.parse(e),s._setupInputs()),e.upVector&&(s.upVector=o.Pq.FromArray(e.upVector)),s.setPosition&&(s.position.copyFromFloats(0,0,0),s.setPosition(o.Pq.FromArray(e.position))),e.target&&s.setTarget&&s.setTarget(o.Pq.FromArray(e.target)),e.cameraRigMode){const t=e.interaxial_distance?{interaxialDistance:e.interaxial_distance}:{};s.setCameraRigMode(e.cameraRigMode,t)}if(e.animations){for(let t=0;t<e.animations.length;t++){const i=e.animations[t],r=(0,x.n9)("BABYLON.Animation");r&&s.animations.push(r.Parse(i))}d.ParseAnimationRanges(s,e,t)}return e.autoAnimate&&t.beginAnimation(s,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),void 0!==e.isEnabled&&s.setEnabled(e.isEnabled),s}_calculateHandednessMultiplier(){let e=this.getScene().useRightHandedSystem?-1:1;return this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(e*=-1),e}}R._CreateDefaultParsedCamera=(e,t)=>{throw(0,h.n)("UniversalCamera")},R.PERSPECTIVE_CAMERA=0,R.ORTHOGRAPHIC_CAMERA=1,R.FOVMODE_VERTICAL_FIXED=0,R.FOVMODE_HORIZONTAL_FIXED=1,R.RIG_MODE_NONE=0,R.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,R.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,R.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,R.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,R.RIG_MODE_STEREOSCOPIC_INTERLACED=14,R.RIG_MODE_VR=20,R.RIG_MODE_CUSTOM=22,R.ForceAttachControlToAlwaysPreventDefault=!1,(0,s.Cg)([(0,n.P_)("position")],R.prototype,"_position",void 0),(0,s.Cg)([(0,n.P_)("upVector")],R.prototype,"_upVector",void 0),(0,s.Cg)([(0,n.lK)()],R.prototype,"orthoLeft",null),(0,s.Cg)([(0,n.lK)()],R.prototype,"orthoRight",null),(0,s.Cg)([(0,n.lK)()],R.prototype,"orthoBottom",null),(0,s.Cg)([(0,n.lK)()],R.prototype,"orthoTop",null),(0,s.Cg)([(0,n.lK)()],R.prototype,"fov",void 0),(0,s.Cg)([(0,n.lK)()],R.prototype,"projectionPlaneTilt",void 0),(0,s.Cg)([(0,n.lK)()],R.prototype,"minZ",void 0),(0,s.Cg)([(0,n.lK)()],R.prototype,"maxZ",void 0),(0,s.Cg)([(0,n.lK)()],R.prototype,"inertia",void 0),(0,s.Cg)([(0,n.lK)()],R.prototype,"mode",null),(0,s.Cg)([(0,n.lK)()],R.prototype,"layerMask",void 0),(0,s.Cg)([(0,n.lK)()],R.prototype,"fovMode",void 0),(0,s.Cg)([(0,n.lK)()],R.prototype,"cameraRigMode",void 0),(0,s.Cg)([(0,n.lK)()],R.prototype,"interaxialDistance",void 0),(0,s.Cg)([(0,n.lK)()],R.prototype,"isStereoscopicSideBySide",void 0);var E=i(6760),S=i(1837),M=i(3702);class P{constructor(e,t,i){this.bu=e,this.bv=t,this.distance=i,this.faceId=0,this.subMeshId=0}}var I=i(4654),O=i(9082);class D{constructor(e,t,i){this.vectors=(0,I.mI)(8,o.Pq.Zero),this.center=o.Pq.Zero(),this.centerWorld=o.Pq.Zero(),this.extendSize=o.Pq.Zero(),this.extendSizeWorld=o.Pq.Zero(),this.directions=(0,I.mI)(3,o.Pq.Zero),this.vectorsWorld=(0,I.mI)(8,o.Pq.Zero),this.minimumWorld=o.Pq.Zero(),this.maximumWorld=o.Pq.Zero(),this.minimum=o.Pq.Zero(),this.maximum=o.Pq.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(e,t,i)}reConstruct(e,t,i){const r=e.x,s=e.y,n=e.z,a=t.x,l=t.y,h=t.z,c=this.vectors;this.minimum.copyFromFloats(r,s,n),this.maximum.copyFromFloats(a,l,h),c[0].copyFromFloats(r,s,n),c[1].copyFromFloats(a,l,h),c[2].copyFromFloats(a,s,n),c[3].copyFromFloats(r,l,n),c[4].copyFromFloats(r,s,h),c[5].copyFromFloats(a,l,n),c[6].copyFromFloats(r,l,h),c[7].copyFromFloats(a,s,h),t.addToRef(e,this.center).scaleInPlace(.5),t.subtractToRef(e,this.extendSize).scaleInPlace(.5),this._worldMatrix=i||o.uq.IdentityReadOnly,this._update(this._worldMatrix)}scale(e){const t=D._TmpVector3,i=this.maximum.subtractToRef(this.minimum,t[0]),r=i.length();i.normalizeFromLength(r);const s=r*e,n=i.scaleInPlace(.5*s),a=this.center.subtractToRef(n,t[1]),o=this.center.addToRef(n,t[2]);return this.reConstruct(a,o,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(e){const t=this.minimumWorld,i=this.maximumWorld,r=this.directions,s=this.vectorsWorld,n=this.vectors;if(e.isIdentity()){t.copyFrom(this.minimum),i.copyFrom(this.maximum);for(let e=0;e<8;++e)s[e].copyFrom(n[e]);this.extendSizeWorld.copyFrom(this.extendSize),this.centerWorld.copyFrom(this.center)}else{t.setAll(Number.MAX_VALUE),i.setAll(-Number.MAX_VALUE);for(let r=0;r<8;++r){const a=s[r];o.Pq.TransformCoordinatesToRef(n[r],e,a),t.minimizeInPlace(a),i.maximizeInPlace(a)}i.subtractToRef(t,this.extendSizeWorld).scaleInPlace(.5),i.addToRef(t,this.centerWorld).scaleInPlace(.5)}o.Pq.FromArrayToRef(e.m,0,r[0]),o.Pq.FromArrayToRef(e.m,4,r[1]),o.Pq.FromArrayToRef(e.m,8,r[2]),this._worldMatrix=e}isInFrustum(e){return D.IsInFrustum(this.vectorsWorld,e)}isCompletelyInFrustum(e){return D.IsCompletelyInFrustum(this.vectorsWorld,e)}intersectsPoint(e){const t=this.minimumWorld,i=this.maximumWorld,r=t.x,s=t.y,n=t.z,a=i.x,o=i.y,l=i.z,h=e.x,c=e.y,u=e.z,d=-O.bH;return!(a-h<d||d>h-r)&&(!(o-c<d||d>c-s)&&!(l-u<d||d>u-n))}intersectsSphere(e){return D.IntersectsSphere(this.minimumWorld,this.maximumWorld,e.centerWorld,e.radiusWorld)}intersectsMinMax(e,t){const i=this.minimumWorld,r=this.maximumWorld,s=i.x,n=i.y,a=i.z,o=r.x,l=r.y,h=r.z,c=e.x,u=e.y,d=e.z,_=t.x,p=t.y,f=t.z;return!(o<c||s>_)&&(!(l<u||n>p)&&!(h<d||a>f))}dispose(){this._drawWrapperFront?.dispose(),this._drawWrapperBack?.dispose()}static Intersects(e,t){return e.intersectsMinMax(t.minimumWorld,t.maximumWorld)}static IntersectsSphere(e,t,i,r){const s=D._TmpVector3[0];o.Pq.ClampToRef(i,e,t,s);return o.Pq.DistanceSquared(i,s)<=r*r}static IsCompletelyInFrustum(e,t){for(let i=0;i<6;++i){const r=t[i];for(let t=0;t<8;++t)if(r.dotCoordinate(e[t])<0)return!1}return!0}static IsInFrustum(e,t){for(let i=0;i<6;++i){let r=!0;const s=t[i];for(let t=0;t<8;++t)if(s.dotCoordinate(e[t])>=0){r=!1;break}if(r)return!1}return!0}}D._TmpVector3=(0,I.mI)(3,o.Pq.Zero);class w{constructor(e,t,i){this.center=o.Pq.Zero(),this.centerWorld=o.Pq.Zero(),this.minimum=o.Pq.Zero(),this.maximum=o.Pq.Zero(),this.reConstruct(e,t,i)}reConstruct(e,t,i){this.minimum.copyFrom(e),this.maximum.copyFrom(t);const r=o.Pq.Distance(e,t);t.addToRef(e,this.center).scaleInPlace(.5),this.radius=.5*r,this._update(i||o.uq.IdentityReadOnly)}scale(e){const t=this.radius*e,i=w._TmpVector3,r=i[0].setAll(t),s=this.center.subtractToRef(r,i[1]),n=this.center.addToRef(r,i[2]);return this.reConstruct(s,n,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(e){if(e.isIdentity())this.centerWorld.copyFrom(this.center),this.radiusWorld=this.radius;else{o.Pq.TransformCoordinatesToRef(this.center,e,this.centerWorld);const t=w._TmpVector3[0];o.Pq.TransformNormalFromFloatsToRef(1,1,1,e,t),this.radiusWorld=Math.max(Math.abs(t.x),Math.abs(t.y),Math.abs(t.z))*this.radius}}isInFrustum(e){const t=this.centerWorld,i=this.radiusWorld;for(let r=0;r<6;r++)if(e[r].dotCoordinate(t)<=-i)return!1;return!0}isCenterInFrustum(e){const t=this.centerWorld;for(let i=0;i<6;i++)if(e[i].dotCoordinate(t)<0)return!1;return!0}intersectsPoint(e){const t=o.Pq.DistanceSquared(this.centerWorld,e);return!(this.radiusWorld*this.radiusWorld<t)}static Intersects(e,t){const i=o.Pq.DistanceSquared(e.centerWorld,t.centerWorld),r=e.radiusWorld+t.radiusWorld;return!(r*r<i)}static CreateFromCenterAndRadius(e,t,i){this._TmpVector3[0].copyFrom(e),this._TmpVector3[1].copyFromFloats(0,0,t),this._TmpVector3[2].copyFrom(e),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].subtractInPlace(this._TmpVector3[1]);const r=new w(this._TmpVector3[0],this._TmpVector3[2]);return r._worldMatrix=i||o.uq.Identity(),r}}w._TmpVector3=(0,I.mI)(3,o.Pq.Zero);const F={min:0,max:0},L={min:0,max:0},B=(e,t,i)=>{const r=o.Pq.Dot(t.centerWorld,e),s=Math.abs(o.Pq.Dot(t.directions[0],e))*t.extendSize.x+Math.abs(o.Pq.Dot(t.directions[1],e))*t.extendSize.y+Math.abs(o.Pq.Dot(t.directions[2],e))*t.extendSize.z;i.min=r-s,i.max=r+s},N=(e,t,i)=>(B(e,t,F),B(e,i,L),!(F.min>L.max||L.min>F.max));class k{constructor(e,t,i){this._isLocked=!1,this.boundingBox=new D(e,t,i),this.boundingSphere=new w(e,t,i)}reConstruct(e,t,i){this.boundingBox.reConstruct(e,t,i),this.boundingSphere.reConstruct(e,t,i)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(e){this._isLocked=e}update(e){this._isLocked||(this.boundingBox._update(e),this.boundingSphere._update(e))}centerOn(e,t){const i=k._TmpVector3[0].copyFrom(e).subtractInPlace(t),r=k._TmpVector3[1].copyFrom(e).addInPlace(t);return this.boundingBox.reConstruct(i,r,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(i,r,this.boundingBox.getWorldMatrix()),this}encapsulate(e){const t=o.Pq.Minimize(this.minimum,e),i=o.Pq.Maximize(this.maximum,e);return this.reConstruct(t,i,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(e){const t=o.AA.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(t);const i=o.AA.Vector3[0];return o.Pq.TransformCoordinatesToRef(e.boundingBox.minimumWorld,t,i),this.encapsulate(i),o.Pq.TransformCoordinatesToRef(e.boundingBox.maximumWorld,t,i),this.encapsulate(i),this}scale(e){return this.boundingBox.scale(e),this.boundingSphere.scale(e),this}isInFrustum(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===t||3===t)&&this.boundingSphere.isCenterInFrustum(e))return!0;if(!this.boundingSphere.isInFrustum(e))return!1;return!(1!==t&&3!==t)||this.boundingBox.isInFrustum(e)}get diagonalLength(){const e=this.boundingBox;return e.maximumWorld.subtractToRef(e.minimumWorld,k._TmpVector3[0]).length()}isCompletelyInFrustum(e){return this.boundingBox.isCompletelyInFrustum(e)}_checkCollision(e){return e._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(e){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(e)&&!!this.boundingBox.intersectsPoint(e))}intersects(e,t){if(!w.Intersects(this.boundingSphere,e.boundingSphere))return!1;if(!D.Intersects(this.boundingBox,e.boundingBox))return!1;if(!t)return!0;const i=this.boundingBox,r=e.boundingBox;return!!N(i.directions[0],i,r)&&(!!N(i.directions[1],i,r)&&(!!N(i.directions[2],i,r)&&(!!N(r.directions[0],i,r)&&(!!N(r.directions[1],i,r)&&(!!N(r.directions[2],i,r)&&(!!N(o.Pq.Cross(i.directions[0],r.directions[0]),i,r)&&(!!N(o.Pq.Cross(i.directions[0],r.directions[1]),i,r)&&(!!N(o.Pq.Cross(i.directions[0],r.directions[2]),i,r)&&(!!N(o.Pq.Cross(i.directions[1],r.directions[0]),i,r)&&(!!N(o.Pq.Cross(i.directions[1],r.directions[1]),i,r)&&(!!N(o.Pq.Cross(i.directions[1],r.directions[2]),i,r)&&(!!N(o.Pq.Cross(i.directions[2],r.directions[0]),i,r)&&(!!N(o.Pq.Cross(i.directions[2],r.directions[1]),i,r)&&!!N(o.Pq.Cross(i.directions[2],r.directions[2]),i,r))))))))))))))}}k._TmpVector3=(0,I.mI)(2,o.Pq.Zero);class U{static extractMinAndMaxIndexed(e,t,i,r,s,n){for(let a=i;a<i+r;a++){const i=3*t[a],r=e[i],o=e[i+1],l=e[i+2];s.minimizeInPlaceFromFloats(r,o,l),n.maximizeInPlaceFromFloats(r,o,l)}}static extractMinAndMax(e,t,i,r,s,n){for(let a=t,o=t*r;a<t+i;a++,o+=r){const t=e[o],i=e[o+1],r=e[o+2];s.minimizeInPlaceFromFloats(t,i,r),n.maximizeInPlaceFromFloats(t,i,r)}}}function V(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4?arguments[4]:void 0;const n=new o.Pq(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),a=new o.Pq(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return s||(s=3),U.extractMinAndMax(e,t,i,s,n,a),r&&(n.x-=n.x*r.x+r.y,n.y-=n.y*r.x+r.y,n.z-=n.z*r.x+r.y,a.x+=a.x*r.x+r.y,a.y+=a.y*r.x+r.y,a.z+=a.z*r.x+r.y),{minimum:n,maximum:a}}(0,s.Cg)([n.Cx.filter((function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];let[r,s]=t;return!Array.isArray(r)&&!Array.isArray(s)}))],U,"extractMinAndMaxIndexed",null),(0,s.Cg)([n.Cx.filter((function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];let[r]=t;return!Array.isArray(r)}))],U,"extractMinAndMax",null);var z=i(6291);class G{get materialDefines(){return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:this._getDrawWrapper()?.defines}set materialDefines(e){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=e}_getDrawWrapper(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e=e??this._engine.currentRenderPassId;let i=this._drawWrappers[e];return!i&&t&&(this._drawWrappers[e]=i=new z.E(this._mesh.getScene().getEngine())),i}_removeDrawWrapper(e){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this._drawWrappers[e]?.dispose(),this._drawWrappers[e]=void 0}get effect(){return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:this._getDrawWrapper()?.effect??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(e){this._mainDrawWrapperOverride=e}setEffect(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const s=this._drawWrapper;s.setEffect(e,t,r),void 0!==i&&(s.materialContext=i),e||(s.defines=null,s.materialContext=void 0)}resetDrawCache(e){if(this._drawWrappers){if(void 0!==e)return void this._removeDrawWrapper(e);for(const e of this._drawWrappers)e?.dispose()}this._drawWrappers=[]}static AddToMesh(e,t,i,r,s,n,a){return new G(e,t,i,r,s,n,a,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(e,t,i,r,s,n,a){let o=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],l=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=e,this.verticesStart=t,this.verticesCount=i,this.indexStart=r,this.indexCount=s,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=n,this._renderingMesh=a||n,l&&n.subMeshes.push(this),this._engine=this._mesh.getScene().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=n.subMeshes.length-1,o&&(this.refreshBoundingInfo(),n.computeWorldMatrix(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(e){return this._boundingInfo=e,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const e=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return e||this._renderingMesh}getMaterial(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!t)return e?this._mesh.getScene().defaultMaterial:null;if(this._isMultiMaterial(t)){const e=t.getSubMaterial(this.materialIndex);return this._currentMaterial!==e&&(this._currentMaterial=e,this.resetDrawCache()),e}return t}_isMultiMaterial(e){return void 0!==e.getSubMaterial}refreshBoundingInfo(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.geometry)return this;if(e||(e=this._renderingMesh.getVerticesData(S.R.PositionKind)),!e)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const t=this._renderingMesh.getIndices();let i;if(0===this.indexStart&&this.indexCount===t.length){const e=this._renderingMesh.getBoundingInfo();i={minimum:e.minimum.clone(),maximum:e.maximum.clone()}}else i=function(e,t,i,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const n=new o.Pq(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),a=new o.Pq(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return U.extractMinAndMaxIndexed(e,t,i,r,n,a),s&&(n.x-=n.x*s.x+s.y,n.y-=n.y*s.x+s.y,n.z-=n.z*s.x+s.y,a.x+=a.x*s.x+s.y,a.y+=a.y*s.x+s.y,a.z+=a.z*s.x+s.y),{minimum:n,maximum:a}}(e,t,this.indexStart,this.indexCount,this._renderingMesh.geometry.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(i.minimum,i.maximum):this._boundingInfo=new k(i.minimum,i.maximum),this}_checkCollision(e){return this.getBoundingInfo()._checkCollision(e)}updateBoundingInfo(e){let t=this.getBoundingInfo();return t||(this.refreshBoundingInfo(),t=this.getBoundingInfo()),t&&t.update(e),this}isInFrustum(e){const t=this.getBoundingInfo();return!!t&&t.isInFrustum(e,this._mesh.cullingStrategy)}isCompletelyInFrustum(e){const t=this.getBoundingInfo();return!!t&&t.isCompletelyInFrustum(e)}render(e){return this._renderingMesh.render(this,e,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(e,t){if(!this._linesIndexBuffer){const i=[];for(let t=this.indexStart;t<this.indexStart+this.indexCount;t+=3)i.push(e[t],e[t+1],e[t+1],e[t+2],e[t+2],e[t]);this._linesIndexBuffer=t.createIndexBuffer(i),this._linesIndexCount=i.length}return this._linesIndexBuffer}canIntersects(e){const t=this.getBoundingInfo();return!!t&&e.intersectsBox(t.boundingBox)}intersects(e,t,i,r,s){const n=this.getMaterial();if(!n)return null;let a=3,o=!1;switch(n.fillMode){case 3:case 5:case 6:case 8:return null;case 7:a=1,o=!0}return 4===n.fillMode?i.length?this._intersectLines(e,t,i,this._mesh.intersectionThreshold,r):this._intersectUnIndexedLines(e,t,i,this._mesh.intersectionThreshold,r):!i.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(e,t,i,r,s):this._intersectTriangles(e,t,i,a,o,r,s)}_intersectLines(e,t,i,r,s){let n=null;for(let a=this.indexStart;a<this.indexStart+this.indexCount;a+=2){const o=t[i[a]],l=t[i[a+1]],h=e.intersectionSegment(o,l,r);if(!(h<0)&&((s||!n||h<n.distance)&&(n=new P(null,null,h),n.faceId=a/2,s)))break}return n}_intersectUnIndexedLines(e,t,i,r,s){let n=null;for(let a=this.verticesStart;a<this.verticesStart+this.verticesCount;a+=2){const i=t[a],o=t[a+1],l=e.intersectionSegment(i,o,r);if(!(l<0)&&((s||!n||l<n.distance)&&(n=new P(null,null,l),n.faceId=a/2,s)))break}return n}_intersectTriangles(e,t,i,r,s,n,a){let o=null,l=-1;for(let h=this.indexStart;h<this.indexStart+this.indexCount-(3-r);h+=r){l++;const r=i[h],c=i[h+1],u=i[h+2];if(s&&4294967295===u){h+=2;continue}const d=t[r],_=t[c],p=t[u];if(!d||!_||!p)continue;if(a&&!a(d,_,p,e,r,c,u))continue;const f=e.intersectsTriangle(d,_,p);if(f){if(f.distance<0)continue;if((n||!o||f.distance<o.distance)&&(o=f,o.faceId=l,n))break}}return o}_intersectUnIndexedTriangles(e,t,i,r,s){let n=null;for(let a=this.verticesStart;a<this.verticesStart+this.verticesCount;a+=3){const i=t[a],o=t[a+1],l=t[a+2];if(s&&!s(i,o,l,e,-1,-1,-1))continue;const h=e.intersectsTriangle(i,o,l);if(h){if(h.distance<0)continue;if((r||!n||h.distance<n.distance)&&(n=h,n.faceId=a/3,r))break}}return n}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(e,t){const i=new G(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,e,t,!1);if(!this.IsGlobal){const e=this.getBoundingInfo();if(!e)return i;i._boundingInfo=new k(e.minimum,e.maximum)}return i}dispose(){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const e=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(e,1),this.resetDrawCache()}getClassName(){return"SubMesh"}static CreateFromIndices(e,t,i,r,s){let n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=Number.MAX_VALUE,o=-Number.MAX_VALUE;const l=(s||r).getIndices();for(let h=t;h<t+i;h++){const e=l[h];e<a&&(a=e),e>o&&(o=e)}return new G(e,a,o-a+1,t,i,r,s,n)}}class H{}class W{constructor(){var e,t;this.uniqueId=0,this.metadata={},this._applyTo=(e=this._applyToCoroutine.bind(this),function(){return b(e(...arguments),t)}),this.uniqueId=W._UniqueIDGenerator,W._UniqueIDGenerator++}set(e,t){switch(e.length||T.V.Warn(`Setting vertex data kind '${t}' with an empty array`),t){case S.R.PositionKind:this.positions=e;break;case S.R.NormalKind:this.normals=e;break;case S.R.TangentKind:this.tangents=e;break;case S.R.UVKind:this.uvs=e;break;case S.R.UV2Kind:this.uvs2=e;break;case S.R.UV3Kind:this.uvs3=e;break;case S.R.UV4Kind:this.uvs4=e;break;case S.R.UV5Kind:this.uvs5=e;break;case S.R.UV6Kind:this.uvs6=e;break;case S.R.ColorKind:this.colors=e;break;case S.R.MatricesIndicesKind:this.matricesIndices=e;break;case S.R.MatricesWeightsKind:this.matricesWeights=e;break;case S.R.MatricesIndicesExtraKind:this.matricesIndicesExtra=e;break;case S.R.MatricesWeightsExtraKind:this.matricesWeightsExtra=e}}applyToMesh(e,t){return this._applyTo(e,t,!1),this}applyToGeometry(e,t){return this._applyTo(e,t,!1),this}updateMesh(e){return this._update(e),this}updateGeometry(e){return this._update(e),this}_applyToCoroutine(e){var t=this;let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0;return function*(){if(t.positions&&(e.setVerticesData(S.R.PositionKind,t.positions,i),r&&(yield)),t.normals&&(e.setVerticesData(S.R.NormalKind,t.normals,i),r&&(yield)),t.tangents&&(e.setVerticesData(S.R.TangentKind,t.tangents,i),r&&(yield)),t.uvs&&(e.setVerticesData(S.R.UVKind,t.uvs,i),r&&(yield)),t.uvs2&&(e.setVerticesData(S.R.UV2Kind,t.uvs2,i),r&&(yield)),t.uvs3&&(e.setVerticesData(S.R.UV3Kind,t.uvs3,i),r&&(yield)),t.uvs4&&(e.setVerticesData(S.R.UV4Kind,t.uvs4,i),r&&(yield)),t.uvs5&&(e.setVerticesData(S.R.UV5Kind,t.uvs5,i),r&&(yield)),t.uvs6&&(e.setVerticesData(S.R.UV6Kind,t.uvs6,i),r&&(yield)),t.colors&&(e.setVerticesData(S.R.ColorKind,t.colors,i),t.hasVertexAlpha&&void 0!==e.hasVertexAlpha&&(e.hasVertexAlpha=!0),r&&(yield)),t.matricesIndices&&(e.setVerticesData(S.R.MatricesIndicesKind,t.matricesIndices,i),r&&(yield)),t.matricesWeights&&(e.setVerticesData(S.R.MatricesWeightsKind,t.matricesWeights,i),r&&(yield)),t.matricesIndicesExtra&&(e.setVerticesData(S.R.MatricesIndicesExtraKind,t.matricesIndicesExtra,i),r&&(yield)),t.matricesWeightsExtra&&(e.setVerticesData(S.R.MatricesWeightsExtraKind,t.matricesWeightsExtra,i),r&&(yield)),t.indices?(e.setIndices(t.indices,null,i),r&&(yield)):e.setIndices([],null),e.subMeshes&&t.materialInfos&&t.materialInfos.length>1){const i=e;i.subMeshes=[];for(const e of t.materialInfos)new G(e.materialIndex,e.verticesStart,e.verticesCount,e.indexStart,e.indexCount,i)}return t}()}_update(e,t,i){return this.positions&&e.updateVerticesData(S.R.PositionKind,this.positions,t,i),this.normals&&e.updateVerticesData(S.R.NormalKind,this.normals,t,i),this.tangents&&e.updateVerticesData(S.R.TangentKind,this.tangents,t,i),this.uvs&&e.updateVerticesData(S.R.UVKind,this.uvs,t,i),this.uvs2&&e.updateVerticesData(S.R.UV2Kind,this.uvs2,t,i),this.uvs3&&e.updateVerticesData(S.R.UV3Kind,this.uvs3,t,i),this.uvs4&&e.updateVerticesData(S.R.UV4Kind,this.uvs4,t,i),this.uvs5&&e.updateVerticesData(S.R.UV5Kind,this.uvs5,t,i),this.uvs6&&e.updateVerticesData(S.R.UV6Kind,this.uvs6,t,i),this.colors&&e.updateVerticesData(S.R.ColorKind,this.colors,t,i),this.matricesIndices&&e.updateVerticesData(S.R.MatricesIndicesKind,this.matricesIndices,t,i),this.matricesWeights&&e.updateVerticesData(S.R.MatricesWeightsKind,this.matricesWeights,t,i),this.matricesIndicesExtra&&e.updateVerticesData(S.R.MatricesIndicesExtraKind,this.matricesIndicesExtra,t,i),this.matricesWeightsExtra&&e.updateVerticesData(S.R.MatricesWeightsExtraKind,this.matricesWeightsExtra,t,i),this.indices&&e.setIndices(this.indices,null),this}static _TransformVector3Coordinates(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length;const s=o.AA.Vector3[0],n=o.AA.Vector3[1];for(let a=i;a<i+r;a+=3)o.Pq.FromArrayToRef(e,a,s),o.Pq.TransformCoordinatesToRef(s,t,n),e[a]=n.x,e[a+1]=n.y,e[a+2]=n.z}static _TransformVector3Normals(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length;const s=o.AA.Vector3[0],n=o.AA.Vector3[1];for(let a=i;a<i+r;a+=3)o.Pq.FromArrayToRef(e,a,s),o.Pq.TransformNormalToRef(s,t,n),e[a]=n.x,e[a+1]=n.y,e[a+2]=n.z}static _TransformVector4Normals(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length;const s=o.AA.Vector4[0],n=o.AA.Vector4[1];for(let a=i;a<i+r;a+=4)o.IU.FromArrayToRef(e,a,s),o.IU.TransformNormalToRef(s,t,n),e[a]=n.x,e[a+1]=n.y,e[a+2]=n.z,e[a+3]=n.w}static _FlipFaces(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.length;for(let r=t;r<t+i;r+=3){const t=e[r+1];e[r+1]=e[r+2],e[r+2]=t}}transform(e){const t=e.determinant()<0;return this.positions&&W._TransformVector3Coordinates(this.positions,e),this.normals&&W._TransformVector3Normals(this.normals,e),this.tangents&&W._TransformVector4Normals(this.tangents,e),t&&this.indices&&W._FlipFaces(this.indices),this}splitBasedOnMaterialID(){if(!this.materialInfos||this.materialInfos.length<2)return[this];const e=[];for(const t of this.materialInfos){const i=new W;if(this.positions&&(i.positions=this.positions.slice(3*t.verticesStart,3*(t.verticesCount+t.verticesStart))),this.normals&&(i.normals=this.normals.slice(3*t.verticesStart,3*(t.verticesCount+t.verticesStart))),this.tangents&&(i.tangents=this.tangents.slice(4*t.verticesStart,4*(t.verticesCount+t.verticesStart))),this.colors&&(i.colors=this.colors.slice(4*t.verticesStart,4*(t.verticesCount+t.verticesStart))),this.uvs&&(i.uvs=this.uvs.slice(2*t.verticesStart,2*(t.verticesCount+t.verticesStart))),this.uvs2&&(i.uvs2=this.uvs2.slice(2*t.verticesStart,2*(t.verticesCount+t.verticesStart))),this.uvs3&&(i.uvs3=this.uvs3.slice(2*t.verticesStart,2*(t.verticesCount+t.verticesStart))),this.uvs4&&(i.uvs4=this.uvs4.slice(2*t.verticesStart,2*(t.verticesCount+t.verticesStart))),this.uvs5&&(i.uvs5=this.uvs5.slice(2*t.verticesStart,2*(t.verticesCount+t.verticesStart))),this.uvs6&&(i.uvs6=this.uvs6.slice(2*t.verticesStart,2*(t.verticesCount+t.verticesStart))),this.matricesIndices&&(i.matricesIndices=this.matricesIndices.slice(4*t.verticesStart,4*(t.verticesCount+t.verticesStart))),this.matricesIndicesExtra&&(i.matricesIndicesExtra=this.matricesIndicesExtra.slice(4*t.verticesStart,4*(t.verticesCount+t.verticesStart))),this.matricesWeights&&(i.matricesWeights=this.matricesWeights.slice(4*t.verticesStart,4*(t.verticesCount+t.verticesStart))),this.matricesWeightsExtra&&(i.matricesWeightsExtra=this.matricesWeightsExtra.slice(4*t.verticesStart,4*(t.verticesCount+t.verticesStart))),this.indices){i.indices=[];for(let e=t.indexStart;e<t.indexStart+t.indexCount;e++)i.indices.push(this.indices[e]-t.verticesStart)}const r=new H;r.indexStart=0,r.indexCount=i.indices?i.indices.length:0,r.materialIndex=t.materialIndex,r.verticesStart=0,r.verticesCount=(i.positions?i.positions.length:0)/3,i.materialInfos=[r],e.push(i)}return e}merge(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const n=Array.isArray(e)?e.map((e=>({vertexData:e}))):[{vertexData:e}];return b(this._mergeCoroutine(void 0,n,t,!1,i,r,s))}_mergeCoroutine(e,t){var i=this;let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return function*(){i._validate();let l=t.map((e=>e.vertexData)),h=i;if(o)for(const e of l)e&&(e._validate(),!i.normals&&e.normals&&(i.normals=new Float32Array(i.positions.length)),!i.tangents&&e.tangents&&(i.tangents=new Float32Array(i.positions.length/3*4)),!i.uvs&&e.uvs&&(i.uvs=new Float32Array(i.positions.length/3*2)),!i.uvs2&&e.uvs2&&(i.uvs2=new Float32Array(i.positions.length/3*2)),!i.uvs3&&e.uvs3&&(i.uvs3=new Float32Array(i.positions.length/3*2)),!i.uvs4&&e.uvs4&&(i.uvs4=new Float32Array(i.positions.length/3*2)),!i.uvs5&&e.uvs5&&(i.uvs5=new Float32Array(i.positions.length/3*2)),!i.uvs6&&e.uvs6&&(i.uvs6=new Float32Array(i.positions.length/3*2)),!i.colors&&e.colors&&(i.colors=new Float32Array(i.positions.length/3*4),i.colors.fill(1)),!i.matricesIndices&&e.matricesIndices&&(i.matricesIndices=new Float32Array(i.positions.length/3*4)),!i.matricesWeights&&e.matricesWeights&&(i.matricesWeights=new Float32Array(i.positions.length/3*4)),!i.matricesIndicesExtra&&e.matricesIndicesExtra&&(i.matricesIndicesExtra=new Float32Array(i.positions.length/3*4)),!i.matricesWeightsExtra&&e.matricesWeightsExtra&&(i.matricesWeightsExtra=new Float32Array(i.positions.length/3*4)));for(const e of l)if(e)if(o)i.normals&&!e.normals&&(e.normals=new Float32Array(e.positions.length)),i.tangents&&!e.tangents&&(e.tangents=new Float32Array(e.positions.length/3*4)),i.uvs&&!e.uvs&&(e.uvs=new Float32Array(e.positions.length/3*2)),i.uvs2&&!e.uvs2&&(e.uvs2=new Float32Array(e.positions.length/3*2)),i.uvs3&&!e.uvs3&&(e.uvs3=new Float32Array(e.positions.length/3*2)),i.uvs4&&!e.uvs4&&(e.uvs4=new Float32Array(e.positions.length/3*2)),i.uvs5&&!e.uvs5&&(e.uvs5=new Float32Array(e.positions.length/3*2)),i.uvs6&&!e.uvs6&&(e.uvs6=new Float32Array(e.positions.length/3*2)),i.colors&&!e.colors&&(e.colors=new Float32Array(e.positions.length/3*4),e.colors.fill(1)),i.matricesIndices&&!e.matricesIndices&&(e.matricesIndices=new Float32Array(e.positions.length/3*4)),i.matricesWeights&&!e.matricesWeights&&(e.matricesWeights=new Float32Array(e.positions.length/3*4)),i.matricesIndicesExtra&&!e.matricesIndicesExtra&&(e.matricesIndicesExtra=new Float32Array(e.positions.length/3*4)),i.matricesWeightsExtra&&!e.matricesWeightsExtra&&(e.matricesWeightsExtra=new Float32Array(e.positions.length/3*4));else if(e._validate(),!i.normals!==!e.normals||!i.tangents!==!e.tangents||!i.uvs!==!e.uvs||!i.uvs2!==!e.uvs2||!i.uvs3!==!e.uvs3||!i.uvs4!==!e.uvs4||!i.uvs5!==!e.uvs5||!i.uvs6!==!e.uvs6||!i.colors!==!e.colors||!i.matricesIndices!==!e.matricesIndices||!i.matricesWeights!==!e.matricesWeights||!i.matricesIndicesExtra!==!e.matricesIndicesExtra||!i.matricesWeightsExtra!==!e.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(a){let r=0,s=0,n=0;const a=[];let o=null;const c=[];for(const t of i.splitBasedOnMaterialID())c.push({vertexData:t,transform:e});for(const e of t)if(e.vertexData)for(const t of e.vertexData.splitBasedOnMaterialID())c.push({vertexData:t,transform:e.transform});c.sort(((e,t)=>{const i=e.vertexData.materialInfos?e.vertexData.materialInfos[0].materialIndex:0,r=t.vertexData.materialInfos?t.vertexData.materialInfos[0].materialIndex:0;return i>r?1:i===r?0:-1}));for(const e of c){const t=e.vertexData;if(r=t.materialInfos?t.materialInfos[0].materialIndex:0,o&&o.materialIndex===r)o.indexCount+=t.indices.length,o.verticesCount+=t.positions.length/3;else{const e=new H;e.materialIndex=r,e.indexStart=s,e.indexCount=t.indices.length,e.verticesStart=n,e.verticesCount=t.positions.length/3,a.push(e),o=e}s+=t.indices.length,n+=t.positions.length/3}const u=c.splice(0,1)[0];h=u.vertexData,e=u.transform,l=c.map((e=>e.vertexData)),t=c,i.materialInfos=a}const c=l.reduce(((e,t)=>e+(t.indices?.length??0)),h.indices?.length??0);let u=n||l.some((e=>e.indices===h.indices))?h.indices?.slice():h.indices;if(c>0){let i=u?.length??0;if(u||(u=new Array(c)),u.length!==c){if(Array.isArray(u))u.length=c;else{const e=r||u instanceof Uint32Array?new Uint32Array(c):new Uint16Array(c);e.set(u),u=e}e&&e.determinant()<0&&W._FlipFaces(u,0,i)}let n=h.positions?h.positions.length/3:0;for(const{vertexData:e,transform:r}of t)if(e.indices){for(let t=0;t<e.indices.length;t++)u[i+t]=e.indices[t]+n;r&&r.determinant()<0&&W._FlipFaces(u,i,e.indices.length),n+=e.positions.length/3,i+=e.indices.length,s&&(yield)}}return i.indices=u,i.positions=W._MergeElement(S.R.PositionKind,h.positions,e,t.map((e=>[e.vertexData.positions,e.transform]))),s&&(yield),h.normals&&(i.normals=W._MergeElement(S.R.NormalKind,h.normals,e,t.map((e=>[e.vertexData.normals,e.transform]))),s&&(yield)),h.tangents&&(i.tangents=W._MergeElement(S.R.TangentKind,h.tangents,e,t.map((e=>[e.vertexData.tangents,e.transform]))),s&&(yield)),h.uvs&&(i.uvs=W._MergeElement(S.R.UVKind,h.uvs,e,t.map((e=>[e.vertexData.uvs,e.transform]))),s&&(yield)),h.uvs2&&(i.uvs2=W._MergeElement(S.R.UV2Kind,h.uvs2,e,t.map((e=>[e.vertexData.uvs2,e.transform]))),s&&(yield)),h.uvs3&&(i.uvs3=W._MergeElement(S.R.UV3Kind,h.uvs3,e,t.map((e=>[e.vertexData.uvs3,e.transform]))),s&&(yield)),h.uvs4&&(i.uvs4=W._MergeElement(S.R.UV4Kind,h.uvs4,e,t.map((e=>[e.vertexData.uvs4,e.transform]))),s&&(yield)),h.uvs5&&(i.uvs5=W._MergeElement(S.R.UV5Kind,h.uvs5,e,t.map((e=>[e.vertexData.uvs5,e.transform]))),s&&(yield)),h.uvs6&&(i.uvs6=W._MergeElement(S.R.UV6Kind,h.uvs6,e,t.map((e=>[e.vertexData.uvs6,e.transform]))),s&&(yield)),h.colors&&(i.colors=W._MergeElement(S.R.ColorKind,h.colors,e,t.map((e=>[e.vertexData.colors,e.transform]))),(void 0!==h.hasVertexAlpha||t.some((e=>void 0!==e.vertexData.hasVertexAlpha)))&&(i.hasVertexAlpha=h.hasVertexAlpha||t.some((e=>e.vertexData.hasVertexAlpha))),s&&(yield)),h.matricesIndices&&(i.matricesIndices=W._MergeElement(S.R.MatricesIndicesKind,h.matricesIndices,e,t.map((e=>[e.vertexData.matricesIndices,e.transform]))),s&&(yield)),h.matricesWeights&&(i.matricesWeights=W._MergeElement(S.R.MatricesWeightsKind,h.matricesWeights,e,t.map((e=>[e.vertexData.matricesWeights,e.transform]))),s&&(yield)),h.matricesIndicesExtra&&(i.matricesIndicesExtra=W._MergeElement(S.R.MatricesIndicesExtraKind,h.matricesIndicesExtra,e,t.map((e=>[e.vertexData.matricesIndicesExtra,e.transform]))),s&&(yield)),h.matricesWeightsExtra&&(i.matricesWeightsExtra=W._MergeElement(S.R.MatricesWeightsExtraKind,h.matricesWeightsExtra,e,t.map((e=>[e.vertexData.matricesWeightsExtra,e.transform])))),i}()}static _MergeElement(e,t,i,r){const s=r.filter((e=>null!==e[0]&&void 0!==e[0]));if(!t&&0==s.length)return t;if(!t)return this._MergeElement(e,s[0][0],s[0][1],s.slice(1));const n=s.reduce(((e,t)=>e+t[0].length),t.length),a=e===S.R.PositionKind?W._TransformVector3Coordinates:e===S.R.NormalKind?W._TransformVector3Normals:e===S.R.TangentKind?W._TransformVector4Normals:()=>{};if(t instanceof Float32Array){const e=new Float32Array(n);e.set(t),i&&a(e,i,0,t.length);let r=t.length;for(const[t,i]of s)e.set(t,r),i&&a(e,i,r,t.length),r+=t.length;return e}{const e=new Array(n);for(let i=0;i<t.length;i++)e[i]=t[i];i&&a(e,i,0,t.length);let r=t.length;for(const[t,i]of s){for(let i=0;i<t.length;i++)e[r+i]=t[i];i&&a(e,i,r,t.length),r+=t.length}return e}}_validate(){if(!this.positions)throw new M.bu("Positions are required",M.tG.MeshInvalidPositionsError);const e=(e,t)=>{const i=S.R.DeduceStride(e);if(t.length%i!==0)throw new Error("The "+e+"s array count must be a multiple of "+i);return t.length/i},t=e(S.R.PositionKind,this.positions),i=(i,r)=>{const s=e(i,r);if(s!==t)throw new Error("The "+i+"s element count ("+s+") does not match the positions count ("+t+")")};this.normals&&i(S.R.NormalKind,this.normals),this.tangents&&i(S.R.TangentKind,this.tangents),this.uvs&&i(S.R.UVKind,this.uvs),this.uvs2&&i(S.R.UV2Kind,this.uvs2),this.uvs3&&i(S.R.UV3Kind,this.uvs3),this.uvs4&&i(S.R.UV4Kind,this.uvs4),this.uvs5&&i(S.R.UV5Kind,this.uvs5),this.uvs6&&i(S.R.UV6Kind,this.uvs6),this.colors&&i(S.R.ColorKind,this.colors),this.matricesIndices&&i(S.R.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&i(S.R.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&i(S.R.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&i(S.R.MatricesWeightsExtraKind,this.matricesWeightsExtra)}clone(){const e=this.serialize();return W.Parse(e)}serialize(){const e={};if(this.positions&&(e.positions=Array.from(this.positions)),this.normals&&(e.normals=Array.from(this.normals)),this.tangents&&(e.tangents=Array.from(this.tangents)),this.uvs&&(e.uvs=Array.from(this.uvs)),this.uvs2&&(e.uvs2=Array.from(this.uvs2)),this.uvs3&&(e.uvs3=Array.from(this.uvs3)),this.uvs4&&(e.uvs4=Array.from(this.uvs4)),this.uvs5&&(e.uvs5=Array.from(this.uvs5)),this.uvs6&&(e.uvs6=Array.from(this.uvs6)),this.colors&&(e.colors=Array.from(this.colors),e.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(e.matricesIndices=Array.from(this.matricesIndices),e.matricesIndices._isExpanded=!0),this.matricesWeights&&(e.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(e.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),e.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(e.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),e.indices=Array.from(this.indices),this.materialInfos){e.materialInfos=[];for(const t of this.materialInfos){const i={indexStart:t.indexStart,indexCount:t.indexCount,materialIndex:t.materialIndex,verticesStart:t.verticesStart,verticesCount:t.verticesCount};e.materialInfos.push(i)}}return e}static ExtractFromMesh(e,t,i){return W._ExtractFrom(e,t,i)}static ExtractFromGeometry(e,t,i){return W._ExtractFrom(e,t,i)}static _ExtractFrom(e,t,i){const r=new W;if(e.isVerticesDataPresent(S.R.PositionKind)&&(r.positions=e.getVerticesData(S.R.PositionKind,t,i)),e.isVerticesDataPresent(S.R.NormalKind)&&(r.normals=e.getVerticesData(S.R.NormalKind,t,i)),e.isVerticesDataPresent(S.R.TangentKind)&&(r.tangents=e.getVerticesData(S.R.TangentKind,t,i)),e.isVerticesDataPresent(S.R.UVKind)&&(r.uvs=e.getVerticesData(S.R.UVKind,t,i)),e.isVerticesDataPresent(S.R.UV2Kind)&&(r.uvs2=e.getVerticesData(S.R.UV2Kind,t,i)),e.isVerticesDataPresent(S.R.UV3Kind)&&(r.uvs3=e.getVerticesData(S.R.UV3Kind,t,i)),e.isVerticesDataPresent(S.R.UV4Kind)&&(r.uvs4=e.getVerticesData(S.R.UV4Kind,t,i)),e.isVerticesDataPresent(S.R.UV5Kind)&&(r.uvs5=e.getVerticesData(S.R.UV5Kind,t,i)),e.isVerticesDataPresent(S.R.UV6Kind)&&(r.uvs6=e.getVerticesData(S.R.UV6Kind,t,i)),e.isVerticesDataPresent(S.R.ColorKind)){const s=e.geometry||e,n=s.getVertexBuffer(S.R.ColorKind),a=s.getVerticesData(S.R.ColorKind,t,i);if(3===n.getSize()){const e=new Float32Array(4*a.length/3);for(let t=0,i=0;t<a.length;t+=3,i+=4)e[i]=a[t],e[i+1]=a[t+1],e[i+2]=a[t+2],e[i+3]=1;r.colors=e}else{if(4!==n.getSize())throw new Error(`Unexpected number of color components: ${n.getSize()}`);r.colors=a}}return e.isVerticesDataPresent(S.R.MatricesIndicesKind)&&(r.matricesIndices=e.getVerticesData(S.R.MatricesIndicesKind,t,i)),e.isVerticesDataPresent(S.R.MatricesWeightsKind)&&(r.matricesWeights=e.getVerticesData(S.R.MatricesWeightsKind,t,i)),e.isVerticesDataPresent(S.R.MatricesIndicesExtraKind)&&(r.matricesIndicesExtra=e.getVerticesData(S.R.MatricesIndicesExtraKind,t,i)),e.isVerticesDataPresent(S.R.MatricesWeightsExtraKind)&&(r.matricesWeightsExtra=e.getVerticesData(S.R.MatricesWeightsExtraKind,t,i)),r.indices=e.getIndices(t,i),r}static CreateRibbon(e){throw(0,h.n)("ribbonBuilder")}static CreateBox(e){throw(0,h.n)("boxBuilder")}static CreateTiledBox(e){throw(0,h.n)("tiledBoxBuilder")}static CreateTiledPlane(e){throw(0,h.n)("tiledPlaneBuilder")}static CreateSphere(e){throw(0,h.n)("sphereBuilder")}static CreateCylinder(e){throw(0,h.n)("cylinderBuilder")}static CreateTorus(e){throw(0,h.n)("torusBuilder")}static CreateLineSystem(e){throw(0,h.n)("linesBuilder")}static CreateDashedLines(e){throw(0,h.n)("linesBuilder")}static CreateGround(e){throw(0,h.n)("groundBuilder")}static CreateTiledGround(e){throw(0,h.n)("groundBuilder")}static CreateGroundFromHeightMap(e){throw(0,h.n)("groundBuilder")}static CreatePlane(e){throw(0,h.n)("planeBuilder")}static CreateDisc(e){throw(0,h.n)("discBuilder")}static CreatePolygon(e,t,i,r,s,n,a){throw(0,h.n)("polygonBuilder")}static CreateIcoSphere(e){throw(0,h.n)("icoSphereBuilder")}static CreatePolyhedron(e){throw(0,h.n)("polyhedronBuilder")}static CreateCapsule(){arguments.length>0&&void 0!==arguments[0]||o.Pq.Up();throw(0,h.n)("capsuleBuilder")}static CreateTorusKnot(e){throw(0,h.n)("torusKnotBuilder")}static ComputeNormals(e,t,i,r){let s=0,n=0,a=0,l=0,h=0,c=0,u=0,d=0,_=0,p=0,f=0,g=0,m=0,b=0,v=0,y=0,T=0,x=0,A=0,C=0,R=!1,E=!1,S=!1,M=!1,P=1,I=0,O=null;r&&(R=!!r.facetNormals,E=!!r.facetPositions,S=!!r.facetPartitioning,P=!0===r.useRightHandedSystem?-1:1,I=r.ratio||0,M=!!r.depthSort,O=r.distanceTo,M&&void 0===O&&(O=o.Pq.Zero()));let D=0,w=0,F=0,L=0;for(S&&r&&r.bbSize&&(D=r.subDiv.X*I/r.bbSize.x,w=r.subDiv.Y*I/r.bbSize.y,F=r.subDiv.Z*I/r.bbSize.z,L=r.subDiv.max*r.subDiv.max,r.facetPartitioning.length=0),s=0;s<e.length;s++)i[s]=0;const B=t.length/3|0;for(s=0;s<B;s++){if(g=3*t[3*s],m=g+1,b=g+2,v=3*t[3*s+1],y=v+1,T=v+2,x=3*t[3*s+2],A=x+1,C=x+2,n=e[g]-e[v],a=e[m]-e[y],l=e[b]-e[T],h=e[x]-e[v],c=e[A]-e[y],u=e[C]-e[T],d=P*(a*u-l*c),_=P*(l*h-n*u),p=P*(n*c-a*h),f=Math.sqrt(d*d+_*_+p*p),f=0===f?1:f,d/=f,_/=f,p/=f,R&&r&&(r.facetNormals[s].x=d,r.facetNormals[s].y=_,r.facetNormals[s].z=p),E&&r&&(r.facetPositions[s].x=(e[g]+e[v]+e[x])/3,r.facetPositions[s].y=(e[m]+e[y]+e[A])/3,r.facetPositions[s].z=(e[b]+e[T]+e[C])/3),S&&r){const t=Math.floor((r.facetPositions[s].x-r.bInfo.minimum.x*I)*D),i=Math.floor((r.facetPositions[s].y-r.bInfo.minimum.y*I)*w),n=Math.floor((r.facetPositions[s].z-r.bInfo.minimum.z*I)*F),a=Math.floor((e[g]-r.bInfo.minimum.x*I)*D),o=Math.floor((e[m]-r.bInfo.minimum.y*I)*w),l=Math.floor((e[b]-r.bInfo.minimum.z*I)*F),h=Math.floor((e[v]-r.bInfo.minimum.x*I)*D),c=Math.floor((e[y]-r.bInfo.minimum.y*I)*w),u=Math.floor((e[T]-r.bInfo.minimum.z*I)*F),d=Math.floor((e[x]-r.bInfo.minimum.x*I)*D),_=Math.floor((e[A]-r.bInfo.minimum.y*I)*w),p=Math.floor((e[C]-r.bInfo.minimum.z*I)*F),f=a+r.subDiv.max*o+L*l,R=h+r.subDiv.max*c+L*u,E=d+r.subDiv.max*_+L*p,S=t+r.subDiv.max*i+L*n;r.facetPartitioning[S]=r.facetPartitioning[S]?r.facetPartitioning[S]:new Array,r.facetPartitioning[f]=r.facetPartitioning[f]?r.facetPartitioning[f]:new Array,r.facetPartitioning[R]=r.facetPartitioning[R]?r.facetPartitioning[R]:new Array,r.facetPartitioning[E]=r.facetPartitioning[E]?r.facetPartitioning[E]:new Array,r.facetPartitioning[f].push(s),R!=f&&r.facetPartitioning[R].push(s),E!=R&&E!=f&&r.facetPartitioning[E].push(s),S!=f&&S!=R&&S!=E&&r.facetPartitioning[S].push(s)}if(M&&r&&r.facetPositions){const e=r.depthSortedFacets[s];e.ind=3*s,e.sqDistance=o.Pq.DistanceSquared(r.facetPositions[s],O)}i[g]+=d,i[m]+=_,i[b]+=p,i[v]+=d,i[y]+=_,i[T]+=p,i[x]+=d,i[A]+=_,i[C]+=p}for(s=0;s<i.length/3;s++)d=i[3*s],_=i[3*s+1],p=i[3*s+2],f=Math.sqrt(d*d+_*_+p*p),f=0===f?1:f,d/=f,_/=f,p/=f,i[3*s]=d,i[3*s+1]=_,i[3*s+2]=p}static _ComputeSides(e,t,i,r,s,n,a){const l=i.length,h=r.length;let c,u;switch(e=e||W.DEFAULTSIDE){case W.FRONTSIDE:break;case W.BACKSIDE:for(c=0;c<l;c+=3){const e=i[c];i[c]=i[c+2],i[c+2]=e}for(u=0;u<h;u++)r[u]=-r[u];break;case W.DOUBLESIDE:{const e=t.length,d=e/3;for(let i=0;i<e;i++)t[e+i]=t[i];for(c=0;c<l;c+=3)i[c+l]=i[c+2]+d,i[c+1+l]=i[c+1]+d,i[c+2+l]=i[c]+d;for(u=0;u<h;u++)r[h+u]=-r[u];const _=s.length;let p=0;for(p=0;p<_;p++)s[p+_]=s[p];for(n=n||new o.IU(0,0,1,1),a=a||new o.IU(0,0,1,1),p=0,c=0;c<_/2;c++)s[p]=n.x+(n.z-n.x)*s[p],s[p+1]=n.y+(n.w-n.y)*s[p+1],s[p+_]=a.x+(a.z-a.x)*s[p+_],s[p+_+1]=a.y+(a.w-a.y)*s[p+_+1],p+=2;break}}}static Parse(e){const t=new W,i=e.positions;i&&t.set(i,S.R.PositionKind);const r=e.normals;r&&t.set(r,S.R.NormalKind);const s=e.tangents;s&&t.set(s,S.R.TangentKind);const n=e.uvs;n&&t.set(n,S.R.UVKind);const a=e.uvs2;a&&t.set(a,S.R.UV2Kind);const o=e.uvs3;o&&t.set(o,S.R.UV3Kind);const l=e.uvs4;l&&t.set(l,S.R.UV4Kind);const h=e.uvs5;h&&t.set(h,S.R.UV5Kind);const c=e.uvs6;c&&t.set(c,S.R.UV6Kind);const u=e.colors;u&&(t.set(E.ov.CheckColors4(u,i.length/3),S.R.ColorKind),void 0!==e.hasVertexAlpha&&(t.hasVertexAlpha=e.hasVertexAlpha));const d=e.matricesIndices;d&&t.set(d,S.R.MatricesIndicesKind);const _=e.matricesWeights;_&&t.set(_,S.R.MatricesWeightsKind);const p=e.indices;p&&(t.indices=p);const f=e.materialInfos;if(f){t.materialInfos=[];for(const e of f){const i=new H;i.indexCount=e.indexCount,i.indexStart=e.indexStart,i.verticesCount=e.verticesCount,i.verticesStart=e.verticesStart,i.materialIndex=e.materialIndex,t.materialInfos.push(i)}}return t}static ImportVertexData(e,t){const i=W.Parse(e);t.setAllVerticesData(i,e.updatable)}}W.FRONTSIDE=0,W.BACKSIDE=1,W.DOUBLESIDE=2,W.DEFAULTSIDE=0,W._UniqueIDGenerator=0,(0,s.Cg)([n.Cx.filter((function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];let[r]=t;return!Array.isArray(r)}))],W,"_TransformVector3Coordinates",null),(0,s.Cg)([n.Cx.filter((function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];let[r]=t;return!Array.isArray(r)}))],W,"_TransformVector3Normals",null),(0,s.Cg)([n.Cx.filter((function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];let[r]=t;return!Array.isArray(r)}))],W,"_TransformVector4Normals",null),(0,s.Cg)([n.Cx.filter((function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];let[r]=t;return!Array.isArray(r)}))],W,"_FlipFaces",null);class q{static get ForceFullSceneLoadingForIncremental(){return q._ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(e){q._ForceFullSceneLoadingForIncremental=e}static get ShowLoadingScreen(){return q._ShowLoadingScreen}static set ShowLoadingScreen(e){q._ShowLoadingScreen=e}static get loggingLevel(){return q._LoggingLevel}static set loggingLevel(e){q._LoggingLevel=e}static get CleanBoneMatrixWeights(){return q._CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(e){q._CleanBoneMatrixWeights=e}}q._ForceFullSceneLoadingForIncremental=!1,q._ShowLoadingScreen=!0,q._CleanBoneMatrixWeights=!1,q._LoggingLevel=0;var X=i(8458);class K{get boundingBias(){return this._boundingBias}set boundingBias(e){this._boundingBias?this._boundingBias.copyFrom(e):this._boundingBias=e.clone(),this._updateBoundingInfo(!0,null)}static CreateGeometryForMesh(e){const t=new K(K.RandomId(),e.getScene());return t.applyToMesh(e),t}get meshes(){return this._meshes}constructor(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=t||l.q.LastCreatedScene,this._scene&&(this.id=e,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=r,i?this.setAllVerticesData(i,r):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),s&&(this.applyToMesh(s),s.computeWorldMatrix(!0)))}get extend(){return this._extend}getScene(){return this._scene}getEngine(){return this._engine}isReady(){return 1===this.delayLoadState||0===this.delayLoadState}get doNotSerialize(){for(let e=0;e<this._meshes.length;e++)if(!this._meshes[e].doNotSerialize)return!1;return!0}_rebuild(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer"));const e=new Set;for(const t in this._vertexBuffers)e.add(this._vertexBuffers[t].getWrapperBuffer());e.forEach((e=>{e._rebuild()}))}setAllVerticesData(e,t){e.applyToGeometry(this,t),this._notifyUpdate()}setVerticesData(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0;i&&Array.isArray(t)&&(t=new Float32Array(t));const s=new S.R(this._engine,t,e,{updatable:i,postponeInternalCreation:0===this._meshes.length,stride:r,label:"Geometry_"+this.id+"_"+e});this.setVerticesBuffer(s)}removeVerticesData(e){this._vertexBuffers[e]&&(this._vertexBuffers[e].dispose(),delete this._vertexBuffers[e]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}setVerticesBuffer(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=e.getKind();this._vertexBuffers[r]&&i&&this._vertexBuffers[r].dispose(),e._buffer&&e._buffer._increaseReferences(),this._vertexBuffers[r]=e;const s=this._meshes,n=s.length;if(r===S.R.PositionKind){this._totalVertices=t??e._maxVerticesCount,this._updateExtend(e.getFloatData(this._totalVertices)),this._resetPointsArrayCache();const i=this._extend&&this._extend.minimum||new o.Pq(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),r=this._extend&&this._extend.maximum||new o.Pq(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let e=0;e<n;e++){const t=s[e];t.buildBoundingInfo(i,r),t._createGlobalSubMesh(t.isUnIndexed),t.computeWorldMatrix(!0),t.synchronizeInstances()}}this._notifyUpdate(r)}updateVerticesDataDirectly(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const s=this.getVertexBuffer(e);s&&(s.updateDirectly(t,i,r),this._notifyUpdate(e))}updateVerticesData(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=this.getVertexBuffer(e);r&&(r.update(t),e===S.R.PositionKind&&this._updateBoundingInfo(i,t),this._notifyUpdate(e))}_updateBoundingInfo(e,t){if(e&&this._updateExtend(t),this._resetPointsArrayCache(),e){const e=this._meshes;for(const t of e){t.hasBoundingInfo?t.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):t.buildBoundingInfo(this._extend.minimum,this._extend.maximum);const e=t.subMeshes;for(const t of e)t.refreshBoundingInfo()}}}_bind(e,t,i,r){if(!e)return;void 0===t&&(t=this._indexBuffer);const s=this.getVertexBuffers();if(!s)return;if(t!=this._indexBuffer||!this._vertexArrayObjects&&!r)return void this._engine.bindBuffers(s,t,e,i);const n=r||this._vertexArrayObjects,a=this._engine;n[e.key]||(n[e.key]=a.recordVertexArrayObject(s,t,e,i)),a.bindVertexArrayObject(n[e.key],t)}getTotalVertices(){return this.isReady()?this._totalVertices:0}getVerticesData(e,t,i){const r=this.getVertexBuffer(e);return r?r.getFloatData(this._totalVertices,i||t&&1!==this._meshes.length):null}copyVerticesData(e,t){const i=this.getVertexBuffer(e);if(!i)return;t[e]||(t[e]=new Float32Array(this._totalVertices*i.getSize()));const r=i.getData();r&&function(e,t,i,r,s,n,a,o){const l=t*S.R.GetTypeByteLength(i),h=a*t;if(o.length!==h)throw new Error("Output length is not valid");if(i===S.R.FLOAT&&s===l)if(e instanceof Array){const t=r/4;o.set(e,t)}else if(e instanceof ArrayBuffer){const t=new Float32Array(e,r,h);o.set(t)}else{const t=e.byteOffset+r;if(t%4)return T.V.Warn("CopyFloatData: copied misaligned data."),void o.set(new Float32Array(e.buffer.slice(t,t+4*h)));const i=new Float32Array(e.buffer,t,h);o.set(i)}else S.R.ForEach(e,r,s,t,i,h,n,((e,t)=>o[t]=e))}(r,i.getSize(),i.type,i.byteOffset,i.byteStride,i.normalized,this._totalVertices,t[e])}isVertexBufferUpdatable(e){const t=this._vertexBuffers[e];return!!t&&t.isUpdatable()}getVertexBuffer(e){return this.isReady()?this._vertexBuffers[e]:null}getVertexBuffers(){return this.isReady()?this._vertexBuffers:null}isVerticesDataPresent(e){return this._vertexBuffers?void 0!==this._vertexBuffers[e]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)}getVerticesDataKinds(){const e=[];let t;if(!this._vertexBuffers&&this._delayInfo)for(t in this._delayInfo)e.push(t);else for(t in this._vertexBuffers)e.push(t);return e}updateIndices(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._indexBuffer)if(this._indexBufferIsUpdatable){const r=e.length!==this._indices.length;if(i||(this._indices=e.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,e,t),r)for(const e of this._meshes)e._createGlobalSubMesh(!0)}else this.setIndices(e,null,!0)}setIndexBuffer(e,t,i){this._indices=[],this._indexBufferIsUpdatable=!1,this._indexBuffer=e,this._totalVertices=t,this._totalIndices=i,e.is32Bits||(e.is32Bits=this._totalIndices>65535);for(const r of this._meshes)r._createGlobalSubMesh(!0),r.synchronizeInstances();this._notifyUpdate()}setIndices(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=e,this._indexBufferIsUpdatable=i,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,i,"Geometry_"+this.id+"_IndexBuffer")),void 0!=t&&(this._totalVertices=t);for(const r of this._meshes)r._createGlobalSubMesh(!0),r.synchronizeInstances();this._notifyUpdate()}getTotalIndices(){return this.isReady()?void 0!==this._totalIndices?this._totalIndices:this._indices.length:0}getIndices(e,t){if(!this.isReady())return null;const i=this._indices;return t||e&&1!==this._meshes.length?i.slice():i}getIndexBuffer(){return this.isReady()?this._indexBuffer:null}_releaseVertexArrayObject(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e&&this._vertexArrayObjects&&this._vertexArrayObjects[e.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[e.key]),delete this._vertexArrayObjects[e.key])}releaseForMesh(e,t){const i=this._meshes,r=i.indexOf(e);-1!==r&&(i.splice(r,1),this._vertexArrayObjects&&e._invalidateInstanceVertexArrayObject(),e._geometry=null,0===i.length&&t&&this.dispose())}applyToMesh(e){if(e._geometry===this)return;const t=e._geometry;t&&t.releaseForMesh(e),this._vertexArrayObjects&&e._invalidateInstanceVertexArrayObject();const i=this._meshes;e._geometry=this,e._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),i.push(e),this.isReady()?this._applyToMesh(e):this._boundingInfo&&e.setBoundingInfo(this._boundingInfo)}_updateExtend(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!e&&(e=this.getVerticesData(S.R.PositionKind),!e))return;this._extend=V(e,0,this._totalVertices,this.boundingBias,3)}}_applyToMesh(e){const t=this._meshes.length;for(const i in this._vertexBuffers)1===t&&this._vertexBuffers[i].create(),i===S.R.PositionKind&&(this._extend||this._updateExtend(),e.buildBoundingInfo(this._extend.minimum,this._extend.maximum),e._createGlobalSubMesh(e.isUnIndexed),e._updateBoundingInfo());1===t&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer")),e._syncGeometryWithMorphTargetManager(),e.synchronizeInstances()}_notifyUpdate(e){this.onGeometryUpdated&&this.onGeometryUpdated(this,e),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(const t of this._meshes)t._markSubMeshesAsAttributesDirty()}load(e,t){2!==this.delayLoadState&&(this.isReady()?t&&t():(this.delayLoadState=2,this._queueLoad(e,t)))}_queueLoad(e,t){this.delayLoadingFile&&(e.addPendingData(this),e._loadFile(this.delayLoadingFile,(i=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(i),this),this.delayLoadState=1,this._delayInfo=[],e.removePendingData(this);const r=this._meshes,s=r.length;for(let e=0;e<s;e++)this._applyToMesh(r[e]);t&&t()}),void 0,!0))}toLeftHanded(){const e=this.getIndices(!1);if(null!=e&&e.length>0){for(let t=0;t<e.length;t+=3){const i=e[t+0];e[t+0]=e[t+2],e[t+2]=i}this.setIndices(e)}const t=this.getVerticesData(S.R.PositionKind,!1);if(null!=t&&t.length>0){for(let e=0;e<t.length;e+=3)t[e+2]=-t[e+2];this.setVerticesData(S.R.PositionKind,t,!1)}const i=this.getVerticesData(S.R.NormalKind,!1);if(null!=i&&i.length>0){for(let e=0;e<i.length;e+=3)i[e+2]=-i[e+2];this.setVerticesData(S.R.NormalKind,i,!1)}}_resetPointsArrayCache(){this._positions=null}_generatePointsArray(){if(this._positions)return!0;const e=this.getVerticesData(S.R.PositionKind);if(!e||0===e.length)return!1;for(let t=3*this._positionsCache.length,i=this._positionsCache.length;t<e.length;t+=3,++i)this._positionsCache[i]=o.Pq.FromArray(e,t);for(let t=0,i=0;t<e.length;t+=3,++i)this._positionsCache[i].set(e[0+t],e[1+t],e[2+t]);return this._positionsCache.length=e.length/3,this._positions=this._positionsCache,!0}isDisposed(){return this._isDisposed}_disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(const i in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[i]);this._vertexArrayObjects={};const e=this._meshes,t=e.length;for(let i=0;i<t;i++)e[i]._invalidateInstanceVertexArrayObject()}}dispose(){const e=this._meshes,t=e.length;let i;for(i=0;i<t;i++)this.releaseForMesh(e[i]);this._meshes.length=0,this._disposeVertexArrayObjects();for(const r in this._vertexBuffers)this._vertexBuffers[r].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){const e=this._parentContainer.geometries.indexOf(this);e>-1&&this._parentContainer.geometries.splice(e,1),this._parentContainer=null}this._isDisposed=!0}copy(e){const t=new W;t.indices=[];const i=this.getIndices();if(i)for(let o=0;o<i.length;o++)t.indices.push(i[o]);let r,s=!1,n=!1;for(r in this._vertexBuffers){const e=this.getVerticesData(r);if(e&&(e instanceof Float32Array?t.set(new Float32Array(e),r):t.set(e.slice(0),r),!n)){const e=this.getVertexBuffer(r);e&&(s=e.isUpdatable(),n=!s)}}const a=new K(e,this._scene,t,s);for(r in a.delayLoadState=this.delayLoadState,a.delayLoadingFile=this.delayLoadingFile,a._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)a._delayInfo=a._delayInfo||[],a._delayInfo.push(r);return a._boundingInfo=new k(this._extend.minimum,this._extend.maximum),a}serialize(){const e={};return e.id=this.id,e.uniqueId=this.uniqueId,e.updatable=this._updatable,f.Y&&f.Y.HasTags(this)&&(e.tags=f.Y.GetTags(this)),e}_toNumberArray(e){return Array.isArray(e)?e:Array.prototype.slice.call(e)}clearCachedData(){this._indices=[],this._resetPointsArrayCache();for(const e in this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,e)&&(this._vertexBuffers[e]._buffer._data=null)}serializeVerticeData(){const e=this.serialize();return this.isVerticesDataPresent(S.R.PositionKind)&&(e.positions=this._toNumberArray(this.getVerticesData(S.R.PositionKind)),this.isVertexBufferUpdatable(S.R.PositionKind)&&(e.positions._updatable=!0)),this.isVerticesDataPresent(S.R.NormalKind)&&(e.normals=this._toNumberArray(this.getVerticesData(S.R.NormalKind)),this.isVertexBufferUpdatable(S.R.NormalKind)&&(e.normals._updatable=!0)),this.isVerticesDataPresent(S.R.TangentKind)&&(e.tangents=this._toNumberArray(this.getVerticesData(S.R.TangentKind)),this.isVertexBufferUpdatable(S.R.TangentKind)&&(e.tangents._updatable=!0)),this.isVerticesDataPresent(S.R.UVKind)&&(e.uvs=this._toNumberArray(this.getVerticesData(S.R.UVKind)),this.isVertexBufferUpdatable(S.R.UVKind)&&(e.uvs._updatable=!0)),this.isVerticesDataPresent(S.R.UV2Kind)&&(e.uvs2=this._toNumberArray(this.getVerticesData(S.R.UV2Kind)),this.isVertexBufferUpdatable(S.R.UV2Kind)&&(e.uvs2._updatable=!0)),this.isVerticesDataPresent(S.R.UV3Kind)&&(e.uvs3=this._toNumberArray(this.getVerticesData(S.R.UV3Kind)),this.isVertexBufferUpdatable(S.R.UV3Kind)&&(e.uvs3._updatable=!0)),this.isVerticesDataPresent(S.R.UV4Kind)&&(e.uvs4=this._toNumberArray(this.getVerticesData(S.R.UV4Kind)),this.isVertexBufferUpdatable(S.R.UV4Kind)&&(e.uvs4._updatable=!0)),this.isVerticesDataPresent(S.R.UV5Kind)&&(e.uvs5=this._toNumberArray(this.getVerticesData(S.R.UV5Kind)),this.isVertexBufferUpdatable(S.R.UV5Kind)&&(e.uvs5._updatable=!0)),this.isVerticesDataPresent(S.R.UV6Kind)&&(e.uvs6=this._toNumberArray(this.getVerticesData(S.R.UV6Kind)),this.isVertexBufferUpdatable(S.R.UV6Kind)&&(e.uvs6._updatable=!0)),this.isVerticesDataPresent(S.R.ColorKind)&&(e.colors=this._toNumberArray(this.getVerticesData(S.R.ColorKind)),this.isVertexBufferUpdatable(S.R.ColorKind)&&(e.colors._updatable=!0)),this.isVerticesDataPresent(S.R.MatricesIndicesKind)&&(e.matricesIndices=this._toNumberArray(this.getVerticesData(S.R.MatricesIndicesKind)),e.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(S.R.MatricesIndicesKind)&&(e.matricesIndices._updatable=!0)),this.isVerticesDataPresent(S.R.MatricesWeightsKind)&&(e.matricesWeights=this._toNumberArray(this.getVerticesData(S.R.MatricesWeightsKind)),this.isVertexBufferUpdatable(S.R.MatricesWeightsKind)&&(e.matricesWeights._updatable=!0)),e.indices=this._toNumberArray(this.getIndices()),e}static ExtractFromMesh(e,t){const i=e._geometry;return i?i.copy(t):null}static RandomId(){return _.S0.RandomId()}static _GetGeometryByLoadedUniqueId(e,t){for(let i=0;i<t.geometries.length;i++)if(t.geometries[i]._loadedUniqueId===e)return t.geometries[i];return null}static _ImportGeometry(e,t){const i=t.getScene(),r=e.geometryUniqueId,s=e.geometryId;if(r||s){const e=r?this._GetGeometryByLoadedUniqueId(r,i):i.getGeometryById(s);e&&e.applyToMesh(t)}else if(e instanceof ArrayBuffer){const i=t._binaryInfo;if(i.positionsAttrDesc&&i.positionsAttrDesc.count>0){const r=new Float32Array(e,i.positionsAttrDesc.offset,i.positionsAttrDesc.count);t.setVerticesData(S.R.PositionKind,r,!1)}if(i.normalsAttrDesc&&i.normalsAttrDesc.count>0){const r=new Float32Array(e,i.normalsAttrDesc.offset,i.normalsAttrDesc.count);t.setVerticesData(S.R.NormalKind,r,!1)}if(i.tangetsAttrDesc&&i.tangetsAttrDesc.count>0){const r=new Float32Array(e,i.tangetsAttrDesc.offset,i.tangetsAttrDesc.count);t.setVerticesData(S.R.TangentKind,r,!1)}if(i.uvsAttrDesc&&i.uvsAttrDesc.count>0){const r=new Float32Array(e,i.uvsAttrDesc.offset,i.uvsAttrDesc.count);if(X.rX)for(let e=1;e<r.length;e+=2)r[e]=1-r[e];t.setVerticesData(S.R.UVKind,r,!1)}if(i.uvs2AttrDesc&&i.uvs2AttrDesc.count>0){const r=new Float32Array(e,i.uvs2AttrDesc.offset,i.uvs2AttrDesc.count);if(X.rX)for(let e=1;e<r.length;e+=2)r[e]=1-r[e];t.setVerticesData(S.R.UV2Kind,r,!1)}if(i.uvs3AttrDesc&&i.uvs3AttrDesc.count>0){const r=new Float32Array(e,i.uvs3AttrDesc.offset,i.uvs3AttrDesc.count);if(X.rX)for(let e=1;e<r.length;e+=2)r[e]=1-r[e];t.setVerticesData(S.R.UV3Kind,r,!1)}if(i.uvs4AttrDesc&&i.uvs4AttrDesc.count>0){const r=new Float32Array(e,i.uvs4AttrDesc.offset,i.uvs4AttrDesc.count);if(X.rX)for(let e=1;e<r.length;e+=2)r[e]=1-r[e];t.setVerticesData(S.R.UV4Kind,r,!1)}if(i.uvs5AttrDesc&&i.uvs5AttrDesc.count>0){const r=new Float32Array(e,i.uvs5AttrDesc.offset,i.uvs5AttrDesc.count);if(X.rX)for(let e=1;e<r.length;e+=2)r[e]=1-r[e];t.setVerticesData(S.R.UV5Kind,r,!1)}if(i.uvs6AttrDesc&&i.uvs6AttrDesc.count>0){const r=new Float32Array(e,i.uvs6AttrDesc.offset,i.uvs6AttrDesc.count);if(X.rX)for(let e=1;e<r.length;e+=2)r[e]=1-r[e];t.setVerticesData(S.R.UV6Kind,r,!1)}if(i.colorsAttrDesc&&i.colorsAttrDesc.count>0){const r=new Float32Array(e,i.colorsAttrDesc.offset,i.colorsAttrDesc.count);t.setVerticesData(S.R.ColorKind,r,!1,i.colorsAttrDesc.stride)}if(i.matricesIndicesAttrDesc&&i.matricesIndicesAttrDesc.count>0){const r=new Int32Array(e,i.matricesIndicesAttrDesc.offset,i.matricesIndicesAttrDesc.count),s=[];for(let e=0;e<r.length;e++){const t=r[e];s.push(255&t),s.push((65280&t)>>8),s.push((16711680&t)>>16),s.push(t>>24&255)}t.setVerticesData(S.R.MatricesIndicesKind,s,!1)}if(i.matricesIndicesExtraAttrDesc&&i.matricesIndicesExtraAttrDesc.count>0){const r=new Int32Array(e,i.matricesIndicesExtraAttrDesc.offset,i.matricesIndicesExtraAttrDesc.count),s=[];for(let e=0;e<r.length;e++){const t=r[e];s.push(255&t),s.push((65280&t)>>8),s.push((16711680&t)>>16),s.push(t>>24&255)}t.setVerticesData(S.R.MatricesIndicesExtraKind,s,!1)}if(i.matricesWeightsAttrDesc&&i.matricesWeightsAttrDesc.count>0){const r=new Float32Array(e,i.matricesWeightsAttrDesc.offset,i.matricesWeightsAttrDesc.count);t.setVerticesData(S.R.MatricesWeightsKind,r,!1)}if(i.indicesAttrDesc&&i.indicesAttrDesc.count>0){const r=new Int32Array(e,i.indicesAttrDesc.offset,i.indicesAttrDesc.count);t.setIndices(r,null)}if(i.subMeshesAttrDesc&&i.subMeshesAttrDesc.count>0){const r=new Int32Array(e,i.subMeshesAttrDesc.offset,5*i.subMeshesAttrDesc.count);t.subMeshes=[];for(let e=0;e<i.subMeshesAttrDesc.count;e++){const i=r[5*e+0],s=r[5*e+1],n=r[5*e+2],a=r[5*e+3],o=r[5*e+4];G.AddToMesh(i,s,n,a,o,t)}}}else if(e.positions&&e.normals&&e.indices){if(t.setVerticesData(S.R.PositionKind,e.positions,e.positions._updatable),t.setVerticesData(S.R.NormalKind,e.normals,e.normals._updatable),e.tangents&&t.setVerticesData(S.R.TangentKind,e.tangents,e.tangents._updatable),e.uvs&&t.setVerticesData(S.R.UVKind,e.uvs,e.uvs._updatable),e.uvs2&&t.setVerticesData(S.R.UV2Kind,e.uvs2,e.uvs2._updatable),e.uvs3&&t.setVerticesData(S.R.UV3Kind,e.uvs3,e.uvs3._updatable),e.uvs4&&t.setVerticesData(S.R.UV4Kind,e.uvs4,e.uvs4._updatable),e.uvs5&&t.setVerticesData(S.R.UV5Kind,e.uvs5,e.uvs5._updatable),e.uvs6&&t.setVerticesData(S.R.UV6Kind,e.uvs6,e.uvs6._updatable),e.colors&&t.setVerticesData(S.R.ColorKind,E.ov.CheckColors4(e.colors,e.positions.length/3),e.colors._updatable),e.matricesIndices)if(e.matricesIndices._isExpanded)delete e.matricesIndices._isExpanded,t.setVerticesData(S.R.MatricesIndicesKind,e.matricesIndices,e.matricesIndices._updatable);else{const i=[];for(let t=0;t<e.matricesIndices.length;t++){const r=e.matricesIndices[t];i.push(255&r),i.push((65280&r)>>8),i.push((16711680&r)>>16),i.push(r>>24&255)}t.setVerticesData(S.R.MatricesIndicesKind,i,e.matricesIndices._updatable)}if(e.matricesIndicesExtra)if(e.matricesIndicesExtra._isExpanded)delete e.matricesIndices._isExpanded,t.setVerticesData(S.R.MatricesIndicesExtraKind,e.matricesIndicesExtra,e.matricesIndicesExtra._updatable);else{const i=[];for(let t=0;t<e.matricesIndicesExtra.length;t++){const r=e.matricesIndicesExtra[t];i.push(255&r),i.push((65280&r)>>8),i.push((16711680&r)>>16),i.push(r>>24&255)}t.setVerticesData(S.R.MatricesIndicesExtraKind,i,e.matricesIndicesExtra._updatable)}e.matricesWeights&&(K._CleanMatricesWeights(e,t),t.setVerticesData(S.R.MatricesWeightsKind,e.matricesWeights,e.matricesWeights._updatable)),e.matricesWeightsExtra&&t.setVerticesData(S.R.MatricesWeightsExtraKind,e.matricesWeightsExtra,e.matricesWeights._updatable),t.setIndices(e.indices,null)}if(e.subMeshes){t.subMeshes=[];for(let i=0;i<e.subMeshes.length;i++){const r=e.subMeshes[i];G.AddToMesh(r.materialIndex,r.verticesStart,r.verticesCount,r.indexStart,r.indexCount,t)}}t._shouldGenerateFlatShading&&(t.convertToFlatShadedMesh(),t._shouldGenerateFlatShading=!1),t.computeWorldMatrix(!0),i.onMeshImportedObservable.notifyObservers(t)}static _CleanMatricesWeights(e,t){const i=.001;if(!q.CleanBoneMatrixWeights)return;let r=0;if(!(e.skeletonId>-1))return;{const i=t.getScene().getLastSkeletonById(e.skeletonId);if(!i)return;r=i.bones.length}const s=t.getVerticesData(S.R.MatricesIndicesKind),n=t.getVerticesData(S.R.MatricesIndicesExtraKind),a=e.matricesWeights,o=e.matricesWeightsExtra,l=e.numBoneInfluencer,h=a.length;for(let c=0;c<h;c+=4){let e=0,t=-1;for(let r=0;r<4;r++){const s=a[c+r];e+=s,s<i&&t<0&&(t=r)}if(o)for(let r=0;r<4;r++){const s=o[c+r];e+=s,s<i&&t<0&&(t=r+4)}if((t<0||t>l-1)&&(t=l-1),e>i){const t=1/e;for(let e=0;e<4;e++)a[c+e]*=t;if(o)for(let e=0;e<4;e++)o[c+e]*=t}else t>=4?(o[c+t-4]=1-e,n[c+t-4]=r):(a[c+t]=1-e,s[c+t]=r)}t.setVerticesData(S.R.MatricesIndicesKind,s),e.matricesWeightsExtra&&t.setVerticesData(S.R.MatricesIndicesExtraKind,n)}static Parse(e,t,i){const r=new K(e.id,t,void 0,e.updatable);return r._loadedUniqueId=e.uniqueId,f.Y&&f.Y.AddTagsTo(r,e.tags),e.delayLoadingFile?(r.delayLoadState=4,r.delayLoadingFile=i+e.delayLoadingFile,r._boundingInfo=new k(o.Pq.FromArray(e.boundingBoxMinimum),o.Pq.FromArray(e.boundingBoxMaximum)),r._delayInfo=[],e.hasUVs&&r._delayInfo.push(S.R.UVKind),e.hasUVs2&&r._delayInfo.push(S.R.UV2Kind),e.hasUVs3&&r._delayInfo.push(S.R.UV3Kind),e.hasUVs4&&r._delayInfo.push(S.R.UV4Kind),e.hasUVs5&&r._delayInfo.push(S.R.UV5Kind),e.hasUVs6&&r._delayInfo.push(S.R.UV6Kind),e.hasColors&&r._delayInfo.push(S.R.ColorKind),e.hasMatricesIndices&&r._delayInfo.push(S.R.MatricesIndicesKind),e.hasMatricesWeights&&r._delayInfo.push(S.R.MatricesWeightsKind),r._delayLoadingFunction=W.ImportVertexData):W.ImportVertexData(e,r),t.pushGeometry(r,!0),r}}const Y=o.uq.Compose(o.Pq.One(),o.PT.FromEulerAngles(0,Math.PI,0),o.Pq.Zero());class j extends d{get billboardMode(){return this._billboardMode}set billboardMode(e){this._billboardMode!==e&&(this._billboardMode=e,this._cache.useBillboardPosition=0!==(this._billboardMode&j.BILLBOARDMODE_USE_POSITION),this._computeUseBillboardPath())}get preserveParentRotationForBillboard(){return this._preserveParentRotationForBillboard}set preserveParentRotationForBillboard(e){e!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=e,this._computeUseBillboardPath())}_computeUseBillboardPath(){this._cache.useBillboardPath=this._billboardMode!==j.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(e){this._infiniteDistance!==e&&(this._infiniteDistance=e)}constructor(e){let t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,!1),this._forward=new o.Pq(0,0,1),this._up=new o.Pq(0,1,0),this._right=new o.Pq(1,0,0),this._position=o.Pq.Zero(),this._rotation=o.Pq.Zero(),this._rotationQuaternion=null,this._scaling=o.Pq.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=j.BILLBOARDMODE_NONE,this._preserveParentRotationForBillboard=!1,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this._localMatrix=o.uq.Zero(),this._usePivotMatrix=!1,this._absolutePosition=o.Pq.Zero(),this._absoluteScaling=o.Pq.Zero(),this._absoluteRotationQuaternion=o.PT.Identity(),this._pivotMatrix=o.uq.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new a.cP,this._nonUniformScaling=!1,t&&this.getScene().addTransformNode(this)}getClassName(){return"TransformNode"}get position(){return this._position}set position(e){this._position=e,this._isDirty=!0}isUsingPivotMatrix(){return this._usePivotMatrix}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}get rotation(){return this._rotation}set rotation(e){this._rotation=e,this._rotationQuaternion=null,this._isDirty=!0}get scaling(){return this._scaling}set scaling(e){this._scaling=e,this._isDirty=!0}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(e){this._rotationQuaternion=e,e&&this._rotation.setAll(0),this._isDirty=!0}get forward(){return o.Pq.TransformNormalFromFloatsToRef(0,0,this.getScene().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return o.Pq.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return o.Pq.TransformNormalFromFloatsToRef(this.getScene().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(e){return this._poseMatrix?(this._poseMatrix.copyFrom(e),this):(this._poseMatrix=e.clone(),this)}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=o.uq.Identity()),this._poseMatrix}_isSynchronized(){const e=this._cache;return this._billboardMode===e.billboardMode&&this._billboardMode===j.BILLBOARDMODE_NONE&&(!e.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))}_initCache(){super._initCache();const e=this._cache;e.localMatrixUpdated=!1,e.billboardMode=-1,e.infiniteDistance=!1,e.useBillboardPosition=!1,e.useBillboardPath=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(e){return this.setPivotMatrix(e,!1)}setPivotMatrix(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._pivotMatrix.copyFrom(e),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=t,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=o.uq.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;const r=this.clone("Clone of "+(this.name||this.id),e||this.parent,!0);r&&i&&i(this,r);for(const s of this.getChildTransformNodes(!0))s.instantiateHierarchy(r,t,i);return r}freezeWorldMatrix(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return e?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(this._rotation.setAll(0),this._rotationQuaternion=this._rotationQuaternion||o.PT.Identity(),e.decompose(this._scaling,this._rotationQuaternion,this._position),this.computeWorldMatrix(!0)):(this._worldMatrix=e,this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this}get isWorldMatrixFrozen(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.computeWorldMatrix(),this._absolutePosition}setAbsolutePosition(e){if(!e)return this;let t,i,r;if(void 0===e.x){if(arguments.length<3)return this;t=arguments[0],i=arguments[1],r=arguments[2]}else t=e.x,i=e.y,r=e.z;if(this.parent){const e=o.AA.Matrix[0];this.parent.getWorldMatrix().invertToRef(e),o.Pq.TransformCoordinatesFromFloatsToRef(t,i,r,e,this.position)}else this.position.x=t,this.position.y=i,this.position.z=r;return this._absolutePosition.copyFrom(e),this}setPositionWithLocalVector(e){return this.computeWorldMatrix(),this.position=o.Pq.TransformNormal(e,this._localMatrix),this}getPositionExpressedInLocalSpace(){this.computeWorldMatrix();const e=o.AA.Matrix[0];return this._localMatrix.invertToRef(e),o.Pq.TransformNormal(this.position,e)}locallyTranslate(e){return this.computeWorldMatrix(!0),this.position=o.Pq.TransformCoordinates(e,this._localMatrix),this}lookAt(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const n=j._LookAtVectorCache,a=0===s?this.position:this.getAbsolutePosition();if(e.subtractToRef(a,n),this.setDirection(n,t,i,r),1===s&&this.parent)if(this.rotationQuaternion){const e=o.AA.Matrix[0];this.rotationQuaternion.toRotationMatrix(e);const t=o.AA.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(t),t.invert(),e.multiplyToRef(t,e),this.rotationQuaternion.fromRotationMatrix(e)}else{const e=o.AA.Quaternion[0];o.PT.FromEulerVectorToRef(this.rotation,e);const t=o.AA.Matrix[0];e.toRotationMatrix(t);const i=o.AA.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(i),i.invert(),t.multiplyToRef(i,t),e.fromRotationMatrix(t),e.toEulerAnglesToRef(this.rotation)}return this}getDirection(e){const t=o.Pq.Zero();return this.getDirectionToRef(e,t),t}getDirectionToRef(e,t){return o.Pq.TransformNormalToRef(e,this.getWorldMatrix(),t),this}setDirection(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const s=-Math.atan2(e.z,e.x)+Math.PI/2,n=Math.sqrt(e.x*e.x+e.z*e.z),a=-Math.atan2(e.y,n);return this.rotationQuaternion?o.PT.RotationYawPitchRollToRef(s+t,a+i,r,this.rotationQuaternion):(this.rotation.x=a+i,this.rotation.y=s+t,this.rotation.z=r),this}setPivotPoint(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;0==this.getScene().getRenderId()&&this.computeWorldMatrix(!0);const i=this.getWorldMatrix();if(1==t){const t=o.AA.Matrix[0];i.invertToRef(t),e=o.Pq.TransformCoordinates(e,t)}return this.setPivotMatrix(o.uq.Translation(-e.x,-e.y,-e.z),!0)}getPivotPoint(){const e=o.Pq.Zero();return this.getPivotPointToRef(e),e}getPivotPointToRef(e){return e.x=-this._pivotMatrix.m[12],e.y=-this._pivotMatrix.m[13],e.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){const e=o.Pq.Zero();return this.getAbsolutePivotPointToRef(e),e}getAbsolutePivotPointToRef(e){return this.getPivotPointToRef(e),o.Pq.TransformCoordinatesToRef(e,this.getWorldMatrix(),e),this}markAsDirty(e){if(this._isDirty)return this;if(this._children)for(const t of this._children)t.markAsDirty(e);return super.markAsDirty(e)}setParent(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e&&!this.parent)return this;const r=o.AA.Quaternion[0],s=o.AA.Vector3[0],n=o.AA.Vector3[1],a=o.AA.Matrix[1];o.uq.IdentityToRef(a);const l=o.AA.Matrix[0];this.computeWorldMatrix(!0);let h=this.rotationQuaternion;return h||(h=j._TmpRotation,o.PT.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,h)),o.uq.ComposeToRef(this.scaling,h,this.position,l),this.parent&&l.multiplyToRef(this.parent.computeWorldMatrix(!0),l),e&&(e.computeWorldMatrix(!0).invertToRef(a),l.multiplyToRef(a,l)),l.decompose(n,r,s,t?this:void 0),this.rotationQuaternion?this.rotationQuaternion.copyFrom(r):r.toEulerAnglesToRef(this.rotation),this.scaling.copyFrom(n),this.position.copyFrom(s),this.parent=e,i&&this.setPivotMatrix(o.uq.Identity()),this}addChild(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e.setParent(this,t),this}removeChild(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e.setParent(null,t),this}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(e){return this._nonUniformScaling!==e&&(this._nonUniformScaling=e,!0)}attachToBone(e,t){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=t,this.parent=e,e.getSkeleton().prepare(!0),e.getFinalMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}detachFromBone(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=e?this._currentParentWhenAttachingToBone:null,this):(e&&(this.parent=this._currentParentWhenAttachingToBone),this)}rotate(e,t,i){let r;if(e.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.setAll(0)),i&&0!==i){if(this.parent){const i=this.parent.getWorldMatrix(),r=o.AA.Matrix[0];i.invertToRef(r),e=o.Pq.TransformNormal(e,r),i.determinant()<0&&(t*=-1)}r=o.PT.RotationAxisToRef(e,t,j._RotationAxisCache),r.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else r=o.PT.RotationAxisToRef(e,t,j._RotationAxisCache),this.rotationQuaternion.multiplyToRef(r,this.rotationQuaternion);return this}rotateAround(e,t,i){t.normalize(),this.rotationQuaternion||(this.rotationQuaternion=o.PT.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.setAll(0));const r=o.AA.Vector3[0],s=o.AA.Vector3[1],n=o.AA.Vector3[2],a=o.AA.Quaternion[0],l=o.AA.Matrix[0],h=o.AA.Matrix[1],c=o.AA.Matrix[2],u=o.AA.Matrix[3];return e.subtractToRef(this.position,r),o.uq.TranslationToRef(r.x,r.y,r.z,l),o.uq.TranslationToRef(-r.x,-r.y,-r.z,h),o.uq.RotationAxisToRef(t,i,c),h.multiplyToRef(c,u),u.multiplyToRef(l,u),u.decompose(s,a,n),this.position.addInPlace(n),a.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(e,t,i){const r=e.scale(t);if(i&&0!==i)this.setAbsolutePosition(this.getAbsolutePosition().add(r));else{const e=this.getPositionExpressedInLocalSpace().add(r);this.setPositionWithLocalVector(e)}return this}addRotation(e,t,i){let r;this.rotationQuaternion?r=this.rotationQuaternion:(r=o.AA.Quaternion[1],o.PT.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,r));const s=o.AA.Quaternion[0];return o.PT.RotationYawPitchRollToRef(t,e,i,s),r.multiplyInPlace(s),this.rotationQuaternion||r.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==j.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}computeWorldMatrix(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const i=this.getScene().getRenderId();if(!this._isDirty&&!e&&(this._currentRenderId===i||this.isSynchronized()))return this._currentRenderId=i,this._worldMatrix;t=t||this.getScene().activeCamera,this._updateCache();const r=this._cache;r.pivotMatrixUpdated=!1,r.billboardMode=this.billboardMode,r.infiniteDistance=this.infiniteDistance,r.parent=this._parentNode,this._currentRenderId=i,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const s=this._getEffectiveParent(),n=j._TmpScaling;let a,l=this._position;if(this._infiniteDistance&&!this.parent&&t){const e=t.getWorldMatrix(),i=new o.Pq(e.m[12],e.m[13],e.m[14]);l=j._TmpTranslation,l.copyFromFloats(this._position.x+i.x,this._position.y+i.y,this._position.z+i.z)}if(n.copyFromFloats(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion){if(this._rotationQuaternion._isDirty=!1,a=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion){this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(o.PT.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.copyFromFloats(0,0,0))}}else a=j._TmpRotation,o.PT.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,a);if(this._usePivotMatrix){const e=o.AA.Matrix[1];o.uq.ScalingToRef(n.x,n.y,n.z,e);const t=o.AA.Matrix[0];a.toRotationMatrix(t),this._pivotMatrix.multiplyToRef(e,o.AA.Matrix[4]),o.AA.Matrix[4].multiplyToRef(t,this._localMatrix),this._postMultiplyPivotMatrix&&this._localMatrix.multiplyToRef(this._pivotMatrixInverse,this._localMatrix),this._localMatrix.addTranslationFromFloats(l.x,l.y,l.z)}else o.uq.ComposeToRef(n,a,l,this._localMatrix);if(s&&s.getWorldMatrix){if(e&&s.computeWorldMatrix(e),r.useBillboardPath){if(this._transformToBoneReferal){const e=this.parent;e.getSkeleton().prepare(),e.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),o.AA.Matrix[7])}else o.AA.Matrix[7].copyFrom(s.getWorldMatrix());const e=o.AA.Vector3[5],t=o.AA.Vector3[6],i=o.AA.Quaternion[0];o.AA.Matrix[7].decompose(t,i,e),o.uq.ScalingToRef(t.x,t.y,t.z,o.AA.Matrix[7]),o.AA.Matrix[7].setTranslation(e),j.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(i,e),this._localMatrix.setTranslation(e)),this._localMatrix.multiplyToRef(o.AA.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){const e=this.parent;e.getSkeleton().prepare(),this._localMatrix.multiplyToRef(e.getFinalMatrix(),o.AA.Matrix[6]),o.AA.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this._localMatrix.multiplyToRef(s.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.copyFrom(this._localMatrix);if(r.useBillboardPath&&t&&this.billboardMode&&!r.useBillboardPosition){const e=o.AA.Vector3[0];if(this._worldMatrix.getTranslationToRef(e),o.AA.Matrix[1].copyFrom(t.getViewMatrix()),this._scene.useRightHandedSystem&&o.AA.Matrix[1].multiplyToRef(Y,o.AA.Matrix[1]),o.AA.Matrix[1].setTranslationFromFloats(0,0,0),o.AA.Matrix[1].invertToRef(o.AA.Matrix[0]),(this.billboardMode&j.BILLBOARDMODE_ALL)!==j.BILLBOARDMODE_ALL){o.AA.Matrix[0].decompose(void 0,o.AA.Quaternion[0],void 0);const e=o.AA.Vector3[1];o.AA.Quaternion[0].toEulerAnglesToRef(e),(this.billboardMode&j.BILLBOARDMODE_X)!==j.BILLBOARDMODE_X&&(e.x=0),(this.billboardMode&j.BILLBOARDMODE_Y)!==j.BILLBOARDMODE_Y&&(e.y=0),(this.billboardMode&j.BILLBOARDMODE_Z)!==j.BILLBOARDMODE_Z&&(e.z=0),o.uq.RotationYawPitchRollToRef(e.y,e.x,e.z,o.AA.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(o.AA.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(o.AA.Vector3[0])}else if(r.useBillboardPath&&t&&r.useBillboardPosition){const e=o.AA.Vector3[0];this._worldMatrix.getTranslationToRef(e);const i=t.globalPosition;this._worldMatrix.invertToRef(o.AA.Matrix[1]);const r=o.AA.Vector3[1];o.Pq.TransformCoordinatesToRef(i,o.AA.Matrix[1],r),r.normalize();const s=-Math.atan2(r.z,r.x)+Math.PI/2,n=Math.sqrt(r.x*r.x+r.z*r.z),a=-Math.atan2(r.y,n);if(o.PT.RotationYawPitchRollToRef(s,a,0,o.AA.Quaternion[0]),(this.billboardMode&j.BILLBOARDMODE_ALL)!==j.BILLBOARDMODE_ALL){const e=o.AA.Vector3[1];o.AA.Quaternion[0].toEulerAnglesToRef(e),(this.billboardMode&j.BILLBOARDMODE_X)!==j.BILLBOARDMODE_X&&(e.x=0),(this.billboardMode&j.BILLBOARDMODE_Y)!==j.BILLBOARDMODE_Y&&(e.y=0),(this.billboardMode&j.BILLBOARDMODE_Z)!==j.BILLBOARDMODE_Z&&(e.z=0),o.uq.RotationYawPitchRollToRef(e.y,e.x,e.z,o.AA.Matrix[0])}else o.uq.FromQuaternionToRef(o.AA.Quaternion[0],o.AA.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(o.AA.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(o.AA.Vector3[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):s&&s._nonUniformScaling?this._updateNonUniformScalingState(s._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=o.uq.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.computeWorldMatrix(),e){const e=this.getChildren();for(let t=0;t<e.length;++t){const i=e[t];if(i){i.computeWorldMatrix();const e=o.AA.Matrix[0];i._localMatrix.multiplyToRef(this._localMatrix,e);const t=o.AA.Quaternion[0];e.decompose(i.scaling,t,i.position),i.rotationQuaternion?i.rotationQuaternion.copyFrom(t):t.toEulerAnglesToRef(i.rotation)}}}this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=o.PT.Identity()),this._worldMatrix=o.uq.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(e){return this.onAfterWorldMatrixUpdateObservable.add(e),this}unregisterAfterWorldMatrixUpdate(e){return this.onAfterWorldMatrixUpdateObservable.removeCallback(e),this}getPositionInCameraSpace(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return e||(e=this.getScene().activeCamera),o.Pq.TransformCoordinates(this.getAbsolutePosition(),e.getViewMatrix())}getDistanceToCamera(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return e||(e=this.getScene().activeCamera),this.getAbsolutePosition().subtract(e.globalPosition).length()}clone(e,t,i){const r=c.p.Clone((()=>new j(e,this.getScene())),this);if(r.name=e,r.id=e,t&&(r.parent=t),!i){const t=this.getDescendants(!0);for(let i=0;i<t.length;i++){const s=t[i];s.clone&&s.clone(e+"."+s.name,r)}}return r}serialize(e){const t=c.p.Serialize(this,e);return t.type=this.getClassName(),t.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(t),t.localMatrix=this.getPivotMatrix().asArray(),t.isEnabled=this.isEnabled(),c.p.AppendSerializedAnimations(this,t),t.ranges=this.serializeAnimationRanges(),t}static Parse(e,t,i){const r=c.p.Parse((()=>new j(e.name,t)),e,t,i);if(e.localMatrix?r.setPreTransformMatrix(o.uq.FromArray(e.localMatrix)):e.pivotMatrix&&r.setPivotMatrix(o.uq.FromArray(e.pivotMatrix)),r.setEnabled(e.isEnabled),r._waitingParsedUniqueId=e.uniqueId,void 0!==e.parentId&&(r._waitingParentId=e.parentId),void 0!==e.parentInstanceIndex&&(r._waitingParentInstanceIndex=e.parentInstanceIndex),e.animations){for(let t=0;t<e.animations.length;t++){const i=e.animations[t],s=(0,x.n9)("BABYLON.Animation");s&&r.animations.push(s.Parse(i))}d.ParseAnimationRanges(r,e,t)}return e.autoAnimate&&t.beginAnimation(r,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),r}getChildTransformNodes(e,t){const i=[];return this._getDescendants(i,e,(e=>(!t||t(e))&&e instanceof j)),i}dispose(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.getScene().stopAnimation(this),this.getScene().removeTransformNode(this),this._parentContainer){const e=this._parentContainer.transformNodes.indexOf(this);e>-1&&this._parentContainer.transformNodes.splice(e,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),e){const e=this.getChildTransformNodes(!0);for(const t of e)t.parent=null,t.computeWorldMatrix(!0)}super.dispose(e,t)}normalizeToUnitCube(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0,r=null,s=null;t&&(this.rotationQuaternion?(s=this.rotationQuaternion.clone(),this.rotationQuaternion.copyFromFloats(0,0,0,1)):this.rotation&&(r=this.rotation.clone(),this.rotation.copyFromFloats(0,0,0)));const n=this.getHierarchyBoundingVectors(e,i),a=n.max.subtract(n.min),o=Math.max(a.x,a.y,a.z);if(0===o)return this;const l=1/o;return this.scaling.scaleInPlace(l),t&&(this.rotationQuaternion&&s?this.rotationQuaternion.copyFrom(s):this.rotation&&r&&this.rotation.copyFrom(r)),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}j.BILLBOARDMODE_NONE=0,j.BILLBOARDMODE_X=1,j.BILLBOARDMODE_Y=2,j.BILLBOARDMODE_Z=4,j.BILLBOARDMODE_ALL=7,j.BILLBOARDMODE_USE_POSITION=128,j.BillboardUseParentOrientation=!1,j._TmpRotation=o.PT.Zero(),j._TmpScaling=o.Pq.Zero(),j._TmpTranslation=o.Pq.Zero(),j._LookAtVectorCache=new o.Pq(0,0,0),j._RotationAxisCache=new o.PT,(0,s.Cg)([(0,n.P_)("position")],j.prototype,"_position",void 0),(0,s.Cg)([(0,n.P_)("rotation")],j.prototype,"_rotation",void 0),(0,s.Cg)([(0,n.bR)("rotationQuaternion")],j.prototype,"_rotationQuaternion",void 0),(0,s.Cg)([(0,n.P_)("scaling")],j.prototype,"_scaling",void 0),(0,s.Cg)([(0,n.lK)("billboardMode")],j.prototype,"_billboardMode",void 0),(0,s.Cg)([(0,n.lK)()],j.prototype,"scalingDeterminant",void 0),(0,s.Cg)([(0,n.lK)("infiniteDistance")],j.prototype,"_infiniteDistance",void 0),(0,s.Cg)([(0,n.lK)()],j.prototype,"ignoreNonUniformScaling",void 0),(0,s.Cg)([(0,n.lK)()],j.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0);var Q=i(9770),$=i(4990);class Z{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new o.Pq(0,0,0),this._diffPositionForCollisions=new o.Pq(0,0,0),this._collisionResponse=!0}}var J=i(6750),ee=i(8846);class te{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=o.Pq.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}class ie{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new te,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=null,this._currentLODIsUpToDate=!1,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new Z,this._enableDistantPicking=!1,this._rawBoundingInfo=null,this._sideOrientationHint=!1,this._inheritVisibility=!1}}class re extends j{static get BILLBOARDMODE_NONE(){return j.BILLBOARDMODE_NONE}static get BILLBOARDMODE_X(){return j.BILLBOARDMODE_X}static get BILLBOARDMODE_Y(){return j.BILLBOARDMODE_Y}static get BILLBOARDMODE_Z(){return j.BILLBOARDMODE_Z}static get BILLBOARDMODE_ALL(){return j.BILLBOARDMODE_ALL}static get BILLBOARDMODE_USE_POSITION(){return j.BILLBOARDMODE_USE_POSITION}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set partitioningSubdivisions(e){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=e}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set partitioningBBoxRatio(e){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=e}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set mustDepthSortFacets(e){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=e}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set facetDepthSortFrom(e){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=e}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set collisionRetryCount(e){this._internalAbstractMeshDataInfo._collisionRetryCount=e}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set morphTargetManager(e){this._internalAbstractMeshDataInfo._morphTargetManager!==e&&(this._internalAbstractMeshDataInfo._morphTargetManager=e,this._syncGeometryWithMorphTargetManager())}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set bakedVertexAnimationManager(e){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==e&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=e,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}_updateNonUniformScalingState(e){return!!super._updateNonUniformScalingState(e)&&(this._markSubMeshesAsMiscDirty(),!0)}get rawBoundingInfo(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}set rawBoundingInfo(e){this._internalAbstractMeshDataInfo._rawBoundingInfo=e}set onCollide(e){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(e)}set onCollisionPositionChange(e){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(e)}get visibility(){return this._internalAbstractMeshDataInfo._visibility}set visibility(e){if(this._internalAbstractMeshDataInfo._visibility===e)return;const t=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=e,(1===t&&1!==e||1!==t&&1===e)&&this._markSubMeshesAsDirty((e=>{e.markAsMiscDirty(),e.markAsPrePassDirty()}))}get inheritVisibility(){return this._internalAbstractMeshDataInfo._inheritVisibility}set inheritVisibility(e){this._internalAbstractMeshDataInfo._inheritVisibility=e}get isVisible(){if(!this._isVisible||!this.inheritVisibility||!this._parentNode)return this._isVisible;if(this._isVisible){let e=this._parentNode;for(;e;){const t=e.isVisible;if("undefined"!==typeof t)return t;e=e.parent}}return this._isVisible}set isVisible(e){this._isVisible=e}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set pointerOverDisableMeshTesting(e){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=e}get renderingGroupId(){return this._internalAbstractMeshDataInfo._renderingGroupId}set renderingGroupId(e){this._internalAbstractMeshDataInfo._renderingGroupId=e}get material(){return this._internalAbstractMeshDataInfo._material}set material(e){this._setMaterial(e)}_setMaterial(e){this._internalAbstractMeshDataInfo._material!==e&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=e,e&&e.meshMap&&(e.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.subMeshes&&(this.resetDrawCache(),this._unBindEffect()))}getMaterialForRenderPass(e){return this._internalAbstractMeshDataInfo._materialForRenderPass?.[e]}setMaterialForRenderPass(e,t){this.resetDrawCache(e),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]),this._internalAbstractMeshDataInfo._materialForRenderPass[e]=t}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}set receiveShadows(e){this._internalAbstractMeshDataInfo._receiveShadows!==e&&(this._internalAbstractMeshDataInfo._receiveShadows=e,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set hasVertexAlpha(e){this._internalAbstractMeshDataInfo._hasVertexAlpha!==e&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=e,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}set useVertexColors(e){this._internalAbstractMeshDataInfo._useVertexColors!==e&&(this._internalAbstractMeshDataInfo._useVertexColors=e,this._markSubMeshesAsAttributesDirty())}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(e){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==e&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=e,this._markSubMeshesAsAttributesDirty())}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set numBoneInfluencers(e){this._internalAbstractMeshDataInfo._numBoneInfluencers!==e&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=e,this._markSubMeshesAsAttributesDirty())}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set applyFog(e){this._internalAbstractMeshDataInfo._applyFog!==e&&(this._internalAbstractMeshDataInfo._applyFog=e,this._markSubMeshesAsMiscDirty())}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set enableDistantPicking(e){this._internalAbstractMeshDataInfo._enableDistantPicking=e}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}set layerMask(e){e!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=e,this._resyncLightSources())}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set collisionMask(e){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(e)?-1:e}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set collisionResponse(e){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=e}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set collisionGroup(e){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(e)?-1:e}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set surroundingMeshes(e){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=e}get lightSources(){return this._lightSources}set skeleton(e){const t=this._internalAbstractMeshDataInfo._skeleton;t&&t.needInitialSkinMatrix&&t._unregisterMeshWithPoseMatrix(this),e&&e.needInitialSkinMatrix&&e._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=e,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}constructor(e){var t;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(super(e,i,!1),t=this,this._internalAbstractMeshDataInfo=new ie,this._waitingMaterialId=null,this.cullingStrategy=re.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,this.onCollideObservable=new a.cP,this.onCollisionPositionChangeObservable=new a.cP,this.onMaterialChangedObservable=new a.cP,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this._isVisible=!0,this.isPickable=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=E.v9.Red(),this.outlineWidth=.02,this.overlayColor=E.v9.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.alwaysSelectAsActiveMesh=!1,this.doNotSyncBoundingInfo=!1,this.actionManager=null,this.ellipsoid=new o.Pq(.5,1,.5),this.ellipsoidOffset=new o.Pq(0,0,0),this.edgesWidth=1,this.edgesColor=new E.ov(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,freezeWorldMatrix:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new a.cP,this._onCollisionPositionChange=function(e,i){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;i.subtractToRef(t._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,t._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),t._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>ee.$.CollisionsEpsilon&&t.position.addInPlace(t._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),r&&t.onCollideObservable.notifyObservers(r),t.onCollisionPositionChangeObservable.notifyObservers(t.position)},i=this.getScene(),i.addMesh(this),this._resyncLightSources(),this._uniformBuffer=new $.D(this.getScene().getEngine(),void 0,void 0,e,!this.getScene().getEngine().isWebGPU),this._buildUniformLayout(),i.performancePriority){case 2:this.doNotSyncBoundingInfo=!0;case 1:this.alwaysSelectAsActiveMesh=!0,this.isPickable=!1}}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}transferToEffect(e){const t=this._uniformBuffer;t.updateMatrix("world",e),t.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),t.update()}getMeshUniformBuffer(){return this._uniformBuffer}getClassName(){return"AbstractMesh"}toString(e){let t="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");t+=", # of submeshes: "+(this.subMeshes?this.subMeshes.length:0);const i=this._internalAbstractMeshDataInfo._skeleton;return i&&(t+=", skeleton: "+i.name),e&&(t+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],t+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.freezeWorldMatrix?"YES":"NO")),t}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==j.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}_getActionManagerForTrigger(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.actionManager&&(t||this.actionManager.isRecursive)){if(!e)return this.actionManager;if(this.actionManager.hasSpecificTrigger(e))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(e,!1):null}_rebuild(){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.subMeshes){for(const e of this.subMeshes)e._rebuild();this.resetDrawCache()}}_resyncLightSources(){this._lightSources.length=0;for(const e of this.getScene().lights)e.isEnabled()&&e.canAffectMesh(this)&&this._lightSources.push(e);this._markSubMeshesAsLightDirty()}_resyncLightSource(e){const t=e.isEnabled()&&e.canAffectMesh(this),i=this._lightSources.indexOf(e);let r=!1;if(-1===i){if(!t)return;this._lightSources.push(e)}else{if(t)return;r=!0,this._lightSources.splice(i,1)}this._markSubMeshesAsLightDirty(r)}_unBindEffect(){for(const e of this.subMeshes)e.setEffect(null)}_removeLightSource(e,t){const i=this._lightSources.indexOf(e);-1!==i&&(this._lightSources.splice(i,1),this._markSubMeshesAsLightDirty(t))}_markSubMeshesAsDirty(e){if(this.subMeshes)for(const t of this.subMeshes)for(let i=0;i<t._drawWrappers.length;++i){const r=t._drawWrappers[i];r&&r.defines&&r.defines.markAllAsDirty&&e(r.defines)}}_markSubMeshesAsLightDirty(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._markSubMeshesAsDirty((t=>t.markAsLightDirty(e)))}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty((e=>e.markAsAttributesDirty()))}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty((e=>e.markAsMiscDirty()))}markAsDirty(e){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}resetDrawCache(e){if(this.subMeshes)for(const t of this.subMeshes)t.resetDrawCache(e)}get isBlocked(){return!1}getLOD(e){return this}getTotalVertices(){return 0}getTotalIndices(){return 0}getIndices(){return null}getVerticesData(e){return null}setVerticesData(e,t,i,r){return this}updateVerticesData(e,t,i,r){return this}setIndices(e,t){return this}isVerticesDataPresent(e){return!1}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this._updateBoundingInfo()),this._boundingInfo)}getRawBoundingInfo(){return this.rawBoundingInfo??this.getBoundingInfo()}setBoundingInfo(e){return this._boundingInfo=e,this}get hasBoundingInfo(){return null!==this._boundingInfo}buildBoundingInfo(e,t,i){return this._boundingInfo=new k(e,t,i),this._boundingInfo}normalizeToUnitCube(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0;return super.normalizeToUnitCube(e,t,i)}get useBones(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(S.R.MatricesIndicesKind)&&this.isVerticesDataPresent(S.R.MatricesWeightsKind)}_preActivate(){}_preActivateForIntermediateRendering(e){}_activate(e,t){return this._renderId=e,!0}_postActivate(){}_freeze(){}_unFreeze(){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===j.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get isAnInstance(){return!1}get hasInstances(){return!1}get hasThinInstances(){return!1}movePOV(e,t,i){return this.position.addInPlace(this.calcMovePOV(e,t,i)),this}calcMovePOV(e,t,i){const r=new o.uq;(this.rotationQuaternion?this.rotationQuaternion:o.PT.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(r);const s=o.Pq.Zero(),n=this.definedFacingForward?-1:1;return o.Pq.TransformCoordinatesFromFloatsToRef(e*n,t,i*n,r,s),s}rotatePOV(e,t,i){return this.rotation.addInPlace(this.calcRotatePOV(e,t,i)),this}calcRotatePOV(e,t,i){const r=this.definedFacingForward?1:-1;return new o.Pq(e*r,t,i*r)}_refreshBoundingInfo(e,t){if(e){const i=V(e,0,this.getTotalVertices(),t);this._boundingInfo?this._boundingInfo.reConstruct(i.minimum,i.maximum):this._boundingInfo=new k(i.minimum,i.maximum)}if(this.subMeshes)for(let i=0;i<this.subMeshes.length;i++)this.subMeshes[i].refreshBoundingInfo(e);this._updateBoundingInfo()}_refreshBoundingInfoDirect(e){if(this._boundingInfo?this._boundingInfo.reConstruct(e.minimum,e.maximum):this._boundingInfo=new k(e.minimum,e.maximum),this.subMeshes)for(let t=0;t<this.subMeshes.length;t++)this.subMeshes[t].refreshBoundingInfo(null);this._updateBoundingInfo()}static _ApplySkeleton(e,t,i,r,s,n,a){!function(e,t,i,r,s,n,a){const l=o.AA.Vector3[0],h=o.AA.Matrix[0],c=o.AA.Matrix[1],u=t===S.R.NormalKind?o.Pq.TransformNormalFromFloatsToRef:o.Pq.TransformCoordinatesFromFloatsToRef;for(let d=0,_=0;d<e.length;d+=3,_+=4){let t,p;for(h.reset(),t=0;t<4;t++)p=s[_+t],p>0&&(o.uq.FromFloat32ArrayToRefScaled(i,Math.floor(16*r[_+t]),p,c),h.addToSelf(c));if(n&&a)for(t=0;t<4;t++)p=a[_+t],p>0&&(o.uq.FromFloat32ArrayToRefScaled(i,Math.floor(16*n[_+t]),p,c),h.addToSelf(c));u(e[d],e[d+1],e[d+2],h,l),l.toArray(e,d)}}(e,t,i,r,s,n,a)}_getData(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S.R.PositionKind;const r=e.cache,s=e=>{if(r){const t=r._vertexData||(r._vertexData={});return t[e]||this.copyVerticesData(e,t),t[e]}return this.getVerticesData(e)};if(t||(t=s(i)),!t)return null;if(r?(r._outputData?r._outputData.set(t):r._outputData=new Float32Array(t),t=r._outputData):(e.applyMorph&&this.morphTargetManager||e.applySkeleton&&this.skeleton)&&(t=t.slice()),e.applyMorph&&this.morphTargetManager&&function(e,t,i){let r=null;switch(t){case S.R.PositionKind:r=e=>e.getPositions();break;case S.R.NormalKind:r=e=>e.getNormals();break;case S.R.TangentKind:r=e=>e.getTangents();break;case S.R.UVKind:r=e=>e.getUVs();break;default:return}for(let s=0;s<e.length;s++){let t=e[s];for(let n=0;n<i.numTargets;n++){const a=i.getTarget(n),o=a.influence;if(0!==o){const i=r(a);i&&(t+=(i[s]-e[s])*o)}}e[s]=t}}(t,i,this.morphTargetManager),e.applySkeleton&&this.skeleton){const e=s(S.R.MatricesIndicesKind),r=s(S.R.MatricesWeightsKind);if(r&&e){const n=this.numBoneInfluencers>4,a=n?s(S.R.MatricesIndicesExtraKind):null,o=n?s(S.R.MatricesWeightsExtraKind):null,l=this.skeleton.getTransformMatrices(this);re._ApplySkeleton(t,i,l,e,r,a,o)}}if(!1!==e.updatePositionsArray&&i===S.R.PositionKind){const e=this._internalAbstractMeshDataInfo._positions||[],i=e.length;if(e.length=t.length/3,i<e.length)for(let t=i;t<e.length;t++)e[t]=new o.Pq;for(let r=0,s=0;r<e.length;r++,s+=3)e[r].copyFromFloats(t[s],t[s+1],t[s+2]);this._internalAbstractMeshDataInfo._positions=e}return t}getNormalsData(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getData({applySkeleton:e,applyMorph:t,updatePositionsArray:!1},null,S.R.NormalKind)}getPositionData(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this._getData({applySkeleton:e,applyMorph:t,updatePositionsArray:!1},i,S.R.PositionKind)}_updateBoundingInfo(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new k(o.Pq.Zero(),o.Pq.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_updateSubMeshesBoundingInfo(e){if(!this.subMeshes)return this;const t=this.subMeshes.length;for(let i=0;i<t;i++){const r=this.subMeshes[i];(t>1||!r.IsGlobal)&&r.updateBoundingInfo(e)}return this}_afterComputeWorldMatrix(){this.doNotSyncBoundingInfo||(this._boundingInfoIsDirty=!0)}isInFrustum(e){return this.getBoundingInfo().isInFrustum(e,this.cullingStrategy)}isCompletelyInFrustum(e){return this.getBoundingInfo().isCompletelyInFrustum(e)}intersectsMesh(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0;const r=this.getBoundingInfo(),s=e.getBoundingInfo();if(r.intersects(s,t))return!0;if(i)for(const n of this.getChildMeshes())if(n.intersectsMesh(e,t,!0))return!0;return!1}intersectsPoint(e){return this.getBoundingInfo().intersectsPoint(e)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set checkCollisions(e){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=e}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}moveWithCollisions(e){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const t=this.getScene().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=t.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,t.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,e,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId),this}_collideForSubMesh(e,t,i){if(this._generatePointsArray(),!this._positions)return this;if(!e._lastColliderWorldVertices||!e._lastColliderTransformMatrix.equals(t)){e._lastColliderTransformMatrix=t.clone(),e._lastColliderWorldVertices=[],e._trianglePlanes=[];const i=e.verticesStart,r=e.verticesStart+e.verticesCount;for(let s=i;s<r;s++)e._lastColliderWorldVertices.push(o.Pq.TransformCoordinates(this._positions[s],t))}return i._collide(e._trianglePlanes,e._lastColliderWorldVertices,this.getIndices(),e.indexStart,e.indexStart+e.indexCount,e.verticesStart,!!e.getMaterial(),this,this._shouldConvertRHS(),7===e.getMaterial()?.fillMode),this}_processCollisionsForSubMeshes(e,t){const i=this._scene.getCollidingSubMeshCandidates(this,e),r=i.length;for(let s=0;s<r;s++){const n=i.data[s];r>1&&!n._checkCollision(e)||this._collideForSubMesh(n,t,e)}return this}_shouldConvertRHS(){return!1}_checkCollision(e){if(!this.getBoundingInfo()._checkCollision(e))return this;const t=o.AA.Matrix[0],i=o.AA.Matrix[1];return o.uq.ScalingToRef(1/e._radius.x,1/e._radius.y,1/e._radius.z,t),this.worldMatrixFromCache.multiplyToRef(t,i),this._processCollisionsForSubMeshes(e,i),this}_generatePointsArray(){return!1}intersects(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4?arguments[4]:void 0,n=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const a=new Q.G,l=this.getClassName(),h="InstancedLinesMesh"===l||"LinesMesh"===l||"GreasedLineMesh"===l?this.intersectionThreshold:0,c=this.getBoundingInfo();if(!this.subMeshes)return a;if(!n&&(!e.intersectsSphere(c.boundingSphere,h)||!e.intersectsBox(c.boundingBox,h)))return a;if(r)return a.hit=!n,a.pickedMesh=n?null:this,a.distance=n?0:o.Pq.Distance(e.origin,c.boundingSphere.center),a.subMeshId=0,a;if(!this._generatePointsArray())return a;let u=null;const d=this._scene.getIntersectingSubMeshCandidates(this,e),_=d.length;let p=!1;for(let o=0;o<_;o++){const e=d.data[o].getMaterial();if(e&&(7==e.fillMode||0==e.fillMode||1==e.fillMode||2==e.fillMode||4==e.fillMode)){p=!0;break}}if(!p)return a.hit=!0,a.pickedMesh=this,a.distance=o.Pq.Distance(e.origin,c.boundingSphere.center),a.subMeshId=-1,a;for(let o=0;o<_;o++){const r=d.data[o];if(_>1&&!n&&!r.canIntersects(e))continue;const s=r.intersects(e,this._positions,this.getIndices(),t,i);if(s&&(t||!u||s.distance<u.distance)&&(u=s,u.subMeshId=o,t))break}if(u){const t=s??this.getWorldMatrix(),i=o.AA.Vector3[0],r=o.AA.Vector3[1];o.Pq.TransformCoordinatesToRef(e.origin,t,i),e.direction.scaleToRef(u.distance,r);const n=o.Pq.TransformNormal(r,t).addInPlace(i);return a.hit=!0,a.distance=o.Pq.Distance(i,n),a.pickedPoint=n,a.pickedMesh=this,a.bu=u.bu||0,a.bv=u.bv||0,a.subMeshFaceId=u.faceId,a.faceId=u.faceId+d.data[u.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),a.subMeshId=u.subMeshId,a}return a}clone(e,t,i){return null}releaseSubMeshes(){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose();else this.subMeshes=[];return this}dispose(e){let t,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=this.getScene();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),r.freeActiveMeshes(),r.freeRenderingGroups(),r.renderingManager.maintainStateBetweenFrames&&r.renderingManager.restoreDispachedFlags(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.disposeWhenUnowned&&!this._scene.meshes.some((e=>e!==this&&e.actionManager===this.actionManager))&&this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),t=0;t<this._intersectionsInProgress.length;t++){const e=this._intersectionsInProgress[t],i=e._intersectionsInProgress.indexOf(this);e._intersectionsInProgress.splice(i,1)}this._intersectionsInProgress.length=0;r.lights.forEach((e=>{let t=e.includedOnlyMeshes.indexOf(this);-1!==t&&e.includedOnlyMeshes.splice(t,1),t=e.excludedMeshes.indexOf(this),-1!==t&&e.excludedMeshes.splice(t,1);const i=e.getShadowGenerators();if(i){const e=i.values();for(let i=e.next();!0!==i.done;i=e.next()){const e=i.value.getShadowMap();e&&e.renderList&&(t=e.renderList.indexOf(this),-1!==t&&e.renderList.splice(t,1))}}})),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes();const s=r.getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,s.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),s.wipeCaches(),r.removeMesh(this),this._parentContainer){const e=this._parentContainer.meshes.indexOf(this);e>-1&&this._parentContainer.meshes.splice(e,1),this._parentContainer=null}if(i&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!e)for(t=0;t<r.particleSystems.length;t++)r.particleSystems[t].emitter===this&&(r.particleSystems[t].dispose(),t--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(e,i)}_initFacetData(){const e=this._internalAbstractMeshDataInfo._facetData;e.facetNormals||(e.facetNormals=[]),e.facetPositions||(e.facetPositions=[]),e.facetPartitioning||(e.facetPartitioning=new Array),e.facetNb=this.getIndices().length/3|0,e.partitioningSubdivisions=e.partitioningSubdivisions?e.partitioningSubdivisions:10,e.partitioningBBoxRatio=e.partitioningBBoxRatio?e.partitioningBBoxRatio:1.01;for(let t=0;t<e.facetNb;t++)e.facetNormals[t]=o.Pq.Zero(),e.facetPositions[t]=o.Pq.Zero();return e.facetDataEnabled=!0,this}updateFacetData(){const e=this._internalAbstractMeshDataInfo._facetData;e.facetDataEnabled||this._initFacetData();const t=this.getVerticesData(S.R.PositionKind),i=this.getIndices(),r=this.getVerticesData(S.R.NormalKind),s=this.getBoundingInfo();if(e.facetDepthSort&&!e.facetDepthSortEnabled){if(e.facetDepthSortEnabled=!0,i instanceof Uint16Array)e.depthSortedIndices=new Uint16Array(i);else if(i instanceof Uint32Array)e.depthSortedIndices=new Uint32Array(i);else{let t=!1;for(let e=0;e<i.length;e++)if(i[e]>65535){t=!0;break}e.depthSortedIndices=t?new Uint32Array(i):new Uint16Array(i)}if(e.facetDepthSortFunction=function(e,t){return t.sqDistance-e.sqDistance},!e.facetDepthSortFrom){const t=this.getScene().activeCamera;e.facetDepthSortFrom=t?t.position:o.Pq.Zero()}e.depthSortedFacets=[];for(let t=0;t<e.facetNb;t++){const i={ind:3*t,sqDistance:0};e.depthSortedFacets.push(i)}e.invertedMatrix=o.uq.Identity(),e.facetDepthSortOrigin=o.Pq.Zero()}e.bbSize.x=s.maximum.x-s.minimum.x>O.bH?s.maximum.x-s.minimum.x:O.bH,e.bbSize.y=s.maximum.y-s.minimum.y>O.bH?s.maximum.y-s.minimum.y:O.bH,e.bbSize.z=s.maximum.z-s.minimum.z>O.bH?s.maximum.z-s.minimum.z:O.bH;let n=e.bbSize.x>e.bbSize.y?e.bbSize.x:e.bbSize.y;if(n=n>e.bbSize.z?n:e.bbSize.z,e.subDiv.max=e.partitioningSubdivisions,e.subDiv.X=Math.floor(e.subDiv.max*e.bbSize.x/n),e.subDiv.Y=Math.floor(e.subDiv.max*e.bbSize.y/n),e.subDiv.Z=Math.floor(e.subDiv.max*e.bbSize.z/n),e.subDiv.X=e.subDiv.X<1?1:e.subDiv.X,e.subDiv.Y=e.subDiv.Y<1?1:e.subDiv.Y,e.subDiv.Z=e.subDiv.Z<1?1:e.subDiv.Z,e.facetParameters.facetNormals=this.getFacetLocalNormals(),e.facetParameters.facetPositions=this.getFacetLocalPositions(),e.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),e.facetParameters.bInfo=s,e.facetParameters.bbSize=e.bbSize,e.facetParameters.subDiv=e.subDiv,e.facetParameters.ratio=this.partitioningBBoxRatio,e.facetParameters.depthSort=e.facetDepthSort,e.facetDepthSort&&e.facetDepthSortEnabled&&(this.computeWorldMatrix(!0),this._worldMatrix.invertToRef(e.invertedMatrix),o.Pq.TransformCoordinatesToRef(e.facetDepthSortFrom,e.invertedMatrix,e.facetDepthSortOrigin),e.facetParameters.distanceTo=e.facetDepthSortOrigin),e.facetParameters.depthSortedFacets=e.depthSortedFacets,r&&W.ComputeNormals(t,i,r,e.facetParameters),e.facetDepthSort&&e.facetDepthSortEnabled){e.depthSortedFacets.sort(e.facetDepthSortFunction);const t=e.depthSortedIndices.length/3|0;for(let r=0;r<t;r++){const t=e.depthSortedFacets[r].ind;e.depthSortedIndices[3*r]=i[t],e.depthSortedIndices[3*r+1]=i[t+1],e.depthSortedIndices[3*r+2]=i[t+2]}this.updateIndices(e.depthSortedIndices,void 0,!0)}return this}getFacetLocalNormals(){const e=this._internalAbstractMeshDataInfo._facetData;return e.facetNormals||this.updateFacetData(),e.facetNormals}getFacetLocalPositions(){const e=this._internalAbstractMeshDataInfo._facetData;return e.facetPositions||this.updateFacetData(),e.facetPositions}getFacetLocalPartitioning(){const e=this._internalAbstractMeshDataInfo._facetData;return e.facetPartitioning||this.updateFacetData(),e.facetPartitioning}getFacetPosition(e){const t=o.Pq.Zero();return this.getFacetPositionToRef(e,t),t}getFacetPositionToRef(e,t){const i=this.getFacetLocalPositions()[e],r=this.getWorldMatrix();return o.Pq.TransformCoordinatesToRef(i,r,t),this}getFacetNormal(e){const t=o.Pq.Zero();return this.getFacetNormalToRef(e,t),t}getFacetNormalToRef(e,t){const i=this.getFacetLocalNormals()[e];return o.Pq.TransformNormalToRef(i,this.getWorldMatrix(),t),this}getFacetsAtLocalCoordinates(e,t,i){const r=this.getBoundingInfo(),s=this._internalAbstractMeshDataInfo._facetData,n=Math.floor((e-r.minimum.x*s.partitioningBBoxRatio)*s.subDiv.X*s.partitioningBBoxRatio/s.bbSize.x),a=Math.floor((t-r.minimum.y*s.partitioningBBoxRatio)*s.subDiv.Y*s.partitioningBBoxRatio/s.bbSize.y),o=Math.floor((i-r.minimum.z*s.partitioningBBoxRatio)*s.subDiv.Z*s.partitioningBBoxRatio/s.bbSize.z);return n<0||n>s.subDiv.max||a<0||a>s.subDiv.max||o<0||o>s.subDiv.max?null:s.facetPartitioning[n+s.subDiv.max*a+s.subDiv.max*s.subDiv.max*o]}getClosestFacetAtCoordinates(e,t,i,r){let s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const a=this.getWorldMatrix(),l=o.AA.Matrix[5];a.invertToRef(l);const h=o.AA.Vector3[8];o.Pq.TransformCoordinatesFromFloatsToRef(e,t,i,l,h);const c=this.getClosestFacetAtLocalCoordinates(h.x,h.y,h.z,r,s,n);return r&&o.Pq.TransformCoordinatesFromFloatsToRef(r.x,r.y,r.z,a,r),c}getClosestFacetAtLocalCoordinates(e,t,i,r){let s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=null,o=0,l=0,h=0,c=0,u=0,d=0,_=0,p=0;const f=this.getFacetLocalPositions(),g=this.getFacetLocalNormals(),m=this.getFacetsAtLocalCoordinates(e,t,i);if(!m)return null;let b,v,y,T=Number.MAX_VALUE,x=T;for(let A=0;A<m.length;A++)b=m[A],v=g[b],y=f[b],c=(e-y.x)*v.x+(t-y.y)*v.y+(i-y.z)*v.z,(!s||s&&n&&c>=0||s&&!n&&c<=0)&&(c=v.x*y.x+v.y*y.y+v.z*y.z,u=-(v.x*e+v.y*t+v.z*i-c)/(v.x*v.x+v.y*v.y+v.z*v.z),d=e+v.x*u,_=t+v.y*u,p=i+v.z*u,o=d-e,l=_-t,h=p-i,x=o*o+l*l+h*h,x<T&&(T=x,a=b,r&&(r.x=d,r.y=_,r.z=p)));return a}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}disableFacetData(){const e=this._internalAbstractMeshDataInfo._facetData;return e.facetDataEnabled&&(e.facetDataEnabled=!1,e.facetPositions=[],e.facetNormals=[],e.facetPartitioning=new Array,e.facetParameters=null,e.depthSortedIndices=new Uint32Array(0)),this}updateIndices(e,t){return this}createNormals(e){const t=this.getVerticesData(S.R.PositionKind),i=this.getIndices();let r;return r=this.isVerticesDataPresent(S.R.NormalKind)?this.getVerticesData(S.R.NormalKind):[],W.ComputeNormals(t,i,r,{useRightHandedSystem:this.getScene().useRightHandedSystem}),this.setVerticesData(S.R.NormalKind,r,e),this}alignWithNormal(e,t){t||(t=J._0.Y);const i=o.AA.Vector3[0],r=o.AA.Vector3[1];return o.Pq.CrossToRef(t,e,r),o.Pq.CrossToRef(e,r,i),this.rotationQuaternion?o.PT.RotationQuaternionFromAxisToRef(i,e,r,this.rotationQuaternion):o.Pq.RotationFromAxisToRef(i,e,r,this.rotation),this}_checkOcclusionQuery(){return!1}disableEdgesRendering(){throw(0,h.n)("EdgesRenderer")}enableEdgesRendering(e,t,i){throw(0,h.n)("EdgesRenderer")}getConnectedParticleSystems(){return this._scene.particleSystems.filter((e=>e.emitter===this))}}re.OCCLUSION_TYPE_NONE=0,re.OCCLUSION_TYPE_OPTIMISTIC=1,re.OCCLUSION_TYPE_STRICT=2,re.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,re.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,re.CULLINGSTRATEGY_STANDARD=0,re.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,re.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,re.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,(0,s.Cg)([n.Cx.filter((function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];let[r,s,n,a,o]=t;return!Array.isArray(r)&&!Array.isArray(s)&&!Array.isArray(n)&&!Array.isArray(a)&&!Array.isArray(o)}))],re,"_ApplySkeleton",null),(0,x.Y5)("BABYLON.AbstractMesh",re);var se=i(5017);class ne{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(e){this._func=e}get funcRef(){return this._funcRef}set funcRef(e){this._funcRef=e}get funcMask(){return this._funcMask}set funcMask(e){this._funcMask=e}get opStencilFail(){return this._opStencilFail}set opStencilFail(e){this._opStencilFail=e}get opDepthFail(){return this._opDepthFail}set opDepthFail(e){this._opDepthFail=e}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(e){this._opStencilDepthPass=e}get mask(){return this._mask}set mask(e){this._mask=e}get enabled(){return this._enabled}set enabled(e){this._enabled=e}getClassName(){return"MaterialStencilState"}copyTo(e){c.p.Clone((()=>e),this)}serialize(){return c.p.Serialize(this)}parse(e,t,i){c.p.Parse((()=>this),e,t,i)}}(0,s.Cg)([(0,n.lK)()],ne.prototype,"func",null),(0,s.Cg)([(0,n.lK)()],ne.prototype,"funcRef",null),(0,s.Cg)([(0,n.lK)()],ne.prototype,"funcMask",null),(0,s.Cg)([(0,n.lK)()],ne.prototype,"opStencilFail",null),(0,s.Cg)([(0,n.lK)()],ne.prototype,"opDepthFail",null),(0,s.Cg)([(0,n.lK)()],ne.prototype,"opStencilDepthPass",null),(0,s.Cg)([(0,n.lK)()],ne.prototype,"mask",null),(0,s.Cg)([(0,n.lK)()],ne.prototype,"enabled",null);var ae=i(5556);function oe(e){-1===e.indexOf("vClipPlane")&&e.push("vClipPlane"),-1===e.indexOf("vClipPlane2")&&e.push("vClipPlane2"),-1===e.indexOf("vClipPlane3")&&e.push("vClipPlane3"),-1===e.indexOf("vClipPlane4")&&e.push("vClipPlane4"),-1===e.indexOf("vClipPlane5")&&e.push("vClipPlane5"),-1===e.indexOf("vClipPlane6")&&e.push("vClipPlane6")}function le(e,t,i){let r=t.clipPlane??i.clipPlane;he(e,"vClipPlane",r),r=t.clipPlane2??i.clipPlane2,he(e,"vClipPlane2",r),r=t.clipPlane3??i.clipPlane3,he(e,"vClipPlane3",r),r=t.clipPlane4??i.clipPlane4,he(e,"vClipPlane4",r),r=t.clipPlane5??i.clipPlane5,he(e,"vClipPlane5",r),r=t.clipPlane6??i.clipPlane6,he(e,"vClipPlane6",r)}function he(e,t,i){i&&e.setFloat4(t,i.normal.x,i.normal.y,i.normal.z,i.d)}const ce=E.v9.Black();function ue(e,t,i){if(!e||e.LOGARITHMICDEPTH||e.indexOf&&e.indexOf("LOGARITHMICDEPTH")>=0){const e=i.activeCamera;1===e.mode&&T.V.Error("Logarithmic depth is not compatible with orthographic cameras!",20),t.setFloat("logarithmicDepthConstant",2/(Math.log(e.maxZ+1)/Math.LN2))}}function de(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];i&&e.fogEnabled&&(!t||t.applyFog)&&0!==e.fogMode&&(i.setFloat4("vFogInfos",e.fogMode,e.fogStart,e.fogEnd,e.fogDensity),r?(e.fogColor.toLinearSpaceToRef(ce,e.getEngine().useExactSrgbConversions),i.setColor3("vFogColor",ce)):i.setColor3("vFogColor",e.fogColor))}function _e(e,t,i){const r=i.NUM_MORPH_INFLUENCERS;if(r>0&&l.q.LastCreatedEngine){const s=l.q.LastCreatedEngine.getCaps().maxVertexAttribs,n=t.morphTargetManager;if(n?.isUsingTextureForTargets)return;const a=n&&n.supportsNormals&&i.NORMAL,o=n&&n.supportsTangents&&i.TANGENT,h=n&&n.supportsUVs&&i.UV1;for(let i=0;i<r;i++)e.push("position"+i),a&&e.push("normal"+i),o&&e.push("tangent"+i),h&&e.push("uv_"+i),e.length>s&&T.V.Error("Cannot add more vertex attributes for mesh "+t.name)}}function pe(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.push("world0"),e.push("world1"),e.push("world2"),e.push("world3"),t&&(e.push("previousWorld0"),e.push("previousWorld1"),e.push("previousWorld2"),e.push("previousWorld3"))}function fe(e,t){const i=e.morphTargetManager;e&&i&&t.setFloatArray("morphTargetInfluences",i.influences)}function ge(e,t){t.bindToEffect(e,"Scene")}function me(e,t,i){t._needUVs=!0,t[i]=!0,e.optimizeUVAllocation&&e.getTextureMatrix().isIdentityAs3x2()?(t[i+"DIRECTUV"]=e.coordinatesIndex+1,t["MAINUV"+(e.coordinatesIndex+1)]=!0):t[i+"DIRECTUV"]=0}function be(e,t,i){const r=e.getTextureMatrix();t.updateMatrix(i+"Matrix",r)}function ve(e,t,i){i.BAKED_VERTEX_ANIMATION_TEXTURE&&i.INSTANCES&&e.push("bakedVertexAnimationSettingsInstanced")}function ye(e,t,i){var r;if(t&&e&&(e.computeBonesUsingShaders&&t._bonesComputationForcedToCPU&&(e.computeBonesUsingShaders=!1),e.useBones&&e.computeBonesUsingShaders&&e.skeleton)){const s=e.skeleton;if(s.isUsingTextureForMatrices&&t.getUniformIndex("boneTextureWidth")>-1){const i=s.getTransformMatrixTexture(e);t.setTexture("boneSampler",i),t.setFloat("boneTextureWidth",4*(s.bones.length+1))}else{const n=s.getTransformMatrices(e);n&&(t.setMatrices("mBones",n),i&&e.getScene().prePassRenderer&&e.getScene().prePassRenderer.getIndex(2)&&(i.previousBones[e.uniqueId]||(i.previousBones[e.uniqueId]=n.slice()),t.setMatrices("mPreviousBones",i.previousBones[e.uniqueId]),r=n,i.previousBones[e.uniqueId].set(r)))}}}function Te(e,t,i,r,s){let n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];e._bindLight(t,i,r,s,n)}function xe(e,t,i,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const n=Math.min(t.lightSources.length,s);for(let a=0;a<n;a++){Te(t.lightSources[a],a,e,i,"boolean"===typeof r?r:r.SPECULARTERM,t.receiveShadows)}}function Ae(e,t,i,r){i.NUM_BONE_INFLUENCERS>0&&(r.addCPUSkinningFallback(0,t),e.push("matricesIndices"),e.push("matricesWeights"),i.NUM_BONE_INFLUENCERS>4&&(e.push("matricesIndicesExtra"),e.push("matricesWeightsExtra")))}function Ce(e,t){(t.INSTANCES||t.THIN_INSTANCES)&&pe(e,!!t.PREPASS_VELOCITY),t.INSTANCESCOLOR&&e.push("instanceColor")}function Re(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=0;for(let n=0;n<i&&e["LIGHT"+n];n++)n>0&&(s=r+n,t.addFallback(s,"LIGHT"+n)),e.SHADOWS||(e["SHADOW"+n]&&t.addFallback(r,"SHADOW"+n),e["SHADOWPCF"+n]&&t.addFallback(r,"SHADOWPCF"+n),e["SHADOWPCSS"+n]&&t.addFallback(r,"SHADOWPCSS"+n),e["SHADOWPOISSON"+n]&&t.addFallback(r,"SHADOWPOISSON"+n),e["SHADOWESM"+n]&&t.addFallback(r,"SHADOWESM"+n),e["SHADOWCLOSEESM"+n]&&t.addFallback(r,"SHADOWCLOSEESM"+n));return s++}function Ee(e,t,i,r,s,n,a){let o=arguments.length>7&&void 0!==arguments[7]&&arguments[7];a._areMiscDirty&&(a.LOGARITHMICDEPTH=i,a.POINTSIZE=r,a.FOG=s&&function(e,t){return t.fogEnabled&&e.applyFog&&0!==t.fogMode}(e,t),a.NONUNIFORMSCALING=e.nonUniformScaling,a.ALPHATEST=n,a.DECAL_AFTER_DETAIL=o)}function Se(e,t,i,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,n=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!i._areLightsDirty)return i._needNormals;let a=0;const o={needNormals:i._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(e.lightsEnabled&&!n)for(const h of t.lightSources)if(Me(e,t,h,a,i,r,o),a++,a===s)break;i.SPECULARTERM=o.specularEnabled,i.SHADOWS=o.shadowEnabled;for(let h=a;h<s;h++)void 0!==i["LIGHT"+h]&&(i["LIGHT"+h]=!1,i["HEMILIGHT"+h]=!1,i["POINTLIGHT"+h]=!1,i["DIRLIGHT"+h]=!1,i["SPOTLIGHT"+h]=!1,i["SHADOW"+h]=!1,i["SHADOWCSM"+h]=!1,i["SHADOWCSMDEBUG"+h]=!1,i["SHADOWCSMNUM_CASCADES"+h]=!1,i["SHADOWCSMUSESHADOWMAXZ"+h]=!1,i["SHADOWCSMNOBLEND"+h]=!1,i["SHADOWCSM_RIGHTHANDED"+h]=!1,i["SHADOWPCF"+h]=!1,i["SHADOWPCSS"+h]=!1,i["SHADOWPOISSON"+h]=!1,i["SHADOWESM"+h]=!1,i["SHADOWCLOSEESM"+h]=!1,i["SHADOWCUBE"+h]=!1,i["SHADOWLOWQUALITY"+h]=!1,i["SHADOWMEDIUMQUALITY"+h]=!1);const l=e.getEngine().getCaps();return void 0===i.SHADOWFLOAT&&(o.needRebuild=!0),i.SHADOWFLOAT=o.shadowEnabled&&(l.textureFloatRender&&l.textureFloatLinearFiltering||l.textureHalfFloatRender&&l.textureHalfFloatLinearFiltering),i.LIGHTMAPEXCLUDED=o.lightmapMode,o.needRebuild&&i.rebuild(),o.needNormals}function Me(e,t,i,r,s,n,a){switch(a.needNormals=!0,void 0===s["LIGHT"+r]&&(a.needRebuild=!0),s["LIGHT"+r]=!0,s["SPOTLIGHT"+r]=!1,s["HEMILIGHT"+r]=!1,s["POINTLIGHT"+r]=!1,s["DIRLIGHT"+r]=!1,i.prepareLightSpecificDefines(s,r),s["LIGHT_FALLOFF_PHYSICAL"+r]=!1,s["LIGHT_FALLOFF_GLTF"+r]=!1,s["LIGHT_FALLOFF_STANDARD"+r]=!1,i.falloffType){case ae.c.FALLOFF_GLTF:s["LIGHT_FALLOFF_GLTF"+r]=!0;break;case ae.c.FALLOFF_PHYSICAL:s["LIGHT_FALLOFF_PHYSICAL"+r]=!0;break;case ae.c.FALLOFF_STANDARD:s["LIGHT_FALLOFF_STANDARD"+r]=!0}if(n&&!i.specular.equalsFloats(0,0,0)&&(a.specularEnabled=!0),s["SHADOW"+r]=!1,s["SHADOWCSM"+r]=!1,s["SHADOWCSMDEBUG"+r]=!1,s["SHADOWCSMNUM_CASCADES"+r]=!1,s["SHADOWCSMUSESHADOWMAXZ"+r]=!1,s["SHADOWCSMNOBLEND"+r]=!1,s["SHADOWCSM_RIGHTHANDED"+r]=!1,s["SHADOWPCF"+r]=!1,s["SHADOWPCSS"+r]=!1,s["SHADOWPOISSON"+r]=!1,s["SHADOWESM"+r]=!1,s["SHADOWCLOSEESM"+r]=!1,s["SHADOWCUBE"+r]=!1,s["SHADOWLOWQUALITY"+r]=!1,s["SHADOWMEDIUMQUALITY"+r]=!1,t&&t.receiveShadows&&e.shadowsEnabled&&i.shadowEnabled){const t=i.getShadowGenerator(e.activeCamera)??i.getShadowGenerator();if(t){const e=t.getShadowMap();e&&e.renderList&&e.renderList.length>0&&(a.shadowEnabled=!0,t.prepareDefines(s,r))}}i.lightmapMode!=ae.c.LIGHTMAP_DEFAULT?(a.lightmapMode=!0,s["LIGHTMAPEXCLUDED"+r]=!0,s["LIGHTMAPNOSPECULAR"+r]=i.lightmapMode==ae.c.LIGHTMAP_SHADOWSONLY):(s["LIGHTMAPEXCLUDED"+r]=!1,s["LIGHTMAPNOSPECULAR"+r]=!1)}function Pe(e,t,i,r,s){let n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=Fe(e,r);!1!==n&&(o=function(e,t,i){let r=!1;const s=!!(e.clipPlane??t.clipPlane),n=!!(e.clipPlane2??t.clipPlane2),a=!!(e.clipPlane3??t.clipPlane3),o=!!(e.clipPlane4??t.clipPlane4),l=!!(e.clipPlane5??t.clipPlane5),h=!!(e.clipPlane6??t.clipPlane6);return i.CLIPPLANE!==s&&(i.CLIPPLANE=s,r=!0),i.CLIPPLANE2!==n&&(i.CLIPPLANE2=n,r=!0),i.CLIPPLANE3!==a&&(i.CLIPPLANE3=a,r=!0),i.CLIPPLANE4!==o&&(i.CLIPPLANE4=o,r=!0),i.CLIPPLANE5!==l&&(i.CLIPPLANE5=l,r=!0),i.CLIPPLANE6!==h&&(i.CLIPPLANE6=h,r=!0),r}(i,e,r)),r.DEPTHPREPASS!==!t.getColorWrite()&&(r.DEPTHPREPASS=!r.DEPTHPREPASS,o=!0),r.INSTANCES!==s&&(r.INSTANCES=s,o=!0),r.THIN_INSTANCES!==a&&(r.THIN_INSTANCES=a,o=!0),o&&r.markAsUnprocessed()}function Ie(e,t,i,r){let s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!t._areAttributesDirty&&t._needNormals===t._normals&&t._needUVs===t._uvs)return!1;t._normals=t._needNormals,t._uvs=t._needUVs,t.NORMAL=t._needNormals&&e.isVerticesDataPresent("normal"),t._needNormals&&e.isVerticesDataPresent("tangent")&&(t.TANGENT=!0);for(let o=1;o<=6;++o)t["UV"+o]=!!t._needUVs&&e.isVerticesDataPresent(`uv${1===o?"":o}`);if(i){const i=e.useVertexColors&&e.isVerticesDataPresent("color");t.VERTEXCOLOR=i,t.VERTEXALPHA=e.hasVertexAlpha&&i&&n}return e.isVerticesDataPresent("instanceColor")&&(e.hasInstances||e.hasThinInstances)&&(t.INSTANCESCOLOR=!0),r&&function(e,t){if(e.useBones&&e.computeBonesUsingShaders&&e.skeleton){t.NUM_BONE_INFLUENCERS=e.numBoneInfluencers;const i=void 0!==t.BONETEXTURE;if(e.skeleton.isUsingTextureForMatrices&&i)t.BONETEXTURE=!0;else{t.BonesPerMesh=e.skeleton.bones.length+1,t.BONETEXTURE=!i&&void 0;const r=e.getScene().prePassRenderer;if(r&&r.enabled){const i=-1===r.excludedSkinnedMesh.indexOf(e);t.BONES_VELOCITY_ENABLED=i}}}else t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,void 0!==t.BONETEXTURE&&(t.BONETEXTURE=!1)}(e,t),s&&function(e,t){const i=e.morphTargetManager;i?(t.MORPHTARGETS_UV=i.supportsUVs&&t.UV1,t.MORPHTARGETS_TANGENT=i.supportsTangents&&t.TANGENT,t.MORPHTARGETS_NORMAL=i.supportsNormals&&t.NORMAL,t.NUM_MORPH_INFLUENCERS=i.numMaxInfluencers||i.numInfluencers,t.MORPHTARGETS=t.NUM_MORPH_INFLUENCERS>0,t.MORPHTARGETS_TEXTURE=i.isUsingTextureForTargets):(t.MORPHTARGETS_UV=!1,t.MORPHTARGETS_TANGENT=!1,t.MORPHTARGETS_NORMAL=!1,t.MORPHTARGETS=!1,t.NUM_MORPH_INFLUENCERS=0)}(e,t),a&&function(e,t){const i=e.bakedVertexAnimationManager;t.BAKED_VERTEX_ANIMATION_TEXTURE=!(!i||!i.isEnabled)}(e,t),!0}function Oe(e,t){if(e.activeCamera){const i=t.MULTIVIEW;t.MULTIVIEW=null!==e.activeCamera.outputRenderTarget&&e.activeCamera.outputRenderTarget.getViewCount()>1,t.MULTIVIEW!=i&&t.markAsUnprocessed()}}function De(e,t,i){const r=t.ORDER_INDEPENDENT_TRANSPARENCY,s=t.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;t.ORDER_INDEPENDENT_TRANSPARENCY=e.useOrderIndependentTransparency&&i,t.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!e.getEngine().getCaps().textureFloatLinearFiltering,r===t.ORDER_INDEPENDENT_TRANSPARENCY&&s===t.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||t.markAsUnprocessed()}function we(e,t,i){const r=t.PREPASS;if(!t._arePrePassDirty)return;const s=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_NDC_DEPTH",index:"PREPASS_NDC_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(e.prePassRenderer&&e.prePassRenderer.enabled&&i){t.PREPASS=!0,t.SCENE_MRT_COUNT=e.prePassRenderer.mrtCount,t.PREPASS_NORMAL_WORLDSPACE=e.prePassRenderer.generateNormalsInWorldSpace;for(let i=0;i<s.length;i++){const r=e.prePassRenderer.getIndex(s[i].type);-1!==r?(t[s[i].define]=!0,t[s[i].index]=r):t[s[i].define]=!1}}else{t.PREPASS=!1;for(let e=0;e<s.length;e++)t[s[e].define]=!1}t.PREPASS!=r&&(t.markAsUnprocessed(),t.markAsImageProcessingDirty())}function Fe(e,t){let i=!1;if(e.activeCamera){const r=t.CAMERA_ORTHOGRAPHIC?1:0,s=t.CAMERA_PERSPECTIVE?1:0,n=1===e.activeCamera.mode?1:0,a=0===e.activeCamera.mode?1:0;(r^n||s^a)&&(t.CAMERA_ORTHOGRAPHIC=1===n,t.CAMERA_PERSPECTIVE=1===a,i=!0)}return i}function Le(e,t,i,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]&&arguments[5];s&&s.push("Light"+e),n||(t.push("vLightData"+e,"vLightDiffuse"+e,"vLightSpecular"+e,"vLightDirection"+e,"vLightFalloff"+e,"vLightGround"+e,"lightMatrix"+e,"shadowsInfo"+e,"depthValues"+e),i.push("shadowTexture"+e),i.push("depthTexture"+e),t.push("viewFrustumZ"+e,"cascadeBlendFactor"+e,"lightSizeUVCorrection"+e,"depthCorrection"+e,"penumbraDarkness"+e,"frustumLengths"+e),r&&(i.push("projectionLightTexture"+e),t.push("textureProjectionMatrix"+e)))}function Be(e,t,i){let r,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4,n=null;if(e.uniformsNames){const a=e;r=a.uniformsNames,n=a.uniformBuffersNames,t=a.samplers,i=a.defines,s=a.maxSimultaneousLights||0}else r=e,t||(t=[]);for(let a=0;a<s&&i["LIGHT"+a];a++)Le(a,r,t,i["PROJECTEDLIGHTTEXTURE"+a],n);i.NUM_MORPH_INFLUENCERS&&(r.push("morphTargetInfluences"),r.push("morphTargetCount")),i.BAKED_VERTEX_ANIMATION_TEXTURE&&(r.push("bakedVertexAnimationSettings"),r.push("bakedVertexAnimationTextureSizeInverted"),r.push("bakedVertexAnimationTime"),t.push("bakedVertexAnimationTexture"))}class Ne{get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(e){if(this._alpha===e)return;const t=this._alpha;this._alpha=e,1!==t&&1!==e||this.markAsDirty(Ne.MiscDirtyFlag+Ne.PrePassDirtyFlag)}get alpha(){return this._alpha}set backFaceCulling(e){this._backFaceCulling!==e&&(this._backFaceCulling=e,this.markAsDirty(Ne.TextureDirtyFlag))}get backFaceCulling(){return this._backFaceCulling}set cullBackFaces(e){this._cullBackFaces!==e&&(this._cullBackFaces=e,this.markAsDirty(Ne.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(e){this._blockDirtyMechanism!==e&&(this._blockDirtyMechanism=e,e||this.markDirty())}atomicMaterialsUpdate(e){this.blockDirtyMechanism=!0;try{e(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new a.cP),this._onBindObservable}set onBind(e){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(e)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new a.cP),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new a.cP),this._onEffectCreatedObservable}set alphaMode(e){this._alphaMode!==e&&(this._alphaMode=e,this.markAsDirty(Ne.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(e){this._needDepthPrePass!==e&&(this._needDepthPrePass=e,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(e){this._fogEnabled!==e&&(this._fogEnabled=e,this.markAsDirty(Ne.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case Ne.WireFrameFillMode:case Ne.LineListDrawMode:case Ne.LineLoopDrawMode:case Ne.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(e){this.fillMode=e?Ne.WireFrameFillMode:Ne.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case Ne.PointFillMode:case Ne.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(e){this.fillMode=e?Ne.PointFillMode:Ne.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(e){this._fillMode!==e&&(this._fillMode=e,this.markAsDirty(Ne.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(e){const t=this.getScene().getEngine().getCaps().fragmentDepthSupported;e&&!t&&T.V.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=e&&t,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(e){this._drawWrapper=e}constructor(e,t,i){this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.onDisposeObservable=new a.cP,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new ne,this._useUBO=!1,this._fillMode=Ne.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._forceAlphaTest=!1,this._transparencyMode=null,this.name=e;const r=t||l.q.LastCreatedScene;r&&(this._scene=r,this._dirtyCallbacks={},this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[63]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=e||_.S0.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new z.E(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new $.D(this._scene.getEngine(),void 0,void 0,e),this._useUBO=this.getScene().getEngine().supportsUniformBuffers,i||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),Ne.OnEventObservable.notifyObservers(this,1))}toString(e){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.markDirty(),this.checkReadyOnlyOnce=!0}unfreeze(){this.markDirty(),this.checkReadyOnlyOnce=!1}isReady(e,t){return!0}isReadyForSubMesh(e,t,i){const r=t.materialDefines;return!!r&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=r,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}getScene(){return this._scene}_getEffectiveOrientation(e){return null!==this.sideOrientation?this.sideOrientation:e.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(e){this._transparencyMode!==e&&(this._transparencyMode=e,this._forceAlphaTest=e===Ne.MATERIAL_ALPHATESTANDBLEND,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _disableAlphaBlending(){return this._transparencyMode===Ne.MATERIAL_OPAQUE||this._transparencyMode===Ne.MATERIAL_ALPHATEST}needAlphaBlending(){return!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(e){return e.visibility<1||!this._disableAlphaBlending&&(e.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._forceAlphaTest}_shouldTurnAlphaTestOn(e){return!this.needAlphaBlendingForMesh(e)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}markDirty(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=this.getScene().meshes;for(const i of t)if(i.subMeshes)for(const t of i.subMeshes)if(t.getMaterial()===this)for(const i of t._drawWrappers)i&&this._materialContext===i.materialContext&&(i._wasPreviouslyReady=!1,i._wasPreviouslyUsingInstances=null,i._forceRebindOnNextCall=e);e&&this.markAsDirty(Ne.AllDirtyFlag)}_preBind(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=this._scene.getEngine(),r=(null==t?this.sideOrientation:t)===Ne.ClockWiseSideOrientation;return i.enableEffect(e||this._getDrawWrapper()),i.setState(this.backFaceCulling,this.zOffset,!1,r,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),r}bind(e,t){}buildUniformLayout(){const e=this._uniformBuffer;this._eventInfo.ubo=e,this._callbackPluginEventGeneric(8,this._eventInfo),e.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(e,t,i){const r=i._drawWrapper;this._eventInfo.subMesh=i,this._callbackPluginEventBindForSubMesh(this._eventInfo),r._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(e){}bindView(e){this._useUBO?this._needToBindSceneUbo=!0:e.setMatrix("view",this.getScene().getViewMatrix())}bindViewProjection(e){this._useUBO?this._needToBindSceneUbo=!0:(e.setMatrix("viewProjection",this.getScene().getTransformMatrix()),e.setMatrix("projection",this.getScene().getProjectionMatrix()))}bindEyePosition(e,t){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(e,t)}_afterBind(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&t&&(this._needToBindSceneUbo=!1,ge(t,this.getScene().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=e?e.visibility:1,this._onBindObservable&&e&&this._onBindObservable.notifyObservers(e),this.disableDepthWrite){const e=this._scene.getEngine();this._cachedDepthWriteState=e.getDepthWrite(),e.setDepthWrite(!1)}if(this.disableColorWrite){const e=this._scene.getEngine();this._cachedColorWriteState=e.getColorWrite(),e.setColorWrite(!1)}if(0!==this.depthFunction){const e=this._scene.getEngine();this._cachedDepthFunctionState=e.getDepthFunction()||0,e.setDepthFunction(this.depthFunction)}}unbind(){if(this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(e){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=e,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(e){return null}_clonePlugins(e,t){const i={};if(this._serializePlugins(i),Ne._ParsePlugins(i,e,this._scene,t),this.pluginManager)for(const r of this.pluginManager._plugins){const t=e.pluginManager.getPlugin(r.name);t&&r.copyTo(t)}}getBindedMeshes(){if(this.meshMap){const e=[];for(const t in this.meshMap){const i=this.meshMap[t];i&&e.push(i)}return e}return this._scene.meshes.filter((e=>e.material===this))}forceCompilation(e,t,i,r){const s={clipPlane:!1,useInstances:!1,...i},n=this.getScene(),a=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const o=()=>{if(!this._scene||!this._scene.getEngine())return;const i=n.clipPlane;if(s.clipPlane&&(n.clipPlane=new se.Z(0,0,0,1)),this._storeEffectOnSubMeshes){let i=!0,n=null;if(e.subMeshes){const t=new G(0,0,0,0,0,e,void 0,!1,!1);t.materialDefines&&(t.materialDefines._renderId=-1),this.isReadyForSubMesh(e,t,s.useInstances)||(t.effect&&t.effect.getCompilationError()&&t.effect.allFallbacksProcessed()?n=t.effect.getCompilationError():(i=!1,setTimeout(o,16)))}i&&(this.allowShaderHotSwapping=a,n&&r&&r(n),t&&t(this))}else this.isReady()?(this.allowShaderHotSwapping=a,t&&t(this)):setTimeout(o,16);s.clipPlane&&(n.clipPlane=i)};o()}forceCompilationAsync(e,t){return new Promise(((i,r)=>{this.forceCompilation(e,(()=>{i()}),t,(e=>{r(e)}))}))}markAsDirty(e){this.getScene().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(Ne._DirtyCallbackArray.length=0,e&Ne.TextureDirtyFlag&&Ne._DirtyCallbackArray.push(Ne._TextureDirtyCallBack),e&Ne.LightDirtyFlag&&Ne._DirtyCallbackArray.push(Ne._LightsDirtyCallBack),e&Ne.FresnelDirtyFlag&&Ne._DirtyCallbackArray.push(Ne._FresnelDirtyCallBack),e&Ne.AttributesDirtyFlag&&Ne._DirtyCallbackArray.push(Ne._AttributeDirtyCallBack),e&Ne.MiscDirtyFlag&&Ne._DirtyCallbackArray.push(Ne._MiscDirtyCallBack),e&Ne.PrePassDirtyFlag&&Ne._DirtyCallbackArray.push(Ne._PrePassDirtyCallBack),Ne._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(Ne._RunDirtyCallBacks),this.getScene().resetCachedMaterial())}resetDrawCache(){const e=this.getScene().meshes;for(const t of e)if(t.subMeshes)for(const e of t.subMeshes)e.getMaterial()===this&&e.resetDrawCache()}_markAllSubMeshesAsDirty(e){if(this.getScene().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const t=this.getScene().meshes;for(const i of t)if(i.subMeshes)for(const t of i.subMeshes)if(t.getMaterial(!1)===this)for(const i of t._drawWrappers)i&&i.defines&&i.defines.markAllAsDirty&&this._materialContext===i.materialContext&&e(i.defines)}_markScenePrePassDirty(){if(this.getScene().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const e=this.getScene().enablePrePassRenderer();e&&e.markAsDirty()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(Ne._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(Ne._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(Ne._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(Ne._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(Ne._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(Ne._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(Ne._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(Ne._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(Ne._MiscDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(Ne._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const e=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.onDisposeObservable.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(e)}))}}setPrePassRenderer(e){return!1}dispose(e,t,i){const r=this.getScene();if(r.stopAnimation(this),r.freeProcessedMaterials(),r.removeMaterial(this),this._eventInfo.forceDisposeTextures=t,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const e=this._parentContainer.materials.indexOf(this);e>-1&&this._parentContainer.materials.splice(e,1),this._parentContainer=null}if(!0!==i)if(this.meshMap)for(const s in this.meshMap){const t=this.meshMap[s];t&&(t.material=null,this.releaseVertexArrayObject(t,e))}else{const t=r.meshes;for(const i of t)i.material!==this||i.sourceMesh||(i.material=null,this.releaseVertexArrayObject(i,e))}this._uniformBuffer.dispose(),e&&this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}releaseVertexArrayObject(e,t){const i=e.geometry;if(i)if(this._storeEffectOnSubMeshes){if(e.subMeshes)for(const r of e.subMeshes)i._releaseVertexArrayObject(r.effect),t&&r.effect&&r.effect.dispose()}else i._releaseVertexArrayObject(this._drawWrapper.effect)}serialize(){const e=c.p.Serialize(this);return e.stencil=this.stencil.serialize(),e.uniqueId=this.uniqueId,this._serializePlugins(e),e}_serializePlugins(e){if(e.plugins={},this.pluginManager)for(const t of this.pluginManager._plugins)e.plugins[t.getClassName()]=t.serialize()}static Parse(e,t,i){if(e.customType){if("BABYLON.PBRMaterial"===e.customType&&e.overloadedAlbedo&&(e.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return T.V.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else e.customType="BABYLON.StandardMaterial";const r=_.S0.Instantiate(e.customType).Parse(e,t,i);return r._loadedUniqueId=e.uniqueId,r}static _ParsePlugins(e,t,i,r){if(e.plugins)for(const s in e.plugins){const n=e.plugins[s];let a=t.pluginManager?.getPlugin(n.name);if(!a){const e=_.S0.Instantiate("BABYLON."+s);e&&(a=new e(t))}a?.parse(n,i,r)}}}Ne.TriangleFillMode=0,Ne.WireFrameFillMode=1,Ne.PointFillMode=2,Ne.PointListDrawMode=3,Ne.LineListDrawMode=4,Ne.LineLoopDrawMode=5,Ne.LineStripDrawMode=6,Ne.TriangleStripDrawMode=7,Ne.TriangleFanDrawMode=8,Ne.ClockWiseSideOrientation=0,Ne.CounterClockWiseSideOrientation=1,Ne.TextureDirtyFlag=1,Ne.LightDirtyFlag=2,Ne.FresnelDirtyFlag=4,Ne.AttributesDirtyFlag=8,Ne.MiscDirtyFlag=16,Ne.PrePassDirtyFlag=32,Ne.AllDirtyFlag=63,Ne.MATERIAL_OPAQUE=0,Ne.MATERIAL_ALPHATEST=1,Ne.MATERIAL_ALPHABLEND=2,Ne.MATERIAL_ALPHATESTANDBLEND=3,Ne.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,Ne.MATERIAL_NORMALBLENDMETHOD_RNM=1,Ne.OnEventObservable=new a.cP,Ne._AllDirtyCallBack=e=>e.markAllAsDirty(),Ne._ImageProcessingDirtyCallBack=e=>e.markAsImageProcessingDirty(),Ne._TextureDirtyCallBack=e=>e.markAsTexturesDirty(),Ne._FresnelDirtyCallBack=e=>e.markAsFresnelDirty(),Ne._MiscDirtyCallBack=e=>e.markAsMiscDirty(),Ne._PrePassDirtyCallBack=e=>e.markAsPrePassDirty(),Ne._LightsDirtyCallBack=e=>e.markAsLightDirty(),Ne._AttributeDirtyCallBack=e=>e.markAsAttributesDirty(),Ne._FresnelAndMiscDirtyCallBack=e=>{Ne._FresnelDirtyCallBack(e),Ne._MiscDirtyCallBack(e)},Ne._TextureAndMiscDirtyCallBack=e=>{Ne._TextureDirtyCallBack(e),Ne._MiscDirtyCallBack(e)},Ne._DirtyCallbackArray=[],Ne._RunDirtyCallBacks=e=>{for(const t of Ne._DirtyCallbackArray)t(e)},(0,s.Cg)([(0,n.lK)()],Ne.prototype,"id",void 0),(0,s.Cg)([(0,n.lK)()],Ne.prototype,"uniqueId",void 0),(0,s.Cg)([(0,n.lK)()],Ne.prototype,"name",void 0),(0,s.Cg)([(0,n.lK)()],Ne.prototype,"metadata",void 0),(0,s.Cg)([(0,n.lK)()],Ne.prototype,"checkReadyOnEveryCall",void 0),(0,s.Cg)([(0,n.lK)()],Ne.prototype,"checkReadyOnlyOnce",void 0),(0,s.Cg)([(0,n.lK)()],Ne.prototype,"state",void 0),(0,s.Cg)([(0,n.lK)("alpha")],Ne.prototype,"_alpha",void 0),(0,s.Cg)([(0,n.lK)("backFaceCulling")],Ne.prototype,"_backFaceCulling",void 0),(0,s.Cg)([(0,n.lK)("cullBackFaces")],Ne.prototype,"_cullBackFaces",void 0),(0,s.Cg)([(0,n.lK)()],Ne.prototype,"sideOrientation",void 0),(0,s.Cg)([(0,n.lK)("alphaMode")],Ne.prototype,"_alphaMode",void 0),(0,s.Cg)([(0,n.lK)()],Ne.prototype,"_needDepthPrePass",void 0),(0,s.Cg)([(0,n.lK)()],Ne.prototype,"disableDepthWrite",void 0),(0,s.Cg)([(0,n.lK)()],Ne.prototype,"disableColorWrite",void 0),(0,s.Cg)([(0,n.lK)()],Ne.prototype,"forceDepthWrite",void 0),(0,s.Cg)([(0,n.lK)()],Ne.prototype,"depthFunction",void 0),(0,s.Cg)([(0,n.lK)()],Ne.prototype,"separateCullingPass",void 0),(0,s.Cg)([(0,n.lK)("fogEnabled")],Ne.prototype,"_fogEnabled",void 0),(0,s.Cg)([(0,n.lK)()],Ne.prototype,"pointSize",void 0),(0,s.Cg)([(0,n.lK)()],Ne.prototype,"zOffset",void 0),(0,s.Cg)([(0,n.lK)()],Ne.prototype,"zOffsetUnits",void 0),(0,s.Cg)([(0,n.lK)()],Ne.prototype,"pointsCloud",null),(0,s.Cg)([(0,n.lK)()],Ne.prototype,"fillMode",null),(0,s.Cg)([(0,n.lK)()],Ne.prototype,"useLogarithmicDepth",null),(0,s.Cg)([(0,n.lK)()],Ne.prototype,"transparencyMode",null);class ke extends Ne{get subMaterials(){return this._subMaterials}set subMaterials(e){this._subMaterials=e,this._hookArray(e)}getChildren(){return this.subMaterials}constructor(e,t){super(e,t,!0),this._waitingSubMaterialsUniqueIds=[],this.getScene().addMultiMaterial(this),this.subMaterials=[],this._storeEffectOnSubMeshes=!0}_hookArray(e){var t=this;const i=e.push;e.push=function(){for(var r=arguments.length,s=new Array(r),n=0;n<r;n++)s[n]=arguments[n];const a=i.apply(e,s);return t._markAllSubMeshesAsTexturesDirty(),a};const r=e.splice;e.splice=(t,i)=>{const s=r.apply(e,[t,i]);return this._markAllSubMeshesAsTexturesDirty(),s}}getSubMaterial(e){return e<0||e>=this.subMaterials.length?this.getScene().defaultMaterial:this.subMaterials[e]}getActiveTextures(){return super.getActiveTextures().concat(...this.subMaterials.map((e=>e?e.getActiveTextures():[])))}hasTexture(e){if(super.hasTexture(e))return!0;for(let t=0;t<this.subMaterials.length;t++)if(this.subMaterials[t]?.hasTexture(e))return!0;return!1}getClassName(){return"MultiMaterial"}isReadyForSubMesh(e,t,i){for(let r=0;r<this.subMaterials.length;r++){const s=this.subMaterials[r];if(s){if(s._storeEffectOnSubMeshes){if(!s.isReadyForSubMesh(e,t,i))return!1;continue}if(!s.isReady(e))return!1}}return!0}clone(e,t){const i=new ke(e,this.getScene());for(let r=0;r<this.subMaterials.length;r++){let s=null;const n=this.subMaterials[r];s=t&&n?n.clone(e+"-"+n.name):this.subMaterials[r],i.subMaterials.push(s)}return i}serialize(){const e={};e.name=this.name,e.id=this.id,e.uniqueId=this.uniqueId,f.Y&&(e.tags=f.Y.GetTags(this)),e.materialsUniqueIds=[],e.materials=[];for(let t=0;t<this.subMaterials.length;t++){const i=this.subMaterials[t];i?(e.materialsUniqueIds.push(i.uniqueId),e.materials.push(i.id)):(e.materialsUniqueIds.push(null),e.materials.push(null))}return e}dispose(e,t,i){const r=this.getScene();if(!r)return;if(i)for(let n=0;n<this.subMaterials.length;n++){const i=this.subMaterials[n];i&&i.dispose(e,t)}const s=r.multiMaterials.indexOf(this);s>=0&&r.multiMaterials.splice(s,1),super.dispose(e,t)}static ParseMultiMaterial(e,t){const i=new ke(e.name,t);return i.id=e.id,i._loadedUniqueId=e.uniqueId,f.Y&&f.Y.AddTagsTo(i,e.tags),e.materialsUniqueIds?i._waitingSubMaterialsUniqueIds=e.materialsUniqueIds:e.materials.forEach((e=>i.subMaterials.push(t.getLastMaterialById(e)))),i}}(0,x.Y5)("BABYLON.MultiMaterial",ke);var Ue=i(6736);class Ve{constructor(e,t){this.distanceOrScreenCoverage=e,this.mesh=t}}class ze{}class Ge{constructor(){this.visibleInstances={},this.batchCache=new He,this.batchCacheReplacementModeInFrozenMode=new He,this.instancesBufferSize=2048}}class He{constructor(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=[],this.hardwareInstancedRendering=[]}}class We{constructor(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}}class qe{constructor(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0,this._overrideRenderingFillMode=null}}class Xe extends re{static _GetDefaultSideOrientation(e){return e||Xe.FRONTSIDE}get useLODScreenCoverage(){return this._internalMeshDataInfo._useLODScreenCoverage}set useLODScreenCoverage(e){this._internalMeshDataInfo._useLODScreenCoverage=e,this._sortLODLevels()}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(e){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==e&&(e&&this._internalMeshDataInfo._sourcePositions&&(this.setVerticesData(S.R.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.setVerticesData(S.R.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=e,this._markSubMeshesAsAttributesDirty())}get onBeforeRenderObservable(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new a.cP),this._internalMeshDataInfo._onBeforeRenderObservable}get onBeforeBindObservable(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new a.cP),this._internalMeshDataInfo._onBeforeBindObservable}get onAfterRenderObservable(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new a.cP),this._internalMeshDataInfo._onAfterRenderObservable}get onBetweenPassObservable(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new a.cP),this._internalMeshDataInfo._onBetweenPassObservable}get onBeforeDrawObservable(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new a.cP),this._internalMeshDataInfo._onBeforeDrawObservable}set onBeforeDraw(e){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(e)}get hasInstances(){return this.instances.length>0}get hasThinInstances(){return(this.forcedInstanceCount||this._thinInstanceDataStorage.instancesCount||0)>0}get forcedInstanceCount(){return this._internalMeshDataInfo._forcedInstanceCount}set forcedInstanceCount(e){this._internalMeshDataInfo._forcedInstanceCount=e}get sideOrientation(){return this._internalMeshDataInfo._sideOrientation}set sideOrientation(e){this._internalMeshDataInfo._sideOrientation=e,this._internalAbstractMeshDataInfo._sideOrientationHint=this._scene.useRightHandedSystem&&1===e||!this._scene.useRightHandedSystem&&0===e}get overrideMaterialSideOrientation(){return this.sideOrientation}set overrideMaterialSideOrientation(e){this.sideOrientation=e,this.material&&(this.material.sideOrientation=null)}get overrideRenderingFillMode(){return this._internalMeshDataInfo._overrideRenderingFillMode}set overrideRenderingFillMode(e){this._internalMeshDataInfo._overrideRenderingFillMode=e}get material(){return this._internalAbstractMeshDataInfo._material}set material(e){e&&(this.material&&null===this.material.sideOrientation||this._internalAbstractMeshDataInfo._sideOrientationHint)&&(e.sideOrientation=null),this._setMaterial(e)}get source(){return this._internalMeshDataInfo._source}get cloneMeshMap(){return this._internalMeshDataInfo.meshMap}get isUnIndexed(){return this._unIndexed}set isUnIndexed(e){this._unIndexed!==e&&(this._unIndexed=e,this._markSubMeshesAsAttributesDirty())}get worldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesData}get previousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesPreviousData}get manualUpdateOfWorldMatrixInstancedBuffer(){return this._instanceDataStorage.manualUpdate}set manualUpdateOfWorldMatrixInstancedBuffer(e){this._instanceDataStorage.manualUpdate=e}get manualUpdateOfPreviousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.previousManualUpdate}set manualUpdateOfPreviousWorldMatrixInstancedBuffer(e){this._instanceDataStorage.previousManualUpdate=e}get forceWorldMatrixInstancedBufferUpdate(){return this._instanceDataStorage.forceMatrixUpdates}set forceWorldMatrixInstancedBufferUpdate(e){this._instanceDataStorage.forceMatrixUpdates=e}_copySource(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=this.getScene();if(e._geometry&&e._geometry.applyToMesh(this),p.r.DeepCopy(e,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","geometry","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","isWorldMatrixFrozen","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo","physicsBody","physicsImpostor"],["_poseMatrix"]),this._internalMeshDataInfo._source=e,r.useClonedMeshMap&&(e._internalMeshDataInfo.meshMap||(e._internalMeshDataInfo.meshMap={}),e._internalMeshDataInfo.meshMap[this.uniqueId]=this),this._originalBuilderSideOrientation=e._originalBuilderSideOrientation,this._creationDataStorage=e._creationDataStorage,e._ranges){const t=e._ranges;for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&t[e]&&this.createAnimationRange(e,t[e].from,t[e].to)}if(e.metadata&&e.metadata.clone?this.metadata=e.metadata.clone():this.metadata=e.metadata,this._internalMetadata=e._internalMetadata,f.Y&&f.Y.HasTags(e)&&f.Y.AddTagsTo(this,f.Y.GetTags(e,!0)),this.setEnabled(e.isEnabled(!1)),this.parent=e.parent,this.setPivotMatrix(e.getPivotMatrix(),this._postMultiplyPivotMatrix),this.id=this.name+"."+e.id,this.material=e.material,!t){const t=e.getDescendants(!0);for(let e=0;e<t.length;e++){const i=t[e];i.clone&&i.clone(this.name+"."+i.name,this)}}if(e.morphTargetManager&&(this.morphTargetManager=e.morphTargetManager),r.getPhysicsEngine){const t=r.getPhysicsEngine();if(i&&t)if(1===t.getPluginVersion()){const i=t.getImpostorForPhysicsObject(e);i&&(this.physicsImpostor=i.clone(this))}else 2===t.getPluginVersion()&&e.physicsBody&&e.physicsBody.clone(this)}for(let s=0;s<r.particleSystems.length;s++){const t=r.particleSystems[s];t.emitter===e&&t.clone(t.name,this)}this.skeleton=e.skeleton,this.refreshBoundingInfo(!0,!0),this.computeWorldMatrix(!0)}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4?arguments[4]:void 0,n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];super(e,t),this._internalMeshDataInfo=new qe,this.delayLoadState=0,this.instances=[],this._creationDataStorage=null,this._geometry=null,this._instanceDataStorage=new Ge,this._thinInstanceDataStorage=new We,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=Xe.DEFAULTSIDE,this.ignoreCameraMaxZ=!1,t=this.getScene(),this._scene.useRightHandedSystem?this.sideOrientation=0:this.sideOrientation=1,this._onBeforeDraw=(e,t,i)=>{e&&i&&(this._uniformBuffer?this.transferToEffect(t):i.bindOnlyWorldMatrix(t))},r&&this._copySource(r,s,n),null!==i&&(this.parent=i),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=e=>{e.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add((()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))})))},this.onMeshReadyObservable=new a.cP(this._internalMeshDataInfo._onMeshReadyObserverAdded),r&&r.onClonedObservable.notifyObservers(this)}instantiateHierarchy(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;const r=0===this.getTotalVertices()||t&&t.doNotInstantiate&&(!0===t.doNotInstantiate||t.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),e||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));r.parent=e||this.parent,r.position=this.position.clone(),r.scaling=this.scaling.clone(),this.rotationQuaternion?r.rotationQuaternion=this.rotationQuaternion.clone():r.rotation=this.rotation.clone(),i&&i(this,r);for(const s of this.getChildTransformNodes(!0))"InstancedMesh"===s.getClassName()&&"Mesh"===r.getClassName()&&s.sourceMesh===this?s.instantiateHierarchy(r,{doNotInstantiate:t&&t.doNotInstantiate||!1,newSourcedMesh:r},i):s.instantiateHierarchy(r,t,i);return r}getClassName(){return"Mesh"}get _isMesh(){return!0}toString(e){let t=super.toString(e);if(t+=", n vertices: "+this.getTotalVertices(),t+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let i=0;i<this.animations.length;i++)t+=", animation[0]: "+this.animations[i].toString(e);if(e)if(this._geometry){const e=this.getIndices(),i=this.getVerticesData(S.R.PositionKind);i&&e&&(t+=", flat shading: "+(i.length/3===e.length?"YES":"NO"))}else t+=", flat shading: UNKNOWN";return t}_unBindEffect(){super._unBindEffect();for(const e of this.instances)e._unBindEffect()}get hasLODLevels(){return this._internalMeshDataInfo._LODLevels.length>0}getLODLevels(){return this._internalMeshDataInfo._LODLevels}_sortLODLevels(){const e=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort(((t,i)=>t.distanceOrScreenCoverage<i.distanceOrScreenCoverage?e:t.distanceOrScreenCoverage>i.distanceOrScreenCoverage?-e:0))}addLODLevel(e,t){if(t&&t._masterMesh)return T.V.Warn("You cannot use a mesh as LOD level twice"),this;const i=new Ve(e,t);return this._internalMeshDataInfo._LODLevels.push(i),t&&(t._masterMesh=this),this._sortLODLevels(),this}getLODLevelAtDistance(e){const t=this._internalMeshDataInfo;for(let i=0;i<t._LODLevels.length;i++){const r=t._LODLevels[i];if(r.distanceOrScreenCoverage===e)return r.mesh}return null}removeLODLevel(e){const t=this._internalMeshDataInfo;for(let i=0;i<t._LODLevels.length;i++)t._LODLevels[i].mesh===e&&(t._LODLevels.splice(i,1),e&&(e._masterMesh=null));return this._sortLODLevels(),this}getLOD(e,t){const i=this._internalMeshDataInfo;if(!i._LODLevels||0===i._LODLevels.length)return this;const r=t||this.getBoundingInfo().boundingSphere,s=e.mode===R.ORTHOGRAPHIC_CAMERA?e.minZ:r.centerWorld.subtract(e.globalPosition).length();let n=s,a=1;if(i._useLODScreenCoverage){const t=e.screenArea;let i=r.radiusWorld*e.minZ/s;i=i*i*Math.PI,n=i/t,a=-1}if(a*i._LODLevels[i._LODLevels.length-1].distanceOrScreenCoverage>a*n)return this.onLODLevelSelection&&this.onLODLevelSelection(n,this,this),this;for(let o=0;o<i._LODLevels.length;o++){const e=i._LODLevels[o];if(a*e.distanceOrScreenCoverage<a*n){if(e.mesh){if(4===e.mesh.delayLoadState)return e.mesh._checkDelayState(),this;if(2===e.mesh.delayLoadState)return this;e.mesh._preActivate(),e.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(n,this,e.mesh),e.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(n,this,this),this}get geometry(){return this._geometry}getTotalVertices(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()}getVerticesData(e,t,i,r){if(!this._geometry)return null;let s=r?void 0:this._userInstancedBuffersStorage?.vertexBuffers[e]?.getFloatData(this.instances.length+1,i||t&&1!==this._geometry.meshes.length);return s||(s=this._geometry.getVerticesData(e,t,i)),s}copyVerticesData(e,t){this._geometry&&this._geometry.copyVerticesData(e,t)}getVertexBuffer(e,t){return this._geometry?(t?void 0:this._userInstancedBuffersStorage?.vertexBuffers[e])??this._geometry.getVertexBuffer(e):null}isVerticesDataPresent(e,t){return this._geometry?!t&&void 0!==this._userInstancedBuffersStorage?.vertexBuffers[e]||this._geometry.isVerticesDataPresent(e):!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)}isVertexBufferUpdatable(e,t){if(!this._geometry)return!!this._delayInfo&&-1!==this._delayInfo.indexOf(e);if(!t){const t=this._userInstancedBuffersStorage?.vertexBuffers[e];if(t)return t.isUpdatable()}return this._geometry.isVertexBufferUpdatable(e)}getVerticesDataKinds(e){if(!this._geometry){const e=[];return this._delayInfo&&this._delayInfo.forEach((function(t){e.push(t)})),e}const t=this._geometry.getVerticesDataKinds();if(!e&&this._userInstancedBuffersStorage)for(const i in this._userInstancedBuffersStorage.vertexBuffers)-1===t.indexOf(i)&&t.push(i);return t}getTotalIndices(){return this._geometry?this._geometry.getTotalIndices():0}getIndices(e,t){return this._geometry?this._geometry.getIndices(e,t):[]}get isBlocked(){return null!==this._masterMesh&&void 0!==this._masterMesh}isReady(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(2===this.delayLoadState)return!1;if(!super.isReady(e))return!1;if(!this.subMeshes||0===this.subMeshes.length)return!0;if(!e)return!0;const i=this.getEngine(),r=this.getScene(),s=t||i.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.computeWorldMatrix();const n=this.material||r.defaultMaterial;if(n)if(n._storeEffectOnSubMeshes)for(const o of this.subMeshes){const e=o.getMaterial();if(e)if(e._storeEffectOnSubMeshes){if(!e.isReadyForSubMesh(this,o,s))return!1}else if(!e.isReady(this,s))return!1}else if(!n.isReady(this,s))return!1;const a=i.currentRenderPassId;for(const o of this.lightSources){const e=o.getShadowGenerators();if(!e)continue;const t=e.values();for(let r=t.next();!0!==r.done;r=t.next()){const e=r.value;if(e&&(!e.getShadowMap()?.renderList||e.getShadowMap()?.renderList&&-1!==e.getShadowMap()?.renderList?.indexOf(this))){const t=e.getShadowMap().renderPassIds??[i.currentRenderPassId];for(let r=0;r<t.length;++r){i.currentRenderPassId=t[r];for(const t of this.subMeshes)if(!e.isReady(t,s,t.getMaterial()?.needAlphaBlendingForMesh(this)??!1))return i.currentRenderPassId=a,!1}i.currentRenderPassId=a}}}for(const o of this._internalMeshDataInfo._LODLevels)if(o.mesh&&!o.mesh.isReady(s))return!1;return!0}get areNormalsFrozen(){return this._internalMeshDataInfo._areNormalsFrozen}freezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}unfreezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}set overridenInstanceCount(e){this._instanceDataStorage.overridenInstanceCount=e}_preActivate(){const e=this._internalMeshDataInfo,t=this.getScene().getRenderId();return e._preActivateId===t||(e._preActivateId=t,this._instanceDataStorage.visibleInstances=null),this}_preActivateForIntermediateRendering(e){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=e),this}_registerInstanceForRenderId(e,t){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:t,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[t]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=t,this._instanceDataStorage.visibleInstances[t]=new Array),this._instanceDataStorage.visibleInstances[t].push(e),this}_afterComputeWorldMatrix(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1))}_postActivate(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}refreshBoundingInfo(){let e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;e="object"===typeof t?t:{applySkeleton:t,applyMorph:i};const r=this.geometry?this.geometry.boundingBias:null;return this._refreshBoundingInfo(this._getData(e,null,S.R.PositionKind),r),this}_createGlobalSubMesh(e){const t=this.getTotalVertices();if(!t||!this.getIndices())return null;if(this.subMeshes&&this.subMeshes.length>0){const i=this.getIndices();if(!i)return null;const r=i.length;let s=!1;if(e)s=!0;else for(const e of this.subMeshes){if(e.indexStart+e.indexCount>r){s=!0;break}if(e.verticesStart+e.verticesCount>t){s=!0;break}}if(!s)return this.subMeshes[0]}return this.releaseSubMeshes(),new G(0,0,t,0,this.getTotalIndices(),this)}subdivide(e){if(e<1)return;const t=this.getTotalIndices();let i=t/e|0,r=0;for(;i%3!==0;)i++;this.releaseSubMeshes();for(let s=0;s<e&&!(r>=t);s++)G.CreateFromIndices(0,r,s===e-1?t-r:i,this,void 0,!1),r+=i;this.refreshBoundingInfo(),this.synchronizeInstances()}setVerticesData(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0;if(this._geometry)this._geometry.setVerticesData(e,t,i,r);else{const r=new W;r.set(t,e);const s=this.getScene();new K(K.RandomId(),s,r,i,this)}return this}removeVerticesData(e){this._geometry&&this._geometry.removeVerticesData(e)}markVerticesDataAsUpdatable(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=this.getVertexBuffer(e);i&&i.isUpdatable()!==t&&this.setVerticesData(e,this.getVerticesData(e),t)}setVerticesBuffer(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._geometry||(this._geometry=K.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(e,null,t),this}updateVerticesData(e,t,i,r){return this._geometry?(r?(this.makeGeometryUnique(),this.updateVerticesData(e,t,i,!1)):this._geometry.updateVerticesData(e,t,i),this):this}updateMeshPositions(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=this.getVerticesData(S.R.PositionKind);if(!i)return this;if(e(i),this.updateVerticesData(S.R.PositionKind,i,!1,!1),t){const e=this.getIndices(),t=this.getVerticesData(S.R.NormalKind);if(!t)return this;W.ComputeNormals(i,e,t),this.updateVerticesData(S.R.NormalKind,t,!1,!1)}return this}makeGeometryUnique(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;const e=this._geometry,t=this._geometry.copy(K.RandomId());return e.releaseForMesh(this,!0),t.applyToMesh(this),this}setIndexBuffer(e,t,i){let r=this._geometry;r||(r=new K(K.RandomId(),this.getScene(),void 0,void 0,this)),r.setIndexBuffer(e,t,i)}setIndices(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._geometry)this._geometry.setIndices(e,t,i);else{const t=new W;t.indices=e;const r=this.getScene();new K(K.RandomId(),r,t,i,this)}return this}updateIndices(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._geometry?(this._geometry.updateIndices(e,t,i),this):this}toLeftHanded(){return this._geometry?(this._geometry.toLeftHanded(),this):this}_bind(e,t,i){let r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!this._geometry)return this;const s=this.getScene().getEngine();let n;if(this._unIndexed)n=null;else switch(this._getRenderingFillMode(i)){case Ne.PointFillMode:n=null;break;case Ne.WireFrameFillMode:n=e._getLinesIndexBuffer(this.getIndices(),s);break;default:case Ne.TriangleFillMode:n=this._geometry.getIndexBuffer()}return this._bindDirect(t,n,r)}_bindDirect(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this._geometry?(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(e),i&&this._userInstancedBuffersStorage&&!this.hasThinInstances?this._geometry._bind(e,t,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(e,t),this):this}_draw(e,t,i){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);const r=this.getScene().getEngine();return this._unIndexed||t==Ne.PointFillMode?r.drawArraysType(t,e.verticesStart,e.verticesCount,this.forcedInstanceCount||i):t==Ne.WireFrameFillMode?r.drawElementsType(t,0,e._linesIndexCount,this.forcedInstanceCount||i):r.drawElementsType(t,e.indexStart,e.indexCount,this.forcedInstanceCount||i),this}registerBeforeRender(e){return this.onBeforeRenderObservable.add(e),this}unregisterBeforeRender(e){return this.onBeforeRenderObservable.removeCallback(e),this}registerAfterRender(e){return this.onAfterRenderObservable.add(e),this}unregisterAfterRender(e){return this.onAfterRenderObservable.removeCallback(e),this}_getInstancesRenderList(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._instanceDataStorage.isFrozen){if(t)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[e]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[e]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}const i=this.getScene(),r=i._isInIntermediateRendering(),s=r?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,n=this._instanceDataStorage.batchCache;if(n.mustReturn=!1,n.renderSelf[e]=t||!s&&this.isEnabled()&&this.isVisible,n.visibleInstances[e]=null,this._instanceDataStorage.visibleInstances&&!t){const t=this._instanceDataStorage.visibleInstances,s=i.getRenderId(),a=r?t.intermediateDefaultRenderId:t.defaultRenderId;n.visibleInstances[e]=t[s],!n.visibleInstances[e]&&a&&(n.visibleInstances[e]=t[a])}return n.hardwareInstancedRendering[e]=!t&&this._instanceDataStorage.hardwareInstancedRendering&&null!==n.visibleInstances[e]&&void 0!==n.visibleInstances[e],this._instanceDataStorage.previousBatch=n,n}_renderWithInstances(e,t,i,r,s){const n=i.visibleInstances[e._id],a=n?n.length:0,l=this._instanceDataStorage,h=l.instancesBufferSize;let c=l.instancesBuffer,u=l.instancesPreviousBuffer;const d=16*(a+1)*4;for(;l.instancesBufferSize<d;)l.instancesBufferSize*=2;l.instancesData&&h==l.instancesBufferSize||(l.instancesData=new Float32Array(l.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!l.instancesPreviousData||h!=l.instancesBufferSize)&&(l.instancesPreviousData=new Float32Array(l.instancesBufferSize/4));let _=0,p=0;const f=i.renderSelf[e._id],g=!c||h!==l.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!l.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||l.isFrozen&&!g)p=(f?1:0)+a;else{const t=this.getWorldMatrix();if(f&&(this._scene.needsPreviousWorldMatrices&&(l.masterMeshPreviousWorldMatrix?(l.masterMeshPreviousWorldMatrix.copyToArray(l.instancesPreviousData,_),l.masterMeshPreviousWorldMatrix.copyFrom(t)):(l.masterMeshPreviousWorldMatrix=t.clone(),l.masterMeshPreviousWorldMatrix.copyToArray(l.instancesPreviousData,_))),t.copyToArray(l.instancesData,_),_+=16,p++),n){if(Xe.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&e.getMaterial()?.needAlphaBlendingForMesh(e.getRenderingMesh())){const e=this._scene.activeCamera.globalPosition;for(let t=0;t<n.length;t++){const i=n[t];i._distanceToCamera=o.Pq.Distance(i.getBoundingInfo().boundingSphere.centerWorld,e)}n.sort(((e,t)=>e._distanceToCamera>t._distanceToCamera?-1:e._distanceToCamera<t._distanceToCamera?1:0))}for(let e=0;e<n.length;e++){const t=n[e],i=t.getWorldMatrix();i.copyToArray(l.instancesData,_),this._scene.needsPreviousWorldMatrices&&(t._previousWorldMatrix?(t._previousWorldMatrix.copyToArray(l.instancesPreviousData,_),t._previousWorldMatrix.copyFrom(i)):(t._previousWorldMatrix=i.clone(),t._previousWorldMatrix.copyToArray(l.instancesPreviousData,_))),_+=16,p++}}}return g?(c&&c.dispose(),u&&u.dispose(),c=new S.h(s,l.instancesData,!0,16,!1,!0),l.instancesBuffer=c,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=c.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=c.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=c.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=c.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(u=new S.h(s,l.instancesPreviousData,!0,16,!1,!0),l.instancesPreviousBuffer=u,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=u.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=u.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=u.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=u.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||(c.updateDirectly(l.instancesData,0,p),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||u.updateDirectly(l.instancesPreviousData,0,p)),this._processInstancedBuffers(n,f),this.getScene()._activeIndices.addCount(e.indexCount*p,!1),s._currentDrawContext&&(s._currentDrawContext.useInstancing=!0),this._bind(e,r,t),this._draw(e,t,p),!this._scene.needsPreviousWorldMatrices||g||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||this._instanceDataStorage.previousManualUpdate||u.updateDirectly(l.instancesData,0,p),s.unbindInstanceAttributes(),this}_renderWithThinInstances(e,t,i,r){const s=this._thinInstanceDataStorage?.instancesCount??0;this.getScene()._activeIndices.addCount(e.indexCount*s,!1),r._currentDrawContext&&(r._currentDrawContext.useInstancing=!0),this._bind(e,i,t),this._draw(e,t,s),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,s):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),r.unbindInstanceAttributes()}_processInstancedBuffers(e,t){}_processRendering(e,t,i,r,s,n,a,o){const l=this.getScene(),h=l.getEngine();if(r=this._getRenderingFillMode(r),n&&t.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(t,r,i,h),this;if(n)this._renderWithInstances(t,r,s,i,h);else{h._currentDrawContext&&(h._currentDrawContext.useInstancing=!1);let i=0;s.renderSelf[t._id]&&(a&&a(!1,e.getWorldMatrix(),o),i++,this._draw(t,r,this._instanceDataStorage.overridenInstanceCount));const n=s.visibleInstances[t._id];if(n){const e=n.length;i+=e;for(let i=0;i<e;i++){const e=n[i].getWorldMatrix();a&&a(!0,e,o),this._draw(t,r)}}l._activeIndices.addCount(t.indexCount*i,!1)}return this}_rebuild(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._instanceDataStorage.instancesBuffer&&(e&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(const t in this._userInstancedBuffersStorage.vertexBuffers){const i=this._userInstancedBuffersStorage.vertexBuffers[t];i&&(e&&i.dispose(),this._userInstancedBuffersStorage.vertexBuffers[t]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(e)}_freeze(){if(this.subMeshes){for(let e=0;e<this.subMeshes.length;e++)this._getInstancesRenderList(e);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}_unFreeze(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null}renderWithRenderPassId(e,t,i,r){let s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const n=this._scene.getEngine(),a=n.currentRenderPassId;if(void 0!==e&&(n.currentRenderPassId=e),r)(!s||s&&r.isInFrustum(this._scene._frustumPlanes))&&this.render(r,!!t,i);else for(let o=0;o<this.subMeshes.length;o++){const e=this.subMeshes[o];(!s||s&&e.isInFrustum(this._scene._frustumPlanes))&&this.render(e,!!t,i)}return void 0!==e&&(n.currentRenderPassId=a),this}render(e,t,i){const r=this.getScene();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;const s=r.activeCameras?.length??0;if((s>1&&r.activeCamera===r.activeCameras[0]||s<=1)&&this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;const n=this._getInstancesRenderList(e._id,!!i);if(n.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const a=r.getEngine();let o=0,l=null;this.ignoreCameraMaxZ&&r.activeCamera&&!r._isInIntermediateRendering()&&(o=r.activeCamera.maxZ,l=r.activeCamera,r.activeCamera.maxZ=0,r.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);const h=e.getRenderingMesh(),c=n.hardwareInstancedRendering[e._id]||h.hasThinInstances||!!this._userInstancedBuffersStorage&&!e.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,u=this._instanceDataStorage,d=e.getMaterial();if(!d)return l&&(l.maxZ=o,r.updateTransformMatrix(!0)),this;if(u.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===d){if(d._storeEffectOnSubMeshes&&!e._drawWrapper?._wasPreviouslyReady||!d._storeEffectOnSubMeshes&&!d._getDrawWrapper()._wasPreviouslyReady)return l&&(l.maxZ=o,r.updateTransformMatrix(!0)),this}else{if(d._storeEffectOnSubMeshes){if(!d.isReadyForSubMesh(this,e,c))return l&&(l.maxZ=o,r.updateTransformMatrix(!0)),this}else if(!d.isReady(this,c))return l&&(l.maxZ=o,r.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=d}let _;t&&a.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode),_=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?e._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();const p=_?.effect??null;for(const T of r._beforeRenderingMeshStage)T.action(this,e,n,p);if(!_||!p)return l&&(l.maxZ=o,r.updateTransformMatrix(!0)),this;const f=i||this;let g;if(u.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.backFaceCulling&&null===this._internalMeshDataInfo._effectiveMaterial.sideOrientation&&!this._internalMeshDataInfo._effectiveMaterial.twoSidedLighting)g=u.sideOrientation;else{const e=f._getWorldMatrixDeterminant();g=this._internalMeshDataInfo._effectiveMaterial._getEffectiveOrientation(this),e<0&&(g=g===Ne.ClockWiseSideOrientation?Ne.CounterClockWiseSideOrientation:Ne.ClockWiseSideOrientation),u.sideOrientation=g}const m=this._internalMeshDataInfo._effectiveMaterial._preBind(_,g);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&a.setDepthWrite(!0);const b=this._internalMeshDataInfo._effectiveMaterial,v=b.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),c||this._bind(e,p,v,!1);const y=f.getWorldMatrix();b._storeEffectOnSubMeshes?b.bindForSubMesh(y,this,e):b.bind(y,this),!b.backFaceCulling&&b.separateCullingPass&&(a.setState(!0,b.zOffset,!1,!m,b.cullBackFaces,b.stencil,b.zOffsetUnits),this._processRendering(this,e,p,v,n,c,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),a.setState(!0,b.zOffset,!1,m,b.cullBackFaces,b.stencil,b.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(e)),this._processRendering(this,e,p,v,n,c,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(const T of r._afterRenderingMeshStage)T.action(this,e,n,p);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),l&&(l.maxZ=o,r.updateTransformMatrix(!0)),2!==r.performancePriority||u.isFrozen||this._freeze(),this}cleanMatrixWeights(){this.isVerticesDataPresent(S.R.MatricesWeightsKind)&&(this.isVerticesDataPresent(S.R.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}_normalizeSkinFourWeights(){const e=this.getVerticesData(S.R.MatricesWeightsKind),t=e.length;for(let i=0;i<t;i+=4){const t=e[i]+e[i+1]+e[i+2]+e[i+3];if(0===t)e[i]=1;else{const r=1/t;e[i]*=r,e[i+1]*=r,e[i+2]*=r,e[i+3]*=r}}this.setVerticesData(S.R.MatricesWeightsKind,e)}_normalizeSkinWeightsAndExtra(){const e=this.getVerticesData(S.R.MatricesWeightsExtraKind),t=this.getVerticesData(S.R.MatricesWeightsKind),i=t.length;for(let r=0;r<i;r+=4){let i=t[r]+t[r+1]+t[r+2]+t[r+3];if(i+=e[r]+e[r+1]+e[r+2]+e[r+3],0===i)t[r]=1;else{const s=1/i;t[r]*=s,t[r+1]*=s,t[r+2]*=s,t[r+3]*=s,e[r]*=s,e[r+1]*=s,e[r+2]*=s,e[r+3]*=s}}this.setVerticesData(S.R.MatricesWeightsKind,t),this.setVerticesData(S.R.MatricesWeightsKind,e)}validateSkinning(){const e=this.getVerticesData(S.R.MatricesWeightsExtraKind),t=this.getVerticesData(S.R.MatricesWeightsKind);if(null===t||null==this.skeleton)return{skinned:!1,valid:!0,report:"not skinned"};const i=t.length;let r=0,s=0,n=0,a=0;const o=null===e?4:8,l=[];for(let _=0;_<=o;_++)l[_]=0;for(let _=0;_<i;_+=4){let i=t[_],h=i,c=0===h?0:1;for(let s=1;s<o;s++){const n=s<4?t[_+s]:e[_+s-4];n>i&&r++,0!==n&&c++,h+=n,i=n}if(l[c]++,c>n&&(n=c),0===h)s++;else{const i=1/h;let r=0;for(let s=0;s<o;s++)r+=s<4?Math.abs(t[_+s]-t[_+s]*i):Math.abs(e[_+s-4]-e[_+s-4]*i);r>.001&&a++}}const h=this.skeleton.bones.length,c=this.getVerticesData(S.R.MatricesIndicesKind),u=this.getVerticesData(S.R.MatricesIndicesExtraKind);let d=0;for(let _=0;_<i;_+=4)for(let e=0;e<o;e++){const t=e<4?c[_+e]:u[_+e-4];(t>=h||t<0)&&d++}return{skinned:!0,valid:0===s&&0===a&&0===d,report:"Number of Weights = "+i/4+"\nMaximum influences = "+n+"\nMissing Weights = "+s+"\nNot Sorted = "+r+"\nNot Normalized = "+a+"\nWeightCounts = ["+l+"]\nNumber of bones = "+h+"\nBad Bone Indices = "+d}}_checkDelayState(){const e=this.getScene();return this._geometry?this._geometry.load(e):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(e)),this}_queueLoad(e){e.addPendingData(this);const t=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return _.S0.LoadFile(this.delayLoadingFile,(t=>{t instanceof ArrayBuffer?this._delayLoadingFunction(t,this):this._delayLoadingFunction(JSON.parse(t),this),this.instances.forEach((e=>{e.refreshBoundingInfo(),e._syncSubMeshes()})),this.delayLoadState=1,e.removePendingData(this)}),(()=>{}),e.offlineProvider,t),this}isInFrustum(e){return 2!==this.delayLoadState&&(!!super.isInFrustum(e)&&(this._checkDelayState(),!0))}setMaterialById(e){const t=this.getScene().materials;let i;for(i=t.length-1;i>-1;i--)if(t[i].id===e)return this.material=t[i],this;const r=this.getScene().multiMaterials;for(i=r.length-1;i>-1;i--)if(r[i].id===e)return this.material=r[i],this;return this}getAnimatables(){const e=[];return this.material&&e.push(this.material),this.skeleton&&e.push(this.skeleton),e}bakeTransformIntoVertices(e){if(!this.isVerticesDataPresent(S.R.PositionKind))return this;const t=this.subMeshes.splice(0);this._resetPointsArrayCache();let i=this.getVerticesData(S.R.PositionKind);const r=o.Pq.Zero();let s;for(s=0;s<i.length;s+=3)o.Pq.TransformCoordinatesFromFloatsToRef(i[s],i[s+1],i[s+2],e,r).toArray(i,s);if(this.setVerticesData(S.R.PositionKind,i,this.getVertexBuffer(S.R.PositionKind).isUpdatable()),this.isVerticesDataPresent(S.R.NormalKind)){for(i=this.getVerticesData(S.R.NormalKind),s=0;s<i.length;s+=3)o.Pq.TransformNormalFromFloatsToRef(i[s],i[s+1],i[s+2],e,r).normalize().toArray(i,s);this.setVerticesData(S.R.NormalKind,i,this.getVertexBuffer(S.R.NormalKind).isUpdatable())}if(this.isVerticesDataPresent(S.R.TangentKind)){for(i=this.getVerticesData(S.R.TangentKind),s=0;s<i.length;s+=4)o.Pq.TransformNormalFromFloatsToRef(i[s],i[s+1],i[s+2],e,r).normalize().toArray(i,s);this.setVerticesData(S.R.TangentKind,i,this.getVertexBuffer(S.R.TangentKind).isUpdatable())}return e.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.subMeshes=t,this}bakeCurrentTransformIntoVertices(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.bakeTransformIntoVertices(this.computeWorldMatrix(!0)),this.resetLocalMatrix(e),this}get _positions(){return this._internalAbstractMeshDataInfo._positions||this._geometry&&this._geometry._positions||null}_resetPointsArrayCache(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}_generatePointsArray(){return!!this._geometry&&this._geometry._generatePointsArray()}clone(){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,t=arguments.length>2?arguments[2]:void 0,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return new Xe(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",this.getScene(),e,this,t,i)}dispose(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);const i=this._internalMeshDataInfo;if(i._onBeforeDrawObservable&&i._onBeforeDrawObservable.clear(),i._onBeforeBindObservable&&i._onBeforeBindObservable.clear(),i._onBeforeRenderObservable&&i._onBeforeRenderObservable.clear(),i._onAfterRenderObservable&&i._onAfterRenderObservable.clear(),i._onBetweenPassObservable&&i._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(i.meshMap)for(const e in i.meshMap){const t=i.meshMap[e];t&&(t._internalMeshDataInfo._source=null,i.meshMap[e]=void 0)}i._source&&i._source._internalMeshDataInfo.meshMap&&(i._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else{const e=this.getScene().meshes;for(const t of e){const e=t;e._internalMeshDataInfo&&e._internalMeshDataInfo._source&&e._internalMeshDataInfo._source===this&&(e._internalMeshDataInfo._source=null)}}i._source=null,this._instanceDataStorage.visibleInstances={},this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(e,t)}_disposeInstanceSpecificData(){}_disposeThinInstanceSpecificData(){}_invalidateInstanceVertexArrayObject(){}applyDisplacementMap(e,t,i,r,s,n){let a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=arguments.length>7?arguments[7]:void 0;const l=this.getScene();return _.S0.LoadImage(e,(e=>{const o=e.width,l=e.height,h=this.getEngine().createCanvas(o,l).getContext("2d");h.drawImage(e,0,0);const c=h.getImageData(0,0,o,l).data;this.applyDisplacementMapFromBuffer(c,o,l,t,i,s,n,a),r&&r(this)}),o||(()=>{}),l.offlineProvider),this}applyDisplacementMapFromBuffer(e,t,i,r,s,n,a){let l=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(!this.isVerticesDataPresent(S.R.PositionKind)||!this.isVerticesDataPresent(S.R.NormalKind)||!this.isVerticesDataPresent(S.R.UVKind))return T.V.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;const h=this.getVerticesData(S.R.PositionKind,!0,!0),c=this.getVerticesData(S.R.NormalKind),u=this.getVerticesData(S.R.UVKind);let d=o.Pq.Zero();const _=o.Pq.Zero(),p=o.I9.Zero();n=n||o.I9.Zero(),a=a||new o.I9(1,1);for(let f=0;f<h.length;f+=3){o.Pq.FromArrayToRef(h,f,d),o.Pq.FromArrayToRef(c,f,_),o.I9.FromArrayToRef(u,f/3*2,p);const l=4*((Math.abs(p.x*a.x+n.x%1)*(t-1)%t|0)+(Math.abs(p.y*a.y+n.y%1)*(i-1)%i|0)*t),g=.3*(e[l]/255)+.59*(e[l+1]/255)+.11*(e[l+2]/255);_.normalize(),_.scaleInPlace(r+(s-r)*g),d=d.add(_),d.toArray(h,f)}return W.ComputeNormals(h,this.getIndices(),c),l?(this.setVerticesData(S.R.PositionKind,h),this.setVerticesData(S.R.NormalKind,c),this.setVerticesData(S.R.UVKind,u)):(this.updateVerticesData(S.R.PositionKind,h),this.updateVerticesData(S.R.NormalKind,c)),this}_getFlattenedNormals(e,t){const i=new Float32Array(3*e.length);let r=0;const s=this.sideOrientation===(this._scene.useRightHandedSystem?1:0);for(let n=0;n<e.length;n+=3){const a=o.Pq.FromArray(t,3*e[n]),l=o.Pq.FromArray(t,3*e[n+1]),h=o.Pq.FromArray(t,3*e[n+2]),c=a.subtract(l),u=h.subtract(l),d=o.Pq.Normalize(o.Pq.Cross(c,u));s&&d.scaleInPlace(-1);for(let e=0;e<3;e++)i[r++]=d.x,i[r++]=d.y,i[r++]=d.z}return i}_convertToUnIndexedMesh(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=this.getVerticesDataKinds().filter((e=>!this.getVertexBuffer(e)?.getIsInstanced())),i=this.getIndices(),r={},s=(e,t)=>{const r=new Float32Array(i.length*t);let s=0;for(let n=0;n<i.length;n++)for(let a=0;a<t;a++)r[s++]=e[i[n]*t+a];return r},n=this.getBoundingInfo(),a=this.geometry?this.subMeshes.slice(0):[];for(const o of t)r[o]=this.getVerticesData(o);for(const o of t){const t=this.getVertexBuffer(o),n=t.getSize();if(e&&o===S.R.NormalKind){const e=this._getFlattenedNormals(i,r[S.R.PositionKind]);this.setVerticesData(S.R.NormalKind,e,t.isUpdatable(),n)}else this.setVerticesData(o,s(r[o],n),t.isUpdatable(),n)}if(this.morphTargetManager){for(let t=0;t<this.morphTargetManager.numTargets;t++){const r=this.morphTargetManager.getTarget(t),n=r.getPositions();r.setPositions(s(n,3));const a=r.getNormals();a&&r.setNormals(e?this._getFlattenedNormals(i,n):s(a,3));const o=r.getTangents();o&&r.setTangents(s(o,3));const l=r.getUVs();l&&r.setUVs(s(l,2))}this.morphTargetManager.synchronize()}for(let o=0;o<i.length;o++)i[o]=o;this.setIndices(i),this._unIndexed=!0,this.releaseSubMeshes();for(const o of a){const e=o.getBoundingInfo();G.AddToMesh(o.materialIndex,o.indexStart,o.indexCount,o.indexStart,o.indexCount,this).setBoundingInfo(e)}return this.setBoundingInfo(n),this.synchronizeInstances(),this}convertToFlatShadedMesh(){return this._convertToUnIndexedMesh(!0)}convertToUnIndexedMesh(){return this._convertToUnIndexedMesh()}flipFaces(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=W.ExtractFromMesh(this);let i;if(e&&this.isVerticesDataPresent(S.R.NormalKind)&&t.normals)for(i=0;i<t.normals.length;i++)t.normals[i]*=-1;if(t.indices){let e;for(i=0;i<t.indices.length;i+=3)e=t.indices[i+1],t.indices[i+1]=t.indices[i+2],t.indices[i+2]=e}return t.applyToMesh(this,this.isVertexBufferUpdatable(S.R.PositionKind)),this}increaseVertices(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const t=W.ExtractFromMesh(this),i=t.indices&&!Array.isArray(t.indices)&&Array.from?Array.from(t.indices):t.indices,r=t.positions&&!Array.isArray(t.positions)&&Array.from?Array.from(t.positions):t.positions,s=t.uvs&&!Array.isArray(t.uvs)&&Array.from?Array.from(t.uvs):t.uvs,n=t.normals&&!Array.isArray(t.normals)&&Array.from?Array.from(t.normals):t.normals;if(i&&r){t.indices=i,t.positions=r,s&&(t.uvs=s),n&&(t.normals=n);const a=e+1,l=new Array;for(let e=0;e<a+1;e++)l[e]=new Array;let h,c;const u=new o.Pq(0,0,0),d=new o.Pq(0,0,0),_=new o.I9(0,0),p=new Array,f=new Array,g=new Array;let m,b,v,y=r.length;s&&(b=s.length),n&&(v=n.length);for(let e=0;e<i.length;e+=3){f[0]=i[e],f[1]=i[e+1],f[2]=i[e+2];for(let e=0;e<3;e++)if(h=f[e],c=f[(e+1)%3],void 0===g[h]&&void 0===g[c]?(g[h]=new Array,g[c]=new Array):(void 0===g[h]&&(g[h]=new Array),void 0===g[c]&&(g[c]=new Array)),void 0===g[h][c]&&void 0===g[c][h]){g[h][c]=[],u.x=(r[3*c]-r[3*h])/a,u.y=(r[3*c+1]-r[3*h+1])/a,u.z=(r[3*c+2]-r[3*h+2])/a,n&&(d.x=(n[3*c]-n[3*h])/a,d.y=(n[3*c+1]-n[3*h+1])/a,d.z=(n[3*c+2]-n[3*h+2])/a),s&&(_.x=(s[2*c]-s[2*h])/a,_.y=(s[2*c+1]-s[2*h+1])/a),g[h][c].push(h);for(let e=1;e<a;e++)g[h][c].push(r.length/3),r[y++]=r[3*h]+e*u.x,r[y++]=r[3*h+1]+e*u.y,r[y++]=r[3*h+2]+e*u.z,n&&(n[v++]=n[3*h]+e*d.x,n[v++]=n[3*h+1]+e*d.y,n[v++]=n[3*h+2]+e*d.z),s&&(s[b++]=s[2*h]+e*_.x,s[b++]=s[2*h+1]+e*_.y);g[h][c].push(c),g[c][h]=new Array,m=g[h][c].length;for(let e=0;e<m;e++)g[c][h][e]=g[h][c][m-1-e]}l[0][0]=i[e],l[1][0]=g[i[e]][i[e+1]][1],l[1][1]=g[i[e]][i[e+2]][1];for(let t=2;t<a;t++){l[t][0]=g[i[e]][i[e+1]][t],l[t][t]=g[i[e]][i[e+2]][t],u.x=(r[3*l[t][t]]-r[3*l[t][0]])/t,u.y=(r[3*l[t][t]+1]-r[3*l[t][0]+1])/t,u.z=(r[3*l[t][t]+2]-r[3*l[t][0]+2])/t,n&&(d.x=(n[3*l[t][t]]-n[3*l[t][0]])/t,d.y=(n[3*l[t][t]+1]-n[3*l[t][0]+1])/t,d.z=(n[3*l[t][t]+2]-n[3*l[t][0]+2])/t),s&&(_.x=(s[2*l[t][t]]-s[2*l[t][0]])/t,_.y=(s[2*l[t][t]+1]-s[2*l[t][0]+1])/t);for(let e=1;e<t;e++)l[t][e]=r.length/3,r[y++]=r[3*l[t][0]]+e*u.x,r[y++]=r[3*l[t][0]+1]+e*u.y,r[y++]=r[3*l[t][0]+2]+e*u.z,n&&(n[v++]=n[3*l[t][0]]+e*d.x,n[v++]=n[3*l[t][0]+1]+e*d.y,n[v++]=n[3*l[t][0]+2]+e*d.z),s&&(s[b++]=s[2*l[t][0]]+e*_.x,s[b++]=s[2*l[t][0]+1]+e*_.y)}l[a]=g[i[e+1]][i[e+2]],p.push(l[0][0],l[1][0],l[1][1]);for(let e=1;e<a;e++){let t;for(t=0;t<e;t++)p.push(l[e][t],l[e+1][t],l[e+1][t+1]),p.push(l[e][t],l[e+1][t+1],l[e][t+1]);p.push(l[e][t],l[e+1][t],l[e+1][t+1])}}t.indices=p,t.applyToMesh(this,this.isVertexBufferUpdatable(S.R.PositionKind))}else T.V.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")}forceSharedVertices(){const e=W.ExtractFromMesh(this),t=e.uvs,i=e.indices,r=e.positions,s=e.colors,n=e.matricesIndices,a=e.matricesWeights,o=e.matricesIndicesExtra,l=e.matricesWeightsExtra;if(void 0===i||void 0===r||null===i||null===r)T.V.Warn("VertexData contains empty entries");else{const h=new Array,c=new Array,u=new Array,d=new Array,_=new Array,p=new Array,f=new Array,g=new Array;let m=new Array,b=0;const v={};let y,T;for(let e=0;e<i.length;e+=3){T=[i[e],i[e+1],i[e+2]],m=[];for(let e=0;e<3;e++){m[e]="";for(let t=0;t<3;t++)Math.abs(r[3*T[e]+t])<1e-8&&(r[3*T[e]+t]=0),m[e]+=r[3*T[e]+t]+"|"}if(m[0]!=m[1]&&m[0]!=m[2]&&m[1]!=m[2])for(let e=0;e<3;e++){if(y=v[m[e]],void 0===y){v[m[e]]=b,y=b++;for(let t=0;t<3;t++)h.push(r[3*T[e]+t]);if(null!==s&&void 0!==s)for(let t=0;t<4;t++)d.push(s[4*T[e]+t]);if(null!==t&&void 0!==t)for(let i=0;i<2;i++)u.push(t[2*T[e]+i]);if(null!==n&&void 0!==n)for(let t=0;t<4;t++)_.push(n[4*T[e]+t]);if(null!==a&&void 0!==a)for(let t=0;t<4;t++)p.push(a[4*T[e]+t]);if(null!==o&&void 0!==o)for(let t=0;t<4;t++)f.push(o[4*T[e]+t]);if(null!==l&&void 0!==l)for(let t=0;t<4;t++)g.push(l[4*T[e]+t])}c.push(y)}}const x=new Array;W.ComputeNormals(h,c,x),e.positions=h,e.indices=c,e.normals=x,null!==t&&void 0!==t&&(e.uvs=u),null!==s&&void 0!==s&&(e.colors=d),null!==n&&void 0!==n&&(e.matricesIndices=_),null!==a&&void 0!==a&&(e.matricesWeights=p),null!==o&&void 0!==o&&(e.matricesIndicesExtra=f),null!==a&&void 0!==a&&(e.matricesWeightsExtra=g),e.applyToMesh(this,this.isVertexBufferUpdatable(S.R.PositionKind))}}static _instancedMeshFactory(e,t){throw(0,h.n)("InstancedMesh")}static _PhysicsImpostorParser(e,t,i){throw(0,h.n)("PhysicsImpostor")}createInstance(e){return Xe._instancedMeshFactory(e,this)}synchronizeInstances(){for(let e=0;e<this.instances.length;e++){this.instances[e]._syncSubMeshes()}return this}optimizeIndices(e){const t=this.getIndices(),i=this.getVerticesData(S.R.PositionKind);if(!i||!t)return this;const r=[];for(let n=0;n<i.length;n+=3)r.push(o.Pq.FromArray(i,n));const s=[];return _.LV.SyncAsyncForLoop(r.length,40,(e=>{const t=r.length-1-e,i=r[t];for(let n=0;n<t;++n){const e=r[n];if(i.equals(e)){s[t]=n;break}}}),(()=>{for(let e=0;e<t.length;++e)t[e]=s[t[e]]||t[e];const i=this.subMeshes.slice(0);this.setIndices(t),this.subMeshes=i,e&&e(this)})),this}serialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.name=this.name,e.id=this.id,e.uniqueId=this.uniqueId,e.type=this.getClassName(),f.Y&&f.Y.HasTags(this)&&(e.tags=f.Y.GetTags(this)),e.position=this.position.asArray(),this.rotationQuaternion?e.rotationQuaternion=this.rotationQuaternion.asArray():this.rotation&&(e.rotation=this.rotation.asArray()),e.scaling=this.scaling.asArray(),this._postMultiplyPivotMatrix?e.pivotMatrix=this.getPivotMatrix().asArray():e.localMatrix=this.getPivotMatrix().asArray(),e.isEnabled=this.isEnabled(!1),e.isVisible=this.isVisible,e.infiniteDistance=this.infiniteDistance,e.pickable=this.isPickable,e.receiveShadows=this.receiveShadows,e.billboardMode=this.billboardMode,e.visibility=this.visibility,e.alwaysSelectAsActiveMesh=this.alwaysSelectAsActiveMesh,e.checkCollisions=this.checkCollisions,e.ellipsoid=this.ellipsoid.asArray(),e.ellipsoidOffset=this.ellipsoidOffset.asArray(),e.doNotSyncBoundingInfo=this.doNotSyncBoundingInfo,e.isBlocker=this.isBlocker,e.sideOrientation=this.sideOrientation,this.parent&&this.parent._serializeAsParent(e),e.isUnIndexed=this.isUnIndexed;const t=this._geometry;if(t&&this.subMeshes){e.geometryUniqueId=t.uniqueId,e.geometryId=t.id,e.subMeshes=[];for(let t=0;t<this.subMeshes.length;t++){const i=this.subMeshes[t];e.subMeshes.push({materialIndex:i.materialIndex,verticesStart:i.verticesStart,verticesCount:i.verticesCount,indexStart:i.indexStart,indexCount:i.indexCount})}}if(this.material?this.material.doNotSerialize||(e.materialUniqueId=this.material.uniqueId,e.materialId=this.material.id):(this.material=null,e.materialUniqueId=this._scene.defaultMaterial.uniqueId,e.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(e.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(e.skeletonId=this.skeleton.id,e.numBoneInfluencers=this.numBoneInfluencers),this.getScene()._getComponent(Ue.v.NAME_PHYSICSENGINE)){const t=this.getPhysicsImpostor();t&&(e.physicsMass=t.getParam("mass"),e.physicsFriction=t.getParam("friction"),e.physicsRestitution=t.getParam("mass"),e.physicsImpostor=t.type)}this.metadata&&(e.metadata=this.metadata),e.instances=[];for(let i=0;i<this.instances.length;i++){const t=this.instances[i];if(t.doNotSerialize)continue;const r={name:t.name,id:t.id,isEnabled:t.isEnabled(!1),isVisible:t.isVisible,isPickable:t.isPickable,checkCollisions:t.checkCollisions,position:t.position.asArray(),scaling:t.scaling.asArray()};if(t.parent&&t.parent._serializeAsParent(r),t.rotationQuaternion?r.rotationQuaternion=t.rotationQuaternion.asArray():t.rotation&&(r.rotation=t.rotation.asArray()),this.getScene()._getComponent(Ue.v.NAME_PHYSICSENGINE)){const e=t.getPhysicsImpostor();e&&(r.physicsMass=e.getParam("mass"),r.physicsFriction=e.getParam("friction"),r.physicsRestitution=e.getParam("mass"),r.physicsImpostor=e.type)}t.metadata&&(r.metadata=t.metadata),t.actionManager&&(r.actions=t.actionManager.serialize(t.name)),e.instances.push(r),c.p.AppendSerializedAnimations(t,r),r.ranges=t.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(e.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){const t={data:{},sizes:{},strides:{}};for(const e in this._userThinInstanceBuffersStorage.data)t.data[e]=Array.from(this._userThinInstanceBuffersStorage.data[e]),t.sizes[e]=this._userThinInstanceBuffersStorage.sizes[e],t.strides[e]=this._userThinInstanceBuffersStorage.strides[e];e.thinInstances.userThinInstance=t}return c.p.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e.layerMask=this.layerMask,e.alphaIndex=this.alphaIndex,e.hasVertexAlpha=this.hasVertexAlpha,e.overlayAlpha=this.overlayAlpha,e.overlayColor=this.overlayColor.asArray(),e.renderOverlay=this.renderOverlay,e.applyFog=this.applyFog,this.actionManager&&(e.actions=this.actionManager.serialize(this.name)),e}_syncGeometryWithMorphTargetManager(){if(!this.geometry)return;this._markSubMeshesAsAttributesDirty();const e=this._internalAbstractMeshDataInfo._morphTargetManager;if(e&&e.vertexCount){if(e.vertexCount!==this.getTotalVertices())return T.V.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(e.isUsingTextureForTargets)return;for(let t=0;t<e.numInfluencers;t++){const i=e.getActiveTarget(t),r=i.getPositions();if(!r)return void T.V.Error("Invalid morph target. Target must have positions.");this.geometry.setVerticesData(S.R.PositionKind+t,r,!1,3);const s=i.getNormals();s&&this.geometry.setVerticesData(S.R.NormalKind+t,s,!1,3);const n=i.getTangents();n&&this.geometry.setVerticesData(S.R.TangentKind+t,n,!1,3);const a=i.getUVs();a&&this.geometry.setVerticesData(S.R.UVKind+"_"+t,a,!1,2)}}else{let e=0;for(;this.geometry.isVerticesDataPresent(S.R.PositionKind+e);)this.geometry.removeVerticesData(S.R.PositionKind+e),this.geometry.isVerticesDataPresent(S.R.NormalKind+e)&&this.geometry.removeVerticesData(S.R.NormalKind+e),this.geometry.isVerticesDataPresent(S.R.TangentKind+e)&&this.geometry.removeVerticesData(S.R.TangentKind+e),this.geometry.isVerticesDataPresent(S.R.UVKind+e)&&this.geometry.removeVerticesData(S.R.UVKind+"_"+e),e++}}static Parse(e,t,i){let r;if(r=e.type&&"LinesMesh"===e.type?Xe._LinesMeshParser(e,t):e.type&&"GroundMesh"===e.type?Xe._GroundMeshParser(e,t):e.type&&"GoldbergMesh"===e.type?Xe._GoldbergMeshParser(e,t):e.type&&"GreasedLineMesh"===e.type?Xe._GreasedLineMeshParser(e,t):e.type&&"TrailMesh"===e.type?Xe._TrailMeshParser(e,t):new Xe(e.name,t),r.id=e.id,r._waitingParsedUniqueId=e.uniqueId,f.Y&&f.Y.AddTagsTo(r,e.tags),r.position=o.Pq.FromArray(e.position),void 0!==e.metadata&&(r.metadata=e.metadata),e.rotationQuaternion?r.rotationQuaternion=o.PT.FromArray(e.rotationQuaternion):e.rotation&&(r.rotation=o.Pq.FromArray(e.rotation)),r.scaling=o.Pq.FromArray(e.scaling),e.localMatrix?r.setPreTransformMatrix(o.uq.FromArray(e.localMatrix)):e.pivotMatrix&&r.setPivotMatrix(o.uq.FromArray(e.pivotMatrix)),r.setEnabled(e.isEnabled),r.isVisible=e.isVisible,r.infiniteDistance=e.infiniteDistance,r.alwaysSelectAsActiveMesh=!!e.alwaysSelectAsActiveMesh,r.showBoundingBox=e.showBoundingBox,r.showSubMeshesBoundingBox=e.showSubMeshesBoundingBox,void 0!==e.applyFog&&(r.applyFog=e.applyFog),void 0!==e.pickable&&(r.isPickable=e.pickable),void 0!==e.alphaIndex&&(r.alphaIndex=e.alphaIndex),r.receiveShadows=e.receiveShadows,void 0!==e.billboardMode&&(r.billboardMode=e.billboardMode),void 0!==e.visibility&&(r.visibility=e.visibility),r.checkCollisions=e.checkCollisions,r.doNotSyncBoundingInfo=!!e.doNotSyncBoundingInfo,e.ellipsoid&&(r.ellipsoid=o.Pq.FromArray(e.ellipsoid)),e.ellipsoidOffset&&(r.ellipsoidOffset=o.Pq.FromArray(e.ellipsoidOffset)),null!=e.overrideMaterialSideOrientation&&(r.sideOrientation=e.overrideMaterialSideOrientation),void 0!==e.sideOrientation&&(r.sideOrientation=e.sideOrientation),void 0!==e.isBlocker&&(r.isBlocker=e.isBlocker),r._shouldGenerateFlatShading=e.useFlatShading,e.freezeWorldMatrix&&(r._waitingData.freezeWorldMatrix=e.freezeWorldMatrix),void 0!==e.parentId&&(r._waitingParentId=e.parentId),void 0!==e.parentInstanceIndex&&(r._waitingParentInstanceIndex=e.parentInstanceIndex),void 0!==e.actions&&(r._waitingData.actions=e.actions),void 0!==e.overlayAlpha&&(r.overlayAlpha=e.overlayAlpha),void 0!==e.overlayColor&&(r.overlayColor=E.v9.FromArray(e.overlayColor)),void 0!==e.renderOverlay&&(r.renderOverlay=e.renderOverlay),r.isUnIndexed=!!e.isUnIndexed,r.hasVertexAlpha=e.hasVertexAlpha,e.delayLoadingFile?(r.delayLoadState=4,r.delayLoadingFile=i+e.delayLoadingFile,r.buildBoundingInfo(o.Pq.FromArray(e.boundingBoxMinimum),o.Pq.FromArray(e.boundingBoxMaximum)),e._binaryInfo&&(r._binaryInfo=e._binaryInfo),r._delayInfo=[],e.hasUVs&&r._delayInfo.push(S.R.UVKind),e.hasUVs2&&r._delayInfo.push(S.R.UV2Kind),e.hasUVs3&&r._delayInfo.push(S.R.UV3Kind),e.hasUVs4&&r._delayInfo.push(S.R.UV4Kind),e.hasUVs5&&r._delayInfo.push(S.R.UV5Kind),e.hasUVs6&&r._delayInfo.push(S.R.UV6Kind),e.hasColors&&r._delayInfo.push(S.R.ColorKind),e.hasMatricesIndices&&r._delayInfo.push(S.R.MatricesIndicesKind),e.hasMatricesWeights&&r._delayInfo.push(S.R.MatricesWeightsKind),r._delayLoadingFunction=K._ImportGeometry,q.ForceFullSceneLoadingForIncremental&&r._checkDelayState()):K._ImportGeometry(e,r),e.materialUniqueId?r._waitingMaterialId=e.materialUniqueId:e.materialId&&(r._waitingMaterialId=e.materialId),e.morphTargetManagerId>-1&&(r.morphTargetManager=t.getMorphTargetManagerById(e.morphTargetManagerId)),void 0!==e.skeletonId&&null!==e.skeletonId&&(r.skeleton=t.getLastSkeletonById(e.skeletonId),e.numBoneInfluencers&&(r.numBoneInfluencers=e.numBoneInfluencers)),e.animations){for(let t=0;t<e.animations.length;t++){const i=e.animations[t],s=(0,x.n9)("BABYLON.Animation");s&&r.animations.push(s.Parse(i))}d.ParseAnimationRanges(r,e,t)}if(e.autoAnimate&&t.beginAnimation(r,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),e.layerMask&&!isNaN(e.layerMask)?r.layerMask=Math.abs(parseInt(e.layerMask)):r.layerMask=268435455,e.physicsImpostor&&(r.physicsImpostor=Xe._PhysicsImpostorParser(t,r,e)),e.lodMeshIds&&(r._waitingData.lods={ids:e.lodMeshIds,distances:e.lodDistances?e.lodDistances:null,coverages:e.lodCoverages?e.lodCoverages:null}),e.instances)for(let s=0;s<e.instances.length;s++){const i=e.instances[s],n=r.createInstance(i.name);if(i.id&&(n.id=i.id),f.Y&&(i.tags?f.Y.AddTagsTo(n,i.tags):f.Y.AddTagsTo(n,e.tags)),n.position=o.Pq.FromArray(i.position),void 0!==i.metadata&&(n.metadata=i.metadata),void 0!==i.parentId&&(n._waitingParentId=i.parentId),void 0!==i.parentInstanceIndex&&(n._waitingParentInstanceIndex=i.parentInstanceIndex),void 0!==i.isEnabled&&null!==i.isEnabled&&n.setEnabled(i.isEnabled),void 0!==i.isVisible&&null!==i.isVisible&&(n.isVisible=i.isVisible),void 0!==i.isPickable&&null!==i.isPickable&&(n.isPickable=i.isPickable),i.rotationQuaternion?n.rotationQuaternion=o.PT.FromArray(i.rotationQuaternion):i.rotation&&(n.rotation=o.Pq.FromArray(i.rotation)),n.scaling=o.Pq.FromArray(i.scaling),void 0!=i.checkCollisions&&null!=i.checkCollisions&&(n.checkCollisions=i.checkCollisions),void 0!=i.pickable&&null!=i.pickable&&(n.isPickable=i.pickable),void 0!=i.showBoundingBox&&null!=i.showBoundingBox&&(n.showBoundingBox=i.showBoundingBox),void 0!=i.showSubMeshesBoundingBox&&null!=i.showSubMeshesBoundingBox&&(n.showSubMeshesBoundingBox=i.showSubMeshesBoundingBox),void 0!=i.alphaIndex&&null!=i.showSubMeshesBoundingBox&&(n.alphaIndex=i.alphaIndex),i.physicsImpostor&&(n.physicsImpostor=Xe._PhysicsImpostorParser(t,n,i)),void 0!==i.actions&&(n._waitingData.actions=i.actions),i.animations){for(let e=0;e<i.animations.length;e++){const t=i.animations[e],r=(0,x.n9)("BABYLON.Animation");r&&n.animations.push(r.Parse(t))}d.ParseAnimationRanges(n,i,t),i.autoAnimate&&t.beginAnimation(n,i.autoAnimateFrom,i.autoAnimateTo,i.autoAnimateLoop,i.autoAnimateSpeed||1)}}if(e.thinInstances){const t=e.thinInstances;if(r.thinInstanceEnablePicking=!!t.enablePicking,t.matrixData?(r.thinInstanceSetBuffer("matrix",new Float32Array(t.matrixData),16,!1),r._thinInstanceDataStorage.matrixBufferSize=t.matrixBufferSize,r._thinInstanceDataStorage.instancesCount=t.instancesCount):r._thinInstanceDataStorage.matrixBufferSize=t.matrixBufferSize,e.thinInstances.userThinInstance){const t=e.thinInstances.userThinInstance;for(const e in t.data)r.thinInstanceSetBuffer(e,new Float32Array(t.data[e]),t.strides[e],!1),r._userThinInstanceBuffersStorage.sizes[e]=t.sizes[e]}}return r}setPositionsForCPUSkinning(){const e=this._internalMeshDataInfo;if(!e._sourcePositions){const t=this.getVerticesData(S.R.PositionKind);if(!t)return e._sourcePositions;e._sourcePositions=new Float32Array(t),this.isVertexBufferUpdatable(S.R.PositionKind)||this.setVerticesData(S.R.PositionKind,t,!0)}return e._sourcePositions}setNormalsForCPUSkinning(){const e=this._internalMeshDataInfo;if(!e._sourceNormals){const t=this.getVerticesData(S.R.NormalKind);if(!t)return e._sourceNormals;e._sourceNormals=new Float32Array(t),this.isVertexBufferUpdatable(S.R.NormalKind)||this.setVerticesData(S.R.NormalKind,t,!0)}return e._sourceNormals}applySkeleton(e){if(!this.geometry)return this;if(this.geometry._softwareSkinningFrameId==this.getScene().getFrameId())return this;if(this.geometry._softwareSkinningFrameId=this.getScene().getFrameId(),!this.isVerticesDataPresent(S.R.PositionKind))return this;if(!this.isVerticesDataPresent(S.R.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(S.R.MatricesWeightsKind))return this;const t=this.isVerticesDataPresent(S.R.NormalKind),i=this._internalMeshDataInfo;if(!i._sourcePositions){const e=this.subMeshes.slice();this.setPositionsForCPUSkinning(),this.subMeshes=e}t&&!i._sourceNormals&&this.setNormalsForCPUSkinning();let r=this.getVerticesData(S.R.PositionKind);if(!r)return this;r instanceof Float32Array||(r=new Float32Array(r));let s=this.getVerticesData(S.R.NormalKind);if(t){if(!s)return this;s instanceof Float32Array||(s=new Float32Array(s))}const n=this.getVerticesData(S.R.MatricesIndicesKind),a=this.getVerticesData(S.R.MatricesWeightsKind);if(!a||!n)return this;const l=this.numBoneInfluencers>4,h=l?this.getVerticesData(S.R.MatricesIndicesExtraKind):null,c=l?this.getVerticesData(S.R.MatricesWeightsExtraKind):null,u=e.getTransformMatrices(this),d=o.Pq.Zero(),_=new o.uq,p=new o.uq;let f,g=0;for(let m=0;m<r.length;m+=3,g+=4){let e;for(f=0;f<4;f++)e=a[g+f],e>0&&(o.uq.FromFloat32ArrayToRefScaled(u,Math.floor(16*n[g+f]),e,p),_.addToSelf(p));if(l)for(f=0;f<4;f++)e=c[g+f],e>0&&(o.uq.FromFloat32ArrayToRefScaled(u,Math.floor(16*h[g+f]),e,p),_.addToSelf(p));o.Pq.TransformCoordinatesFromFloatsToRef(i._sourcePositions[m],i._sourcePositions[m+1],i._sourcePositions[m+2],_,d),d.toArray(r,m),t&&(o.Pq.TransformNormalFromFloatsToRef(i._sourceNormals[m],i._sourceNormals[m+1],i._sourceNormals[m+2],_,d),d.toArray(s,m)),_.reset()}return this.updateVerticesData(S.R.PositionKind,r),t&&this.updateVerticesData(S.R.NormalKind,s),this}static MinMax(e){let t=null,i=null;return e.forEach((function(e){const r=e.getBoundingInfo().boundingBox;t&&i?(t.minimizeInPlace(r.minimumWorld),i.maximizeInPlace(r.maximumWorld)):(t=r.minimumWorld,i=r.maximumWorld)})),t&&i?{min:t,max:i}:{min:o.Pq.Zero(),max:o.Pq.Zero()}}static Center(e){const t=e instanceof Array?Xe.MinMax(e):e;return o.Pq.Center(t.min,t.max)}static MergeMeshes(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,n=arguments.length>5?arguments[5]:void 0;return b(Xe._MergeMeshesCoroutine(e,t,i,r,s,n,!1))}static MergeMeshesAsync(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,n=arguments.length>5?arguments[5]:void 0;return v(Xe._MergeMeshesCoroutine(e,t,i,r,s,n,!0),function(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25;return(i,r,s)=>{const n=performance.now();void 0===e||n-e>t?(e=n,setTimeout((()=>{g(i,r,s)}),0)):g(i,r,s)}}())}static _MergeMeshesCoroutine(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,n=arguments.length>5?arguments[5]:void 0,a=arguments.length>6?arguments[6]:void 0;return function*(){if(0===(e=e.filter(Boolean)).length)return null;let o;if(!i){let t=0;for(o=0;o<e.length;o++)if(t+=e[o].getTotalVertices(),t>=65536)return T.V.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}n&&(s=!1);const l=new Array,h=new Array,c=new Array,u=e[0].sideOrientation;for(o=0;o<e.length;o++){const t=e[o];if(t.isAnInstance)return T.V.Warn("Cannot merge instance meshes."),null;if(u!==t.sideOrientation)return T.V.Warn("Cannot merge meshes with different sideOrientation values."),null;if(s&&c.push(t.getTotalIndices()),n)if(t.material){const e=t.material;if(e instanceof ke){for(let t=0;t<e.subMaterials.length;t++)l.indexOf(e.subMaterials[t])<0&&l.push(e.subMaterials[t]);for(let i=0;i<t.subMeshes.length;i++)h.push(l.indexOf(e.subMaterials[t.subMeshes[i].materialIndex])),c.push(t.subMeshes[i].indexCount)}else{l.indexOf(e)<0&&l.push(e);for(let i=0;i<t.subMeshes.length;i++)h.push(l.indexOf(e)),c.push(t.subMeshes[i].indexCount)}}else for(let e=0;e<t.subMeshes.length;e++)h.push(0),c.push(t.subMeshes[e].indexCount)}const d=e[0],_=e=>{const t=e.computeWorldMatrix(!0);return{vertexData:W.ExtractFromMesh(e,!1,!1),transform:t}},{vertexData:p,transform:f}=_(d);a&&(yield);const g=new Array(e.length-1);for(let t=1;t<e.length;t++)g[t-1]=_(e[t]),a&&(yield);const m=p._mergeCoroutine(f,g,i,a,!t);let b=m.next();for(;!b.done;)a&&(yield),b=m.next();const v=b.value;r||(r=new Xe(d.name+"_merged",d.getScene()));const y=v._applyToCoroutine(r,void 0,a);let x=y.next();for(;!x.done;)a&&(yield),x=y.next();if(r.checkCollisions=d.checkCollisions,r.sideOrientation=d.sideOrientation,t)for(o=0;o<e.length;o++)e[o].dispose();if(s||n){r.releaseSubMeshes(),o=0;let e=0;for(;o<c.length;)G.CreateFromIndices(0,e,c[o],r,void 0,!1),e+=c[o],o++;for(const t of r.subMeshes)t.refreshBoundingInfo();r.computeWorldMatrix(!0)}if(n){const e=new ke(d.name+"_merged",d.getScene());e.subMaterials=l;for(let t=0;t<r.subMeshes.length;t++)r.subMeshes[t].materialIndex=h[t];r.material=e}else r.material=d.material;return r}()}addInstance(e){e._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(e)}removeInstance(e){const t=e._indexInSourceMeshInstanceArray;if(-1!=t){if(t!==this.instances.length-1){const e=this.instances[this.instances.length-1];this.instances[t]=e,e._indexInSourceMeshInstanceArray=t}e._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}_shouldConvertRHS(){return this._scene.useRightHandedSystem&&this.sideOrientation===Ne.CounterClockWiseSideOrientation}_getRenderingFillMode(e){const t=this.getScene();return t.forcePointsCloud?Ne.PointFillMode:t.forceWireframe?Ne.WireFrameFillMode:this.overrideRenderingFillMode??e}setMaterialByID(e){return this.setMaterialById(e)}static CreateRibbon(e,t,i,r,s,n,a,o,l){throw new Error("Import MeshBuilder to populate this function")}static CreateDisc(e,t,i,r,s,n){throw new Error("Import MeshBuilder to populate this function")}static CreateBox(e,t,i,r,s){throw new Error("Import MeshBuilder to populate this function")}static CreateSphere(e,t,i,r,s,n){throw new Error("Import MeshBuilder to populate this function")}static CreateHemisphere(e,t,i,r){throw new Error("Import MeshBuilder to populate this function")}static CreateCylinder(e,t,i,r,s,n,a,o,l){throw new Error("Import MeshBuilder to populate this function")}static CreateTorus(e,t,i,r,s,n,a){throw new Error("Import MeshBuilder to populate this function")}static CreateTorusKnot(e,t,i,r,s,n,a,o,l,h){throw new Error("Import MeshBuilder to populate this function")}static CreateLines(e,t,i,r,s){throw new Error("Import MeshBuilder to populate this function")}static CreateDashedLines(e,t,i,r,s,n,a,o){throw new Error("Import MeshBuilder to populate this function")}static CreatePolygon(e,t,i,r,s,n,a){throw new Error("Import MeshBuilder to populate this function")}static ExtrudePolygon(e,t,i,r,s,n,a,o){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShape(e,t,i,r,s,n,a,o,l,h){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShapeCustom(e,t,i,r,s,n,a,o,l,h,c,u){throw new Error("Import MeshBuilder to populate this function")}static CreateLathe(e,t,i,r,s,n,a){throw new Error("Import MeshBuilder to populate this function")}static CreatePlane(e,t,i,r,s){throw new Error("Import MeshBuilder to populate this function")}static CreateGround(e,t,i,r,s,n){throw new Error("Import MeshBuilder to populate this function")}static CreateTiledGround(e,t,i,r,s,n,a,o,l){throw new Error("Import MeshBuilder to populate this function")}static CreateGroundFromHeightMap(e,t,i,r,s,n,a,o,l,h,c){throw new Error("Import MeshBuilder to populate this function")}static CreateTube(e,t,i,r,s,n,a,o,l,h){throw new Error("Import MeshBuilder to populate this function")}static CreatePolyhedron(e,t,i){throw new Error("Import MeshBuilder to populate this function")}static CreateIcoSphere(e,t,i){throw new Error("Import MeshBuilder to populate this function")}static CreateDecal(e,t,i,r,s,n){throw new Error("Import MeshBuilder to populate this function")}static CreateCapsule(e,t,i){throw new Error("Import MeshBuilder to populate this function")}static ExtendToGoldberg(e){throw new Error("Import MeshBuilder to populate this function")}}Xe.FRONTSIDE=W.FRONTSIDE,Xe.BACKSIDE=W.BACKSIDE,Xe.DOUBLESIDE=W.DOUBLESIDE,Xe.DEFAULTSIDE=W.DEFAULTSIDE,Xe.NO_CAP=0,Xe.CAP_START=1,Xe.CAP_END=2,Xe.CAP_ALL=3,Xe.NO_FLIP=0,Xe.FLIP_TILE=1,Xe.ROTATE_TILE=2,Xe.FLIP_ROW=3,Xe.ROTATE_ROW=4,Xe.FLIP_N_ROTATE_TILE=5,Xe.FLIP_N_ROTATE_ROW=6,Xe.CENTER=0,Xe.LEFT=1,Xe.RIGHT=2,Xe.TOP=3,Xe.BOTTOM=4,Xe.INSTANCEDMESH_SORT_TRANSPARENT=!1,Xe._GroundMeshParser=(e,t)=>{throw(0,h.n)("GroundMesh")},Xe._GoldbergMeshParser=(e,t)=>{throw(0,h.n)("GoldbergMesh")},Xe._LinesMeshParser=(e,t)=>{throw(0,h.n)("LinesMesh")},Xe._GreasedLineMeshParser=(e,t)=>{throw(0,h.n)("GreasedLineMesh")},Xe._GreasedLineRibbonMeshParser=(e,t)=>{throw(0,h.n)("GreasedLineRibbonMesh")},Xe._TrailMeshParser=(e,t)=>{throw(0,h.n)("TrailMesh")},(0,x.Y5)("BABYLON.Mesh",Xe);var Ke=i(3781),Ye=i(2132);class je{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(e){this._zoomStopsAnimation=e}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(e){this._idleRotationSpeed=e}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(e){this._idleRotationWaitTime=e}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(e){this._idleRotationSpinupTime=e}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(e){this._attachedCamera=e;const t=this._attachedCamera.getScene();this._onPrePointerObservableObserver=t.onPrePointerObservable.add((e=>{e.type!==Ke.Zp.POINTERDOWN?e.type===Ke.Zp.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=e.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const e=Ye.j.Now;let t=0;null!=this._lastFrameTime&&(t=e-this._lastFrameTime),this._lastFrameTime=e,this._applyUserInteraction();const i=e-this._lastInteractionTime-this._idleRotationWaitTime,r=Math.max(Math.min(i/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*r,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(t/1e3))}))}detach(){if(!this._attachedCamera)return;const e=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&e.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null}resetLastInteractionTime(e){this._lastInteractionTime=e??Ye.j.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<O.bH}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let e=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(e=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?e:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=Ye.j.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var Qe=i(200);class $e{constructor(){this._easingMode=$e.EASINGMODE_EASEIN}setEasingMode(e){const t=Math.min(Math.max(e,0),2);this._easingMode=t}getEasingMode(){return this._easingMode}easeInCore(e){throw new Error("You must implement this method")}ease(e){switch(this._easingMode){case $e.EASINGMODE_EASEIN:return this.easeInCore(e);case $e.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-e)}return e>=.5?.5*(1-this.easeInCore(2*(1-e)))+.5:.5*this.easeInCore(2*e)}}$e.EASINGMODE_EASEIN=0,$e.EASINGMODE_EASEOUT=1,$e.EASINGMODE_EASEINOUT=2;class Ze extends $e{easeInCore(e){return e=Math.max(0,Math.min(1,e)),1-Math.sqrt(1-e*e)}}class Je extends $e{easeInCore(e){return e*e}}class et extends $e{easeInCore(e){return 1-Math.sin(1.5707963267948966*(1-e))}}var tt=i(7559);class it{constructor(e,t,i){this.name=e,this.from=t,this.to=i}clone(){return new it(this.name,this.from,this.to)}}var rt=i(3518),st=i(4861);const nt=Object.freeze(new o.PT(0,0,0,0)),at=Object.freeze(o.Pq.Zero()),ot=Object.freeze(o.I9.Zero()),lt=Object.freeze(rt.o.Zero()),ht=Object.freeze(E.v9.Black()),ct=Object.freeze(new E.ov(0,0,0,0)),ut={key:0,repeatCount:0,loopMode:2};class dt{static _PrepareAnimation(e,t,i,r,s,n,a,l){let h;if(!isNaN(parseFloat(s))&&isFinite(s)?h=dt.ANIMATIONTYPE_FLOAT:s instanceof o.PT?h=dt.ANIMATIONTYPE_QUATERNION:s instanceof o.Pq?h=dt.ANIMATIONTYPE_VECTOR3:s instanceof o.I9?h=dt.ANIMATIONTYPE_VECTOR2:s instanceof E.v9?h=dt.ANIMATIONTYPE_COLOR3:s instanceof E.ov?h=dt.ANIMATIONTYPE_COLOR4:s instanceof rt.o&&(h=dt.ANIMATIONTYPE_SIZE),void 0==h)return null;const c=new dt(e,t,i,h,a),u=[{frame:0,value:s},{frame:r,value:n}];return c.setKeys(u),void 0!==l&&c.setEasingFunction(l),c}static CreateAnimation(e,t,i,r){const s=new dt(e+"Animation",e,i,t,dt.ANIMATIONLOOPMODE_CONSTANT);return s.setEasingFunction(r),s}static CreateAndStartAnimation(e,t,i,r,s,n,a,o,l,h,c){const u=dt._PrepareAnimation(e,i,r,s,n,a,o,l);return u?(t.getScene&&(c=t.getScene()),c?c.beginDirectAnimation(t,[u],0,s,1===u.loopMode,1,h):null):null}static CreateAndStartHierarchyAnimation(e,t,i,r,s,n,a,o,l,h,c){const u=dt._PrepareAnimation(e,r,s,n,a,o,l,h);if(!u)return null;return t.getScene().beginDirectHierarchyAnimation(t,i,[u],0,n,1===u.loopMode,1,c)}static CreateMergeAndStartAnimation(e,t,i,r,s,n,a,o,l,h){const c=dt._PrepareAnimation(e,i,r,s,n,a,o,l);return c?(t.animations.push(c),t.getScene().beginAnimation(t,0,s,1===c.loopMode,1,h)):null}static MakeAnimationAdditive(e,t,i){let r;r="object"===typeof t?t:{referenceFrame:t??0,range:i,cloneOriginalAnimation:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let s=e;if(r.cloneOriginalAnimation&&(s=e.clone(),s.name=r.clonedAnimationName||s.name),!s._keys.length)return s;const n=r.referenceFrame&&r.referenceFrame>=0?r.referenceFrame:0;let a=0;const l=s._keys[0];let h=s._keys.length-1;const c=s._keys[h],u={referenceValue:l.value,referencePosition:o.AA.Vector3[0],referenceQuaternion:o.AA.Quaternion[0],referenceScaling:o.AA.Vector3[1],keyPosition:o.AA.Vector3[2],keyQuaternion:o.AA.Quaternion[1],keyScaling:o.AA.Vector3[3]};let d=l.frame,_=c.frame;if(r.range){const e=s.getRange(r.range);e&&(d=e.from,_=e.to)}else d=r.fromFrame??d,_=r.toFrame??_;if(d!==l.frame&&(a=s.createKeyForFrame(d)),_!==c.frame&&(h=s.createKeyForFrame(_)),1===s._keys.length){const e=s._getKeyValue(s._keys[0]);u.referenceValue=e.clone?e.clone():e}else if(n<=l.frame){const e=s._getKeyValue(l.value);u.referenceValue=e.clone?e.clone():e}else if(n>=c.frame){const e=s._getKeyValue(c.value);u.referenceValue=e.clone?e.clone():e}else{ut.key=0;const e=s._interpolate(n,ut);u.referenceValue=e.clone?e.clone():e}s.dataType===dt.ANIMATIONTYPE_QUATERNION?u.referenceValue.normalize().conjugateInPlace():s.dataType===dt.ANIMATIONTYPE_MATRIX&&(u.referenceValue.decompose(u.referenceScaling,u.referenceQuaternion,u.referencePosition),u.referenceQuaternion.normalize().conjugateInPlace());let p=Number.MAX_VALUE;const f=r.clipKeys?[]:null;for(let g=a;g<=h;g++){let e=s._keys[g];if((f||r.cloneOriginalAnimation)&&(e={frame:e.frame,value:e.value.clone?e.value.clone():e.value,inTangent:e.inTangent,outTangent:e.outTangent,interpolation:e.interpolation,lockedTangent:e.lockedTangent},f&&(p===Number.MAX_VALUE&&(p=e.frame),e.frame-=p,f.push(e))),!g||s.dataType===dt.ANIMATIONTYPE_FLOAT||e.value!==l.value)switch(s.dataType){case dt.ANIMATIONTYPE_MATRIX:e.value.decompose(u.keyScaling,u.keyQuaternion,u.keyPosition),u.keyPosition.subtractInPlace(u.referencePosition),u.keyScaling.divideInPlace(u.referenceScaling),u.referenceQuaternion.multiplyToRef(u.keyQuaternion,u.keyQuaternion),o.uq.ComposeToRef(u.keyScaling,u.keyQuaternion,u.keyPosition,e.value);break;case dt.ANIMATIONTYPE_QUATERNION:u.referenceValue.multiplyToRef(e.value,e.value);break;case dt.ANIMATIONTYPE_VECTOR2:case dt.ANIMATIONTYPE_VECTOR3:case dt.ANIMATIONTYPE_COLOR3:case dt.ANIMATIONTYPE_COLOR4:e.value.subtractToRef(u.referenceValue,e.value);break;case dt.ANIMATIONTYPE_SIZE:e.value.width-=u.referenceValue.width,e.value.height-=u.referenceValue.height;break;default:e.value-=u.referenceValue}}return f&&s.setKeys(f,!0),s}static TransitionTo(e,t,i,r,s,n,a){let o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(a<=0)return i[e]=t,o&&o(),null;const l=s*(a/1e3);n.setKeys([{frame:0,value:i[e].clone?i[e].clone():i[e]},{frame:l,value:t}]),i.animations||(i.animations=[]),i.animations.push(n);const h=r.beginAnimation(i,0,l,!1);return h.onAnimationEnd=o,h}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const e of this._runtimeAnimations)if(!e.isStopped())return!0;return!1}constructor(e,t,i,r,s,n){this.name=e,this.targetProperty=t,this.framePerSecond=i,this.dataType=r,this.loopMode=s,this.enableBlending=n,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=t.split("."),this.dataType=r,this.loopMode=void 0===s?dt.ANIMATIONLOOPMODE_CYCLE:s,this.uniqueId=dt._UniqueIdGenerator++}toString(e){let t="Name: "+this.name+", property: "+this.targetProperty;if(t+=", datatype: "+["Float","Vector3","Quaternion","Matrix","Color3","Vector2"][this.dataType],t+=", nKeys: "+(this._keys?this._keys.length:"none"),t+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),e){t+=", Ranges: {";let e=!0;for(const i in this._ranges)e&&(t+=", ",e=!1),t+=i;t+="}"}return t}addEvent(e){this._events.push(e),this._events.sort(((e,t)=>e.frame-t.frame))}removeEvents(e){for(let t=0;t<this._events.length;t++)this._events[t].frame===e&&(this._events.splice(t,1),t--)}getEvents(){return this._events}createRange(e,t,i){this._ranges[e]||(this._ranges[e]=new it(e,t,i))}deleteRange(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=this._ranges[e];if(i){if(t){const e=i.from,t=i.to;for(let i=this._keys.length-1;i>=0;i--)this._keys[i].frame>=e&&this._keys[i].frame<=t&&this._keys.splice(i,1)}this._ranges[e]=null}}getRange(e){return this._ranges[e]}getKeys(){return this._keys}getHighestFrame(){let e=0;for(let t=0,i=this._keys.length;t<i;t++)e<this._keys[t].frame&&(e=this._keys[t].frame);return e}getEasingFunction(){return this._easingFunction}setEasingFunction(e){this._easingFunction=e}floatInterpolateFunction(e,t,i){return tt.X.Lerp(e,t,i)}floatInterpolateFunctionWithTangents(e,t,i,r,s){return tt.X.Hermite(e,t,i,r,s)}quaternionInterpolateFunction(e,t,i){return o.PT.Slerp(e,t,i)}quaternionInterpolateFunctionWithTangents(e,t,i,r,s){return o.PT.Hermite(e,t,i,r,s).normalize()}vector3InterpolateFunction(e,t,i){return o.Pq.Lerp(e,t,i)}vector3InterpolateFunctionWithTangents(e,t,i,r,s){return o.Pq.Hermite(e,t,i,r,s)}vector2InterpolateFunction(e,t,i){return o.I9.Lerp(e,t,i)}vector2InterpolateFunctionWithTangents(e,t,i,r,s){return o.I9.Hermite(e,t,i,r,s)}sizeInterpolateFunction(e,t,i){return rt.o.Lerp(e,t,i)}color3InterpolateFunction(e,t,i){return E.v9.Lerp(e,t,i)}color3InterpolateFunctionWithTangents(e,t,i,r,s){return E.v9.Hermite(e,t,i,r,s)}color4InterpolateFunction(e,t,i){return E.ov.Lerp(e,t,i)}color4InterpolateFunctionWithTangents(e,t,i,r,s){return E.ov.Hermite(e,t,i,r,s)}_getKeyValue(e){return"function"===typeof e?e():e}evaluate(e){return ut.key=0,this._interpolate(e,ut)}_interpolate(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t.loopMode===dt.ANIMATIONLOOPMODE_CONSTANT&&t.repeatCount>0)return t.highLimitValue.clone?t.highLimitValue.clone():t.highLimitValue;const r=this._keys,s=r.length;let n=t.key;for(;n>=0&&e<r[n].frame;)--n;for(;n+1<=s-1&&e>=r[n+1].frame;)++n;if(t.key=n,n<0)return i?void 0:this._getKeyValue(r[0].value);if(n+1>s-1)return i?void 0:this._getKeyValue(r[s-1].value);const a=r[n],o=r[n+1];if(i&&(e===a.frame||e===o.frame))return;const l=this._getKeyValue(a.value),h=this._getKeyValue(o.value);if(1===a.interpolation)return o.frame>e?l:h;const c=void 0!==a.outTangent&&void 0!==o.inTangent,u=o.frame-a.frame;let d=(e-a.frame)/u;const _=a.easingFunction||this.getEasingFunction();switch(null!==_&&(d=_.ease(d)),this.dataType){case dt.ANIMATIONTYPE_FLOAT:{const e=c?this.floatInterpolateFunctionWithTangents(l,a.outTangent*u,h,o.inTangent*u,d):this.floatInterpolateFunction(l,h,d);switch(t.loopMode){case dt.ANIMATIONLOOPMODE_CYCLE:case dt.ANIMATIONLOOPMODE_CONSTANT:case dt.ANIMATIONLOOPMODE_YOYO:return e;case dt.ANIMATIONLOOPMODE_RELATIVE:case dt.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(t.offsetValue??0)*t.repeatCount+e}break}case dt.ANIMATIONTYPE_QUATERNION:{const e=c?this.quaternionInterpolateFunctionWithTangents(l,a.outTangent.scale(u),h,o.inTangent.scale(u),d):this.quaternionInterpolateFunction(l,h,d);switch(t.loopMode){case dt.ANIMATIONLOOPMODE_CYCLE:case dt.ANIMATIONLOOPMODE_CONSTANT:case dt.ANIMATIONLOOPMODE_YOYO:return e;case dt.ANIMATIONLOOPMODE_RELATIVE:case dt.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return e.addInPlace((t.offsetValue||nt).scale(t.repeatCount))}return e}case dt.ANIMATIONTYPE_VECTOR3:{const e=c?this.vector3InterpolateFunctionWithTangents(l,a.outTangent.scale(u),h,o.inTangent.scale(u),d):this.vector3InterpolateFunction(l,h,d);switch(t.loopMode){case dt.ANIMATIONLOOPMODE_CYCLE:case dt.ANIMATIONLOOPMODE_CONSTANT:case dt.ANIMATIONLOOPMODE_YOYO:return e;case dt.ANIMATIONLOOPMODE_RELATIVE:case dt.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return e.add((t.offsetValue||at).scale(t.repeatCount))}break}case dt.ANIMATIONTYPE_VECTOR2:{const e=c?this.vector2InterpolateFunctionWithTangents(l,a.outTangent.scale(u),h,o.inTangent.scale(u),d):this.vector2InterpolateFunction(l,h,d);switch(t.loopMode){case dt.ANIMATIONLOOPMODE_CYCLE:case dt.ANIMATIONLOOPMODE_CONSTANT:case dt.ANIMATIONLOOPMODE_YOYO:return e;case dt.ANIMATIONLOOPMODE_RELATIVE:case dt.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return e.add((t.offsetValue||ot).scale(t.repeatCount))}break}case dt.ANIMATIONTYPE_SIZE:switch(t.loopMode){case dt.ANIMATIONLOOPMODE_CYCLE:case dt.ANIMATIONLOOPMODE_CONSTANT:case dt.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(l,h,d);case dt.ANIMATIONLOOPMODE_RELATIVE:case dt.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(l,h,d).add((t.offsetValue||lt).scale(t.repeatCount))}break;case dt.ANIMATIONTYPE_COLOR3:{const e=c?this.color3InterpolateFunctionWithTangents(l,a.outTangent.scale(u),h,o.inTangent.scale(u),d):this.color3InterpolateFunction(l,h,d);switch(t.loopMode){case dt.ANIMATIONLOOPMODE_CYCLE:case dt.ANIMATIONLOOPMODE_CONSTANT:case dt.ANIMATIONLOOPMODE_YOYO:return e;case dt.ANIMATIONLOOPMODE_RELATIVE:case dt.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return e.add((t.offsetValue||ht).scale(t.repeatCount))}break}case dt.ANIMATIONTYPE_COLOR4:{const e=c?this.color4InterpolateFunctionWithTangents(l,a.outTangent.scale(u),h,o.inTangent.scale(u),d):this.color4InterpolateFunction(l,h,d);switch(t.loopMode){case dt.ANIMATIONLOOPMODE_CYCLE:case dt.ANIMATIONLOOPMODE_CONSTANT:case dt.ANIMATIONLOOPMODE_YOYO:return e;case dt.ANIMATIONLOOPMODE_RELATIVE:case dt.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return e.add((t.offsetValue||ct).scale(t.repeatCount))}break}case dt.ANIMATIONTYPE_MATRIX:switch(t.loopMode){case dt.ANIMATIONLOOPMODE_CYCLE:case dt.ANIMATIONLOOPMODE_CONSTANT:case dt.ANIMATIONLOOPMODE_YOYO:return dt.AllowMatricesInterpolation?this.matrixInterpolateFunction(l,h,d,t.workValue):l;case dt.ANIMATIONLOOPMODE_RELATIVE:case dt.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return l}}return 0}matrixInterpolateFunction(e,t,i,r){return dt.AllowMatrixDecomposeForInterpolation?r?(o.uq.DecomposeLerpToRef(e,t,i,r),r):o.uq.DecomposeLerp(e,t,i):r?(o.uq.LerpToRef(e,t,i,r),r):o.uq.Lerp(e,t,i)}clone(){const e=new dt(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(e.enableBlending=this.enableBlending,e.blendingSpeed=this.blendingSpeed,this._keys&&e.setKeys(this._keys),this._ranges){e._ranges={};for(const t in this._ranges){const i=this._ranges[t];i&&(e._ranges[t]=i.clone())}}return e}setKeys(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._keys=t?e:e.slice(0)}createKeyForFrame(e){ut.key=0;const t=this._interpolate(e,ut,!0);if(!t)return this._keys[ut.key].frame===e?ut.key:ut.key+1;const i={frame:e,value:t.clone?t.clone():t};return this._keys.splice(ut.key+1,0,i),ut.key+1}serialize(){const e={};e.name=this.name,e.property=this.targetProperty,e.framePerSecond=this.framePerSecond,e.dataType=this.dataType,e.loopBehavior=this.loopMode,e.enableBlending=this.enableBlending,e.blendingSpeed=this.blendingSpeed;const t=this.dataType;e.keys=[];const i=this.getKeys();for(let r=0;r<i.length;r++){const s=i[r],n={};switch(n.frame=s.frame,t){case dt.ANIMATIONTYPE_FLOAT:n.values=[s.value],void 0!==s.inTangent&&n.values.push(s.inTangent),void 0!==s.outTangent&&(void 0===s.inTangent&&n.values.push(void 0),n.values.push(s.outTangent)),void 0!==s.interpolation&&(void 0===s.inTangent&&n.values.push(void 0),void 0===s.outTangent&&n.values.push(void 0),n.values.push(s.interpolation));break;case dt.ANIMATIONTYPE_QUATERNION:case dt.ANIMATIONTYPE_MATRIX:case dt.ANIMATIONTYPE_VECTOR3:case dt.ANIMATIONTYPE_COLOR3:case dt.ANIMATIONTYPE_COLOR4:n.values=s.value.asArray(),void 0!=s.inTangent&&n.values.push(s.inTangent.asArray()),void 0!=s.outTangent&&(void 0===s.inTangent&&n.values.push(void 0),n.values.push(s.outTangent.asArray())),void 0!==s.interpolation&&(void 0===s.inTangent&&n.values.push(void 0),void 0===s.outTangent&&n.values.push(void 0),n.values.push(s.interpolation))}e.keys.push(n)}e.ranges=[];for(const r in this._ranges){const t=this._ranges[r];if(!t)continue;const i={};i.name=r,i.from=t.from,i.to=t.to,e.ranges.push(i)}return e}static _UniversalLerp(e,t,i){const r=e.constructor;return r.Lerp?r.Lerp(e,t,i):r.Slerp?r.Slerp(e,t,i):e.toFixed?e*(1-i)+i*t:t}static Parse(e){const t=new dt(e.name,e.property,e.framePerSecond,e.dataType,e.loopBehavior),i=e.dataType,r=[];let s,n;for(e.enableBlending&&(t.enableBlending=e.enableBlending),e.blendingSpeed&&(t.blendingSpeed=e.blendingSpeed),n=0;n<e.keys.length;n++){const t=e.keys[n];let a,l,h;switch(i){case dt.ANIMATIONTYPE_FLOAT:s=t.values[0],t.values.length>=2&&(a=t.values[1]),t.values.length>=3&&(l=t.values[2]),t.values.length>=4&&(h=t.values[3]);break;case dt.ANIMATIONTYPE_QUATERNION:if(s=o.PT.FromArray(t.values),t.values.length>=8){const e=o.PT.FromArray(t.values.slice(4,8));e.equals(o.PT.Zero())||(a=e)}if(t.values.length>=12){const e=o.PT.FromArray(t.values.slice(8,12));e.equals(o.PT.Zero())||(l=e)}t.values.length>=13&&(h=t.values[12]);break;case dt.ANIMATIONTYPE_MATRIX:s=o.uq.FromArray(t.values),t.values.length>=17&&(h=t.values[16]);break;case dt.ANIMATIONTYPE_COLOR3:s=E.v9.FromArray(t.values),t.values[3]&&(a=E.v9.FromArray(t.values[3])),t.values[4]&&(l=E.v9.FromArray(t.values[4])),t.values[5]&&(h=t.values[5]);break;case dt.ANIMATIONTYPE_COLOR4:s=E.ov.FromArray(t.values),t.values[4]&&(a=E.ov.FromArray(t.values[4])),t.values[5]&&(l=E.ov.FromArray(t.values[5])),t.values[6]&&(h=E.ov.FromArray(t.values[6]));break;case dt.ANIMATIONTYPE_VECTOR3:default:s=o.Pq.FromArray(t.values),t.values[3]&&(a=o.Pq.FromArray(t.values[3])),t.values[4]&&(l=o.Pq.FromArray(t.values[4])),t.values[5]&&(h=t.values[5])}const c={};c.frame=t.frame,c.value=s,void 0!=a&&(c.inTangent=a),void 0!=l&&(c.outTangent=l),void 0!=h&&(c.interpolation=h),r.push(c)}if(t.setKeys(r),e.ranges)for(n=0;n<e.ranges.length;n++)s=e.ranges[n],t.createRange(s.name,s.from,s.to);return t}static AppendSerializedAnimations(e,t){c.p.AppendSerializedAnimations(e,t)}static ParseFromFileAsync(e,t){return new Promise(((i,r)=>{const s=new st.u;s.addEventListener("readystatechange",(()=>{if(4==s.readyState)if(200==s.status){let t=JSON.parse(s.responseText);if(t.animations&&(t=t.animations),t.length){const e=[];for(const i of t)e.push(this.Parse(i));i(e)}else{const r=this.Parse(t);e&&(r.name=e),i(r)}}else r("Unable to load the animation")})),s.open("GET",t),s.send()}))}static ParseFromSnippetAsync(e){return new Promise(((t,i)=>{const r=new st.u;r.addEventListener("readystatechange",(()=>{if(4==r.readyState)if(200==r.status){const i=JSON.parse(JSON.parse(r.responseText).jsonPayload);if(i.animations){const r=JSON.parse(i.animations),s=[];for(const t of r.animations){const i=this.Parse(t);i.snippetId=e,s.push(i)}t(s)}else{const r=JSON.parse(i.animation),s=this.Parse(r);s.snippetId=e,t(s)}}else i("Unable to load the snippet "+e)})),r.open("GET",this.SnippetUrl+"/"+e.replace(/#/g,"/")),r.send()}))}}dt._UniqueIdGenerator=0,dt.AllowMatricesInterpolation=!1,dt.AllowMatrixDecomposeForInterpolation=!0,dt.SnippetUrl="https://snippet.babylonjs.com",dt.ANIMATIONTYPE_FLOAT=0,dt.ANIMATIONTYPE_VECTOR3=1,dt.ANIMATIONTYPE_QUATERNION=2,dt.ANIMATIONTYPE_MATRIX=3,dt.ANIMATIONTYPE_COLOR3=4,dt.ANIMATIONTYPE_COLOR4=7,dt.ANIMATIONTYPE_VECTOR2=5,dt.ANIMATIONTYPE_SIZE=6,dt.ANIMATIONLOOPMODE_RELATIVE=0,dt.ANIMATIONLOOPMODE_CYCLE=1,dt.ANIMATIONLOOPMODE_CONSTANT=2,dt.ANIMATIONLOOPMODE_YOYO=4,dt.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,dt.CreateFromSnippetAsync=dt.ParseFromSnippetAsync,(0,x.Y5)("BABYLON.Animation",dt),d._AnimationRangeFactory=(e,t,i)=>new it(e,t,i);class _t{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(e){if(this._autoTransitionRange===e)return;this._autoTransitionRange=e;const t=this._attachedCamera;t&&(e?this._onMeshTargetChangedObserver=t.onMeshTargetChangedObservable.add((e=>{if(e&&(e.computeWorldMatrix(!0),e.getBoundingInfo)){const t=e.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*t,this.upperRadiusTransitionRange=.05*t}})):this._onMeshTargetChangedObserver&&t.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(e){this._attachedCamera=e,this._onAfterCheckInputsObserver=e.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(e){return!!this._attachedCamera&&(this._attachedCamera.radius===e&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(e){if(!this._attachedCamera)return;this._radiusBounceTransition||(_t.EasingFunction.setEasingMode(_t.EasingMode),this._radiusBounceTransition=dt.CreateAnimation("radius",dt.ANIMATIONTYPE_FLOAT,60,_t.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const t=dt.TransitionTo("radius",this._attachedCamera.radius+e,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));t&&this._animatables.push(t)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}_t.EasingFunction=new class extends $e{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=e}easeInCore(e){const t=Math.max(0,this.amplitude);return Math.pow(e,3)-e*t*Math.sin(3.141592653589793*e)}}(.3),_t.EasingMode=$e.EASINGMODE_EASEOUT;class pt{constructor(){this.onTargetFramingAnimationEndObservable=new a.cP,this._mode=pt.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(e){this._mode=e}get mode(){return this._mode}set radiusScale(e){this._radiusScale=e}get radiusScale(){return this._radiusScale}set positionScale(e){this._positionScale=e}get positionScale(){return this._positionScale}set defaultElevation(e){this._defaultElevation=e}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(e){this._elevationReturnTime=e}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(e){this._elevationReturnWaitTime=e}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(e){this._zoomStopsAnimation=e}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(e){this._framingTime=e}get framingTime(){return this._framingTime}init(){}attach(e){this._attachedCamera=e;const t=this._attachedCamera.getScene();pt.EasingFunction.setEasingMode(pt.EasingMode),this._onPrePointerObservableObserver=t.onPrePointerObservable.add((e=>{e.type!==Ke.Zp.POINTERDOWN?e.type===Ke.Zp.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=e.onMeshTargetChangedObservable.add((e=>{e&&e.getBoundingInfo&&this.zoomOnMesh(e,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=e.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const e=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&e.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.computeWorldMatrix(!0);const r=e.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(r.minimumWorld,r.maximumWorld,t,i)}zoomOnMeshHierarchy(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.computeWorldMatrix(!0);const r=e.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(r.min,r.max,t,i)}zoomOnMeshesHierarchy(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=new o.Pq(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=new o.Pq(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let n=0;n<e.length;n++){const t=e[n].getHierarchyBoundingVectors(!0);o.Pq.CheckExtends(t.min,r,s),o.Pq.CheckExtends(t.max,r,s)}this.zoomOnBoundingInfo(r,s,t,i)}zoomOnBoundingInfo(e,t){let i,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const n=e.y,a=n+(t.y-n)*this._positionScale,l=t.subtract(e).scale(.5);if(r)i=new o.Pq(0,a,0);else{const t=e.add(l);i=new o.Pq(t.x,a,t.z)}this._vectorTransition||(this._vectorTransition=dt.CreateAnimation("target",dt.ANIMATIONTYPE_VECTOR3,60,pt.EasingFunction)),this._betaIsAnimating=!0;let h=dt.TransitionTo("target",i,this._attachedCamera,this._attachedCamera.getScene(),60,this._vectorTransition,this._framingTime);h&&this._animatables.push(h);let c=0;if(this._mode===pt.FitFrustumSidesMode){const i=this._calculateLowerRadiusFromModelBoundingSphere(e,t);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=l.length()+this._attachedCamera.minZ),c=i}else this._mode===pt.IgnoreBoundsSizeMode&&(c=this._calculateLowerRadiusFromModelBoundingSphere(e,t),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.minZ));if(this.autoCorrectCameraLimitsAndSensibility){const i=t.subtract(e).length();this._attachedCamera.panningSensibility=5e3/i,this._attachedCamera.wheelPrecision=100/c}return this._radiusTransition||(this._radiusTransition=dt.CreateAnimation("radius",dt.ANIMATIONTYPE_FLOAT,60,pt.EasingFunction)),h=dt.TransitionTo("radius",c,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),s&&s(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),h&&this._animatables.push(h),!0}_calculateLowerRadiusFromModelBoundingSphere(e,t){const i=this._attachedCamera;if(!i)return 0;let r=i._calculateLowerRadiusFromModelBoundingSphere(e,t,this._radiusScale);return i.lowerRadiusLimit&&this._mode===pt.IgnoreBoundsSizeMode&&(r=r<i.lowerRadiusLimit?i.lowerRadiusLimit:r),i.upperRadiusLimit&&(r=r>i.upperRadiusLimit?i.upperRadiusLimit:r),r}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const e=Ye.j.Now-this._lastInteractionTime,t=.5*Math.PI-this._defaultElevation,i=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>i&&e>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=dt.CreateAnimation("beta",dt.ANIMATIONTYPE_FLOAT,60,pt.EasingFunction));const e=dt.TransitionTo("beta",t,this._attachedCamera,this._attachedCamera.getScene(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));e&&this._animatables.push(e)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=Ye.j.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}pt.EasingFunction=new class extends $e{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=e}easeInCore(e){return this.exponent<=0?e:(Math.exp(this.exponent*e)-1)/(Math.exp(this.exponent)-1)}},pt.EasingMode=$e.EASINGMODE_EASEINOUT,pt.IgnoreBoundsSizeMode=0,pt.FitFrustumSidesMode=1,d.AddNodeConstructor("TargetCamera",((e,t)=>()=>new ft(e,o.Pq.Zero(),t)));class ft extends R{constructor(e,t,i){super(e,t,i,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),this._tmpUpVector=o.Pq.Zero(),this._tmpTargetVector=o.Pq.Zero(),this.cameraDirection=new o.Pq(0,0,0),this.cameraRotation=new o.I9(0,0),this.ignoreParentScaling=!1,this.updateUpVectorFromRotation=!1,this._tmpQuaternion=new o.PT,this.rotation=new o.Pq(0,0,0),this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=o.Pq.Zero(),this._initialFocalDistance=1,this._viewMatrix=o.uq.Zero(),this._camMatrix=o.uq.Zero(),this._cameraTransformMatrix=o.uq.Zero(),this._cameraRotationMatrix=o.uq.Zero(),this._referencePoint=new o.Pq(0,0,1),this._transformedReferencePoint=o.Pq.Zero(),this._deferredPositionUpdate=new o.Pq,this._deferredRotationQuaternionUpdate=new o.PT,this._deferredRotationUpdate=new o.Pq,this._deferredUpdated=!1,this._deferOnly=!1,this._defaultUp=o.Pq.Up(),this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0}getFrontPosition(e){this.getWorldMatrix();const t=this.getTarget().subtract(this.position);return t.normalize(),t.scaleInPlace(e),this.globalPosition.add(t)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const e=this.lockedTarget;e.computeWorldMatrix().getTranslationToRef(e.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.copyFromFloats(0,0,0),this.cameraRotation.copyFromFloats(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new o.Pq(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new o.Pq(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new o.PT(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(e){e||super._updateCache();const t=this._getLockedTargetPosition();t?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(t):this._cache.lockedTarget=t.clone():this._cache.lockedTarget=null,this._cache.rotation.copyFrom(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const e=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(e):!e)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const e=this.getEngine();return this.speed*Math.sqrt(e.getDeltaTime()/(100*e.getFps()))}setTarget(e){this.upVector.normalize(),this._initialFocalDistance=e.subtract(this.position).length(),this.position.z===e.z&&(this.position.z+=O.bH),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),o.uq.LookAtLHToRef(this.position,e,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);const t=e.subtract(this.position);t.x>=0?this.rotation.y=-Math.atan(t.z/t.x)+Math.PI/2:this.rotation.y=-Math.atan(t.z/t.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&o.PT.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}get target(){return this.getTarget()}set target(e){this.setTarget(e)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(o.AA.Matrix[0]),o.Pq.TransformNormalToRef(this.cameraDirection,o.AA.Matrix[0],o.AA.Vector3[0]),this._deferredPositionUpdate.addInPlace(o.AA.Vector3[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.copyFrom(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.copyFrom(this._deferredPositionUpdate)}_checkInputs(){const e=this.invertRotation?-this.inverseRotationSpeed:1,t=this._decideIfNeedsToMove(),i=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.copyFrom(this.rotation),this._deferredPositionUpdate.copyFrom(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.copyFrom(this.rotationQuaternion),t&&this._updatePosition(),i){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*e,this._deferredRotationUpdate.y+=this.cameraRotation.y*e,!this.noRotationConstraint){const e=1.570796;this._deferredRotationUpdate.x>e&&(this._deferredRotationUpdate.x=e),this._deferredRotationUpdate.x<-e&&(this._deferredRotationUpdate.x=-e)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.copyFrom(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(o.PT.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.copyFrom(this._deferredRotationQuaternionUpdate))}}t&&(Math.abs(this.cameraDirection.x)<this.speed*O.bH&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*O.bH&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*O.bH&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),i&&(Math.abs(this.cameraRotation.x)<this.speed*O.bH&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*O.bH&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):o.uq.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return o.Pq.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),o.Pq.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?J._0.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(o.PT.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),J._0.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(e,t,i){if(this.ignoreParentScaling){if(this.parent){const r=this.parent.getWorldMatrix();o.Pq.TransformCoordinatesToRef(e,r,this._globalPosition),o.Pq.TransformCoordinatesToRef(t,r,this._tmpTargetVector),o.Pq.TransformNormalToRef(i,r,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.copyFrom(e),this._tmpTargetVector.copyFrom(t),this._tmpUpVector.copyFrom(i);this.getScene().useRightHandedSystem?o.uq.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):o.uq.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix)}else if(this.getScene().useRightHandedSystem?o.uq.LookAtRHToRef(e,t,i,this._viewMatrix):o.uq.LookAtLHToRef(e,t,i,this._viewMatrix),this.parent){const e=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(e,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.copyFrom(e)}createRigCamera(e,t){if(this.cameraRigMode!==R.RIG_MODE_NONE){const t=new ft(e,this.position.clone(),this.getScene());return t.isRigCamera=!0,t.rigParent=this,this.cameraRigMode===R.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new o.PT),t._cameraRigParams={},t.rotationQuaternion=new o.PT),t.mode=this.mode,t.orthoLeft=this.orthoLeft,t.orthoRight=this.orthoRight,t.orthoTop=this.orthoTop,t.orthoBottom=this.orthoBottom,t}return null}_updateRigCameras(){const e=this._rigCameras[0],t=this._rigCameras[1];switch(this.computeWorldMatrix(),this.cameraRigMode){case R.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case R.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case R.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case R.RIG_MODE_STEREOSCOPIC_OVERUNDER:case R.RIG_MODE_STEREOSCOPIC_INTERLACED:{const i=this.cameraRigMode===R.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,r=this.cameraRigMode===R.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*i,e),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*r,t);break}case R.RIG_MODE_VR:e.rotationQuaternion?(e.rotationQuaternion.copyFrom(this.rotationQuaternion),t.rotationQuaternion.copyFrom(this.rotationQuaternion)):(e.rotation.copyFrom(this.rotation),t.rotation.copyFrom(this.rotation)),e.position.copyFrom(this.position),t.position.copyFrom(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(e,t){this.getTarget().subtractToRef(this.position,ft._TargetFocalPoint),ft._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const i=ft._TargetFocalPoint.addInPlace(this.position);o.uq.TranslationToRef(-i.x,-i.y,-i.z,ft._TargetTransformMatrix),ft._TargetTransformMatrix.multiplyToRef(o.uq.RotationAxis(t.upVector,e),ft._RigCamTransformMatrix),o.uq.TranslationToRef(i.x,i.y,i.z,ft._TargetTransformMatrix),ft._RigCamTransformMatrix.multiplyToRef(ft._TargetTransformMatrix,ft._RigCamTransformMatrix),o.Pq.TransformCoordinatesToRef(this.position,ft._RigCamTransformMatrix,t.position),t.setTarget(i)}getClassName(){return"TargetCamera"}}ft._RigCamTransformMatrix=new o.uq,ft._TargetTransformMatrix=new o.uq,ft._TargetFocalPoint=new o.Pq,(0,s.Cg)([(0,n.P_)()],ft.prototype,"rotation",void 0),(0,s.Cg)([(0,n.lK)()],ft.prototype,"speed",void 0),(0,s.Cg)([(0,n.xG)("lockedTargetId")],ft.prototype,"lockedTarget",void 0);var gt={};class mt{constructor(e){this.attachedToElement=!1,this.attached={},this.camera=e,this.checkInputs=()=>{}}add(e){const t=e.getSimpleName();this.attached[t]?T.V.Warn("camera input of type "+t+" already exists on camera"):(this.attached[t]=e,e.camera=this.camera,e.checkInputs&&(this.checkInputs=this._addCheckInputs(e.checkInputs.bind(e))),this.attachedToElement&&e.attachControl(this.noPreventDefault))}remove(e){for(const t in this.attached){const i=this.attached[t];if(i===e)return i.detachControl(),i.camera=null,delete this.attached[t],void this.rebuildInputCheck()}}removeByType(e){for(const t in this.attached){const i=this.attached[t];i.getClassName()===e&&(i.detachControl(),i.camera=null,delete this.attached[t],this.rebuildInputCheck())}}_addCheckInputs(e){const t=this.checkInputs;return()=>{t(),e()}}attachInput(e){this.attachedToElement&&e.attachControl(this.noPreventDefault)}attachElement(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){e=!R.ForceAttachControlToAlwaysPreventDefault&&e,this.attachedToElement=!0,this.noPreventDefault=e;for(const t in this.attached)this.attached[t].attachControl(e)}}detachElement(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const t in this.attached)this.attached[t].detachControl(),e&&(this.attached[t].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const e in this.attached){const t=this.attached[e];t.checkInputs&&(this.checkInputs=this._addCheckInputs(t.checkInputs.bind(t)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(e){const t={};for(const i in this.attached){const e=this.attached[i],r=c.p.Serialize(e);t[e.getClassName()]=r}e.inputsmgr=t}parse(e){const t=e.inputsmgr;if(t){this.clear();for(const e in t){const i=gt[e];if(i){const r=t[e],s=c.p.Parse((()=>new i),r,null);this.add(s)}}}else for(const i in this.attached){const t=gt[this.attached[i].getClassName()];if(t){const r=c.p.Parse((()=>new t),e,null);this.remove(this.attached[i]),this.add(r)}}}}class bt{constructor(){this._currentActiveButton=-1,this.buttons=[0,1,2]}attachControl(e){e=_.S0.BackCompatCameraNoPreventDefault(arguments);const t=this.camera.getEngine(),i=t.getInputElement();let r=0,s=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=n=>{const a=n.event,o="touch"===a.pointerType;if(n.type!==Ke.Zp.POINTERMOVE&&-1===this.buttons.indexOf(a.button))return;const l=a.target;if(this._altKey=a.altKey,this._ctrlKey=a.ctrlKey,this._metaKey=a.metaKey,this._shiftKey=a.shiftKey,this._buttonsPressed=a.buttons,t.isPointerLock){const e=a.movementX,t=a.movementY;this.onTouch(null,e,t),this._pointA=null,this._pointB=null}else{if(n.type!==Ke.Zp.POINTERDOWN&&n.type!==Ke.Zp.POINTERDOUBLETAP&&o&&this._pointA?.pointerId!==a.pointerId&&this._pointB?.pointerId!==a.pointerId)return;if(n.type!==Ke.Zp.POINTERDOWN||-1!==this._currentActiveButton&&!o)if(n.type===Ke.Zp.POINTERDOUBLETAP)this.onDoubleTap(a.pointerType);else if(n.type!==Ke.Zp.POINTERUP||this._currentActiveButton!==a.button&&!o){if(n.type===Ke.Zp.POINTERMOVE)if(e||a.preventDefault(),this._pointA&&null===this._pointB){const e=a.clientX-this._pointA.x,t=a.clientY-this._pointA.y;this._pointA.x=a.clientX,this._pointA.y=a.clientY,this.onTouch(this._pointA,e,t)}else if(this._pointA&&this._pointB){const e=this._pointA.pointerId===a.pointerId?this._pointA:this._pointB;e.x=a.clientX,e.y=a.clientY;const t=this._pointA.x-this._pointB.x,i=this._pointA.y-this._pointB.y,o=t*t+i*i,l={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:a.pointerId,type:n.type};this.onMultiTouch(this._pointA,this._pointB,r,o,s,l),s=l,r=o}}else{try{l?.releasePointerCapture(a.pointerId)}catch(Qp){}o||(this._pointB=null),t._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==a.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==a.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==r||s)&&(this.onMultiTouch(this._pointA,this._pointB,r,0,s,null),r=0,s=null),this._currentActiveButton=-1,this.onButtonUp(a),e||a.preventDefault()}else{try{l?.setPointerCapture(a.pointerId)}catch(Qp){}if(null===this._pointA)this._pointA={x:a.clientX,y:a.clientY,pointerId:a.pointerId,type:a.pointerType};else{if(null!==this._pointB)return;this._pointB={x:a.clientX,y:a.clientY,pointerId:a.pointerId,type:a.pointerType}}-1!==this._currentActiveButton||o||(this._currentActiveButton=a.button),this.onButtonDown(a),e||(a.preventDefault(),i&&i.focus())}}},this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._pointerInput,Ke.Zp.POINTERDOWN|Ke.Zp.POINTERUP|Ke.Zp.POINTERMOVE|Ke.Zp.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,r=0,s=null,this.onLostFocus()},this._contextMenuBind=e=>this.onContextMenu(e),i&&i.addEventListener("contextmenu",this._contextMenuBind,!1);const n=this.camera.getScene().getEngine().getHostWindow();n&&_.S0.RegisterTopRootEvents(n,[{name:"blur",handler:this._onLostFocus}])}detachControl(){if(this._onLostFocus){const e=this.camera.getScene().getEngine().getHostWindow();e&&_.S0.UnregisterTopRootEvents(e,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const e=this.camera.getScene().getEngine().getInputElement();e&&e.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentActiveButton=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(e){}onTouch(e,t,i){}onMultiTouch(e,t,i,r,s,n){}onContextMenu(e){e.preventDefault()}onButtonDown(e){}onButtonUp(e){}onLostFocus(){}}(0,s.Cg)([(0,n.lK)()],bt.prototype,"buttons",void 0);class vt extends bt{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(e,t){if(0!==this.panningSensibility&&e&&t){const i=t.x-e.x,r=t.y-e.y;this.camera.inertialPanningX+=-i/this.panningSensibility,this.camera.inertialPanningY+=r/this.panningSensibility}}_computePinchZoom(e,t){const i=this.camera.radius||vt.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=i*Math.sqrt(e)/Math.sqrt(t):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(t-e)*i*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(t-e)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(e,t,i){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-t/this.panningSensibility,this.camera.inertialPanningY+=i/this.panningSensibility):(this.camera.inertialAlphaOffset-=t/this.angularSensibilityX,this.camera.inertialBetaOffset-=i/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(e,t,i,r,s,n){0===i&&null===s||0===r&&null===n||(this.multiTouchPanAndZoom?(this._computePinchZoom(i,r),this._computeMultiTouchPanning(s,n)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(r)-Math.sqrt(i))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(i,r),this._isPinching=!0):this._computeMultiTouchPanning(s,n)):this.multiTouchPanning?this._computeMultiTouchPanning(s,n):this.pinchZoom&&this._computePinchZoom(i,r))}onButtonDown(e){this._isPanClick=e.button===this.camera._panningMouseButton}onButtonUp(e){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}vt.MinimumRadiusForPinch=.001,(0,s.Cg)([(0,n.lK)()],vt.prototype,"buttons",void 0),(0,s.Cg)([(0,n.lK)()],vt.prototype,"angularSensibilityX",void 0),(0,s.Cg)([(0,n.lK)()],vt.prototype,"angularSensibilityY",void 0),(0,s.Cg)([(0,n.lK)()],vt.prototype,"pinchPrecision",void 0),(0,s.Cg)([(0,n.lK)()],vt.prototype,"pinchDeltaPercentage",void 0),(0,s.Cg)([(0,n.lK)()],vt.prototype,"useNaturalPinchZoom",void 0),(0,s.Cg)([(0,n.lK)()],vt.prototype,"pinchZoom",void 0),(0,s.Cg)([(0,n.lK)()],vt.prototype,"panningSensibility",void 0),(0,s.Cg)([(0,n.lK)()],vt.prototype,"multiTouchPanning",void 0),(0,s.Cg)([(0,n.lK)()],vt.prototype,"multiTouchPanAndZoom",void 0),gt.ArcRotateCameraPointersInput=vt;var yt=i(4585);class Tt{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(e){e=_.S0.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((t=>{const i=t.event;if(!i.metaKey)if(t.type===yt.TB.KEYDOWN){if(this._ctrlPressed=i.ctrlKey,this._altPressed=i.altKey,-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)||-1!==this.keysReset.indexOf(i.keyCode)){-1===this._keys.indexOf(i.keyCode)&&this._keys.push(i.keyCode),i.preventDefault&&(e||i.preventDefault())}}else if(-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)||-1!==this.keysReset.indexOf(i.keyCode)){const t=this._keys.indexOf(i.keyCode);t>=0&&this._keys.splice(t,1),i.preventDefault&&(e||i.preventDefault())}})))}detachControl(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const e=this.camera;for(let t=0;t<this._keys.length;t++){const i=this._keys[t];-1!==this.keysLeft.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningX-=1/this.panningSensibility:e.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?e.inertialRadiusOffset+=1/this.zoomingSensibility:e.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningX+=1/this.panningSensibility:e.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?e.inertialRadiusOffset-=1/this.zoomingSensibility:e.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(i)&&e.useInputToRestoreState&&e.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,s.Cg)([(0,n.lK)()],Tt.prototype,"keysUp",void 0),(0,s.Cg)([(0,n.lK)()],Tt.prototype,"keysDown",void 0),(0,s.Cg)([(0,n.lK)()],Tt.prototype,"keysLeft",void 0),(0,s.Cg)([(0,n.lK)()],Tt.prototype,"keysRight",void 0),(0,s.Cg)([(0,n.lK)()],Tt.prototype,"keysReset",void 0),(0,s.Cg)([(0,n.lK)()],Tt.prototype,"panningSensibility",void 0),(0,s.Cg)([(0,n.lK)()],Tt.prototype,"zoomingSensibility",void 0),(0,s.Cg)([(0,n.lK)()],Tt.prototype,"useAltToZoom",void 0),(0,s.Cg)([(0,n.lK)()],Tt.prototype,"angularSpeed",void 0),gt.ArcRotateCameraKeyboardMoveInput=Tt;var xt=i(1321);class At{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new o.Pq(0,0,0),this._globalOffset=new o.Pq(0,0,0),this._inertialPanning=o.Pq.Zero()}_computeDeltaFromMouseWheelLegacyEvent(e,t){let i=0;const r=.01*e*this.wheelDeltaPercentage*t;return i=e>0?r/(1+this.wheelDeltaPercentage):r*(1+this.wheelDeltaPercentage),i}attachControl(e){e=_.S0.BackCompatCameraNoPreventDefault(arguments),this._wheel=t=>{if(t.type!==Ke.Zp.POINTERWHEEL)return;const i=t.event;let r=0;const s=i.deltaMode===xt.s.DOM_DELTA_LINE?40:1,n=-i.deltaY*s;if(this.customComputeDeltaFromMouseWheel)r=this.customComputeDeltaFromMouseWheel(n,this,i);else if(this.wheelDeltaPercentage){if(r=this._computeDeltaFromMouseWheelLegacyEvent(n,this.camera.radius),r>0){let e=this.camera.radius,t=this.camera.inertialRadiusOffset+r;for(let i=0;i<20&&Math.abs(t)>.001;i++)e-=t,t*=this.camera.inertia;e=tt.X.Clamp(e,0,Number.MAX_VALUE),r=this._computeDeltaFromMouseWheelLegacyEvent(n,e)}}else r=n/(40*this.wheelPrecision);r&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(r)):this.camera.inertialRadiusOffset+=r),i.preventDefault&&(e||i.preventDefault())},this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._wheel,Ke.Zp.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.setAll(0)}detachControl(){this._observer&&(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const e=this.camera;0+e.inertialAlphaOffset+e.inertialBetaOffset+e.inertialRadiusOffset&&(this._updateHitPlane(),e.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(e.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const e=this.camera,t=e.target.subtract(e.position);this._hitPlane=se.Z.FromPositionAndNormal(e.target,t)}_getPosition(){const e=this.camera,t=e.getScene(),i=t.createPickingRay(t.pointerX,t.pointerY,o.uq.Identity(),e,!1);0===e.targetScreenOffset.x&&0===e.targetScreenOffset.y||(this._viewOffset.set(e.targetScreenOffset.x,e.targetScreenOffset.y,0),e.getViewMatrix().invertToRef(e._cameraTransformMatrix),this._globalOffset=o.Pq.TransformNormal(this._viewOffset,e._cameraTransformMatrix),i.origin.addInPlace(this._globalOffset));let r=0;return this._hitPlane&&(r=i.intersectsPlane(this._hitPlane)??0),i.origin.addInPlace(i.direction.scaleInPlace(r))}_zoomToMouse(e){const t=this.camera,i=1-t.inertia;if(t.lowerRadiusLimit){const r=t.lowerRadiusLimit??0;t.radius-(t.inertialRadiusOffset+e)/i<r&&(e=(t.radius-r)*i-t.inertialRadiusOffset)}if(t.upperRadiusLimit){const r=t.upperRadiusLimit??0;t.radius-(t.inertialRadiusOffset+e)/i>r&&(e=(t.radius-r)*i-t.inertialRadiusOffset)}const r=e/i/t.radius,s=this._getPosition(),n=o.AA.Vector3[6];s.subtractToRef(t.target,n),n.scaleInPlace(r),n.scaleInPlace(i),this._inertialPanning.addInPlace(n),t.inertialRadiusOffset+=e}_zeroIfClose(e){Math.abs(e.x)<O.bH&&(e.x=0),Math.abs(e.y)<O.bH&&(e.y=0),Math.abs(e.z)<O.bH&&(e.z=0)}}(0,s.Cg)([(0,n.lK)()],At.prototype,"wheelPrecision",void 0),(0,s.Cg)([(0,n.lK)()],At.prototype,"zoomToMouseLocation",void 0),(0,s.Cg)([(0,n.lK)()],At.prototype,"wheelDeltaPercentage",void 0),gt.ArcRotateCameraMouseWheelInput=At;class Ct extends mt{constructor(e){super(e)}addMouseWheel(){return this.add(new At),this}addPointers(){return this.add(new vt),this}addKeyboard(){return this.add(new Tt),this}}d.AddNodeConstructor("ArcRotateCamera",((e,t)=>()=>new Rt(e,0,0,1,o.Pq.Zero(),t)));class Rt extends ft{get target(){return this._target}set target(e){this.setTarget(e)}get targetHost(){return this._targetHost}set targetHost(e){e&&this.setTarget(e)}getTarget(){return this.target}get position(){return this._position}set position(e){this.setPosition(e)}set upVector(e){this._upToYMatrix||(this._yToUpMatrix=new o.uq,this._upToYMatrix=new o.uq,this._upVector=o.Pq.Zero()),e.normalize(),this._upVector.copyFrom(e),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){o.uq.RotationAlignToRef(o.Pq.UpReadOnly,this._upVector,this._yToUpMatrix),o.uq.RotationAlignToRef(this._upVector,o.Pq.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const e=this.inputs.attached.pointers;return e?e.angularSensibilityX:0}set angularSensibilityX(e){const t=this.inputs.attached.pointers;t&&(t.angularSensibilityX=e)}get angularSensibilityY(){const e=this.inputs.attached.pointers;return e?e.angularSensibilityY:0}set angularSensibilityY(e){const t=this.inputs.attached.pointers;t&&(t.angularSensibilityY=e)}get pinchPrecision(){const e=this.inputs.attached.pointers;return e?e.pinchPrecision:0}set pinchPrecision(e){const t=this.inputs.attached.pointers;t&&(t.pinchPrecision=e)}get pinchDeltaPercentage(){const e=this.inputs.attached.pointers;return e?e.pinchDeltaPercentage:0}set pinchDeltaPercentage(e){const t=this.inputs.attached.pointers;t&&(t.pinchDeltaPercentage=e)}get useNaturalPinchZoom(){const e=this.inputs.attached.pointers;return!!e&&e.useNaturalPinchZoom}set useNaturalPinchZoom(e){const t=this.inputs.attached.pointers;t&&(t.useNaturalPinchZoom=e)}get panningSensibility(){const e=this.inputs.attached.pointers;return e?e.panningSensibility:0}set panningSensibility(e){const t=this.inputs.attached.pointers;t&&(t.panningSensibility=e)}get keysUp(){const e=this.inputs.attached.keyboard;return e?e.keysUp:[]}set keysUp(e){const t=this.inputs.attached.keyboard;t&&(t.keysUp=e)}get keysDown(){const e=this.inputs.attached.keyboard;return e?e.keysDown:[]}set keysDown(e){const t=this.inputs.attached.keyboard;t&&(t.keysDown=e)}get keysLeft(){const e=this.inputs.attached.keyboard;return e?e.keysLeft:[]}set keysLeft(e){const t=this.inputs.attached.keyboard;t&&(t.keysLeft=e)}get keysRight(){const e=this.inputs.attached.keyboard;return e?e.keysRight:[]}set keysRight(e){const t=this.inputs.attached.keyboard;t&&(t.keysRight=e)}get wheelPrecision(){const e=this.inputs.attached.mousewheel;return e?e.wheelPrecision:0}set wheelPrecision(e){const t=this.inputs.attached.mousewheel;t&&(t.wheelPrecision=e)}get zoomToMouseLocation(){const e=this.inputs.attached.mousewheel;return!!e&&e.zoomToMouseLocation}set zoomToMouseLocation(e){const t=this.inputs.attached.mousewheel;t&&(t.zoomToMouseLocation=e)}get wheelDeltaPercentage(){const e=this.inputs.attached.mousewheel;return e?e.wheelDeltaPercentage:0}set wheelDeltaPercentage(e){const t=this.inputs.attached.mousewheel;t&&(t.wheelDeltaPercentage=e)}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(e){e!==this.useBouncingBehavior&&(e?(this._bouncingBehavior=new _t,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(e){e!==this.useFramingBehavior&&(e?(this._framingBehavior=new pt,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(e){e!==this.useAutoRotationBehavior&&(e?(this._autoRotationBehavior=new je,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(e,t,i,r,s,n){var l;let h=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(e,o.Pq.Zero(),n,h),l=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=o.Pq.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=o.I9.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._viewMatrix=new o.uq,this.panningAxis=new o.Pq(1,1,0),this._transformedDirection=new o.Pq,this.mapPanning=!1,this._progressiveRestore=!1,this.onMeshTargetChangedObservable=new a.cP,this.checkCollisions=!1,this.collisionRadius=new o.Pq(.5,.5,.5),this._previousPosition=o.Pq.Zero(),this._collisionVelocity=o.Pq.Zero(),this._newPosition=o.Pq.Zero(),this._computationVector=o.Pq.Zero(),this._onCollisionPositionChange=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;i?(l.setPosition(t),l.onCollide&&l.onCollide(i)):l._previousPosition.copyFrom(l._position);const r=Math.cos(l.alpha),s=Math.sin(l.alpha),n=Math.cos(l.beta);let a=Math.sin(l.beta);0===a&&(a=1e-4);const o=l._getTargetPosition();l._computationVector.copyFromFloats(l.radius*r*a,l.radius*n,l.radius*s*a),o.addToRef(l._computationVector,l._newPosition),l._position.copyFrom(l._newPosition);let h=l.upVector;l.allowUpsideDown&&l.beta<0&&(h=h.clone(),h=h.negate()),l._computeViewMatrix(l._position,o,h),l._viewMatrix.addAtIndex(12,l.targetScreenOffset.x),l._viewMatrix.addAtIndex(13,l.targetScreenOffset.y),l._collisionTriggered=!1},this._target=o.Pq.Zero(),s&&this.setTarget(s),this.alpha=t,this.beta=i,this.radius=r,this.getViewMatrix(),this.inputs=new Ct(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new o.Pq(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=o.I9.Zero()}_updateCache(e){e||super._updateCache(),this._cache._target.copyFrom(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.copyFrom(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const e=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?e.addToRef(this._targetBoundingCenter,this._target):this._target.copyFrom(e)}const e=this._getLockedTargetPosition();return e||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>O.bH&&this.restoreStateInterpolationFactor<1?(this._progressiveRestore=!0,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const s=arguments;t=_.S0.BackCompatCameraNoPreventDefault(s),this._useCtrlForPanning=i,this._panningMouseButton=r,"boolean"===typeof s[0]&&(s.length>1&&(this._useCtrlForPanning=s[1]),s.length>2&&(this._panningMouseButton=s[2])),this.inputs.attachElement(t),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}detachControl(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),this._progressiveRestore){const e=this._scene.getEngine().getDeltaTime()/1e3,t=1-Math.pow(2,-e/this.restoreStateInterpolationFactor);this.setTarget(o.Pq.Lerp(this.getTarget(),this._storedTarget,t)),o.PT.RotationAlphaBetaGammaToRef(this._storedAlpha,this._storedBeta,0,o.AA.Quaternion[0]),o.PT.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,o.AA.Quaternion[1]),o.PT.SlerpToRef(o.AA.Quaternion[1],o.AA.Quaternion[0],t,o.AA.Quaternion[2]),o.AA.Quaternion[2].normalize(),o.AA.Quaternion[2].toAlphaBetaGammaToRef(o.AA.Vector3[0]),this.alpha=o.AA.Vector3[0].x,this.beta=o.AA.Vector3[0].y,this.radius+=(this._storedRadius-this.radius)*t,o.I9.LerpToRef(this.targetScreenOffset,this._storedTargetScreenOffset,t,this.targetScreenOffset),(o.Pq.DistanceSquared(this.getTarget(),this._storedTarget)<O.bH&&o.AA.Quaternion[2].equalsWithEpsilon(o.AA.Quaternion[0])&&Math.pow(this._storedRadius-this.radius,2)<O.bH&&o.I9.Distance(this.targetScreenOffset,this._storedTargetScreenOffset)<O.bH||0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset||0!==this.inertialPanningX||0!==this.inertialPanningY)&&(this._progressiveRestore=!1)}if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){const e=this.invertRotation?-1:1,t=this._calculateHandednessMultiplier();let i=this.inertialAlphaOffset*t;this.beta<0&&(i*=-1),this.alpha+=i*e,this.beta+=this.inertialBetaOffset*e,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<O.bH&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<O.bH&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*O.bH&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){const e=new o.Pq(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),e.multiplyInPlace(this.panningAxis),o.Pq.TransformNormalToRef(e,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const e=this.upVector,t=o.Pq.CrossToRef(this._transformedDirection,e,this._transformedDirection);o.Pq.CrossToRef(e,t,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);o.Pq.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.copyFrom(this._transformedDirection)}else{if(this.parent){const e=o.AA.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(e),e.transposeToRef(e),o.Pq.TransformCoordinatesToRef(this._transformedDirection,e,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*O.bH&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*O.bH&&(this.inertialPanningY=0)}this._checkLimits(),super._checkInputs()}}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||o.Pq.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const e=this.alpha;0===this._computationVector.x&&0===this._computationVector.z?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha);const t=Math.round((e-this.alpha)/(2*Math.PI));this.alpha+=2*t*Math.PI,this.beta=Math.acos(this._computationVector.y/this.radius),this._checkLimits()}setPosition(e){this._position.equals(e)||(this._position.copyFrom(e),this.rebuildAnglesAndRadius())}setTarget(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(r=this.overrideCloneAlphaBetaRadius??r,e.computeWorldMatrix)t&&e.getBoundingInfo?this._targetBoundingCenter=e.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,e.computeWorldMatrix(),this._targetHost=e,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const t=e,r=this._getTargetPosition();if(r&&!i&&r.equals(t))return;this._targetHost=null,this._target=t,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}r||this.rebuildAnglesAndRadius()}_getViewMatrix(){const e=Math.cos(this.alpha),t=Math.sin(this.alpha),i=Math.cos(this.beta);let r=Math.sin(this.beta);0===r&&(r=1e-4),0===this.radius&&(this.radius=1e-4);const s=this._getTargetPosition();if(this._computationVector.copyFromFloats(this.radius*e*r,this.radius*i,this.radius*t*r),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||o.Pq.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),s.addToRef(this._computationVector,this._newPosition),this.getScene().collisionsEnabled&&this.checkCollisions){const e=this.getScene().collisionCoordinator;this._collider||(this._collider=e.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,e.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.copyFrom(this._newPosition);let e=this.upVector;this.allowUpsideDown&&r<0&&(e=e.negate()),this._computeViewMatrix(this._position,s,e),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=s,this._viewMatrix}zoomOn(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e=e||this.getScene().meshes;const i=Xe.MinMax(e);let r=this._calculateLowerRadiusFromModelBoundingSphere(i.min,i.max);r=Math.max(Math.min(r,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=r*this.zoomOnFactor,this.focusOn({min:i.min,max:i.max,distance:r},t)}focusOn(e){let t,i,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===e.min){const r=e||this.getScene().meshes;t=Xe.MinMax(r),i=o.Pq.Distance(t.min,t.max)}else{t=e,i=e.distance}this._target=Xe.Center(t),r||(this.maxZ=2*i)}createRigCamera(e,t){let i=0;switch(this.cameraRigMode){case R.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case R.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case R.RIG_MODE_STEREOSCOPIC_OVERUNDER:case R.RIG_MODE_STEREOSCOPIC_INTERLACED:case R.RIG_MODE_VR:i=this._cameraRigParams.stereoHalfAngle*(0===t?1:-1);break;case R.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:i=this._cameraRigParams.stereoHalfAngle*(0===t?-1:1)}const r=new Rt(e,this.alpha+i,this.beta,this.radius,this._target,this.getScene());return r._cameraRigParams={},r.isRigCamera=!0,r.rigParent=this,r.upVector=this.upVector,r.mode=this.mode,r.orthoLeft=this.orthoLeft,r.orthoRight=this.orthoRight,r.orthoBottom=this.orthoBottom,r.orthoTop=this.orthoTop,r}_updateRigCameras(){const e=this._rigCameras[0],t=this._rigCameras[1];switch(e.beta=t.beta=this.beta,this.cameraRigMode){case R.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case R.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case R.RIG_MODE_STEREOSCOPIC_OVERUNDER:case R.RIG_MODE_STEREOSCOPIC_INTERLACED:case R.RIG_MODE_VR:e.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,t.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case R.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:e.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,t.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const r=o.Pq.Distance(e,t),s=this.getScene().getEngine().getAspectRatio(this),n=Math.tan(this.fov/2),a=n*s,l=.5*r*i,h=l*Math.sqrt(1+1/(a*a)),c=l*Math.sqrt(1+1/(n*n));return Math.max(h,c)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,s.Cg)([(0,n.lK)()],Rt.prototype,"alpha",void 0),(0,s.Cg)([(0,n.lK)()],Rt.prototype,"beta",void 0),(0,s.Cg)([(0,n.lK)()],Rt.prototype,"radius",void 0),(0,s.Cg)([(0,n.lK)()],Rt.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,s.Cg)([(0,n.P_)("target")],Rt.prototype,"_target",void 0),(0,s.Cg)([(0,n.xG)("targetHost")],Rt.prototype,"_targetHost",void 0),(0,s.Cg)([(0,n.lK)()],Rt.prototype,"inertialAlphaOffset",void 0),(0,s.Cg)([(0,n.lK)()],Rt.prototype,"inertialBetaOffset",void 0),(0,s.Cg)([(0,n.lK)()],Rt.prototype,"inertialRadiusOffset",void 0),(0,s.Cg)([(0,n.lK)()],Rt.prototype,"lowerAlphaLimit",void 0),(0,s.Cg)([(0,n.lK)()],Rt.prototype,"upperAlphaLimit",void 0),(0,s.Cg)([(0,n.lK)()],Rt.prototype,"lowerBetaLimit",void 0),(0,s.Cg)([(0,n.lK)()],Rt.prototype,"upperBetaLimit",void 0),(0,s.Cg)([(0,n.lK)()],Rt.prototype,"lowerRadiusLimit",void 0),(0,s.Cg)([(0,n.lK)()],Rt.prototype,"upperRadiusLimit",void 0),(0,s.Cg)([(0,n.lK)()],Rt.prototype,"inertialPanningX",void 0),(0,s.Cg)([(0,n.lK)()],Rt.prototype,"inertialPanningY",void 0),(0,s.Cg)([(0,n.lK)()],Rt.prototype,"pinchToPanMaxDistance",void 0),(0,s.Cg)([(0,n.lK)()],Rt.prototype,"panningDistanceLimit",void 0),(0,s.Cg)([(0,n.P_)()],Rt.prototype,"panningOriginTarget",void 0),(0,s.Cg)([(0,n.lK)()],Rt.prototype,"panningInertia",void 0),(0,s.Cg)([(0,n.lK)()],Rt.prototype,"zoomToMouseLocation",null),(0,s.Cg)([(0,n.lK)()],Rt.prototype,"zoomOnFactor",void 0),(0,s.Cg)([(0,n.WM)()],Rt.prototype,"targetScreenOffset",void 0),(0,s.Cg)([(0,n.lK)()],Rt.prototype,"allowUpsideDown",void 0),(0,s.Cg)([(0,n.lK)()],Rt.prototype,"useInputToRestoreState",void 0),(0,s.Cg)([(0,n.lK)()],Rt.prototype,"restoreStateInterpolationFactor",void 0),(0,x.Y5)("BABYLON.ArcRotateCamera",Rt);var Et=i(8665),St=i(5887);class Mt{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;this._enabled=!0,this._rollingFrameTime=new Pt(e)}sampleFrame(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ye.j.Now;if(this._enabled){if(null!=this._lastFrameTimeMs){const t=e-this._lastFrameTimeMs;this._rollingFrameTime.add(t)}this._lastFrameTimeMs=e}}get averageFrameTime(){return this._rollingFrameTime.average}get averageFrameTimeVariance(){return this._rollingFrameTime.variance}get instantaneousFrameTime(){return this._rollingFrameTime.history(0)}get averageFPS(){return 1e3/this._rollingFrameTime.average}get instantaneousFPS(){const e=this._rollingFrameTime.history(0);return 0===e?0:1e3/e}get isSaturated(){return this._rollingFrameTime.isSaturated()}enable(){this._enabled=!0}disable(){this._enabled=!1,this._lastFrameTimeMs=null}get isEnabled(){return this._enabled}reset(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()}}class Pt{constructor(e){this._samples=new Array(e),this.reset()}add(e){let t;if(this.isSaturated()){const e=this._samples[this._pos];t=e-this.average,this.average-=t/(this._sampleCount-1),this._m2-=t*(e-this.average)}else this._sampleCount++;t=e-this.average,this.average+=t/this._sampleCount,this._m2+=t*(e-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=e,this._pos++,this._pos%=this._samples.length}history(e){if(e>=this._sampleCount||e>=this._samples.length)return 0;const t=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(t-e)]}isSaturated(){return this._sampleCount>=this._samples.length}reset(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0}_wrapPosition(e){const t=this._samples.length;return(e%t+t)%t}}var It=i(4116),Ot=i(7829);St.w.prototype.setAlphaMode=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._alphaMode!==e){switch(e){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}t||(this.depthCullingState.depthMask=0===e),this._alphaMode=e}else if(!t){const t=0===e;this.depthCullingState.depthMask!==t&&(this.depthCullingState.depthMask=t)}};i(6371);St.w.prototype.updateDynamicIndexBuffer=function(e,t){let i;this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(e),i=e.is32Bits?t instanceof Uint32Array?t:new Uint32Array(t):t instanceof Uint16Array?t:new Uint16Array(t),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,i,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},St.w.prototype.updateDynamicVertexBuffer=function(e,t,i,r){this.bindArrayBuffer(e),void 0===i&&(i=0);const s=t.byteLength||t.length;void 0===r||r>=s&&0===i?t instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,i,new Float32Array(t)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,i,t):t instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(t).subarray(i,i+r)):(t=t instanceof ArrayBuffer?new Uint8Array(t,i,r):new Uint8Array(t.buffer,t.byteOffset+i,r),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t)),this._resetVertexBufferBinding()};var Dt=i(8315);ee.$.prototype.displayLoadingUI=function(){if(!(0,Dt.BA)())return;const e=this.loadingScreen;e&&e.displayLoadingUI()},ee.$.prototype.hideLoadingUI=function(){if(!(0,Dt.BA)())return;const e=this._loadingScreen;e&&e.hideLoadingUI()},Object.defineProperty(ee.$.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=ee.$.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(e){this._loadingScreen=e},enumerable:!0,configurable:!0}),Object.defineProperty(ee.$.prototype,"loadingUIText",{set:function(e){this.loadingScreen.loadingUIText=e},enumerable:!0,configurable:!0}),Object.defineProperty(ee.$.prototype,"loadingUIBackgroundColor",{set:function(e){this.loadingScreen.loadingUIBackgroundColor=e},enumerable:!0,configurable:!0}),ee.$.prototype.getInputElement=function(){return this._renderingCanvas},ee.$.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},ee.$.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},ee.$.prototype.getAspectRatio=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=e.viewport;return this.getRenderWidth(t)*i.width/(this.getRenderHeight(t)*i.height)},ee.$.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},ee.$.prototype._verifyPointerLock=function(){this._onPointerLockChange?.()},ee.$.prototype.setAlphaEquation=function(e){if(this._alphaEquation!==e){switch(e){case 0:this._alphaState.setAlphaEquationParameters(32774,32774);break;case 1:this._alphaState.setAlphaEquationParameters(32778,32778);break;case 2:this._alphaState.setAlphaEquationParameters(32779,32779);break;case 3:this._alphaState.setAlphaEquationParameters(32776,32776);break;case 4:this._alphaState.setAlphaEquationParameters(32775,32775);break;case 5:this._alphaState.setAlphaEquationParameters(32775,32774)}this._alphaEquation=e}},ee.$.prototype.getInputElement=function(){return this._renderingCanvas},ee.$.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},ee.$.prototype.setDepthFunction=function(e){this._depthCullingState.depthFunc=e},ee.$.prototype.setDepthFunctionToGreater=function(){this.setDepthFunction(516)},ee.$.prototype.setDepthFunctionToGreaterOrEqual=function(){this.setDepthFunction(518)},ee.$.prototype.setDepthFunctionToLess=function(){this.setDepthFunction(513)},ee.$.prototype.setDepthFunctionToLessOrEqual=function(){this.setDepthFunction(515)},ee.$.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},ee.$.prototype.setDepthWrite=function(e){this._depthCullingState.depthMask=e},ee.$.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},ee.$.prototype.setStencilBuffer=function(e){this._stencilState.stencilTest=e},ee.$.prototype.getStencilMask=function(){return this._stencilState.stencilMask},ee.$.prototype.setStencilMask=function(e){this._stencilState.stencilMask=e},ee.$.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},ee.$.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},ee.$.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},ee.$.prototype.setStencilFunction=function(e){this._stencilState.stencilFunc=e},ee.$.prototype.setStencilFunctionReference=function(e){this._stencilState.stencilFuncRef=e},ee.$.prototype.setStencilFunctionMask=function(e){this._stencilState.stencilFuncMask=e},ee.$.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},ee.$.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},ee.$.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},ee.$.prototype.setStencilOperationFail=function(e){this._stencilState.stencilOpStencilFail=e},ee.$.prototype.setStencilOperationDepthFail=function(e){this._stencilState.stencilOpDepthFail=e},ee.$.prototype.setStencilOperationPass=function(e){this._stencilState.stencilOpStencilDepthPass=e},ee.$.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},ee.$.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},ee.$.prototype.setAlphaConstants=function(e,t,i,r){this._alphaState.setAlphaBlendConstants(e,t,i,r)},ee.$.prototype.getAlphaMode=function(){return this._alphaMode},ee.$.prototype.getAlphaEquation=function(){return this._alphaEquation},ee.$.prototype.getRenderPassNames=function(){return this._renderPassNames},ee.$.prototype.getCurrentRenderPassName=function(){return this._renderPassNames[this.currentRenderPassId]},ee.$.prototype.createRenderPassId=function(e){const t=++ee.$._RenderPassIdCounter;return this._renderPassNames[t]=e??"NONAME",t},ee.$.prototype.releaseRenderPassId=function(e){this._renderPassNames[e]=void 0;for(let t=0;t<this.scenes.length;++t){const i=this.scenes[t];for(let t=0;t<i.meshes.length;++t){const r=i.meshes[t];if(r.subMeshes)for(let t=0;t<r.subMeshes.length;++t){r.subMeshes[t]._removeDrawWrapper(e)}}}};i(5627);function wt(e){if(e.requestPointerLock){const t=e.requestPointerLock();t instanceof Promise?t.then((()=>{e.focus()})).catch((()=>{})):e.focus()}}var Ft=i(3341);ee.$.AudioEngineFactory=(e,t,i)=>new Lt(e,t,i);class Lt{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new a.cP,this.onAudioLockedObservable=new a.cP,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,Dt.BA)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const r=document.createElement("audio");this._hostElement=e,this._audioContext=t,this._audioDestination=i;try{r&&r.canPlayType&&(r.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||r.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(Qp){}try{r&&r.canPlayType&&r.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(Qp){}}lock(){this._triggerSuspendedState()}unlock(){if("running"===this._audioContext?.state)return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?this._audioContext?.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningState()})):this._triggerRunningState()}_resumeAudioContextOnStateChange(){this._audioContext?.addEventListener("statechange",(()=>{this.unlocked&&"running"!==this._audioContext?.state&&this._resumeAudioContext()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContext(){return this._audioContext?.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningState())}catch(Qp){this.canUseWebAudio=!1,T.V.Error("Web Audio: "+Qp.message)}}_triggerRunningState(){this._tryToRun||(this._tryToRun=!0,this._resumeAudioContext().then((()=>{this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)})).catch((()=>{this._tryToRun=!1,this.unlocked=!1})))}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const e=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",t=document.createElement("style");t.appendChild(document.createTextNode(e)),document.getElementsByTagName("head")[0].appendChild(t),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningState()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear()}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(e){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=e)}connectToAnalyser(e){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=e,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}class Bt extends St.w{static get NpmPackage(){return ee.$.NpmPackage}static get Version(){return ee.$.Version}static get Instances(){return l.q.Instances}static get LastCreatedEngine(){return l.q.LastCreatedEngine}static get LastCreatedScene(){return l.q.LastCreatedScene}static DefaultLoadingScreenFactory(e){return ee.$.DefaultLoadingScreenFactory(e)}get _supportsHardwareTextureRescaling(){return!!Bt._RescalePostProcessFactory}_measureFps(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0}get performanceMonitor(){return this._performanceMonitor}constructor(e,t,i){if(super(e,t,i,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this.customAnimationFrameRequester=null,this._performanceMonitor=new Mt,this._drawCalls=new Ft.A,e&&(this._features.supportRenderPasses=!0,i=this._creationOptions,e.getContext)){const t=e;this._sharedInit(t)}}_initGLContext(){super._initGLContext(),this._rescalePostProcess=null}_sharedInit(e){super._sharedInit(e),function(e,t,i){e._onCanvasFocus=()=>{e.onCanvasFocusObservable.notifyObservers(e)},e._onCanvasBlur=()=>{e.onCanvasBlurObservable.notifyObservers(e)},e._onCanvasContextMenu=t=>{e.disableContextMenu&&t.preventDefault()},t.addEventListener("focus",e._onCanvasFocus),t.addEventListener("blur",e._onCanvasBlur),t.addEventListener("contextmenu",e._onCanvasContextMenu),e._onBlur=()=>{e.disablePerformanceMonitorInBackground&&e.performanceMonitor.disable(),e._windowIsBackground=!0},e._onFocus=()=>{e.disablePerformanceMonitorInBackground&&e.performanceMonitor.enable(),e._windowIsBackground=!1},e._onCanvasPointerOut=i=>{document.elementFromPoint(i.clientX,i.clientY)!==t&&e.onCanvasPointerOutObservable.notifyObservers(i)};const r=e.getHostWindow();r&&"function"===typeof r.addEventListener&&(r.addEventListener("blur",e._onBlur),r.addEventListener("focus",e._onFocus)),t.addEventListener("pointerout",e._onCanvasPointerOut),i.doNotHandleTouchAction||function(e){e&&e.setAttribute&&(e.setAttribute("touch-action","none"),e.style.touchAction="none",e.style.webkitTapHighlightColor="transparent")}(t),!ee.$.audioEngine&&i.audioEngine&&ee.$.AudioEngineFactory&&(ee.$.audioEngine=ee.$.AudioEngineFactory(e.getRenderingCanvas(),e.getAudioContext(),e.getAudioDestination())),(0,Dt.Nf)()&&(e._onFullscreenChange=()=>{e.isFullscreen=!!document.fullscreenElement,e.isFullscreen&&e._pointerLockRequested&&t&&wt(t)},document.addEventListener("fullscreenchange",e._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",e._onFullscreenChange,!1),e._onPointerLockChange=()=>{e.isPointerLock=document.pointerLockElement===t},document.addEventListener("pointerlockchange",e._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",e._onPointerLockChange,!1)),e.enableOfflineSupport=void 0!==ee.$.OfflineProviderFactory,e._deterministicLockstep=!!i.deterministicLockstep,e._lockstepMaxSteps=i.lockstepMaxSteps||0,e._timeStep=i.timeStep||1/60}(this,e,this._creationOptions)}resizeImageBitmap(e,t,i){return function(e,t,i,r){const s=e.createCanvas(i,r).getContext("2d");if(!s)throw new Error("Unable to get 2d context for resizeImageBitmap");return s.drawImage(t,0,0),s.getImageData(0,0,i,r).data}(this,e,t,i)}_createImageBitmapFromSource(e,t){return function(e,t,i){return new Promise(((r,s)=>{const n=new Image;n.onload=()=>{n.decode().then((()=>{e.createImageBitmap(n,i).then((e=>{r(e)}))}))},n.onerror=()=>{s(`Error loading image ${n.src}`)},n.src=t}))}(this,e,t)}switchFullscreen(e){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(e)}enterFullscreen(e){this.isFullscreen||(this._pointerLockRequested=e,this._renderingCanvas&&function(e){const t=e.requestFullscreen||e.webkitRequestFullscreen;t&&t.call(e)}(this._renderingCanvas))}exitFullscreen(){this.isFullscreen&&function(){const e=document;document.exitFullscreen?document.exitFullscreen():e.webkitCancelFullScreen&&e.webkitCancelFullScreen()}()}setDitheringState(e){e?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)}setRasterizerState(e){e?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)}setDirectViewport(e,t,i,r){const s=this._cachedViewport;return this._cachedViewport=null,this._viewport(e,t,i,r),s}scissorClear(e,t,i,r,s){this.enableScissor(e,t,i,r),this.clear(s,!0,!0,!0),this.disableScissor()}enableScissor(e,t,i,r){const s=this._gl;s.enable(s.SCISSOR_TEST),s.scissor(e,t,i,r)}disableScissor(){const e=this._gl;e.disable(e.SCISSOR_TEST)}_loadFileAsync(e,t,i){return new Promise(((r,s)=>{this._loadFile(e,(e=>{r(e)}),void 0,t,i,((e,t)=>{s(t)}))}))}getVertexShaderSource(e){const t=this._gl.getAttachedShaders(e);return t?this._gl.getShaderSource(t[0]):null}getFragmentShaderSource(e){const t=this._gl.getAttachedShaders(e);return t?this._gl.getShaderSource(t[1]):null}set framebufferDimensionsObject(e){this._framebufferDimensionsObject=e,this._framebufferDimensionsObject&&this.onResizeObservable.notifyObservers(this)}_rebuildBuffers(){for(const e of this.scenes)e.resetCachedMaterial(),e._rebuildGeometries();for(const e of this._virtualScenes)e.resetCachedMaterial(),e._rebuildGeometries();super._rebuildBuffers()}getFontOffset(e){return function(e){const t=document.createElement("span");t.textContent="Hg",t.style.font=e;const i=document.createElement("div");i.style.display="inline-block",i.style.width="1px",i.style.height="0px",i.style.verticalAlign="bottom";const r=document.createElement("div");r.style.whiteSpace="nowrap",r.appendChild(t),r.appendChild(i),document.body.appendChild(r);let s=0,n=0;try{n=i.getBoundingClientRect().top-t.getBoundingClientRect().top,i.style.verticalAlign="baseline",s=i.getBoundingClientRect().top-t.getBoundingClientRect().top}finally{document.body.removeChild(r)}return{ascent:s,height:n,descent:n-s}}(e)}_cancelFrame(){if(this.customAnimationFrameRequester){if(0!==this._frameHandler){this._frameHandler=0;const{cancelAnimationFrame:e}=this.customAnimationFrameRequester;e&&e(this.customAnimationFrameRequester.requestID)}}else super._cancelFrame()}_renderLoop(){if(this._frameHandler=0,!this._contextWasLost){let e=!0;(this.isDisposed||!this.renderEvenInBackground&&this._windowIsBackground)&&(e=!1),e&&(this.beginFrame(),this._renderViews()||this._renderFrame(),this.endFrame())}this._activeRenderLoops.length>0&&0===this._frameHandler&&(this.customAnimationFrameRequester?(this.customAnimationFrameRequester.requestID=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.requestID):this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}enterPointerlock(){this._renderingCanvas&&wt(this._renderingCanvas)}exitPointerlock(){document.exitPointerLock&&document.exitPointerLock()}beginFrame(){this._measureFps(),super.beginFrame()}_deletePipelineContext(e){const t=e;t&&t.program&&t.transformFeedback&&(this.deleteTransformFeedback(t.transformFeedback),t.transformFeedback=null),super._deletePipelineContext(e)}createShaderProgram(e,t,i,r,s){let n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;s=s||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);const a=super.createShaderProgram(e,t,i,r,s,n);return this.onAfterShaderCompilationObservable.notifyObservers(this),a}_createShaderProgram(e,t,i,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const n=r.createProgram();if(e.program=n,!n)throw new Error("Unable to create program");if(r.attachShader(n,t),r.attachShader(n,i),this.webGLVersion>1&&s){const t=this.createTransformFeedback();this.bindTransformFeedback(t),this.setTranformFeedbackVaryings(n,s),e.transformFeedback=t}return r.linkProgram(n),this.webGLVersion>1&&s&&this.bindTransformFeedback(null),e.context=r,e.vertexShader=t,e.fragmentShader=i,e.isParallelCompiled||this._finalizePipelineContext(e),n}_releaseTexture(e){super._releaseTexture(e)}_releaseRenderTargetWrapper(e){super._releaseRenderTargetWrapper(e),this.scenes.forEach((t=>{t.postProcesses.forEach((t=>{t._outputTexture===e&&(t._outputTexture=null)})),t.cameras.forEach((t=>{t._postProcesses.forEach((t=>{t&&t._outputTexture===e&&(t._outputTexture=null)}))}))}))}_rescaleTexture(e,t,i,r,s){this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);const n=this.createRenderTargetTexture({width:t.width,height:t.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});if(!this._rescalePostProcess&&Bt._RescalePostProcessFactory&&(this._rescalePostProcess=Bt._RescalePostProcessFactory(this)),this._rescalePostProcess){this._rescalePostProcess.externalTextureSamplerBinding=!0;const a=()=>{this._rescalePostProcess.onApply=function(t){t._bindTexture("textureSampler",e)};let a=i;a||(a=this.scenes[this.scenes.length-1]),a.postProcessManager.directRender([this._rescalePostProcess],n,!0),this._bindTextureDirectly(this._gl.TEXTURE_2D,t,!0),this._gl.copyTexImage2D(this._gl.TEXTURE_2D,0,r,0,0,t.width,t.height,0),this.unBindFramebuffer(n),n.dispose(),s&&s()},o=this._rescalePostProcess.getEffect();o?o.executeWhenCompiled(a):this._rescalePostProcess.onEffectCreatedObservable.addOnce((e=>{e.executeWhenCompiled(a)}))}}wrapWebGLTexture(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const n=new Ot.d(e,this._gl),a=new Et.h(this,0,!0);return a._hardwareTexture=n,a.baseWidth=r,a.baseHeight=s,a.width=r,a.height=s,a.isReady=!0,a.useMipMaps=t,this.updateTextureSamplingMode(i,a),a}_uploadImageToTexture(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const s=this._gl,n=this._getWebGLTextureType(e.type),a=this._getInternalFormat(e.format),o=this._getRGBABufferInternalSizedFormat(e.type,a),l=e.isCube?s.TEXTURE_CUBE_MAP:s.TEXTURE_2D;this._bindTextureDirectly(l,e,!0),this._unpackFlipY(e.invertY);let h=s.TEXTURE_2D;e.isCube&&(h=s.TEXTURE_CUBE_MAP_POSITIVE_X+i),s.texImage2D(h,r,o,a,n,t),this._bindTextureDirectly(l,null,!0)}updateTextureComparisonFunction(e,t){if(1===this.webGLVersion)return void T.V.Error("WebGL 1 does not support texture comparison.");const i=this._gl;e.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,e,!0),0===t?(i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_FUNC,515),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_MODE,i.NONE)):(i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_FUNC,t),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0),0===t?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_FUNC,515),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_MODE,i.NONE)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_FUNC,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),e._comparisonFunction=t}createInstancesBuffer(e){const t=this._gl.createBuffer();if(!t)throw new Error("Unable to create instance buffer");const i=new It.A(t);return i.capacity=e,this.bindArrayBuffer(i),this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),i.references=1,i}deleteInstancesBuffer(e){this._gl.deleteBuffer(e)}_clientWaitAsync(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;const r=this._gl;return new Promise(((s,n)=>{const a=()=>{const o=r.clientWaitSync(e,t,0);o!=r.WAIT_FAILED?o!=r.TIMEOUT_EXPIRED?s():setTimeout(a,i):n()};a()}))}_readPixelsAsync(e,t,i,r,s,n,a){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");const o=this._gl,l=o.createBuffer();o.bindBuffer(o.PIXEL_PACK_BUFFER,l),o.bufferData(o.PIXEL_PACK_BUFFER,a.byteLength,o.STREAM_READ),o.readPixels(e,t,i,r,s,n,0),o.bindBuffer(o.PIXEL_PACK_BUFFER,null);const h=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);return h?(o.flush(),this._clientWaitAsync(h,0,10).then((()=>(o.deleteSync(h),o.bindBuffer(o.PIXEL_PACK_BUFFER,l),o.getBufferSubData(o.PIXEL_PACK_BUFFER,0,a),o.bindBuffer(o.PIXEL_PACK_BUFFER,null),o.deleteBuffer(l),a)))):null}dispose(){this.hideLoadingUI(),this._rescalePostProcess&&this._rescalePostProcess.dispose(),function(e,t){1===l.q.Instances.length&&ee.$.audioEngine&&(ee.$.audioEngine.dispose(),ee.$.audioEngine=null);const i=e.getHostWindow();i&&"function"===typeof i.removeEventListener&&(i.removeEventListener("blur",e._onBlur),i.removeEventListener("focus",e._onFocus)),t&&(t.removeEventListener("focus",e._onCanvasFocus),t.removeEventListener("blur",e._onCanvasBlur),t.removeEventListener("pointerout",e._onCanvasPointerOut),t.removeEventListener("contextmenu",e._onCanvasContextMenu)),(0,Dt.Nf)()&&(document.removeEventListener("fullscreenchange",e._onFullscreenChange),document.removeEventListener("mozfullscreenchange",e._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",e._onFullscreenChange),document.removeEventListener("msfullscreenchange",e._onFullscreenChange),document.removeEventListener("pointerlockchange",e._onPointerLockChange),document.removeEventListener("mspointerlockchange",e._onPointerLockChange),document.removeEventListener("mozpointerlockchange",e._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",e._onPointerLockChange))}(this,this._renderingCanvas),super.dispose()}}Bt.ALPHA_DISABLE=0,Bt.ALPHA_ADD=1,Bt.ALPHA_COMBINE=2,Bt.ALPHA_SUBTRACT=3,Bt.ALPHA_MULTIPLY=4,Bt.ALPHA_MAXIMIZED=5,Bt.ALPHA_ONEONE=6,Bt.ALPHA_PREMULTIPLIED=7,Bt.ALPHA_PREMULTIPLIED_PORTERDUFF=8,Bt.ALPHA_INTERPOLATE=9,Bt.ALPHA_SCREENMODE=10,Bt.DELAYLOADSTATE_NONE=0,Bt.DELAYLOADSTATE_LOADED=1,Bt.DELAYLOADSTATE_LOADING=2,Bt.DELAYLOADSTATE_NOTLOADED=4,Bt.NEVER=512,Bt.ALWAYS=519,Bt.LESS=513,Bt.EQUAL=514,Bt.LEQUAL=515,Bt.GREATER=516,Bt.GEQUAL=518,Bt.NOTEQUAL=517,Bt.KEEP=7680,Bt.REPLACE=7681,Bt.INCR=7682,Bt.DECR=7683,Bt.INVERT=5386,Bt.INCR_WRAP=34055,Bt.DECR_WRAP=34056,Bt.TEXTURE_CLAMP_ADDRESSMODE=0,Bt.TEXTURE_WRAP_ADDRESSMODE=1,Bt.TEXTURE_MIRROR_ADDRESSMODE=2,Bt.TEXTUREFORMAT_ALPHA=0,Bt.TEXTUREFORMAT_LUMINANCE=1,Bt.TEXTUREFORMAT_LUMINANCE_ALPHA=2,Bt.TEXTUREFORMAT_RGB=4,Bt.TEXTUREFORMAT_RGBA=5,Bt.TEXTUREFORMAT_RED=6,Bt.TEXTUREFORMAT_R=6,Bt.TEXTUREFORMAT_RG=7,Bt.TEXTUREFORMAT_RED_INTEGER=8,Bt.TEXTUREFORMAT_R_INTEGER=8,Bt.TEXTUREFORMAT_RG_INTEGER=9,Bt.TEXTUREFORMAT_RGB_INTEGER=10,Bt.TEXTUREFORMAT_RGBA_INTEGER=11,Bt.TEXTURETYPE_UNSIGNED_BYTE=0,Bt.TEXTURETYPE_UNSIGNED_INT=0,Bt.TEXTURETYPE_FLOAT=1,Bt.TEXTURETYPE_HALF_FLOAT=2,Bt.TEXTURETYPE_BYTE=3,Bt.TEXTURETYPE_SHORT=4,Bt.TEXTURETYPE_UNSIGNED_SHORT=5,Bt.TEXTURETYPE_INT=6,Bt.TEXTURETYPE_UNSIGNED_INTEGER=7,Bt.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,Bt.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,Bt.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,Bt.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,Bt.TEXTURETYPE_UNSIGNED_INT_24_8=12,Bt.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,Bt.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,Bt.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,Bt.TEXTURE_NEAREST_SAMPLINGMODE=1,Bt.TEXTURE_BILINEAR_SAMPLINGMODE=2,Bt.TEXTURE_TRILINEAR_SAMPLINGMODE=3,Bt.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,Bt.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,Bt.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,Bt.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,Bt.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,Bt.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,Bt.TEXTURE_NEAREST_LINEAR=7,Bt.TEXTURE_NEAREST_NEAREST=1,Bt.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,Bt.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,Bt.TEXTURE_LINEAR_LINEAR=2,Bt.TEXTURE_LINEAR_NEAREST=12,Bt.TEXTURE_EXPLICIT_MODE=0,Bt.TEXTURE_SPHERICAL_MODE=1,Bt.TEXTURE_PLANAR_MODE=2,Bt.TEXTURE_CUBIC_MODE=3,Bt.TEXTURE_PROJECTION_MODE=4,Bt.TEXTURE_SKYBOX_MODE=5,Bt.TEXTURE_INVCUBIC_MODE=6,Bt.TEXTURE_EQUIRECTANGULAR_MODE=7,Bt.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,Bt.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,Bt.SCALEMODE_FLOOR=1,Bt.SCALEMODE_NEAREST=2,Bt.SCALEMODE_CEILING=3;class Nt{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(e){e!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=e,e?(this._onBeforeActiveMeshesEvaluationObserver=this.scene.onBeforeActiveMeshesEvaluationObservable.add((()=>{_.S0.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.scene.onAfterActiveMeshesEvaluationObservable.add((()=>{_.S0.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.scene.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.scene.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(e){e!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=e,e?(this._onBeforeRenderTargetsRenderObserver=this.scene.onBeforeRenderTargetsRenderObservable.add((()=>{_.S0.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.scene.onAfterRenderTargetsRenderObservable.add((()=>{_.S0.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.scene.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.scene.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(e){e!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=e,e?(this._onBeforeParticlesRenderingObserver=this.scene.onBeforeParticlesRenderingObservable.add((()=>{_.S0.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.scene.onAfterParticlesRenderingObservable.add((()=>{_.S0.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.scene.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.scene.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(e){e!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=e,this.scene.spriteManagers&&(e?(this._onBeforeSpritesRenderingObserver=this.scene.onBeforeSpritesRenderingObservable.add((()=>{_.S0.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.scene.onAfterSpritesRenderingObservable.add((()=>{_.S0.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.scene.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.scene.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(e){e!==this._capturePhysicsTime&&this.scene.onBeforePhysicsObservable&&(this._capturePhysicsTime=e,e?(this._onBeforePhysicsObserver=this.scene.onBeforePhysicsObservable.add((()=>{_.S0.StartPerformanceCounter("Physics"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.scene.onAfterPhysicsObservable.add((()=>{_.S0.EndPerformanceCounter("Physics"),this._physicsTime.endMonitoring()}))):(this.scene.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.scene.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(e){e!==this._captureAnimationsTime&&(this._captureAnimationsTime=e,e?this._onAfterAnimationsObserver=this.scene.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.scene.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(e){this._captureFrameTime=e}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(e){this._captureInterFrameTime=e}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(e){e!==this._captureRenderTime&&(this._captureRenderTime=e,e?(this._onBeforeDrawPhaseObserver=this.scene.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),_.S0.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.scene.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),_.S0.EndPerformanceCounter("Main render")}))):(this.scene.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.scene.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(e){e!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=e,e?(this._onBeforeCameraRenderObserver=this.scene.onBeforeCameraRenderObservable.add((e=>{this._cameraRenderTime.beginMonitoring(),_.S0.StartPerformanceCounter(`Rendering camera ${e.name}`)})),this._onAfterCameraRenderObserver=this.scene.onAfterCameraRenderObservable.add((e=>{this._cameraRenderTime.endMonitoring(!1),_.S0.EndPerformanceCounter(`Rendering camera ${e.name}`)}))):(this.scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.scene.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.scene.getEngine()._drawCalls}constructor(e){this.scene=e,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new Ft.A,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new Ft.A,this._captureFrameTime=!1,this._frameTime=new Ft.A,this._captureRenderTime=!1,this._renderTime=new Ft.A,this._captureInterFrameTime=!1,this._interFrameTime=new Ft.A,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new Ft.A,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new Ft.A,this._capturePhysicsTime=!1,this._physicsTime=new Ft.A,this._captureAnimationsTime=!1,this._animationsTime=new Ft.A,this._captureCameraRenderTime=!1,this._cameraRenderTime=new Ft.A,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._onBeforeAnimationsObserver=e.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(_.S0.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.scene.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=e.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(_.S0.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.endFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.endFrame(),this._captureParticlesRenderTime&&this._particlesRenderTime.endFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.endFrame(),this._captureRenderTime&&this._renderTime.endFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.endFrame()}))}dispose(){this.scene.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.scene.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.scene.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.scene.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.scene.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.scene.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.scene.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.scene.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.scene.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.scene.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.scene.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.scene.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.scene.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.scene.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.scene.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.scene.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.scene=null}}var kt=i(5415),Ut=i(921);let Vt=0;const zt=e=>{if(!e.environmentBRDFTexture){const t=e.useDelayedTextureLoading;e.useDelayedTextureLoading=!1;const i=e._blockEntityCollection;e._blockEntityCollection=!1;const r=kt.g.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+Vt++,e,!0,!1,kt.g.BILINEAR_SAMPLINGMODE);e._blockEntityCollection=i;const s=e.getEngine().getLoadedTexturesCache(),n=s.indexOf(r.getInternalTexture());-1!==n&&s.splice(n,1),r.isRGBD=!0,r.wrapU=kt.g.CLAMP_ADDRESSMODE,r.wrapV=kt.g.CLAMP_ADDRESSMODE,e.environmentBRDFTexture=r,e.useDelayedTextureLoading=t,Ut.G.ExpandRGBDTexture(r);const a=e.getEngine().onContextRestoredObservable.add((()=>{r.isRGBD=!0;const t=e.onBeforeRenderObservable.add((()=>{r.isReady()&&(e.onBeforeRenderObservable.remove(t),Ut.G.ExpandRGBDTexture(r))}))}));e.onDisposeObservable.add((()=>{e.getEngine().onContextRestoredObservable.remove(a)}))}return e.environmentBRDFTexture};var Gt=i(4742);class Ht{constructor(e){if(this._keys=[],this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=e,e)for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&this._setDefaultValue(t)}get isDirty(){return this._isDirty}markAsProcessed(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1}markAsUnprocessed(){this._isDirty=!0}markAllAsDirty(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!1,this._areImageProcessingDirty=!0,this._isDirty=!0}markAsImageProcessingDirty(){this._areImageProcessingDirty=!0,this._isDirty=!0}markAsLightDirty(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||e,this._isDirty=!0}markAsAttributesDirty(){this._areAttributesDirty=!0,this._isDirty=!0}markAsTexturesDirty(){this._areTexturesDirty=!0,this._isDirty=!0}markAsFresnelDirty(){this._areFresnelDirty=!0,this._isDirty=!0}markAsMiscDirty(){this._areMiscDirty=!0,this._isDirty=!0}markAsPrePassDirty(){this._arePrePassDirty=!0,this._isDirty=!0}rebuild(){this._keys.length=0;for(const e of Object.keys(this))"_"!==e[0]&&this._keys.push(e);if(this._externalProperties)for(const e in this._externalProperties)-1===this._keys.indexOf(e)&&this._keys.push(e)}isEqual(e){if(this._keys.length!==e._keys.length)return!1;for(let t=0;t<this._keys.length;t++){const i=this._keys[t];if(this[i]!==e[i])return!1}return!0}cloneTo(e){this._keys.length!==e._keys.length&&(e._keys=this._keys.slice(0));for(let t=0;t<this._keys.length;t++){const i=this._keys[t];e[i]=this[i]}}reset(){this._keys.forEach((e=>this._setDefaultValue(e)))}_setDefaultValue(e){const t=this._externalProperties?.[e]?.type??typeof this[e],i=this._externalProperties?.[e]?.default;switch(t){case"number":this[e]=i??0;break;case"string":this[e]=i??"";break;default:this[e]=i??!1}}toString(){let e="";for(let t=0;t<this._keys.length;t++){const i=this._keys[t],r=this[i];switch(typeof r){case"number":case"string":e+="#define "+i+" "+r+"\n";break;default:r&&(e+="#define "+i+"\n")}}return e}}var Wt=i(4504),qt=i(4453);const Xt=new RegExp("^([gimus]+)!");class Kt{constructor(e){this._plugins=[],this._activePlugins=[],this._activePluginsForExtraEvents=[],this._material=e,this._scene=e.getScene(),this._engine=this._scene.getEngine()}_addPlugin(e){for(let r=0;r<this._plugins.length;++r)if(this._plugins[r].name===e.name)return!1;if(this._material._uniformBufferLayoutBuilt)throw`The plugin "${e.name}" can't be added to the material "${this._material.name}" because this material has already been used for rendering! Please add plugins to materials before any rendering with this material occurs.`;if(!e.isCompatible(this._material.shaderLanguage))throw`The plugin "${e.name}" can't be added to the material "${this._material.name}" because the plugin is not compatible with the shader language of the material.`;const t=e.getClassName();Kt._MaterialPluginClassToMainDefine[t]||(Kt._MaterialPluginClassToMainDefine[t]="MATERIALPLUGIN_"+ ++Kt._MaterialPluginCounter),this._material._callbackPluginEventGeneric=(e,t)=>this._handlePluginEvent(e,t),this._plugins.push(e),this._plugins.sort(((e,t)=>e.priority-t.priority)),this._codeInjectionPoints={};const i={};i[Kt._MaterialPluginClassToMainDefine[t]]={type:"boolean",default:!0};for(const r of this._plugins)r.collectDefines(i),this._collectPointNames("vertex",r.getCustomCode("vertex",this._material.shaderLanguage)),this._collectPointNames("fragment",r.getCustomCode("fragment",this._material.shaderLanguage));return this._defineNamesFromPlugins=i,!0}_activatePlugin(e){-1===this._activePlugins.indexOf(e)&&(this._activePlugins.push(e),this._activePlugins.sort(((e,t)=>e.priority-t.priority)),this._material._callbackPluginEventIsReadyForSubMesh=this._handlePluginEventIsReadyForSubMesh.bind(this),this._material._callbackPluginEventPrepareDefinesBeforeAttributes=this._handlePluginEventPrepareDefinesBeforeAttributes.bind(this),this._material._callbackPluginEventPrepareDefines=this._handlePluginEventPrepareDefines.bind(this),this._material._callbackPluginEventBindForSubMesh=this._handlePluginEventBindForSubMesh.bind(this),e.registerForExtraEvents&&(this._activePluginsForExtraEvents.push(e),this._activePluginsForExtraEvents.sort(((e,t)=>e.priority-t.priority)),this._material._callbackPluginEventHasRenderTargetTextures=this._handlePluginEventHasRenderTargetTextures.bind(this),this._material._callbackPluginEventFillRenderTargetTextures=this._handlePluginEventFillRenderTargetTextures.bind(this),this._material._callbackPluginEventHardBindForSubMesh=this._handlePluginEventHardBindForSubMesh.bind(this)))}getPlugin(e){for(let t=0;t<this._plugins.length;++t)if(this._plugins[t].name===e)return this._plugins[t];return null}_handlePluginEventIsReadyForSubMesh(e){let t=!0;for(const i of this._activePlugins)t=t&&i.isReadyForSubMesh(e.defines,this._scene,this._engine,e.subMesh);e.isReadyForSubMesh=t}_handlePluginEventPrepareDefinesBeforeAttributes(e){for(const t of this._activePlugins)t.prepareDefinesBeforeAttributes(e.defines,this._scene,e.mesh)}_handlePluginEventPrepareDefines(e){for(const t of this._activePlugins)t.prepareDefines(e.defines,this._scene,e.mesh)}_handlePluginEventHardBindForSubMesh(e){for(const t of this._activePluginsForExtraEvents)t.hardBindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,e.subMesh)}_handlePluginEventBindForSubMesh(e){for(const t of this._activePlugins)t.bindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,e.subMesh)}_handlePluginEventHasRenderTargetTextures(e){let t=!1;for(const i of this._activePluginsForExtraEvents)if(t=i.hasRenderTargetTextures(),t)break;e.hasRenderTargetTextures=t}_handlePluginEventFillRenderTargetTextures(e){for(const t of this._activePluginsForExtraEvents)t.fillRenderTargetTextures(e.renderTargets)}_handlePluginEvent(e,t){switch(e){case 512:{const e=t;for(const t of this._activePlugins)t.getActiveTextures(e.activeTextures);break}case 256:{const e=t;for(const t of this._activePlugins)t.getAnimatables(e.animatables);break}case 1024:{const e=t;let i=!1;for(const t of this._activePlugins)if(i=t.hasTexture(e.texture),i)break;e.hasTexture=i;break}case 2:{const e=t;for(const t of this._plugins)t.dispose(e.forceDisposeTextures);break}case 4:t.defineNames=this._defineNamesFromPlugins;break;case 128:{const e=t;for(const t of this._activePlugins)e.fallbackRank=t.addFallbacks(e.defines,e.fallbacks,e.fallbackRank),t.getAttributes(e.attributes,this._scene,e.mesh);this._uniformList.length>0&&e.uniforms.push(...this._uniformList),this._samplerList.length>0&&e.samplers.push(...this._samplerList),this._uboList.length>0&&e.uniformBuffersNames.push(...this._uboList),e.customCode=this._injectCustomCode(e,e.customCode);break}case 8:{const e=t;this._uboDeclaration="",this._vertexDeclaration="",this._fragmentDeclaration="",this._uniformList=[],this._samplerList=[],this._uboList=[];const i=1===this._material.shaderLanguage;for(const t of this._plugins){const r=t.getUniforms(this._material.shaderLanguage);if(r){if(r.ubo)for(const t of r.ubo){if(t.size&&t.type){const r=t.arraySize??0;if(e.ubo.addUniform(t.name,t.size,r),i){let e;switch(t.type){case"mat4":e="mat4x4f";break;case"float":e="f32";break;default:e=`${t.type}f`}this._uboDeclaration+=`uniform ${t.name}: ${e}${r>0?`[${r}]`:""};\n`}else this._uboDeclaration+=`${t.type} ${t.name}${r>0?`[${r}]`:""};\n`}this._uniformList.push(t.name)}r.vertex&&(this._vertexDeclaration+=r.vertex+"\n"),r.fragment&&(this._fragmentDeclaration+=r.fragment+"\n")}t.getSamplers(this._samplerList),t.getUniformBuffersNames(this._uboList)}break}}}_collectPointNames(e,t){if(t)for(const i in t)this._codeInjectionPoints[e]||(this._codeInjectionPoints[e]={}),this._codeInjectionPoints[e][i]=!0}_injectCustomCode(e,t){return(i,r)=>{t&&(r=t(i,r)),this._uboDeclaration&&(r=r.replace("#define ADDITIONAL_UBO_DECLARATION",this._uboDeclaration)),this._vertexDeclaration&&(r=r.replace("#define ADDITIONAL_VERTEX_DECLARATION",this._vertexDeclaration)),this._fragmentDeclaration&&(r=r.replace("#define ADDITIONAL_FRAGMENT_DECLARATION",this._fragmentDeclaration));const s=this._codeInjectionPoints?.[i];if(!s)return r;let n=null;for(let t in s){let s="";for(const r of this._activePlugins){let a=r.getCustomCode(i,this._material.shaderLanguage)?.[t];if(a){if(r.resolveIncludes){if(null===n){const t=0;n={defines:[],indexParameters:e.indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:void 0,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:qt.l.GetShadersRepository(t),includesShadersStore:qt.l.GetIncludesShadersStore(t),version:void 0,platformName:this._engine.shaderPlatformName,processingContext:void 0,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:void 0}}n.isFragment="fragment"===i,(0,Wt.Iq)(a,n,(e=>a=e))}s+=a+"\n"}}if(s.length>0)if("!"===t.charAt(0)){t=t.substring(1);let e="g";if("!"===t.charAt(0))e="",t=t.substring(1);else{const i=Xt.exec(t);i&&i.length>=2&&(e=i[1],t=t.substring(e.length+1))}e.indexOf("g")<0&&(e+="g");const i=r,n=new RegExp(t,e);let a=n.exec(i);for(;null!==a;){let e=s;for(let t=0;t<a.length;++t)e=e.replace("$"+t,a[t]);r=r.replace(a[0],e),a=n.exec(i)}}else{const e="#define "+t;r=r.replace(e,"\n"+s+"\n"+e)}}return r}}}Kt._MaterialPluginClassToMainDefine={},Kt._MaterialPluginCounter=0,l.q.OnEnginesDisposedObservable.add((()=>{$t()}));const Yt=[];let jt=!1,Qt=null;function $t(){Yt.length=0,jt=!1,Ne.OnEventObservable.remove(Qt),Qt=null}class Zt{isCompatible(e){return 0===e}_enable(e){e&&this._pluginManager._activatePlugin(this)}constructor(e,t,i,r){let s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],n=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this.priority=500,this.resolveIncludes=!1,this.registerForExtraEvents=!1,this._material=e,this.name=t,this.priority=i,this.resolveIncludes=a,e.pluginManager||(e.pluginManager=new Kt(e),e.onDisposeObservable.add((()=>{e.pluginManager=void 0}))),this._pluginDefineNames=r,this._pluginManager=e.pluginManager,s&&this._pluginManager._addPlugin(this),n&&this._enable(!0),this.markAllDefinesAsDirty=e._dirtyCallbacks[63]}getClassName(){return"MaterialPluginBase"}isReadyForSubMesh(e,t,i,r){return!0}hardBindForSubMesh(e,t,i,r){}bindForSubMesh(e,t,i,r){}dispose(e){}getCustomCode(e){return null}collectDefines(e){if(this._pluginDefineNames)for(const t of Object.keys(this._pluginDefineNames)){if("_"===t[0])continue;const i=typeof this._pluginDefineNames[t];e[t]={type:"number"===i?"number":"string"===i?"string":"boolean"===i?"boolean":"object",default:this._pluginDefineNames[t]}}}prepareDefinesBeforeAttributes(e,t,i){}prepareDefines(e,t,i){}hasTexture(e){return!1}hasRenderTargetTextures(){return!1}fillRenderTargetTextures(e){}getActiveTextures(e){}getAnimatables(e){}addFallbacks(e,t,i){return i}getSamplers(e){}getAttributes(e,t,i){}getUniformBuffersNames(e){}getUniforms(){return{}}copyTo(e){c.p.Clone((()=>e),this)}serialize(){return c.p.Serialize(this)}parse(e,t,i){c.p.Parse((()=>this),e,t,i)}}(0,s.Cg)([(0,n.lK)()],Zt.prototype,"name",void 0),(0,s.Cg)([(0,n.lK)()],Zt.prototype,"priority",void 0),(0,s.Cg)([(0,n.lK)()],Zt.prototype,"resolveIncludes",void 0),(0,s.Cg)([(0,n.lK)()],Zt.prototype,"registerForExtraEvents",void 0),(0,x.Y5)("BABYLON.MaterialPluginBase",Zt);class Jt extends Ht{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1}}class ei extends Zt{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(e,"PBRBRDF",90,new Jt,t),this._useEnergyConservation=ei.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=ei.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=ei.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=ei.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=ei.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=ei.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=ei.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=ei.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._internalMarkAllSubMeshesAsMiscDirty=e._dirtyCallbacks[16],this._enable(!0)}prepareDefines(e){e.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,e.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,e.SPHERICAL_HARMONICS=this._useSphericalHarmonics,e.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation}getClassName(){return"PBRBRDFConfiguration"}}ei.DEFAULT_USE_ENERGY_CONSERVATION=!0,ei.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,ei.DEFAULT_USE_SPHERICAL_HARMONICS=!0,ei.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsMiscDirty")],ei.prototype,"useEnergyConservation",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsMiscDirty")],ei.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsMiscDirty")],ei.prototype,"useSphericalHarmonics",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsMiscDirty")],ei.prototype,"useSpecularGlossinessInputEnergyConservation",void 0);class ti{constructor(){this.previousWorldMatrices={},this.previousBones={}}static AddUniforms(e){e.push("previousWorld","previousViewProjection","mPreviousBones")}static AddSamplers(e){}bindForSubMesh(e,t,i,r,s){if(t.prePassRenderer&&t.prePassRenderer.enabled&&t.prePassRenderer.currentRTisSceneRT&&(-1!==t.prePassRenderer.getIndex(2)||-1!==t.prePassRenderer.getIndex(11))){this.previousWorldMatrices[i.uniqueId]||(this.previousWorldMatrices[i.uniqueId]=r.clone()),this.previousViewProjection||(this.previousViewProjection=t.getTransformMatrix().clone(),this.currentViewProjection=t.getTransformMatrix().clone());const s=t.getEngine();this.currentViewProjection.updateFlag!==t.getTransformMatrix().updateFlag?(this._lastUpdateFrameId=s.frameId,this.previousViewProjection.copyFrom(this.currentViewProjection),this.currentViewProjection.copyFrom(t.getTransformMatrix())):this._lastUpdateFrameId!==s.frameId&&(this._lastUpdateFrameId=s.frameId,this.previousViewProjection.copyFrom(this.currentViewProjection)),e.setMatrix("previousWorld",this.previousWorldMatrices[i.uniqueId]),e.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[i.uniqueId]=r.clone()}}}var ii=i(3390);class ri extends Ne{constructor(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(e,t),this._normalMatrix=new o.uq,this._storeEffectOnSubMeshes=i}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(e,t){return!!e&&(!this._storeEffectOnSubMeshes||(!e.subMeshes||0===e.subMeshes.length||this.isReadyForSubMesh(e,e.subMeshes[0],t)))}_isReadyForSubMesh(e){const t=e.materialDefines;return!(this.checkReadyOnEveryCall||!e.effect||!t||t._renderId!==this.getScene().getRenderId())}bindOnlyWorldMatrix(e){this._activeEffect.setMatrix("world",e)}bindOnlyNormalMatrix(e){this._activeEffect.setMatrix("normalMatrix",e)}bind(e,t){t&&this.bindForSubMesh(e,t,t.subMeshes[0])}_afterBind(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0;super._afterBind(e,t,i),this.getScene()._cachedEffect=t,i?i._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return i._drawWrapper._forceRebindOnNextCall||e.isCachedMaterialInvalid(this,t,r)}dispose(e,t,i){this._activeEffect=void 0,super.dispose(e,t,i)}}class si{static get DiffuseTextureEnabled(){return this._DiffuseTextureEnabled}static set DiffuseTextureEnabled(e){this._DiffuseTextureEnabled!==e&&(this._DiffuseTextureEnabled=e,ee.$.MarkAllMaterialsAsDirty(1))}static get DetailTextureEnabled(){return this._DetailTextureEnabled}static set DetailTextureEnabled(e){this._DetailTextureEnabled!==e&&(this._DetailTextureEnabled=e,ee.$.MarkAllMaterialsAsDirty(1))}static get DecalMapEnabled(){return this._DecalMapEnabled}static set DecalMapEnabled(e){this._DecalMapEnabled!==e&&(this._DecalMapEnabled=e,ee.$.MarkAllMaterialsAsDirty(1))}static get AmbientTextureEnabled(){return this._AmbientTextureEnabled}static set AmbientTextureEnabled(e){this._AmbientTextureEnabled!==e&&(this._AmbientTextureEnabled=e,ee.$.MarkAllMaterialsAsDirty(1))}static get OpacityTextureEnabled(){return this._OpacityTextureEnabled}static set OpacityTextureEnabled(e){this._OpacityTextureEnabled!==e&&(this._OpacityTextureEnabled=e,ee.$.MarkAllMaterialsAsDirty(1))}static get ReflectionTextureEnabled(){return this._ReflectionTextureEnabled}static set ReflectionTextureEnabled(e){this._ReflectionTextureEnabled!==e&&(this._ReflectionTextureEnabled=e,ee.$.MarkAllMaterialsAsDirty(1))}static get EmissiveTextureEnabled(){return this._EmissiveTextureEnabled}static set EmissiveTextureEnabled(e){this._EmissiveTextureEnabled!==e&&(this._EmissiveTextureEnabled=e,ee.$.MarkAllMaterialsAsDirty(1))}static get SpecularTextureEnabled(){return this._SpecularTextureEnabled}static set SpecularTextureEnabled(e){this._SpecularTextureEnabled!==e&&(this._SpecularTextureEnabled=e,ee.$.MarkAllMaterialsAsDirty(1))}static get BumpTextureEnabled(){return this._BumpTextureEnabled}static set BumpTextureEnabled(e){this._BumpTextureEnabled!==e&&(this._BumpTextureEnabled=e,ee.$.MarkAllMaterialsAsDirty(1))}static get LightmapTextureEnabled(){return this._LightmapTextureEnabled}static set LightmapTextureEnabled(e){this._LightmapTextureEnabled!==e&&(this._LightmapTextureEnabled=e,ee.$.MarkAllMaterialsAsDirty(1))}static get RefractionTextureEnabled(){return this._RefractionTextureEnabled}static set RefractionTextureEnabled(e){this._RefractionTextureEnabled!==e&&(this._RefractionTextureEnabled=e,ee.$.MarkAllMaterialsAsDirty(1))}static get ColorGradingTextureEnabled(){return this._ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(e){this._ColorGradingTextureEnabled!==e&&(this._ColorGradingTextureEnabled=e,ee.$.MarkAllMaterialsAsDirty(1))}static get FresnelEnabled(){return this._FresnelEnabled}static set FresnelEnabled(e){this._FresnelEnabled!==e&&(this._FresnelEnabled=e,ee.$.MarkAllMaterialsAsDirty(4))}static get ClearCoatTextureEnabled(){return this._ClearCoatTextureEnabled}static set ClearCoatTextureEnabled(e){this._ClearCoatTextureEnabled!==e&&(this._ClearCoatTextureEnabled=e,ee.$.MarkAllMaterialsAsDirty(1))}static get ClearCoatBumpTextureEnabled(){return this._ClearCoatBumpTextureEnabled}static set ClearCoatBumpTextureEnabled(e){this._ClearCoatBumpTextureEnabled!==e&&(this._ClearCoatBumpTextureEnabled=e,ee.$.MarkAllMaterialsAsDirty(1))}static get ClearCoatTintTextureEnabled(){return this._ClearCoatTintTextureEnabled}static set ClearCoatTintTextureEnabled(e){this._ClearCoatTintTextureEnabled!==e&&(this._ClearCoatTintTextureEnabled=e,ee.$.MarkAllMaterialsAsDirty(1))}static get SheenTextureEnabled(){return this._SheenTextureEnabled}static set SheenTextureEnabled(e){this._SheenTextureEnabled!==e&&(this._SheenTextureEnabled=e,ee.$.MarkAllMaterialsAsDirty(1))}static get AnisotropicTextureEnabled(){return this._AnisotropicTextureEnabled}static set AnisotropicTextureEnabled(e){this._AnisotropicTextureEnabled!==e&&(this._AnisotropicTextureEnabled=e,ee.$.MarkAllMaterialsAsDirty(1))}static get ThicknessTextureEnabled(){return this._ThicknessTextureEnabled}static set ThicknessTextureEnabled(e){this._ThicknessTextureEnabled!==e&&(this._ThicknessTextureEnabled=e,ee.$.MarkAllMaterialsAsDirty(1))}static get RefractionIntensityTextureEnabled(){return this._ThicknessTextureEnabled}static set RefractionIntensityTextureEnabled(e){this._RefractionIntensityTextureEnabled!==e&&(this._RefractionIntensityTextureEnabled=e,ee.$.MarkAllMaterialsAsDirty(1))}static get TranslucencyIntensityTextureEnabled(){return this._TranslucencyIntensityTextureEnabled}static set TranslucencyIntensityTextureEnabled(e){this._TranslucencyIntensityTextureEnabled!==e&&(this._TranslucencyIntensityTextureEnabled=e,ee.$.MarkAllMaterialsAsDirty(1))}static get TranslucencyColorTextureEnabled(){return this._TranslucencyColorTextureEnabled}static set TranslucencyColorTextureEnabled(e){this._TranslucencyColorTextureEnabled!==e&&(this._TranslucencyColorTextureEnabled=e,ee.$.MarkAllMaterialsAsDirty(1))}static get IridescenceTextureEnabled(){return this._IridescenceTextureEnabled}static set IridescenceTextureEnabled(e){this._IridescenceTextureEnabled!==e&&(this._IridescenceTextureEnabled=e,ee.$.MarkAllMaterialsAsDirty(1))}}si._DiffuseTextureEnabled=!0,si._DetailTextureEnabled=!0,si._DecalMapEnabled=!0,si._AmbientTextureEnabled=!0,si._OpacityTextureEnabled=!0,si._ReflectionTextureEnabled=!0,si._EmissiveTextureEnabled=!0,si._SpecularTextureEnabled=!0,si._BumpTextureEnabled=!0,si._LightmapTextureEnabled=!0,si._RefractionTextureEnabled=!0,si._ColorGradingTextureEnabled=!0,si._FresnelEnabled=!0,si._ClearCoatTextureEnabled=!0,si._ClearCoatBumpTextureEnabled=!0,si._ClearCoatTintTextureEnabled=!0,si._SheenTextureEnabled=!0,si._AnisotropicTextureEnabled=!0,si._ThicknessTextureEnabled=!0,si._RefractionIntensityTextureEnabled=!0,si._TranslucencyIntensityTextureEnabled=!0,si._TranslucencyColorTextureEnabled=!0,si._IridescenceTextureEnabled=!0;i(1335);class ni{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(e,t){this._defines[e]||(e<this._currentRank&&(this._currentRank=e),e>this._maxRank&&(this._maxRank=e),this._defines[e]=new Array),this._defines[e].push(t)}addCPUSkinningFallback(e,t){this._mesh=t,e<this._currentRank&&(this._currentRank=e),e>this._maxRank&&(this._maxRank=e)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(e,t){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,e=e.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),t._bonesComputationForcedToCPU=!0;const i=this._mesh.getScene();for(let e=0;e<i.meshes.length;e++){const r=i.meshes[e];if(r.material){if(r.computeBonesUsingShaders&&0!==r.numBoneInfluencers)if(r.material.getEffect()===t)r.computeBonesUsingShaders=!1;else if(r.subMeshes)for(const e of r.subMeshes){if(e.effect===t){r.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&r.computeBonesUsingShaders&&r.numBoneInfluencers>0&&(r.computeBonesUsingShaders=!1)}}else{const t=this._defines[this._currentRank];if(t)for(let i=0;i<t.length;i++)e=e.replace("#define "+t[i],"");this._currentRank++}return e}}class ai extends Ht{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class oi extends Zt{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(e,"PBRClearCoat",100,new ai,t),this._isEnabled=!1,this.isEnabled=!1,this.intensity=1,this.roughness=0,this._indexOfRefraction=oi._DefaultIndexOfRefraction,this.indexOfRefraction=oi._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=E.v9.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=e._dirtyCallbacks[1]}isReadyForSubMesh(e,t,i){if(!this._isEnabled)return!0;const r=this._material._disableBumpMap;if(e._areTexturesDirty&&t.texturesEnabled){if(this._texture&&si.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&si.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(i.getCaps().standardDerivatives&&this._bumpTexture&&si.ClearCoatBumpTextureEnabled&&!r&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&si.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(e,t){this._isEnabled?(e.CLEARCOAT=!0,e.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,e.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,e._areTexturesDirty&&t.texturesEnabled&&(this._texture&&si.ClearCoatTextureEnabled?me(this._texture,e,"CLEARCOAT_TEXTURE"):e.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&si.ClearCoatTextureEnabled?me(this._textureRoughness,e,"CLEARCOAT_TEXTURE_ROUGHNESS"):e.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&si.ClearCoatBumpTextureEnabled?me(this._bumpTexture,e,"CLEARCOAT_BUMP"):e.CLEARCOAT_BUMP=!1,e.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===oi._DefaultIndexOfRefraction,this._isTintEnabled?(e.CLEARCOAT_TINT=!0,this._tintTexture&&si.ClearCoatTintTextureEnabled?(me(this._tintTexture,e,"CLEARCOAT_TINT_TEXTURE"),e.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):e.CLEARCOAT_TINT_TEXTURE=!1):(e.CLEARCOAT_TINT=!1,e.CLEARCOAT_TINT_TEXTURE=!1))):(e.CLEARCOAT=!1,e.CLEARCOAT_TEXTURE=!1,e.CLEARCOAT_TEXTURE_ROUGHNESS=!1,e.CLEARCOAT_BUMP=!1,e.CLEARCOAT_TINT=!1,e.CLEARCOAT_TINT_TEXTURE=!1,e.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,e.CLEARCOAT_DEFAULTIOR=!1,e.CLEARCOAT_TEXTUREDIRECTUV=0,e.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,e.CLEARCOAT_BUMPDIRECTUV=0,e.CLEARCOAT_REMAP_F0=!1,e.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,e.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(e,t,i,r){if(!this._isEnabled)return;const s=r.materialDefines,n=this._material.isFrozen,a=this._material._disableBumpMap,o=this._material._invertNormalMapX,l=this._material._invertNormalMapY;if(!e.useUbo||!n||!e.isSync){(this._texture||this._textureRoughness)&&si.ClearCoatTextureEnabled&&(e.updateFloat4("vClearCoatInfos",this._texture?.coordinatesIndex??0,this._texture?.level??0,this._textureRoughness?.coordinatesIndex??0,this._textureRoughness?.level??0),this._texture&&be(this._texture,e,"clearCoat"),this._textureRoughness&&!s.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&be(this._textureRoughness,e,"clearCoatRoughness")),this._bumpTexture&&i.getCaps().standardDerivatives&&si.ClearCoatTextureEnabled&&!a&&(e.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),be(this._bumpTexture,e,"clearCoatBump"),t._mirroredCameraPosition?e.updateFloat2("vClearCoatTangentSpaceParams",o?1:-1,l?1:-1):e.updateFloat2("vClearCoatTangentSpaceParams",o?-1:1,l?-1:1)),this._tintTexture&&si.ClearCoatTintTextureEnabled&&(e.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),be(this._tintTexture,e,"clearCoatTint")),e.updateFloat2("vClearCoatParams",this.intensity,this.roughness);const r=1-this._indexOfRefraction,n=1+this._indexOfRefraction,h=Math.pow(-r/n,2),c=1/this._indexOfRefraction;e.updateFloat4("vClearCoatRefractionParams",h,c,r,n),this._isTintEnabled&&(e.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),e.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}t.texturesEnabled&&(this._texture&&si.ClearCoatTextureEnabled&&e.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!s.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&si.ClearCoatTextureEnabled&&e.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&i.getCaps().standardDerivatives&&si.ClearCoatBumpTextureEnabled&&!a&&e.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&si.ClearCoatTintTextureEnabled&&e.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(e){return this._texture===e||(this._textureRoughness===e||(this._bumpTexture===e||this._tintTexture===e))}getActiveTextures(e){this._texture&&e.push(this._texture),this._textureRoughness&&e.push(this._textureRoughness),this._bumpTexture&&e.push(this._bumpTexture),this._tintTexture&&e.push(this._tintTexture)}getAnimatables(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&e.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&e.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&e.push(this._tintTexture)}dispose(e){e&&(this._texture?.dispose(),this._textureRoughness?.dispose(),this._bumpTexture?.dispose(),this._tintTexture?.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(e,t,i){return e.CLEARCOAT_BUMP&&t.addFallback(i++,"CLEARCOAT_BUMP"),e.CLEARCOAT_TINT&&t.addFallback(i++,"CLEARCOAT_TINT"),e.CLEARCOAT&&t.addFallback(i++,"CLEARCOAT"),i}getSamplers(e){e.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}oi._DefaultIndexOfRefraction=1.5,(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],oi.prototype,"isEnabled",void 0),(0,s.Cg)([(0,n.lK)()],oi.prototype,"intensity",void 0),(0,s.Cg)([(0,n.lK)()],oi.prototype,"roughness",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],oi.prototype,"indexOfRefraction",void 0),(0,s.Cg)([(0,n.uM)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],oi.prototype,"texture",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],oi.prototype,"useRoughnessFromMainTexture",void 0),(0,s.Cg)([(0,n.uM)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],oi.prototype,"textureRoughness",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],oi.prototype,"remapF0OnInterfaceChange",void 0),(0,s.Cg)([(0,n.uM)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],oi.prototype,"bumpTexture",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],oi.prototype,"isTintEnabled",void 0),(0,s.Cg)([(0,n.jT)()],oi.prototype,"tintColor",void 0),(0,s.Cg)([(0,n.lK)()],oi.prototype,"tintColorAtDistance",void 0),(0,s.Cg)([(0,n.lK)()],oi.prototype,"tintThickness",void 0),(0,s.Cg)([(0,n.uM)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],oi.prototype,"tintTexture",void 0);class li extends Ht{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class hi extends Zt{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(e,"PBRIridescence",110,new li,t),this._isEnabled=!1,this.isEnabled=!1,this.intensity=1,this.minimumThickness=hi._DefaultMinimumThickness,this.maximumThickness=hi._DefaultMaximumThickness,this.indexOfRefraction=hi._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=e._dirtyCallbacks[1]}isReadyForSubMesh(e,t){if(!this._isEnabled)return!0;if(e._areTexturesDirty&&t.texturesEnabled){if(this._texture&&si.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&si.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(e,t){this._isEnabled?(e.IRIDESCENCE=!0,e._areTexturesDirty&&t.texturesEnabled&&(this._texture&&si.IridescenceTextureEnabled?me(this._texture,e,"IRIDESCENCE_TEXTURE"):e.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&si.IridescenceTextureEnabled?me(this._thicknessTexture,e,"IRIDESCENCE_THICKNESS_TEXTURE"):e.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(e.IRIDESCENCE=!1,e.IRIDESCENCE_TEXTURE=!1,e.IRIDESCENCE_THICKNESS_TEXTURE=!1,e.IRIDESCENCE_TEXTUREDIRECTUV=0,e.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(e,t){if(!this._isEnabled)return;const i=this._material.isFrozen;e.useUbo&&i&&e.isSync||((this._texture||this._thicknessTexture)&&si.IridescenceTextureEnabled&&(e.updateFloat4("vIridescenceInfos",this._texture?.coordinatesIndex??0,this._texture?.level??0,this._thicknessTexture?.coordinatesIndex??0,this._thicknessTexture?.level??0),this._texture&&be(this._texture,e,"iridescence"),this._thicknessTexture&&be(this._thicknessTexture,e,"iridescenceThickness")),e.updateFloat4("vIridescenceParams",this.intensity,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)),t.texturesEnabled&&(this._texture&&si.IridescenceTextureEnabled&&e.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&si.IridescenceTextureEnabled&&e.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(e){return this._texture===e||this._thicknessTexture===e}getActiveTextures(e){this._texture&&e.push(this._texture),this._thicknessTexture&&e.push(this._thicknessTexture)}getAnimatables(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&e.push(this._thicknessTexture)}dispose(e){e&&(this._texture?.dispose(),this._thicknessTexture?.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(e,t,i){return e.IRIDESCENCE&&t.addFallback(i++,"IRIDESCENCE"),i}getSamplers(e){e.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}hi._DefaultMinimumThickness=100,hi._DefaultMaximumThickness=400,hi._DefaultIndexOfRefraction=1.3,(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],hi.prototype,"isEnabled",void 0),(0,s.Cg)([(0,n.lK)()],hi.prototype,"intensity",void 0),(0,s.Cg)([(0,n.lK)()],hi.prototype,"minimumThickness",void 0),(0,s.Cg)([(0,n.lK)()],hi.prototype,"maximumThickness",void 0),(0,s.Cg)([(0,n.lK)()],hi.prototype,"indexOfRefraction",void 0),(0,s.Cg)([(0,n.uM)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],hi.prototype,"texture",void 0),(0,s.Cg)([(0,n.uM)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],hi.prototype,"thicknessTexture",void 0);class ci extends Ht{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class ui extends Zt{set angle(e){this.direction.x=Math.cos(e),this.direction.y=Math.sin(e)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(e,"PBRAnisotropic",110,new ci,t),this._isEnabled=!1,this.isEnabled=!1,this.intensity=1,this.direction=new o.I9(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=e._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=e._dirtyCallbacks[16]}isReadyForSubMesh(e,t){return!this._isEnabled||!(e._areTexturesDirty&&t.texturesEnabled&&this._texture&&si.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(e,t,i){this._isEnabled?(e.ANISOTROPIC=this._isEnabled,this._isEnabled&&!i.isVerticesDataPresent(S.R.TangentKind)&&(e._needUVs=!0,e.MAINUV1=!0),e._areTexturesDirty&&t.texturesEnabled&&(this._texture&&si.AnisotropicTextureEnabled?me(this._texture,e,"ANISOTROPIC_TEXTURE"):e.ANISOTROPIC_TEXTURE=!1),e._areMiscDirty&&(e.ANISOTROPIC_LEGACY=this._legacy)):(e.ANISOTROPIC=!1,e.ANISOTROPIC_TEXTURE=!1,e.ANISOTROPIC_TEXTUREDIRECTUV=0,e.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(e,t){if(!this._isEnabled)return;const i=this._material.isFrozen;e.useUbo&&i&&e.isSync||(this._texture&&si.AnisotropicTextureEnabled&&(e.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),be(this._texture,e,"anisotropy")),e.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.intensity)),t.texturesEnabled&&this._texture&&si.AnisotropicTextureEnabled&&e.setTexture("anisotropySampler",this._texture)}hasTexture(e){return this._texture===e}getActiveTextures(e){this._texture&&e.push(this._texture)}getAnimatables(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture)}dispose(e){e&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(e,t,i){return e.ANISOTROPIC&&t.addFallback(i++,"ANISOTROPIC"),i}getSamplers(e){e.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(e,t,i){super.parse(e,t,i),void 0===e.legacy&&(this.legacy=!0)}}(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],ui.prototype,"isEnabled",void 0),(0,s.Cg)([(0,n.lK)()],ui.prototype,"intensity",void 0),(0,s.Cg)([(0,n.WM)()],ui.prototype,"direction",void 0),(0,s.Cg)([(0,n.uM)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],ui.prototype,"texture",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsMiscDirty")],ui.prototype,"legacy",void 0);class di extends Ht{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class _i extends Zt{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(e,"Sheen",120,new di,t),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.intensity=1,this.color=E.v9.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=e._dirtyCallbacks[1]}isReadyForSubMesh(e,t){if(!this._isEnabled)return!0;if(e._areTexturesDirty&&t.texturesEnabled){if(this._texture&&si.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&si.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(e,t){this._isEnabled?(e.SHEEN=!0,e.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,e.SHEEN_ROUGHNESS=null!==this._roughness,e.SHEEN_ALBEDOSCALING=this._albedoScaling,e.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,e._areTexturesDirty&&t.texturesEnabled&&(this._texture&&si.SheenTextureEnabled?(me(this._texture,e,"SHEEN_TEXTURE"),e.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):e.SHEEN_TEXTURE=!1,this._textureRoughness&&si.SheenTextureEnabled?me(this._textureRoughness,e,"SHEEN_TEXTURE_ROUGHNESS"):e.SHEEN_TEXTURE_ROUGHNESS=!1)):(e.SHEEN=!1,e.SHEEN_TEXTURE=!1,e.SHEEN_TEXTURE_ROUGHNESS=!1,e.SHEEN_LINKWITHALBEDO=!1,e.SHEEN_ROUGHNESS=!1,e.SHEEN_ALBEDOSCALING=!1,e.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,e.SHEEN_GAMMATEXTURE=!1,e.SHEEN_TEXTUREDIRECTUV=0,e.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(e,t,i,r){if(!this._isEnabled)return;const s=r.materialDefines,n=this._material.isFrozen;e.useUbo&&n&&e.isSync||((this._texture||this._textureRoughness)&&si.SheenTextureEnabled&&(e.updateFloat4("vSheenInfos",this._texture?.coordinatesIndex??0,this._texture?.level??0,this._textureRoughness?.coordinatesIndex??0,this._textureRoughness?.level??0),this._texture&&be(this._texture,e,"sheen"),this._textureRoughness&&!s.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&be(this._textureRoughness,e,"sheenRoughness")),e.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.intensity),null!==this._roughness&&e.updateFloat("vSheenRoughness",this._roughness)),t.texturesEnabled&&(this._texture&&si.SheenTextureEnabled&&e.setTexture("sheenSampler",this._texture),this._textureRoughness&&!s.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&si.SheenTextureEnabled&&e.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(e){return this._texture===e||this._textureRoughness===e}getActiveTextures(e){this._texture&&e.push(this._texture),this._textureRoughness&&e.push(this._textureRoughness)}getAnimatables(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&e.push(this._textureRoughness)}dispose(e){e&&(this._texture?.dispose(),this._textureRoughness?.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(e,t,i){return e.SHEEN&&t.addFallback(i++,"SHEEN"),i}getSamplers(e){e.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],_i.prototype,"isEnabled",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],_i.prototype,"linkSheenWithAlbedo",void 0),(0,s.Cg)([(0,n.lK)()],_i.prototype,"intensity",void 0),(0,s.Cg)([(0,n.jT)()],_i.prototype,"color",void 0),(0,s.Cg)([(0,n.uM)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],_i.prototype,"texture",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],_i.prototype,"useRoughnessFromMainTexture",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],_i.prototype,"roughness",void 0),(0,s.Cg)([(0,n.uM)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],_i.prototype,"textureRoughness",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],_i.prototype,"albedoScaling",void 0);class pi extends Ht{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1}}class fi extends Zt{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(e){this._scene.enableSubSurfaceForPrePass()&&e&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(e))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(e){this._volumeIndexOfRefraction=e>=1?e:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(e,"PBRSubSurface",130,new pi,t),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=E.v9.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=E.v9.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this._scene=e.getScene(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=e._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=e._dirtyCallbacks[32]}isReadyForSubMesh(e,t){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(e._areTexturesDirty&&t.texturesEnabled){if(this._thicknessTexture&&si.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&si.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&si.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const e=this._getRefractionTexture(t);if(e&&si.RefractionTextureEnabled&&!e.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(e,t){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return e.SUBSURFACE=!1,e.SS_DISPERSION=!1,e.SS_TRANSLUCENCY=!1,e.SS_SCATTERING=!1,e.SS_REFRACTION=!1,e.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,e.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,e.SS_THICKNESSANDMASK_TEXTURE=!1,e.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,e.SS_HAS_THICKNESS=!1,e.SS_REFRACTIONINTENSITY_TEXTURE=!1,e.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,e.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,e.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,e.SS_REFRACTIONMAP_3D=!1,e.SS_REFRACTIONMAP_OPPOSITEZ=!1,e.SS_LODINREFRACTIONALPHA=!1,e.SS_GAMMAREFRACTION=!1,e.SS_RGBDREFRACTION=!1,e.SS_LINEARSPECULARREFRACTION=!1,e.SS_LINKREFRACTIONTOTRANSPARENCY=!1,e.SS_ALBEDOFORREFRACTIONTINT=!1,e.SS_ALBEDOFORTRANSLUCENCYTINT=!1,e.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,e.SS_USE_THICKNESS_AS_DEPTH=!1,e.SS_USE_GLTF_TEXTURES=!1,e.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,void(e.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0);if(e._areTexturesDirty){if(e.SUBSURFACE=!0,e.SS_DISPERSION=this._isDispersionEnabled,e.SS_TRANSLUCENCY=this._isTranslucencyEnabled,e.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,e.SS_SCATTERING=this._isScatteringEnabled,e.SS_THICKNESSANDMASK_TEXTURE=!1,e.SS_REFRACTIONINTENSITY_TEXTURE=!1,e.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,e.SS_HAS_THICKNESS=!1,e.SS_USE_GLTF_TEXTURES=!1,e.SS_REFRACTION=!1,e.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,e.SS_REFRACTIONMAP_3D=!1,e.SS_GAMMAREFRACTION=!1,e.SS_RGBDREFRACTION=!1,e.SS_LINEARSPECULARREFRACTION=!1,e.SS_REFRACTIONMAP_OPPOSITEZ=!1,e.SS_LODINREFRACTIONALPHA=!1,e.SS_LINKREFRACTIONTOTRANSPARENCY=!1,e.SS_ALBEDOFORREFRACTIONTINT=!1,e.SS_ALBEDOFORTRANSLUCENCYTINT=!1,e.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,e.SS_USE_THICKNESS_AS_DEPTH=!1,e.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,e._areTexturesDirty&&t.texturesEnabled&&(this._thicknessTexture&&si.ThicknessTextureEnabled&&me(this._thicknessTexture,e,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&si.RefractionIntensityTextureEnabled&&me(this._refractionIntensityTexture,e,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&si.TranslucencyIntensityTextureEnabled&&me(this._translucencyIntensityTexture,e,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&si.TranslucencyColorTextureEnabled&&me(this._translucencyColorTexture,e,"SS_TRANSLUCENCYCOLOR_TEXTURE")),e.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,e.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,e.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,e.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&t.texturesEnabled){const i=this._getRefractionTexture(t);i&&si.RefractionTextureEnabled&&(e.SS_REFRACTION=!0,e.SS_REFRACTIONMAP_3D=i.isCube,e.SS_GAMMAREFRACTION=i.gammaSpace,e.SS_RGBDREFRACTION=i.isRGBD,e.SS_LINEARSPECULARREFRACTION=i.linearSpecularLOD,e.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&i.isCube?!i.invertZ:i.invertZ,e.SS_LODINREFRACTIONALPHA=i.lodLevelInAlpha,e.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,e.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,e.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=i.isCube&&i.boundingBoxSize,e.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(e.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(e,t,i,r){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)e.updateFloat2("vThicknessParam",0,0);else{r.getRenderingMesh().getWorldMatrix().decompose(o.AA.Vector3[0]);const t=Math.max(Math.abs(o.AA.Vector3[0].x),Math.abs(o.AA.Vector3[0].y),Math.abs(o.AA.Vector3[0].z));e.updateFloat2("vThicknessParam",this.minimumThickness*t,(this.maximumThickness-this.minimumThickness)*t)}}bindForSubMesh(e,t,i,r){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const s=r.materialDefines,n=this._material.isFrozen,a=this._material.realTimeFiltering,o=s.LODBASEDMICROSFURACE,l=this._getRefractionTexture(t);if(!e.useUbo||!n||!e.isSync){if(this._thicknessTexture&&si.ThicknessTextureEnabled&&(e.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),be(this._thicknessTexture,e,"thickness")),this._refractionIntensityTexture&&si.RefractionIntensityTextureEnabled&&s.SS_REFRACTIONINTENSITY_TEXTURE&&(e.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),be(this._refractionIntensityTexture,e,"refractionIntensity")),this._translucencyColorTexture&&si.TranslucencyColorTextureEnabled&&s.SS_TRANSLUCENCYCOLOR_TEXTURE&&(e.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),be(this._translucencyColorTexture,e,"translucencyColor")),this._translucencyIntensityTexture&&si.TranslucencyIntensityTextureEnabled&&s.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(e.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),be(this._translucencyIntensityTexture,e,"translucencyIntensity")),l&&si.RefractionTextureEnabled){e.updateMatrix("refractionMatrix",l.getRefractionTextureMatrix());let t=1;l.isCube||l.depth&&(t=l.depth);const i=l.getSize().width,r=this.volumeIndexOfRefraction;if(e.updateFloat4("vRefractionInfos",l.level,1/r,t,this._invertRefractionY?-1:1),e.updateFloat4("vRefractionMicrosurfaceInfos",i,l.lodGenerationScale,l.lodGenerationOffset,1/this.indexOfRefraction),a&&e.updateFloat2("vRefractionFilteringInfo",i,tt.X.Log2(i)),l.boundingBoxSize){const t=l;e.updateVector3("vRefractionPosition",t.boundingBoxPosition),e.updateVector3("vRefractionSize",t.boundingBoxSize)}}this._isScatteringEnabled&&e.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),e.updateColor3("vDiffusionDistance",this.diffusionDistance),e.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),e.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),e.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),e.updateFloat("dispersion",this.dispersion)}t.texturesEnabled&&(this._thicknessTexture&&si.ThicknessTextureEnabled&&e.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&si.RefractionIntensityTextureEnabled&&s.SS_REFRACTIONINTENSITY_TEXTURE&&e.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&si.TranslucencyIntensityTextureEnabled&&s.SS_TRANSLUCENCYINTENSITY_TEXTURE&&e.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&si.TranslucencyColorTextureEnabled&&s.SS_TRANSLUCENCYCOLOR_TEXTURE&&e.setTexture("translucencyColorSampler",this._translucencyColorTexture),l&&si.RefractionTextureEnabled&&(o?e.setTexture("refractionSampler",l):(e.setTexture("refractionSampler",l._lodTextureMid||l),e.setTexture("refractionSamplerLow",l._lodTextureLow||l),e.setTexture("refractionSamplerHigh",l._lodTextureHigh||l))))}_getRefractionTexture(e){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?e.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(e){si.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&e.push(this._refractionTexture)}hasTexture(e){return this._thicknessTexture===e||(this._refractionTexture===e||(this._refractionIntensityTexture===e||(this._translucencyIntensityTexture===e||this._translucencyColorTexture===e)))}hasRenderTargetTextures(){return!!(si.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(e){this._thicknessTexture&&e.push(this._thicknessTexture),this._refractionTexture&&e.push(this._refractionTexture),this._translucencyColorTexture&&e.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&e.push(this._translucencyIntensityTexture)}getAnimatables(e){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&e.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&e.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&e.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&e.push(this._translucencyIntensityTexture)}dispose(e){e&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(e,t,i){return e.SS_SCATTERING&&t.addFallback(i++,"SS_SCATTERING"),e.SS_TRANSLUCENCY&&t.addFallback(i++,"SS_TRANSLUCENCY"),i}getSamplers(e){e.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],fi.prototype,"isRefractionEnabled",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],fi.prototype,"isTranslucencyEnabled",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],fi.prototype,"isDispersionEnabled",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markScenePrePassDirty")],fi.prototype,"isScatteringEnabled",void 0),(0,s.Cg)([(0,n.lK)()],fi.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,s.Cg)([(0,n.lK)()],fi.prototype,"refractionIntensity",void 0),(0,s.Cg)([(0,n.lK)()],fi.prototype,"translucencyIntensity",void 0),(0,s.Cg)([(0,n.lK)()],fi.prototype,"useAlbedoToTintRefraction",void 0),(0,s.Cg)([(0,n.lK)()],fi.prototype,"useAlbedoToTintTranslucency",void 0),(0,s.Cg)([(0,n.uM)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],fi.prototype,"thicknessTexture",void 0),(0,s.Cg)([(0,n.uM)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],fi.prototype,"refractionTexture",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],fi.prototype,"indexOfRefraction",void 0),(0,s.Cg)([(0,n.lK)()],fi.prototype,"_volumeIndexOfRefraction",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],fi.prototype,"volumeIndexOfRefraction",null),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],fi.prototype,"invertRefractionY",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],fi.prototype,"linkRefractionWithTransparency",void 0),(0,s.Cg)([(0,n.lK)()],fi.prototype,"minimumThickness",void 0),(0,s.Cg)([(0,n.lK)()],fi.prototype,"maximumThickness",void 0),(0,s.Cg)([(0,n.lK)()],fi.prototype,"useThicknessAsDepth",void 0),(0,s.Cg)([(0,n.jT)()],fi.prototype,"tintColor",void 0),(0,s.Cg)([(0,n.lK)()],fi.prototype,"tintColorAtDistance",void 0),(0,s.Cg)([(0,n.lK)()],fi.prototype,"dispersion",void 0),(0,s.Cg)([(0,n.jT)()],fi.prototype,"diffusionDistance",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],fi.prototype,"useMaskFromThicknessTexture",void 0),(0,s.Cg)([(0,n.uM)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],fi.prototype,"refractionIntensityTexture",void 0),(0,s.Cg)([(0,n.uM)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],fi.prototype,"translucencyIntensityTexture",void 0),(0,s.Cg)([(0,n.jT)()],fi.prototype,"translucencyColor",void 0),(0,s.Cg)([(0,n.uM)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],fi.prototype,"translucencyColorTexture",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],fi.prototype,"useGltfStyleTextures",void 0);class gi extends Ht{constructor(){super(...arguments),this.DETAIL=!1,this.DETAILDIRECTUV=0,this.DETAIL_NORMALBLENDMETHOD=0}}class mi extends Zt{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(e,"DetailMap",140,new gi,t),this._texture=null,this.diffuseBlendLevel=1,this.roughnessBlendLevel=1,this.bumpLevel=1,this._normalBlendMethod=Ne.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,this._isEnabled=!1,this.isEnabled=!1,this._internalMarkAllSubMeshesAsTexturesDirty=e._dirtyCallbacks[1]}isReadyForSubMesh(e,t,i){return!this._isEnabled||!(e._areTexturesDirty&&t.texturesEnabled&&i.getCaps().standardDerivatives&&this._texture&&si.DetailTextureEnabled&&!this._texture.isReady())}prepareDefines(e,t){if(this._isEnabled){e.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;const i=t.getEngine();e._areTexturesDirty&&(i.getCaps().standardDerivatives&&this._texture&&si.DetailTextureEnabled&&this._isEnabled?(me(this._texture,e,"DETAIL"),e.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):e.DETAIL=!1)}else e.DETAIL=!1}bindForSubMesh(e,t){if(!this._isEnabled)return;const i=this._material.isFrozen;e.useUbo&&i&&e.isSync||this._texture&&si.DetailTextureEnabled&&(e.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),be(this._texture,e,"detail")),t.texturesEnabled&&this._texture&&si.DetailTextureEnabled&&e.setTexture("detailSampler",this._texture)}hasTexture(e){return this._texture===e}getActiveTextures(e){this._texture&&e.push(this._texture)}getAnimatables(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture)}dispose(e){e&&this._texture?.dispose()}getClassName(){return"DetailMapConfiguration"}getSamplers(e){e.push("detailSampler")}getUniforms(){return{ubo:[{name:"vDetailInfos",size:4,type:"vec4"},{name:"detailMatrix",size:16,type:"mat4"}]}}}(0,s.Cg)([(0,n.uM)("detailTexture"),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],mi.prototype,"texture",void 0),(0,s.Cg)([(0,n.lK)()],mi.prototype,"diffuseBlendLevel",void 0),(0,s.Cg)([(0,n.lK)()],mi.prototype,"roughnessBlendLevel",void 0),(0,s.Cg)([(0,n.lK)()],mi.prototype,"bumpLevel",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],mi.prototype,"normalBlendMethod",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],mi.prototype,"isEnabled",void 0);const bi={effect:null,subMesh:null};class vi extends Ht{constructor(e){super(e),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_NDC_DEPTH=!1,this.PREPASS_NDC_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class yi extends ri{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(e){this._realTimeFiltering=e,this.markAsDirty(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(e){this._realTimeFilteringQuality=e,this.markAsDirty(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(e){e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(e,t),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new o.IU(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=yi.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=E.v9.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new E.v9(0,0,0),this._albedoColor=new E.v9(1,1,1),this._reflectivityColor=new E.v9(1,1,1),this._reflectionColor=new E.v9(1,1,1),this._emissiveColor=new E.v9(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=yi.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._forceAlphaTest=!1,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new y.L(16),this._globalAmbientColor=new E.v9(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1;const r=this.getScene().getEngine();!r.isWebGPU||i||yi.ForceGLSL||(this._uniformBuffer&&this._uniformBuffer.dispose(),this._uniformBuffer=new $.D(r,void 0,void 0,this.name,!0),this._shaderLanguage=1),this.brdf=new ei(this),this.clearCoat=new oi(this),this.iridescence=new hi(this),this.anisotropy=new ui(this),this.sheen=new _i(this),this.subSurface=new fi(this),this.detailMap=new mi(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),si.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=zt(this.getScene()),this.prePassConfiguration=new ti}get hasRenderTargetTextures(){return!!(si.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){return this._transparencyMode===yi.PBRMATERIAL_OPAQUE||this._transparencyMode===yi.PBRMATERIAL_ALPHATEST||this.subSurface?.disableAlphaBlending}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){return!!this._forceAlphaTest||!this.subSurface?.disableAlphaBlending&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===yi.PBRMATERIAL_ALPHATEST))}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.hasAlpha&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==yi.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.hasAlpha||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(e,t,i){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const r=t._drawWrapper;if(r.effect&&this.isFrozen&&r._wasPreviouslyReady&&r._wasPreviouslyUsingInstances===i)return!0;t.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),t.materialDefines=new vi(this._eventInfo.defineNames));const s=t.materialDefines;if(this._isReadyForSubMesh(t))return!0;const n=this.getScene(),a=n.getEngine();if(s._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,n.texturesEnabled)){if(this._albedoTexture&&si.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&si.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&si.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const e=this._getReflectionTexture();if(e&&si.ReflectionTextureEnabled){if(!e.isReadyOrNotBlocking())return!1;if(e.irradianceTexture){if(!e.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!e.sphericalPolynomial&&e.getInternalTexture()?._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&si.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&si.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(si.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(a.getCaps().standardDerivatives&&this._bumpTexture&&si.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&si.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=s,this._eventInfo.subMesh=t,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(s._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;a.getCaps().standardDerivatives||e.isVerticesDataPresent(S.R.NormalKind)||(e.createNormals(!0),T.V.Warn("PBRMaterial: Normals have been created for the mesh: "+e.name));const o=t.effect,l=s._areLightsDisposed;let h=this._prepareEffect(e,s,this.onCompiled,this.onError,i,null,t.getRenderingMesh().hasThinInstances),c=!1;if(h)if(this._onEffectCreatedObservable&&(bi.effect=h,bi.subMesh=t,this._onEffectCreatedObservable.notifyObservers(bi)),this.allowShaderHotSwapping&&o&&!h.isReady()){if(h=o,s.markAsUnprocessed(),c=this.isFrozen,l)return s._areLightsDisposed=!0,!1}else n.resetCachedMaterial(),t.setEffect(h,s,this._materialContext);return!(!t.effect||!t.effect.isReady())&&(s._renderId=n.getRenderId(),r._wasPreviouslyReady=!c,r._wasPreviouslyUsingInstances=!!i,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6?arguments[6]:void 0;if(this._prepareDefines(e,t,n,a,o),!t.isDirty)return null;t.markAsProcessed();const l=this.getScene().getEngine(),h=new ni;let c=0;t.USESPHERICALINVERTEX&&h.addFallback(c++,"USESPHERICALINVERTEX"),t.FOG&&h.addFallback(c,"FOG"),t.SPECULARAA&&h.addFallback(c,"SPECULARAA"),t.POINTSIZE&&h.addFallback(c,"POINTSIZE"),t.LOGARITHMICDEPTH&&h.addFallback(c,"LOGARITHMICDEPTH"),t.PARALLAX&&h.addFallback(c,"PARALLAX"),t.PARALLAX_RHS&&h.addFallback(c,"PARALLAX_RHS"),t.PARALLAXOCCLUSION&&h.addFallback(c++,"PARALLAXOCCLUSION"),t.ENVIRONMENTBRDF&&h.addFallback(c++,"ENVIRONMENTBRDF"),t.TANGENT&&h.addFallback(c++,"TANGENT"),t.BUMP&&h.addFallback(c++,"BUMP"),c=Re(t,h,this._maxSimultaneousLights,c++),t.SPECULARTERM&&h.addFallback(c++,"SPECULARTERM"),t.USESPHERICALFROMREFLECTIONMAP&&h.addFallback(c++,"USESPHERICALFROMREFLECTIONMAP"),t.USEIRRADIANCEMAP&&h.addFallback(c++,"USEIRRADIANCEMAP"),t.LIGHTMAP&&h.addFallback(c++,"LIGHTMAP"),t.NORMAL&&h.addFallback(c++,"NORMAL"),t.AMBIENT&&h.addFallback(c++,"AMBIENT"),t.EMISSIVE&&h.addFallback(c++,"EMISSIVE"),t.VERTEXCOLOR&&h.addFallback(c++,"VERTEXCOLOR"),t.MORPHTARGETS&&h.addFallback(c++,"MORPHTARGETS"),t.MULTIVIEW&&h.addFallback(0,"MULTIVIEW");const u=[S.R.PositionKind];t.NORMAL&&u.push(S.R.NormalKind),t.TANGENT&&u.push(S.R.TangentKind);for(let i=1;i<=6;++i)t["UV"+i]&&u.push(`uv${1===i?"":i}`);t.VERTEXCOLOR&&u.push(S.R.ColorKind),Ae(u,e,t,h),Ce(u,t),_e(u,e,t),ve(u,0,t);let d="pbr";const _=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices"],p=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],f=["Material","Scene","Mesh"],g={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:t.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=h,this._eventInfo.fallbackRank=c,this._eventInfo.defines=t,this._eventInfo.uniforms=_,this._eventInfo.attributes=u,this._eventInfo.samplers=p,this._eventInfo.uniformBuffersNames=f,this._eventInfo.customCode=void 0,this._eventInfo.mesh=e,this._eventInfo.indexParameters=g,this._callbackPluginEventGeneric(128,this._eventInfo),ti.AddUniforms(_),ti.AddSamplers(p),oe(_),ii.p&&(ii.p.PrepareUniforms(_,t),ii.p.PrepareSamplers(p,t)),Be({uniformsNames:_,uniformBuffersNames:f,samplers:p,defines:t,maxSimultaneousLights:this._maxSimultaneousLights});const m={};this.customShaderNameResolve&&(d=this.customShaderNameResolve(d,_,f,p,t,u,m));const b=t.toString(),v=l.createEffect(d,{attributes:u,uniformsNames:_,uniformBuffersNames:f,samplers:p,defines:b,fallbacks:h,onCompiled:r,onError:s,indexParameters:g,processFinalCode:m.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:t.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([i.e(835),i.e(955)]).then(i.bind(i,2955)),Promise.all([i.e(72),i.e(114)]).then(i.bind(i,114))]):await Promise.all([Promise.all([i.e(176),i.e(916)]).then(i.bind(i,5916)),Promise.all([i.e(680),i.e(541)]).then(i.bind(i,4541))]),this._shadersLoaded=!0}},l);return this._eventInfo.customCode=void 0,v}_prepareDefines(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const n=this.getScene(),a=n.getEngine();Se(n,e,t,!0,this._maxSimultaneousLights,this._disableLighting),t._needNormals=!0,Oe(n,t);const o=this.needAlphaBlendingForMesh(e)&&this.getScene().useOrderIndependentTransparency;if(we(n,t,this.canRenderToMRT&&!o),De(n,t,o),t.METALLICWORKFLOW=this.isMetallicWorkflow(),t._areTexturesDirty){t._needUVs=!1;for(let e=1;e<=6;++e)t["MAINUV"+e]=!1;if(n.texturesEnabled){t.ALBEDODIRECTUV=0,t.AMBIENTDIRECTUV=0,t.OPACITYDIRECTUV=0,t.EMISSIVEDIRECTUV=0,t.REFLECTIVITYDIRECTUV=0,t.MICROSURFACEMAPDIRECTUV=0,t.METALLIC_REFLECTANCEDIRECTUV=0,t.REFLECTANCEDIRECTUV=0,t.BUMPDIRECTUV=0,t.LIGHTMAPDIRECTUV=0,a.getCaps().textureLOD&&(t.LODBASEDMICROSFURACE=!0),this._albedoTexture&&si.DiffuseTextureEnabled?(me(this._albedoTexture,t,"ALBEDO"),t.GAMMAALBEDO=this._albedoTexture.gammaSpace):t.ALBEDO=!1,this._ambientTexture&&si.AmbientTextureEnabled?(me(this._ambientTexture,t,"AMBIENT"),t.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):t.AMBIENT=!1,this._opacityTexture&&si.OpacityTextureEnabled?(me(this._opacityTexture,t,"OPACITY"),t.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):t.OPACITY=!1;const e=this._getReflectionTexture();if(e&&si.ReflectionTextureEnabled){switch(t.REFLECTION=!0,t.GAMMAREFLECTION=e.gammaSpace,t.RGBDREFLECTION=e.isRGBD,t.LODINREFLECTIONALPHA=e.lodLevelInAlpha,t.LINEARSPECULARREFLECTION=e.linearSpecularLOD,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(t.NUM_SAMPLES=""+this.realTimeFilteringQuality,a._features.needTypeSuffixInShaderConstants&&(t.NUM_SAMPLES=t.NUM_SAMPLES+"u"),t.REALTIME_FILTERING=!0):t.REALTIME_FILTERING=!1,t.INVERTCUBICMAP=e.coordinatesMode===kt.g.INVCUBIC_MODE,t.REFLECTIONMAP_3D=e.isCube,t.REFLECTIONMAP_OPPOSITEZ=t.REFLECTIONMAP_3D&&this.getScene().useRightHandedSystem?!e.invertZ:e.invertZ,t.REFLECTIONMAP_CUBIC=!1,t.REFLECTIONMAP_EXPLICIT=!1,t.REFLECTIONMAP_PLANAR=!1,t.REFLECTIONMAP_PROJECTION=!1,t.REFLECTIONMAP_SKYBOX=!1,t.REFLECTIONMAP_SPHERICAL=!1,t.REFLECTIONMAP_EQUIRECTANGULAR=!1,t.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,t.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,e.coordinatesMode){case kt.g.EXPLICIT_MODE:t.REFLECTIONMAP_EXPLICIT=!0;break;case kt.g.PLANAR_MODE:t.REFLECTIONMAP_PLANAR=!0;break;case kt.g.PROJECTION_MODE:t.REFLECTIONMAP_PROJECTION=!0;break;case kt.g.SKYBOX_MODE:t.REFLECTIONMAP_SKYBOX=!0;break;case kt.g.SPHERICAL_MODE:t.REFLECTIONMAP_SPHERICAL=!0;break;case kt.g.EQUIRECTANGULAR_MODE:t.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case kt.g.FIXED_EQUIRECTANGULAR_MODE:t.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case kt.g.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:t.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case kt.g.CUBIC_MODE:case kt.g.INVCUBIC_MODE:default:t.REFLECTIONMAP_CUBIC=!0,t.USE_LOCAL_REFLECTIONMAP_CUBIC=!!e.boundingBoxSize}e.coordinatesMode!==kt.g.SKYBOX_MODE&&(e.irradianceTexture?(t.USEIRRADIANCEMAP=!0,t.USESPHERICALFROMREFLECTIONMAP=!1):e.isCube&&(t.USESPHERICALFROMREFLECTIONMAP=!0,t.USEIRRADIANCEMAP=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||a.getCaps().maxVaryingVectors<=8?t.USESPHERICALINVERTEX=!1:t.USESPHERICALINVERTEX=!0))}else t.REFLECTION=!1,t.REFLECTIONMAP_3D=!1,t.REFLECTIONMAP_SPHERICAL=!1,t.REFLECTIONMAP_PLANAR=!1,t.REFLECTIONMAP_CUBIC=!1,t.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,t.REFLECTIONMAP_PROJECTION=!1,t.REFLECTIONMAP_SKYBOX=!1,t.REFLECTIONMAP_EXPLICIT=!1,t.REFLECTIONMAP_EQUIRECTANGULAR=!1,t.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,t.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,t.INVERTCUBICMAP=!1,t.USESPHERICALFROMREFLECTIONMAP=!1,t.USEIRRADIANCEMAP=!1,t.USESPHERICALINVERTEX=!1,t.REFLECTIONMAP_OPPOSITEZ=!1,t.LODINREFLECTIONALPHA=!1,t.GAMMAREFLECTION=!1,t.RGBDREFLECTION=!1,t.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&si.LightmapTextureEnabled?(me(this._lightmapTexture,t,"LIGHTMAP"),t.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,t.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,t.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):t.LIGHTMAP=!1,this._emissiveTexture&&si.EmissiveTextureEnabled?(me(this._emissiveTexture,t,"EMISSIVE"),t.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):t.EMISSIVE=!1,si.SpecularTextureEnabled?(this._metallicTexture?(me(this._metallicTexture,t,"REFLECTIVITY"),t.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,t.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,t.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,t.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,t.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?(me(this._reflectivityTexture,t,"REFLECTIVITY"),t.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,t.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,t.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):t.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(t.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?(me(this._metallicReflectanceTexture,t,"METALLIC_REFLECTANCE"),t.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):t.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?(me(this._reflectanceTexture,t,"REFLECTANCE"),t.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):t.REFLECTANCE=!1):(t.METALLIC_REFLECTANCE=!1,t.REFLECTANCE=!1),this._microSurfaceTexture?me(this._microSurfaceTexture,t,"MICROSURFACEMAP"):t.MICROSURFACEMAP=!1):(t.REFLECTIVITY=!1,t.MICROSURFACEMAP=!1),a.getCaps().standardDerivatives&&this._bumpTexture&&si.BumpTextureEnabled&&!this._disableBumpMap?(me(this._bumpTexture,t,"BUMP"),this._useParallax&&this._albedoTexture&&si.DiffuseTextureEnabled?(t.PARALLAX=!0,t.PARALLAX_RHS=n.useRightHandedSystem,t.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):t.PARALLAX=!1,t.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(t.BUMP=!1,t.PARALLAX=!1,t.PARALLAX_RHS=!1,t.PARALLAXOCCLUSION=!1,t.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&si.ReflectionTextureEnabled?(t.ENVIRONMENTBRDF=!0,t.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(t.ENVIRONMENTBRDF=!1,t.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?t.ALPHAFROMALBEDO=!0:t.ALPHAFROMALBEDO=!1}t.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===yi.LIGHTFALLOFF_STANDARD?(t.USEPHYSICALLIGHTFALLOFF=!1,t.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===yi.LIGHTFALLOFF_GLTF?(t.USEPHYSICALLIGHTFALLOFF=!1,t.USEGLTFLIGHTFALLOFF=!0):(t.USEPHYSICALLIGHTFALLOFF=!0,t.USEGLTFLIGHTFALLOFF=!1),t.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.backFaceCulling&&this._twoSidedLighting?t.TWOSIDEDLIGHTING=!0:t.TWOSIDEDLIGHTING=!1,t.SPECULARAA=a.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(t._areTexturesDirty||t._areMiscDirty)&&(t.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,t.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,t.ALPHABLEND=this.needAlphaBlendingForMesh(e),t.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,t.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),t._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(t),t.FORCENORMALFORWARD=this._forceNormalForward,t.RADIANCEOCCLUSION=this._useRadianceOcclusion,t.HORIZONOCCLUSION=this._useHorizonOcclusion,t._areMiscDirty&&(Ee(e,n,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e)||this._forceAlphaTest,t,this._applyDecalMapAfterDetailMap),t.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!e.isVerticesDataPresent(S.R.NormalKind),t.DEBUGMODE=this._debugMode),Pe(n,a,this,t,!!i,r,s),this._eventInfo.defines=t,this._eventInfo.mesh=e,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),Ie(e,t,!0,!0,!0,this._transparencyMode!==yi.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(e,t,i){const r={clipPlane:!1,useInstances:!1,...i};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);(()=>{if(this._breakShaderLoadedCheck)return;const i=new vi(this._eventInfo.defineNames),s=this._prepareEffect(e,i,void 0,void 0,r.useInstances,r.clipPlane,e.hasThinInstances);this._onEffectCreatedObservable&&(bi.effect=s,bi.subMesh=null,this._onEffectCreatedObservable.notifyObservers(bi)),s.isReady()?t&&t(this):s.onCompileObservable.add((()=>{t&&t(this)}))})()}buildUniformLayout(){const e=this._uniformBuffer;e.addUniform("vAlbedoInfos",2),e.addUniform("vAmbientInfos",4),e.addUniform("vOpacityInfos",2),e.addUniform("vEmissiveInfos",2),e.addUniform("vLightmapInfos",2),e.addUniform("vReflectivityInfos",3),e.addUniform("vMicroSurfaceSamplerInfos",2),e.addUniform("vReflectionInfos",2),e.addUniform("vReflectionFilteringInfo",2),e.addUniform("vReflectionPosition",3),e.addUniform("vReflectionSize",3),e.addUniform("vBumpInfos",3),e.addUniform("albedoMatrix",16),e.addUniform("ambientMatrix",16),e.addUniform("opacityMatrix",16),e.addUniform("emissiveMatrix",16),e.addUniform("lightmapMatrix",16),e.addUniform("reflectivityMatrix",16),e.addUniform("microSurfaceSamplerMatrix",16),e.addUniform("bumpMatrix",16),e.addUniform("vTangentSpaceParams",2),e.addUniform("reflectionMatrix",16),e.addUniform("vReflectionColor",3),e.addUniform("vAlbedoColor",4),e.addUniform("vLightingIntensity",4),e.addUniform("vReflectionMicrosurfaceInfos",3),e.addUniform("pointSize",1),e.addUniform("vReflectivityColor",4),e.addUniform("vEmissiveColor",3),e.addUniform("vAmbientColor",3),e.addUniform("vDebugMode",2),e.addUniform("vMetallicReflectanceFactors",4),e.addUniform("vMetallicReflectanceInfos",2),e.addUniform("metallicReflectanceMatrix",16),e.addUniform("vReflectanceInfos",2),e.addUniform("reflectanceMatrix",16),e.addUniform("vSphericalL00",3),e.addUniform("vSphericalL1_1",3),e.addUniform("vSphericalL10",3),e.addUniform("vSphericalL11",3),e.addUniform("vSphericalL2_2",3),e.addUniform("vSphericalL2_1",3),e.addUniform("vSphericalL20",3),e.addUniform("vSphericalL21",3),e.addUniform("vSphericalL22",3),e.addUniform("vSphericalX",3),e.addUniform("vSphericalY",3),e.addUniform("vSphericalZ",3),e.addUniform("vSphericalXX_ZZ",3),e.addUniform("vSphericalYY_ZZ",3),e.addUniform("vSphericalZZ",3),e.addUniform("vSphericalXY",3),e.addUniform("vSphericalYZ",3),e.addUniform("vSphericalZX",3),super.buildUniformLayout()}bindForSubMesh(e,t,i){const r=this.getScene(),s=i.materialDefines;if(!s)return;const n=i.effect;if(!n)return;this._activeEffect=n,t.getMeshUniformBuffer().bindToEffect(n,"Mesh"),t.transferToEffect(e);const a=r.getEngine();this._uniformBuffer.bindToEffect(n,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,r,t,e,this.isFrozen),this._eventInfo.subMesh=i,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),s.OBJECTSPACE_NORMALMAP&&(e.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const o=this._mustRebind(r,n,i,t.visibility);ye(t,this._activeEffect,this.prePassConfiguration);let l=null;const h=this._uniformBuffer;if(o){if(this.bindViewProjection(n),l=this._getReflectionTexture(),!h.useUbo||!this.isFrozen||!h.isSync||i._drawWrapper._forceRebindOnNextCall){if(r.texturesEnabled){if(this._albedoTexture&&si.DiffuseTextureEnabled&&(h.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),be(this._albedoTexture,h,"albedo")),this._ambientTexture&&si.AmbientTextureEnabled&&(h.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),be(this._ambientTexture,h,"ambient")),this._opacityTexture&&si.OpacityTextureEnabled&&(h.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),be(this._opacityTexture,h,"opacity")),l&&si.ReflectionTextureEnabled){if(h.updateMatrix("reflectionMatrix",l.getReflectionTextureMatrix()),h.updateFloat2("vReflectionInfos",l.level,0),l.boundingBoxSize){const e=l;h.updateVector3("vReflectionPosition",e.boundingBoxPosition),h.updateVector3("vReflectionSize",e.boundingBoxSize)}if(this.realTimeFiltering){const e=l.getSize().width;h.updateFloat2("vReflectionFilteringInfo",e,tt.X.Log2(e))}if(!s.USEIRRADIANCEMAP){const e=l.sphericalPolynomial;if(s.USESPHERICALFROMREFLECTIONMAP&&e)if(s.SPHERICAL_HARMONICS){const t=e.preScaledHarmonics;h.updateVector3("vSphericalL00",t.l00),h.updateVector3("vSphericalL1_1",t.l1_1),h.updateVector3("vSphericalL10",t.l10),h.updateVector3("vSphericalL11",t.l11),h.updateVector3("vSphericalL2_2",t.l2_2),h.updateVector3("vSphericalL2_1",t.l2_1),h.updateVector3("vSphericalL20",t.l20),h.updateVector3("vSphericalL21",t.l21),h.updateVector3("vSphericalL22",t.l22)}else h.updateFloat3("vSphericalX",e.x.x,e.x.y,e.x.z),h.updateFloat3("vSphericalY",e.y.x,e.y.y,e.y.z),h.updateFloat3("vSphericalZ",e.z.x,e.z.y,e.z.z),h.updateFloat3("vSphericalXX_ZZ",e.xx.x-e.zz.x,e.xx.y-e.zz.y,e.xx.z-e.zz.z),h.updateFloat3("vSphericalYY_ZZ",e.yy.x-e.zz.x,e.yy.y-e.zz.y,e.yy.z-e.zz.z),h.updateFloat3("vSphericalZZ",e.zz.x,e.zz.y,e.zz.z),h.updateFloat3("vSphericalXY",e.xy.x,e.xy.y,e.xy.z),h.updateFloat3("vSphericalYZ",e.yz.x,e.yz.y,e.yz.z),h.updateFloat3("vSphericalZX",e.zx.x,e.zx.y,e.zx.z)}h.updateFloat3("vReflectionMicrosurfaceInfos",l.getSize().width,l.lodGenerationScale,l.lodGenerationOffset)}this._emissiveTexture&&si.EmissiveTextureEnabled&&(h.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),be(this._emissiveTexture,h,"emissive")),this._lightmapTexture&&si.LightmapTextureEnabled&&(h.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),be(this._lightmapTexture,h,"lightmap")),si.SpecularTextureEnabled&&(this._metallicTexture?(h.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),be(this._metallicTexture,h,"reflectivity")):this._reflectivityTexture&&(h.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),be(this._reflectivityTexture,h,"reflectivity")),this._metallicReflectanceTexture&&(h.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),be(this._metallicReflectanceTexture,h,"metallicReflectance")),this._reflectanceTexture&&s.REFLECTANCE&&(h.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),be(this._reflectanceTexture,h,"reflectance")),this._microSurfaceTexture&&(h.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),be(this._microSurfaceTexture,h,"microSurfaceSampler"))),this._bumpTexture&&a.getCaps().standardDerivatives&&si.BumpTextureEnabled&&!this._disableBumpMap&&(h.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),be(this._bumpTexture,h,"bump"),r._mirroredCameraPosition?h.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):h.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&h.updateFloat("pointSize",this.pointSize),s.METALLICWORKFLOW){E.IG.Color3[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,E.IG.Color3[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness,h.updateColor4("vReflectivityColor",E.IG.Color3[0],1);const e=this.subSurface?._indexOfRefraction??1.5,t=1,i=Math.pow((e-t)/(e+t),2);this._metallicReflectanceColor.scaleToRef(i*this._metallicF0Factor,E.IG.Color3[0]);const r=this._metallicF0Factor;h.updateColor4("vMetallicReflectanceFactors",E.IG.Color3[0],r)}else h.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);h.updateColor3("vEmissiveColor",si.EmissiveTextureEnabled?this._emissiveColor:E.v9.BlackReadOnly),h.updateColor3("vReflectionColor",this._reflectionColor),!s.SS_REFRACTION&&this.subSurface?._linkRefractionWithTransparency?h.updateColor4("vAlbedoColor",this._albedoColor,1):h.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*r.environmentIntensity,this._lightingInfos.w=this._specularIntensity,h.updateVector4("vLightingIntensity",this._lightingInfos),r.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),h.updateColor3("vAmbientColor",this._globalAmbientColor),h.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}r.texturesEnabled&&(this._albedoTexture&&si.DiffuseTextureEnabled&&h.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&si.AmbientTextureEnabled&&h.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&si.OpacityTextureEnabled&&h.setTexture("opacitySampler",this._opacityTexture),l&&si.ReflectionTextureEnabled&&(s.LODBASEDMICROSFURACE?h.setTexture("reflectionSampler",l):(h.setTexture("reflectionSampler",l._lodTextureMid||l),h.setTexture("reflectionSamplerLow",l._lodTextureLow||l),h.setTexture("reflectionSamplerHigh",l._lodTextureHigh||l)),s.USEIRRADIANCEMAP&&h.setTexture("irradianceSampler",l.irradianceTexture)),s.ENVIRONMENTBRDF&&h.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&si.EmissiveTextureEnabled&&h.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&si.LightmapTextureEnabled&&h.setTexture("lightmapSampler",this._lightmapTexture),si.SpecularTextureEnabled&&(this._metallicTexture?h.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&h.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&h.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&s.REFLECTANCE&&h.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&h.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&a.getCaps().standardDerivatives&&si.BumpTextureEnabled&&!this._disableBumpMap&&h.setTexture("bumpSampler",this._bumpTexture)),this.getScene().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(t)&&this.getScene().depthPeelingRenderer.bind(n),this._eventInfo.subMesh=i,this._callbackPluginEventBindForSubMesh(this._eventInfo),le(this._activeEffect,this,r),this.bindEyePosition(n)}else r.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);!o&&this.isFrozen||(r.lightsEnabled&&!this._disableLighting&&xe(r,t,this._activeEffect,s,this._maxSimultaneousLights),(r.fogEnabled&&t.applyFog&&r.fogMode!==Gt.Z.FOGMODE_NONE||l||this.subSurface.refractionTexture||t.receiveShadows||s.PREPASS)&&this.bindView(n),de(r,t,this._activeEffect,!0),s.NUM_MORPH_INFLUENCERS&&fe(t,this._activeEffect),s.BAKED_VERTEX_ANIMATION_TEXTURE&&t.bakedVertexAnimationManager?.bind(n,s.INSTANCES),this._imageProcessingConfiguration.bind(this._activeEffect),ue(s,this._activeEffect,r)),this._afterBind(t,this._activeEffect,i),h.update()}getAnimatables(){const e=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&e.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&e.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&e.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&e.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&e.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?e.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&e.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&e.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&e.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&e.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&e.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&e.push(this._microSurfaceTexture),e}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.getScene().environmentTexture}getActiveTextures(){const e=super.getActiveTextures();return this._albedoTexture&&e.push(this._albedoTexture),this._ambientTexture&&e.push(this._ambientTexture),this._opacityTexture&&e.push(this._opacityTexture),this._reflectionTexture&&e.push(this._reflectionTexture),this._emissiveTexture&&e.push(this._emissiveTexture),this._reflectivityTexture&&e.push(this._reflectivityTexture),this._metallicTexture&&e.push(this._metallicTexture),this._metallicReflectanceTexture&&e.push(this._metallicReflectanceTexture),this._reflectanceTexture&&e.push(this._reflectanceTexture),this._microSurfaceTexture&&e.push(this._microSurfaceTexture),this._bumpTexture&&e.push(this._bumpTexture),this._lightmapTexture&&e.push(this._lightmapTexture),e}hasTexture(e){return!!super.hasTexture(e)||(this._albedoTexture===e||(this._ambientTexture===e||(this._opacityTexture===e||(this._reflectionTexture===e||(this._emissiveTexture===e||(this._reflectivityTexture===e||(this._metallicTexture===e||(this._metallicReflectanceTexture===e||(this._reflectanceTexture===e||(this._microSurfaceTexture===e||(this._bumpTexture===e||this._lightmapTexture===e)))))))))))}setPrePassRenderer(){if(!this.subSurface?.isScatteringEnabled)return!1;const e=this.getScene().enableSubSurfaceForPrePass();return e&&(e.enabled=!0),!0}dispose(e,t){this._breakShaderLoadedCheck=!0,t&&(this._environmentBRDFTexture&&this.getScene().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),this._albedoTexture?.dispose(),this._ambientTexture?.dispose(),this._opacityTexture?.dispose(),this._reflectionTexture?.dispose(),this._emissiveTexture?.dispose(),this._metallicTexture?.dispose(),this._reflectivityTexture?.dispose(),this._bumpTexture?.dispose(),this._lightmapTexture?.dispose(),this._metallicReflectanceTexture?.dispose(),this._reflectanceTexture?.dispose(),this._microSurfaceTexture?.dispose()),this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(e,t)}}yi.PBRMATERIAL_OPAQUE=Ne.MATERIAL_OPAQUE,yi.PBRMATERIAL_ALPHATEST=Ne.MATERIAL_ALPHATEST,yi.PBRMATERIAL_ALPHABLEND=Ne.MATERIAL_ALPHABLEND,yi.PBRMATERIAL_ALPHATESTANDBLEND=Ne.MATERIAL_ALPHATESTANDBLEND,yi.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,yi.LIGHTFALLOFF_PHYSICAL=0,yi.LIGHTFALLOFF_GLTF=1,yi.LIGHTFALLOFF_STANDARD=2,yi.ForceGLSL=!1,(0,s.Cg)([(0,n.n1)()],yi.prototype,"_imageProcessingConfiguration",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsMiscDirty")],yi.prototype,"debugMode",void 0);class Ti extends yi{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(e){this.subSurface.refractionTexture=e,e?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(e){this.subSurface.indexOfRefraction=e}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(e){this.subSurface.invertRefractionY=e}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(e){this.subSurface.linkRefractionWithTransparency=e,e&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===yi.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(e){e!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=e?yi.LIGHTFALLOFF_PHYSICAL:yi.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===yi.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(e){e!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=e?yi.LIGHTFALLOFF_GLTF:yi.LIGHTFALLOFF_STANDARD)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(e){this.imageProcessingConfiguration.colorCurvesEnabled=e}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(e){this.imageProcessingConfiguration.colorGradingEnabled=e}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(e){this._imageProcessingConfiguration.toneMappingEnabled=e}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(e){this._imageProcessingConfiguration.exposure=e}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(e){this._imageProcessingConfiguration.contrast=e}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(e){this._imageProcessingConfiguration.colorGradingTexture=e}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(e){this._imageProcessingConfiguration.colorCurves=e}constructor(e,t){super(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=Ti.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=E.v9.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new E.v9(0,0,0),this.albedoColor=new E.v9(1,1,1),this.reflectivityColor=new E.v9(1,1,1),this.reflectionColor=new E.v9(1,1,1),this.emissiveColor=new E.v9(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=zt(this.getScene())}getClassName(){return"PBRMaterial"}clone(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const r=c.p.Clone((()=>new Ti(e,this.getScene())),this,{cloneTexturesOnlyOnce:t});return r.id=e,r.name=e,this.stencil.copyTo(r.stencil),this._clonePlugins(r,i),r}serialize(){const e=super.serialize();return e.customType="BABYLON.PBRMaterial",e}static Parse(e,t,i){const r=c.p.Parse((()=>new Ti(e.name,t)),e,t,i);return e.stencil&&r.stencil.parse(e.stencil,t,i),Ne._ParsePlugins(e,r,t,i),e.clearCoat&&r.clearCoat.parse(e.clearCoat,t,i),e.anisotropy&&r.anisotropy.parse(e.anisotropy,t,i),e.brdf&&r.brdf.parse(e.brdf,t,i),e.sheen&&r.sheen.parse(e.sheen,t,i),e.subSurface&&r.subSurface.parse(e.subSurface,t,i),e.iridescence&&r.iridescence.parse(e.iridescence,t,i),r}}Ti.PBRMATERIAL_OPAQUE=yi.PBRMATERIAL_OPAQUE,Ti.PBRMATERIAL_ALPHATEST=yi.PBRMATERIAL_ALPHATEST,Ti.PBRMATERIAL_ALPHABLEND=yi.PBRMATERIAL_ALPHABLEND,Ti.PBRMATERIAL_ALPHATESTANDBLEND=yi.PBRMATERIAL_ALPHATESTANDBLEND,Ti.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=yi.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"directIntensity",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"emissiveIntensity",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"environmentIntensity",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"specularIntensity",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"disableBumpMap",void 0),(0,s.Cg)([(0,n.uM)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"albedoTexture",void 0),(0,s.Cg)([(0,n.uM)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"ambientTexture",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"ambientTextureStrength",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,s.Cg)([(0,n.uM)(),(0,n.$z)("_markAllSubMeshesAsTexturesAndMiscDirty")],Ti.prototype,"opacityTexture",void 0),(0,s.Cg)([(0,n.uM)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"reflectionTexture",void 0),(0,s.Cg)([(0,n.uM)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"emissiveTexture",void 0),(0,s.Cg)([(0,n.uM)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"reflectivityTexture",void 0),(0,s.Cg)([(0,n.uM)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"metallicTexture",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"metallic",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"roughness",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"metallicF0Factor",void 0),(0,s.Cg)([(0,n.jT)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"metallicReflectanceColor",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,s.Cg)([(0,n.uM)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"metallicReflectanceTexture",void 0),(0,s.Cg)([(0,n.uM)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"reflectanceTexture",void 0),(0,s.Cg)([(0,n.uM)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"microSurfaceTexture",void 0),(0,s.Cg)([(0,n.uM)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"bumpTexture",void 0),(0,s.Cg)([(0,n.uM)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty",null)],Ti.prototype,"lightmapTexture",void 0),(0,s.Cg)([(0,n.jT)("ambient"),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"ambientColor",void 0),(0,s.Cg)([(0,n.jT)("albedo"),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"albedoColor",void 0),(0,s.Cg)([(0,n.jT)("reflectivity"),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"reflectivityColor",void 0),(0,s.Cg)([(0,n.jT)("reflection"),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"reflectionColor",void 0),(0,s.Cg)([(0,n.jT)("emissive"),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"emissiveColor",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"microSurface",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"useLightmapAsShadowmap",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesAndMiscDirty")],Ti.prototype,"useAlphaFromAlbedoTexture",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesAndMiscDirty")],Ti.prototype,"forceAlphaTest",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesAndMiscDirty")],Ti.prototype,"alphaCutOff",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"useSpecularOverAlpha",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"useAmbientInGrayScale",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,s.Cg)([(0,n.lK)()],Ti.prototype,"usePhysicalLightFalloff",null),(0,s.Cg)([(0,n.lK)()],Ti.prototype,"useGLTFLightFalloff",null),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"useRadianceOverAlpha",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"useObjectSpaceNormalMap",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"useParallax",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"useParallaxOcclusion",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"parallaxScaleBias",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsLightsDirty")],Ti.prototype,"disableLighting",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"forceIrradianceInFragment",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsLightsDirty")],Ti.prototype,"maxSimultaneousLights",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"invertNormalMapX",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"invertNormalMapY",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"twoSidedLighting",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"useAlphaFresnel",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"useLinearAlphaFresnel",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"environmentBRDFTexture",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"forceNormalForward",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"enableSpecularAntiAliasing",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"useHorizonOcclusion",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Ti.prototype,"useRadianceOcclusion",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsMiscDirty")],Ti.prototype,"unlit",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsMiscDirty")],Ti.prototype,"applyDecalMapAfterDetailMap",void 0),(0,x.Y5)("BABYLON.PBRMaterial",Ti);var xi=i(8386);function Ai(e){let t=e.pathArray;const i=e.closeArray||!1,r=e.closePath||!1,s=e.invertUV||!1,n=Math.floor(t[0].length/2);let a=e.offset||n;a=a>n?n:Math.floor(a);const o=0===e.sideOrientation?0:e.sideOrientation||W.DEFAULTSIDE,l=e.uvs,h=e.colors,c=[],u=[],d=[],_=[],p=[],f=[],g=[],m=[];let b;const v=[],y=[];let T,x,A;if(t.length<2){const e=[],i=[];for(x=0;x<t[0].length-a;x++)e.push(t[0][x]),i.push(t[0][x+a]);t=[e,i]}let C=0;const R=r?1:0,E=i?1:0;let M,P,I,O,D,w;for(b=t[0].length,T=0;T<t.length+E;T++){for(g[T]=0,p[T]=[0],M=T===t.length?t[0]:t[T],P=M.length,b=b<P?b:P,A=0;A<P;)c.push(M[A].x,M[A].y,M[A].z),A>0&&(I=M[A].subtract(M[A-1]).length(),O=I+g[T],p[T].push(O),g[T]=O),A++;r&&(A--,c.push(M[0].x,M[0].y,M[0].z),I=M[A].subtract(M[0]).length(),O=I+g[T],p[T].push(O),g[T]=O),v[T]=P+R,y[T]=C,C+=P+R}let F,L,B=null,N=null;for(x=0;x<b+R;x++)for(m[x]=0,f[x]=[0],T=0;T<t.length-1+E;T++)D=t[T],w=T===t.length-1?t[0]:t[T+1],x===b?(B=D[0],N=w[0]):(B=D[x],N=w[x]),I=N.subtract(B).length(),O=I+m[x],f[x].push(O),m[x]=O;if(l)for(T=0;T<l.length;T++)_.push(l[T].x,X.rX?1-l[T].y:l[T].y);else for(T=0;T<t.length+E;T++)for(x=0;x<b+R;x++)F=0!=g[T]?p[T][x]/g[T]:0,L=0!=m[x]?f[x][T]/m[x]:0,s?_.push(L,F):_.push(F,X.rX?1-L:L);T=0;let k=0,U=v[T]-1,V=v[T+1]-1,z=U<V?U:V,G=y[1]-y[0];const H=v.length-1;for(;k<=z&&T<H;)u.push(k,k+G,k+1),u.push(k+G+1,k+1,k+G),k+=1,k===z&&(T++,G=y[T+1]-y[T],U=v[T]-1,V=v[T+1]-1,k=y[T],z=U<V?U+k:V+k);if(W.ComputeNormals(c,u,d),r){let e=0,i=0;for(T=0;T<t.length;T++){e=3*y[T],i=T+1<t.length?3*(y[T+1]-1):d.length-3,d[e]=.5*(d[e]+d[i]),d[e+1]=.5*(d[e+1]+d[i+1]),d[e+2]=.5*(d[e+2]+d[i+2]);const r=Math.sqrt(d[e]*d[e]+d[e+1]*d[e+1]+d[e+2]*d[e+2]);d[e]/=r,d[e+1]/=r,d[e+2]/=r,d[i]=d[e],d[i+1]=d[e+1],d[i+2]=d[e+2]}}if(i){let e=3*y[0],i=3*y[t.length];for(x=0;x<b+R;x++){d[e]=.5*(d[e]+d[i]),d[e+1]=.5*(d[e+1]+d[i+1]),d[e+2]=.5*(d[e+2]+d[i+2]);const t=Math.sqrt(d[e]*d[e]+d[e+1]*d[e+1]+d[e+2]*d[e+2]);d[e]/=t,d[e+1]/=t,d[e+2]/=t,d[i]=d[e],d[i+1]=d[e+1],d[i+2]=d[e+2],e+=3,i+=3}}W._ComputeSides(o,c,u,d,_,e.frontUVs,e.backUVs);let q=null;if(h){q=new Float32Array(4*h.length);for(let e=0;e<h.length;e++)q[4*e]=h[e].r,q[4*e+1]=h[e].g,q[4*e+2]=h[e].b,q[4*e+3]=h[e].a}const K=new W,Y=new Float32Array(c),j=new Float32Array(d),Q=new Float32Array(_);return K.indices=u,K.positions=Y,K.normals=j,K.uvs=Q,q&&K.set(q,S.R.ColorKind),r&&(K._idx=y),K}function Ci(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=t.pathArray,s=t.closeArray,n=t.closePath,a=Xe._GetDefaultSideOrientation(t.sideOrientation),l=t.instance,h=t.updatable;if(l){const e=o.AA.Vector3[0].setAll(Number.MAX_VALUE),i=o.AA.Vector3[1].setAll(-Number.MAX_VALUE),s=t=>{let s=r[0].length;const n=l;let a=0;const o=n._originalBuilderSideOrientation===Xe.DOUBLESIDE?2:1;for(let l=1;l<=o;++l)for(let o=0;o<r.length;++o){const l=r[o],h=l.length;s=s<h?s:h;for(let r=0;r<s;++r){const s=l[r];t[a]=s.x,t[a+1]=s.y,t[a+2]=s.z,e.minimizeInPlaceFromFloats(s.x,s.y,s.z),i.maximizeInPlaceFromFloats(s.x,s.y,s.z),a+=3}if(n._creationDataStorage&&n._creationDataStorage.closePath){const e=l[0];t[a]=e.x,t[a+1]=e.y,t[a+2]=e.z,a+=3}}},n=l.getVerticesData(S.R.PositionKind);if(s(n),l.hasBoundingInfo?l.getBoundingInfo().reConstruct(e,i,l._worldMatrix):l.buildBoundingInfo(e,i,l._worldMatrix),l.updateVerticesData(S.R.PositionKind,n,!1,!1),t.colors){const e=l.getVerticesData(S.R.ColorKind);for(let i=0,r=0;i<t.colors.length;i++,r+=4){const s=t.colors[i];e[r]=s.r,e[r+1]=s.g,e[r+2]=s.b,e[r+3]=s.a}l.updateVerticesData(S.R.ColorKind,e,!1,!1)}if(t.uvs){const e=l.getVerticesData(S.R.UVKind);for(let i=0;i<t.uvs.length;i++)e[2*i]=t.uvs[i].x,e[2*i+1]=X.rX?1-t.uvs[i].y:t.uvs[i].y;l.updateVerticesData(S.R.UVKind,e,!1,!1)}if(!l.areNormalsFrozen||l.isFacetDataEnabled){const e=l.getIndices(),t=l.getVerticesData(S.R.NormalKind),i=l.isFacetDataEnabled?l.getFacetDataParameters():null;if(W.ComputeNormals(n,e,t,i),l._creationDataStorage&&l._creationDataStorage.closePath){let e=0,i=0;for(let s=0;s<r.length;s++)e=3*l._creationDataStorage.idx[s],i=s+1<r.length?3*(l._creationDataStorage.idx[s+1]-1):t.length-3,t[e]=.5*(t[e]+t[i]),t[e+1]=.5*(t[e+1]+t[i+1]),t[e+2]=.5*(t[e+2]+t[i+2]),t[i]=t[e],t[i+1]=t[e+1],t[i+2]=t[e+2]}l.areNormalsFrozen||l.updateVerticesData(S.R.NormalKind,t,!1,!1)}return l}{const r=new Xe(e,i);r._originalBuilderSideOrientation=a,r._creationDataStorage=new ze;const o=Ai(t);return n&&(r._creationDataStorage.idx=o._idx),r._creationDataStorage.closePath=n,r._creationDataStorage.closeArray=s,o.applyToMesh(r,h),r}}function Ri(e){const t=[],i=[],r=[],s=[],n=e.radius||.5,a=e.tessellation||64,o=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1,l=0===e.sideOrientation?0:e.sideOrientation||W.DEFAULTSIDE;t.push(0,0,0),s.push(.5,.5);const h=2*Math.PI*o,c=1===o?h/a:h/(a-1);let u=0;for(let p=0;p<a;p++){const e=Math.cos(u),i=Math.sin(u),r=(e+1)/2,a=(1-i)/2;t.push(n*e,n*i,0),s.push(r,X.rX?1-a:a),u+=c}1===o&&(t.push(t[3],t[4],t[5]),s.push(s[2],X.rX?1-s[3]:s[3]));const d=t.length/3;for(let p=1;p<d-1;p++)i.push(p+1,0,p);W.ComputeNormals(t,i,r),W._ComputeSides(l,t,i,r,s,e.frontUVs,e.backUVs);const _=new W;return _.indices=i,_.positions=t,_.normals=r,_.uvs=s,_}function Ei(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=new Xe(e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null);t.sideOrientation=Xe._GetDefaultSideOrientation(t.sideOrientation),i._originalBuilderSideOrientation=t.sideOrientation;return Ri(t).applyToMesh(i,t.updatable),i}W.CreateRibbon=Ai,Xe.CreateRibbon=function(e,t){return Ci(e,{pathArray:t,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};W.CreateDisc=Ri,Xe.CreateDisc=function(e,t,i){return Ei(e,{radius:t,tessellation:i,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)},Xe._GroundMeshParser=(e,t)=>Si.Parse(e,t);class Si extends Xe{constructor(e,t){super(e,t),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=e,this._subdivisionsY=e,this.subdivide(e);const i=this;i.createOrUpdateSubmeshesOctree&&i.createOrUpdateSubmeshesOctree(t)}getHeightAtCoordinates(e,t){const i=this.getWorldMatrix(),r=o.AA.Matrix[5];i.invertToRef(r);const s=o.AA.Vector3[8];if(o.Pq.TransformCoordinatesFromFloatsToRef(e,0,t,r,s),e=s.x,t=s.z,e<this._minX||e>=this._maxX||t<=this._minZ||t>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const n=this._getFacetAt(e,t),a=-(n.x*e+n.z*t+n.w)/n.y;return o.Pq.TransformCoordinatesFromFloatsToRef(0,a,0,i,s),s.y}getNormalAtCoordinates(e,t){const i=new o.Pq(0,1,0);return this.getNormalAtCoordinatesToRef(e,t,i),i}getNormalAtCoordinatesToRef(e,t,i){const r=this.getWorldMatrix(),s=o.AA.Matrix[5];r.invertToRef(s);const n=o.AA.Vector3[8];if(o.Pq.TransformCoordinatesFromFloatsToRef(e,0,t,s,n),e=n.x,t=n.z,e<this._minX||e>this._maxX||t<this._minZ||t>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const a=this._getFacetAt(e,t);return o.Pq.TransformNormalFromFloatsToRef(a.x,a.y,a.z,r,i),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(e,t){const i=Math.floor((e+this._maxX)*this._subdivisionsX/this._width),r=Math.floor(-(t+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),s=this._heightQuads[r*this._subdivisionsX+i];let n;return n=t<s.slope.x*e+s.slope.y?s.facet1:s.facet2,n}_initHeightQuads(){const e=this._subdivisionsX,t=this._subdivisionsY;this._heightQuads=new Array;for(let i=0;i<t;i++)for(let t=0;t<e;t++){const r={slope:o.I9.Zero(),facet1:new o.IU(0,0,0,0),facet2:new o.IU(0,0,0,0)};this._heightQuads[i*e+t]=r}return this}_computeHeightQuads(){const e=this.getVerticesData(S.R.PositionKind);if(!e)return this;const t=o.AA.Vector3[3],i=o.AA.Vector3[2],r=o.AA.Vector3[1],s=o.AA.Vector3[0],n=o.AA.Vector3[4],a=o.AA.Vector3[5],l=o.AA.Vector3[6],h=o.AA.Vector3[7],c=o.AA.Vector3[8];let u=0,d=0,_=0,p=0,f=0,g=0,m=0;const b=this._subdivisionsX,v=this._subdivisionsY;for(let y=0;y<v;y++)for(let v=0;v<b;v++){u=3*v,d=y*(b+1)*3,_=(y+1)*(b+1)*3,t.x=e[d+u],t.y=e[d+u+1],t.z=e[d+u+2],i.x=e[d+u+3],i.y=e[d+u+4],i.z=e[d+u+5],r.x=e[_+u],r.y=e[_+u+1],r.z=e[_+u+2],s.x=e[_+u+3],s.y=e[_+u+4],s.z=e[_+u+5],p=(s.z-t.z)/(s.x-t.x),f=t.z-p*t.x,i.subtractToRef(t,n),r.subtractToRef(t,a),s.subtractToRef(t,l),o.Pq.CrossToRef(l,a,h),o.Pq.CrossToRef(n,l,c),h.normalize(),c.normalize(),g=-(h.x*t.x+h.y*t.y+h.z*t.z),m=-(c.x*i.x+c.y*i.y+c.z*i.z);const T=this._heightQuads[y*b+v];T.slope.copyFromFloats(p,f),T.facet1.copyFromFloats(h.x,h.y,h.z,g),T.facet2.copyFromFloats(c.x,c.y,c.z,m)}return this}serialize(e){super.serialize(e),e.subdivisionsX=this._subdivisionsX,e.subdivisionsY=this._subdivisionsY,e.minX=this._minX,e.maxX=this._maxX,e.minZ=this._minZ,e.maxZ=this._maxZ,e.width=this._width,e.height=this._height}static Parse(e,t){const i=new Si(e.name,t);return i._subdivisionsX=e.subdivisionsX||1,i._subdivisionsY=e.subdivisionsY||1,i._minX=e.minX,i._maxX=e.maxX,i._minZ=e.minZ,i._maxZ=e.maxZ,i._width=e.width,i._height=e.height,i}}function Mi(e){const t=[],i=[],r=[],s=[];let n,a;const l=e.width||1,h=e.height||1,c=0|(e.subdivisionsX||e.subdivisions||1),u=0|(e.subdivisionsY||e.subdivisions||1);for(n=0;n<=u;n++)for(a=0;a<=c;a++){const e=new o.Pq(a*l/c-l/2,0,(u-n)*h/u-h/2),t=new o.Pq(0,1,0);i.push(e.x,e.y,e.z),r.push(t.x,t.y,t.z),s.push(a/c,X.rX?n/u:1-n/u)}for(n=0;n<u;n++)for(a=0;a<c;a++)t.push(a+1+(n+1)*(c+1)),t.push(a+1+n*(c+1)),t.push(a+n*(c+1)),t.push(a+(n+1)*(c+1)),t.push(a+1+(n+1)*(c+1)),t.push(a+n*(c+1));const d=new W;return d.indices=t,d.positions=i,d.normals=r,d.uvs=s,d}function Pi(e){const t=void 0!==e.xmin&&null!==e.xmin?e.xmin:-1,i=void 0!==e.zmin&&null!==e.zmin?e.zmin:-1,r=void 0!==e.xmax&&null!==e.xmax?e.xmax:1,s=void 0!==e.zmax&&null!==e.zmax?e.zmax:1,n=e.subdivisions||{w:1,h:1},a=e.precision||{w:1,h:1},l=[],h=[],c=[],u=[];let d,_,p,f;n.h=n.h<1?1:n.h,n.w=n.w<1?1:n.w,a.w=a.w<1?1:a.w,a.h=a.h<1?1:a.h;const g=(r-t)/n.w,m=(s-i)/n.h;function b(e,t,i,r){const s=h.length/3,n=a.w+1;for(d=0;d<a.h;d++)for(_=0;_<a.w;_++){const e=[s+_+d*n,s+(_+1)+d*n,s+(_+1)+(d+1)*n,s+_+(d+1)*n];l.push(e[1]),l.push(e[2]),l.push(e[3]),l.push(e[0]),l.push(e[1]),l.push(e[3])}const p=o.Pq.Zero(),f=new o.Pq(0,1,0);for(d=0;d<=a.h;d++)for(p.z=d*(r-t)/a.h+t,_=0;_<=a.w;_++)p.x=_*(i-e)/a.w+e,p.y=0,h.push(p.x,p.y,p.z),c.push(f.x,f.y,f.z),u.push(_/a.w,d/a.h)}for(p=0;p<n.h;p++)for(f=0;f<n.w;f++)b(t+f*g,i+p*m,t+(f+1)*g,i+(p+1)*m);const v=new W;return v.indices=l,v.positions=h,v.normals=c,v.uvs=u,v}function Ii(e){const t=[],i=[],r=[],s=[];let n,a;const l=e.colorFilter||new E.v9(.3,.59,.11),h=e.alphaFilter||0;let c=!1;if(e.minHeight>e.maxHeight){c=!0;const t=e.maxHeight;e.maxHeight=e.minHeight,e.minHeight=t}for(n=0;n<=e.subdivisions;n++)for(a=0;a<=e.subdivisions;a++){const t=new o.Pq(a*e.width/e.subdivisions-e.width/2,0,(e.subdivisions-n)*e.height/e.subdivisions-e.height/2),u=4*(((t.x+e.width/2)/e.width*(e.bufferWidth-1)|0)+((1-(t.z+e.height/2)/e.height)*(e.bufferHeight-1)|0)*e.bufferWidth);let d=e.buffer[u]/255,_=e.buffer[u+1]/255,p=e.buffer[u+2]/255;const f=e.buffer[u+3]/255;c&&(d=1-d,_=1-_,p=1-p);const g=d*l.r+_*l.g+p*l.b;t.y=f>=h?e.minHeight+(e.maxHeight-e.minHeight)*g:e.minHeight-O.bH,e.heightBuffer&&(e.heightBuffer[n*(e.subdivisions+1)+a]=t.y),i.push(t.x,t.y,t.z),r.push(0,0,0),s.push(a/e.subdivisions,1-n/e.subdivisions)}for(n=0;n<e.subdivisions;n++)for(a=0;a<e.subdivisions;a++){const r=a+1+(n+1)*(e.subdivisions+1),s=a+1+n*(e.subdivisions+1),o=a+n*(e.subdivisions+1),l=a+(n+1)*(e.subdivisions+1),h=i[3*r+1]>=e.minHeight,c=i[3*s+1]>=e.minHeight,u=i[3*o+1]>=e.minHeight;h&&c&&u&&(t.push(r),t.push(s),t.push(o));i[3*l+1]>=e.minHeight&&h&&u&&(t.push(l),t.push(r),t.push(o))}W.ComputeNormals(i,t,r);const u=new W;return u.indices=t,u.positions=i,u.normals=r,u.uvs=s,u}function Oi(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=new Si(e,arguments.length>2?arguments[2]:void 0);i._setReady(!1),i._subdivisionsX=t.subdivisionsX||t.subdivisions||1,i._subdivisionsY=t.subdivisionsY||t.subdivisions||1,i._width=t.width||1,i._height=t.height||1,i._maxX=i._width/2,i._maxZ=i._height/2,i._minX=-i._maxX,i._minZ=-i._maxZ;return Mi(t).applyToMesh(i,t.updatable),i._setReady(!0),i}function Di(e,t){const i=new Xe(e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null);return Pi(t).applyToMesh(i,t.updatable),i}function wi(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const s=i.width||10,n=i.height||10,a=i.subdivisions||1,o=i.minHeight||0,h=i.maxHeight||1,c=i.colorFilter||new E.v9(.3,.59,.11),u=i.alphaFilter||0,d=i.updatable,p=i.onReady;r=r||l.q.LastCreatedScene;const f=new Si(e,r);let g;f._subdivisionsX=a,f._subdivisionsY=a,f._width=s,f._height=n,f._maxX=f._width/2,f._maxZ=f._height/2,f._minX=-f._maxX,f._minZ=-f._maxZ,f._setReady(!1),i.passHeightBufferInCallback&&(g=new Float32Array((a+1)*(a+1)));const m=(e,t,i)=>{Ii({width:s,height:n,subdivisions:a,minHeight:o,maxHeight:h,colorFilter:c,buffer:e,bufferWidth:t,bufferHeight:i,alphaFilter:u,heightBuffer:g}).applyToMesh(f,d),p&&p(f,g),f._setReady(!0)};if("string"===typeof t){const e=e=>{const t=e.width,i=e.height;if(r.isDisposed)return;const s=r?.getEngine().resizeImageBitmap(e,t,i);m(s,t,i)};_.S0.LoadImage(t,e,i.onError?i.onError:()=>{},r.offlineProvider)}else m(t.data,t.width,t.height);return f}function Fi(e){let t=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const i=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],r=[];let s=[];const n=e.width||e.size||1,a=e.height||e.size||1,l=e.depth||e.size||1,h=e.wrap||!1;let c=void 0===e.topBaseAt?1:e.topBaseAt,u=void 0===e.bottomBaseAt?0:e.bottomBaseAt;c=(c+4)%4,u=(u+4)%4;let d=[2,0,3,1][c],_=[2,0,1,3][u],p=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(h){t=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],p=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let e=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],i=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const r=[17,18,19,16],s=[22,23,20,21];for(;d>0;)e.unshift(e.pop()),r.unshift(r.pop()),d--;for(;_>0;)i.unshift(i.pop()),s.unshift(s.pop()),_--;e=e.flat(),i=i.flat(),p=p.concat(e).concat(i),t.push(r[0],r[2],r[3],r[0],r[1],r[2]),t.push(s[0],s[2],s[3],s[0],s[1],s[2])}const f=[n/2,a/2,l/2];s=p.reduce(((e,t,i)=>e.concat(t*f[i%3])),[]);const g=0===e.sideOrientation?0:e.sideOrientation||W.DEFAULTSIDE,m=e.faceUV||new Array(6),b=e.faceColors,v=[];for(let T=0;T<6;T++)void 0===m[T]&&(m[T]=new o.IU(0,0,1,1)),b&&void 0===b[T]&&(b[T]=new E.ov(1,1,1,1));for(let o=0;o<6;o++)if(r.push(m[o].z,X.rX?1-m[o].w:m[o].w),r.push(m[o].x,X.rX?1-m[o].w:m[o].w),r.push(m[o].x,X.rX?1-m[o].y:m[o].y),r.push(m[o].z,X.rX?1-m[o].y:m[o].y),b)for(let e=0;e<4;e++)v.push(b[o].r,b[o].g,b[o].b,b[o].a);W._ComputeSides(g,s,t,i,r,e.frontUVs,e.backUVs);const y=new W;if(y.indices=t,y.positions=s,y.normals=i,y.uvs=r,b){const e=g===W.DOUBLESIDE?v.concat(v):v;y.colors=e}return y}function Li(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=new Xe(e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null);t.sideOrientation=Xe._GetDefaultSideOrientation(t.sideOrientation),i._originalBuilderSideOrientation=t.sideOrientation;return Fi(t).applyToMesh(i,t.updatable),i}W.CreateGround=Mi,W.CreateTiledGround=Pi,W.CreateGroundFromHeightMap=Ii,Xe.CreateGround=(e,t,i,r,s,n)=>Oi(e,{width:t,height:i,subdivisions:r,updatable:n},s),Xe.CreateTiledGround=(e,t,i,r,s,n,a,o,l)=>Di(e,{xmin:t,zmin:i,xmax:r,zmax:s,subdivisions:n,precision:a,updatable:l},o),Xe.CreateGroundFromHeightMap=(e,t,i,r,s,n,a,o,l,h,c)=>wi(e,t,{width:i,height:r,subdivisions:s,minHeight:n,maxHeight:a,updatable:l,onReady:h,alphaFilter:c},o);function Bi(e){const t=e.pattern||Xe.NO_FLIP,i=e.tileWidth||e.tileSize||1,r=e.tileHeight||e.tileSize||1,s=e.alignHorizontal||0,n=e.alignVertical||0,a=e.width||e.size||1,o=Math.floor(a/i);let l=a-o*i;const h=e.height||e.size||1,c=Math.floor(h/r);let u=h-c*r;const d=i*o/2,_=r*c/2;let p=0,f=0,g=0,m=0,b=0,v=0;if(l>0||u>0){switch(g=-d,m=-_,b=d,v=_,s){case Xe.CENTER:l/=2,g-=l,b+=l;break;case Xe.LEFT:b+=l,p=-l/2;break;case Xe.RIGHT:g-=l,p=l/2}switch(n){case Xe.CENTER:u/=2,m-=u,v+=u;break;case Xe.BOTTOM:v+=u,f=-u/2;break;case Xe.TOP:m-=u,f=u/2}}const y=[],T=[],x=[];x[0]=[0,0,1,0,1,1,0,1],x[1]=[0,0,1,0,1,1,0,1],t!==Xe.ROTATE_TILE&&t!==Xe.ROTATE_ROW||(x[1]=[1,1,0,1,0,0,1,0]),t!==Xe.FLIP_TILE&&t!==Xe.FLIP_ROW||(x[1]=[1,0,0,0,0,1,1,1]),t!==Xe.FLIP_N_ROTATE_TILE&&t!==Xe.FLIP_N_ROTATE_ROW||(x[1]=[0,1,1,1,1,0,0,0]);let A=[];const C=[],R=[];let E=0;for(let I=0;I<c;I++)for(let e=0;e<o;e++)y.push(e*i-d+p,I*r-_+f,0),y.push((e+1)*i-d+p,I*r-_+f,0),y.push((e+1)*i-d+p,(I+1)*r-_+f,0),y.push(e*i-d+p,(I+1)*r-_+f,0),R.push(E,E+1,E+3,E+1,E+2,E+3),A=t===Xe.FLIP_TILE||t===Xe.ROTATE_TILE||t===Xe.FLIP_N_ROTATE_TILE?A.concat(x[(e%2+I%2)%2]):t===Xe.FLIP_ROW||t===Xe.ROTATE_ROW||t===Xe.FLIP_N_ROTATE_ROW?A.concat(x[I%2]):A.concat(x[0]),C.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),T.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),E+=4;if(l>0||u>0){const e=u>0&&(n===Xe.CENTER||n===Xe.TOP),a=u>0&&(n===Xe.CENTER||n===Xe.BOTTOM),h=l>0&&(s===Xe.CENTER||s===Xe.RIGHT),x=l>0&&(s===Xe.CENTER||s===Xe.LEFT);let S,M,P,I,O=[];if(e&&h&&(y.push(g+p,m+f,0),y.push(-d+p,m+f,0),y.push(-d+p,m+u+f,0),y.push(g+p,m+u+f,0),R.push(E,E+1,E+3,E+1,E+2,E+3),E+=4,S=1-l/i,M=1-u/r,P=1,I=1,O=[S,M,P,M,P,I,S,I],t===Xe.ROTATE_ROW&&(O=[1-S,1-M,1-P,1-M,1-P,1-I,1-S,1-I]),t===Xe.FLIP_ROW&&(O=[1-S,M,1-P,M,1-P,I,1-S,I]),t===Xe.FLIP_N_ROTATE_ROW&&(O=[S,1-M,P,1-M,P,1-I,S,1-I]),A=A.concat(O),C.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),T.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),e&&x&&(y.push(d+p,m+f,0),y.push(b+p,m+f,0),y.push(b+p,m+u+f,0),y.push(d+p,m+u+f,0),R.push(E,E+1,E+3,E+1,E+2,E+3),E+=4,S=0,M=1-u/r,P=l/i,I=1,O=[S,M,P,M,P,I,S,I],(t===Xe.ROTATE_ROW||t===Xe.ROTATE_TILE&&o%2===0)&&(O=[1-S,1-M,1-P,1-M,1-P,1-I,1-S,1-I]),(t===Xe.FLIP_ROW||t===Xe.FLIP_TILE&&o%2===0)&&(O=[1-S,M,1-P,M,1-P,I,1-S,I]),(t===Xe.FLIP_N_ROTATE_ROW||t===Xe.FLIP_N_ROTATE_TILE&&o%2===0)&&(O=[S,1-M,P,1-M,P,1-I,S,1-I]),A=A.concat(O),C.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),T.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),a&&h&&(y.push(g+p,_+f,0),y.push(-d+p,_+f,0),y.push(-d+p,v+f,0),y.push(g+p,v+f,0),R.push(E,E+1,E+3,E+1,E+2,E+3),E+=4,S=1-l/i,M=0,P=1,I=u/r,O=[S,M,P,M,P,I,S,I],(t===Xe.ROTATE_ROW&&c%2===1||t===Xe.ROTATE_TILE&&c%1===0)&&(O=[1-S,1-M,1-P,1-M,1-P,1-I,1-S,1-I]),(t===Xe.FLIP_ROW&&c%2===1||t===Xe.FLIP_TILE&&c%2===0)&&(O=[1-S,M,1-P,M,1-P,I,1-S,I]),(t===Xe.FLIP_N_ROTATE_ROW&&c%2===1||t===Xe.FLIP_N_ROTATE_TILE&&c%2===0)&&(O=[S,1-M,P,1-M,P,1-I,S,1-I]),A=A.concat(O),C.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),T.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),a&&x&&(y.push(d+p,_+f,0),y.push(b+p,_+f,0),y.push(b+p,v+f,0),y.push(d+p,v+f,0),R.push(E,E+1,E+3,E+1,E+2,E+3),E+=4,S=0,M=0,P=l/i,I=u/r,O=[S,M,P,M,P,I,S,I],(t===Xe.ROTATE_ROW&&c%2===1||t===Xe.ROTATE_TILE&&(c+o)%2===1)&&(O=[1-S,1-M,1-P,1-M,1-P,1-I,1-S,1-I]),(t===Xe.FLIP_ROW&&c%2===1||t===Xe.FLIP_TILE&&(c+o)%2===1)&&(O=[1-S,M,1-P,M,1-P,I,1-S,I]),(t===Xe.FLIP_N_ROTATE_ROW&&c%2===1||t===Xe.FLIP_N_ROTATE_TILE&&(c+o)%2===1)&&(O=[S,1-M,P,1-M,P,1-I,S,1-I]),A=A.concat(O),C.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),T.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),e){const e=[];S=0,M=1-u/r,P=1,I=1,e[0]=[S,M,P,M,P,I,S,I],e[1]=[S,M,P,M,P,I,S,I],t!==Xe.ROTATE_TILE&&t!==Xe.ROTATE_ROW||(e[1]=[1-S,1-M,1-P,1-M,1-P,1-I,1-S,1-I]),t!==Xe.FLIP_TILE&&t!==Xe.FLIP_ROW||(e[1]=[1-S,M,1-P,M,1-P,I,1-S,I]),t!==Xe.FLIP_N_ROTATE_TILE&&t!==Xe.FLIP_N_ROTATE_ROW||(e[1]=[S,1-M,P,1-M,P,1-I,S,1-I]);for(let r=0;r<o;r++)y.push(r*i-d+p,m+f,0),y.push((r+1)*i-d+p,m+f,0),y.push((r+1)*i-d+p,m+u+f,0),y.push(r*i-d+p,m+u+f,0),R.push(E,E+1,E+3,E+1,E+2,E+3),E+=4,A=t===Xe.FLIP_TILE||t===Xe.ROTATE_TILE||t===Xe.FLIP_N_ROTATE_TILE?A.concat(e[(r+1)%2]):t===Xe.FLIP_ROW||t===Xe.ROTATE_ROW||t===Xe.FLIP_N_ROTATE_ROW?A.concat(e[1]):A.concat(e[0]),C.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),T.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(a){const e=[];S=0,M=0,P=1,I=u/r,e[0]=[S,M,P,M,P,I,S,I],e[1]=[S,M,P,M,P,I,S,I],t!==Xe.ROTATE_TILE&&t!==Xe.ROTATE_ROW||(e[1]=[1-S,1-M,1-P,1-M,1-P,1-I,1-S,1-I]),t!==Xe.FLIP_TILE&&t!==Xe.FLIP_ROW||(e[1]=[1-S,M,1-P,M,1-P,I,1-S,I]),t!==Xe.FLIP_N_ROTATE_TILE&&t!==Xe.FLIP_N_ROTATE_ROW||(e[1]=[S,1-M,P,1-M,P,1-I,S,1-I]);for(let r=0;r<o;r++)y.push(r*i-d+p,v-u+f,0),y.push((r+1)*i-d+p,v-u+f,0),y.push((r+1)*i-d+p,v+f,0),y.push(r*i-d+p,v+f,0),R.push(E,E+1,E+3,E+1,E+2,E+3),E+=4,A=t===Xe.FLIP_TILE||t===Xe.ROTATE_TILE||t===Xe.FLIP_N_ROTATE_TILE?A.concat(e[(r+c)%2]):t===Xe.FLIP_ROW||t===Xe.ROTATE_ROW||t===Xe.FLIP_N_ROTATE_ROW?A.concat(e[c%2]):A.concat(e[0]),C.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),T.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(h){const e=[];S=1-l/i,M=0,P=1,I=1,e[0]=[S,M,P,M,P,I,S,I],e[1]=[S,M,P,M,P,I,S,I],t!==Xe.ROTATE_TILE&&t!==Xe.ROTATE_ROW||(e[1]=[1-S,1-M,1-P,1-M,1-P,1-I,1-S,1-I]),t!==Xe.FLIP_TILE&&t!==Xe.FLIP_ROW||(e[1]=[1-S,M,1-P,M,1-P,I,1-S,I]),t!==Xe.FLIP_N_ROTATE_TILE&&t!==Xe.FLIP_N_ROTATE_ROW||(e[1]=[S,1-M,P,1-M,P,1-I,S,1-I]);for(let i=0;i<c;i++)y.push(g+p,i*r-_+f,0),y.push(g+l+p,i*r-_+f,0),y.push(g+l+p,(i+1)*r-_+f,0),y.push(g+p,(i+1)*r-_+f,0),R.push(E,E+1,E+3,E+1,E+2,E+3),E+=4,A=t===Xe.FLIP_TILE||t===Xe.ROTATE_TILE||t===Xe.FLIP_N_ROTATE_TILE?A.concat(e[(i+1)%2]):t===Xe.FLIP_ROW||t===Xe.ROTATE_ROW||t===Xe.FLIP_N_ROTATE_ROW?A.concat(e[i%2]):A.concat(e[0]),C.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),T.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(x){const e=[];S=0,M=0,P=l/r,I=1,e[0]=[S,M,P,M,P,I,S,I],e[1]=[S,M,P,M,P,I,S,I],t!==Xe.ROTATE_TILE&&t!==Xe.ROTATE_ROW||(e[1]=[1-S,1-M,1-P,1-M,1-P,1-I,1-S,1-I]),t!==Xe.FLIP_TILE&&t!==Xe.FLIP_ROW||(e[1]=[1-S,M,1-P,M,1-P,I,1-S,I]),t!==Xe.FLIP_N_ROTATE_TILE&&t!==Xe.FLIP_N_ROTATE_ROW||(e[1]=[S,1-M,P,1-M,P,1-I,S,1-I]);for(let i=0;i<c;i++)y.push(b-l+p,i*r-_+f,0),y.push(b+p,i*r-_+f,0),y.push(b+p,(i+1)*r-_+f,0),y.push(b-l+p,(i+1)*r-_+f,0),R.push(E,E+1,E+3,E+1,E+2,E+3),E+=4,A=t===Xe.FLIP_TILE||t===Xe.ROTATE_TILE||t===Xe.FLIP_N_ROTATE_TILE?A.concat(e[(i+o)%2]):t===Xe.FLIP_ROW||t===Xe.ROTATE_ROW||t===Xe.FLIP_N_ROTATE_ROW?A.concat(e[i%2]):A.concat(e[0]),C.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),T.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const S=0===e.sideOrientation?0:e.sideOrientation||W.DEFAULTSIDE;W._ComputeSides(S,y,R,T,A,e.frontUVs,e.backUVs);const M=new W;M.indices=R,M.positions=y,M.normals=T,M.uvs=A;const P=S===W.DOUBLESIDE?C.concat(C):C;return M.colors=P,M}function Ni(e,t){const i=new Xe(e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null);t.sideOrientation=Xe._GetDefaultSideOrientation(t.sideOrientation),i._originalBuilderSideOrientation=t.sideOrientation;return Bi(t).applyToMesh(i,t.updatable),i}W.CreateBox=Fi,Xe.CreateBox=function(e,t){return Li(e,{size:t,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)};function ki(e){const t=e.faceUV||new Array(6),i=e.faceColors,r=e.pattern||Xe.NO_FLIP,s=e.width||e.size||1,n=e.height||e.size||1,a=e.depth||e.size||1,l=e.tileWidth||e.tileSize||1,h=e.tileHeight||e.tileSize||1,c=e.alignHorizontal||0,u=e.alignVertical||0,d=0===e.sideOrientation?0:e.sideOrientation||W.DEFAULTSIDE;for(let k=0;k<6;k++)void 0===t[k]&&(t[k]=new o.IU(0,0,1,1)),i&&void 0===i[k]&&(i[k]=new E.ov(1,1,1,1));const _=s/2,p=n/2,f=a/2,g=[];for(let o=0;o<2;o++)g[o]=Bi({pattern:r,tileWidth:l,tileHeight:h,width:s,height:n,alignVertical:u,alignHorizontal:c,sideOrientation:d});for(let o=2;o<4;o++)g[o]=Bi({pattern:r,tileWidth:l,tileHeight:h,width:a,height:n,alignVertical:u,alignHorizontal:c,sideOrientation:d});let m=u;u===Xe.BOTTOM?m=Xe.TOP:u===Xe.TOP&&(m=Xe.BOTTOM);for(let o=4;o<6;o++)g[o]=Bi({pattern:r,tileWidth:l,tileHeight:h,width:s,height:a,alignVertical:m,alignHorizontal:c,sideOrientation:d});let b=[],v=[],y=[],T=[];const x=[],A=[],C=[],R=[];let S=0,M=0;for(let E=0;E<6;E++){const e=g[E].positions.length;A[E]=[],C[E]=[];for(let t=0;t<e/3;t++)A[E].push(new o.Pq(g[E].positions[3*t],g[E].positions[3*t+1],g[E].positions[3*t+2])),C[E].push(new o.Pq(g[E].normals[3*t],g[E].normals[3*t+1],g[E].normals[3*t+2]));S=g[E].uvs.length,R[E]=[];for(let i=0;i<S;i+=2)R[E][i]=t[E].x+(t[E].z-t[E].x)*g[E].uvs[i],R[E][i+1]=t[E].y+(t[E].w-t[E].y)*g[E].uvs[i+1],X.rX&&(R[E][i+1]=1-R[E][i+1]);if(y=y.concat(R[E]),T=T.concat(g[E].indices.map((e=>e+M))),M+=A[E].length,i)for(let t=0;t<4;t++)x.push(i[E].r,i[E].g,i[E].b,i[E].a)}const P=new o.Pq(0,0,f),I=o.uq.RotationY(Math.PI);b=A[0].map((e=>o.Pq.TransformNormal(e,I).add(P))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[]),v=C[0].map((e=>o.Pq.TransformNormal(e,I))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[]),b=b.concat(A[1].map((e=>e.subtract(P))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[])),v=v.concat(C[1].map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[]));const O=new o.Pq(_,0,0),D=o.uq.RotationY(-Math.PI/2);b=b.concat(A[2].map((e=>o.Pq.TransformNormal(e,D).add(O))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[])),v=v.concat(C[2].map((e=>o.Pq.TransformNormal(e,D))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[]));const w=o.uq.RotationY(Math.PI/2);b=b.concat(A[3].map((e=>o.Pq.TransformNormal(e,w).subtract(O))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[])),v=v.concat(C[3].map((e=>o.Pq.TransformNormal(e,w))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[]));const F=new o.Pq(0,p,0),L=o.uq.RotationX(Math.PI/2);b=b.concat(A[4].map((e=>o.Pq.TransformNormal(e,L).add(F))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[])),v=v.concat(C[4].map((e=>o.Pq.TransformNormal(e,L))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[]));const B=o.uq.RotationX(-Math.PI/2);b=b.concat(A[5].map((e=>o.Pq.TransformNormal(e,B).subtract(F))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[])),v=v.concat(C[5].map((e=>o.Pq.TransformNormal(e,B))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[])),W._ComputeSides(d,b,T,v,y);const N=new W;if(N.indices=T,N.positions=b,N.normals=v,N.uvs=y,i){const e=d===W.DOUBLESIDE?x.concat(x):x;N.colors=e}return N}function Ui(e,t){const i=new Xe(e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null);t.sideOrientation=Xe._GetDefaultSideOrientation(t.sideOrientation),i._originalBuilderSideOrientation=t.sideOrientation;return ki(t).applyToMesh(i,t.updatable),i}W.CreateTiledPlane=Bi;function Vi(e){const t=0|(e.segments||32),i=e.diameterX||e.diameter||1,r=e.diameterY||e.diameter||1,s=e.diameterZ||e.diameter||1,n=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1,a=e.slice&&e.slice<=0?1:e.slice||1,l=0===e.sideOrientation?0:e.sideOrientation||W.DEFAULTSIDE,h=!!e.dedupTopBottomIndices,c=new o.Pq(i/2,r/2,s/2),u=2+t,d=2*u,_=[],p=[],f=[],g=[];for(let b=0;b<=u;b++){const e=b/u,t=e*Math.PI*a;for(let i=0;i<=d;i++){const r=i/d,s=r*Math.PI*2*n,a=o.uq.RotationZ(-t),l=o.uq.RotationY(s),h=o.Pq.TransformCoordinates(o.Pq.Up(),a),u=o.Pq.TransformCoordinates(h,l),_=u.multiply(c),m=u.divide(c).normalize();p.push(_.x,_.y,_.z),f.push(m.x,m.y,m.z),g.push(r,X.rX?1-e:e)}if(b>0){const e=p.length/3;for(let t=e-2*(d+1);t+d+2<e;t++)h?(b>1&&(_.push(t),_.push(t+1),_.push(t+d+1)),(b<u||a<1)&&(_.push(t+d+1),_.push(t+1),_.push(t+d+2))):(_.push(t),_.push(t+1),_.push(t+d+1),_.push(t+d+1),_.push(t+1),_.push(t+d+2))}}W._ComputeSides(l,p,_,f,g,e.frontUVs,e.backUVs);const m=new W;return m.indices=_,m.positions=p,m.normals=f,m.uvs=g,m}function zi(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=new Xe(e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null);t.sideOrientation=Xe._GetDefaultSideOrientation(t.sideOrientation),i._originalBuilderSideOrientation=t.sideOrientation;return Vi(t).applyToMesh(i,t.updatable),i}W.CreateTiledBox=ki;function Gi(e){const t=e.height||2;let i=0===e.diameterTop?0:e.diameterTop||e.diameter||1,r=0===e.diameterBottom?0:e.diameterBottom||e.diameter||1;i=i||1e-5,r=r||1e-5;const s=0|(e.tessellation||24),n=0|(e.subdivisions||1),a=!!e.hasRings,l=!!e.enclose,h=0===e.cap?0:e.cap||Xe.CAP_ALL,c=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1,u=0===e.sideOrientation?0:e.sideOrientation||W.DEFAULTSIDE,d=e.faceUV||new Array(3),_=e.faceColors,p=2+(1+(1!==c&&l?2:0))*(a?n:1);let f;for(f=0;f<p;f++)_&&void 0===_[f]&&(_[f]=new E.ov(1,1,1,1));for(f=0;f<p;f++)d&&void 0===d[f]&&(d[f]=new o.IU(0,0,1,1));const g=[],m=[],b=[],v=[],y=[],T=2*Math.PI*c/s;let x,A,C;const R=(r-i)/2/t,S=o.Pq.Zero(),M=o.Pq.Zero(),P=o.Pq.Zero(),I=o.Pq.Zero(),O=o.Pq.Zero(),D=J._0.Y;let w,F,L,B=1,N=1,k=0,U=0;for(w=0;w<=n;w++)for(A=w/n,C=(A*(i-r)+r)/2,B=a&&0!==w&&w!==n?2:1,L=0;L<B;L++){for(a&&(N+=L),l&&(N+=2*L),F=0;F<=s;F++)x=F*T,S.x=Math.cos(-x)*C,S.y=-t/2+A*t,S.z=Math.sin(-x)*C,0===i&&w===n?(M.x=b[b.length-3*(s+1)],M.y=b[b.length-3*(s+1)+1],M.z=b[b.length-3*(s+1)+2]):(M.x=S.x,M.z=S.z,M.y=Math.sqrt(M.x*M.x+M.z*M.z)*R,M.normalize()),0===F&&(P.copyFrom(S),I.copyFrom(M)),m.push(S.x,S.y,S.z),b.push(M.x,M.y,M.z),U=a?k!==N?d[N].y:d[N].w:d[N].y+(d[N].w-d[N].y)*A,v.push(d[N].x+(d[N].z-d[N].x)*F/s,X.rX?1-U:U),_&&y.push(_[N].r,_[N].g,_[N].b,_[N].a);1!==c&&l&&(m.push(S.x,S.y,S.z),m.push(0,S.y,0),m.push(0,S.y,0),m.push(P.x,P.y,P.z),o.Pq.CrossToRef(D,M,O),O.normalize(),b.push(O.x,O.y,O.z,O.x,O.y,O.z),o.Pq.CrossToRef(I,D,O),O.normalize(),b.push(O.x,O.y,O.z,O.x,O.y,O.z),U=a?k!==N?d[N+1].y:d[N+1].w:d[N+1].y+(d[N+1].w-d[N+1].y)*A,v.push(d[N+1].x,X.rX?1-U:U),v.push(d[N+1].z,X.rX?1-U:U),U=a?k!==N?d[N+2].y:d[N+2].w:d[N+2].y+(d[N+2].w-d[N+2].y)*A,v.push(d[N+2].x,X.rX?1-U:U),v.push(d[N+2].z,X.rX?1-U:U),_&&(y.push(_[N+1].r,_[N+1].g,_[N+1].b,_[N+1].a),y.push(_[N+1].r,_[N+1].g,_[N+1].b,_[N+1].a),y.push(_[N+2].r,_[N+2].g,_[N+2].b,_[N+2].a),y.push(_[N+2].r,_[N+2].g,_[N+2].b,_[N+2].a))),k!==N&&(k=N)}const V=1!==c&&l?s+4:s;for(w=0,N=0;N<n;N++){let e=0,t=0,i=0,r=0;for(F=0;F<s;F++)e=w*(V+1)+F,t=(w+1)*(V+1)+F,i=w*(V+1)+(F+1),r=(w+1)*(V+1)+(F+1),g.push(e,t,i),g.push(r,i,t);1!==c&&l&&(g.push(e+2,t+2,i+2),g.push(r+2,i+2,t+2),g.push(e+4,t+4,i+4),g.push(r+4,i+4,t+4)),w=a?w+2:w+1}const z=e=>{const n=e?i/2:r/2;if(0===n)return;let a,l,h;const u=e?d[p-1]:d[0];let f=null;_&&(f=e?_[p-1]:_[0]);const T=m.length/3,x=e?t/2:-t/2,A=new o.Pq(0,x,0);m.push(A.x,A.y,A.z),b.push(0,e?1:-1,0);const C=u.y+.5*(u.w-u.y);v.push(u.x+.5*(u.z-u.x),X.rX?1-C:C),f&&y.push(f.r,f.g,f.b,f.a);const R=new o.I9(.5,.5);for(h=0;h<=s;h++){a=2*Math.PI*h*c/s;const t=Math.cos(-a),i=Math.sin(-a);l=new o.Pq(t*n,x,i*n);const r=new o.I9(t*R.x+.5,i*R.y+.5);m.push(l.x,l.y,l.z),b.push(0,e?1:-1,0);const d=u.y+(u.w-u.y)*r.y;v.push(u.x+(u.z-u.x)*r.x,X.rX?1-d:d),f&&y.push(f.r,f.g,f.b,f.a)}for(h=0;h<s;h++)e?(g.push(T),g.push(T+(h+2)),g.push(T+(h+1))):(g.push(T),g.push(T+(h+1)),g.push(T+(h+2)))};h!==Xe.CAP_START&&h!==Xe.CAP_ALL||z(!1),h!==Xe.CAP_END&&h!==Xe.CAP_ALL||z(!0),W._ComputeSides(u,m,g,b,v,e.frontUVs,e.backUVs);const G=new W;return G.indices=g,G.positions=m,G.normals=b,G.uvs=v,_&&(G.colors=y),G}function Hi(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=new Xe(e,arguments.length>2?arguments[2]:void 0);t.sideOrientation=Xe._GetDefaultSideOrientation(t.sideOrientation),i._originalBuilderSideOrientation=t.sideOrientation;return Gi(t).applyToMesh(i,t.updatable),i}W.CreateSphere=Vi,Xe.CreateSphere=(e,t,i,r,s,n)=>zi(e,{segments:t,diameterX:i,diameterY:i,diameterZ:i,sideOrientation:n,updatable:s},r);function Wi(e){const t=[],i=[],r=[],s=[],n=e.diameter||1,a=e.thickness||.5,l=0|(e.tessellation||16),h=0===e.sideOrientation?0:e.sideOrientation||W.DEFAULTSIDE,c=l+1;for(let d=0;d<=l;d++){const e=d/l,h=d*Math.PI*2/l-Math.PI/2,u=o.uq.Translation(n/2,0,0).multiply(o.uq.RotationY(h));for(let n=0;n<=l;n++){const h=1-n/l,_=n*Math.PI*2/l+Math.PI,p=Math.cos(_),f=Math.sin(_);let g=new o.Pq(p,f,0),m=g.scale(a/2);const b=new o.I9(e,h);m=o.Pq.TransformCoordinates(m,u),g=o.Pq.TransformNormal(g,u),i.push(m.x,m.y,m.z),r.push(g.x,g.y,g.z),s.push(b.x,X.rX?1-b.y:b.y);const v=(d+1)%c,y=(n+1)%c;t.push(d*c+n),t.push(d*c+y),t.push(v*c+n),t.push(d*c+y),t.push(v*c+y),t.push(v*c+n)}}W._ComputeSides(h,i,t,r,s,e.frontUVs,e.backUVs);const u=new W;return u.indices=t,u.positions=i,u.normals=r,u.uvs=s,u}function qi(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=new Xe(e,arguments.length>2?arguments[2]:void 0);t.sideOrientation=Xe._GetDefaultSideOrientation(t.sideOrientation),i._originalBuilderSideOrientation=t.sideOrientation;return Wi(t).applyToMesh(i,t.updatable),i}W.CreateCylinder=Gi,Xe.CreateCylinder=(e,t,i,r,s,n,a,o,l)=>{void 0!==a&&a instanceof Gt.Z||(void 0!==a&&(l=o||Xe.DEFAULTSIDE,o=a),a=n,n=1);return Hi(e,{height:t,diameterTop:i,diameterBottom:r,tessellation:s,subdivisions:n,sideOrientation:l,updatable:o},a)};function Xi(e){const t=[],i=[],r=[],s=[],n=e.radius||2,a=e.tube||.5,l=e.radialSegments||32,h=e.tubularSegments||32,c=e.p||2,u=e.q||3,d=0===e.sideOrientation?0:e.sideOrientation||W.DEFAULTSIDE,_=e=>{const t=Math.cos(e),i=Math.sin(e),r=u/c*e,s=Math.cos(r),a=n*(2+s)*.5*t,l=n*(2+s)*i*.5,h=n*Math.sin(r)*.5;return new o.Pq(a,l,h)};let p,f;for(p=0;p<=l;p++){const e=p%l/l*2*c*Math.PI,t=_(e),r=_(e+.01),n=r.subtract(t);let u=r.add(t);const d=o.Pq.Cross(n,u);for(u=o.Pq.Cross(d,n),d.normalize(),u.normalize(),f=0;f<h;f++){const e=f%h/h*2*Math.PI,r=-a*Math.cos(e),n=a*Math.sin(e);i.push(t.x+r*u.x+n*d.x),i.push(t.y+r*u.y+n*d.y),i.push(t.z+r*u.z+n*d.z),s.push(p/l),s.push(X.rX?1-f/h:f/h)}}for(p=0;p<l;p++)for(f=0;f<h;f++){const e=(f+1)%h,i=p*h+f,r=(p+1)*h+f,s=(p+1)*h+e,n=p*h+e;t.push(n),t.push(r),t.push(i),t.push(n),t.push(s),t.push(r)}W.ComputeNormals(i,t,r),W._ComputeSides(d,i,t,r,s,e.frontUVs,e.backUVs);const g=new W;return g.indices=t,g.positions=i,g.normals=r,g.uvs=s,g}function Ki(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=new Xe(e,arguments.length>2?arguments[2]:void 0);t.sideOrientation=Xe._GetDefaultSideOrientation(t.sideOrientation),i._originalBuilderSideOrientation=t.sideOrientation;return Xi(t).applyToMesh(i,t.updatable),i}W.CreateTorus=Wi,Xe.CreateTorus=(e,t,i,r,s,n,a)=>qi(e,{diameter:t,thickness:i,tessellation:r,sideOrientation:a,updatable:n},s);W.CreateTorusKnot=Xi,Xe.CreateTorusKnot=(e,t,i,r,s,n,a,o,l,h)=>Ki(e,{radius:t,tube:i,radialSegments:r,tubularSegments:s,p:n,q:a,sideOrientation:h,updatable:l},o),Xe._instancedMeshFactory=(e,t)=>{const i=new Yi(e,t);if(t.instancedBuffers){i.instancedBuffers={};for(const e in t.instancedBuffers)i.instancedBuffers[e]=t.instancedBuffers[e]}return i};class Yi extends re{constructor(e,t){super(e,t.getScene()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,t.addInstance(this),this._sourceMesh=t,this._unIndexed=t._unIndexed,this.position.copyFrom(t.position),this.rotation.copyFrom(t.rotation),this.scaling.copyFrom(t.scaling),t.rotationQuaternion&&(this.rotationQuaternion=t.rotationQuaternion.clone()),this.animations=t.animations.slice();for(const i of t.getAnimationRanges())null!=i&&this.createAnimationRange(i.name,i.from,i.to);this.infiniteDistance=t.infiniteDistance,this.setPivotMatrix(t.getPivotMatrix()),this.refreshBoundingInfo(!0,!0),this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(e){this._sourceMesh?.receiveShadows!==e&&_.S0.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(e){this._sourceMesh?.material!==e&&_.S0.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(e){this._sourceMesh?.visibility!==e&&_.S0.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(e){this._sourceMesh?.skeleton!==e&&_.S0.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(e){this._sourceMesh&&e!==this._sourceMesh.renderingGroupId&&T.V.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}createInstance(e){return this._sourceMesh.createInstance(e)}isReady(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(e,!0)}getVerticesData(e,t,i){return this._sourceMesh.getVerticesData(e,t,i)}copyVerticesData(e,t){this._sourceMesh.copyVerticesData(e,t)}setVerticesData(e,t,i,r){return this.sourceMesh&&this.sourceMesh.setVerticesData(e,t,i,r),this.sourceMesh}updateVerticesData(e,t,i,r){return this.sourceMesh&&this.sourceMesh.updateVerticesData(e,t,i,r),this.sourceMesh}setIndices(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(e,t),this.sourceMesh}isVerticesDataPresent(e){return this._sourceMesh.isVerticesDataPresent(e)}getIndices(){return this._sourceMesh.getIndices()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(){let e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;e="object"===typeof t?t:{applySkeleton:t,applyMorph:i};const r=this._sourceMesh.geometry?this._sourceMesh.geometry.boundingBias:null;return this._refreshBoundingInfo(this._sourceMesh._getData(e,null,S.R.PositionKind),r),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(e,t){if(super._activate(e,t),this._sourceMesh.subMeshes||T.V.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,e),t){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD.billboardMode!==j.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new o.uq);const e=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,o.AA.Vector3[7].copyFrom(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.copyFrom(this._currentLOD.computeWorldMatrix(!0)),this._currentLOD.position.copyFrom(o.AA.Vector3[7]),this._currentLOD._masterMesh=e,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(e){if(!e)return this;const t=this.sourceMesh.getLODLevels();if(t&&0!==t.length){const t=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(e,t.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(e){return this.sourceMesh._preActivateForIntermediateRendering(e)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.subMeshes)for(let e=0;e<this._sourceMesh.subMeshes.length;e++)this._sourceMesh.subMeshes[e].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}_updateBoundingInfo(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0;const r=((arguments.length>3?arguments[3]:void 0)||this._sourceMesh).createInstance(e);if(p.r.DeepCopy(this,r,["name","subMeshes","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","isWorldMatrixFrozen","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo"],[]),this.refreshBoundingInfo(),t&&(r.parent=t),!i)for(let s=0;s<this.getScene().meshes.length;s++){const e=this.getScene().meshes[s];e.parent===this&&e.clone(e.name,r)}return r.computeWorldMatrix(!0),this.onClonedObservable.notifyObservers(r),r}dispose(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.removeInstance(this),super.dispose(e,t)}_serializeAsParent(e){super._serializeAsParent(e),e.parentId=this._sourceMesh.uniqueId,e.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;const r=this.clone("Clone of "+(this.name||this.id),e||this.parent,!0,t&&t.newSourcedMesh);r&&i&&i(this,r);for(const s of this.getChildTransformNodes(!0))s.instantiateHierarchy(r,t,i);return r}}Xe.prototype.registerInstancedBuffer=function(e,t){if(this._userInstancedBuffersStorage?.vertexBuffers[e]?.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const e of this.instances)e.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[e]=null,this._userInstancedBuffersStorage.strides[e]=t,this._userInstancedBuffersStorage.sizes[e]=32*t,this._userInstancedBuffersStorage.data[e]=new Float32Array(this._userInstancedBuffersStorage.sizes[e]),this._userInstancedBuffersStorage.vertexBuffers[e]=new S.R(this.getEngine(),this._userInstancedBuffersStorage.data[e],e,!0,!1,t,!0);for(const i of this.instances)i.instancedBuffers[e]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},Xe.prototype._processInstancedBuffers=function(e,t){const i=e?e.length:0;for(const r in this.instancedBuffers){let s=this._userInstancedBuffersStorage.sizes[r];const n=this._userInstancedBuffersStorage.strides[r],a=(i+1)*n;for(;s<a;)s*=2;this._userInstancedBuffersStorage.data[r].length!=s&&(this._userInstancedBuffersStorage.data[r]=new Float32Array(s),this._userInstancedBuffersStorage.sizes[r]=s,this._userInstancedBuffersStorage.vertexBuffers[r]&&(this._userInstancedBuffersStorage.vertexBuffers[r].dispose(),this._userInstancedBuffersStorage.vertexBuffers[r]=null));const o=this._userInstancedBuffersStorage.data[r];let l=0;if(t){const e=this.instancedBuffers[r];e.toArray?e.toArray(o,l):e.copyToArray?e.copyToArray(o,l):o[l]=e,l+=n}for(let t=0;t<i;t++){const i=e[t].instancedBuffers[r];i.toArray?i.toArray(o,l):i.copyToArray?i.copyToArray(o,l):o[l]=i,l+=n}this._userInstancedBuffersStorage.vertexBuffers[r]?this._userInstancedBuffersStorage.vertexBuffers[r].updateDirectly(o,0):(this._userInstancedBuffersStorage.vertexBuffers[r]=new S.R(this.getEngine(),this._userInstancedBuffersStorage.data[r],r,!0,!1,n,!0),this._invalidateInstanceVertexArrayObject())}},Xe.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const e in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[e]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},Xe.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const e in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[e]&&this._userInstancedBuffersStorage.vertexBuffers[e].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,x.Y5)("BABYLON.InstancedMesh",Yi);const ji={effect:null,subMesh:null};class Qi extends ri{constructor(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(e,t,!(arguments.length>4&&void 0!==arguments[4])||arguments[4]),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new o.uq,this._cachedWorldViewProjectionMatrix=new o.uq,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=i,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","normal","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...r}}get shaderPath(){return this._shaderPath}set shaderPath(e){this._shaderPath=e}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(e){-1===this._options.uniforms.indexOf(e)&&this._options.uniforms.push(e)}setTexture(e,t){return-1===this._options.samplers.indexOf(e)&&this._options.samplers.push(e),this._textures[e]=t,this}setTextureArray(e,t){return-1===this._options.samplers.indexOf(e)&&this._options.samplers.push(e),this._checkUniform(e),this._textureArrays[e]=t,this}setExternalTexture(e,t){return-1===this._options.externalTextures.indexOf(e)&&this._options.externalTextures.push(e),this._externalTextures[e]=t,this}setFloat(e,t){return this._checkUniform(e),this._floats[e]=t,this}setInt(e,t){return this._checkUniform(e),this._ints[e]=t,this}setUInt(e,t){return this._checkUniform(e),this._uints[e]=t,this}setFloats(e,t){return this._checkUniform(e),this._floatsArrays[e]=t,this}setColor3(e,t){return this._checkUniform(e),this._colors3[e]=t,this}setColor3Array(e,t){return this._checkUniform(e),this._colors3Arrays[e]=t.reduce(((e,t)=>(t.toArray(e,e.length),e)),[]),this}setColor4(e,t){return this._checkUniform(e),this._colors4[e]=t,this}setColor4Array(e,t){return this._checkUniform(e),this._colors4Arrays[e]=t.reduce(((e,t)=>(t.toArray(e,e.length),e)),[]),this}setVector2(e,t){return this._checkUniform(e),this._vectors2[e]=t,this}setVector3(e,t){return this._checkUniform(e),this._vectors3[e]=t,this}setVector4(e,t){return this._checkUniform(e),this._vectors4[e]=t,this}setQuaternion(e,t){return this._checkUniform(e),this._quaternions[e]=t,this}setQuaternionArray(e,t){return this._checkUniform(e),this._quaternionsArrays[e]=t.reduce(((e,t)=>(t.toArray(e,e.length),e)),[]),this}setMatrix(e,t){return this._checkUniform(e),this._matrices[e]=t,this}setMatrices(e,t){this._checkUniform(e);const i=new Float32Array(16*t.length);for(let r=0;r<t.length;r++){t[r].copyToArray(i,16*r)}return this._matrixArrays[e]=i,this}setMatrix3x3(e,t){return this._checkUniform(e),this._matrices3x3[e]=t,this}setMatrix2x2(e,t){return this._checkUniform(e),this._matrices2x2[e]=t,this}setArray2(e,t){return this._checkUniform(e),this._vectors2Arrays[e]=t,this}setArray3(e,t){return this._checkUniform(e),this._vectors3Arrays[e]=t,this}setArray4(e,t){return this._checkUniform(e),this._vectors4Arrays[e]=t,this}setUniformBuffer(e,t){return-1===this._options.uniformBuffers.indexOf(e)&&this._options.uniformBuffers.push(e),this._uniformBuffers[e]=t,this}setTextureSampler(e,t){return-1===this._options.samplerObjects.indexOf(e)&&this._options.samplerObjects.push(e),this._textureSamplers[e]=t,this}setStorageBuffer(e,t){return-1===this._options.storageBuffers.indexOf(e)&&this._options.storageBuffers.push(e),this._storageBuffers[e]=t,this}setDefine(e,t){const i=e.trimEnd()+" ",r=this.options.defines.findIndex((t=>t===e||t.startsWith(i)));return r>=0&&this.options.defines.splice(r,1),("boolean"!==typeof t||t)&&this.options.defines.push(i+t),this}isReadyForSubMesh(e,t,i){return this.isReady(e,i,t)}isReady(e,t,i){const r=i&&this._storeEffectOnSubMeshes;if(this.isFrozen){const e=r?i._drawWrapper:this._drawWrapper;if(e.effect&&e._wasPreviouslyReady&&e._wasPreviouslyUsingInstances===t)return!0}const s=this.getScene(),n=s.getEngine(),a=[],o=[],l=new ni;let h=this._shaderPath,c=this._options.uniforms,u=this._options.uniformBuffers,d=this._options.samplers;n.getCaps().multiview&&s.activeCamera&&s.activeCamera.outputRenderTarget&&s.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,a.push("#define MULTIVIEW"),-1!==c.indexOf("viewProjection")&&-1===c.indexOf("viewProjectionR")&&c.push("viewProjectionR"));for(let y=0;y<this._options.defines.length;y++){const e=0===this._options.defines[y].indexOf("#define")?this._options.defines[y]:`#define ${this._options.defines[y]}`;a.push(e)}for(let y=0;y<this._options.attributes.length;y++)o.push(this._options.attributes[y]);if(e&&e.isVerticesDataPresent(S.R.ColorKind)&&(-1===o.indexOf(S.R.ColorKind)&&o.push(S.R.ColorKind),a.push("#define VERTEXCOLOR")),t&&(a.push("#define INSTANCES"),pe(o,this._materialHelperNeedsPreviousMatrices),e?.hasThinInstances&&(a.push("#define THIN_INSTANCES"),e&&e.isVerticesDataPresent(S.R.ColorInstanceKind)&&(o.push(S.R.ColorInstanceKind),a.push("#define INSTANCESCOLOR")))),e&&e.useBones&&e.computeBonesUsingShaders&&e.skeleton){o.push(S.R.MatricesIndicesKind),o.push(S.R.MatricesWeightsKind),e.numBoneInfluencers>4&&(o.push(S.R.MatricesIndicesExtraKind),o.push(S.R.MatricesWeightsExtraKind));const t=e.skeleton;a.push("#define NUM_BONE_INFLUENCERS "+e.numBoneInfluencers),l.addCPUSkinningFallback(0,e),t.isUsingTextureForMatrices?(a.push("#define BONETEXTURE"),-1===c.indexOf("boneTextureWidth")&&c.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(a.push("#define BonesPerMesh "+(t.bones.length+1)),-1===c.indexOf("mBones")&&c.push("mBones"))}else a.push("#define NUM_BONE_INFLUENCERS 0");let _=0;const p=e?e.morphTargetManager:null;if(p){const e=p.supportsUVs&&-1!==a.indexOf("#define UV1"),t=p.supportsTangents&&-1!==a.indexOf("#define TANGENT"),i=p.supportsNormals&&-1!==a.indexOf("#define NORMAL");_=p.numMaxInfluencers||p.numInfluencers,e&&a.push("#define MORPHTARGETS_UV"),t&&a.push("#define MORPHTARGETS_TANGENT"),i&&a.push("#define MORPHTARGETS_NORMAL"),_>0&&a.push("#define MORPHTARGETS"),p.isUsingTextureForTargets&&(a.push("#define MORPHTARGETS_TEXTURE"),-1===c.indexOf("morphTargetTextureIndices")&&c.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),a.push("#define NUM_MORPH_INFLUENCERS "+_);for(let r=0;r<_;r++)o.push(S.R.PositionKind+r),i&&o.push(S.R.NormalKind+r),t&&o.push(S.R.TangentKind+r),e&&o.push(S.R.UVKind+"_"+r);_>0&&(c=c.slice(),c.push("morphTargetInfluences"),c.push("morphTargetCount"),c.push("morphTargetTextureInfo"),c.push("morphTargetTextureIndices"))}else a.push("#define NUM_MORPH_INFLUENCERS 0");if(e){const t=e.bakedVertexAnimationManager;t&&t.isEnabled&&(a.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===c.indexOf("bakedVertexAnimationSettings")&&c.push("bakedVertexAnimationSettings"),-1===c.indexOf("bakedVertexAnimationTextureSizeInverted")&&c.push("bakedVertexAnimationTextureSizeInverted"),-1===c.indexOf("bakedVertexAnimationTime")&&c.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),ve(o,0,a)}for(const y in this._textures)if(!this._textures[y].isReady())return!1;e&&this._shouldTurnAlphaTestOn(e)&&a.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&(oe(c),function(e,t,i){const r=!!(e.clipPlane??t.clipPlane),s=!!(e.clipPlane2??t.clipPlane2),n=!!(e.clipPlane3??t.clipPlane3),a=!!(e.clipPlane4??t.clipPlane4),o=!!(e.clipPlane5??t.clipPlane5),l=!!(e.clipPlane6??t.clipPlane6);r&&i.push("#define CLIPPLANE"),s&&i.push("#define CLIPPLANE2"),n&&i.push("#define CLIPPLANE3"),a&&i.push("#define CLIPPLANE4"),o&&i.push("#define CLIPPLANE5"),l&&i.push("#define CLIPPLANE6")}(this,s,a)),s.fogEnabled&&e?.applyFog&&s.fogMode!==Gt.Z.FOGMODE_NONE&&(a.push("#define FOG"),-1===c.indexOf("view")&&c.push("view"),-1===c.indexOf("vFogInfos")&&c.push("vFogInfos"),-1===c.indexOf("vFogColor")&&c.push("vFogColor")),this._useLogarithmicDepth&&(a.push("#define LOGARITHMICDEPTH"),-1===c.indexOf("logarithmicDepthConstant")&&c.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(c=c.slice(),u=u.slice(),d=d.slice(),h=this.customShaderNameResolve(this.name,c,u,d,a,o));const f=r?i._getDrawWrapper(void 0,!0):this._drawWrapper,g=f?.effect??null,m=f?.defines??null,b=a.join("\n");let v=g;return m!==b&&(v=n.createEffect(h,{attributes:o,uniformsNames:c,uniformBuffersNames:u,samplers:d,defines:b,fallbacks:l,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:_},shaderLanguage:this._options.shaderLanguage,extraInitializationsAsync:this._options.extraInitializationsAsync},n),r?i.setEffect(v,b,this._materialContext):f&&f.setEffect(v,b),this._onEffectCreatedObservable&&(ji.effect=v,ji.subMesh=i??e?.subMeshes[0]??null,this._onEffectCreatedObservable.notifyObservers(ji))),f._wasPreviouslyUsingInstances=!!t,!(!v?.isReady()??1)&&(g!==v&&s.resetCachedMaterial(),f._wasPreviouslyReady=!0,!0)}bindOnlyWorldMatrix(e,t){const i=this.getScene(),r=t??this.getEffect();r&&(-1!==this._options.uniforms.indexOf("world")&&r.setMatrix("world",e),-1!==this._options.uniforms.indexOf("worldView")&&(e.multiplyToRef(i.getViewMatrix(),this._cachedWorldViewMatrix),r.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&(e.multiplyToRef(i.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),r.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==this._options.uniforms.indexOf("view")&&r.setMatrix("view",i.getViewMatrix()))}bindForSubMesh(e,t,i){this.bind(e,t,i._drawWrapperOverride?.effect,i)}bind(e,t,i,r){const s=r&&this._storeEffectOnSubMeshes,n=i??(s?r.effect:this.getEffect());if(!n)return;const a=this.getScene();this._activeEffect=n,this.bindOnlyWorldMatrix(e,i);const o=this._options.uniformBuffers;let l=!1;if(n&&o&&o.length>0&&a.getEngine().supportsUniformBuffers)for(let c=0;c<o.length;++c){switch(o[c]){case"Mesh":t&&(t.getMeshUniformBuffer().bindToEffect(n,"Mesh"),t.transferToEffect(e));break;case"Scene":ge(n,a.getSceneUniformBuffer()),a.finalizeSceneUbo(),l=!0}}const h=t&&s?this._mustRebind(a,n,r,t.visibility):a.getCachedMaterial()!==this;if(n&&h){let e;for(e in l||-1===this._options.uniforms.indexOf("view")||n.setMatrix("view",a.getViewMatrix()),l||-1===this._options.uniforms.indexOf("projection")||n.setMatrix("projection",a.getProjectionMatrix()),l||-1===this._options.uniforms.indexOf("viewProjection")||(n.setMatrix("viewProjection",a.getTransformMatrix()),this._multiview&&n.setMatrix("viewProjectionR",a._transformMatrixR)),a.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&n.setVector3("cameraPosition",a.activeCamera.globalPosition),ye(t,n),le(n,this,a),this._useLogarithmicDepth&&ue(s?r.materialDefines:n.defines,n,a),t&&de(a,t,n),this._textures)n.setTexture(e,this._textures[e]);for(e in this._textureArrays)n.setTextureArray(e,this._textureArrays[e]);for(e in this._ints)n.setInt(e,this._ints[e]);for(e in this._uints)n.setUInt(e,this._uints[e]);for(e in this._floats)n.setFloat(e,this._floats[e]);for(e in this._floatsArrays)n.setArray(e,this._floatsArrays[e]);for(e in this._colors3)n.setColor3(e,this._colors3[e]);for(e in this._colors3Arrays)n.setArray3(e,this._colors3Arrays[e]);for(e in this._colors4){const t=this._colors4[e];n.setFloat4(e,t.r,t.g,t.b,t.a)}for(e in this._colors4Arrays)n.setArray4(e,this._colors4Arrays[e]);for(e in this._vectors2)n.setVector2(e,this._vectors2[e]);for(e in this._vectors3)n.setVector3(e,this._vectors3[e]);for(e in this._vectors4)n.setVector4(e,this._vectors4[e]);for(e in this._quaternions)n.setQuaternion(e,this._quaternions[e]);for(e in this._matrices)n.setMatrix(e,this._matrices[e]);for(e in this._matrixArrays)n.setMatrices(e,this._matrixArrays[e]);for(e in this._matrices3x3)n.setMatrix3x3(e,this._matrices3x3[e]);for(e in this._matrices2x2)n.setMatrix2x2(e,this._matrices2x2[e]);for(e in this._vectors2Arrays)n.setArray2(e,this._vectors2Arrays[e]);for(e in this._vectors3Arrays)n.setArray3(e,this._vectors3Arrays[e]);for(e in this._vectors4Arrays)n.setArray4(e,this._vectors4Arrays[e]);for(e in this._quaternionsArrays)n.setArray4(e,this._quaternionsArrays[e]);for(e in this._uniformBuffers){const t=this._uniformBuffers[e].getBuffer();t&&n.bindUniformBuffer(t,e)}const i=a.getEngine(),o=i.setExternalTexture;if(o)for(e in this._externalTextures)o.call(i,e,this._externalTextures[e]);const h=i.setTextureSampler;if(h)for(e in this._textureSamplers)h.call(i,e,this._textureSamplers[e]);const c=i.setStorageBuffer;if(c)for(e in this._storageBuffers)c.call(i,e,this._storageBuffers[e])}if(n&&t&&(h||!this.isFrozen)){const e=t.morphTargetManager;e&&e.numInfluencers>0&&fe(t,n);const i=t.bakedVertexAnimationManager;if(i&&i.isEnabled){const e=s?r._drawWrapper:this._drawWrapper;t.bakedVertexAnimationManager?.bind(n,!!e._wasPreviouslyUsingInstances)}}this._afterBind(t,n,r)}getActiveTextures(){const e=super.getActiveTextures();for(const t in this._textures)e.push(this._textures[t]);for(const t in this._textureArrays){const i=this._textureArrays[t];for(let t=0;t<i.length;t++)e.push(i[t])}return e}hasTexture(e){if(super.hasTexture(e))return!0;for(const t in this._textures)if(this._textures[t]===e)return!0;for(const t in this._textureArrays){const i=this._textureArrays[t];for(let t=0;t<i.length;t++)if(i[t]===e)return!0}return!1}clone(e){const t=c.p.Clone((()=>new Qi(e,this.getScene(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);t.name=e,t.id=e,"object"===typeof t._shaderPath&&(t._shaderPath={...t._shaderPath}),this._options={...this._options},Object.keys(this._options).forEach((e=>{const t=this._options[e];Array.isArray(t)&&(this._options[e]=t.slice(0))})),this.stencil.copyTo(t.stencil);for(const i in this._textures)t.setTexture(i,this._textures[i]);for(const i in this._textureArrays)t.setTextureArray(i,this._textureArrays[i]);for(const i in this._externalTextures)t.setExternalTexture(i,this._externalTextures[i]);for(const i in this._ints)t.setInt(i,this._ints[i]);for(const i in this._uints)t.setUInt(i,this._uints[i]);for(const i in this._floats)t.setFloat(i,this._floats[i]);for(const i in this._floatsArrays)t.setFloats(i,this._floatsArrays[i]);for(const i in this._colors3)t.setColor3(i,this._colors3[i]);for(const i in this._colors3Arrays)t._colors3Arrays[i]=this._colors3Arrays[i];for(const i in this._colors4)t.setColor4(i,this._colors4[i]);for(const i in this._colors4Arrays)t._colors4Arrays[i]=this._colors4Arrays[i];for(const i in this._vectors2)t.setVector2(i,this._vectors2[i]);for(const i in this._vectors3)t.setVector3(i,this._vectors3[i]);for(const i in this._vectors4)t.setVector4(i,this._vectors4[i]);for(const i in this._quaternions)t.setQuaternion(i,this._quaternions[i]);for(const i in this._quaternionsArrays)t._quaternionsArrays[i]=this._quaternionsArrays[i];for(const i in this._matrices)t.setMatrix(i,this._matrices[i]);for(const i in this._matrixArrays)t._matrixArrays[i]=this._matrixArrays[i].slice();for(const i in this._matrices3x3)t.setMatrix3x3(i,this._matrices3x3[i]);for(const i in this._matrices2x2)t.setMatrix2x2(i,this._matrices2x2[i]);for(const i in this._vectors2Arrays)t.setArray2(i,this._vectors2Arrays[i]);for(const i in this._vectors3Arrays)t.setArray3(i,this._vectors3Arrays[i]);for(const i in this._vectors4Arrays)t.setArray4(i,this._vectors4Arrays[i]);for(const i in this._uniformBuffers)t.setUniformBuffer(i,this._uniformBuffers[i]);for(const i in this._textureSamplers)t.setTextureSampler(i,this._textureSamplers[i]);for(const i in this._storageBuffers)t.setStorageBuffer(i,this._storageBuffers[i]);return t}dispose(e,t,i){if(t){let e;for(e in this._textures)this._textures[e].dispose();for(e in this._textureArrays){const t=this._textureArrays[e];for(let e=0;e<t.length;e++)t[e].dispose()}}this._textures={},super.dispose(e,t,i)}serialize(){const e=c.p.Serialize(this);let t;for(t in e.customType="BABYLON.ShaderMaterial",e.uniqueId=this.uniqueId,e.options=this._options,e.shaderPath=this._shaderPath,e.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,e.stencil=this.stencil.serialize(),e.textures={},this._textures)e.textures[t]=this._textures[t].serialize();for(t in e.textureArrays={},this._textureArrays){e.textureArrays[t]=[];const i=this._textureArrays[t];for(let r=0;r<i.length;r++)e.textureArrays[t].push(i[r].serialize())}for(t in e.ints={},this._ints)e.ints[t]=this._ints[t];for(t in e.uints={},this._uints)e.uints[t]=this._uints[t];for(t in e.floats={},this._floats)e.floats[t]=this._floats[t];for(t in e.floatsArrays={},this._floatsArrays)e.floatsArrays[t]=this._floatsArrays[t];for(t in e.colors3={},this._colors3)e.colors3[t]=this._colors3[t].asArray();for(t in e.colors3Arrays={},this._colors3Arrays)e.colors3Arrays[t]=this._colors3Arrays[t];for(t in e.colors4={},this._colors4)e.colors4[t]=this._colors4[t].asArray();for(t in e.colors4Arrays={},this._colors4Arrays)e.colors4Arrays[t]=this._colors4Arrays[t];for(t in e.vectors2={},this._vectors2)e.vectors2[t]=this._vectors2[t].asArray();for(t in e.vectors3={},this._vectors3)e.vectors3[t]=this._vectors3[t].asArray();for(t in e.vectors4={},this._vectors4)e.vectors4[t]=this._vectors4[t].asArray();for(t in e.quaternions={},this._quaternions)e.quaternions[t]=this._quaternions[t].asArray();for(t in e.matrices={},this._matrices)e.matrices[t]=this._matrices[t].asArray();for(t in e.matrixArray={},this._matrixArrays)e.matrixArray[t]=this._matrixArrays[t];for(t in e.matrices3x3={},this._matrices3x3)e.matrices3x3[t]=this._matrices3x3[t];for(t in e.matrices2x2={},this._matrices2x2)e.matrices2x2[t]=this._matrices2x2[t];for(t in e.vectors2Arrays={},this._vectors2Arrays)e.vectors2Arrays[t]=this._vectors2Arrays[t];for(t in e.vectors3Arrays={},this._vectors3Arrays)e.vectors3Arrays[t]=this._vectors3Arrays[t];for(t in e.vectors4Arrays={},this._vectors4Arrays)e.vectors4Arrays[t]=this._vectors4Arrays[t];for(t in e.quaternionsArrays={},this._quaternionsArrays)e.quaternionsArrays[t]=this._quaternionsArrays[t];return e}static Parse(e,t,i){const r=c.p.Parse((()=>new Qi(e.name,t,e.shaderPath,e.options,e.storeEffectOnSubMeshes)),e,t,i);let s;for(s in e.stencil&&r.stencil.parse(e.stencil,t,i),e.textures)r.setTexture(s,kt.g.Parse(e.textures[s],t,i));for(s in e.textureArrays){const n=e.textureArrays[s],a=[];for(let e=0;e<n.length;e++)a.push(kt.g.Parse(n[e],t,i));r.setTextureArray(s,a)}for(s in e.ints)r.setInt(s,e.ints[s]);for(s in e.uints)r.setUInt(s,e.uints[s]);for(s in e.floats)r.setFloat(s,e.floats[s]);for(s in e.floatsArrays)r.setFloats(s,e.floatsArrays[s]);for(s in e.colors3)r.setColor3(s,E.v9.FromArray(e.colors3[s]));for(s in e.colors3Arrays){const t=e.colors3Arrays[s].reduce(((e,t,i)=>(i%3===0?e.push([t]):e[e.length-1].push(t),e)),[]).map((e=>E.v9.FromArray(e)));r.setColor3Array(s,t)}for(s in e.colors4)r.setColor4(s,E.ov.FromArray(e.colors4[s]));for(s in e.colors4Arrays){const t=e.colors4Arrays[s].reduce(((e,t,i)=>(i%4===0?e.push([t]):e[e.length-1].push(t),e)),[]).map((e=>E.ov.FromArray(e)));r.setColor4Array(s,t)}for(s in e.vectors2)r.setVector2(s,o.I9.FromArray(e.vectors2[s]));for(s in e.vectors3)r.setVector3(s,o.Pq.FromArray(e.vectors3[s]));for(s in e.vectors4)r.setVector4(s,o.IU.FromArray(e.vectors4[s]));for(s in e.quaternions)r.setQuaternion(s,o.PT.FromArray(e.quaternions[s]));for(s in e.matrices)r.setMatrix(s,o.uq.FromArray(e.matrices[s]));for(s in e.matrixArray)r._matrixArrays[s]=new Float32Array(e.matrixArray[s]);for(s in e.matrices3x3)r.setMatrix3x3(s,e.matrices3x3[s]);for(s in e.matrices2x2)r.setMatrix2x2(s,e.matrices2x2[s]);for(s in e.vectors2Arrays)r.setArray2(s,e.vectors2Arrays[s]);for(s in e.vectors3Arrays)r.setArray3(s,e.vectors3Arrays[s]);for(s in e.vectors4Arrays)r.setArray4(s,e.vectors4Arrays[s]);for(s in e.quaternionsArrays)r.setArray4(s,e.quaternionsArrays[s]);return r}static ParseFromFileAsync(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return new Promise(((s,n)=>{const a=new st.u;a.addEventListener("readystatechange",(()=>{if(4==a.readyState)if(200==a.status){const t=JSON.parse(a.responseText),n=this.Parse(t,i||l.q.LastCreatedScene,r);e&&(n.name=e),s(n)}else n("Unable to load the ShaderMaterial")})),a.open("GET",t),a.send()}))}static ParseFromSnippetAsync(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Promise(((r,s)=>{const n=new st.u;n.addEventListener("readystatechange",(()=>{if(4==n.readyState)if(200==n.status){const s=JSON.parse(JSON.parse(n.responseText).jsonPayload),a=JSON.parse(s.shaderMaterial),o=this.Parse(a,t||l.q.LastCreatedScene,i);o.snippetId=e,r(o)}else s("Unable to load the snippet "+e)})),n.open("GET",this.SnippetUrl+"/"+e.replace(/#/g,"/")),n.send()}))}}Qi.SnippetUrl="https://snippet.babylonjs.com",Qi.CreateFromSnippetAsync=Qi.ParseFromSnippetAsync,(0,x.Y5)("BABYLON.ShaderMaterial",Qi),Xe._LinesMeshParser=(e,t)=>$i.Parse(e,t);class $i extends Xe{_isShaderMaterial(e){return"ShaderMaterial"===e.getClassName()}constructor(e){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>5?arguments[5]:void 0,s=arguments.length>6?arguments[6]:void 0,n=arguments.length>7?arguments[7]:void 0;super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,t,arguments.length>4?arguments[4]:void 0),this.useVertexColor=r,this.useVertexAlpha=s,this.color=new E.v9(1,1,1),this.alpha=1,this._shaderLanguage=0,t&&(this.color=t.color.clone(),this.alpha=t.alpha,this.useVertexColor=t.useVertexColor,this.useVertexAlpha=t.useVertexAlpha),this.intersectionThreshold=.1;const a={attributes:[S.R.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};if(!1===s?a.needAlphaBlending=!1:a.defines.push("#define VERTEXALPHA"),r?(a.defines.push("#define VERTEXCOLOR"),a.attributes.push(S.R.ColorKind)):(a.uniforms.push("color"),this._color4=new E.ov),n)this.material=n;else{this.getScene().getEngine().isWebGPU&&!$i.ForceGLSL&&(this._shaderLanguage=1),a.shaderLanguage=this._shaderLanguage,a.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([i.e(574).then(i.bind(i,5574)),i.e(912).then(i.bind(i,7912))]):await Promise.all([i.e(825).then(i.bind(i,2825)),i.e(351).then(i.bind(i,4351))])},this.material=new Qi("colorShader",this.getScene(),"color",a,!1),this.material.doNotSerialize=!0}}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(e){this._lineMaterial=e,this._lineMaterial.fillMode=Ne.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(e){}_bind(e,t){if(!this._geometry)return this;const i=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(t,i):this._geometry._bind(t,i,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:e,g:t,b:i}=this.color;this._color4.set(e,t,i,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(e,t,i){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const r=this.getScene().getEngine();return this._unIndexed?r.drawArraysType(Ne.LineListDrawMode,e.verticesStart,e.verticesCount,i):r.drawElementsType(Ne.LineListDrawMode,e.indexStart,e.indexCount,i),this}dispose(e){(arguments.length>2?arguments[2]:void 0)||this._lineMaterial.dispose(!1,!1,!0),super.dispose(e)}clone(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0;return new $i(e,this.getScene(),t,this,i)}createInstance(e){const t=new Zi(e,this);if(this.instancedBuffers){t.instancedBuffers={};for(const e in this.instancedBuffers)t.instancedBuffers[e]=this.instancedBuffers[e]}return t}serialize(e){super.serialize(e),e.color=this.color.asArray(),e.alpha=this.alpha}static Parse(e,t){const i=new $i(e.name,t);return i.color=E.v9.FromArray(e.color),i.alpha=e.alpha,i}}$i.ForceGLSL=!1;class Zi extends Yi{constructor(e,t){super(e,t),this.intersectionThreshold=t.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}function Ji(e){const t=[],i=[],r=e.lines,s=e.colors,n=[];let a=0;for(let l=0;l<r.length;l++){const e=r[l];for(let r=0;r<e.length;r++){const{x:o,y:h,z:c}=e[r];if(i.push(o,h,c),s){const e=s[l],{r:t,g:i,b:a,a:o}=e[r];n.push(t,i,a,o)}r>0&&(t.push(a-1),t.push(a)),a++}}const o=new W;return o.indices=t,o.positions=i,s&&(o.colors=n),o}function er(e){const t=e.dashSize||3,i=e.gapSize||1,r=e.dashNb||200,s=e.points,n=[],a=[],l=o.Pq.Zero();let h=0,c=0,u=0,d=0,_=0,p=0,f=0;for(f=0;f<s.length-1;f++)s[f+1].subtractToRef(s[f],l),h+=l.length();for(u=h/r,d=t*u/(t+i),f=0;f<s.length-1;f++){s[f+1].subtractToRef(s[f],l),c=Math.floor(l.length()/u),l.normalize();for(let e=0;e<c;e++)_=u*e,n.push(s[f].x+_*l.x,s[f].y+_*l.y,s[f].z+_*l.z),n.push(s[f].x+(_+d)*l.x,s[f].y+(_+d)*l.y,s[f].z+(_+d)*l.z),a.push(p,p+1),p+=2}const g=new W;return g.positions=n,g.indices=a,g}function tr(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=t.instance,s=t.lines,n=t.colors;if(r){const e=r.getVerticesData(S.R.PositionKind);let t,i;n&&(t=r.getVerticesData(S.R.ColorKind));let a=0,o=0;for(let r=0;r<s.length;r++){const l=s[r];for(let s=0;s<l.length;s++)e[a]=l[s].x,e[a+1]=l[s].y,e[a+2]=l[s].z,n&&t&&(i=n[r],t[o]=i[s].r,t[o+1]=i[s].g,t[o+2]=i[s].b,t[o+3]=i[s].a,o+=4),a+=3}return r.updateVerticesData(S.R.PositionKind,e,!1,!1),n&&t&&r.updateVerticesData(S.R.ColorKind,t,!1,!1),r.refreshBoundingInfo(),r}const a=new $i(e,i,null,void 0,void 0,!!n,t.useVertexAlpha,t.material);return Ji(t).applyToMesh(a,t.updatable),a}function ir(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=t.colors?[t.colors]:null;return tr(e,{lines:[t.points],updatable:t.updatable,instance:t.instance,colors:r,useVertexAlpha:t.useVertexAlpha,material:t.material},i)}function rr(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=t.points,s=t.instance,n=t.gapSize||1,a=t.dashSize||3;if(s){const e=e=>{const t=o.Pq.Zero(),i=e.length/6;let n=0,a=0,l=0,h=0,c=0,u=0,d=0,_=0;for(d=0;d<r.length-1;d++)r[d+1].subtractToRef(r[d],t),n+=t.length();l=n/i;const p=s._creationDataStorage.dashSize;for(h=p*l/(p+s._creationDataStorage.gapSize),d=0;d<r.length-1;d++)for(r[d+1].subtractToRef(r[d],t),a=Math.floor(t.length()/l),t.normalize(),_=0;_<a&&u<e.length;)c=l*_,e[u]=r[d].x+c*t.x,e[u+1]=r[d].y+c*t.y,e[u+2]=r[d].z+c*t.z,e[u+3]=r[d].x+(c+h)*t.x,e[u+4]=r[d].y+(c+h)*t.y,e[u+5]=r[d].z+(c+h)*t.z,u+=6,_++;for(;u<e.length;)e[u]=r[d].x,e[u+1]=r[d].y,e[u+2]=r[d].z,u+=3};return(t.dashNb||t.dashSize||t.gapSize||t.useVertexAlpha||t.material)&&T.V.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),s.updateMeshPositions(e,!1),s}const l=new $i(e,i,null,void 0,void 0,void 0,t.useVertexAlpha,t.material);return er(t).applyToMesh(l,t.updatable),l._creationDataStorage=new ze,l._creationDataStorage.dashSize=a,l._creationDataStorage.gapSize=n,l}W.CreateLineSystem=Ji,W.CreateDashedLines=er,Xe.CreateLines=function(e,t){return ir(e,{points:t,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},Xe.CreateDashedLines=function(e,t,i,r,s){return rr(e,{points:t,dashSize:i,gapSize:r,dashNb:s,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)};class sr extends o.I9{constructor(e,t){super(e.x,e.y),this.index=t}}class nr{constructor(){this.elements=[]}add(e){const t=[];return e.forEach((e=>{const i=new sr(e,this.elements.length);t.push(i),this.elements.push(i)})),t}computeBounds(){const e=new o.I9(this.elements[0].x,this.elements[0].y),t=new o.I9(this.elements[0].x,this.elements[0].y);return this.elements.forEach((i=>{i.x<e.x?e.x=i.x:i.x>t.x&&(t.x=i.x),i.y<e.y?e.y=i.y:i.y>t.y&&(t.y=i.y)})),{min:e,max:t,width:t.x-e.x,height:t.y-e.y}}}class ar{_addToepoint(e){for(const t of e)this._epoints.push(t.x,t.y)}constructor(e,t,i){let r,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;this._points=new nr,this._outlinepoints=new nr,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=s,this._name=e,this._scene=i||l.q.LastCreatedScene,r=t instanceof Qe.Cu?t.getPoints():t,this._addToepoint(r),this._points.add(r),this._outlinepoints.add(r),"undefined"===typeof this.bjsEarcut&&T.V.Warn("Earcut was not found, the polygon will not be built.")}addHole(e){this._points.add(e);const t=new nr;return t.add(e),this._holes.push(t),this._eholes.push(this._epoints.length/2),this._addToepoint(e),this}build(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const r=new Xe(this._name,this._scene),s=this.buildVertexData(t,i);return r.setVerticesData(S.R.PositionKind,s.positions,e),r.setVerticesData(S.R.NormalKind,s.normals,e),r.setVerticesData(S.R.UVKind,s.uvs,e),r.setIndices(s.indices),r}buildVertexData(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const i=new W,r=[],s=[],n=[],a=this._points.computeBounds();this._points.elements.forEach((e=>{r.push(0,1,0),s.push(e.x,0,e.y),n.push((e.x-a.min.x)/a.width,(e.y-a.min.y)/a.height)}));const o=[],l=this.bjsEarcut(this._epoints,this._eholes,2);for(let h=0;h<l.length;h++)o.push(l[h]);if(e>0){const i=s.length/3;this._points.elements.forEach((t=>{r.push(0,-1,0),s.push(t.x,-e,t.y),n.push(1-(t.x-a.min.x)/a.width,1-(t.y-a.min.y)/a.height)}));const l=o.length;for(let e=0;e<l;e+=3){const t=o[e+0],r=o[e+1],s=o[e+2];o.push(s+i),o.push(r+i),o.push(t+i)}this._addSide(s,r,n,o,a,this._outlinepoints,e,!1,t),this._holes.forEach((i=>{this._addSide(s,r,n,o,a,i,e,!0,t)}))}return i.indices=o,i.positions=s,i.normals=r,i.uvs=n,i}_addSide(e,t,i,r,s,n,a,l,h){let c=e.length/3,u=0;for(let d=0;d<n.elements.length;d++){const _=n.elements[d],p=n.elements[(d+1)%n.elements.length];e.push(_.x,0,_.y),e.push(_.x,-a,_.y),e.push(p.x,0,p.y),e.push(p.x,-a,p.y);const f=n.elements[(d+n.elements.length-1)%n.elements.length],g=n.elements[(d+2)%n.elements.length];let m=new o.Pq(-(p.y-_.y),0,p.x-_.x),b=new o.Pq(-(_.y-f.y),0,_.x-f.x),v=new o.Pq(-(g.y-p.y),0,g.x-p.x);l||(m=m.scale(-1),b=b.scale(-1),v=v.scale(-1));const y=m.normalizeToNew();let T=b.normalizeToNew(),x=v.normalizeToNew();const A=o.Pq.Dot(T,y);T=A>h?A<O.bH-1?new o.Pq(_.x,0,_.y).subtract(new o.Pq(p.x,0,p.y)).normalize():b.add(m).normalize():y;const C=o.Pq.Dot(v,m);x=C>h?C<O.bH-1?new o.Pq(p.x,0,p.y).subtract(new o.Pq(_.x,0,_.y)).normalize():v.add(m).normalize():y,i.push(u/s.width,0),i.push(u/s.width,1),u+=m.length(),i.push(u/s.width,0),i.push(u/s.width,1),t.push(T.x,T.y,T.z),t.push(T.x,T.y,T.z),t.push(x.x,x.y,x.z),t.push(x.x,x.y,x.z),l?(r.push(c),r.push(c+2),r.push(c+1),r.push(c+1),r.push(c+2),r.push(c+3)):(r.push(c),r.push(c+1),r.push(c+2),r.push(c+1),r.push(c+3),r.push(c+2)),c+=4}}}function or(e,t,i,r,s,n,a){const l=i||new Array(3),h=r,c=[],u=a||!1;for(let S=0;S<3;S++)void 0===l[S]&&(l[S]=new o.IU(0,0,1,1)),h&&void 0===h[S]&&(h[S]=new E.ov(1,1,1,1));const d=e.getVerticesData(S.R.PositionKind),_=e.getVerticesData(S.R.NormalKind),p=e.getVerticesData(S.R.UVKind),f=e.getIndices(),g=d.length/9;let m=0,b=0,v=0,y=0,T=0;const x=[0];if(u)for(let o=g;o<d.length/3;o+=4)b=d[3*(o+2)]-d[3*o],v=d[3*(o+2)+2]-d[3*o+2],y=Math.sqrt(b*b+v*v),T+=y,x.push(T);let A=0,C=0;for(let o=0;o<_.length;o+=3)Math.abs(_[o+1])<.001&&(C=1),Math.abs(_[o+1]-1)<.001&&(C=0),Math.abs(_[o+1]+1)<.001&&(C=2),A=o/3,1===C?(m=A-g,p[2*A]=m%4<1.5?u?l[C].x+(l[C].z-l[C].x)*x[Math.floor(m/4)]/T:l[C].x:u?l[C].x+(l[C].z-l[C].x)*x[Math.floor(m/4)+1]/T:l[C].z,p[2*A+1]=m%2===0?X.rX?1-l[C].w:l[C].w:X.rX?1-l[C].y:l[C].y):(p[2*A]=(1-p[2*A])*l[C].x+p[2*A]*l[C].z,p[2*A+1]=(1-p[2*A+1])*l[C].y+p[2*A+1]*l[C].w,X.rX&&(p[2*A+1]=1-p[2*A+1])),h&&c.push(h[C].r,h[C].g,h[C].b,h[C].a);W._ComputeSides(t,d,f,_,p,s,n);const R=new W;if(R.indices=f,R.positions=d,R.normals=_,R.uvs=p,h){const e=t===W.DOUBLESIDE?c.concat(c):c;R.colors=e}return R}function lr(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;t.sideOrientation=Xe._GetDefaultSideOrientation(t.sideOrientation);const s=t.shape,n=t.holes||[],a=t.depth||0,h=t.smoothingThreshold||2,c=[];let u=[];for(let l=0;l<s.length;l++)c[l]=new o.I9(s[l].x,s[l].z);c[0].equalsWithEpsilon(c[c.length-1],1e-8)&&c.pop();const d=new ar(e,c,i||l.q.LastCreatedScene,r);for(let l=0;l<n.length;l++){u=[];for(let e=0;e<n[l].length;e++)u.push(new o.I9(n[l][e].x,n[l][e].z));d.addHole(u)}const _=d.build(!1,a,h);_._originalBuilderSideOrientation=t.sideOrientation;return or(_,t.sideOrientation,t.faceUV,t.faceColors,t.frontUVs,t.backUVs,t.wrap).applyToMesh(_,t.updatable),_}function hr(e,t){return lr(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut)}function cr(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=t.path,s=t.shape,n=t.scale||1,a=t.rotation||0,o=0===t.cap?0:t.cap||Xe.NO_CAP,l=t.updatable,h=Xe._GetDefaultSideOrientation(t.sideOrientation),c=t.instance||null,u=t.invertUV||!1,d=t.closeShape||!1;return dr(e,s,r,n,a,null,null,t.closePath||!1,d,o,!1,i,!!l,h,c,u,t.frontUVs||null,t.backUVs||null,t.firstNormal||null,!!t.adjustFrame)}function ur(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=t.path,s=t.shape,n=t.scaleFunction||(()=>1),a=t.rotationFunction||(()=>0),o=t.closePath||t.ribbonCloseArray||!1,l=t.closeShape||t.ribbonClosePath||!1,h=0===t.cap?0:t.cap||Xe.NO_CAP,c=t.updatable,u=t.firstNormal||null,d=t.adjustFrame||!1;return dr(e,s,r,null,null,n,a,o,l,h,!0,i,!!c,Xe._GetDefaultSideOrientation(t.sideOrientation),t.instance||null,t.invertUV||!1,t.frontUVs||null,t.backUVs||null,u,d)}function dr(e,t,i,r,s,n,a,l,h,c,u,d,_,p,f,g,m,b,v,y){const T=(e,t,i,r,s,n,a,l,h,c,u)=>{const d=i.getTangents(),_=i.getNormals(),p=i.getBinormals(),f=i.getDistances();if(u)for(let x=0;x<d.length;x++)if(0==d[x].x&&0==d[x].y&&0==d[x].z&&d[x].copyFrom(d[x-1]),0==_[x].x&&0==_[x].y&&0==_[x].z&&_[x].copyFrom(_[x-1]),0==p[x].x&&0==p[x].y&&0==p[x].z&&p[x].copyFrom(p[x-1]),x>0){let e=d[x-1];o.Pq.Dot(e,d[x])<0&&d[x].scaleInPlace(-1),e=_[x-1],o.Pq.Dot(e,_[x])<0&&_[x].scaleInPlace(-1),e=p[x-1],o.Pq.Dot(e,p[x])<0&&p[x].scaleInPlace(-1)}let g=0;const m=c&&l?l:()=>null!==n?n:0,b=c&&a?a:()=>null!==s?s:1;let v=h===Xe.NO_CAP||h===Xe.CAP_END?0:2;const y=o.AA.Matrix[0];for(let x=0;x<t.length;x++){const i=[],s=m(x,f[x]),n=b(x,f[x]);o.uq.RotationAxisToRef(d[x],g,y);for(let r=0;r<e.length;r++){const s=d[x].scale(e[r].z).add(_[x].scale(e[r].x)).add(p[x].scale(e[r].y)),a=o.Pq.Zero();o.Pq.TransformCoordinatesToRef(s,y,a),a.scaleInPlace(n).addInPlace(t[x]),i[r]=a}r[v]=i,g+=s,v++}const T=e=>{const t=Array(),i=o.Pq.Zero();let r;for(r=0;r<e.length;r++)i.addInPlace(e[r]);for(i.scaleInPlace(1/e.length),r=0;r<e.length;r++)t.push(i);return t};switch(h){case Xe.NO_CAP:break;case Xe.CAP_START:r[0]=T(r[2]),r[1]=r[2];break;case Xe.CAP_END:r[v]=r[v-1],r[v+1]=T(r[v-1]);break;case Xe.CAP_ALL:r[0]=T(r[2]),r[1]=r[2],r[v]=r[v-1],r[v+1]=T(r[v-1])}return r};let x,A;if(f){const e=f._creationDataStorage;return x=v?e.path3D.update(i,v):e.path3D.update(i),A=T(t,i,e.path3D,e.pathArray,r,s,n,a,e.cap,u,y),f=Ci("",{pathArray:A,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:f},d||void 0)}x=v?new Qe.tO(i,v):new Qe.tO(i);A=T(t,i,x,new Array,r,s,n,a,c=c<0||c>3?0:c,u,y);const C=Ci(e,{pathArray:A,closeArray:l,closePath:h,updatable:_,sideOrientation:p,invertUV:g,frontUVs:m||void 0,backUVs:b||void 0},d);return C._creationDataStorage.pathArray=A,C._creationDataStorage.path3D=x,C._creationDataStorage.cap=c,C}W.CreatePolygon=or,Xe.CreatePolygon=function(e,t,i,r,s,n){return lr(e,{shape:t,holes:r,updatable:s,sideOrientation:n},i,arguments.length>6&&void 0!==arguments[6]?arguments[6]:earcut)},Xe.ExtrudePolygon=function(e,t,i,r,s,n,a){return hr(e,{shape:t,holes:s,depth:i,updatable:n,sideOrientation:a},r,arguments.length>7&&void 0!==arguments[7]?arguments[7]:earcut)};function _r(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=t.arc?t.arc<=0||t.arc>1?1:t.arc:1,s=void 0===t.closed||t.closed,n=t.shape,a=t.radius||1,l=t.tessellation||64,h=t.clip||0,c=t.updatable,u=Xe._GetDefaultSideOrientation(t.sideOrientation),d=t.cap||Xe.NO_CAP,_=2*Math.PI,p=[],f=t.invertUV||!1;let g=0,m=0;const b=_/l*r;let v,y;for(g=0;g<=l-h;g++){for(y=[],d!=Xe.CAP_START&&d!=Xe.CAP_ALL||(y.push(new o.Pq(0,n[0].y,0)),y.push(new o.Pq(Math.cos(g*b)*n[0].x*a,n[0].y,Math.sin(g*b)*n[0].x*a))),m=0;m<n.length;m++)v=new o.Pq(Math.cos(g*b)*n[m].x*a,n[m].y,Math.sin(g*b)*n[m].x*a),y.push(v);d!=Xe.CAP_END&&d!=Xe.CAP_ALL||(y.push(new o.Pq(Math.cos(g*b)*n[n.length-1].x*a,n[n.length-1].y,Math.sin(g*b)*n[n.length-1].x*a)),y.push(new o.Pq(0,n[n.length-1].y,0))),p.push(y)}return Ci(e,{pathArray:p,closeArray:s,sideOrientation:u,updatable:c,invertUV:f,frontUVs:t.frontUVs,backUVs:t.backUVs},i)}Xe.ExtrudeShape=function(e,t,i,r,s,n){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=arguments.length>7?arguments[7]:void 0,l=arguments.length>8?arguments[8]:void 0,h=arguments.length>9?arguments[9]:void 0;return cr(e,{shape:t,path:i,scale:r,rotation:s,cap:0===n?0:n||Xe.NO_CAP,sideOrientation:l,instance:h,updatable:o},a)},Xe.ExtrudeShapeCustom=(e,t,i,r,s,n,a,o,l,h,c,u)=>ur(e,{shape:t,path:i,scaleFunction:r,rotationFunction:s,ribbonCloseArray:n,ribbonClosePath:a,cap:0===o?0:o||Xe.NO_CAP,sideOrientation:c,instance:u,updatable:h},l);function pr(e){const t=[],i=[],r=[],s=[],n=e.width||e.size||1,a=e.height||e.size||1,o=0===e.sideOrientation?0:e.sideOrientation||W.DEFAULTSIDE,l=n/2,h=a/2;i.push(-l,-h,0),r.push(0,0,-1),s.push(0,X.rX?1:0),i.push(l,-h,0),r.push(0,0,-1),s.push(1,X.rX?1:0),i.push(l,h,0),r.push(0,0,-1),s.push(1,X.rX?0:1),i.push(-l,h,0),r.push(0,0,-1),s.push(0,X.rX?0:1),t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),W._ComputeSides(o,i,t,r,s,e.frontUVs,e.backUVs);const c=new W;return c.indices=t,c.positions=i,c.normals=r,c.uvs=s,c}function fr(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=new Xe(e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null);t.sideOrientation=Xe._GetDefaultSideOrientation(t.sideOrientation),i._originalBuilderSideOrientation=t.sideOrientation;return pr(t).applyToMesh(i,t.updatable),t.sourcePlane&&(i.translate(t.sourcePlane.normal,-t.sourcePlane.d),i.setDirection(t.sourcePlane.normal.scale(-1))),i}Xe.CreateLathe=(e,t,i,r,s,n,a)=>_r(e,{shape:t,radius:i,tessellation:r,sideOrientation:a,updatable:n},s);function gr(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=t.path;let s=t.instance,n=1;void 0!==t.radius?n=t.radius:s&&(n=s._creationDataStorage.radius);const a=t.tessellation||64,l=t.radiusFunction||null;let h=t.cap||Xe.NO_CAP;const c=t.invertUV||!1,u=t.updatable,d=Xe._GetDefaultSideOrientation(t.sideOrientation);t.arc=t.arc&&(t.arc<=0||t.arc>1)?1:t.arc||1;const _=(e,t,i,r,s,n,a,l)=>{const h=t.getTangents(),c=t.getNormals(),u=t.getDistances(),d=2*Math.PI/s*l,_=n||(()=>r);let p,f,g,m;const b=o.AA.Matrix[0];let v=a===Xe.NO_CAP||a===Xe.CAP_END?0:2;for(let T=0;T<e.length;T++){f=_(T,u[T]),p=Array(),g=c[T];for(let t=0;t<s;t++)o.uq.RotationAxisToRef(h[T],d*t,b),m=p[t]?p[t]:o.Pq.Zero(),o.Pq.TransformCoordinatesToRef(g,b,m),m.scaleInPlace(f).addInPlace(e[T]),p[t]=m;i[v]=p,v++}const y=(t,i)=>{const r=Array();for(let s=0;s<t;s++)r.push(e[i]);return r};switch(a){case Xe.NO_CAP:break;case Xe.CAP_START:i[0]=y(s,0),i[1]=i[2].slice(0);break;case Xe.CAP_END:i[v]=i[v-1].slice(0),i[v+1]=y(s,e.length-1);break;case Xe.CAP_ALL:i[0]=y(s,0),i[1]=i[2].slice(0),i[v]=i[v-1].slice(0),i[v+1]=y(s,e.length-1)}return i};let p,f;if(s){const e=s._creationDataStorage,i=t.arc||e.arc;return p=e.path3D.update(r),f=_(r,p,e.pathArray,n,e.tessellation,l,e.cap,i),s=Ci("",{pathArray:f,instance:s}),e.path3D=p,e.pathArray=f,e.arc=i,e.radius=n,s}p=new Qe.tO(r);h=h<0||h>3?0:h,f=_(r,p,new Array,n,a,l,h,t.arc);const g=Ci(e,{pathArray:f,closePath:!0,closeArray:!1,updatable:u,sideOrientation:d,invertUV:c,frontUVs:t.frontUVs,backUVs:t.backUVs},i);return g._creationDataStorage.pathArray=f,g._creationDataStorage.path3D=p,g._creationDataStorage.tessellation=a,g._creationDataStorage.cap=h,g._creationDataStorage.arc=t.arc,g._creationDataStorage.radius=n,g}W.CreatePlane=pr,Xe.CreatePlane=(e,t,i,r,s)=>fr(e,{size:t,width:t,height:t,sideOrientation:s,updatable:r},i);function mr(e){const t=[];t[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},t[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},t[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},t[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},t[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},t[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},t[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},t[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},t[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},t[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},t[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},t[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},t[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},t[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},t[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const i=e.type&&(e.type<0||e.type>=t.length)?0:e.type||0,r=e.size,s=e.sizeX||r||1,n=e.sizeY||r||1,a=e.sizeZ||r||1,l=e.custom||t[i],h=l.face.length,c=e.faceUV||new Array(h),u=e.faceColors,d=void 0===e.flat||e.flat,_=0===e.sideOrientation?0:e.sideOrientation||W.DEFAULTSIDE,p=[],f=[],g=[],m=[],b=[];let v=0,y=0;const T=[];let x,A,C,R,S,M,P=0,I=0;if(d)for(I=0;I<h;I++)u&&void 0===u[I]&&(u[I]=new E.ov(1,1,1,1)),c&&void 0===c[I]&&(c[I]=new o.IU(0,0,1,1));if(d)for(I=0;I<h;I++){const e=l.face[I].length;for(C=2*Math.PI/e,R=.5*Math.tan(C/2),S=.5,P=0;P<e;P++)p.push(l.vertex[l.face[I][P]][0]*s,l.vertex[l.face[I][P]][1]*n,l.vertex[l.face[I][P]][2]*a),T.push(v),v++,x=c[I].x+(c[I].z-c[I].x)*(.5+R),A=c[I].y+(c[I].w-c[I].y)*(S-.5),m.push(x,X.rX?1-A:A),M=R*Math.cos(C)-S*Math.sin(C),S=R*Math.sin(C)+S*Math.cos(C),R=M,u&&b.push(u[I].r,u[I].g,u[I].b,u[I].a);for(P=0;P<e-2;P++)f.push(T[0+y],T[P+2+y],T[P+1+y]);y+=e}else{for(P=0;P<l.vertex.length;P++)p.push(l.vertex[P][0]*s,l.vertex[P][1]*n,l.vertex[P][2]*a),m.push(0,X.rX?1:0);for(I=0;I<h;I++)for(P=0;P<l.face[I].length-2;P++)f.push(l.face[I][0],l.face[I][P+2],l.face[I][P+1])}W.ComputeNormals(p,f,g),W._ComputeSides(_,p,f,g,m,e.frontUVs,e.backUVs);const O=new W;return O.positions=p,O.indices=f,O.normals=g,O.uvs=m,u&&d&&(O.colors=b),O}function br(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=new Xe(e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null);t.sideOrientation=Xe._GetDefaultSideOrientation(t.sideOrientation),i._originalBuilderSideOrientation=t.sideOrientation;return mr(t).applyToMesh(i,t.updatable),i}Xe.CreateTube=(e,t,i,r,s,n,a,o,l,h)=>gr(e,{path:t,radius:i,tessellation:r,radiusFunction:s,arc:1,cap:n,updatable:o,sideOrientation:l,instance:h},a);function vr(e){const t=e.sideOrientation||W.DEFAULTSIDE,i=e.radius||1,r=void 0===e.flat||e.flat,s=0|(e.subdivisions||4),n=e.radiusX||i,a=e.radiusY||i,l=e.radiusZ||i,h=(1+Math.sqrt(5))/2,c=[-1,h,-0,1,h,0,-1,-h,0,1,-h,0,0,-1,-h,0,1,-h,0,-1,h,0,1,h,h,0,1,h,0,-1,-h,0,1,-h,0,-1],u=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],d=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],_=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],p=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],f=[],g=[],m=[],b=[];let v=0;const y=new Array(3),T=new Array(3);let x;for(x=0;x<3;x++)y[x]=o.Pq.Zero(),T[x]=o.I9.Zero();for(let C=0;C<20;C++){for(x=0;x<3;x++){const e=u[3*C+x];y[x].copyFromFloats(c[3*d[e]],c[3*d[e]+1],c[3*d[e]+2]),y[x].normalize(),T[x].copyFromFloats(.134765625*_[2*e]+.05859375+-.0390625*p[C],.2333984375*_[2*e+1]+.025390625+.01953125*p[C])}const e=(e,t,i,h)=>{const c=o.Pq.Lerp(y[0],y[2],t/s),u=o.Pq.Lerp(y[1],y[2],t/s),d=s===t?y[2]:o.Pq.Lerp(c,u,e/(s-t));let _;if(d.normalize(),r){const e=o.Pq.Lerp(y[0],y[2],h/s),t=o.Pq.Lerp(y[1],y[2],h/s);_=o.Pq.Lerp(e,t,i/(s-h))}else _=new o.Pq(d.x,d.y,d.z);_.x/=n,_.y/=a,_.z/=l,_.normalize();const p=o.I9.Lerp(T[0],T[2],t/s),x=o.I9.Lerp(T[1],T[2],t/s),A=s===t?T[2]:o.I9.Lerp(p,x,e/(s-t));g.push(d.x*n,d.y*a,d.z*l),m.push(_.x,_.y,_.z),b.push(A.x,X.rX?1-A.y:A.y),f.push(v),v++};for(let t=0;t<s;t++)for(let i=0;i+t<s;i++)e(i,t,i+1/3,t+1/3),e(i+1,t,i+1/3,t+1/3),e(i,t+1,i+1/3,t+1/3),i+t+1<s&&(e(i+1,t,i+2/3,t+2/3),e(i+1,t+1,i+2/3,t+2/3),e(i,t+1,i+2/3,t+2/3))}W._ComputeSides(t,g,f,m,b,e.frontUVs,e.backUVs);const A=new W;return A.indices=f,A.positions=g,A.normals=m,A.uvs=b,A}function yr(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=new Xe(e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null);t.sideOrientation=Xe._GetDefaultSideOrientation(t.sideOrientation),i._originalBuilderSideOrientation=t.sideOrientation;return vr(t).applyToMesh(i,t.updatable),i}W.CreatePolyhedron=mr,Xe.CreatePolyhedron=(e,t,i)=>br(e,t,i);W.CreateIcoSphere=vr,Xe.CreateIcoSphere=(e,t,i)=>yr(e,t,i);const Tr=new o.Pq(1,0,0),xr=new o.Pq(-1,0,0),Ar=new o.Pq(0,1,0),Cr=new o.Pq(0,-1,0),Rr=new o.Pq(0,0,1),Er=new o.Pq(0,0,-1);class Sr{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o.Pq.Zero(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.Pq.Up(),i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.I9.Zero(),r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=e,this.normal=t,this.uv=i,this.vertexIdx=r,this.vertexIdxForBones=s,this.localPositionOverride=n,this.localNormalOverride=a,this.matrixIndicesOverride=l,this.matrixWeightsOverride=h}clone(){return new Sr(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,this.localPositionOverride?.slice(),this.localNormalOverride?.slice(),this.matrixIndicesOverride?.slice(),this.matrixWeightsOverride?.slice())}}function Mr(e,t,i){const r=!!t.skeleton,s=i.localMode||r,n=t.getIndices(),a=r?t.getPositionData(!0,!0):t.getVerticesData(S.R.PositionKind),l=r?t.getNormalsData(!0,!0):t.getVerticesData(S.R.NormalKind),h=s?r?t.getVerticesData(S.R.PositionKind):a:null,c=s?r?t.getVerticesData(S.R.NormalKind):l:null,u=t.getVerticesData(S.R.UVKind),d=r?t.getVerticesData(S.R.MatricesIndicesKind):null,_=r?t.getVerticesData(S.R.MatricesWeightsKind):null,p=r?t.getVerticesData(S.R.MatricesIndicesExtraKind):null,f=r?t.getVerticesData(S.R.MatricesWeightsExtraKind):null,g=i.position||o.Pq.Zero();let m=i.normal||o.Pq.Up();const b=i.size||o.Pq.One(),v=i.angle||0;if(!m){const e=new o.Pq(0,0,1),i=t.getScene().activeCamera,r=o.Pq.TransformCoordinates(e,i.getWorldMatrix());m=i.globalPosition.subtract(r)}const y=-Math.atan2(m.z,m.x)-Math.PI/2,T=Math.sqrt(m.x*m.x+m.z*m.z),x=Math.atan2(m.y,T),A=new W;A.indices=[],A.positions=[],A.normals=[],A.uvs=[],A.matricesIndices=r?[]:null,A.matricesWeights=r?[]:null,A.matricesIndicesExtra=p?[]:null,A.matricesWeightsExtra=f?[]:null;let C=0;const R=(e,t)=>{const r=new Sr;if(!n||!a||!l)return r;const s=n[e];if(r.vertexIdx=3*s,r.vertexIdxForBones=4*s,r.position=new o.Pq(a[3*s],a[3*s+1],a[3*s+2]),o.Pq.TransformCoordinatesToRef(r.position,t,r.position),r.normal=new o.Pq(l[3*s],l[3*s+1],l[3*s+2]),o.Pq.TransformNormalToRef(r.normal,t,r.normal),i.captureUVS&&u){const e=u[2*s+1];r.uv=new o.I9(u[2*s],X.rX?1-e:e)}return r},E=[0,0,0,0],M=(e,t)=>{if(0===e.length)return e;const i=.5*Math.abs(o.Pq.Dot(b,t)),r=(e,t,i,r)=>{for(let s=0;s<r;++s)if(e[i+s]===t)return i+s;return-1},s=(e,s)=>{const n=o.Pq.GetClipFactor(e.position,s.position,t,i);let a=E,l=E;if(d&&_){const t=e.matrixIndicesOverride?0:e.vertexIdxForBones,i=e.matrixIndicesOverride??d,o=e.matrixWeightsOverride??_,h=s.matrixIndicesOverride?0:s.vertexIdxForBones,c=s.matrixIndicesOverride??d,u=s.matrixWeightsOverride??_;a=[0,0,0,0],l=[0,0,0,0];let p=0;for(let e=0;e<4;++e)if(o[t+e]>0){const s=r(c,i[t+e],h,4);a[p]=i[t+e],l[p]=tt.X.Lerp(o[t+e],s>=0?u[s]:0,n),p++}for(let e=0;e<4&&p<4;++e){const s=c[h+e];-1===r(i,s,t,4)&&(a[p]=s,l[p]=tt.X.Lerp(0,u[h+e],n),p++)}const f=l[0]+l[1]+l[2]+l[3];l[0]/=f,l[1]/=f,l[2]/=f,l[3]/=f}const u=e.localPositionOverride?e.localPositionOverride[0]:h?.[e.vertexIdx]??0,p=e.localPositionOverride?e.localPositionOverride[1]:h?.[e.vertexIdx+1]??0,f=e.localPositionOverride?e.localPositionOverride[2]:h?.[e.vertexIdx+2]??0,g=s.localPositionOverride?s.localPositionOverride[0]:h?.[s.vertexIdx]??0,m=s.localPositionOverride?s.localPositionOverride[1]:h?.[s.vertexIdx+1]??0,b=s.localPositionOverride?s.localPositionOverride[2]:h?.[s.vertexIdx+2]??0,v=e.localNormalOverride?e.localNormalOverride[0]:c?.[e.vertexIdx]??0,y=e.localNormalOverride?e.localNormalOverride[1]:c?.[e.vertexIdx+1]??0,T=e.localNormalOverride?e.localNormalOverride[2]:c?.[e.vertexIdx+2]??0,x=v+((s.localNormalOverride?s.localNormalOverride[0]:c?.[s.vertexIdx]??0)-v)*n,A=y+((s.localNormalOverride?s.localNormalOverride[1]:c?.[s.vertexIdx+1]??0)-y)*n,C=T+((s.localNormalOverride?s.localNormalOverride[2]:c?.[s.vertexIdx+2]??0)-T)*n,R=Math.sqrt(x*x+A*A+C*C);return new Sr(o.Pq.Lerp(e.position,s.position,n),o.Pq.Lerp(e.normal,s.normal,n).normalize(),o.I9.Lerp(e.uv,s.uv,n),-1,-1,h?[u+(g-u)*n,p+(m-p)*n,f+(b-f)*n]:null,c?[x/R,A/R,C/R]:null,a,l)};let n=null;e.length>3&&(n=[]);for(let a=0;a<e.length;a+=3){let r=0,l=null,h=null,c=null,u=null;const d=o.Pq.Dot(e[a].position,t)-i>0,_=o.Pq.Dot(e[a+1].position,t)-i>0,p=o.Pq.Dot(e[a+2].position,t)-i>0;switch(r=(d?1:0)+(_?1:0)+(p?1:0),r){case 0:e.length>3?(n.push(e[a]),n.push(e[a+1]),n.push(e[a+2])):n=e;break;case 1:if(n=n??new Array,d&&(l=e[a+1],h=e[a+2],c=s(e[a],l),u=s(e[a],h)),_){l=e[a],h=e[a+2],c=s(e[a+1],l),u=s(e[a+1],h),n.push(c),n.push(h.clone()),n.push(l.clone()),n.push(h.clone()),n.push(c.clone()),n.push(u);break}p&&(l=e[a],h=e[a+1],c=s(e[a+2],l),u=s(e[a+2],h)),l&&h&&c&&u&&(n.push(l.clone()),n.push(h.clone()),n.push(c),n.push(u),n.push(c.clone()),n.push(h.clone()));break;case 2:n=n??new Array,d||(l=e[a].clone(),h=s(l,e[a+1]),c=s(l,e[a+2]),n.push(l),n.push(h),n.push(c)),_||(l=e[a+1].clone(),h=s(l,e[a+2]),c=s(l,e[a]),n.push(l),n.push(h),n.push(c)),p||(l=e[a+2].clone(),h=s(l,e[a]),c=s(l,e[a+1]),n.push(l),n.push(h),n.push(c))}}return n},P=t instanceof Xe?t:null,I=P?._thinInstanceDataStorage.matrixData,O=P?.thinInstanceCount||1,D=o.AA.Matrix[0];D.copyFrom(o.uq.IdentityReadOnly);for(let S=0;S<O;++S){if(P?.hasThinInstances&&I){const e=16*S;D.setRowFromFloats(0,I[e+0],I[e+1],I[e+2],I[e+3]),D.setRowFromFloats(1,I[e+4],I[e+5],I[e+6],I[e+7]),D.setRowFromFloats(2,I[e+8],I[e+9],I[e+10],I[e+11]),D.setRowFromFloats(3,I[e+12],I[e+13],I[e+14],I[e+15])}const e=o.uq.RotationYawPitchRoll(y,x,v).multiply(o.uq.Translation(g.x,g.y,g.z)),r=o.uq.Invert(e),a=t.getWorldMatrix(),l=D.multiply(a).multiply(r),u=new Array(3);for(let t=0;t<n.length;t+=3){let e=u;if(e[0]=R(t,l),e[1]=R(t+1,l),e[2]=R(t+2,l),!(i.cullBackFaces&&-e[0].normal.z<=0&&-e[1].normal.z<=0&&-e[2].normal.z<=0)&&(e=M(e,Tr),e&&(e=M(e,xr),e&&(e=M(e,Ar),e&&(e=M(e,Cr),e&&(e=M(e,Rr),e&&(e=M(e,Er),e)))))))for(let t=0;t<e.length;t++){const r=e[t];if(A.indices.push(C),s?(r.localPositionOverride?(A.positions[3*C]=r.localPositionOverride[0],A.positions[3*C+1]=r.localPositionOverride[1],A.positions[3*C+2]=r.localPositionOverride[2]):h&&(A.positions[3*C]=h[r.vertexIdx],A.positions[3*C+1]=h[r.vertexIdx+1],A.positions[3*C+2]=h[r.vertexIdx+2]),r.localNormalOverride?(A.normals[3*C]=r.localNormalOverride[0],A.normals[3*C+1]=r.localNormalOverride[1],A.normals[3*C+2]=r.localNormalOverride[2]):c&&(A.normals[3*C]=c[r.vertexIdx],A.normals[3*C+1]=c[r.vertexIdx+1],A.normals[3*C+2]=c[r.vertexIdx+2])):(r.position.toArray(A.positions,3*C),r.normal.toArray(A.normals,3*C)),A.matricesIndices&&A.matricesWeights&&(r.matrixIndicesOverride?(A.matricesIndices[4*C]=r.matrixIndicesOverride[0],A.matricesIndices[4*C+1]=r.matrixIndicesOverride[1],A.matricesIndices[4*C+2]=r.matrixIndicesOverride[2],A.matricesIndices[4*C+3]=r.matrixIndicesOverride[3]):(d&&(A.matricesIndices[4*C]=d[r.vertexIdxForBones],A.matricesIndices[4*C+1]=d[r.vertexIdxForBones+1],A.matricesIndices[4*C+2]=d[r.vertexIdxForBones+2],A.matricesIndices[4*C+3]=d[r.vertexIdxForBones+3]),p&&A.matricesIndicesExtra&&(A.matricesIndicesExtra[4*C]=p[r.vertexIdxForBones],A.matricesIndicesExtra[4*C+1]=p[r.vertexIdxForBones+1],A.matricesIndicesExtra[4*C+2]=p[r.vertexIdxForBones+2],A.matricesIndicesExtra[4*C+3]=p[r.vertexIdxForBones+3])),r.matrixWeightsOverride?(A.matricesWeights[4*C]=r.matrixWeightsOverride[0],A.matricesWeights[4*C+1]=r.matrixWeightsOverride[1],A.matricesWeights[4*C+2]=r.matrixWeightsOverride[2],A.matricesWeights[4*C+3]=r.matrixWeightsOverride[3]):(_&&(A.matricesWeights[4*C]=_[r.vertexIdxForBones],A.matricesWeights[4*C+1]=_[r.vertexIdxForBones+1],A.matricesWeights[4*C+2]=_[r.vertexIdxForBones+2],A.matricesWeights[4*C+3]=_[r.vertexIdxForBones+3]),f&&A.matricesWeightsExtra&&(A.matricesWeightsExtra[4*C]=f[r.vertexIdxForBones],A.matricesWeightsExtra[4*C+1]=f[r.vertexIdxForBones+1],A.matricesWeightsExtra[4*C+2]=f[r.vertexIdxForBones+2],A.matricesWeightsExtra[4*C+3]=f[r.vertexIdxForBones+3]))),i.captureUVS)r.uv.toArray(A.uvs,2*C);else{A.uvs.push(.5+r.position.x/b.x);const e=.5+r.position.y/b.y;A.uvs.push(X.rX?1-e:e)}C++}}}0===A.indices.length&&(A.indices=null),0===A.positions.length&&(A.positions=null),0===A.normals.length&&(A.normals=null),0===A.uvs.length&&(A.uvs=null),0===A.matricesIndices?.length&&(A.matricesIndices=null),0===A.matricesWeights?.length&&(A.matricesWeights=null),0===A.matricesIndicesExtra?.length&&(A.matricesIndicesExtra=null),0===A.matricesWeightsExtra?.length&&(A.matricesWeightsExtra=null);const w=new Xe(e,t.getScene());return A.applyToMesh(w),s?(w.skeleton=t.skeleton,w.parent=t):(w.position=g.clone(),w.rotation=new o.Pq(x,y,v)),w.computeWorldMatrix(!0),w.refreshBoundingInfo(!0,!0),w}function Pr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const t=0|Math.max(e.subdivisions?e.subdivisions:2,1),i=0|Math.max(e.tessellation?e.tessellation:16,3),r=Math.max(e.height?e.height:1,0),s=Math.max(e.radius?e.radius:.25,0),n=0|Math.max(e.capSubdivisions?e.capSubdivisions:6,1),a=i,l=t,h=Math.max(e.radiusTop?e.radiusTop:s,0),c=Math.max(e.radiusBottom?e.radiusBottom:s,0),u=r-(h+c),d=2*Math.PI,_=Math.max(e.topCapSubdivisions?e.topCapSubdivisions:n,1),p=Math.max(e.bottomCapSubdivisions?e.bottomCapSubdivisions:n,1),f=Math.acos((c-h)/r);let g=[];const m=[],b=[],v=[];let y=0;const T=[],x=.5*u,A=.5*Math.PI;let C,R;const E=o.Pq.Zero(),S=o.Pq.Zero(),M=Math.cos(f),P=Math.sin(f),I=new o.I9(h*P,x+h*M).subtract(new o.I9(c*P,c*M-x)).length(),O=h*f+I+c*(A-f);let D=0;for(R=0;R<=_;R++){const e=[],t=A-f*(R/_);D+=h*f/_;const i=Math.cos(t),r=Math.sin(t),s=i*h;for(C=0;C<=a;C++){const t=C/a,n=t*d+0,o=Math.sin(n),l=Math.cos(n);S.x=s*o,S.y=x+r*h,S.z=s*l,m.push(S.x,S.y,S.z),E.set(i*o,r,i*l),b.push(E.x,E.y,E.z),v.push(t,X.rX?D/O:1-D/O),e.push(y),y++}T.push(e)}const w=r-h-c+M*h-M*c,F=P*(c-h)/w;for(R=1;R<=l;R++){const e=[];D+=I/l;const t=P*(R*(c-h)/l+h);for(C=0;C<=a;C++){const i=C/a,r=i*d+0,s=Math.sin(r),n=Math.cos(r);S.x=t*s,S.y=x+M*h-R*w/l,S.z=t*n,m.push(S.x,S.y,S.z),E.set(s,F,n).normalize(),b.push(E.x,E.y,E.z),v.push(i,X.rX?D/O:1-D/O),e.push(y),y++}T.push(e)}for(R=1;R<=p;R++){const e=[],t=A-f-(Math.PI-f)*(R/p);D+=c*f/p;const i=Math.cos(t),r=Math.sin(t),s=i*c;for(C=0;C<=a;C++){const t=C/a,n=t*d+0,o=Math.sin(n),l=Math.cos(n);S.x=s*o,S.y=r*c-x,S.z=s*l,m.push(S.x,S.y,S.z),E.set(i*o,r,i*l),b.push(E.x,E.y,E.z),v.push(t,X.rX?D/O:1-D/O),e.push(y),y++}T.push(e)}for(C=0;C<a;C++)for(R=0;R<_+l+p;R++){const e=T[R][C],t=T[R+1][C],i=T[R+1][C+1],r=T[R][C+1];g.push(e),g.push(t),g.push(r),g.push(t),g.push(i),g.push(r)}if(g=g.reverse(),e.orientation&&!e.orientation.equals(o.Pq.Up())){const t=new o.uq;e.orientation.clone().scale(.5*Math.PI).cross(o.Pq.Up()).toQuaternion().toRotationMatrix(t);const i=o.Pq.Zero();for(let e=0;e<m.length;e+=3)i.set(m[e],m[e+1],m[e+2]),o.Pq.TransformCoordinatesToRef(i.clone(),t,i),m[e]=i.x,m[e+1]=i.y,m[e+2]=i.z}const L=new W;return L.positions=m,L.normals=b,L.uvs=v,L.indices=g,L}function Ir(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:o.Pq.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1};const i=new Xe(e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null);return Pr(t).applyToMesh(i,t.updatable),i}Xe.CreateDecal=(e,t,i,r,s,n)=>Mr(e,t,{position:i,normal:r,size:s,angle:n});Xe.CreateCapsule=(e,t,i)=>Ir(e,t,i),W.CreateCapsule=Pr;class Or{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=e,this.y=t,e!==Math.floor(e)&&(e=Math.floor(e),T.V.Warn("x is not an integer, floor(x) used")),t!==Math.floor(t)&&(t=Math.floor(t),T.V.Warn("y is not an integer, floor(y) used"))}clone(){return new Or(this.x,this.y)}rotate60About(e){const t=this.x;return this.x=e.x+e.y-this.y,this.y=t+this.y-e.x,this}rotateNeg60About(e){const t=this.x;return this.x=t+this.y-e.y,this.y=e.x+e.y-t,this}rotate120(e,t){e!==Math.floor(e)&&(e=Math.floor(e),T.V.Warn("m not an integer only floor(m) used")),t!==Math.floor(t)&&(t=Math.floor(t),T.V.Warn("n not an integer only floor(n) used"));const i=this.x;return this.x=e-i-this.y,this.y=t+i,this}rotateNeg120(e,t){e!==Math.floor(e)&&(e=Math.floor(e),T.V.Warn("m is not an integer, floor(m) used")),t!==Math.floor(t)&&(t=Math.floor(t),T.V.Warn("n is not an integer,   floor(n) used"));const i=this.x;return this.x=this.y-t,this.y=e+t-i-this.y,this}toCartesianOrigin(e,t){const i=o.Pq.Zero();return i.x=e.x+2*this.x*t+this.y*t,i.y=e.y+Math.sqrt(3)*this.y*t,i}static Zero(){return new Or(0,0)}}class Dr{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new wr("icosahedron","Regular",[[0,O.a6,-1],[-O.a6,1,0],[-1,0,-O.a6],[1,0,-O.a6],[O.a6,1,0],[0,O.a6,1],[-1,0,O.a6],[-O.a6,-1,0],[0,-O.a6,-1],[O.a6,-1,0],[1,0,O.a6],[0,-O.a6,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let e=12;const t={},i=this.m,r=this.n;let s,n,a,o,l,h=i,c=1,u=0;0!==r&&(h=tt.X.HCF(i,r)),c=i/h,u=r/h;const d=Or.Zero(),_=new Or(i,r),p=new Or(-r,i+r),f=Or.Zero(),g=Or.Zero(),m=Or.Zero();let b,v,y,T,x=[];const A=[],C=this.vertByDist,R=(i,r,s,n)=>{b=i+"|"+s,v=r+"|"+n,b in t||v in t?b in t&&!(v in t)?t[v]=t[b]:v in t&&!(b in t)&&(t[b]=t[v]):(t[b]=e,t[v]=e,e++),C[s][0]>2?A[t[b]]=[-C[s][0],C[s][1],t[b]]:A[t[b]]=[x[C[s][0]],C[s][1],t[b]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let E=0;E<20;E++){if(x=this.IDATA.face[E],a=x[2],o=x[1],l=x[0],y=d.x+"|"+d.y,b=E+"|"+y,b in t||(t[b]=a,A[a]=[x[C[y][0]],C[y][1]]),y=_.x+"|"+_.y,b=E+"|"+y,b in t||(t[b]=o,A[o]=[x[C[y][0]],C[y][1]]),y=p.x+"|"+p.y,b=E+"|"+y,b in t||(t[b]=l,A[l]=[x[C[y][0]],C[y][1]]),s=this.IDATA.edgematch[E][0],n=this.IDATA.edgematch[E][1],"B"===n)for(let e=1;e<h;e++)g.x=i-e*(c+u),g.y=r+e*c,m.x=-e*u,m.y=e*(c+u),y=g.x+"|"+g.y,T=m.x+"|"+m.y,R(E,s,y,T);if("O"===n)for(let e=1;e<h;e++)m.x=-e*u,m.y=e*(c+u),f.x=e*c,f.y=e*u,y=m.x+"|"+m.y,T=f.x+"|"+f.y,R(E,s,y,T);if(s=this.IDATA.edgematch[E][2],n=this.IDATA.edgematch[E][3],n&&"A"===n)for(let e=1;e<h;e++)f.x=e*c,f.y=e*u,g.x=i-(h-e)*(c+u),g.y=r+(h-e)*c,y=f.x+"|"+f.y,T=g.x+"|"+g.y,R(E,s,y,T);for(let i=0;i<this.vertices.length;i++)y=this.vertices[i].x+"|"+this.vertices[i].y,b=E+"|"+y,b in t||(t[b]=e++,C[y][0]>2?A[t[b]]=[-C[y][0],C[y][1],t[b]]:A[t[b]]=[x[C[y][0]],C[y][1],t[b]])}this.closestTo=A,this.vecToidx=t}calcCoeffs(){const e=this.m,t=this.n,i=Math.sqrt(3)/3,r=e*e+t*t+e*t;this.coau=(e+t)/r,this.cobu=-t/r,this.coav=-i*(e-t)/r,this.cobv=i*(2*e+t)/r}createInnerFacets(){const e=this.m,t=this.n;for(let i=0;i<t+e+1;i++)for(let e=this.min[i];e<this.max[i]+1;e++)e<this.max[i]&&e<this.max[i+1]+1&&this.innerFacets.push(["|"+e+"|"+i,"|"+e+"|"+(i+1),"|"+(e+1)+"|"+i]),i>0&&e<this.max[i-1]&&e+1<this.max[i]+1&&this.innerFacets.push(["|"+e+"|"+i,"|"+(e+1)+"|"+i,"|"+(e+1)+"|"+(i-1)])}edgeVecsABOB(){const e=this.m,t=this.n,i=new Or(-t,e+t);for(let r=1;r<e+t;r++){const e=new Or(this.min[r],r),t=new Or(this.min[r-1],r-1),s=new Or(this.min[r+1],r+1),n=e.clone(),a=t.clone(),o=s.clone();n.rotate60About(i),a.rotate60About(i),o.rotate60About(i);const l=new Or(this.max[n.y],n.y),h=new Or(this.max[n.y-1],n.y-1),c=new Or(this.max[n.y-1]-1,n.y-1);n.x===l.x&&n.y===l.y||(n.x!==h.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([e,h,c]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([e,c,l])):n.y===o.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([e,t,h]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([e,h,s])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([e,t,h]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([e,h,l])))}}mapABOBtoOBOA(){const e=new Or(0,0);for(let t=0;t<this.isoVecsABOB.length;t++){const i=[];for(let r=0;r<3;r++)e.x=this.isoVecsABOB[t][r].x,e.y=this.isoVecsABOB[t][r].y,0===this.vertexTypes[t][r]&&e.rotateNeg120(this.m,this.n),i.push(e.clone());this.isoVecsOBOA.push(i)}}mapABOBtoBAOA(){const e=new Or(0,0);for(let t=0;t<this.isoVecsABOB.length;t++){const i=[];for(let r=0;r<3;r++)e.x=this.isoVecsABOB[t][r].x,e.y=this.isoVecsABOB[t][r].y,1===this.vertexTypes[t][r]&&e.rotate120(this.m,this.n),i.push(e.clone());this.isoVecsBAOA.push(i)}}MapToFace(e,t){const i=this.IDATA.face[e],r=i[2],s=i[1],n=i[0],a=o.Pq.FromArray(this.IDATA.vertex[r]),l=o.Pq.FromArray(this.IDATA.vertex[s]),h=o.Pq.FromArray(this.IDATA.vertex[n]),c=l.subtract(a),u=h.subtract(a),d=c.scale(this.coau).add(u.scale(this.cobu)),_=c.scale(this.coav).add(u.scale(this.cobv)),p=[];let f,g=o.AA.Vector3[0];for(let o=0;o<this.cartesian.length;o++)g=d.scale(this.cartesian[o].x).add(_.scale(this.cartesian[o].y)).add(a),p[o]=[g.x,g.y,g.z],f=e+"|"+this.vertices[o].x+"|"+this.vertices[o].y,t.vertex[this.vecToidx[f]]=[g.x,g.y,g.z]}build(e,t){const i=[],r=Or.Zero(),s=new Or(e,t),n=new Or(-t,e+t);i.push(r,s,n);for(let y=t;y<e+1;y++)for(let t=0;t<e+1-y;t++)i.push(new Or(t,y));if(t>0){const r=tt.X.HCF(e,t),s=e/r,n=t/r;for(let o=1;o<r;o++)i.push(new Or(o*s,o*n)),i.push(new Or(-o*n,o*(s+n))),i.push(new Or(e-o*(s+n),t+o*s));const a=e/t;for(let o=1;o<t;o++)for(let r=0;r<o*a;r++)i.push(new Or(r,o)),i.push(new Or(r,o).rotate120(e,t)),i.push(new Or(r,o).rotateNeg120(e,t))}i.sort(((e,t)=>e.x-t.x)),i.sort(((e,t)=>e.y-t.y));const a=new Array(e+t+1),o=new Array(e+t+1);for(let y=0;y<a.length;y++)a[y]=1/0,o[y]=-1/0;let l=0,h=0;const c=i.length;for(let y=0;y<c;y++)h=i[y].x,l=i[y].y,a[l]=Math.min(h,a[l]),o[l]=Math.max(h,o[l]);const u=(i,r)=>{const s=i.clone();return"A"===r&&s.rotateNeg120(e,t),"B"===r&&s.rotate120(e,t),s.x<0?s.y:s.x+s.y},d=[],_=[],p=[],f=[],g={},m=[];let b=-1,v=-1;for(let y=0;y<c;y++)d[y]=i[y].toCartesianOrigin(new Or(0,0),.5),_[y]=u(i[y],"O"),p[y]=u(i[y],"A"),f[y]=u(i[y],"B"),_[y]===p[y]&&p[y]===f[y]?(b=3,v=_[y]):_[y]===p[y]?(b=4,v=_[y]):p[y]===f[y]?(b=5,v=p[y]):f[y]===_[y]&&(b=6,v=_[y]),_[y]<p[y]&&_[y]<f[y]&&(b=2,v=_[y]),p[y]<_[y]&&p[y]<f[y]&&(b=1,v=p[y]),f[y]<p[y]&&f[y]<_[y]&&(b=0,v=f[y]),m.push([b,v,i[y].x,i[y].y]);m.sort(((e,t)=>e[2]-t[2])),m.sort(((e,t)=>e[3]-t[3])),m.sort(((e,t)=>e[1]-t[1])),m.sort(((e,t)=>e[0]-t[0]));for(let y=0;y<m.length;y++)g[m[y][2]+"|"+m[y][3]]=[m[y][0],m[y][1],y];return this.m=e,this.n=t,this.vertices=i,this.vertByDist=g,this.cartesian=d,this.min=a,this.max=o,this}}class wr{constructor(e,t,i,r){this.name=e,this.category=t,this.vertex=i,this.face=r}}class Fr extends wr{innerToData(e,t){for(let i=0;i<t.innerFacets.length;i++)this.face.push(t.innerFacets[i].map((i=>t.vecToidx[e+i])))}mapABOBtoDATA(e,t){const i=t.IDATA.edgematch[e][0];for(let r=0;r<t.isoVecsABOB.length;r++){const s=[];for(let n=0;n<3;n++)0===t.vertexTypes[r][n]?s.push(e+"|"+t.isoVecsABOB[r][n].x+"|"+t.isoVecsABOB[r][n].y):s.push(i+"|"+t.isoVecsABOB[r][n].x+"|"+t.isoVecsABOB[r][n].y);this.face.push([t.vecToidx[s[0]],t.vecToidx[s[1]],t.vecToidx[s[2]]])}}mapOBOAtoDATA(e,t){const i=t.IDATA.edgematch[e][0];for(let r=0;r<t.isoVecsOBOA.length;r++){const s=[];for(let n=0;n<3;n++)1===t.vertexTypes[r][n]?s.push(e+"|"+t.isoVecsOBOA[r][n].x+"|"+t.isoVecsOBOA[r][n].y):s.push(i+"|"+t.isoVecsOBOA[r][n].x+"|"+t.isoVecsOBOA[r][n].y);this.face.push([t.vecToidx[s[0]],t.vecToidx[s[1]],t.vecToidx[s[2]]])}}mapBAOAtoDATA(e,t){const i=t.IDATA.edgematch[e][2];for(let r=0;r<t.isoVecsBAOA.length;r++){const s=[];for(let n=0;n<3;n++)1===t.vertexTypes[r][n]?s.push(e+"|"+t.isoVecsBAOA[r][n].x+"|"+t.isoVecsBAOA[r][n].y):s.push(i+"|"+t.isoVecsBAOA[r][n].x+"|"+t.isoVecsBAOA[r][n].y);this.face.push([t.vecToidx[s[0]],t.vecToidx[s[1]],t.vecToidx[s[2]]])}}orderData(e){const t=[];for(let n=0;n<13;n++)t[n]=[];const i=e.closestTo;for(let n=0;n<i.length;n++)i[n][0]>-1?i[n][1]>0&&t[i[n][0]].push([n,i[n][1]]):t[12].push([n,i[n][0]]);const r=[];for(let n=0;n<12;n++)r[n]=n;let s=12;for(let n=0;n<12;n++){t[n].sort(((e,t)=>e[1]-t[1]));for(let e=0;e<t[n].length;e++)r[t[n][e][0]]=s++}for(let n=0;n<t[12].length;n++)r[t[12][n][0]]=s++;for(let n=0;n<this.vertex.length;n++)this.vertex[n].push(r[n]);this.vertex.sort(((e,t)=>e[3]-t[3]));for(let n=0;n<this.vertex.length;n++)this.vertex[n].pop();for(let n=0;n<this.face.length;n++)for(let e=0;e<this.face[n].length;e++)this.face[n][e]=r[this.face[n][e]];this.sharedNodes=t[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(e,t){const i=[],r=[];let s=t.pop();r.push(s);let n=this.face[s].indexOf(e);n=(n+2)%3;let a=this.face[s][n];i.push(a);let o=0;for(;t.length>0;)s=t[o],this.face[s].indexOf(a)>-1?(n=(this.face[s].indexOf(a)+1)%3,a=this.face[s][n],i.push(a),r.push(s),t.splice(o,1),o=0):o++;return this.adjacentFaces.push(i),r}toGoldbergPolyhedronData(){const e=new wr("GeoDual","Goldberg",[],[]);e.name="GD dual";const t=this.vertex.length,i=new Array(t);for(let l=0;l<t;l++)i[l]=[];for(let l=0;l<this.face.length;l++)for(let e=0;e<3;e++)i[this.face[l][e]].push(l);let r=0,s=0,n=0,a=[],o=[];this.adjacentFaces=[];for(let l=0;l<i.length;l++)e.face[l]=this.setOrder(l,i[l].concat([])),i[l].forEach((t=>{r=0,s=0,n=0,a=this.face[t];for(let e=0;e<3;e++)o=this.vertex[a[e]],r+=o[0],s+=o[1],n+=o[2];e.vertex[t]=[r/3,s/3,n/3]}));return e}static BuildGeodesicData(e){const t=new Fr("Geodesic-m-n","Geodesic",[[0,O.a6,-1],[-O.a6,1,0],[-1,0,-O.a6],[1,0,-O.a6],[O.a6,1,0],[0,O.a6,1],[-1,0,O.a6],[-O.a6,-1,0],[0,-O.a6,-1],[O.a6,-1,0],[1,0,O.a6],[0,-O.a6,1]],[]);e.setIndices(),e.calcCoeffs(),e.createInnerFacets(),e.edgeVecsABOB(),e.mapABOBtoOBOA(),e.mapABOBtoBAOA();for(let i=0;i<e.IDATA.face.length;i++)e.MapToFace(i,t),t.innerToData(i,e),"B"===e.IDATA.edgematch[i][1]&&t.mapABOBtoDATA(i,e),"O"===e.IDATA.edgematch[i][1]&&t.mapOBOAtoDATA(i,e),"A"===e.IDATA.edgematch[i][3]&&t.mapBAOAtoDATA(i,e);t.orderData(e);return t.vertex=t.vertex.map((function(e){const t=e[0],i=e[1],r=e[2],s=Math.sqrt(t*t+i*i+r*r);return e[0]*=1/s,e[1]*=1/s,e[2]*=1/s,e})),t}}Xe._GoldbergMeshParser=(e,t)=>Lr.Parse(e,t);class Lr extends Xe{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(e,t){return void 0===t?(e>this.goldbergData.nbUnsharedFaces-1&&(T.V.Warn("Maximum number of unshared faces used"),e=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+e):(e>11&&(T.V.Warn("Last pole used"),e=11),t>this.goldbergData.nbFacesAtPole-1&&(T.V.Warn("Maximum number of faces at a pole used"),t=this.goldbergData.nbFacesAtPole-1),12+e*this.goldbergData.nbFacesAtPole+t)}_changeGoldbergFaceColors(e){for(let i=0;i<e.length;i++){const t=e[i][0],r=e[i][1],s=e[i][2];for(let e=t;e<r+1;e++)this.goldbergData.faceColors[e]=s}const t=[];for(let i=0;i<12;i++)for(let e=0;e<5;e++)t.push(this.goldbergData.faceColors[i].r,this.goldbergData.faceColors[i].g,this.goldbergData.faceColors[i].b,this.goldbergData.faceColors[i].a);for(let i=12;i<this.goldbergData.faceColors.length;i++)for(let e=0;e<6;e++)t.push(this.goldbergData.faceColors[i].r,this.goldbergData.faceColors[i].g,this.goldbergData.faceColors[i].b,this.goldbergData.faceColors[i].a);return t}setGoldbergFaceColors(e){const t=this._changeGoldbergFaceColors(e);this.setVerticesData(S.R.ColorKind,t)}updateGoldbergFaceColors(e){const t=this._changeGoldbergFaceColors(e);this.updateVerticesData(S.R.ColorKind,t)}_changeGoldbergFaceUVs(e){const t=this.getVerticesData(S.R.UVKind);for(let i=0;i<e.length;i++){const r=e[i][0],s=e[i][1],n=e[i][2],a=e[i][3],o=e[i][4],l=[],h=[];let c,u;for(let e=0;e<5;e++)c=n.x+a*Math.cos(o+e*Math.PI/2.5),u=n.y+a*Math.sin(o+e*Math.PI/2.5),c<0&&(c=0),c>1&&(c=1),l.push(c,u);for(let e=0;e<6;e++)c=n.x+a*Math.cos(o+e*Math.PI/3),u=n.y+a*Math.sin(o+e*Math.PI/3),c<0&&(c=0),c>1&&(c=1),h.push(c,u);for(let e=r;e<Math.min(12,s+1);e++)for(let i=0;i<5;i++)t[10*e+2*i]=l[2*i],t[10*e+2*i+1]=l[2*i+1];for(let e=Math.max(12,r);e<s+1;e++)for(let i=0;i<6;i++)t[12*e-24+2*i]=h[2*i],t[12*e-23+2*i]=h[2*i+1]}return t}setGoldbergFaceUVs(e){const t=this._changeGoldbergFaceUVs(e);this.setVerticesData(S.R.UVKind,t)}updateGoldbergFaceUVs(e){const t=this._changeGoldbergFaceUVs(e);this.updateVerticesData(S.R.UVKind,t)}placeOnGoldbergFaceAt(e,t,i){const r=o.Pq.RotationFromAxis(this.goldbergData.faceXaxis[t],this.goldbergData.faceYaxis[t],this.goldbergData.faceZaxis[t]);e.rotation=r,e.position=this.goldbergData.faceCenters[t].add(this.goldbergData.faceXaxis[t].scale(i.x)).add(this.goldbergData.faceYaxis[t].scale(i.y)).add(this.goldbergData.faceZaxis[t].scale(i.z))}serialize(e){super.serialize(e),e.type="GoldbergMesh";const t={};if(t.adjacentFaces=this.goldbergData.adjacentFaces,t.nbSharedFaces=this.goldbergData.nbSharedFaces,t.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,t.nbFaces=this.goldbergData.nbFaces,t.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){t.faceColors=[];for(const e of this.goldbergData.faceColors)t.faceColors.push(e.asArray())}if(this.goldbergData.faceCenters){t.faceCenters=[];for(const e of this.goldbergData.faceCenters)t.faceCenters.push(e.asArray())}if(this.goldbergData.faceZaxis){t.faceZaxis=[];for(const e of this.goldbergData.faceZaxis)t.faceZaxis.push(e.asArray())}if(this.goldbergData.faceYaxis){t.faceYaxis=[];for(const e of this.goldbergData.faceYaxis)t.faceYaxis.push(e.asArray())}if(this.goldbergData.faceXaxis){t.faceXaxis=[];for(const e of this.goldbergData.faceXaxis)t.faceXaxis.push(e.asArray())}e.goldbergData=t}static Parse(e,t){const i=e.goldbergData;i.faceColors=i.faceColors.map((e=>E.ov.FromArray(e))),i.faceCenters=i.faceCenters.map((e=>o.Pq.FromArray(e))),i.faceZaxis=i.faceZaxis.map((e=>o.Pq.FromArray(e))),i.faceXaxis=i.faceXaxis.map((e=>o.Pq.FromArray(e))),i.faceYaxis=i.faceYaxis.map((e=>o.Pq.FromArray(e)));const r=new Lr(e.name,t);return r.goldbergData=i,r}}class Br{constructor(e){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=e}moveTo(e,t){this._currentPath=new Qe.Cu(e,t),this._tempPaths.push(this._currentPath)}lineTo(e,t){this._currentPath.addLineTo(e,t)}quadraticCurveTo(e,t,i,r){this._currentPath.addQuadraticCurveTo(e,t,i,r,this._resolution)}bezierCurveTo(e,t,i,r,s,n){this._currentPath.addBezierCurveTo(e,t,i,r,s,n,this._resolution)}extractHoles(){for(const e of this._tempPaths)e.area()>0?this._holes.push(e):this._paths.push(e);if(!this._paths.length&&this._holes.length){const e=this._holes;this._holes=this._paths,this._paths=e}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function Nr(e,t,i,r,s,n){const a=n.glyphs[e]||n.glyphs["?"];if(!a)return null;const o=new Br(s);if(a.o){const e=a.o.split(" ");for(let s=0,n=e.length;s<n;){switch(e[s++]){case"m":{const n=parseInt(e[s++])*t+i,a=parseInt(e[s++])*t+r;o.moveTo(n,a);break}case"l":{const n=parseInt(e[s++])*t+i,a=parseInt(e[s++])*t+r;o.lineTo(n,a);break}case"q":{const n=parseInt(e[s++])*t+i,a=parseInt(e[s++])*t+r,l=parseInt(e[s++])*t+i,h=parseInt(e[s++])*t+r;o.quadraticCurveTo(l,h,n,a);break}case"b":{const n=parseInt(e[s++])*t+i,a=parseInt(e[s++])*t+r,l=parseInt(e[s++])*t+i,h=parseInt(e[s++])*t+r,c=parseInt(e[s++])*t+i,u=parseInt(e[s++])*t+r;o.bezierCurveTo(l,h,c,u,n,a);break}}}}return o.extractHoles(),{offsetX:a.ha*t,shapePath:o}}const kr={CreateBox:Li,CreateTiledBox:Ui,CreateSphere:zi,CreateDisc:Ei,CreateIcoSphere:yr,CreateRibbon:Ci,CreateCylinder:Hi,CreateTorus:qi,CreateTorusKnot:Ki,CreateLineSystem:tr,CreateLines:ir,CreateDashedLines:rr,ExtrudeShape:cr,ExtrudeShapeCustom:ur,CreateLathe:_r,CreateTiledPlane:Ni,CreatePlane:fr,CreateGround:Oi,CreateTiledGround:Di,CreateGroundFromHeightMap:wi,CreatePolygon:lr,ExtrudePolygon:hr,CreateTube:gr,CreatePolyhedron:br,CreateGeodesic:function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=t.m||1;r!==Math.floor(r)&&(r=Math.floor(r),T.V.Warn("m not an integer only floor(m) used"));let s=t.n||0;if(s!==Math.floor(s)&&(s=Math.floor(s),T.V.Warn("n not an integer only floor(n) used")),s>r){const e=s;s=r,r=e,T.V.Warn("n > m therefore m and n swapped")}const n=new Dr;return n.build(r,s),br(e,{custom:Fr.BuildGeodesicData(n),size:t.size,sizeX:t.sizeX,sizeY:t.sizeY,sizeZ:t.sizeZ,faceUV:t.faceUV,faceColors:t.faceColors,flat:t.flat,updatable:t.updatable,sideOrientation:t.sideOrientation,frontUVs:t.frontUVs,backUVs:t.backUVs},i)},CreateGoldberg:function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=t.size,s=t.sizeX||r||1,n=t.sizeY||r||1,a=t.sizeZ||r||1;let l=t.m||1;l!==Math.floor(l)&&(l=Math.floor(l),T.V.Warn("m not an integer only floor(m) used"));let h=t.n||0;if(h!==Math.floor(h)&&(h=Math.floor(h),T.V.Warn("n not an integer only floor(n) used")),h>l){const e=h;h=l,l=e,T.V.Warn("n > m therefore m and n swapped")}const c=new Dr;c.build(l,h);const u=Fr.BuildGeodesicData(c),d=u.toGoldbergPolyhedronData(),_=new Lr(e,i);t.sideOrientation=Xe._GetDefaultSideOrientation(t.sideOrientation),_._originalBuilderSideOrientation=t.sideOrientation;const p=function(e,t){const i=e.size,r=e.sizeX||i||1,s=e.sizeY||i||1,n=e.sizeZ||i||1,a=0===e.sideOrientation?0:e.sideOrientation||W.DEFAULTSIDE,l=[],h=[],c=[],u=[];let d=1/0,_=-1/0,p=1/0,f=-1/0;for(let o=0;o<t.vertex.length;o++)d=Math.min(d,t.vertex[o][0]*r),_=Math.max(_,t.vertex[o][0]*r),p=Math.min(p,t.vertex[o][1]*s),f=Math.max(f,t.vertex[o][1]*s);let g=0;for(let b=0;b<t.face.length;b++){const e=t.face[b],i=o.Pq.FromArray(t.vertex[e[0]]),a=o.Pq.FromArray(t.vertex[e[2]]),m=o.Pq.FromArray(t.vertex[e[1]]),v=a.subtract(i),y=m.subtract(i),T=o.Pq.Cross(y,v).normalize();for(let o=0;o<e.length;o++){c.push(T.x,T.y,T.z);const i=t.vertex[e[o]];l.push(i[0]*r,i[1]*s,i[2]*n);const a=(i[1]*s-p)/(f-p);u.push((i[0]*r-d)/(_-d),X.rX?1-a:a)}for(let t=0;t<e.length-2;t++)h.push(g,g+t+2,g+t+1);g+=e.length}W._ComputeSides(a,l,h,c,u);const m=new W;return m.positions=l,m.indices=h,m.normals=c,m.uvs=u,m}(t,d);p.applyToMesh(_,t.updatable),_.goldbergData.nbSharedFaces=u.sharedNodes,_.goldbergData.nbUnsharedFaces=u.poleNodes,_.goldbergData.adjacentFaces=u.adjacentFaces,_.goldbergData.nbFaces=_.goldbergData.nbSharedFaces+_.goldbergData.nbUnsharedFaces,_.goldbergData.nbFacesAtPole=(_.goldbergData.nbUnsharedFaces-12)/12;for(let f=0;f<u.vertex.length;f++)_.goldbergData.faceCenters.push(o.Pq.FromArray(u.vertex[f])),_.goldbergData.faceCenters[f].x*=s,_.goldbergData.faceCenters[f].y*=n,_.goldbergData.faceCenters[f].z*=a,_.goldbergData.faceColors.push(new E.ov(1,1,1,1));for(let f=0;f<d.face.length;f++){const e=d.face[f],t=o.Pq.FromArray(d.vertex[e[0]]),i=o.Pq.FromArray(d.vertex[e[2]]),r=o.Pq.FromArray(d.vertex[e[1]]),s=i.subtract(t),n=r.subtract(t),a=o.Pq.Cross(n,s).normalize(),l=o.Pq.Cross(n,a).normalize();_.goldbergData.faceXaxis.push(n.normalize()),_.goldbergData.faceYaxis.push(a),_.goldbergData.faceZaxis.push(l)}return _},CreateDecal:Mr,CreateCapsule:Ir,CreateText:function(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:50,resolution:8,depth:1},s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:earcut;const a=function(e,t,i,r){const s=Array.from(e),n=t/r.resolution,a=(r.boundingBox.yMax-r.boundingBox.yMin+r.underlineThickness)*n,o=[];let l=0,h=0;for(let c=0;c<s.length;c++){const e=s[c];if("\n"===e)l=0,h-=a;else{const t=Nr(e,n,l,h,i,r);t&&(l+=t.offsetX,o.push(t.shapePath))}}return o}(t,r.size||50,r.resolution||8,i),l=[];let h=0;for(const u of a){if(!u.paths.length)continue;const t=u.holes.slice();for(const i of u.paths){const a=[],c=[],u=i.getPoints();for(const e of u)c.push(new o.Pq(e.x,0,e.y));const d=t.slice();for(const e of d){const r=e.getPoints();let s=!1;for(const e of r)if(i.isPointInside(e)){s=!0;break}if(!s)continue;const n=[];for(const e of r)n.push(new o.Pq(e.x,0,e.y));a.push(n),t.splice(t.indexOf(e),1)}if(!a.length&&t.length)for(const e of t){const t=e.getPoints(),i=[];for(const e of t)i.push(new o.Pq(e.x,0,e.y));a.push(i)}const _=hr(e,{shape:c,holes:a.length?a:void 0,depth:r.depth||1,faceUV:r.faceUV||r.perLetterFaceUV?.(h),faceColors:r.faceColors||r.perLetterFaceColors?.(h),sideOrientation:Xe._GetDefaultSideOrientation(r.sideOrientation||Xe.DOUBLESIDE)},s,n);l.push(_),h++}}const c=Xe.MergeMeshes(l,!0,!0);if(c){const t=c.getBoundingInfo().boundingBox;c.position.x+=-(t.minimumWorld.x+t.maximumWorld.x)/2,c.position.y+=-(t.minimumWorld.y+t.maximumWorld.y)/2,c.position.z+=-(t.minimumWorld.z+t.maximumWorld.z)/2+t.extendSize.z,c.name=e;const i=new j("pivot",s);i.rotation.x=-Math.PI/2,c.parent=i,c.bakeCurrentTransformIntoVertices(),c.parent=null,i.dispose()}return c}},Ur={effect:null,subMesh:null};class Vr extends Ht{constructor(e){super(e),this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.DIFFUSE=!1,this.DIFFUSEDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.OPACITY=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.REFLECTION=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.SPECULAR=!1,this.SPECULARDIRECTUV=0,this.BUMP=!1,this.BUMPDIRECTUV=0,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.SPECULAROVERALPHA=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHAFROMDIFFUSE=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.DIFFUSEFRESNEL=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONFRESNEL=!1,this.REFRACTIONFRESNEL=!1,this.EMISSIVEFRESNEL=!1,this.FRESNEL=!1,this.NORMAL=!1,this.TANGENT=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.GLOSSINESS=!1,this.ROUGHNESS=!1,this.EMISSIVEASILLUMINATION=!1,this.LINKEMISSIVEWITHDIFFUSE=!1,this.REFLECTIONFRESNELFROMSPECULAR=!1,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.USELIGHTMAPASSHADOWMAP=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.INVERTCUBICMAP=!1,this.LOGARITHMICDEPTH=!1,this.REFRACTION=!1,this.REFRACTIONMAP_3D=!1,this.REFLECTIONOVERALPHA=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.NONUNIFORMSCALING=!1,this.PREMULTIPLYALPHA=!1,this.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,this.ALPHABLEND=!0,this.PREPASS=!1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_NDC_DEPTH=!1,this.PREPASS_NDC_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.RGBDLIGHTMAP=!1,this.RGBDREFLECTION=!1,this.RGBDREFRACTION=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.IS_REFLECTION_LINEAR=!1,this.IS_REFRACTION_LINEAR=!1,this.EXPOSURE=!1,this.DECAL_AFTER_DETAIL=!1,this.rebuild()}setReflectionMode(e){const t=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];for(const i of t)this[i]=i===e}}class zr extends ri{get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()}_attachImageProcessingConfiguration(e){e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}get isPrePassCapable(){return!this.disableDepthWrite}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(e){this.imageProcessingConfiguration.colorCurvesEnabled=e}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(e){this.imageProcessingConfiguration.colorGradingEnabled=e}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(e){this._imageProcessingConfiguration.toneMappingEnabled=e}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(e){this._imageProcessingConfiguration.exposure=e}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(e){this._imageProcessingConfiguration.contrast=e}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(e){this._imageProcessingConfiguration.colorGradingTexture=e}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(e){this._imageProcessingConfiguration.colorCurves=e}get canRenderToMRT(){return!0}constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(e,t),this._diffuseTexture=null,this._ambientTexture=null,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._specularTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._refractionTexture=null,this.ambientColor=new E.v9(0,0,0),this.diffuseColor=new E.v9(1,1,1),this.specularColor=new E.v9(1,1,1),this.emissiveColor=new E.v9(0,0,0),this.specularPower=64,this._useAlphaFromDiffuseTexture=!1,this._useEmissiveAsIllumination=!1,this._linkEmissiveWithDiffuse=!1,this._useSpecularOverAlpha=!1,this._useReflectionOverAlpha=!1,this._disableLighting=!1,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this._roughness=0,this.indexOfRefraction=.98,this.invertRefractionY=!0,this.alphaCutOff=.4,this._useLightmapAsShadowmap=!1,this._useReflectionFresnelFromSpecular=!1,this._useGlossinessFromSpecularMapAlpha=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._applyDecalMapAfterDetailMap=!1,this._shadersLoaded=!1,this._renderTargets=new y.L(16),this._worldViewProjectionMatrix=o.uq.Zero(),this._globalAmbientColor=new E.v9(0,0,0),this._cacheHasRenderTargetTextures=!1;const r=this.getScene().getEngine();!r.isWebGPU||i||zr.ForceGLSL||(this._uniformBuffer&&this._uniformBuffer.dispose(),this._uniformBuffer=new $.D(r,void 0,void 0,this.name,!0),this._shaderLanguage=1),this.detailMap=new mi(this),this._attachImageProcessingConfiguration(null),this.prePassConfiguration=new ti,this.getRenderTargetTextures=()=>(this._renderTargets.reset(),zr.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),zr.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._renderTargets.push(this._refractionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets)}get hasRenderTargetTextures(){return!!(zr.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||(!!(zr.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures)}getClassName(){return"StandardMaterial"}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)}needAlphaTesting(){return!!this._forceAlphaTest||this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===Ne.MATERIAL_ALPHATEST)}_shouldUseAlphaFromDiffuseTexture(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==Ne.MATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha||null!=this._opacityTexture}getAlphaTestTexture(){return this._diffuseTexture}isReadyForSubMesh(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._uniformBufferLayoutBuilt||this.buildUniformLayout();const s=t._drawWrapper;if(s.effect&&this.isFrozen&&s._wasPreviouslyReady&&s._wasPreviouslyUsingInstances===r)return!0;t.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),t.materialDefines=new Vr(this._eventInfo.defineNames));const n=this.getScene(),a=t.materialDefines;if(this._isReadyForSubMesh(t))return!0;const o=n.getEngine();a._needNormals=Se(n,e,a,!0,this._maxSimultaneousLights,this._disableLighting),Oe(n,a);const l=this.needAlphaBlendingForMesh(e)&&this.getScene().useOrderIndependentTransparency;if(we(n,a,this.canRenderToMRT&&!l),De(n,a,l),a._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,a._needUVs=!1;for(let e=1;e<=6;++e)a["MAINUV"+e]=!1;if(n.texturesEnabled){if(a.DIFFUSEDIRECTUV=0,a.BUMPDIRECTUV=0,a.AMBIENTDIRECTUV=0,a.OPACITYDIRECTUV=0,a.EMISSIVEDIRECTUV=0,a.SPECULARDIRECTUV=0,a.LIGHTMAPDIRECTUV=0,this._diffuseTexture&&zr.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;me(this._diffuseTexture,a,"DIFFUSE")}else a.DIFFUSE=!1;if(this._ambientTexture&&zr.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;me(this._ambientTexture,a,"AMBIENT")}else a.AMBIENT=!1;if(this._opacityTexture&&zr.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;me(this._opacityTexture,a,"OPACITY"),a.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else a.OPACITY=!1;if(this._reflectionTexture&&zr.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(a._needNormals=!0,a.REFLECTION=!0,a.ROUGHNESS=this._roughness>0,a.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,a.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===kt.g.INVCUBIC_MODE,a.REFLECTIONMAP_3D=this._reflectionTexture.isCube,a.REFLECTIONMAP_OPPOSITEZ=a.REFLECTIONMAP_3D&&this.getScene().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ,a.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case kt.g.EXPLICIT_MODE:a.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case kt.g.PLANAR_MODE:a.setReflectionMode("REFLECTIONMAP_PLANAR");break;case kt.g.PROJECTION_MODE:a.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case kt.g.SKYBOX_MODE:a.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case kt.g.SPHERICAL_MODE:a.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case kt.g.EQUIRECTANGULAR_MODE:a.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case kt.g.FIXED_EQUIRECTANGULAR_MODE:a.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case kt.g.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:a.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case kt.g.CUBIC_MODE:case kt.g.INVCUBIC_MODE:default:a.setReflectionMode("REFLECTIONMAP_CUBIC")}a.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else a.REFLECTION=!1,a.REFLECTIONMAP_OPPOSITEZ=!1;if(this._emissiveTexture&&zr.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;me(this._emissiveTexture,a,"EMISSIVE")}else a.EMISSIVE=!1;if(this._lightmapTexture&&zr.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;me(this._lightmapTexture,a,"LIGHTMAP"),a.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,a.RGBDLIGHTMAP=this._lightmapTexture.isRGBD}else a.LIGHTMAP=!1;if(this._specularTexture&&zr.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;me(this._specularTexture,a,"SPECULAR"),a.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else a.SPECULAR=!1;if(n.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&zr.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;me(this._bumpTexture,a,"BUMP"),a.PARALLAX=this._useParallax,a.PARALLAX_RHS=n.useRightHandedSystem,a.PARALLAXOCCLUSION=this._useParallaxOcclusion,a.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else a.BUMP=!1,a.PARALLAX=!1,a.PARALLAX_RHS=!1,a.PARALLAXOCCLUSION=!1;if(this._refractionTexture&&zr.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;a._needUVs=!0,a.REFRACTION=!0,a.REFRACTIONMAP_3D=this._refractionTexture.isCube,a.RGBDREFRACTION=this._refractionTexture.isRGBD,a.USE_LOCAL_REFRACTIONMAP_CUBIC=!!this._refractionTexture.boundingBoxSize}else a.REFRACTION=!1;a.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else a.DIFFUSE=!1,a.AMBIENT=!1,a.OPACITY=!1,a.REFLECTION=!1,a.EMISSIVE=!1,a.LIGHTMAP=!1,a.BUMP=!1,a.REFRACTION=!1;a.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),a.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,a.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,a.SPECULAROVERALPHA=this._useSpecularOverAlpha,a.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,a.ALPHATEST_AFTERALLALPHACOMPUTATIONS=null!==this.transparencyMode,a.ALPHABLEND=null===this.transparencyMode||this.needAlphaBlendingForMesh(e)}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=a,this._eventInfo.subMesh=t,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(a._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(a),a.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,a.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}a._areFresnelDirty&&(zr.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(a.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,a.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,a.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,a.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,a.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,a.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,a._needNormals=!0,a.FRESNEL=!0):a.FRESNEL=!1),Ee(e,n,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e)||this._forceAlphaTest,a,this._applyDecalMapAfterDetailMap),Pe(n,o,this,a,r,null,t.getRenderingMesh().hasThinInstances),this._eventInfo.defines=a,this._eventInfo.mesh=e,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),Ie(e,a,!0,!0,!0),this._callbackPluginEventPrepareDefines(this._eventInfo);let h=!1;if(a.isDirty){const r=a._areLightsDisposed;a.markAsProcessed();const s=new ni;a.REFLECTION&&s.addFallback(0,"REFLECTION"),a.SPECULAR&&s.addFallback(0,"SPECULAR"),a.BUMP&&s.addFallback(0,"BUMP"),a.PARALLAX&&s.addFallback(1,"PARALLAX"),a.PARALLAX_RHS&&s.addFallback(1,"PARALLAX_RHS"),a.PARALLAXOCCLUSION&&s.addFallback(0,"PARALLAXOCCLUSION"),a.SPECULAROVERALPHA&&s.addFallback(0,"SPECULAROVERALPHA"),a.FOG&&s.addFallback(1,"FOG"),a.POINTSIZE&&s.addFallback(0,"POINTSIZE"),a.LOGARITHMICDEPTH&&s.addFallback(0,"LOGARITHMICDEPTH"),Re(a,s,this._maxSimultaneousLights),a.SPECULARTERM&&s.addFallback(0,"SPECULARTERM"),a.DIFFUSEFRESNEL&&s.addFallback(1,"DIFFUSEFRESNEL"),a.OPACITYFRESNEL&&s.addFallback(2,"OPACITYFRESNEL"),a.REFLECTIONFRESNEL&&s.addFallback(3,"REFLECTIONFRESNEL"),a.EMISSIVEFRESNEL&&s.addFallback(4,"EMISSIVEFRESNEL"),a.FRESNEL&&s.addFallback(4,"FRESNEL"),a.MULTIVIEW&&s.addFallback(0,"MULTIVIEW");const l=[S.R.PositionKind];a.NORMAL&&l.push(S.R.NormalKind),a.TANGENT&&l.push(S.R.TangentKind);for(let e=1;e<=6;++e)a["UV"+e]&&l.push(`uv${1===e?"":e}`);a.VERTEXCOLOR&&l.push(S.R.ColorKind),Ae(l,e,a,s),Ce(l,a),_e(l,e,a),ve(l,0,a);let c="default";const u=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices"],d=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],_=["Material","Scene","Mesh"],p={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:a.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=s,this._eventInfo.fallbackRank=0,this._eventInfo.defines=a,this._eventInfo.uniforms=u,this._eventInfo.attributes=l,this._eventInfo.samplers=d,this._eventInfo.uniformBuffersNames=_,this._eventInfo.customCode=void 0,this._eventInfo.mesh=e,this._eventInfo.indexParameters=p,this._callbackPluginEventGeneric(128,this._eventInfo),ti.AddUniforms(u),ti.AddSamplers(d),ii.p&&(ii.p.PrepareUniforms(u,a),ii.p.PrepareSamplers(d,a)),Be({uniformsNames:u,uniformBuffersNames:_,samplers:d,defines:a,maxSimultaneousLights:this._maxSimultaneousLights}),oe(u);const f={};this.customShaderNameResolve&&(c=this.customShaderNameResolve(c,u,_,d,a,l,f));const g=a.toString(),m=t.effect;let b=n.getEngine().createEffect(c,{attributes:l,uniformsNames:u,uniformBuffersNames:_,samplers:d,defines:g,fallbacks:s,onCompiled:this.onCompiled,onError:this.onError,indexParameters:p,processFinalCode:f.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:a.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this._shaderLanguage?await Promise.all([Promise.all([i.e(835),i.e(736)]).then(i.bind(i,7736)),Promise.all([i.e(72),i.e(605)]).then(i.bind(i,5605))]):await Promise.all([Promise.all([i.e(176),i.e(73)]).then(i.bind(i,73)),Promise.all([i.e(680),i.e(386)]).then(i.bind(i,6005))]),this._shadersLoaded=!0}},o);if(this._eventInfo.customCode=void 0,b)if(this._onEffectCreatedObservable&&(Ur.effect=b,Ur.subMesh=t,this._onEffectCreatedObservable.notifyObservers(Ur)),this.allowShaderHotSwapping&&m&&!b.isReady()){if(b=m,a.markAsUnprocessed(),h=this.isFrozen,r)return a._areLightsDisposed=!0,!1}else n.resetCachedMaterial(),t.setEffect(b,a,this._materialContext)}return!(!t.effect||!t.effect.isReady())&&(a._renderId=n.getRenderId(),s._wasPreviouslyReady=!h,s._wasPreviouslyUsingInstances=r,this._checkScenePerformancePriority(),!0)}buildUniformLayout(){const e=this._uniformBuffer;e.addUniform("diffuseLeftColor",4),e.addUniform("diffuseRightColor",4),e.addUniform("opacityParts",4),e.addUniform("reflectionLeftColor",4),e.addUniform("reflectionRightColor",4),e.addUniform("refractionLeftColor",4),e.addUniform("refractionRightColor",4),e.addUniform("emissiveLeftColor",4),e.addUniform("emissiveRightColor",4),e.addUniform("vDiffuseInfos",2),e.addUniform("vAmbientInfos",2),e.addUniform("vOpacityInfos",2),e.addUniform("vReflectionInfos",2),e.addUniform("vReflectionPosition",3),e.addUniform("vReflectionSize",3),e.addUniform("vEmissiveInfos",2),e.addUniform("vLightmapInfos",2),e.addUniform("vSpecularInfos",2),e.addUniform("vBumpInfos",3),e.addUniform("diffuseMatrix",16),e.addUniform("ambientMatrix",16),e.addUniform("opacityMatrix",16),e.addUniform("reflectionMatrix",16),e.addUniform("emissiveMatrix",16),e.addUniform("lightmapMatrix",16),e.addUniform("specularMatrix",16),e.addUniform("bumpMatrix",16),e.addUniform("vTangentSpaceParams",2),e.addUniform("pointSize",1),e.addUniform("alphaCutOff",1),e.addUniform("refractionMatrix",16),e.addUniform("vRefractionInfos",4),e.addUniform("vRefractionPosition",3),e.addUniform("vRefractionSize",3),e.addUniform("vSpecularColor",4),e.addUniform("vEmissiveColor",3),e.addUniform("vDiffuseColor",4),e.addUniform("vAmbientColor",3),super.buildUniformLayout()}bindForSubMesh(e,t,i){const r=this.getScene(),s=i.materialDefines;if(!s)return;const n=i.effect;if(!n)return;this._activeEffect=n,t.getMeshUniformBuffer().bindToEffect(n,"Mesh"),t.transferToEffect(e),this._uniformBuffer.bindToEffect(n,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,r,t,e,this.isFrozen),this._eventInfo.subMesh=i,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),s.OBJECTSPACE_NORMALMAP&&(e.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const a=this._mustRebind(r,n,i,t.visibility);ye(t,n);const o=this._uniformBuffer;if(a){if(this.bindViewProjection(n),!o.useUbo||!this.isFrozen||!o.isSync||i._drawWrapper._forceRebindOnNextCall){if(zr.FresnelEnabled&&s.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(o.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),o.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&o.updateColor4("opacityParts",new E.v9(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(o.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),o.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(o.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),o.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(o.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),o.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),r.texturesEnabled){if(this._diffuseTexture&&zr.DiffuseTextureEnabled&&(o.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),be(this._diffuseTexture,o,"diffuse")),this._ambientTexture&&zr.AmbientTextureEnabled&&(o.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),be(this._ambientTexture,o,"ambient")),this._opacityTexture&&zr.OpacityTextureEnabled&&(o.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),be(this._opacityTexture,o,"opacity")),this._hasAlphaChannel()&&o.updateFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&zr.ReflectionTextureEnabled&&(o.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),o.updateMatrix("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize)){const e=this._reflectionTexture;o.updateVector3("vReflectionPosition",e.boundingBoxPosition),o.updateVector3("vReflectionSize",e.boundingBoxSize)}if(this._emissiveTexture&&zr.EmissiveTextureEnabled&&(o.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),be(this._emissiveTexture,o,"emissive")),this._lightmapTexture&&zr.LightmapTextureEnabled&&(o.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),be(this._lightmapTexture,o,"lightmap")),this._specularTexture&&zr.SpecularTextureEnabled&&(o.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),be(this._specularTexture,o,"specular")),this._bumpTexture&&r.getEngine().getCaps().standardDerivatives&&zr.BumpTextureEnabled&&(o.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),be(this._bumpTexture,o,"bump"),r._mirroredCameraPosition?o.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):o.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&zr.RefractionTextureEnabled){let e=1;if(this._refractionTexture.isCube||(o.updateMatrix("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(e=this._refractionTexture.depth)),o.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,e,this.invertRefractionY?-1:1),this._refractionTexture.boundingBoxSize){const e=this._refractionTexture;o.updateVector3("vRefractionPosition",e.boundingBoxPosition),o.updateVector3("vRefractionSize",e.boundingBoxSize)}}}this.pointsCloud&&o.updateFloat("pointSize",this.pointSize),s.SPECULARTERM&&o.updateColor4("vSpecularColor",this.specularColor,this.specularPower),o.updateColor3("vEmissiveColor",zr.EmissiveTextureEnabled?this.emissiveColor:E.v9.BlackReadOnly),o.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha),r.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),o.updateColor3("vAmbientColor",this._globalAmbientColor)}r.texturesEnabled&&(this._diffuseTexture&&zr.DiffuseTextureEnabled&&n.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&zr.AmbientTextureEnabled&&n.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&zr.OpacityTextureEnabled&&n.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&zr.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?n.setTexture("reflectionCubeSampler",this._reflectionTexture):n.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&zr.EmissiveTextureEnabled&&n.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&zr.LightmapTextureEnabled&&n.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&zr.SpecularTextureEnabled&&n.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&r.getEngine().getCaps().standardDerivatives&&zr.BumpTextureEnabled&&n.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&zr.RefractionTextureEnabled&&(this._refractionTexture.isCube?n.setTexture("refractionCubeSampler",this._refractionTexture):n.setTexture("refraction2DSampler",this._refractionTexture))),this.getScene().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(t)&&this.getScene().depthPeelingRenderer.bind(n),this._eventInfo.subMesh=i,this._callbackPluginEventBindForSubMesh(this._eventInfo),le(n,this,r),this.bindEyePosition(n)}else r.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);!a&&this.isFrozen||(r.lightsEnabled&&!this._disableLighting&&xe(r,t,n,s,this._maxSimultaneousLights),(r.fogEnabled&&t.applyFog&&r.fogMode!==Gt.Z.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||t.receiveShadows||s.PREPASS)&&this.bindView(n),de(r,t,n),s.NUM_MORPH_INFLUENCERS&&fe(t,n),s.BAKED_VERTEX_ANIMATION_TEXTURE&&t.bakedVertexAnimationManager?.bind(n,s.INSTANCES),this.useLogarithmicDepth&&ue(s,n,r),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)),this._afterBind(t,this._activeEffect,i),o.update()}getAnimatables(){const e=super.getAnimatables();return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&e.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&e.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&e.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&e.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&e.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&e.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&e.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&e.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&e.push(this._refractionTexture),e}getActiveTextures(){const e=super.getActiveTextures();return this._diffuseTexture&&e.push(this._diffuseTexture),this._ambientTexture&&e.push(this._ambientTexture),this._opacityTexture&&e.push(this._opacityTexture),this._reflectionTexture&&e.push(this._reflectionTexture),this._emissiveTexture&&e.push(this._emissiveTexture),this._specularTexture&&e.push(this._specularTexture),this._bumpTexture&&e.push(this._bumpTexture),this._lightmapTexture&&e.push(this._lightmapTexture),this._refractionTexture&&e.push(this._refractionTexture),e}hasTexture(e){return!!super.hasTexture(e)||(this._diffuseTexture===e||(this._ambientTexture===e||(this._opacityTexture===e||(this._reflectionTexture===e||(this._emissiveTexture===e||(this._specularTexture===e||(this._bumpTexture===e||(this._lightmapTexture===e||this._refractionTexture===e))))))))}dispose(e,t){t&&(this._diffuseTexture?.dispose(),this._ambientTexture?.dispose(),this._opacityTexture?.dispose(),this._reflectionTexture?.dispose(),this._emissiveTexture?.dispose(),this._specularTexture?.dispose(),this._bumpTexture?.dispose(),this._lightmapTexture?.dispose(),this._refractionTexture?.dispose()),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(e,t)}clone(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const r=c.p.Clone((()=>new zr(e,this.getScene())),this,{cloneTexturesOnlyOnce:t});return r.name=e,r.id=e,this.stencil.copyTo(r.stencil),this._clonePlugins(r,i),r}static Parse(e,t,i){const r=c.p.Parse((()=>new zr(e.name,t)),e,t,i);return e.stencil&&r.stencil.parse(e.stencil,t,i),Ne._ParsePlugins(e,r,t,i),r}static get DiffuseTextureEnabled(){return si.DiffuseTextureEnabled}static set DiffuseTextureEnabled(e){si.DiffuseTextureEnabled=e}static get DetailTextureEnabled(){return si.DetailTextureEnabled}static set DetailTextureEnabled(e){si.DetailTextureEnabled=e}static get AmbientTextureEnabled(){return si.AmbientTextureEnabled}static set AmbientTextureEnabled(e){si.AmbientTextureEnabled=e}static get OpacityTextureEnabled(){return si.OpacityTextureEnabled}static set OpacityTextureEnabled(e){si.OpacityTextureEnabled=e}static get ReflectionTextureEnabled(){return si.ReflectionTextureEnabled}static set ReflectionTextureEnabled(e){si.ReflectionTextureEnabled=e}static get EmissiveTextureEnabled(){return si.EmissiveTextureEnabled}static set EmissiveTextureEnabled(e){si.EmissiveTextureEnabled=e}static get SpecularTextureEnabled(){return si.SpecularTextureEnabled}static set SpecularTextureEnabled(e){si.SpecularTextureEnabled=e}static get BumpTextureEnabled(){return si.BumpTextureEnabled}static set BumpTextureEnabled(e){si.BumpTextureEnabled=e}static get LightmapTextureEnabled(){return si.LightmapTextureEnabled}static set LightmapTextureEnabled(e){si.LightmapTextureEnabled=e}static get RefractionTextureEnabled(){return si.RefractionTextureEnabled}static set RefractionTextureEnabled(e){si.RefractionTextureEnabled=e}static get ColorGradingTextureEnabled(){return si.ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(e){si.ColorGradingTextureEnabled=e}static get FresnelEnabled(){return si.FresnelEnabled}static set FresnelEnabled(e){si.FresnelEnabled=e}}zr.ForceGLSL=!1,(0,s.Cg)([(0,n.uM)("diffuseTexture")],zr.prototype,"_diffuseTexture",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesAndMiscDirty")],zr.prototype,"diffuseTexture",void 0),(0,s.Cg)([(0,n.uM)("ambientTexture")],zr.prototype,"_ambientTexture",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],zr.prototype,"ambientTexture",void 0),(0,s.Cg)([(0,n.uM)("opacityTexture")],zr.prototype,"_opacityTexture",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesAndMiscDirty")],zr.prototype,"opacityTexture",void 0),(0,s.Cg)([(0,n.uM)("reflectionTexture")],zr.prototype,"_reflectionTexture",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],zr.prototype,"reflectionTexture",void 0),(0,s.Cg)([(0,n.uM)("emissiveTexture")],zr.prototype,"_emissiveTexture",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],zr.prototype,"emissiveTexture",void 0),(0,s.Cg)([(0,n.uM)("specularTexture")],zr.prototype,"_specularTexture",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],zr.prototype,"specularTexture",void 0),(0,s.Cg)([(0,n.uM)("bumpTexture")],zr.prototype,"_bumpTexture",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],zr.prototype,"bumpTexture",void 0),(0,s.Cg)([(0,n.uM)("lightmapTexture")],zr.prototype,"_lightmapTexture",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],zr.prototype,"lightmapTexture",void 0),(0,s.Cg)([(0,n.uM)("refractionTexture")],zr.prototype,"_refractionTexture",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],zr.prototype,"refractionTexture",void 0),(0,s.Cg)([(0,n.jT)("ambient")],zr.prototype,"ambientColor",void 0),(0,s.Cg)([(0,n.jT)("diffuse")],zr.prototype,"diffuseColor",void 0),(0,s.Cg)([(0,n.jT)("specular")],zr.prototype,"specularColor",void 0),(0,s.Cg)([(0,n.jT)("emissive")],zr.prototype,"emissiveColor",void 0),(0,s.Cg)([(0,n.lK)()],zr.prototype,"specularPower",void 0),(0,s.Cg)([(0,n.lK)("useAlphaFromDiffuseTexture")],zr.prototype,"_useAlphaFromDiffuseTexture",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesAndMiscDirty")],zr.prototype,"useAlphaFromDiffuseTexture",void 0),(0,s.Cg)([(0,n.lK)("useEmissiveAsIllumination")],zr.prototype,"_useEmissiveAsIllumination",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],zr.prototype,"useEmissiveAsIllumination",void 0),(0,s.Cg)([(0,n.lK)("linkEmissiveWithDiffuse")],zr.prototype,"_linkEmissiveWithDiffuse",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],zr.prototype,"linkEmissiveWithDiffuse",void 0),(0,s.Cg)([(0,n.lK)("useSpecularOverAlpha")],zr.prototype,"_useSpecularOverAlpha",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],zr.prototype,"useSpecularOverAlpha",void 0),(0,s.Cg)([(0,n.lK)("useReflectionOverAlpha")],zr.prototype,"_useReflectionOverAlpha",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],zr.prototype,"useReflectionOverAlpha",void 0),(0,s.Cg)([(0,n.lK)("disableLighting")],zr.prototype,"_disableLighting",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsLightsDirty")],zr.prototype,"disableLighting",void 0),(0,s.Cg)([(0,n.lK)("useObjectSpaceNormalMap")],zr.prototype,"_useObjectSpaceNormalMap",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],zr.prototype,"useObjectSpaceNormalMap",void 0),(0,s.Cg)([(0,n.lK)("useParallax")],zr.prototype,"_useParallax",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],zr.prototype,"useParallax",void 0),(0,s.Cg)([(0,n.lK)("useParallaxOcclusion")],zr.prototype,"_useParallaxOcclusion",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],zr.prototype,"useParallaxOcclusion",void 0),(0,s.Cg)([(0,n.lK)()],zr.prototype,"parallaxScaleBias",void 0),(0,s.Cg)([(0,n.lK)("roughness")],zr.prototype,"_roughness",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],zr.prototype,"roughness",void 0),(0,s.Cg)([(0,n.lK)()],zr.prototype,"indexOfRefraction",void 0),(0,s.Cg)([(0,n.lK)()],zr.prototype,"invertRefractionY",void 0),(0,s.Cg)([(0,n.lK)()],zr.prototype,"alphaCutOff",void 0),(0,s.Cg)([(0,n.lK)("useLightmapAsShadowmap")],zr.prototype,"_useLightmapAsShadowmap",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],zr.prototype,"useLightmapAsShadowmap",void 0),(0,s.Cg)([(0,n.Y9)("diffuseFresnelParameters")],zr.prototype,"_diffuseFresnelParameters",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsFresnelDirty")],zr.prototype,"diffuseFresnelParameters",void 0),(0,s.Cg)([(0,n.Y9)("opacityFresnelParameters")],zr.prototype,"_opacityFresnelParameters",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsFresnelAndMiscDirty")],zr.prototype,"opacityFresnelParameters",void 0),(0,s.Cg)([(0,n.Y9)("reflectionFresnelParameters")],zr.prototype,"_reflectionFresnelParameters",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsFresnelDirty")],zr.prototype,"reflectionFresnelParameters",void 0),(0,s.Cg)([(0,n.Y9)("refractionFresnelParameters")],zr.prototype,"_refractionFresnelParameters",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsFresnelDirty")],zr.prototype,"refractionFresnelParameters",void 0),(0,s.Cg)([(0,n.Y9)("emissiveFresnelParameters")],zr.prototype,"_emissiveFresnelParameters",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsFresnelDirty")],zr.prototype,"emissiveFresnelParameters",void 0),(0,s.Cg)([(0,n.lK)("useReflectionFresnelFromSpecular")],zr.prototype,"_useReflectionFresnelFromSpecular",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsFresnelDirty")],zr.prototype,"useReflectionFresnelFromSpecular",void 0),(0,s.Cg)([(0,n.lK)("useGlossinessFromSpecularMapAlpha")],zr.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],zr.prototype,"useGlossinessFromSpecularMapAlpha",void 0),(0,s.Cg)([(0,n.lK)("maxSimultaneousLights")],zr.prototype,"_maxSimultaneousLights",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsLightsDirty")],zr.prototype,"maxSimultaneousLights",void 0),(0,s.Cg)([(0,n.lK)("invertNormalMapX")],zr.prototype,"_invertNormalMapX",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],zr.prototype,"invertNormalMapX",void 0),(0,s.Cg)([(0,n.lK)("invertNormalMapY")],zr.prototype,"_invertNormalMapY",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],zr.prototype,"invertNormalMapY",void 0),(0,s.Cg)([(0,n.lK)("twoSidedLighting")],zr.prototype,"_twoSidedLighting",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],zr.prototype,"twoSidedLighting",void 0),(0,s.Cg)([(0,n.lK)("applyDecalMapAfterDetailMap")],zr.prototype,"_applyDecalMapAfterDetailMap",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsMiscDirty")],zr.prototype,"applyDecalMapAfterDetailMap",void 0),(0,x.Y5)("BABYLON.StandardMaterial",zr),Gt.Z.DefaultMaterialFactory=e=>new zr("default material",e);class Gr extends d{get range(){return this._range}set range(e){this._range=e,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(e){this._intensityMode=e,this._computePhotometricScale()}get radius(){return this._radius}set radius(e){this._radius=e,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(e){this._shadowEnabled!==e&&(this._shadowEnabled=e,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(e){this._includedOnlyMeshes=e,this._hookArrayForIncludedOnly(e)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(e){this._excludedMeshes=e,this._hookArrayForExcluded(e)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(e){this._excludeWithLayerMask=e,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(e){this._includeOnlyWithLayerMask=e,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(e){this._lightmapMode!==e&&(this._lightmapMode=e,this._markMeshesAsLightDirty())}getViewMatrix(e){return null}getProjectionMatrix(e,t){return null}constructor(e,t){super(e,t,!1),this.diffuse=new E.v9(1,1,1),this.specular=new E.v9(1,1,1),this.falloffType=Gr.FALLOFF_DEFAULT,this.intensity=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=Gr.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.getScene().addLight(this),this._uniformBuffer=new $.D(this.getScene().getEngine(),void 0,void 0,e),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(e,t){return this}_bindLight(e,t,i,r){let s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const n=e.toString();let a=!1;if(this._uniformBuffer.bindToEffect(i,"Light"+n),this._renderId!==t.getRenderId()||this._lastUseSpecular!==r||!this._uniformBuffer.useUbo){this._renderId=t.getRenderId(),this._lastUseSpecular=r;const e=this.getScaledIntensity();this.transferToEffect(i,n),this.diffuse.scaleToRef(e,E.IG.Color3[0]),this._uniformBuffer.updateColor4("vLightDiffuse",E.IG.Color3[0],this.range,n),r&&(this.specular.scaleToRef(e,E.IG.Color3[1]),this._uniformBuffer.updateColor4("vLightSpecular",E.IG.Color3[1],this.radius,n)),a=!0}if(this.transferTexturesToEffect(i,n),t.shadowsEnabled&&this.shadowEnabled&&s){const e=this.getShadowGenerator(t.activeCamera)??this.getShadowGenerator();e&&(e.bindShadowLight(n,i),a=!0)}a?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(e){let t="Name: "+this.name;if(t+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let i=0;i<this.animations.length;i++)t+=", animation[0]: "+this.animations[i].toString(e);return t}_syncParentEnabledState(){super._syncParentEnabledState(),this.isDisposed()||this._resyncMeshes()}setEnabled(e){super.setEnabled(e),this._resyncMeshes()}getShadowGenerator(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===this._shadowGenerators?null:this._shadowGenerators.get(e)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return o.Pq.Zero()}canAffectMesh(e){return!e||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(e))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(e))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&e.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&e.layerMask)))}dispose(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerators){const e=this._shadowGenerators.values();for(let t=e.next();!0!==t.done;t=e.next()){t.value.dispose()}this._shadowGenerators=null}if(this.getScene().stopAnimation(this),this._parentContainer){const e=this._parentContainer.lights.indexOf(this);e>-1&&this._parentContainer.lights.splice(e,1),this._parentContainer=null}for(const i of this.getScene().meshes)i._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.getScene().removeLight(this),super.dispose(e,t)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.intensity}clone(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=Gr.GetConstructorFromName(this.getTypeID(),e,this.getScene());if(!i)return null;const r=c.p.Clone(i,this);return e&&(r.name=e),t&&(r.parent=t),r.setEnabled(this.isEnabled()),this.onClonedObservable.notifyObservers(r),r}serialize(){const e=c.p.Serialize(this);return e.uniqueId=this.uniqueId,e.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(e),this.excludedMeshes.length>0&&(e.excludedMeshesIds=[],this.excludedMeshes.forEach((t=>{e.excludedMeshesIds.push(t.id)}))),this.includedOnlyMeshes.length>0&&(e.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach((t=>{e.includedOnlyMeshesIds.push(t.id)}))),c.p.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e.isEnabled=this.isEnabled(),e}static GetConstructorFromName(e,t,i){const r=d.Construct("Light_Type_"+e,t,i);return r||null}static Parse(e,t){const i=Gr.GetConstructorFromName(e.type,e.name,t);if(!i)return null;const r=c.p.Parse(i,e,t);if(e.excludedMeshesIds&&(r._excludedMeshesIds=e.excludedMeshesIds),e.includedOnlyMeshesIds&&(r._includedOnlyMeshesIds=e.includedOnlyMeshesIds),void 0!==e.parentId&&(r._waitingParentId=e.parentId),void 0!==e.parentInstanceIndex&&(r._waitingParentInstanceIndex=e.parentInstanceIndex),void 0!==e.falloffType&&(r.falloffType=e.falloffType),void 0!==e.lightmapMode&&(r.lightmapMode=e.lightmapMode),e.animations){for(let t=0;t<e.animations.length;t++){const i=e.animations[t],s=(0,x.n9)("BABYLON.Animation");s&&r.animations.push(s.Parse(i))}d.ParseAnimationRanges(r,e,t)}return e.autoAnimate&&t.beginAnimation(r,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),void 0!==e.isEnabled&&r.setEnabled(e.isEnabled),r}_hookArrayForExcluded(e){var t=this;const i=e.push;e.push=function(){for(var r=arguments.length,s=new Array(r),n=0;n<r;n++)s[n]=arguments[n];const a=i.apply(e,s);for(const e of s)e._resyncLightSource(t);return a};const r=e.splice;e.splice=(t,i)=>{const s=r.apply(e,[t,i]);for(const e of s)e._resyncLightSource(this);return s};for(const s of e)s._resyncLightSource(this)}_hookArrayForIncludedOnly(e){var t=this;const i=e.push;e.push=function(){for(var r=arguments.length,s=new Array(r),n=0;n<r;n++)s[n]=arguments[n];const a=i.apply(e,s);return t._resyncMeshes(),a};const r=e.splice;e.splice=(t,i)=>{const s=r.apply(e,[t,i]);return this._resyncMeshes(),s},this._resyncMeshes()}_resyncMeshes(){for(const e of this.getScene().meshes)e._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const e of this.getScene().meshes)-1!==e.lightSources.indexOf(this)&&e._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.getScene().resetCachedMaterial()}_getPhotometricScale(){let e=0;const t=this.getTypeID();let i=this.intensityMode;switch(i===Gr.INTENSITYMODE_AUTOMATIC&&(i=t===Gr.LIGHTTYPEID_DIRECTIONALLIGHT?Gr.INTENSITYMODE_ILLUMINANCE:Gr.INTENSITYMODE_LUMINOUSINTENSITY),t){case Gr.LIGHTTYPEID_POINTLIGHT:case Gr.LIGHTTYPEID_SPOTLIGHT:switch(i){case Gr.INTENSITYMODE_LUMINOUSPOWER:e=1/(4*Math.PI);break;case Gr.INTENSITYMODE_LUMINOUSINTENSITY:e=1;break;case Gr.INTENSITYMODE_LUMINANCE:e=this.radius*this.radius}break;case Gr.LIGHTTYPEID_DIRECTIONALLIGHT:switch(i){case Gr.INTENSITYMODE_ILLUMINANCE:e=1;break;case Gr.INTENSITYMODE_LUMINANCE:{let t=this.radius;t=Math.max(t,.001);e=2*Math.PI*(1-Math.cos(t));break}}break;case Gr.LIGHTTYPEID_HEMISPHERICLIGHT:e=1}return e}_reorderLightsInScene(){const e=this.getScene();0!=this._renderPriority&&(e.requireLightSorting=!0),this.getScene().sortLightsByPriority()}}Gr.FALLOFF_DEFAULT=ae.c.FALLOFF_DEFAULT,Gr.FALLOFF_PHYSICAL=ae.c.FALLOFF_PHYSICAL,Gr.FALLOFF_GLTF=ae.c.FALLOFF_GLTF,Gr.FALLOFF_STANDARD=ae.c.FALLOFF_STANDARD,Gr.LIGHTMAP_DEFAULT=ae.c.LIGHTMAP_DEFAULT,Gr.LIGHTMAP_SPECULAR=ae.c.LIGHTMAP_SPECULAR,Gr.LIGHTMAP_SHADOWSONLY=ae.c.LIGHTMAP_SHADOWSONLY,Gr.INTENSITYMODE_AUTOMATIC=ae.c.INTENSITYMODE_AUTOMATIC,Gr.INTENSITYMODE_LUMINOUSPOWER=ae.c.INTENSITYMODE_LUMINOUSPOWER,Gr.INTENSITYMODE_LUMINOUSINTENSITY=ae.c.INTENSITYMODE_LUMINOUSINTENSITY,Gr.INTENSITYMODE_ILLUMINANCE=ae.c.INTENSITYMODE_ILLUMINANCE,Gr.INTENSITYMODE_LUMINANCE=ae.c.INTENSITYMODE_LUMINANCE,Gr.LIGHTTYPEID_POINTLIGHT=ae.c.LIGHTTYPEID_POINTLIGHT,Gr.LIGHTTYPEID_DIRECTIONALLIGHT=ae.c.LIGHTTYPEID_DIRECTIONALLIGHT,Gr.LIGHTTYPEID_SPOTLIGHT=ae.c.LIGHTTYPEID_SPOTLIGHT,Gr.LIGHTTYPEID_HEMISPHERICLIGHT=ae.c.LIGHTTYPEID_HEMISPHERICLIGHT,(0,s.Cg)([(0,n.jT)()],Gr.prototype,"diffuse",void 0),(0,s.Cg)([(0,n.jT)()],Gr.prototype,"specular",void 0),(0,s.Cg)([(0,n.lK)()],Gr.prototype,"falloffType",void 0),(0,s.Cg)([(0,n.lK)()],Gr.prototype,"intensity",void 0),(0,s.Cg)([(0,n.lK)()],Gr.prototype,"range",null),(0,s.Cg)([(0,n.lK)()],Gr.prototype,"intensityMode",null),(0,s.Cg)([(0,n.lK)()],Gr.prototype,"radius",null),(0,s.Cg)([(0,n.lK)()],Gr.prototype,"_renderPriority",void 0),(0,s.Cg)([(0,n.$z)("_reorderLightsInScene")],Gr.prototype,"renderPriority",void 0),(0,s.Cg)([(0,n.lK)("shadowEnabled")],Gr.prototype,"_shadowEnabled",void 0),(0,s.Cg)([(0,n.lK)("excludeWithLayerMask")],Gr.prototype,"_excludeWithLayerMask",void 0),(0,s.Cg)([(0,n.lK)("includeOnlyWithLayerMask")],Gr.prototype,"_includeOnlyWithLayerMask",void 0),(0,s.Cg)([(0,n.lK)("lightmapMode")],Gr.prototype,"_lightmapMode",void 0),d.AddNodeConstructor("Light_Type_3",((e,t)=>()=>new Hr(e,o.Pq.Zero(),t)));class Hr extends Gr{constructor(e,t,i){super(e,i),this.groundColor=new E.v9(0,0,0),this.direction=t||o.Pq.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"HemisphericLight"}setDirectionToTarget(e){return this.direction=o.Pq.Normalize(e.subtract(o.Pq.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(e,t){const i=o.Pq.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",i.x,i.y,i.z,0,t),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.intensity),t),this}transferToNodeMaterialEffect(e,t){const i=o.Pq.Normalize(this.direction);return e.setFloat3(t,i.x,i.y,i.z),this}computeWorldMatrix(){return this._worldMatrix||(this._worldMatrix=o.uq.Identity()),this._worldMatrix}getTypeID(){return Gr.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(e,t){e["HEMILIGHT"+t]=!0}}(0,s.Cg)([(0,n.jT)()],Hr.prototype,"groundColor",void 0),(0,s.Cg)([(0,n.P_)()],Hr.prototype,"direction",void 0),(0,x.Y5)("BABYLON.HemisphericLight",Hr);var Wr=i(1119),qr=i(1078),Xr=i(6976);class Kr extends Xr.w{set kernel(e){this._idealKernel!==e&&(e=Math.max(e,1),this._idealKernel=e,this._kernel=this._nearestBestKernel(e),this._blockCompilation||this._updateParameters())}get kernel(){return this._idealKernel}set packedFloat(e){this._packedFloat!==e&&(this._packedFloat=e,this._blockCompilation||this._updateParameters())}get packedFloat(){return this._packedFloat}getClassName(){return"BlurPostProcess"}constructor(e,t,i,r,s){let n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:kt.g.BILINEAR_SAMPLINGMODE,a=arguments.length>9&&void 0!==arguments[9]?arguments[9]:"",o=arguments.length>10&&void 0!==arguments[10]&&arguments[10];super(e,"kernelBlur",["delta","direction"],["circleOfConfusionSampler"],r,s,n,arguments.length>6?arguments[6]:void 0,arguments.length>7?arguments[7]:void 0,null,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,"kernelBlur",{varyingCount:0,depCount:0},!0,arguments.length>11&&void 0!==arguments[11]?arguments[11]:5),this._blockCompilation=o,this._packedFloat=!1,this._staticDefines="",this._staticDefines=a,this.direction=t,this.onApplyObservable.add((e=>{this._outputTexture?e.setFloat2("delta",1/this._outputTexture.width*this.direction.x,1/this._outputTexture.height*this.direction.y):e.setFloat2("delta",1/this.width*this.direction.x,1/this.height*this.direction.y)})),this.kernel=i}_gatherImports(e,t){e?(this._webGPUReady=!0,t.push(Promise.all([i.e(383).then(i.bind(i,6383)),i.e(842).then(i.bind(i,8842))]))):t.push(Promise.all([i.e(516).then(i.bind(i,8516)),i.e(861).then(i.bind(i,7861))])),super._gatherImports(e,t)}updateEffect(){let e=arguments.length>4?arguments[4]:void 0,t=arguments.length>5?arguments[5]:void 0;this._updateParameters(e,t)}_updateParameters(e,t){const i=this._kernel,r=(i-1)/2;let s=[],n=[],a=0;for(let f=0;f<i;f++){const e=f/(i-1),t=this._gaussianWeight(2*e-1);s[f]=f-r,n[f]=t,a+=t}for(let f=0;f<n.length;f++)n[f]/=a;const o=[],l=[],h=[];for(let f=0;f<=r;f+=2){const e=Math.min(f+1,Math.floor(r));if(f===e)h.push({o:s[f],w:n[f]});else{const t=e===r,i=n[f]+n[e]*(t?.5:1),a=s[f]+1/(1+n[f]/n[e]);0===a?(h.push({o:s[f],w:n[f]}),h.push({o:s[f+1],w:n[f+1]})):(h.push({o:a,w:i}),h.push({o:-a,w:i}))}}for(let f=0;f<h.length;f++)l[f]=h[f].o,o[f]=h[f].w;s=l,n=o;const c=this.getEngine().getCaps().maxVaryingVectors-(1===this.shaderLanguage?1:0),u=Math.max(c,0)-1;let d=Math.min(s.length,u),_="";_+=this._staticDefines,-1!=this._staticDefines.indexOf("DOF")&&(_+=`#define CENTER_WEIGHT ${this._glslFloat(n[d-1])}\n`,d--);for(let f=0;f<d;f++)_+=`#define KERNEL_OFFSET${f} ${this._glslFloat(s[f])}\n`,_+=`#define KERNEL_WEIGHT${f} ${this._glslFloat(n[f])}\n`;let p=0;for(let f=u;f<s.length;f++)_+=`#define KERNEL_DEP_OFFSET${p} ${this._glslFloat(s[f])}\n`,_+=`#define KERNEL_DEP_WEIGHT${p} ${this._glslFloat(n[f])}\n`,p++;this.packedFloat&&(_+="#define PACKEDFLOAT 1"),this._blockCompilation=!1,super.updateEffect(_,null,null,{varyingCount:d,depCount:p},e,t)}_nearestBestKernel(e){const t=Math.round(e);for(const i of[t,t-1,t+1,t-2,t+2])if(i%2!==0&&Math.floor(i/2)%2===0&&i>0)return Math.max(i,3);return Math.max(t,3)}_gaussianWeight(e){const t=1/3,i=-e*e/(2*t*t);return 1/(Math.sqrt(2*Math.PI)*t)*Math.exp(i)}_glslFloat(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8;return e.toFixed(t).replace(/0+$/,"")}static _Parse(e,t,i,r){return c.p.Parse((()=>new Kr(e.name,e.direction,e.kernel,e.options,t,e.renderTargetSamplingMode,i.getEngine(),e.reusable,e.textureType,void 0,!1)),e,i,r)}}(0,s.Cg)([(0,n.lK)("kernel")],Kr.prototype,"_kernel",void 0),(0,s.Cg)([(0,n.lK)("packedFloat")],Kr.prototype,"_packedFloat",void 0),(0,s.Cg)([(0,n.WM)()],Kr.prototype,"direction",void 0),(0,x.Y5)("BABYLON.BlurPostProcess",Kr);class Yr extends qr.${set blurRatio(e){this._blurRatio!==e&&(this._blurRatio=e,this._preparePostProcesses())}get blurRatio(){return this._blurRatio}set adaptiveBlurKernel(e){this._adaptiveBlurKernel=e,this._autoComputeBlurKernel()}set blurKernel(e){this.blurKernelX=e,this.blurKernelY=e}set blurKernelX(e){this._blurKernelX!==e&&(this._blurKernelX=e,this._preparePostProcesses())}get blurKernelX(){return this._blurKernelX}set blurKernelY(e){this._blurKernelY!==e&&(this._blurKernelY=e,this._preparePostProcesses())}get blurKernelY(){return this._blurKernelY}_autoComputeBlurKernel(){const e=this.getScene().getEngine(),t=this.getRenderWidth()/e.getRenderWidth(),i=this.getRenderHeight()/e.getRenderHeight();this.blurKernelX=this._adaptiveBlurKernel*t,this.blurKernelY=this._adaptiveBlurKernel*i}_onRatioRescale(){this._sizeRatio&&(this.resize(this._initialSizeParameter),this._adaptiveBlurKernel||this._preparePostProcesses()),this._adaptiveBlurKernel&&this._autoComputeBlurKernel()}_updateGammaSpace(){const e=this.getScene();e&&(this.gammaSpace=!e.imageProcessingConfiguration.isEnabled||!e.imageProcessingConfiguration.applyByPostProcess)}constructor(e,t,i,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:kt.g.BILINEAR_SAMPLINGMODE;if(super(e,t,i,r,!0,s,!1,n,!(arguments.length>6&&void 0!==arguments[6])||arguments[6]),this.mirrorPlane=new se.Z(0,1,0,1),this._transformMatrix=o.uq.Zero(),this._mirrorMatrix=o.uq.Zero(),this._adaptiveBlurKernel=0,this._blurKernelX=0,this._blurKernelY=0,this._blurRatio=1,!(i=this.getScene()))return this;this.ignoreCameraViewport=!0,this._updateGammaSpace(),this._imageProcessingConfigChangeObserver=i.imageProcessingConfiguration.onUpdateParameters.add((()=>{this._updateGammaSpace()}));const a=i.getEngine();let l;a.supportsUniformBuffers&&(this._sceneUBO=i.createSceneUniformBuffer(`Scene for Mirror Texture (name "${e}")`)),this.onBeforeBindObservable.add((()=>{a._debugPushGroup?.(`mirror generation for ${e}`,1)})),this.onAfterUnbindObservable.add((()=>{a._debugPopGroup?.(1)})),this.onBeforeRenderObservable.add((()=>{this._sceneUBO&&(this._currentSceneUBO=i.getSceneUniformBuffer(),i.setSceneUniformBuffer(this._sceneUBO),i.getSceneUniformBuffer().unbindEffect()),o.uq.ReflectionToRef(this.mirrorPlane,this._mirrorMatrix),this._mirrorMatrix.multiplyToRef(i.getViewMatrix(),this._transformMatrix),i.setTransformMatrix(this._transformMatrix,i.getProjectionMatrix()),l=i.clipPlane,i.clipPlane=this.mirrorPlane,i._mirroredCameraPosition=o.Pq.TransformCoordinates(i.activeCamera.globalPosition,this._mirrorMatrix)})),this.onAfterRenderObservable.add((()=>{this._sceneUBO&&i.setSceneUniformBuffer(this._currentSceneUBO),i.updateTransformMatrix(),i._mirroredCameraPosition=null,i.clipPlane=l}))}_preparePostProcesses(){if(this.clearPostProcesses(!0),this._blurKernelX&&this._blurKernelY){const e=this.getScene().getEngine(),t=e.getCaps().textureFloatRender&&e.getCaps().textureFloatLinearFiltering?1:2;this._blurX=new Kr("horizontal blur",new o.I9(1,0),this._blurKernelX,this._blurRatio,null,kt.g.BILINEAR_SAMPLINGMODE,e,!1,t),this._blurX.autoClear=!1,1===this._blurRatio&&this.samples<2&&this._texture?this._blurX.inputTexture=this._renderTarget:this._blurX.alwaysForcePOT=!0,this._blurY=new Kr("vertical blur",new o.I9(0,1),this._blurKernelY,this._blurRatio,null,kt.g.BILINEAR_SAMPLINGMODE,e,!1,t),this._blurY.autoClear=!1,this._blurY.alwaysForcePOT=1!==this._blurRatio,this.addPostProcess(this._blurX),this.addPostProcess(this._blurY)}else this._blurY&&(this.removePostProcess(this._blurY),this._blurY.dispose(),this._blurY=null),this._blurX&&(this.removePostProcess(this._blurX),this._blurX.dispose(),this._blurX=null)}clone(){const e=this.getScene();if(!e)return this;const t=this.getSize(),i=new Yr(this.name,t.width,e,this._renderTargetOptions.generateMipMaps,this._renderTargetOptions.type,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer);return i.hasAlpha=this.hasAlpha,i.level=this.level,i.mirrorPlane=this.mirrorPlane.clone(),this.renderList&&(i.renderList=this.renderList.slice(0)),i}serialize(){if(!this.name)return null;const e=super.serialize();return e.mirrorPlane=this.mirrorPlane.asArray(),e}dispose(){super.dispose();const e=this.getScene();e&&e.imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingConfigChangeObserver),this._sceneUBO?.dispose()}}kt.g._CreateMirror=(e,t,i,r)=>new Yr(e,t,i,r);i(9776),i(6952);var jr=i(1322),Qr=i(561);St.w.prototype.createPrefilteredCubeTexture=function(e,t,i,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6?arguments[6]:void 0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,l=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];return this.createCubeTexture(e,t,null,!1,(e=>{if(!e)return void(s&&s(null));const n=e.texture;if(l?e.info.sphericalPolynomial&&(n._sphericalPolynomial=e.info.sphericalPolynomial):n._sphericalPolynomial=new jr.Q,n._source=9,this.getCaps().textureLOD)return void(s&&s(n));const a=this._gl,o=e.width;if(!o)return;const h=[];for(let s=0;s<3;s++){const l=1-s/2,c=r,u=tt.X.Log2(o)*i+r,d=c+(u-c)*l,_=Math.round(Math.min(Math.max(d,0),u)),p=new Et.h(this,2);if(p.type=n.type,p.format=n.format,p.width=Math.pow(2,Math.max(tt.X.Log2(o)-_,0)),p.height=p.width,p.isCube=!0,p._cachedWrapU=0,p._cachedWrapV=0,this._bindTextureDirectly(a.TEXTURE_CUBE_MAP,p,!0),p.samplingMode=2,a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),e.isDDS){const t=e.info,i=e.data;this._unpackFlipY(t.isCompressed),Qr.D.UploadDDSLevels(this,p,i,t,!0,6,_)}else T.V.Warn("DDS is the only prefiltered cube map supported so far.");this._bindTextureDirectly(a.TEXTURE_CUBE_MAP,null);const f=new Wr.t(t);f._isCube=!0,f._texture=p,p.isReady=!0,h.push(f)}n._lodTextureHigh=h[2],n._lodTextureMid=h[1],n._lodTextureLow=h[0],s&&s(n)}),n,a,o,l,i,r)};class $r extends Wr.t{set boundingBoxSize(e){if(this._boundingBoxSize&&this._boundingBoxSize.equals(e))return;this._boundingBoxSize=e;const t=this.getScene();t&&t.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(e){this._rotationY=e,this.setReflectionTextureMatrix(o.uq.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(e,t,i){let r="";return e.forEach((e=>r+=e)),new $r(r,t,null,i,e)}static CreateFromPrefilteredData(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const s=t.useDelayedTextureLoading;t.useDelayedTextureLoading=!1;const n=new $r(e,t,null,!1,null,null,null,void 0,!0,i,r);return t.useDelayedTextureLoading=s,n}constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,c=arguments.length>8&&void 0!==arguments[8]&&arguments[8],u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,d=arguments.length>10&&void 0!==arguments[10]&&arguments[10],_=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,p=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,f=arguments.length>13?arguments[13]:void 0,g=arguments.length>14?arguments[14]:void 0;super(t),this.onLoadObservable=new a.cP,this.boundingBoxPosition=o.Pq.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new o.uq,this._buffer=null,this.name=e,this.url=e,this._noMipmap=r,this.hasAlpha=!1,this.isCube=!0,this._textureMatrix=o.uq.Identity(),this.coordinatesMode=kt.g.CUBIC_MODE;let m=null,b=null;null===i||Array.isArray(i)?(this._noMipmap=r,this._format=h,this._createPolynomials=d,m=i,this._loaderOptions=f,this._useSRGBBuffer=g,this._lodScale=_,this._lodOffset=p):(m=i.extensions??null,this._noMipmap=i.noMipmap??!1,s=i.files??null,b=i.buffer??null,this._format=i.format??5,c=i.prefiltered??!1,u=i.forcedExtension??null,this._createPolynomials=i.createPolynomials??!1,this._lodScale=i.lodScale??.8,this._lodOffset=i.lodOffset??0,this._loaderOptions=i.loaderOptions,this._useSRGBBuffer=i.useSRGBBuffer,n=i.onLoad??null,l=i.onError??null),(e||s)&&this.updateURL(e,u,n,c,l,m,this.getScene()?.useDelayedTextureLoading,s,b)}getClassName(){return"CubeTexture"}updateURL(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=e),this.url=e,t&&(this._forcedExtension=t);const h=e.lastIndexOf("."),c=t||(h>-1?e.substring(h).toLowerCase():""),u=0===c.indexOf(".dds"),d=0===c.indexOf(".env"),_=0===c.indexOf(".basis");if(d?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=r,r&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),o)this._files=o;else if(_||d||u||n||(n=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,n){for(let t=0;t<n.length;t++)this._files.push(e+n[t]);this._extensions=n}this._buffer=l,a?(this.delayLoadState=4,this._delayedOnLoad=i,this._delayedOnError=s):this._loadTexture(i,s)}delayLoad(e){4===this.delayLoadState&&(e&&(this._forcedExtension=e),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(e){if(e.updateFlag===this._textureMatrix.updateFlag)return;if(e.isIdentity()!==this._textureMatrix.isIdentity()&&this.getScene()?.markAllMaterialsAsDirty(1,(e=>-1!==e.getActiveTextures().indexOf(this))),this._textureMatrix=e,!this.getScene()?.useRightHandedSystem)return;const t=o.AA.Vector3[0],i=o.AA.Quaternion[0],r=o.AA.Vector3[1];this._textureMatrix.decompose(t,i,r),i.z*=-1,i.w*=-1,o.uq.ComposeToRef(t,i,r,this._textureMatrixRefraction)}getRefractionTextureMatrix(){return this.getScene()?.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=this.getScene(),r=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const s=()=>{this.onLoadObservable.notifyObservers(this),r&&(r.dispose(),this.getScene()?.markAllMaterialsAsDirty(1)),e&&e()},n=(e,i)=>{this._loadingError=!0,this._errorObject={message:e,exception:i},t&&t(e,i),kt.g.OnTextureLoadErrorObservable.notifyObservers(this)};this._texture?this._texture.isReady?_.S0.SetImmediate((()=>s())):this._texture.onLoadedObservable.add((()=>s())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,i,this._lodScale,this._lodOffset,e,n,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,i,this._files,this._noMipmap,e,n,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),this._texture?.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(e,t,i){const r=c.p.Parse((()=>{let r=!1;return e.prefiltered&&(r=e.prefiltered),new $r(i+(e.url??e.name),t,e.extensions,!1,e.files||null,null,null,void 0,r,e.forcedExtension)}),e,t);if(e.boundingBoxPosition&&(r.boundingBoxPosition=o.Pq.FromArray(e.boundingBoxPosition)),e.boundingBoxSize&&(r.boundingBoxSize=o.Pq.FromArray(e.boundingBoxSize)),e.animations)for(let s=0;s<e.animations.length;s++){const t=e.animations[s],i=(0,x.n9)("BABYLON.Animation");i&&r.animations.push(i.Parse(t))}return r}clone(){let e=0;const t=c.p.Clone((()=>{const t=new $r(this.url,this.getScene()||this._getEngine(),this._extensions,this._noMipmap,this._files);return e=t.uniqueId,t}),this);return t.uniqueId=e,t}}(0,s.Cg)([(0,n.lK)()],$r.prototype,"url",void 0),(0,s.Cg)([(0,n.P_)()],$r.prototype,"boundingBoxPosition",void 0),(0,s.Cg)([(0,n.P_)()],$r.prototype,"boundingBoxSize",null),(0,s.Cg)([(0,n.lK)("rotationY")],$r.prototype,"rotationY",null),(0,s.Cg)([(0,n.lK)("files")],$r.prototype,"_files",void 0),(0,s.Cg)([(0,n.lK)("forcedExtension")],$r.prototype,"_forcedExtension",void 0),(0,s.Cg)([(0,n.lK)("extensions")],$r.prototype,"_extensions",void 0),(0,s.Cg)([(0,n.GG)("textureMatrix")],$r.prototype,"_textureMatrix",void 0),(0,s.Cg)([(0,n.GG)("textureMatrixRefraction")],$r.prototype,"_textureMatrixRefraction",void 0),kt.g._CubeTextureParser=$r.Parse,(0,x.Y5)("BABYLON.CubeTexture",$r);class Zr extends Ht{constructor(){super(),this.DIFFUSE=!1,this.DIFFUSEDIRECTUV=0,this.GAMMADIFFUSE=!1,this.DIFFUSEHASALPHA=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONBLUR=!1,this.REFLECTIONFRESNEL=!1,this.REFLECTIONFALLOFF=!1,this.TEXTURELODSUPPORT=!1,this.PREMULTIPLYALPHA=!1,this.USERGBCOLOR=!1,this.USEHIGHLIGHTANDSHADOWCOLORS=!1,this.BACKMAT_SHADOWONLY=!1,this.NOISE=!1,this.REFLECTIONBGR=!1,this.PROJECTED_GROUND=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.EQUIRECTANGULAR_RELFECTION_FOV=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.UV1=!1,this.UV2=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.NORMAL=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.INSTANCES=!1,this.SHADOWFLOAT=!1,this.LOGARITHMICDEPTH=!1,this.NONUNIFORMSCALING=!1,this.ALPHATEST=!1,this.rebuild()}}class Jr extends ri{get _perceptualColor(){return this.__perceptualColor}set _perceptualColor(e){this.__perceptualColor=e,this._computePrimaryColorFromPerceptualColor(),this._markAllSubMeshesAsLightsDirty()}get primaryColorShadowLevel(){return this._primaryColorShadowLevel}set primaryColorShadowLevel(e){this._primaryColorShadowLevel=e,this._computePrimaryColors(),this._markAllSubMeshesAsLightsDirty()}get primaryColorHighlightLevel(){return this._primaryColorHighlightLevel}set primaryColorHighlightLevel(e){this._primaryColorHighlightLevel=e,this._computePrimaryColors(),this._markAllSubMeshesAsLightsDirty()}set reflectionStandardFresnelWeight(e){let t=e;t<.5?(t*=2,this.reflectionReflectance0=Jr.StandardReflectance0*t,this.reflectionReflectance90=Jr.StandardReflectance90*t):(t=2*t-1,this.reflectionReflectance0=Jr.StandardReflectance0+(1-Jr.StandardReflectance0)*t,this.reflectionReflectance90=Jr.StandardReflectance90+(1-Jr.StandardReflectance90)*t)}get fovMultiplier(){return this._fovMultiplier}set fovMultiplier(e){isNaN(e)&&(e=1),this._fovMultiplier=Math.max(0,Math.min(2,e))}_attachImageProcessingConfiguration(e){e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._computePrimaryColorFromPerceptualColor(),this._markAllSubMeshesAsImageProcessingDirty()}))))}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(e){this.imageProcessingConfiguration.colorCurvesEnabled=e}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(e){this.imageProcessingConfiguration.colorGradingEnabled=e}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(e){this._imageProcessingConfiguration.toneMappingEnabled=e}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(e){this._imageProcessingConfiguration.exposure=e}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(e){this._imageProcessingConfiguration.contrast=e}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(e){this.imageProcessingConfiguration.colorGradingTexture=e}get cameraColorCurves(){return this.imageProcessingConfiguration.colorCurves}set cameraColorCurves(e){this.imageProcessingConfiguration.colorCurves=e}constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(e,t),this.primaryColor=E.v9.White(),this._primaryColorShadowLevel=0,this._primaryColorHighlightLevel=0,this.reflectionTexture=null,this.reflectionBlur=0,this.diffuseTexture=null,this._shadowLights=null,this.shadowLights=null,this.shadowLevel=0,this.sceneCenter=o.Pq.Zero(),this.opacityFresnel=!0,this.reflectionFresnel=!1,this.reflectionFalloffDistance=0,this.reflectionAmount=1,this.reflectionReflectance0=.05,this.reflectionReflectance90=.5,this.useRGBColor=!0,this.enableNoise=!1,this._fovMultiplier=1,this.useEquirectangularFOV=!1,this._maxSimultaneousLights=4,this.maxSimultaneousLights=4,this._shadowOnly=!1,this.shadowOnly=!1,this._imageProcessingObserver=null,this.switchToBGR=!1,this._enableGroundProjection=!1,this.enableGroundProjection=!1,this.projectedGroundRadius=1e3,this.projectedGroundHeight=10,this._renderTargets=new y.L(16),this._reflectionControls=o.IU.Zero(),this._white=E.v9.White(),this._primaryShadowColor=E.v9.Black(),this._primaryHighlightColor=E.v9.Black(),this._shadersLoaded=!1;const r=this.getScene().getEngine();r.isWebGPU&&!i&&(this._uniformBuffer&&this._uniformBuffer.dispose(),this._uniformBuffer=new $.D(r,void 0,void 0,this.name,!0),this._shaderLanguage=1),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),this._diffuseTexture&&this._diffuseTexture.isRenderTarget&&this._renderTargets.push(this._diffuseTexture),this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._renderTargets)}get hasRenderTargetTextures(){return!(!this._diffuseTexture||!this._diffuseTexture.isRenderTarget)||!(!this._reflectionTexture||!this._reflectionTexture.isRenderTarget)}needAlphaTesting(){return!0}needAlphaBlending(){return this.alpha<1||null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha||this._shadowOnly}isReadyForSubMesh(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const s=t._drawWrapper;if(s.effect&&this.isFrozen&&s._wasPreviouslyReady&&s._wasPreviouslyUsingInstances===r)return!0;t.materialDefines||(t.materialDefines=new Zr);const n=this.getScene(),a=t.materialDefines;if(this._isReadyForSubMesh(t))return!0;const o=n.getEngine();if(Se(n,e,a,!1,this._maxSimultaneousLights),a._needNormals=!0,Oe(n,a),a._areTexturesDirty){if(a._needUVs=!1,n.texturesEnabled){if(n.getEngine().getCaps().textureLOD&&(a.TEXTURELODSUPPORT=!0),this._diffuseTexture&&si.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;me(this._diffuseTexture,a,"DIFFUSE"),a.DIFFUSEHASALPHA=this._diffuseTexture.hasAlpha,a.GAMMADIFFUSE=this._diffuseTexture.gammaSpace,a.OPACITYFRESNEL=this._opacityFresnel}else a.DIFFUSE=!1,a.DIFFUSEDIRECTUV=0,a.DIFFUSEHASALPHA=!1,a.GAMMADIFFUSE=!1,a.OPACITYFRESNEL=!1;const e=this._reflectionTexture;if(e&&si.ReflectionTextureEnabled){if(!e.isReadyOrNotBlocking())return!1;switch(a.REFLECTION=!0,a.GAMMAREFLECTION=e.gammaSpace,a.RGBDREFLECTION=e.isRGBD,a.REFLECTIONBLUR=this._reflectionBlur>0,a.LODINREFLECTIONALPHA=e.lodLevelInAlpha,a.EQUIRECTANGULAR_RELFECTION_FOV=this.useEquirectangularFOV,a.REFLECTIONBGR=this.switchToBGR,e.coordinatesMode===kt.g.INVCUBIC_MODE&&(a.INVERTCUBICMAP=!0),a.REFLECTIONMAP_3D=e.isCube,a.REFLECTIONMAP_OPPOSITEZ=a.REFLECTIONMAP_3D&&this.getScene().useRightHandedSystem?!e.invertZ:e.invertZ,e.coordinatesMode){case kt.g.EXPLICIT_MODE:a.REFLECTIONMAP_EXPLICIT=!0;break;case kt.g.PLANAR_MODE:a.REFLECTIONMAP_PLANAR=!0;break;case kt.g.PROJECTION_MODE:a.REFLECTIONMAP_PROJECTION=!0;break;case kt.g.SKYBOX_MODE:a.REFLECTIONMAP_SKYBOX=!0;break;case kt.g.SPHERICAL_MODE:a.REFLECTIONMAP_SPHERICAL=!0;break;case kt.g.EQUIRECTANGULAR_MODE:a.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case kt.g.FIXED_EQUIRECTANGULAR_MODE:a.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case kt.g.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:a.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case kt.g.CUBIC_MODE:case kt.g.INVCUBIC_MODE:default:a.REFLECTIONMAP_CUBIC=!0}this.reflectionFresnel?(a.REFLECTIONFRESNEL=!0,a.REFLECTIONFALLOFF=this.reflectionFalloffDistance>0,this._reflectionControls.x=this.reflectionAmount,this._reflectionControls.y=this.reflectionReflectance0,this._reflectionControls.z=this.reflectionReflectance90,this._reflectionControls.w=1/this.reflectionFalloffDistance):(a.REFLECTIONFRESNEL=!1,a.REFLECTIONFALLOFF=!1)}else a.REFLECTION=!1,a.REFLECTIONFRESNEL=!1,a.REFLECTIONFALLOFF=!1,a.REFLECTIONBLUR=!1,a.REFLECTIONMAP_3D=!1,a.REFLECTIONMAP_SPHERICAL=!1,a.REFLECTIONMAP_PLANAR=!1,a.REFLECTIONMAP_CUBIC=!1,a.REFLECTIONMAP_PROJECTION=!1,a.REFLECTIONMAP_SKYBOX=!1,a.REFLECTIONMAP_EXPLICIT=!1,a.REFLECTIONMAP_EQUIRECTANGULAR=!1,a.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,a.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,a.INVERTCUBICMAP=!1,a.REFLECTIONMAP_OPPOSITEZ=!1,a.LODINREFLECTIONALPHA=!1,a.GAMMAREFLECTION=!1,a.RGBDREFLECTION=!1}a.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,a.USERGBCOLOR=this._useRGBColor,a.NOISE=this._enableNoise}if(a._areLightsDirty&&(a.USEHIGHLIGHTANDSHADOWCOLORS=!this._useRGBColor&&(0!==this._primaryColorShadowLevel||0!==this._primaryColorHighlightLevel),a.BACKMAT_SHADOWONLY=this._shadowOnly),a._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(a)}if(a._areMiscDirty&&(a.REFLECTIONMAP_3D&&this._enableGroundProjection?(a.PROJECTED_GROUND=!0,a.REFLECTIONMAP_SKYBOX=!0):a.PROJECTED_GROUND=!1),Ee(e,n,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),a),Pe(n,o,this,a,r,null,t.getRenderingMesh().hasThinInstances),Ie(e,a,!1,!0,!1)&&e&&(n.getEngine().getCaps().standardDerivatives||e.isVerticesDataPresent(S.R.NormalKind)||(e.createNormals(!0),T.V.Warn("BackgroundMaterial: Normals have been created for the mesh: "+e.name))),a.isDirty){a.markAsProcessed(),n.resetCachedMaterial();const r=new ni;a.FOG&&r.addFallback(0,"FOG"),a.POINTSIZE&&r.addFallback(1,"POINTSIZE"),a.MULTIVIEW&&r.addFallback(0,"MULTIVIEW"),Re(a,r,this._maxSimultaneousLights);const s=[S.R.PositionKind];a.NORMAL&&s.push(S.R.NormalKind),a.UV1&&s.push(S.R.UVKind),a.UV2&&s.push(S.R.UV2Kind),Ae(s,e,a,r),Ce(s,a);const l=["world","view","viewProjection","vEyePosition","vLightsType","vFogInfos","vFogColor","pointSize","mBones","vPrimaryColor","vPrimaryColorShadow","vReflectionInfos","reflectionMatrix","vReflectionMicrosurfaceInfos","fFovMultiplier","shadowLevel","alpha","vBackgroundCenter","vReflectionControl","vDiffuseInfos","diffuseMatrix","projectedGroundInfos","logarithmicDepthConstant"];oe(l);const h=["diffuseSampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh"],c=["Material","Scene"];ii.p&&(ii.p.PrepareUniforms(l,a),ii.p.PrepareSamplers(h,a)),Be({uniformsNames:l,uniformBuffersNames:c,samplers:h,defines:a,maxSimultaneousLights:this._maxSimultaneousLights});const u=a.toString(),d=n.getEngine().createEffect("background",{attributes:s,uniformsNames:l,uniformBuffersNames:c,samplers:h,defines:u,fallbacks:r,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights},shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([i.e(835),i.e(571)]).then(i.bind(i,3571)),Promise.all([i.e(72),i.e(1)]).then(i.bind(i,9001))]):await Promise.all([i.e(352).then(i.bind(i,3352)),Promise.all([i.e(680),i.e(299)]).then(i.bind(i,6680))]),this._shadersLoaded=!0}},o);t.setEffect(d,a,this._materialContext),this.buildUniformLayout()}return!(!t.effect||!t.effect.isReady())&&(a._renderId=n.getRenderId(),s._wasPreviouslyReady=!0,s._wasPreviouslyUsingInstances=r,this._checkScenePerformancePriority(),!0)}_computePrimaryColorFromPerceptualColor(){this.__perceptualColor&&(this._primaryColor.copyFrom(this.__perceptualColor),this._primaryColor.toLinearSpaceToRef(this._primaryColor,this.getScene().getEngine().useExactSrgbConversions),this._imageProcessingConfiguration&&this._primaryColor.scaleToRef(1/this._imageProcessingConfiguration.exposure,this._primaryColor),this._computePrimaryColors())}_computePrimaryColors(){0===this._primaryColorShadowLevel&&0===this._primaryColorHighlightLevel||(this._primaryColor.scaleToRef(this._primaryColorShadowLevel,this._primaryShadowColor),this._primaryColor.subtractToRef(this._primaryShadowColor,this._primaryShadowColor),this._white.subtractToRef(this._primaryColor,this._primaryHighlightColor),this._primaryHighlightColor.scaleToRef(this._primaryColorHighlightLevel,this._primaryHighlightColor),this._primaryColor.addToRef(this._primaryHighlightColor,this._primaryHighlightColor))}buildUniformLayout(){this._uniformBuffer.addUniform("vPrimaryColor",4),this._uniformBuffer.addUniform("vPrimaryColorShadow",4),this._uniformBuffer.addUniform("vDiffuseInfos",2),this._uniformBuffer.addUniform("vReflectionInfos",2),this._uniformBuffer.addUniform("diffuseMatrix",16),this._uniformBuffer.addUniform("reflectionMatrix",16),this._uniformBuffer.addUniform("vReflectionMicrosurfaceInfos",3),this._uniformBuffer.addUniform("fFovMultiplier",1),this._uniformBuffer.addUniform("pointSize",1),this._uniformBuffer.addUniform("shadowLevel",1),this._uniformBuffer.addUniform("alpha",1),this._uniformBuffer.addUniform("vBackgroundCenter",3),this._uniformBuffer.addUniform("vReflectionControl",4),this._uniformBuffer.addUniform("projectedGroundInfos",2),this._uniformBuffer.create()}unbind(){this._diffuseTexture&&this._diffuseTexture.isRenderTarget&&this._uniformBuffer.setTexture("diffuseSampler",null),this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._uniformBuffer.setTexture("reflectionSampler",null),super.unbind()}bindOnlyWorldMatrix(e){this._activeEffect.setMatrix("world",e)}bindForSubMesh(e,t,i){const r=this.getScene(),s=i.materialDefines;if(!s)return;const n=i.effect;if(!n)return;this._activeEffect=n,this.bindOnlyWorldMatrix(e),ye(t,this._activeEffect);const a=this._mustRebind(r,n,i,t.visibility);if(a){this._uniformBuffer.bindToEffect(n,"Material"),this.bindViewProjection(n);const e=this._reflectionTexture;this._uniformBuffer.useUbo&&this.isFrozen&&this._uniformBuffer.isSync&&!i._drawWrapper._forceRebindOnNextCall||(r.texturesEnabled&&(this._diffuseTexture&&si.DiffuseTextureEnabled&&(this._uniformBuffer.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),be(this._diffuseTexture,this._uniformBuffer,"diffuse")),e&&si.ReflectionTextureEnabled&&(this._uniformBuffer.updateMatrix("reflectionMatrix",e.getReflectionTextureMatrix()),this._uniformBuffer.updateFloat2("vReflectionInfos",e.level,this._reflectionBlur),this._uniformBuffer.updateFloat3("vReflectionMicrosurfaceInfos",e.getSize().width,e.lodGenerationScale,e.lodGenerationOffset))),this.shadowLevel>0&&this._uniformBuffer.updateFloat("shadowLevel",this.shadowLevel),this._uniformBuffer.updateFloat("alpha",this.alpha),this.pointsCloud&&this._uniformBuffer.updateFloat("pointSize",this.pointSize),s.USEHIGHLIGHTANDSHADOWCOLORS?(this._uniformBuffer.updateColor4("vPrimaryColor",this._primaryHighlightColor,1),this._uniformBuffer.updateColor4("vPrimaryColorShadow",this._primaryShadowColor,1)):this._uniformBuffer.updateColor4("vPrimaryColor",this._primaryColor,1)),this._uniformBuffer.updateFloat("fFovMultiplier",this._fovMultiplier),r.texturesEnabled&&(this._diffuseTexture&&si.DiffuseTextureEnabled&&this._uniformBuffer.setTexture("diffuseSampler",this._diffuseTexture),e&&si.ReflectionTextureEnabled&&(s.REFLECTIONBLUR&&s.TEXTURELODSUPPORT?this._uniformBuffer.setTexture("reflectionSampler",e):s.REFLECTIONBLUR?(this._uniformBuffer.setTexture("reflectionSampler",e._lodTextureMid||e),this._uniformBuffer.setTexture("reflectionSamplerLow",e._lodTextureLow||e),this._uniformBuffer.setTexture("reflectionSamplerHigh",e._lodTextureHigh||e)):this._uniformBuffer.setTexture("reflectionSampler",e),s.REFLECTIONFRESNEL&&(this._uniformBuffer.updateFloat3("vBackgroundCenter",this.sceneCenter.x,this.sceneCenter.y,this.sceneCenter.z),this._uniformBuffer.updateFloat4("vReflectionControl",this._reflectionControls.x,this._reflectionControls.y,this._reflectionControls.z,this._reflectionControls.w))),s.PROJECTED_GROUND&&this._uniformBuffer.updateFloat2("projectedGroundInfos",this.projectedGroundRadius,this.projectedGroundHeight)),le(this._activeEffect,this,r),r.bindEyePosition(n)}else r.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._uniformBuffer.bindToEffect(n,"Material"),this._needToBindSceneUbo=!0);!a&&this.isFrozen||(r.lightsEnabled&&xe(r,t,this._activeEffect,s,this._maxSimultaneousLights),this.bindView(n),de(r,t,this._activeEffect,!0),this._useLogarithmicDepth&&ue(s,n,r),this._imageProcessingConfiguration&&this._imageProcessingConfiguration.bind(this._activeEffect)),this._afterBind(t,this._activeEffect,i),this._uniformBuffer.update()}hasTexture(e){return!!super.hasTexture(e)||(this._reflectionTexture===e||this._diffuseTexture===e)}dispose(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&(this.diffuseTexture&&this.diffuseTexture.dispose(),this.reflectionTexture&&this.reflectionTexture.dispose()),this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(e)}clone(e){return c.p.Clone((()=>new Jr(e,this.getScene())),this)}serialize(){const e=super.serialize();return e.customType="BABYLON.BackgroundMaterial",e}getClassName(){return"BackgroundMaterial"}static Parse(e,t,i){return c.p.Parse((()=>new Jr(e.name,t)),e,t,i)}}Jr.StandardReflectance0=.05,Jr.StandardReflectance90=.5,(0,s.Cg)([(0,n.jT)()],Jr.prototype,"_primaryColor",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsLightsDirty")],Jr.prototype,"primaryColor",void 0),(0,s.Cg)([(0,n.jT)()],Jr.prototype,"__perceptualColor",void 0),(0,s.Cg)([(0,n.lK)()],Jr.prototype,"_primaryColorShadowLevel",void 0),(0,s.Cg)([(0,n.lK)()],Jr.prototype,"_primaryColorHighlightLevel",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsLightsDirty")],Jr.prototype,"primaryColorHighlightLevel",null),(0,s.Cg)([(0,n.uM)()],Jr.prototype,"_reflectionTexture",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Jr.prototype,"reflectionTexture",void 0),(0,s.Cg)([(0,n.lK)()],Jr.prototype,"_reflectionBlur",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Jr.prototype,"reflectionBlur",void 0),(0,s.Cg)([(0,n.uM)()],Jr.prototype,"_diffuseTexture",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Jr.prototype,"diffuseTexture",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Jr.prototype,"shadowLights",void 0),(0,s.Cg)([(0,n.lK)()],Jr.prototype,"_shadowLevel",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Jr.prototype,"shadowLevel",void 0),(0,s.Cg)([(0,n.P_)()],Jr.prototype,"_sceneCenter",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Jr.prototype,"sceneCenter",void 0),(0,s.Cg)([(0,n.lK)()],Jr.prototype,"_opacityFresnel",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Jr.prototype,"opacityFresnel",void 0),(0,s.Cg)([(0,n.lK)()],Jr.prototype,"_reflectionFresnel",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Jr.prototype,"reflectionFresnel",void 0),(0,s.Cg)([(0,n.lK)()],Jr.prototype,"_reflectionFalloffDistance",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Jr.prototype,"reflectionFalloffDistance",void 0),(0,s.Cg)([(0,n.lK)()],Jr.prototype,"_reflectionAmount",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Jr.prototype,"reflectionAmount",void 0),(0,s.Cg)([(0,n.lK)()],Jr.prototype,"_reflectionReflectance0",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Jr.prototype,"reflectionReflectance0",void 0),(0,s.Cg)([(0,n.lK)()],Jr.prototype,"_reflectionReflectance90",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Jr.prototype,"reflectionReflectance90",void 0),(0,s.Cg)([(0,n.lK)()],Jr.prototype,"_useRGBColor",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Jr.prototype,"useRGBColor",void 0),(0,s.Cg)([(0,n.lK)()],Jr.prototype,"_enableNoise",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Jr.prototype,"enableNoise",void 0),(0,s.Cg)([(0,n.lK)()],Jr.prototype,"_maxSimultaneousLights",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],Jr.prototype,"maxSimultaneousLights",void 0),(0,s.Cg)([(0,n.lK)()],Jr.prototype,"_shadowOnly",void 0),(0,s.Cg)([(0,n.$z)("_markAllSubMeshesAsLightsDirty")],Jr.prototype,"shadowOnly",void 0),(0,s.Cg)([(0,n.n1)()],Jr.prototype,"_imageProcessingConfiguration",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsMiscDirty")],Jr.prototype,"enableGroundProjection",void 0),(0,s.Cg)([(0,n.lK)()],Jr.prototype,"projectedGroundRadius",void 0),(0,s.Cg)([(0,n.lK)()],Jr.prototype,"projectedGroundHeight",void 0),(0,x.Y5)("BABYLON.BackgroundMaterial",Jr);class es{static _GetDefaultOptions(e){return{createGround:!0,groundSize:15,groundTexture:this._GroundTextureCDNUrl,groundColor:new E.v9(.2,.2,.3).toLinearSpace(e.getEngine().useExactSrgbConversions).scale(3),groundOpacity:.9,enableGroundShadow:!0,groundShadowLevel:.5,enableGroundMirror:!1,groundMirrorSizeRatio:.3,groundMirrorBlurKernel:64,groundMirrorAmount:1,groundMirrorFresnelWeight:1,groundMirrorFallOffDistance:0,groundMirrorTextureType:0,groundYBias:1e-5,createSkybox:!0,skyboxSize:20,skyboxTexture:this._SkyboxTextureCDNUrl,skyboxColor:new E.v9(.2,.2,.3).toLinearSpace(e.getEngine().useExactSrgbConversions).scale(3),backgroundYRotation:0,sizeAuto:!0,rootPosition:o.Pq.Zero(),setupImageProcessing:!0,environmentTexture:this._EnvironmentTextureCDNUrl,cameraExposure:.8,cameraContrast:1.2,toneMappingEnabled:!0}}get rootMesh(){return this._rootMesh}get skybox(){return this._skybox}get skyboxTexture(){return this._skyboxTexture}get skyboxMaterial(){return this._skyboxMaterial}get ground(){return this._ground}get groundTexture(){return this._groundTexture}get groundMirror(){return this._groundMirror}get groundMirrorRenderList(){return this._groundMirror?this._groundMirror.renderList:null}get groundMaterial(){return this._groundMaterial}constructor(e,t){this._errorHandler=(e,t)=>{this.onErrorObservable.notifyObservers({message:e,exception:t})},this._options={...es._GetDefaultOptions(t),...e},this._scene=t,this.onErrorObservable=new a.cP,this._setupBackground(),this._setupImageProcessing()}updateOptions(e){const t={...this._options,...e};this._ground&&!t.createGround&&(this._ground.dispose(),this._ground=null),this._groundMaterial&&!t.createGround&&(this._groundMaterial.dispose(),this._groundMaterial=null),this._groundTexture&&this._options.groundTexture!=t.groundTexture&&(this._groundTexture.dispose(),this._groundTexture=null),this._skybox&&!t.createSkybox&&(this._skybox.dispose(),this._skybox=null),this._skyboxMaterial&&!t.createSkybox&&(this._skyboxMaterial.dispose(),this._skyboxMaterial=null),this._skyboxTexture&&this._options.skyboxTexture!=t.skyboxTexture&&(this._skyboxTexture.dispose(),this._skyboxTexture=null),this._groundMirror&&!t.enableGroundMirror&&(this._groundMirror.dispose(),this._groundMirror=null),this._scene.environmentTexture&&this._options.environmentTexture!=t.environmentTexture&&this._scene.environmentTexture.dispose(),this._options=t,this._setupBackground(),this._setupImageProcessing()}setMainColor(e){this.groundMaterial&&(this.groundMaterial.primaryColor=e),this.skyboxMaterial&&(this.skyboxMaterial.primaryColor=e),this.groundMirror&&(this.groundMirror.clearColor=new E.ov(e.r,e.g,e.b,1))}_setupImageProcessing(){this._options.setupImageProcessing&&(this._scene.imageProcessingConfiguration.contrast=this._options.cameraContrast,this._scene.imageProcessingConfiguration.exposure=this._options.cameraExposure,this._scene.imageProcessingConfiguration.toneMappingEnabled=this._options.toneMappingEnabled,this._setupEnvironmentTexture())}_setupEnvironmentTexture(){if(this._scene.environmentTexture)return;if(this._options.environmentTexture instanceof Wr.t)return void(this._scene.environmentTexture=this._options.environmentTexture);const e=$r.CreateFromPrefilteredData(this._options.environmentTexture,this._scene);this._scene.environmentTexture=e}_setupBackground(){this._rootMesh||(this._rootMesh=new Xe("BackgroundHelper",this._scene)),this._rootMesh.rotation.y=this._options.backgroundYRotation;const e=this._getSceneSize();this._options.createGround&&(this._setupGround(e),this._setupGroundMaterial(),this._setupGroundDiffuseTexture(),this._options.enableGroundMirror&&this._setupGroundMirrorTexture(e),this._setupMirrorInGroundMaterial()),this._options.createSkybox&&(this._setupSkybox(e),this._setupSkyboxMaterial(),this._setupSkyboxReflectionTexture()),this._rootMesh.position.x=e.rootPosition.x,this._rootMesh.position.z=e.rootPosition.z,this._rootMesh.position.y=e.rootPosition.y}_getSceneSize(){let e=this._options.groundSize,t=this._options.skyboxSize,i=this._options.rootPosition;if(!this._scene.meshes||1===this._scene.meshes.length)return{groundSize:e,skyboxSize:t,rootPosition:i};const r=this._scene.getWorldExtends((e=>e!==this._ground&&e!==this._rootMesh&&e!==this._skybox)),s=r.max.subtract(r.min);if(this._options.sizeAuto){this._scene.activeCamera instanceof Rt&&this._scene.activeCamera.upperRadiusLimit&&(e=2*this._scene.activeCamera.upperRadiusLimit,t=e);const n=s.length();n>e&&(e=2*n,t=e),e*=1.1,t*=1.5,i=r.min.add(s.scale(.5)),i.y=r.min.y-this._options.groundYBias}return{groundSize:e,skyboxSize:t,rootPosition:i}}_setupGround(e){this._ground&&!this._ground.isDisposed()||(this._ground=fr("BackgroundPlane",{size:e.groundSize},this._scene),this._ground.rotation.x=Math.PI/2,this._ground.isPickable=!1,this._ground.parent=this._rootMesh,this._ground.onDisposeObservable.add((()=>{this._ground=null}))),this._ground.receiveShadows=this._options.enableGroundShadow}_setupGroundMaterial(){this._groundMaterial||(this._groundMaterial=new Jr("BackgroundPlaneMaterial",this._scene)),this._groundMaterial.alpha=this._options.groundOpacity,this._groundMaterial.alphaMode=8,this._groundMaterial.shadowLevel=this._options.groundShadowLevel,this._groundMaterial.primaryColor=this._options.groundColor,this._groundMaterial.useRGBColor=!1,this._groundMaterial.enableNoise=!0,this._ground&&(this._ground.material=this._groundMaterial)}_setupGroundDiffuseTexture(){this._groundMaterial&&(this._groundTexture||(this._options.groundTexture instanceof Wr.t?this._groundMaterial.diffuseTexture=this._options.groundTexture:(this._groundTexture=new kt.g(this._options.groundTexture,this._scene,void 0,void 0,void 0,void 0,this._errorHandler),this._groundTexture.gammaSpace=!1,this._groundTexture.hasAlpha=!0,this._groundMaterial.diffuseTexture=this._groundTexture)))}_setupGroundMirrorTexture(e){const t=kt.g.CLAMP_ADDRESSMODE;if(!this._groundMirror&&(this._groundMirror=new Yr("BackgroundPlaneMirrorTexture",{ratio:this._options.groundMirrorSizeRatio},this._scene,!1,this._options.groundMirrorTextureType,kt.g.BILINEAR_SAMPLINGMODE,!0),this._groundMirror.mirrorPlane=new se.Z(0,-1,0,e.rootPosition.y),this._groundMirror.anisotropicFilteringLevel=1,this._groundMirror.wrapU=t,this._groundMirror.wrapV=t,this._groundMirror.renderList))for(let r=0;r<this._scene.meshes.length;r++){const e=this._scene.meshes[r];e!==this._ground&&e!==this._skybox&&e!==this._rootMesh&&this._groundMirror.renderList.push(e)}const i=this._options.groundColor.toGammaSpace(this._scene.getEngine().useExactSrgbConversions);this._groundMirror.clearColor=new E.ov(i.r,i.g,i.b,1),this._groundMirror.adaptiveBlurKernel=this._options.groundMirrorBlurKernel}_setupMirrorInGroundMaterial(){this._groundMaterial&&(this._groundMaterial.reflectionTexture=this._groundMirror,this._groundMaterial.reflectionFresnel=!0,this._groundMaterial.reflectionAmount=this._options.groundMirrorAmount,this._groundMaterial.reflectionStandardFresnelWeight=this._options.groundMirrorFresnelWeight,this._groundMaterial.reflectionFalloffDistance=this._options.groundMirrorFallOffDistance)}_setupSkybox(e){this._skybox&&!this._skybox.isDisposed()||(this._skybox=Li("BackgroundSkybox",{size:e.skyboxSize,sideOrientation:Xe.BACKSIDE},this._scene),this._skybox.isPickable=!1,this._skybox.onDisposeObservable.add((()=>{this._skybox=null}))),this._skybox.parent=this._rootMesh}_setupSkyboxMaterial(){this._skybox&&(this._skyboxMaterial||(this._skyboxMaterial=new Jr("BackgroundSkyboxMaterial",this._scene)),this._skyboxMaterial.useRGBColor=!1,this._skyboxMaterial.primaryColor=this._options.skyboxColor,this._skyboxMaterial.enableNoise=!0,this._skybox.material=this._skyboxMaterial)}_setupSkyboxReflectionTexture(){this._skyboxMaterial&&(this._skyboxTexture||(this._options.skyboxTexture instanceof Wr.t?this._skyboxMaterial.reflectionTexture=this._options.skyboxTexture:(this._skyboxTexture=new $r(this._options.skyboxTexture,this._scene,void 0,void 0,void 0,void 0,this._errorHandler),this._skyboxTexture.coordinatesMode=kt.g.SKYBOX_MODE,this._skyboxTexture.gammaSpace=!1,this._skyboxMaterial.reflectionTexture=this._skyboxTexture)))}dispose(){this._groundMaterial&&this._groundMaterial.dispose(!0,!0),this._skyboxMaterial&&this._skyboxMaterial.dispose(!0,!0),this._rootMesh.dispose(!1)}}es._GroundTextureCDNUrl="https://assets.babylonjs.com/environments/backgroundGround.png",es._SkyboxTextureCDNUrl="https://assets.babylonjs.com/environments/backgroundSkybox.dds",es._EnvironmentTextureCDNUrl="https://assets.babylonjs.com/environments/environmentSpecular.env";class ts{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(e){e=_.S0.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((t=>{const i=t.event;if(!i.metaKey)if(t.type===yt.TB.KEYDOWN){if(-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)||-1!==this.keysUpward.indexOf(i.keyCode)||-1!==this.keysDownward.indexOf(i.keyCode)||-1!==this.keysRotateLeft.indexOf(i.keyCode)||-1!==this.keysRotateRight.indexOf(i.keyCode)||-1!==this.keysRotateUp.indexOf(i.keyCode)||-1!==this.keysRotateDown.indexOf(i.keyCode)){-1===this._keys.indexOf(i.keyCode)&&this._keys.push(i.keyCode),e||i.preventDefault()}}else if(-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)||-1!==this.keysUpward.indexOf(i.keyCode)||-1!==this.keysDownward.indexOf(i.keyCode)||-1!==this.keysRotateLeft.indexOf(i.keyCode)||-1!==this.keysRotateRight.indexOf(i.keyCode)||-1!==this.keysRotateUp.indexOf(i.keyCode)||-1!==this.keysRotateDown.indexOf(i.keyCode)){const t=this._keys.indexOf(i.keyCode);t>=0&&this._keys.splice(t,1),e||i.preventDefault()}})))}detachControl(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const e=this.camera;for(let t=0;t<this._keys.length;t++){const i=this._keys[t],r=e._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(i)?e._localDirection.copyFromFloats(-r,0,0):-1!==this.keysUp.indexOf(i)?e._localDirection.copyFromFloats(0,0,r):-1!==this.keysRight.indexOf(i)?e._localDirection.copyFromFloats(r,0,0):-1!==this.keysDown.indexOf(i)?e._localDirection.copyFromFloats(0,0,-r):-1!==this.keysUpward.indexOf(i)?e._localDirection.copyFromFloats(0,r,0):-1!==this.keysDownward.indexOf(i)?e._localDirection.copyFromFloats(0,-r,0):-1!==this.keysRotateLeft.indexOf(i)?(e._localDirection.copyFromFloats(0,0,0),e.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(i)?(e._localDirection.copyFromFloats(0,0,0),e.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(i)?(e._localDirection.copyFromFloats(0,0,0),e.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(i)&&(e._localDirection.copyFromFloats(0,0,0),e.cameraRotation.x+=this._getLocalRotation()),e.getScene().useRightHandedSystem&&(e._localDirection.z*=-1),e.getViewMatrix().invertToRef(e._cameraTransformMatrix),o.Pq.TransformNormalToRef(e._localDirection,e._cameraTransformMatrix,e._transformedDirection),e.cameraDirection.addInPlace(e._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const e=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*e}}(0,s.Cg)([(0,n.lK)()],ts.prototype,"keysUp",void 0),(0,s.Cg)([(0,n.lK)()],ts.prototype,"keysUpward",void 0),(0,s.Cg)([(0,n.lK)()],ts.prototype,"keysDown",void 0),(0,s.Cg)([(0,n.lK)()],ts.prototype,"keysDownward",void 0),(0,s.Cg)([(0,n.lK)()],ts.prototype,"keysLeft",void 0),(0,s.Cg)([(0,n.lK)()],ts.prototype,"keysRight",void 0),(0,s.Cg)([(0,n.lK)()],ts.prototype,"rotationSpeed",void 0),(0,s.Cg)([(0,n.lK)()],ts.prototype,"keysRotateLeft",void 0),(0,s.Cg)([(0,n.lK)()],ts.prototype,"keysRotateRight",void 0),(0,s.Cg)([(0,n.lK)()],ts.prototype,"keysRotateUp",void 0),(0,s.Cg)([(0,n.lK)()],ts.prototype,"keysRotateDown",void 0),gt.FreeCameraKeyboardMoveInput=ts;class is{constructor(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=e,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new a.cP,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(e){e=_.S0.BackCompatCameraNoPreventDefault(arguments);const t=this.camera.getEngine(),i=t.getInputElement();this._pointerInput||(this._pointerInput=r=>{const s=r.event,n="touch"===s.pointerType;if(!this.touchEnabled&&n)return;if(r.type!==Ke.Zp.POINTERMOVE&&-1===this.buttons.indexOf(s.button))return;const a=s.target;if(r.type===Ke.Zp.POINTERDOWN){if(n&&-1!==this._activePointerId||!n&&-1!==this._currentActiveButton)return;this._activePointerId=s.pointerId;try{a?.setPointerCapture(s.pointerId)}catch(Qp){}-1===this._currentActiveButton&&(this._currentActiveButton=s.button),this._previousPosition={x:s.clientX,y:s.clientY},e||(s.preventDefault(),i&&i.focus()),t.isPointerLock&&this._onMouseMove&&this._onMouseMove(r.event)}else if(r.type===Ke.Zp.POINTERUP){if(n&&this._activePointerId!==s.pointerId||!n&&this._currentActiveButton!==s.button)return;try{a?.releasePointerCapture(s.pointerId)}catch(Qp){}this._currentActiveButton=-1,this._previousPosition=null,e||s.preventDefault(),this._activePointerId=-1}else if(r.type===Ke.Zp.POINTERMOVE&&(this._activePointerId===s.pointerId||!n))if(t.isPointerLock&&this._onMouseMove)this._onMouseMove(r.event);else if(this._previousPosition){const t=this.camera._calculateHandednessMultiplier(),i=(s.clientX-this._previousPosition.x)*t,r=s.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=i/this.angularSensibility,this.camera.cameraRotation.x+=r/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:i,offsetY:r}),this._previousPosition={x:s.clientX,y:s.clientY},e||s.preventDefault()}}),this._onMouseMove=i=>{if(!t.isPointerLock)return;const r=this.camera._calculateHandednessMultiplier(),s=i.movementX*r;this.camera.cameraRotation.y+=s/this.angularSensibility;const n=i.movementY;this.camera.cameraRotation.x+=n/this.angularSensibility,this._previousPosition=null,e||i.preventDefault()},this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._pointerInput,Ke.Zp.POINTERDOWN|Ke.Zp.POINTERUP|Ke.Zp.POINTERMOVE),i&&(this._contextMenuBind=e=>this.onContextMenu(e),i.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(e){e.preventDefault()}detachControl(){if(this._observer){if(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const e=this.camera.getEngine().getInputElement();e&&e.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,s.Cg)([(0,n.lK)()],is.prototype,"buttons",void 0),(0,s.Cg)([(0,n.lK)()],is.prototype,"angularSensibility",void 0),gt.FreeCameraMouseInput=is;class rs{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new a.cP,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(e){e=_.S0.BackCompatCameraNoPreventDefault(arguments),this._wheel=t=>{if(t.type!==Ke.Zp.POINTERWHEEL)return;const i=t.event,r=i.deltaMode===xt.s.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*r*i.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*r*i.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*r*i.deltaZ/this._normalize,i.preventDefault&&(e||i.preventDefault())},this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._wheel,Ke.Zp.POINTERWHEEL)}detachControl(){this._observer&&(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}var ss;(0,s.Cg)([(0,n.lK)()],rs.prototype,"wheelPrecisionX",void 0),(0,s.Cg)([(0,n.lK)()],rs.prototype,"wheelPrecisionY",void 0),(0,s.Cg)([(0,n.lK)()],rs.prototype,"wheelPrecisionZ",void 0),function(e){e[e.MoveRelative=0]="MoveRelative",e[e.RotateRelative=1]="RotateRelative",e[e.MoveScene=2]="MoveScene"}(ss||(ss={}));class ns extends rs{constructor(){super(...arguments),this._moveRelative=o.Pq.Zero(),this._rotateRelative=o.Pq.Zero(),this._moveScene=o.Pq.Zero(),this._wheelXAction=ss.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=ss.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(e){null===e&&this._wheelXAction!==ss.MoveRelative||(this._wheelXAction=ss.MoveRelative,this._wheelXActionCoordinate=e)}get wheelXMoveRelative(){return this._wheelXAction!==ss.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(e){null===e&&this._wheelYAction!==ss.MoveRelative||(this._wheelYAction=ss.MoveRelative,this._wheelYActionCoordinate=e)}get wheelYMoveRelative(){return this._wheelYAction!==ss.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(e){null===e&&this._wheelZAction!==ss.MoveRelative||(this._wheelZAction=ss.MoveRelative,this._wheelZActionCoordinate=e)}get wheelZMoveRelative(){return this._wheelZAction!==ss.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(e){null===e&&this._wheelXAction!==ss.RotateRelative||(this._wheelXAction=ss.RotateRelative,this._wheelXActionCoordinate=e)}get wheelXRotateRelative(){return this._wheelXAction!==ss.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(e){null===e&&this._wheelYAction!==ss.RotateRelative||(this._wheelYAction=ss.RotateRelative,this._wheelYActionCoordinate=e)}get wheelYRotateRelative(){return this._wheelYAction!==ss.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(e){null===e&&this._wheelZAction!==ss.RotateRelative||(this._wheelZAction=ss.RotateRelative,this._wheelZActionCoordinate=e)}get wheelZRotateRelative(){return this._wheelZAction!==ss.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(e){null===e&&this._wheelXAction!==ss.MoveScene||(this._wheelXAction=ss.MoveScene,this._wheelXActionCoordinate=e)}get wheelXMoveScene(){return this._wheelXAction!==ss.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(e){null===e&&this._wheelYAction!==ss.MoveScene||(this._wheelYAction=ss.MoveScene,this._wheelYActionCoordinate=e)}get wheelYMoveScene(){return this._wheelYAction!==ss.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(e){null===e&&this._wheelZAction!==ss.MoveScene||(this._wheelZAction=ss.MoveScene,this._wheelZActionCoordinate=e)}get wheelZMoveScene(){return this._wheelZAction!==ss.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.setAll(0),this._rotateRelative.setAll(0),this._moveScene.setAll(0),this._updateCamera(),this.camera.getScene().useRightHandedSystem&&(this._moveRelative.z*=-1);const e=o.uq.Zero();this.camera.getViewMatrix().invertToRef(e);const t=o.Pq.Zero();o.Pq.TransformNormalToRef(this._moveRelative,e,t),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(t),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(e,t,i){if(0===e)return;if(null===t||null===i)return;let r=null;switch(t){case ss.MoveRelative:r=this._moveRelative;break;case ss.RotateRelative:r=this._rotateRelative;break;case ss.MoveScene:r=this._moveScene}switch(i){case 0:r.set(e,0,0);break;case 1:r.set(0,e,0);break;case 2:r.set(0,0,e)}}}(0,s.Cg)([(0,n.lK)()],ns.prototype,"wheelXMoveRelative",null),(0,s.Cg)([(0,n.lK)()],ns.prototype,"wheelYMoveRelative",null),(0,s.Cg)([(0,n.lK)()],ns.prototype,"wheelZMoveRelative",null),(0,s.Cg)([(0,n.lK)()],ns.prototype,"wheelXRotateRelative",null),(0,s.Cg)([(0,n.lK)()],ns.prototype,"wheelYRotateRelative",null),(0,s.Cg)([(0,n.lK)()],ns.prototype,"wheelZRotateRelative",null),(0,s.Cg)([(0,n.lK)()],ns.prototype,"wheelXMoveScene",null),(0,s.Cg)([(0,n.lK)()],ns.prototype,"wheelYMoveScene",null),(0,s.Cg)([(0,n.lK)()],ns.prototype,"wheelZMoveScene",null),gt.FreeCameraMouseWheelInput=ns;class as{constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=e,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=_.S0.IsSafari()}attachControl(e){e=_.S0.BackCompatCameraNoPreventDefault(arguments);let t=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=i=>{const r=i.event,s="mouse"===r.pointerType||this._isSafari&&"undefined"===typeof r.pointerType;if(this.allowMouse||!s)if(i.type===Ke.Zp.POINTERDOWN){if(e||r.preventDefault(),this._pointerPressed.push(r.pointerId),1!==this._pointerPressed.length)return;t={x:r.clientX,y:r.clientY}}else if(i.type===Ke.Zp.POINTERUP){e||r.preventDefault();const i=this._pointerPressed.indexOf(r.pointerId);if(-1===i)return;if(this._pointerPressed.splice(i,1),0!=i)return;t=null,this._offsetX=null,this._offsetY=null}else if(i.type===Ke.Zp.POINTERMOVE){if(e||r.preventDefault(),!t)return;if(0!=this._pointerPressed.indexOf(r.pointerId))return;this._offsetX=r.clientX-t.x,this._offsetY=-(r.clientY-t.y)}}),this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._pointerInput,Ke.Zp.POINTERDOWN|Ke.Zp.POINTERUP|Ke.Zp.POINTERMOVE),this._onLostFocus){const e=this.camera.getEngine().getInputElement();e&&e.addEventListener("blur",this._onLostFocus)}}detachControl(){if(this._pointerInput){if(this._observer&&(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const e=this.camera.getEngine().getInputElement();e&&e.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const e=this.camera,t=e._calculateHandednessMultiplier();e.cameraRotation.y=t*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)e.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const t=e._computeLocalCameraSpeed(),i=new o.Pq(0,0,0!==this.touchMoveSensibility?t*this._offsetY/this.touchMoveSensibility:0);o.uq.RotationYawPitchRollToRef(e.rotation.y,e.rotation.x,0,e._cameraRotationMatrix),e.cameraDirection.addInPlace(o.Pq.TransformCoordinates(i,e._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,s.Cg)([(0,n.lK)()],as.prototype,"touchAngularSensibility",void 0),(0,s.Cg)([(0,n.lK)()],as.prototype,"touchMoveSensibility",void 0),gt.FreeCameraTouchInput=as;class os extends mt{constructor(e){super(e),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new ts),this}addMouse(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new is(e),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new ns,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new as),this}clear(){super.clear(),this._mouseInput=null}}class ls extends ft{get angularSensibility(){const e=this.inputs.attached.mouse;return e?e.angularSensibility:0}set angularSensibility(e){const t=this.inputs.attached.mouse;t&&(t.angularSensibility=e)}get keysUp(){const e=this.inputs.attached.keyboard;return e?e.keysUp:[]}set keysUp(e){const t=this.inputs.attached.keyboard;t&&(t.keysUp=e)}get keysUpward(){const e=this.inputs.attached.keyboard;return e?e.keysUpward:[]}set keysUpward(e){const t=this.inputs.attached.keyboard;t&&(t.keysUpward=e)}get keysDown(){const e=this.inputs.attached.keyboard;return e?e.keysDown:[]}set keysDown(e){const t=this.inputs.attached.keyboard;t&&(t.keysDown=e)}get keysDownward(){const e=this.inputs.attached.keyboard;return e?e.keysDownward:[]}set keysDownward(e){const t=this.inputs.attached.keyboard;t&&(t.keysDownward=e)}get keysLeft(){const e=this.inputs.attached.keyboard;return e?e.keysLeft:[]}set keysLeft(e){const t=this.inputs.attached.keyboard;t&&(t.keysLeft=e)}get keysRight(){const e=this.inputs.attached.keyboard;return e?e.keysRight:[]}set keysRight(e){const t=this.inputs.attached.keyboard;t&&(t.keysRight=e)}get keysRotateLeft(){const e=this.inputs.attached.keyboard;return e?e.keysRotateLeft:[]}set keysRotateLeft(e){const t=this.inputs.attached.keyboard;t&&(t.keysRotateLeft=e)}get keysRotateRight(){const e=this.inputs.attached.keyboard;return e?e.keysRotateRight:[]}set keysRotateRight(e){const t=this.inputs.attached.keyboard;t&&(t.keysRotateRight=e)}get keysRotateUp(){const e=this.inputs.attached.keyboard;return e?e.keysRotateUp:[]}set keysRotateUp(e){const t=this.inputs.attached.keyboard;t&&(t.keysRotateUp=e)}get keysRotateDown(){const e=this.inputs.attached.keyboard;return e?e.keysRotateDown:[]}set keysRotateDown(e){const t=this.inputs.attached.keyboard;t&&(t.keysRotateDown=e)}constructor(e,t,i){var r;super(e,t,i,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),r=this,this.ellipsoid=new o.Pq(.5,1,.5),this.ellipsoidOffset=new o.Pq(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=o.Pq.Zero(),this._diffPosition=o.Pq.Zero(),this._newPosition=o.Pq.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;r._newPosition.copyFrom(t),r._newPosition.subtractToRef(r._oldPosition,r._diffPosition),r._diffPosition.length()>ee.$.CollisionsEpsilon&&(r.position.addToRef(r._diffPosition,r._deferredPositionUpdate),r._deferOnly?r._deferredUpdated=!0:r.position.copyFrom(r._deferredPositionUpdate),r.onCollide&&i&&r.onCollide(i))},this.inputs=new os(this),this.inputs.addKeyboard().addMouse()}attachControl(e,t){t=_.S0.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(t)}detachControl(){this.inputs.detachElement(),this.cameraDirection=new o.Pq(0,0,0),this.cameraRotation=new o.I9(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(e){this._collisionMask=isNaN(e)?-1:e}_collideWithWorld(e){let t;t=this.parent?o.Pq.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,t.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const i=this.getScene().collisionCoordinator;this._collider||(this._collider=i.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let r=e;this.applyGravity&&(r=e.add(this.getScene().gravity)),i.getNewPosition(this._oldPosition,r,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=o.Pq.Zero(),this._transformedDirection=o.Pq.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(e){this._needMoveForGravity=e}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"FreeCamera"}}(0,s.Cg)([(0,n.P_)()],ls.prototype,"ellipsoid",void 0),(0,s.Cg)([(0,n.P_)()],ls.prototype,"ellipsoidOffset",void 0),(0,s.Cg)([(0,n.lK)()],ls.prototype,"checkCollisions",void 0),(0,s.Cg)([(0,n.lK)()],ls.prototype,"applyGravity",void 0),(0,x.Y5)("BABYLON.FreeCamera",ls),os.prototype.addDeviceOrientation=function(e){return this._deviceOrientationInput||(this._deviceOrientationInput=new hs,e&&(this._deviceOrientationInput.smoothFactor=e),this.add(this._deviceOrientationInput)),this};class hs{static WaitForOrientationChangeAsync(e){return new Promise(((t,i)=>{let r=!1;const s=()=>{window.removeEventListener("deviceorientation",s),r=!0,t()};e&&setTimeout((()=>{r||(window.removeEventListener("deviceorientation",s),i("WaitForOrientationChangeAsync timed out"))}),e),"undefined"!==typeof DeviceOrientationEvent&&"function"===typeof DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((e=>{"granted"==e?window.addEventListener("deviceorientation",s):_.S0.Warn("Permission not granted.")})).catch((e=>{_.S0.Error(e)})):window.addEventListener("deviceorientation",s)}))}constructor(){this._screenOrientationAngle=0,this._screenQuaternion=new o.PT,this._alpha=0,this._beta=0,this._gamma=0,this.smoothFactor=0,this._onDeviceOrientationChangedObservable=new a.cP,this._orientationChanged=()=>{this._screenOrientationAngle=void 0!==window.orientation?+window.orientation:window.screen.orientation&&window.screen.orientation.angle?window.screen.orientation.angle:0,this._screenOrientationAngle=-_.S0.ToRadians(this._screenOrientationAngle/2),this._screenQuaternion.copyFromFloats(0,Math.sin(this._screenOrientationAngle),0,Math.cos(this._screenOrientationAngle))},this._deviceOrientation=e=>{this.smoothFactor?(this._alpha=null!==e.alpha?_.S0.SmoothAngleChange(this._alpha,e.alpha,this.smoothFactor):0,this._beta=null!==e.beta?_.S0.SmoothAngleChange(this._beta,e.beta,this.smoothFactor):0,this._gamma=null!==e.gamma?_.S0.SmoothAngleChange(this._gamma,e.gamma,this.smoothFactor):0):(this._alpha=null!==e.alpha?e.alpha:0,this._beta=null!==e.beta?e.beta:0,this._gamma=null!==e.gamma?e.gamma:0),null!==e.alpha&&this._onDeviceOrientationChangedObservable.notifyObservers()},this._constantTransform=new o.PT(-Math.sqrt(.5),0,0,Math.sqrt(.5)),this._orientationChanged()}get camera(){return this._camera}set camera(e){this._camera=e,null==this._camera||this._camera.rotationQuaternion||(this._camera.rotationQuaternion=new o.PT),this._camera&&this._camera.onDisposeObservable.add((()=>{this._onDeviceOrientationChangedObservable.clear()}))}attachControl(){const e=this.camera.getScene().getEngine().getHostWindow();if(e){const t=()=>{e.addEventListener("orientationchange",this._orientationChanged),e.addEventListener("deviceorientation",this._deviceOrientation),this._orientationChanged()};"undefined"!==typeof DeviceOrientationEvent&&"function"===typeof DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((e=>{"granted"===e?t():_.S0.Warn("Permission not granted.")})).catch((e=>{_.S0.Error(e)})):t()}}detachControl(){window.removeEventListener("orientationchange",this._orientationChanged),window.removeEventListener("deviceorientation",this._deviceOrientation),this._alpha=0}checkInputs(){this._alpha&&(o.PT.RotationYawPitchRollToRef(_.S0.ToRadians(this._alpha),_.S0.ToRadians(this._beta),-_.S0.ToRadians(this._gamma),this.camera.rotationQuaternion),this._camera.rotationQuaternion.multiplyInPlace(this._screenQuaternion),this._camera.rotationQuaternion.multiplyInPlace(this._constantTransform),this._camera.getScene().useRightHandedSystem?this._camera.rotationQuaternion.y*=-1:this._camera.rotationQuaternion.z*=-1,this._camera.rotationQuaternion.w*=-1)}getClassName(){return"FreeCameraDeviceOrientationInput"}getSimpleName(){return"deviceOrientation"}}gt.FreeCameraDeviceOrientationInput=hs,d.AddNodeConstructor("DeviceOrientationCamera",((e,t)=>()=>new cs(e,o.Pq.Zero(),t)));class cs extends ls{constructor(e,t,i){super(e,t,i),this._tmpDragQuaternion=new o.PT,this._disablePointerInputWhenUsingDeviceOrientation=!0,this._dragFactor=0,this._quaternionCache=new o.PT,this.inputs.addDeviceOrientation(),this.inputs._deviceOrientationInput&&this.inputs._deviceOrientationInput._onDeviceOrientationChangedObservable.addOnce((()=>{this._disablePointerInputWhenUsingDeviceOrientation&&this.inputs._mouseInput&&(this.inputs._mouseInput._allowCameraRotation=!1,this.inputs._mouseInput.onPointerMovedObservable.add((e=>{0!=this._dragFactor&&(this._initialQuaternion||(this._initialQuaternion=new o.PT),o.PT.FromEulerAnglesToRef(0,e.offsetX*this._dragFactor,0,this._tmpDragQuaternion),this._initialQuaternion.multiplyToRef(this._tmpDragQuaternion,this._initialQuaternion))})))}))}get disablePointerInputWhenUsingDeviceOrientation(){return this._disablePointerInputWhenUsingDeviceOrientation}set disablePointerInputWhenUsingDeviceOrientation(e){this._disablePointerInputWhenUsingDeviceOrientation=e}enableHorizontalDragging(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/300;this._dragFactor=e}getClassName(){return"DeviceOrientationCamera"}_checkInputs(){super._checkInputs(),this._quaternionCache.copyFrom(this.rotationQuaternion),this._initialQuaternion&&this._initialQuaternion.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}resetToCurrentRotation(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:J._0.Y;this.rotationQuaternion&&(this._initialQuaternion||(this._initialQuaternion=new o.PT),this._initialQuaternion.copyFrom(this._quaternionCache||this.rotationQuaternion),["x","y","z"].forEach((t=>{e[t]?this._initialQuaternion[t]*=-1:this._initialQuaternion[t]=0})),this._initialQuaternion.normalize(),this._initialQuaternion.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion))}}class us{constructor(){this.compensateDistortion=!0,this.multiviewEnabled=!1}get aspectRatio(){return this.hResolution/(2*this.vResolution)}get aspectRatioFov(){return 2*Math.atan(this.postProcessScaleFactor*this.vScreenSize/(2*this.eyeToScreenDistance))}get leftHMatrix(){const e=4*(this.hScreenSize/4-this.lensSeparationDistance/2)/this.hScreenSize;return o.uq.Translation(e,0,0)}get rightHMatrix(){const e=4*(this.hScreenSize/4-this.lensSeparationDistance/2)/this.hScreenSize;return o.uq.Translation(-e,0,0)}get leftPreViewMatrix(){return o.uq.Translation(.5*this.interpupillaryDistance,0,0)}get rightPreViewMatrix(){return o.uq.Translation(-.5*this.interpupillaryDistance,0,0)}static GetDefault(){const e=new us;return e.hResolution=1280,e.vResolution=800,e.hScreenSize=.149759993,e.vScreenSize=.0935999975,e.vScreenCenter=.0467999987,e.eyeToScreenDistance=.0410000011,e.lensSeparationDistance=.063500002,e.interpupillaryDistance=.064000003,e.distortionK=[1,.219999999,.239999995,0],e.chromaAbCorrection=[.995999992,-.00400000019,1.01400006,0],e.postProcessScaleFactor=1.714605507808412,e.lensCenterOffset=.151976421,e}}class ds extends Xr.w{getClassName(){return"VRDistortionCorrectionPostProcess"}constructor(e,t,i,r){super(e,"vrDistortionCorrection",["LensCenter","Scale","ScaleIn","HmdWarpParam"],null,r.postProcessScaleFactor,t,kt.g.BILINEAR_SAMPLINGMODE),this._isRightEye=i,this._distortionFactors=r.distortionK,this._postProcessScaleFactor=r.postProcessScaleFactor,this._lensCenterOffset=r.lensCenterOffset,this.adaptScaleToCurrentViewport=!0,this.onSizeChangedObservable.add((()=>{this._scaleIn=new o.I9(2,2/this.aspectRatio),this._scaleFactor=new o.I9(1/this._postProcessScaleFactor*.5,1/this._postProcessScaleFactor*.5*this.aspectRatio),this._lensCenter=new o.I9(this._isRightEye?.5-.5*this._lensCenterOffset:.5+.5*this._lensCenterOffset,.5)})),this.onApplyObservable.add((e=>{e.setFloat2("LensCenter",this._lensCenter.x,this._lensCenter.y),e.setFloat2("Scale",this._scaleFactor.x,this._scaleFactor.y),e.setFloat2("ScaleIn",this._scaleIn.x,this._scaleIn.y),e.setFloat4("HmdWarpParam",this._distortionFactors[0],this._distortionFactors[1],this._distortionFactors[2],this._distortionFactors[3])}))}_gatherImports(e,t){e?(this._webGPUReady=!0,t.push(i.e(160).then(i.bind(i,4160)))):t.push(i.e(993).then(i.bind(i,2993))),super._gatherImports(e,t)}}const _s="vrMultiviewToSingleviewPixelShader",ps="precision mediump sampler2DArray;varying vec2 vUV;uniform sampler2DArray multiviewSampler;uniform int imageIndex;\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void)\n{gl_FragColor=texture2D(multiviewSampler,vec3(vUV,imageIndex));}";qt.l.ShadersStore[_s]=ps;class fs extends qr.${set samples(e){this._samples=e}get samples(){return this._samples}constructor(e){super("multiview rtt",arguments.length>1&&void 0!==arguments[1]?arguments[1]:512,e,!1,!0,0,!1,void 0,!1,!1,!0,void 0,!0),this._renderTarget=this.getScene().getEngine().createMultiviewRenderTargetTexture(this.getRenderWidth(),this.getRenderHeight()),this._texture=this._renderTarget.texture,this._texture.isMultiview=!0,this._texture.format=5,this.samples=this._getEngine().getCaps().maxSamples||this.samples,this._texture.samples=this._samples}_bindFrameBuffer(){this._renderTarget&&this.getScene().getEngine().bindMultiviewFramebuffer(this._renderTarget)}getViewCount(){return 2}}function gs(e,t){const i=new $.D(e,void 0,!0,t);return i.addUniform("viewProjection",16),i.addUniform("viewProjectionR",16),i.addUniform("view",16),i.addUniform("projection",16),i.addUniform("vEyePosition",4),i}Bt.prototype.createMultiviewRenderTargetTexture=function(e,t,i,r){const s=this._gl;if(!this.getCaps().multiview)throw"Multiview is not supported";const n=this._createHardwareRenderTargetWrapper(!1,!1,{width:e,height:t});n._framebuffer=s.createFramebuffer();const a=new Et.h(this,0,!0);return a.width=e,a.height=t,a.isMultiview=!0,i||(i=s.createTexture(),s.bindTexture(s.TEXTURE_2D_ARRAY,i),s.texStorage3D(s.TEXTURE_2D_ARRAY,1,s.RGBA8,e,t,2)),n._colorTextureArray=i,r||(r=s.createTexture(),s.bindTexture(s.TEXTURE_2D_ARRAY,r),s.texStorage3D(s.TEXTURE_2D_ARRAY,1,s.DEPTH24_STENCIL8,e,t,2)),n._depthStencilTextureArray=r,a.isReady=!0,n.setTextures(a),n._depthStencilTexture=a,n},Bt.prototype.bindMultiviewFramebuffer=function(e){const t=e,i=this._gl,r=this.getCaps().oculusMultiview||this.getCaps().multiview;if(this.bindFramebuffer(t,void 0,void 0,void 0,!0),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,t._framebuffer),!t._colorTextureArray||!t._depthStencilTextureArray)throw"Invalid multiview frame buffer";this.getCaps().oculusMultiview?(r.framebufferTextureMultisampleMultiviewOVR(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0,t._colorTextureArray,0,t.samples,0,2),r.framebufferTextureMultisampleMultiviewOVR(i.DRAW_FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,t._depthStencilTextureArray,0,t.samples,0,2)):(r.framebufferTextureMultiviewOVR(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0,t._colorTextureArray,0,0,2),r.framebufferTextureMultiviewOVR(i.DRAW_FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,t._depthStencilTextureArray,0,0,2))},Bt.prototype.bindSpaceWarpFramebuffer=function(e){const t=e,i=this._gl,r=this.getCaps().oculusMultiview||this.getCaps().multiview;if(this.bindFramebuffer(t,void 0,void 0,void 0,!0),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,t._framebuffer),!t._colorTextureArray||!t._depthStencilTextureArray)throw new Error("Invalid Space Warp framebuffer");r.framebufferTextureMultiviewOVR(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0,t._colorTextureArray,0,0,2),r.framebufferTextureMultiviewOVR(i.DRAW_FRAMEBUFFER,i.DEPTH_ATTACHMENT,t._depthStencilTextureArray,0,0,2)},R.prototype._useMultiviewToSingleView=!1,R.prototype._multiviewTexture=null,R.prototype._resizeOrCreateMultiviewTexture=function(e,t){this._multiviewTexture?this._multiviewTexture.getRenderWidth()==e&&this._multiviewTexture.getRenderHeight()==t||(this._multiviewTexture.dispose(),this._multiviewTexture=new fs(this.getScene(),{width:e,height:t})):this._multiviewTexture=new fs(this.getScene(),{width:e,height:t})};const ms=Gt.Z.prototype.createSceneUniformBuffer;Gt.Z.prototype._transformMatrixR=o.uq.Zero(),Gt.Z.prototype._multiviewSceneUbo=null,Gt.Z.prototype._createMultiviewUbo=function(){this._multiviewSceneUbo=gs(this.getEngine(),"scene_multiview")},Gt.Z.prototype.createSceneUniformBuffer=function(e){return this._multiviewSceneUbo?gs(this.getEngine(),e):ms.bind(this)(e)},Gt.Z.prototype._updateMultiviewUbo=function(e,t){e&&t&&e.multiplyToRef(t,this._transformMatrixR),e&&t&&(e.multiplyToRef(t,o.AA.Matrix[0]),C.P.GetRightPlaneToRef(o.AA.Matrix[0],this._frustumPlanes[3])),this._multiviewSceneUbo&&(this._multiviewSceneUbo.updateMatrix("viewProjection",this.getTransformMatrix()),this._multiviewSceneUbo.updateMatrix("viewProjectionR",this._transformMatrixR),this._multiviewSceneUbo.updateMatrix("view",this._viewMatrix),this._multiviewSceneUbo.updateMatrix("projection",this._projectionMatrix))},Gt.Z.prototype._renderMultiviewToSingleView=function(e){e._resizeOrCreateMultiviewTexture(e._rigPostProcess&&e._rigPostProcess&&e._rigPostProcess.width>0?e._rigPostProcess.width:this.getEngine().getRenderWidth(!0),e._rigPostProcess&&e._rigPostProcess&&e._rigPostProcess.height>0?e._rigPostProcess.height:this.getEngine().getRenderHeight(!0)),this._multiviewSceneUbo||this._createMultiviewUbo(),e.outputRenderTarget=e._multiviewTexture,this._renderForCamera(e),e.outputRenderTarget=null;for(let t=0;t<e._rigCameras.length;t++){const i=this.getEngine();this._activeCamera=e._rigCameras[t],i.setViewport(this._activeCamera.viewport),this.postProcessManager&&(this.postProcessManager._prepareFrame(),this.postProcessManager._finalizeFrame(this._activeCamera.isIntermediate))}};class bs extends Xr.w{getClassName(){return"VRMultiviewToSingleviewPostProcess"}constructor(e,t,i){super(e,"vrMultiviewToSingleview",["imageIndex"],["multiviewSampler"],i,t,kt.g.BILINEAR_SAMPLINGMODE);const r=t??this.getCamera();this.onSizeChangedObservable.add((()=>{})),this.onApplyObservable.add((e=>{r._scene.activeCamera&&r._scene.activeCamera.isLeftCamera?e.setInt("imageIndex",0):e.setInt("imageIndex",1),e.setTexture("multiviewSampler",r._multiviewTexture)}))}}d.AddNodeConstructor("VRDeviceOrientationFreeCamera",((e,t)=>()=>new vs(e,o.Pq.Zero(),t)));class vs extends cs{constructor(e,t,i){let r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:us.GetDefault();super(e,t,i),this._setRigMode=e=>function(e,t){const i=t.vrCameraMetrics||us.GetDefault();e._rigCameras[0]._cameraRigParams.vrMetrics=i,e._rigCameras[0].viewport=new A.L(0,0,.5,1),e._rigCameras[0]._cameraRigParams.vrWorkMatrix=new o.uq,e._rigCameras[0]._cameraRigParams.vrHMatrix=i.leftHMatrix,e._rigCameras[0]._cameraRigParams.vrPreViewMatrix=i.leftPreViewMatrix,e._rigCameras[0].getProjectionMatrix=e._rigCameras[0]._getVRProjectionMatrix,e._rigCameras[1]._cameraRigParams.vrMetrics=i,e._rigCameras[1].viewport=new A.L(.5,0,.5,1),e._rigCameras[1]._cameraRigParams.vrWorkMatrix=new o.uq,e._rigCameras[1]._cameraRigParams.vrHMatrix=i.rightHMatrix,e._rigCameras[1]._cameraRigParams.vrPreViewMatrix=i.rightPreViewMatrix,e._rigCameras[1].getProjectionMatrix=e._rigCameras[1]._getVRProjectionMatrix,i.multiviewEnabled&&(e.getScene().getEngine().getCaps().multiview?(e._useMultiviewToSingleView=!0,e._rigPostProcess=new bs("VRMultiviewToSingleview",e,i.postProcessScaleFactor)):(T.V.Warn("Multiview is not supported, falling back to standard rendering"),i.multiviewEnabled=!1)),i.compensateDistortion&&(e._rigCameras[0]._rigPostProcess=new ds("VR_Distort_Compensation_Left",e._rigCameras[0],!1,i),e._rigCameras[1]._rigPostProcess=new ds("VR_Distort_Compensation_Right",e._rigCameras[1],!0,i))}(this,e),s.compensateDistortion=r,this.setCameraRigMode(R.RIG_MODE_VR,{vrCameraMetrics:s})}getClassName(){return"VRDeviceOrientationFreeCamera"}}class ys{get isConnected(){return this._isConnected}constructor(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:3;this.id=e,this.index=t,this.browserGamepad=i,this._leftStick={x:0,y:0},this._rightStick={x:0,y:0},this._isConnected=!0,this._invertLeftStickY=!1,this.type=ys.GAMEPAD,this._leftStickAxisX=r,this._leftStickAxisY=s,this._rightStickAxisX=n,this._rightStickAxisY=a,this.browserGamepad.axes.length>=2&&(this._leftStick={x:this.browserGamepad.axes[this._leftStickAxisX],y:this.browserGamepad.axes[this._leftStickAxisY]}),this.browserGamepad.axes.length>=4&&(this._rightStick={x:this.browserGamepad.axes[this._rightStickAxisX],y:this.browserGamepad.axes[this._rightStickAxisY]})}onleftstickchanged(e){this._onleftstickchanged=e}onrightstickchanged(e){this._onrightstickchanged=e}get leftStick(){return this._leftStick}set leftStick(e){!this._onleftstickchanged||this._leftStick.x===e.x&&this._leftStick.y===e.y||this._onleftstickchanged(e),this._leftStick=e}get rightStick(){return this._rightStick}set rightStick(e){!this._onrightstickchanged||this._rightStick.x===e.x&&this._rightStick.y===e.y||this._onrightstickchanged(e),this._rightStick=e}update(){this._leftStick&&(this.leftStick={x:this.browserGamepad.axes[this._leftStickAxisX],y:this.browserGamepad.axes[this._leftStickAxisY]},this._invertLeftStickY&&(this.leftStick.y*=-1)),this._rightStick&&(this.rightStick={x:this.browserGamepad.axes[this._rightStickAxisX],y:this.browserGamepad.axes[this._rightStickAxisY]})}dispose(){}}ys.GAMEPAD=0,ys.GENERIC=1,ys.XBOX=2,ys.POSE_ENABLED=3,ys.DUALSHOCK=4;class Ts extends ys{onbuttondown(e){this._onbuttondown=e}onbuttonup(e){this._onbuttonup=e}constructor(e,t,i){super(e,t,i),this.onButtonDownObservable=new a.cP,this.onButtonUpObservable=new a.cP,this.type=ys.GENERIC,this._buttons=new Array(i.buttons.length)}_setButtonValue(e,t,i){return e!==t&&(1===e&&(this._onbuttondown&&this._onbuttondown(i),this.onButtonDownObservable.notifyObservers(i)),0===e&&(this._onbuttonup&&this._onbuttonup(i),this.onButtonUpObservable.notifyObservers(i))),e}update(){super.update();for(let e=0;e<this._buttons.length;e++)this._buttons[e]=this._setButtonValue(this.browserGamepad.buttons[e].value,this._buttons[e],e)}dispose(){super.dispose(),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear()}}class xs{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:O.bH;this.origin=e,this.direction=t,this.length=i,this.epsilon=r}clone(){return new xs(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=xs._TmpVector3[0].copyFromFloats(e.x-i,e.y-i,e.z-i),s=xs._TmpVector3[1].copyFromFloats(t.x+i,t.y+i,t.z+i);let n,a,o,l,h=0,c=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<r.x||this.origin.x>s.x)return!1}else if(n=1/this.direction.x,a=(r.x-this.origin.x)*n,o=(s.x-this.origin.x)*n,o===-1/0&&(o=1/0),a>o&&(l=a,a=o,o=l),h=Math.max(a,h),c=Math.min(o,c),h>c)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<r.y||this.origin.y>s.y)return!1}else if(n=1/this.direction.y,a=(r.y-this.origin.y)*n,o=(s.y-this.origin.y)*n,o===-1/0&&(o=1/0),a>o&&(l=a,a=o,o=l),h=Math.max(a,h),c=Math.min(o,c),h>c)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<r.z||this.origin.z>s.z)return!1}else if(n=1/this.direction.z,a=(r.z-this.origin.z)*n,o=(s.z-this.origin.z)*n,o===-1/0&&(o=1/0),a>o&&(l=a,a=o,o=l),h=Math.max(a,h),c=Math.min(o,c),h>c)return!1;return!0}intersectsBox(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(e.minimum,e.maximum,t)}intersectsSphere(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=e.center.x-this.origin.x,r=e.center.y-this.origin.y,s=e.center.z-this.origin.z,n=i*i+r*r+s*s,a=e.radius+t,o=a*a;if(n<=o)return!0;const l=i*this.direction.x+r*this.direction.y+s*this.direction.z;if(l<0)return!1;return n-l*l<=o}intersectsTriangle(e,t,i){const r=xs._TmpVector3[0],s=xs._TmpVector3[1],n=xs._TmpVector3[2],a=xs._TmpVector3[3],l=xs._TmpVector3[4];t.subtractToRef(e,r),i.subtractToRef(e,s),o.Pq.CrossToRef(this.direction,s,n);const h=o.Pq.Dot(r,n);if(0===h)return null;const c=1/h;this.origin.subtractToRef(e,a);const u=o.Pq.Dot(a,n)*c;if(u<-this.epsilon||u>1+this.epsilon)return null;o.Pq.CrossToRef(a,r,l);const d=o.Pq.Dot(this.direction,l)*c;if(d<-this.epsilon||u+d>1+this.epsilon)return null;const _=o.Pq.Dot(s,l)*c;return _>this.length?null:new P(1-u-d,u,_)}intersectsPlane(e){let t;const i=o.Pq.Dot(e.normal,this.direction);if(Math.abs(i)<9.99999997475243e-7)return null;{const r=o.Pq.Dot(e.normal,this.origin);return t=(-e.d-r)/i,t<0?t<-9.99999997475243e-7?null:0:t}}intersectsAxis(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(e){case"y":{const e=(this.origin.y-t)/this.direction.y;return e>0?null:new o.Pq(this.origin.x+this.direction.x*-e,t,this.origin.z+this.direction.z*-e)}case"x":{const e=(this.origin.x-t)/this.direction.x;return e>0?null:new o.Pq(t,this.origin.y+this.direction.y*-e,this.origin.z+this.direction.z*-e)}case"z":{const e=(this.origin.z-t)/this.direction.z;return e>0?null:new o.Pq(this.origin.x+this.direction.x*-e,this.origin.y+this.direction.y*-e,t)}default:return null}}intersectsMesh(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4?arguments[4]:void 0,n=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const a=o.AA.Matrix[0];return e.getWorldMatrix().invertToRef(a),this._tmpRay?xs.TransformToRef(this,a,this._tmpRay):this._tmpRay=xs.Transform(this,a),e.intersects(this._tmpRay,t,i,r,s,n)}intersectsMeshes(e,t,i){i?i.length=0:i=[];for(let r=0;r<e.length;r++){const s=this.intersectsMesh(e[r],t);s.hit&&i.push(s)}return i.sort(this._comparePickingInfo),i}_comparePickingInfo(e,t){return e.distance<t.distance?-1:e.distance>t.distance?1:0}intersectionSegment(e,t,i){const r=this.origin,s=o.AA.Vector3[0],n=o.AA.Vector3[1],a=o.AA.Vector3[2],l=o.AA.Vector3[3];t.subtractToRef(e,s),this.direction.scaleToRef(xs._Rayl,a),r.addToRef(a,n),e.subtractToRef(r,l);const h=o.Pq.Dot(s,s),c=o.Pq.Dot(s,a),u=o.Pq.Dot(a,a),d=o.Pq.Dot(s,l),_=o.Pq.Dot(a,l),p=h*u-c*c;let f,g,m=p,b=p;p<xs._Smallnum?(f=0,m=1,g=_,b=u):(f=c*_-u*d,g=h*_-c*d,f<0?(f=0,g=_,b=u):f>m&&(f=m,g=_+c,b=u)),g<0?(g=0,-d<0?f=0:-d>h?f=m:(f=-d,m=h)):g>b&&(g=b,-d+c<0?f=0:-d+c>h?f=m:(f=-d+c,m=h));const v=Math.abs(f)<xs._Smallnum?0:f/m,y=Math.abs(g)<xs._Smallnum?0:g/b,T=o.AA.Vector3[4];a.scaleToRef(y,T);const x=o.AA.Vector3[5];s.scaleToRef(v,x),x.addInPlace(l);const A=o.AA.Vector3[6];x.subtractToRef(T,A);return y>0&&y<=this.length&&A.lengthSquared()<i*i?x.length():-1}update(e,t,i,r,s,n,a){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){xs._RayDistant||(xs._RayDistant=xs.Zero()),xs._RayDistant.unprojectRayToRef(e,t,i,r,o.uq.IdentityReadOnly,n,a);const l=o.AA.Matrix[0];s.invertToRef(l),xs.TransformToRef(xs._RayDistant,l,this)}else this.unprojectRayToRef(e,t,i,r,s,n,a);return this}static Zero(){return new xs(o.Pq.Zero(),o.Pq.Zero())}static CreateNew(e,t,i,r,s,n,a){return xs.Zero().update(e,t,i,r,s,n,a)}static CreateNewFromTo(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.uq.IdentityReadOnly;const r=new xs(new o.Pq(0,0,0),new o.Pq(0,0,0));return xs.CreateFromToToRef(e,t,r,i)}static CreateFromToToRef(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o.uq.IdentityReadOnly;i.origin.copyFrom(e);const s=t.subtractToRef(e,i.direction),n=Math.sqrt(s.x*s.x+s.y*s.y+s.z*s.z);return i.length=n,i.direction.normalize(),xs.TransformToRef(i,r,i)}static Transform(e,t){const i=new xs(new o.Pq(0,0,0),new o.Pq(0,0,0));return xs.TransformToRef(e,t,i),i}static TransformToRef(e,t,i){o.Pq.TransformCoordinatesToRef(e.origin,t,i.origin),o.Pq.TransformNormalToRef(e.direction,t,i.direction),i.length=e.length,i.epsilon=e.epsilon;const r=i.direction,s=r.length();if(0!==s&&1!==s){const e=1/s;r.x*=e,r.y*=e,r.z*=e,i.length*=s}return i}unprojectRayToRef(e,t,i,r,s,n,a){const h=o.AA.Matrix[0];s.multiplyToRef(n,h),h.multiplyToRef(a,h),h.invert();const c=l.q.LastCreatedEngine,u=o.AA.Vector3[0];u.x=e/i*2-1,u.y=-(t/r*2-1),u.z=c?.useReverseDepthBuffer?1:c?.isNDCHalfZRange?0:-1;const d=o.AA.Vector3[1].copyFromFloats(u.x,u.y,1-1e-8),_=o.AA.Vector3[2],p=o.AA.Vector3[3];o.Pq._UnprojectFromInvertedMatrixToRef(u,h,_),o.Pq._UnprojectFromInvertedMatrixToRef(d,h,p),this.origin.copyFrom(_),p.subtractToRef(_,this.direction),this.direction.normalize()}}xs._TmpVector3=(0,I.mI)(6,o.Pq.Zero),xs._RayDistant=xs.Zero(),xs._Smallnum=1e-8,xs._Rayl=1e9,Gt.Z.prototype.createPickingRay=function(e,t,i,r){let s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const n=xs.Zero();return this.createPickingRayToRef(e,t,i,n,r,s),n},Gt.Z.prototype.createPickingRayToRef=function(e,t,i,r,s){let n=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const l=this.getEngine();if(!s&&!(s=this.activeCamera))return this;const h=s.viewport,c=l.getRenderHeight(),{x:u,y:d,width:_,height:p}=h.toGlobal(l.getRenderWidth(),c),f=1/l.getHardwareScalingLevel();return e=e*f-u,t=t*f-(c-d-p),r.update(e,t,_,p,i||o.uq.IdentityReadOnly,n?o.uq.IdentityReadOnly:s.getViewMatrix(),s.getProjectionMatrix(),a),this},Gt.Z.prototype.createPickingRayInCameraSpace=function(e,t,i){const r=xs.Zero();return this.createPickingRayInCameraSpaceToRef(e,t,r,i),r},Gt.Z.prototype.createPickingRayInCameraSpaceToRef=function(e,t,i,r){if(!Q.G)return this;const s=this.getEngine();if(!r&&!(r=this.activeCamera))throw new Error("Active camera not set");const n=r.viewport,a=s.getRenderHeight(),{x:l,y:h,width:c,height:u}=n.toGlobal(s.getRenderWidth(),a),d=o.uq.Identity(),_=1/s.getHardwareScalingLevel();return e=e*_-l,t=t*_-(a-h-u),i.update(e,t,c,u,d,d,r.getProjectionMatrix()),this},Gt.Z.prototype._internalPickForMesh=function(e,t,i,r,s,n,a,o){const l=t(r,i.enableDistantPicking),h=i.intersects(l,s,a,n,r,o);return h&&h.hit?!s&&null!=e&&h.distance>=e.distance?null:h:null},Gt.Z.prototype._internalPick=function(e,t,i,r,s){let n=null;const a=!!(this.activeCameras&&this.activeCameras.length>1&&this.cameraToUseForPointers!==this.activeCamera),l=this.cameraToUseForPointers||this.activeCamera;for(let h=0;h<this.meshes.length;h++){const c=this.meshes[h];if(t){if(!t(c,-1))continue}else if(!c.isEnabled()||!c.isVisible||!c.isPickable)continue;const u=a&&c.isWorldMatrixCameraDependent(),d=c.computeWorldMatrix(u,l);if(c.hasThinInstances&&c.thinInstanceEnablePicking){const a=this._internalPickForMesh(n,e,c,d,!0,!0,s);if(a){if(r)return a;const l=o.AA.Matrix[1],h=c.thinInstanceGetWorldMatrices();for(let a=0;a<h.length;a++){if(t&&!t(c,a))continue;h[a].multiplyToRef(d,l);const o=this._internalPickForMesh(n,e,c,l,i,r,s,!0);if(o&&(n=o,n.thinInstanceIndex=a,i))return n}}}else{const t=this._internalPickForMesh(n,e,c,d,i,r,s);if(t&&(n=t,i))return n}}return n||new Q.G},Gt.Z.prototype._internalMultiPick=function(e,t,i){if(!Q.G)return null;const r=[],s=!!(this.activeCameras&&this.activeCameras.length>1&&this.cameraToUseForPointers!==this.activeCamera),n=this.cameraToUseForPointers||this.activeCamera;for(let a=0;a<this.meshes.length;a++){const l=this.meshes[a];if(t){if(!t(l,-1))continue}else if(!l.isEnabled()||!l.isVisible||!l.isPickable)continue;const h=s&&l.isWorldMatrixCameraDependent(),c=l.computeWorldMatrix(h,n);if(l.hasThinInstances&&l.thinInstanceEnablePicking){if(this._internalPickForMesh(null,e,l,c,!0,!0,i)){const s=o.AA.Matrix[1],n=l.thinInstanceGetWorldMatrices();for(let a=0;a<n.length;a++){if(t&&!t(l,a))continue;n[a].multiplyToRef(c,s);const o=this._internalPickForMesh(null,e,l,s,!1,!1,i,!0);o&&(o.thinInstanceIndex=a,r.push(o))}}}else{const t=this._internalPickForMesh(null,e,l,c,!1,!1,i);t&&r.push(t)}}return r},Gt.Z.prototype.pickWithBoundingInfo=function(e,t,i,r,s){if(!Q.G)return null;const n=this._internalPick((i=>(this._tempPickingRay||(this._tempPickingRay=xs.Zero()),this.createPickingRayToRef(e,t,i,this._tempPickingRay,s||null),this._tempPickingRay)),i,r,!0);return n&&(n.ray=this.createPickingRay(e,t,o.uq.Identity(),s||null)),n},Object.defineProperty(Gt.Z.prototype,"_pickingAvailable",{get:()=>!0,enumerable:!1,configurable:!1}),Gt.Z.prototype.pick=function(e,t,i,r,s,n){const a=this._internalPick(((i,r)=>(this._tempPickingRay||(this._tempPickingRay=xs.Zero()),this.createPickingRayToRef(e,t,i,this._tempPickingRay,s||null,!1,r),this._tempPickingRay)),i,r,!1,n);return a&&(a.ray=this.createPickingRay(e,t,o.uq.Identity(),s||null)),a},Gt.Z.prototype.pickWithRay=function(e,t,i,r){const s=this._internalPick((t=>(this._pickWithRayInverseMatrix||(this._pickWithRayInverseMatrix=o.uq.Identity()),t.invertToRef(this._pickWithRayInverseMatrix),this._cachedRayForTransform||(this._cachedRayForTransform=xs.Zero()),xs.TransformToRef(e,this._pickWithRayInverseMatrix,this._cachedRayForTransform),this._cachedRayForTransform)),t,i,!1,r);return s&&(s.ray=e),s},Gt.Z.prototype.multiPick=function(e,t,i,r,s){return this._internalMultiPick((i=>this.createPickingRay(e,t,i,r||null)),i,s)},Gt.Z.prototype.multiPickWithRay=function(e,t,i){return this._internalMultiPick((t=>(this._pickWithRayInverseMatrix||(this._pickWithRayInverseMatrix=o.uq.Identity()),t.invertToRef(this._pickWithRayInverseMatrix),this._cachedRayForTransform||(this._cachedRayForTransform=xs.Zero()),xs.TransformToRef(e,this._pickWithRayInverseMatrix,this._cachedRayForTransform),this._cachedRayForTransform)),t,i)},R.prototype.getForwardRay=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;return this.getForwardRayToRef(new xs(o.Pq.Zero(),o.Pq.Zero(),e),e,t,i)},R.prototype.getForwardRayToRef=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;i||(i=this.getWorldMatrix()),e.length=t,r?e.origin.copyFrom(r):e.origin.copyFrom(this.position);const s=o.AA.Vector3[2];s.set(0,0,this._scene.useRightHandedSystem?-1:1);const n=o.AA.Vector3[3];return o.Pq.TransformNormalToRef(s,i,n),o.Pq.NormalizeToRef(n,e.direction),e};var As,Cs,Rs,Es,Ss=i(4780);St.w.prototype.createDynamicTexture=function(e,t,i,r){const s=new Et.h(this,4);return s.baseWidth=e,s.baseHeight=t,i&&(e=this.needPOTTextures?(0,Ss.R)(e,this._caps.maxTextureSize):e,t=this.needPOTTextures?(0,Ss.R)(t,this._caps.maxTextureSize):t),s.width=e,s.height=t,s.isReady=!1,s.generateMipMaps=i,s.samplingMode=r,this.updateTextureSamplingMode(r,s),this._internalTexturesCache.push(s),s},St.w.prototype.updateDynamicTexture=function(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4?arguments[4]:void 0,n=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!e)return;const a=this._gl,o=a.TEXTURE_2D,l=this._bindTextureDirectly(o,e,!0,n);this._unpackFlipY(void 0===i?e.invertY:i),r&&a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const h=this._getWebGLTextureType(e.type),c=this._getInternalFormat(s||e.format),u=this._getRGBABufferInternalSizedFormat(e.type,c);a.texImage2D(o,0,u,c,h,t),e.generateMipMaps&&a.generateMipmap(o),l||this._bindTextureDirectly(o,null),r&&a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),s&&(e.format=s),e._dynamicTextureSource=t,e._premulAlpha=r,e.invertY=i||!1,e.isReady=!0};class Ms extends kt.g{constructor(e,t){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3;super(null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,!i,arguments.length>6?arguments[6]:void 0,r,void 0,void 0,void 0,void 0,arguments.length>5&&void 0!==arguments[5]?arguments[5]:5),this.name=e,this.wrapU=kt.g.CLAMP_ADDRESSMODE,this.wrapV=kt.g.CLAMP_ADDRESSMODE,this._generateMipMaps=i;const s=this._getEngine();if(!s)return;t.getContext?(this._canvas=t,this._ownCanvas=!1,this._texture=s.createDynamicTexture(t.width,t.height,i,r)):(this._canvas=s.createCanvas(1,1),this._ownCanvas=!0,t.width||0===t.width?this._texture=s.createDynamicTexture(t.width,t.height,i,r):this._texture=s.createDynamicTexture(t,t,i,r));const n=this.getSize();this._canvas.width!==n.width&&(this._canvas.width=n.width),this._canvas.height!==n.height&&(this._canvas.height=n.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(e){this._canvas.width=e.width,this._canvas.height=e.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(e.width,e.height,this._generateMipMaps,this.samplingMode)}scale(e){const t=this.getSize();t.width*=e,t.height*=e,this._recreate(t)}scaleTo(e,t){const i=this.getSize();i.width=e,i.height=t,this._recreate(i)}getContext(){return this._context}clear(e){const t=this.getSize();e&&(this._context.fillStyle=e),this._context.clearRect(0,0,t.width,t.height)}update(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===e||e,t,this._format||void 0,void 0,i)}drawText(e,t,i,r,s,n,a){let o=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const l=this.getSize();if(n&&(this._context.fillStyle=n,this._context.fillRect(0,0,l.width,l.height)),this._context.font=r,null===t||void 0===t){const i=this._context.measureText(e);t=(l.width-i.width)/2}if(null===i||void 0===i){const e=parseInt(r.replace(/\D/g,""));i=l.height/2+e/3.65}this._context.fillStyle=s||"",this._context.fillText(e,t,i),o&&this.update(a)}dispose(){super.dispose(),this._ownCanvas&&this._canvas?.remove?.(),this._canvas=null,this._context=null}clone(){const e=this.getScene();if(!e)return this;const t=this.getSize(),i=new Ms(this.name,t,e,this._generateMipMaps);return i.hasAlpha=this.hasAlpha,i.level=this.level,i.wrapU=this.wrapU,i.wrapV=this.wrapV,i}serialize(){const e=this.getScene();e&&!e.isReady()&&T.V.Warn("The scene must be ready before serializing the dynamic texture");const t=super.serialize();return Ms._IsCanvasElement(this._canvas)&&(t.base64String=this._canvas.toDataURL()),t.invertY=this._invertY,t.samplingMode=this.samplingMode,t}static _IsCanvasElement(e){return void 0!==e.toDataURL}_rebuild(){this.update()}}!function(e){e[e.A=0]="A",e[e.B=1]="B",e[e.X=2]="X",e[e.Y=3]="Y",e[e.LB=4]="LB",e[e.RB=5]="RB",e[e.Back=8]="Back",e[e.Start=9]="Start",e[e.LeftStick=10]="LeftStick",e[e.RightStick=11]="RightStick"}(As||(As={})),function(e){e[e.Up=12]="Up",e[e.Down=13]="Down",e[e.Left=14]="Left",e[e.Right=15]="Right"}(Cs||(Cs={}));class Ps extends ys{constructor(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];super(e,t,i,0,1,2,3),this._leftTrigger=0,this._rightTrigger=0,this.onButtonDownObservable=new a.cP,this.onButtonUpObservable=new a.cP,this.onPadDownObservable=new a.cP,this.onPadUpObservable=new a.cP,this._buttonA=0,this._buttonB=0,this._buttonX=0,this._buttonY=0,this._buttonBack=0,this._buttonStart=0,this._buttonLB=0,this._buttonRB=0,this._buttonLeftStick=0,this._buttonRightStick=0,this._dPadUp=0,this._dPadDown=0,this._dPadLeft=0,this._dPadRight=0,this._isXboxOnePad=!1,this.type=ys.XBOX,this._isXboxOnePad=r}onlefttriggerchanged(e){this._onlefttriggerchanged=e}onrighttriggerchanged(e){this._onrighttriggerchanged=e}get leftTrigger(){return this._leftTrigger}set leftTrigger(e){this._onlefttriggerchanged&&this._leftTrigger!==e&&this._onlefttriggerchanged(e),this._leftTrigger=e}get rightTrigger(){return this._rightTrigger}set rightTrigger(e){this._onrighttriggerchanged&&this._rightTrigger!==e&&this._onrighttriggerchanged(e),this._rightTrigger=e}onbuttondown(e){this._onbuttondown=e}onbuttonup(e){this._onbuttonup=e}ondpaddown(e){this._ondpaddown=e}ondpadup(e){this._ondpadup=e}_setButtonValue(e,t,i){return e!==t&&(1===e&&(this._onbuttondown&&this._onbuttondown(i),this.onButtonDownObservable.notifyObservers(i)),0===e&&(this._onbuttonup&&this._onbuttonup(i),this.onButtonUpObservable.notifyObservers(i))),e}_setDPadValue(e,t,i){return e!==t&&(1===e&&(this._ondpaddown&&this._ondpaddown(i),this.onPadDownObservable.notifyObservers(i)),0===e&&(this._ondpadup&&this._ondpadup(i),this.onPadUpObservable.notifyObservers(i))),e}get buttonA(){return this._buttonA}set buttonA(e){this._buttonA=this._setButtonValue(e,this._buttonA,0)}get buttonB(){return this._buttonB}set buttonB(e){this._buttonB=this._setButtonValue(e,this._buttonB,1)}get buttonX(){return this._buttonX}set buttonX(e){this._buttonX=this._setButtonValue(e,this._buttonX,2)}get buttonY(){return this._buttonY}set buttonY(e){this._buttonY=this._setButtonValue(e,this._buttonY,3)}get buttonStart(){return this._buttonStart}set buttonStart(e){this._buttonStart=this._setButtonValue(e,this._buttonStart,9)}get buttonBack(){return this._buttonBack}set buttonBack(e){this._buttonBack=this._setButtonValue(e,this._buttonBack,8)}get buttonLB(){return this._buttonLB}set buttonLB(e){this._buttonLB=this._setButtonValue(e,this._buttonLB,4)}get buttonRB(){return this._buttonRB}set buttonRB(e){this._buttonRB=this._setButtonValue(e,this._buttonRB,5)}get buttonLeftStick(){return this._buttonLeftStick}set buttonLeftStick(e){this._buttonLeftStick=this._setButtonValue(e,this._buttonLeftStick,10)}get buttonRightStick(){return this._buttonRightStick}set buttonRightStick(e){this._buttonRightStick=this._setButtonValue(e,this._buttonRightStick,11)}get dPadUp(){return this._dPadUp}set dPadUp(e){this._dPadUp=this._setDPadValue(e,this._dPadUp,12)}get dPadDown(){return this._dPadDown}set dPadDown(e){this._dPadDown=this._setDPadValue(e,this._dPadDown,13)}get dPadLeft(){return this._dPadLeft}set dPadLeft(e){this._dPadLeft=this._setDPadValue(e,this._dPadLeft,14)}get dPadRight(){return this._dPadRight}set dPadRight(e){this._dPadRight=this._setDPadValue(e,this._dPadRight,15)}update(){super.update(),this._isXboxOnePad,this.buttonA=this.browserGamepad.buttons[0].value,this.buttonB=this.browserGamepad.buttons[1].value,this.buttonX=this.browserGamepad.buttons[2].value,this.buttonY=this.browserGamepad.buttons[3].value,this.buttonLB=this.browserGamepad.buttons[4].value,this.buttonRB=this.browserGamepad.buttons[5].value,this.leftTrigger=this.browserGamepad.buttons[6].value,this.rightTrigger=this.browserGamepad.buttons[7].value,this.buttonBack=this.browserGamepad.buttons[8].value,this.buttonStart=this.browserGamepad.buttons[9].value,this.buttonLeftStick=this.browserGamepad.buttons[10].value,this.buttonRightStick=this.browserGamepad.buttons[11].value,this.dPadUp=this.browserGamepad.buttons[12].value,this.dPadDown=this.browserGamepad.buttons[13].value,this.dPadLeft=this.browserGamepad.buttons[14].value,this.dPadRight=this.browserGamepad.buttons[15].value}dispose(){super.dispose(),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear(),this.onPadDownObservable.clear(),this.onPadUpObservable.clear()}}!function(e){e[e.Cross=0]="Cross",e[e.Circle=1]="Circle",e[e.Square=2]="Square",e[e.Triangle=3]="Triangle",e[e.L1=4]="L1",e[e.R1=5]="R1",e[e.Share=8]="Share",e[e.Options=9]="Options",e[e.LeftStick=10]="LeftStick",e[e.RightStick=11]="RightStick"}(Rs||(Rs={})),function(e){e[e.Up=12]="Up",e[e.Down=13]="Down",e[e.Left=14]="Left",e[e.Right=15]="Right"}(Es||(Es={}));class Is extends ys{constructor(e,t,i){super(e.replace("STANDARD GAMEPAD","SONY PLAYSTATION DUALSHOCK"),t,i,0,1,2,3),this._leftTrigger=0,this._rightTrigger=0,this.onButtonDownObservable=new a.cP,this.onButtonUpObservable=new a.cP,this.onPadDownObservable=new a.cP,this.onPadUpObservable=new a.cP,this._buttonCross=0,this._buttonCircle=0,this._buttonSquare=0,this._buttonTriangle=0,this._buttonShare=0,this._buttonOptions=0,this._buttonL1=0,this._buttonR1=0,this._buttonLeftStick=0,this._buttonRightStick=0,this._dPadUp=0,this._dPadDown=0,this._dPadLeft=0,this._dPadRight=0,this.type=ys.DUALSHOCK}onlefttriggerchanged(e){this._onlefttriggerchanged=e}onrighttriggerchanged(e){this._onrighttriggerchanged=e}get leftTrigger(){return this._leftTrigger}set leftTrigger(e){this._onlefttriggerchanged&&this._leftTrigger!==e&&this._onlefttriggerchanged(e),this._leftTrigger=e}get rightTrigger(){return this._rightTrigger}set rightTrigger(e){this._onrighttriggerchanged&&this._rightTrigger!==e&&this._onrighttriggerchanged(e),this._rightTrigger=e}onbuttondown(e){this._onbuttondown=e}onbuttonup(e){this._onbuttonup=e}ondpaddown(e){this._ondpaddown=e}ondpadup(e){this._ondpadup=e}_setButtonValue(e,t,i){return e!==t&&(1===e&&(this._onbuttondown&&this._onbuttondown(i),this.onButtonDownObservable.notifyObservers(i)),0===e&&(this._onbuttonup&&this._onbuttonup(i),this.onButtonUpObservable.notifyObservers(i))),e}_setDPadValue(e,t,i){return e!==t&&(1===e&&(this._ondpaddown&&this._ondpaddown(i),this.onPadDownObservable.notifyObservers(i)),0===e&&(this._ondpadup&&this._ondpadup(i),this.onPadUpObservable.notifyObservers(i))),e}get buttonCross(){return this._buttonCross}set buttonCross(e){this._buttonCross=this._setButtonValue(e,this._buttonCross,0)}get buttonCircle(){return this._buttonCircle}set buttonCircle(e){this._buttonCircle=this._setButtonValue(e,this._buttonCircle,1)}get buttonSquare(){return this._buttonSquare}set buttonSquare(e){this._buttonSquare=this._setButtonValue(e,this._buttonSquare,2)}get buttonTriangle(){return this._buttonTriangle}set buttonTriangle(e){this._buttonTriangle=this._setButtonValue(e,this._buttonTriangle,3)}get buttonOptions(){return this._buttonOptions}set buttonOptions(e){this._buttonOptions=this._setButtonValue(e,this._buttonOptions,9)}get buttonShare(){return this._buttonShare}set buttonShare(e){this._buttonShare=this._setButtonValue(e,this._buttonShare,8)}get buttonL1(){return this._buttonL1}set buttonL1(e){this._buttonL1=this._setButtonValue(e,this._buttonL1,4)}get buttonR1(){return this._buttonR1}set buttonR1(e){this._buttonR1=this._setButtonValue(e,this._buttonR1,5)}get buttonLeftStick(){return this._buttonLeftStick}set buttonLeftStick(e){this._buttonLeftStick=this._setButtonValue(e,this._buttonLeftStick,10)}get buttonRightStick(){return this._buttonRightStick}set buttonRightStick(e){this._buttonRightStick=this._setButtonValue(e,this._buttonRightStick,11)}get dPadUp(){return this._dPadUp}set dPadUp(e){this._dPadUp=this._setDPadValue(e,this._dPadUp,12)}get dPadDown(){return this._dPadDown}set dPadDown(e){this._dPadDown=this._setDPadValue(e,this._dPadDown,13)}get dPadLeft(){return this._dPadLeft}set dPadLeft(e){this._dPadLeft=this._setDPadValue(e,this._dPadLeft,14)}get dPadRight(){return this._dPadRight}set dPadRight(e){this._dPadRight=this._setDPadValue(e,this._dPadRight,15)}update(){super.update(),this.buttonCross=this.browserGamepad.buttons[0].value,this.buttonCircle=this.browserGamepad.buttons[1].value,this.buttonSquare=this.browserGamepad.buttons[2].value,this.buttonTriangle=this.browserGamepad.buttons[3].value,this.buttonL1=this.browserGamepad.buttons[4].value,this.buttonR1=this.browserGamepad.buttons[5].value,this.leftTrigger=this.browserGamepad.buttons[6].value,this.rightTrigger=this.browserGamepad.buttons[7].value,this.buttonShare=this.browserGamepad.buttons[8].value,this.buttonOptions=this.browserGamepad.buttons[9].value,this.buttonLeftStick=this.browserGamepad.buttons[10].value,this.buttonRightStick=this.browserGamepad.buttons[11].value,this.dPadUp=this.browserGamepad.buttons[12].value,this.dPadDown=this.browserGamepad.buttons[13].value,this.dPadLeft=this.browserGamepad.buttons[14].value,this.dPadRight=this.browserGamepad.buttons[15].value}dispose(){super.dispose(),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear(),this.onPadDownObservable.clear(),this.onPadUpObservable.clear()}}class Os{constructor(e){if(this._scene=e,this._babylonGamepads=[],this._oneGamepadConnected=!1,this._isMonitoring=!1,this.onGamepadDisconnectedObservable=new a.cP,(0,Dt.BA)()?(this._gamepadEventSupported="GamepadEvent"in window,this._gamepadSupport=navigator&&navigator.getGamepads):this._gamepadEventSupported=!1,this.onGamepadConnectedObservable=new a.cP((e=>{for(const t in this._babylonGamepads){const i=this._babylonGamepads[t];i&&i._isConnected&&this.onGamepadConnectedObservable.notifyObserver(e,i)}})),this._onGamepadConnectedEvent=e=>{const t=e.gamepad;if(t.index in this._babylonGamepads&&this._babylonGamepads[t.index].isConnected)return;let i;this._babylonGamepads[t.index]?(i=this._babylonGamepads[t.index],i.browserGamepad=t,i._isConnected=!0):i=this._addNewGamepad(t),this.onGamepadConnectedObservable.notifyObservers(i),this._startMonitoringGamepads()},this._onGamepadDisconnectedEvent=e=>{const t=e.gamepad;for(const i in this._babylonGamepads)if(this._babylonGamepads[i].index===t.index){const e=this._babylonGamepads[i];e._isConnected=!1,this.onGamepadDisconnectedObservable.notifyObservers(e),e.dispose&&e.dispose();break}},this._gamepadSupport)if(this._updateGamepadObjects(),this._babylonGamepads.length&&this._startMonitoringGamepads(),this._gamepadEventSupported){const e=this._scene?this._scene.getEngine().getHostWindow():window;e&&(e.addEventListener("gamepadconnected",this._onGamepadConnectedEvent,!1),e.addEventListener("gamepaddisconnected",this._onGamepadDisconnectedEvent,!1))}else this._startMonitoringGamepads()}get gamepads(){return this._babylonGamepads}getGamepadByType(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ys.XBOX;for(const t of this._babylonGamepads)if(t&&t.type===e)return t;return null}dispose(){this._gamepadEventSupported&&(this._onGamepadConnectedEvent&&window.removeEventListener("gamepadconnected",this._onGamepadConnectedEvent),this._onGamepadDisconnectedEvent&&window.removeEventListener("gamepaddisconnected",this._onGamepadDisconnectedEvent),this._onGamepadConnectedEvent=null,this._onGamepadDisconnectedEvent=null),this._babylonGamepads.forEach((e=>{e.dispose()})),this.onGamepadConnectedObservable.clear(),this.onGamepadDisconnectedObservable.clear(),this._oneGamepadConnected=!1,this._stopMonitoringGamepads(),this._babylonGamepads=[]}_addNewGamepad(e){let t;this._oneGamepadConnected||(this._oneGamepadConnected=!0);const i=-1!==e.id.search("054c")&&-1===e.id.search("0ce6"),r=-1!==e.id.search("Xbox One");return t=r||-1!==e.id.search("Xbox 360")||-1!==e.id.search("xinput")||-1!==e.id.search("045e")&&-1===e.id.search("Surface Dock")?new Ps(e.id,e.index,e,r):i?new Is(e.id,e.index,e):new Ts(e.id,e.index,e),this._babylonGamepads[t.index]=t,t}_startMonitoringGamepads(){this._isMonitoring||(this._isMonitoring=!0,this._checkGamepadsStatus())}_stopMonitoringGamepads(){this._isMonitoring=!1}_checkGamepadsStatus(){this._updateGamepadObjects();for(const e in this._babylonGamepads){const t=this._babylonGamepads[e];if(t&&t.isConnected)try{t.update()}catch{-1===this._loggedErrors.indexOf(t.index)&&(_.S0.Warn(`Error updating gamepad ${t.id}`),this._loggedErrors.push(t.index))}}this._isMonitoring&&ee.$.QueueNewFrame((()=>{this._checkGamepadsStatus()}))}_updateGamepadObjects(){const e=navigator.getGamepads?navigator.getGamepads():[];for(let t=0;t<e.length;t++){const i=e[t];if(i)if(this._babylonGamepads[i.index])this._babylonGamepads[t].browserGamepad=i,this._babylonGamepads[t].isConnected||(this._babylonGamepads[t]._isConnected=!0,this.onGamepadConnectedObservable.notifyObservers(this._babylonGamepads[t]));else{const e=this._addNewGamepad(i);this.onGamepadConnectedObservable.notifyObservers(e)}}}}class Ds{constructor(){this.gamepadAngularSensibility=200,this.gamepadMoveSensibility=40,this.deadzoneDelta=.1,this._yAxisScale=1,this._cameraTransform=o.uq.Identity(),this._deltaTransform=o.Pq.Zero(),this._vector3=o.Pq.Zero(),this._vector2=o.I9.Zero()}get invertYAxis(){return 1!==this._yAxisScale}set invertYAxis(e){this._yAxisScale=e?-1:1}attachControl(){const e=this.camera.getScene().gamepadManager;this._onGamepadConnectedObserver=e.onGamepadConnectedObservable.add((e=>{e.type!==ys.POSE_ENABLED&&(this.gamepad&&e.type!==ys.XBOX||(this.gamepad=e))})),this._onGamepadDisconnectedObserver=e.onGamepadDisconnectedObservable.add((e=>{this.gamepad===e&&(this.gamepad=null)})),this.gamepad=e.getGamepadByType(ys.XBOX),!this.gamepad&&e.gamepads.length&&(this.gamepad=e.gamepads[0])}detachControl(){this.camera.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.camera.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),this.gamepad=null}checkInputs(){if(this.gamepad&&this.gamepad.leftStick){const e=this.camera,t=this.gamepad.leftStick;0!==this.gamepadMoveSensibility&&(t.x=Math.abs(t.x)>this.deadzoneDelta?t.x/this.gamepadMoveSensibility:0,t.y=Math.abs(t.y)>this.deadzoneDelta?t.y/this.gamepadMoveSensibility:0);let i=this.gamepad.rightStick;i&&0!==this.gamepadAngularSensibility?(i.x=Math.abs(i.x)>this.deadzoneDelta?i.x/this.gamepadAngularSensibility:0,i.y=(Math.abs(i.y)>this.deadzoneDelta?i.y/this.gamepadAngularSensibility:0)*this._yAxisScale):i={x:0,y:0},e.rotationQuaternion?e.rotationQuaternion.toRotationMatrix(this._cameraTransform):o.uq.RotationYawPitchRollToRef(e.rotation.y,e.rotation.x,0,this._cameraTransform);const r=50*e._computeLocalCameraSpeed();this._vector3.copyFromFloats(t.x*r,0,-t.y*r),o.Pq.TransformCoordinatesToRef(this._vector3,this._cameraTransform,this._deltaTransform),e.cameraDirection.addInPlace(this._deltaTransform),this._vector2.copyFromFloats(i.y,i.x),e.cameraRotation.addInPlace(this._vector2)}}getClassName(){return"FreeCameraGamepadInput"}getSimpleName(){return"gamepad"}}(0,s.Cg)([(0,n.lK)()],Ds.prototype,"gamepadAngularSensibility",void 0),(0,s.Cg)([(0,n.lK)()],Ds.prototype,"gamepadMoveSensibility",void 0),gt.FreeCameraGamepadInput=Ds;class ws{constructor(){this.gamepadRotationSensibility=80,this.gamepadMoveSensibility=40,this._yAxisScale=1}get invertYAxis(){return 1!==this._yAxisScale}set invertYAxis(e){this._yAxisScale=e?-1:1}attachControl(){const e=this.camera.getScene().gamepadManager;this._onGamepadConnectedObserver=e.onGamepadConnectedObservable.add((e=>{e.type!==ys.POSE_ENABLED&&(this.gamepad&&e.type!==ys.XBOX||(this.gamepad=e))})),this._onGamepadDisconnectedObserver=e.onGamepadDisconnectedObservable.add((e=>{this.gamepad===e&&(this.gamepad=null)})),this.gamepad=e.getGamepadByType(ys.XBOX),!this.gamepad&&e.gamepads.length&&(this.gamepad=e.gamepads[0])}detachControl(){this.camera.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.camera.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),this.gamepad=null}checkInputs(){if(this.gamepad){const e=this.camera,t=this.gamepad.rightStick;if(t){if(0!=t.x){const i=t.x/this.gamepadRotationSensibility;0!=i&&Math.abs(i)>.005&&(e.inertialAlphaOffset+=i)}if(0!=t.y){const i=t.y/this.gamepadRotationSensibility*this._yAxisScale;0!=i&&Math.abs(i)>.005&&(e.inertialBetaOffset+=i)}}const i=this.gamepad.leftStick;if(i&&0!=i.y){const e=i.y/this.gamepadMoveSensibility;0!=e&&Math.abs(e)>.005&&(this.camera.inertialRadiusOffset-=e)}}}getClassName(){return"ArcRotateCameraGamepadInput"}getSimpleName(){return"gamepad"}}(0,s.Cg)([(0,n.lK)()],ws.prototype,"gamepadRotationSensibility",void 0),(0,s.Cg)([(0,n.lK)()],ws.prototype,"gamepadMoveSensibility",void 0),gt.ArcRotateCameraGamepadInput=ws,Object.defineProperty(Gt.Z.prototype,"gamepadManager",{get:function(){if(!this._gamepadManager){this._gamepadManager=new Os(this);let e=this._getComponent(Ue.v.NAME_GAMEPAD);e||(e=new Fs(this),this._addComponent(e))}return this._gamepadManager},enumerable:!0,configurable:!0}),os.prototype.addGamepad=function(){return this.add(new Ds),this},Ct.prototype.addGamepad=function(){return this.add(new ws),this};class Fs{constructor(e){this.name=Ue.v.NAME_GAMEPAD,this.scene=e}register(){this.scene._beforeCameraUpdateStage.registerStep(Ue.v.STEP_BEFORECAMERAUPDATE_GAMEPAD,this,this._beforeCameraUpdate)}rebuild(){}dispose(){const e=this.scene._gamepadManager;e&&(e.dispose(),this.scene._gamepadManager=null)}_beforeCameraUpdate(){const e=this.scene._gamepadManager;e&&e._isMonitoring&&e._checkGamepadsStatus()}}class Ls{get currentFrame(){return this._currentFrame}get weight(){return this._weight}get currentValue(){return this._currentValue}get targetPath(){return this._targetPath}get target(){return this._currentActiveTarget}get isAdditive(){return this._host&&this._host.isAdditive}constructor(e,t,i,r){if(this._events=new Array,this._currentFrame=0,this._originalValue=new Array,this._originalBlendValue=null,this._offsetsCache={},this._highLimitsCache={},this._stopped=!1,this._blendingFactor=0,this._currentValue=null,this._currentActiveTarget=null,this._directTarget=null,this._targetPath="",this._weight=1,this._absoluteFrameOffset=0,this._previousElapsedTime=0,this._yoyoDirection=1,this._previousAbsoluteFrame=0,this._targetIsArray=!1,this._animation=t,this._target=e,this._scene=i,this._host=r,this._activeTargets=[],t._runtimeAnimations.push(this),this._animationState={key:0,repeatCount:0,loopMode:this._getCorrectLoopMode()},this._animation.dataType===dt.ANIMATIONTYPE_MATRIX&&(this._animationState.workValue=o.uq.Zero()),this._keys=this._animation.getKeys(),this._minFrame=this._keys[0].frame,this._maxFrame=this._keys[this._keys.length-1].frame,this._minValue=this._keys[0].value,this._maxValue=this._keys[this._keys.length-1].value,0!==this._minFrame){const e={frame:0,value:this._minValue};this._keys.splice(0,0,e)}if(this._target instanceof Array){let e=0;for(const t of this._target)this._preparePath(t,e),this._getOriginalValues(e),e++;this._targetIsArray=!0}else this._preparePath(this._target),this._getOriginalValues(),this._targetIsArray=!1,this._directTarget=this._activeTargets[0];const s=t.getEvents();s&&s.length>0&&s.forEach((e=>{this._events.push(e._clone())})),this._enableBlending=e&&e.animationPropertiesOverride?e.animationPropertiesOverride.enableBlending:this._animation.enableBlending}_preparePath(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=this._animation.targetPropertyPath;if(i.length>1){let r=e;for(let e=0;e<i.length-1;e++){const t=i[e];if(r=r[t],void 0===r)throw new Error(`Invalid property (${t}) in property path (${i.join(".")})`)}this._targetPath=i[i.length-1],this._activeTargets[t]=r}else this._targetPath=i[0],this._activeTargets[t]=e;if(void 0===this._activeTargets[t][this._targetPath])throw new Error(`Invalid property (${this._targetPath}) in property path (${i.join(".")})`)}get animation(){return this._animation}reset(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])if(this._target instanceof Array){let e=0;for(const t of this._target)void 0!==this._originalValue[e]&&this._setValue(t,this._activeTargets[e],this._originalValue[e],-1,e),e++}else void 0!==this._originalValue[0]&&this._setValue(this._target,this._directTarget,this._originalValue[0],-1,0);this._offsetsCache={},this._highLimitsCache={},this._currentFrame=0,this._blendingFactor=0;for(let e=0;e<this._events.length;e++)this._events[e].isDone=!1}isStopped(){return this._stopped}dispose(){const e=this._animation.runtimeAnimations.indexOf(this);e>-1&&this._animation.runtimeAnimations.splice(e,1)}setValue(e,t){if(this._targetIsArray)for(let i=0;i<this._target.length;i++){const r=this._target[i];this._setValue(r,this._activeTargets[i],e,t,i)}else this._setValue(this._target,this._directTarget,e,t,0)}_getOriginalValues(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const i=this._activeTargets[t];e=i.getLocalMatrix&&"_matrix"===this._targetPath?i.getLocalMatrix():i[this._targetPath],e&&e.clone?this._originalValue[t]=e.clone():this._originalValue[t]=e}_setValue(e,t,i,r,s){if(this._currentActiveTarget=t,this._weight=r,this._enableBlending&&this._blendingFactor<=1){if(!this._originalBlendValue){const e=t[this._targetPath];e.clone?this._originalBlendValue=e.clone():this._originalBlendValue=e}this._originalBlendValue.m?dt.AllowMatrixDecomposeForInterpolation?this._currentValue?o.uq.DecomposeLerpToRef(this._originalBlendValue,i,this._blendingFactor,this._currentValue):this._currentValue=o.uq.DecomposeLerp(this._originalBlendValue,i,this._blendingFactor):this._currentValue?o.uq.LerpToRef(this._originalBlendValue,i,this._blendingFactor,this._currentValue):this._currentValue=o.uq.Lerp(this._originalBlendValue,i,this._blendingFactor):this._currentValue=dt._UniversalLerp(this._originalBlendValue,i,this._blendingFactor);const r=e&&e.animationPropertiesOverride?e.animationPropertiesOverride.blendingSpeed:this._animation.blendingSpeed;this._blendingFactor+=r}else this._currentValue?this._currentValue.copyFrom?this._currentValue.copyFrom(i):this._currentValue=i:this._currentValue=i?.clone?i.clone():i;-1!==r?this._scene._registerTargetForLateAnimationBinding(this,this._originalValue[s]):this._animationState.loopMode===dt.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT?this._currentValue.addToRef?this._currentValue.addToRef(this._originalValue[s],t[this._targetPath]):t[this._targetPath]=this._originalValue[s]+this._currentValue:t[this._targetPath]=this._currentValue,e.markAsDirty&&e.markAsDirty(this._animation.targetProperty)}_getCorrectLoopMode(){return this._target&&this._target.animationPropertiesOverride?this._target.animationPropertiesOverride.loopMode:this._animation.loopMode}goToFrame(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;const i=this._animation.getKeys();e<i[0].frame?e=i[0].frame:e>i[i.length-1].frame&&(e=i[i.length-1].frame);const r=this._events;if(r.length)for(let n=0;n<r.length;n++)r[n].onlyOnce||(r[n].isDone=r[n].frame<e);this._currentFrame=e;const s=this._animation._interpolate(e,this._animationState);this.setValue(s,t)}_prepareForSpeedRatioChange(e){const t=this._previousElapsedTime*(this._animation.framePerSecond*e)/1e3;this._absoluteFrameOffset=this._previousAbsoluteFrame-t}animate(e,t,i,r,s){let n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1;const a=this._animation,o=a.targetPropertyPath;if(!o||o.length<1)return this._stopped=!0,!1;let l=!0;(t<this._minFrame||t>this._maxFrame)&&(t=this._minFrame),(i<this._minFrame||i>this._maxFrame)&&(i=this._maxFrame);const h=i-t;let c,u=e*(a.framePerSecond*s)/1e3+this._absoluteFrameOffset,d=0,_=!1;const p=r&&this._animationState.loopMode===dt.ANIMATIONLOOPMODE_YOYO;if(p){const e=(u-t)/h,i=Math.sin(e*Math.PI);u=Math.abs(i)*h+t;const r=i>=0?1:-1;this._yoyoDirection!==r&&(_=!0),this._yoyoDirection=r}if(this._previousElapsedTime=e,this._previousAbsoluteFrame=u,!r&&i>=t&&(u>=h&&s>0||u<=0&&s<0))l=!1,d=a._getKeyValue(this._maxValue);else if(!r&&t>=i&&(u<=h&&s<0||u>=0&&s>0))l=!1,d=a._getKeyValue(this._minValue);else if(this._animationState.loopMode!==dt.ANIMATIONLOOPMODE_CYCLE){const e=i.toString()+t.toString();if(!this._offsetsCache[e]){this._animationState.repeatCount=0,this._animationState.loopMode=dt.ANIMATIONLOOPMODE_CYCLE;const r=a._interpolate(t,this._animationState),s=a._interpolate(i,this._animationState);switch(this._animationState.loopMode=this._getCorrectLoopMode(),a.dataType){case dt.ANIMATIONTYPE_FLOAT:this._offsetsCache[e]=s-r;break;case dt.ANIMATIONTYPE_QUATERNION:case dt.ANIMATIONTYPE_VECTOR3:case dt.ANIMATIONTYPE_VECTOR2:case dt.ANIMATIONTYPE_SIZE:case dt.ANIMATIONTYPE_COLOR3:this._offsetsCache[e]=s.subtract(r)}this._highLimitsCache[e]=s}d=this._highLimitsCache[e],c=this._offsetsCache[e]}if(void 0===c)switch(a.dataType){case dt.ANIMATIONTYPE_FLOAT:c=0;break;case dt.ANIMATIONTYPE_QUATERNION:c=nt;break;case dt.ANIMATIONTYPE_VECTOR3:c=at;break;case dt.ANIMATIONTYPE_VECTOR2:c=ot;break;case dt.ANIMATIONTYPE_SIZE:c=lt;break;case dt.ANIMATIONTYPE_COLOR3:c=ht;break;case dt.ANIMATIONTYPE_COLOR4:c=ct}let f;if(this._host&&this._host.syncRoot){const e=this._host.syncRoot;f=t+h*((e.masterFrame-e.fromFrame)/(e.toFrame-e.fromFrame))}else f=u>0&&t>i||u<0&&t<i?l&&0!==h?i+u%h:t:l&&0!==h?t+u%h:i;const g=this._events;if(!p&&(s>0&&this.currentFrame>f||s<0&&this.currentFrame<f)||p&&_){this._onLoop();for(let e=0;e<g.length;e++)g[e].onlyOnce||(g[e].isDone=!1);this._animationState.key=s>0?0:a.getKeys().length-1}this._currentFrame=f,this._animationState.repeatCount=0===h?0:u/h|0,this._animationState.highLimitValue=d,this._animationState.offsetValue=c;const m=a._interpolate(f,this._animationState);if(this.setValue(m,n),g.length)for(let b=0;b<g.length;b++)if(h>=0&&f>=g[b].frame&&g[b].frame>=t||h<0&&f<=g[b].frame&&g[b].frame<=t){const e=g[b];e.isDone||(e.onlyOnce&&(g.splice(b,1),b--),e.isDone=!0,e.action(f))}return l||(this._stopped=!0),l}}class Bs extends d{get _matrix(){return this._compose(),this._localMatrix}set _matrix(e){(e.updateFlag!==this._localMatrix.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this._localMatrix.copyFrom(e),this._markAsDirtyAndDecompose())}constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(e,t.getScene(),!1),this.name=e,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=t,this._localMatrix=r?.clone()??o.uq.Identity(),this._restMatrix=s??this._localMatrix.clone(),this._bindMatrix=n??this._localMatrix.clone(),this._index=a,this._absoluteMatrix=new o.uq,this._absoluteBindMatrix=new o.uq,this._absoluteInverseBindMatrix=new o.uq,this._finalMatrix=new o.uq,t.bones.push(this),this.setParent(i,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(e){this.setParent(e)}setParent(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==e){if(this.parent){const e=this.parent.children.indexOf(this);-1!==e&&this.parent.children.splice(e,1)}this._parentNode=e,this.parent&&this.parent.children.push(this),t&&this._updateAbsoluteBindMatrices(),this.markAsDirty()}}getLocalMatrix(){return this._compose(),this._localMatrix}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(e){this._restMatrix.copyFrom(e)}setRestPose(e){this.setRestMatrix(e)}getBindPose(){return this.getBindMatrix()}setBindMatrix(e){this.updateMatrix(e)}setBindPose(e){this.setBindMatrix(e)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const e=o.AA.Vector3[0],t=o.AA.Quaternion[0],i=o.AA.Vector3[1];this.getRestMatrix().decompose(e,t,i),this._linkedTransformNode.position.copyFrom(i),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??o.PT.Identity(),this._linkedTransformNode.rotationQuaternion.copyFrom(t),this._linkedTransformNode.scaling.copyFrom(e)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(e){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=e,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this._localPosition}set position(e){this._decompose(),this._localPosition.copyFrom(e),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(e){this.setRotation(e)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(e){this.setRotationQuaternion(e)}get scaling(){return this.getScale()}set scaling(e){this.setScale(e)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=o.Pq.Zero(),this._localRotation=o.PT.Zero(),this._localPosition=o.Pq.Zero()),this._localMatrix.decompose(this._localScaling,this._localRotation,this._localPosition))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,o.uq.ComposeToRef(this._localScaling,this._localRotation,this._localPosition,this._localMatrix)):this._needToCompose=!1)}updateMatrix(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.copyFrom(e),t&&this._updateAbsoluteBindMatrices(),i?this._matrix=e:this.markAsDirty()}_updateAbsoluteBindMatrices(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e||(e=this._bindMatrix),this.parent?e.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.copyFrom(e),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),t)for(let i=0;i<this.children.length;i++)this.children[i]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}markAsDirty(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.markAsDirty(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.markAsDirty(),this._needToDecompose=!0}_updatePosition(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const s=this.getLocalMatrix();if(0==t)r?(s.addAtIndex(12,e.x),s.addAtIndex(13,e.y),s.addAtIndex(14,e.z)):s.setTranslationFromFloats(e.x,e.y,e.z);else{let t=null;i&&(t=i.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const n=Bs._TmpMats[0],a=Bs._TmpVecs[0];this.parent?i&&t?(n.copyFrom(this.parent.getAbsoluteMatrix()),n.multiplyToRef(t,n)):n.copyFrom(this.parent.getAbsoluteMatrix()):o.uq.IdentityToRef(n),r&&n.setTranslationFromFloats(0,0,0),n.invert(),o.Pq.TransformCoordinatesToRef(e,n,a),r?(s.addAtIndex(12,a.x),s.addAtIndex(13,a.y),s.addAtIndex(14,a.z)):s.setTranslationFromFloats(a.x,a.y,a.z)}this._markAsDirtyAndDecompose()}translate(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;this._updatePosition(e,t,i,!0)}setPosition(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;this._updatePosition(e,t,i,!1)}setAbsolutePosition(e,t){this.setPosition(e,1,t)}scale(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const s=this.getLocalMatrix(),n=Bs._TmpMats[0];o.uq.ScalingToRef(e,t,i,n),n.multiplyToRef(s,s),n.invert();for(const a of this.children){const r=a.getLocalMatrix();r.multiplyToRef(n,r),r.multiplyAtIndex(12,e),r.multiplyAtIndex(13,t),r.multiplyAtIndex(14,i),a._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),r)for(const a of this.children)a.scale(e,t,i,r)}setScale(e){this._decompose(),this._localScaling.copyFrom(e),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(e){this._decompose(),e.copyFrom(this._localScaling)}setYawPitchRoll(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4?arguments[4]:void 0;if(0===r){const n=Bs._TmpQuat;return o.PT.RotationYawPitchRollToRef(e,t,i,n),void this.setRotationQuaternion(n,r,s)}const n=Bs._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(n,s))return;const a=Bs._TmpMats[1];o.uq.RotationYawPitchRollToRef(e,t,i,a),n.multiplyToRef(a,a),this._rotateWithMatrix(a,r,s)}rotate(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0;const s=Bs._TmpMats[0];s.setTranslationFromFloats(0,0,0),o.uq.RotationAxisToRef(e,t,s),this._rotateWithMatrix(s,i,r)}setAxisAngle(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0;if(0===i){const s=Bs._TmpQuat;return o.PT.RotationAxisToRef(e,t,s),void this.setRotationQuaternion(s,i,r)}const s=Bs._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(s,r))return;const n=Bs._TmpMats[1];o.uq.RotationAxisToRef(e,t,n),s.multiplyToRef(n,n),this._rotateWithMatrix(n,i,r)}setRotation(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(e.y,e.x,e.z,t,i)}setRotationQuaternion(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;if(0===t)return this._decompose(),this._localRotation.copyFrom(e),void this._markAsDirtyAndCompose();const r=Bs._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(r,i))return;const s=Bs._TmpMats[1];o.uq.FromQuaternionToRef(e,s),r.multiplyToRef(s,s),this._rotateWithMatrix(s,t,i)}setRotationMatrix(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;if(0===t){const r=Bs._TmpQuat;return o.PT.FromRotationMatrixToRef(e,r),void this.setRotationQuaternion(r,t,i)}const r=Bs._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(r,i))return;const s=Bs._TmpMats[1];s.copyFrom(e),r.multiplyToRef(e,s),this._rotateWithMatrix(s,t,i)}_rotateWithMatrix(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;const r=this.getLocalMatrix(),s=r.m[12],n=r.m[13],a=r.m[14],o=this.getParent(),l=Bs._TmpMats[3],h=Bs._TmpMats[4];o&&1==t?(i?(l.copyFrom(i.getWorldMatrix()),o.getAbsoluteMatrix().multiplyToRef(l,l)):l.copyFrom(o.getAbsoluteMatrix()),h.copyFrom(l),h.invert(),r.multiplyToRef(l,r),r.multiplyToRef(e,r),r.multiplyToRef(h,r)):1==t&&i?(l.copyFrom(i.getWorldMatrix()),h.copyFrom(l),h.invert(),r.multiplyToRef(l,r),r.multiplyToRef(e,r),r.multiplyToRef(h,r)):r.multiplyToRef(e,r),r.setTranslationFromFloats(s,n,a),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(e,t){const i=Bs._TmpMats[2];return e.copyFrom(this.getAbsoluteMatrix()),t?(e.multiplyToRef(t.getWorldMatrix(),e),o.uq.ScalingToRef(t.scaling.x,t.scaling.y,t.scaling.z,i)):o.uq.IdentityToRef(i),e.invert(),!isNaN(e.m[0])&&(i.multiplyAtIndex(0,this._scalingDeterminant),e.multiplyToRef(i,e),!0)}getPosition(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=o.Pq.Zero();return this.getPositionToRef(e,t,i),i}getPositionToRef(){let e=arguments.length>1?arguments[1]:void 0,t=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const e=this.getLocalMatrix();t.x=e.m[12],t.y=e.m[13],t.z=e.m[14]}else{let i=null;e&&(i=e.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let r=Bs._TmpMats[0];e&&i?(r.copyFrom(this.getAbsoluteMatrix()),r.multiplyToRef(i,r)):r=this.getAbsoluteMatrix(),t.x=r.m[12],t.y=r.m[13],t.z=r.m[14]}}getAbsolutePosition(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const t=o.Pq.Zero();return this.getPositionToRef(1,e,t),t}getAbsolutePositionToRef(e,t){this.getPositionToRef(1,e,t)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this._localMatrix.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.copyFrom(this._localMatrix);const e=this._skeleton.getPoseMatrix();e&&this._absoluteMatrix.multiplyToRef(e,this._absoluteMatrix)}const e=this.children,t=e.length;for(let i=0;i<t;i++)e[i].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}getDirection(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=o.Pq.Zero();return this.getDirectionToRef(e,t,i),i}getDirectionToRef(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0,r=null;t&&(r=t.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const s=Bs._TmpMats[0];s.copyFrom(this.getAbsoluteMatrix()),t&&r&&s.multiplyToRef(r,s),o.Pq.TransformNormalToRef(e,s,i),i.normalize()}getRotation(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=o.Pq.Zero();return this.getRotationToRef(e,t,i),i}getRotationToRef(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0;const r=Bs._TmpQuat;this.getRotationQuaternionToRef(e,t,r),r.toEulerAnglesToRef(i)}getRotationQuaternion(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=o.PT.Identity();return this.getRotationQuaternionToRef(e,t,i),i}getRotationQuaternionToRef(){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,t=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),t.copyFrom(this._localRotation);else{const i=Bs._TmpMats[0],r=this.getAbsoluteMatrix();e?r.multiplyToRef(e.getWorldMatrix(),i):i.copyFrom(r),i.multiplyAtIndex(0,this._scalingDeterminant),i.multiplyAtIndex(1,this._scalingDeterminant),i.multiplyAtIndex(2,this._scalingDeterminant),i.decompose(void 0,t,void 0)}}getRotationMatrix(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;const i=o.uq.Identity();return this.getRotationMatrixToRef(e,t,i),i}getRotationMatrixToRef(){let e=arguments.length>1?arguments[1]:void 0,t=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(t);else{const i=Bs._TmpMats[0],r=this.getAbsoluteMatrix();e?r.multiplyToRef(e.getWorldMatrix(),i):i.copyFrom(r),i.multiplyAtIndex(0,this._scalingDeterminant),i.multiplyAtIndex(1,this._scalingDeterminant),i.multiplyAtIndex(2,this._scalingDeterminant),i.getRotationMatrixToRef(t)}}getAbsolutePositionFromLocal(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=o.Pq.Zero();return this.getAbsolutePositionFromLocalToRef(e,t,i),i}getAbsolutePositionFromLocalToRef(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0,r=null;t&&(r=t.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const s=Bs._TmpMats[0];s.copyFrom(this.getAbsoluteMatrix()),t&&r&&s.multiplyToRef(r,s),o.Pq.TransformCoordinatesToRef(e,s,i)}getLocalPositionFromAbsolute(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=o.Pq.Zero();return this.getLocalPositionFromAbsoluteToRef(e,t,i),i}getLocalPositionFromAbsoluteToRef(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0,r=null;t&&(r=t.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const s=Bs._TmpMats[0];s.copyFrom(this.getAbsoluteMatrix()),t&&r&&s.multiplyToRef(r,s),s.invert(),o.Pq.TransformCoordinatesToRef(e,s,i)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}}Bs._TmpVecs=(0,I.mI)(2,o.Pq.Zero),Bs._TmpQuat=o.PT.Identity(),Bs._TmpMats=(0,I.mI)(5,o.uq.Identity);class Ns{get syncRoot(){return this._syncRoot}get masterFrame(){return 0===this._runtimeAnimations.length?0:this._runtimeAnimations[0].currentFrame}get weight(){return this._weight}set weight(e){this._weight=-1!==e?Math.min(Math.max(e,0),1):-1}get speedRatio(){return this._speedRatio}set speedRatio(e){for(let t=0;t<this._runtimeAnimations.length;t++){this._runtimeAnimations[t]._prepareForSpeedRatioChange(e)}this._speedRatio=e,null!==this._goToFrame&&this.goToFrame(this._goToFrame)}get elapsedTime(){return null===this._localDelayOffset?0:this._scene._animationTime-this._localDelayOffset}constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6?arguments[6]:void 0,l=arguments.length>7?arguments[7]:void 0,h=arguments.length>8?arguments[8]:void 0,c=arguments.length>9&&void 0!==arguments[9]&&arguments[9],u=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0;this.target=t,this.fromFrame=i,this.toFrame=r,this.loopAnimation=s,this.onAnimationEnd=o,this.onAnimationLoop=h,this.isAdditive=c,this.playOrder=u,this._localDelayOffset=null,this._pausedDelay=null,this._manualJumpDelay=null,this._runtimeAnimations=new Array,this._paused=!1,this._speedRatio=1,this._weight=-1,this._syncRoot=null,this._frameToSyncFromJump=null,this._goToFrame=null,this.disposeOnEnd=!0,this.animationStarted=!1,this.onAnimationEndObservable=new a.cP,this.onAnimationLoopObservable=new a.cP,this._scene=e,l&&this.appendAnimations(t,l),this._speedRatio=n,e._activeAnimatables.push(this)}syncWith(e){if(this._syncRoot=e,e){const e=this._scene._activeAnimatables.indexOf(this);e>-1&&(this._scene._activeAnimatables.splice(e,1),this._scene._activeAnimatables.push(this))}return this}getAnimations(){return this._runtimeAnimations}appendAnimations(e,t){for(let i=0;i<t.length;i++){const r=t[i],s=new Ls(e,r,this._scene,this);s._onLoop=()=>{this.onAnimationLoopObservable.notifyObservers(this),this.onAnimationLoop&&this.onAnimationLoop()},this._runtimeAnimations.push(s)}}getAnimationByTargetProperty(e){const t=this._runtimeAnimations;for(let i=0;i<t.length;i++)if(t[i].animation.targetProperty===e)return t[i].animation;return null}getRuntimeAnimationByTargetProperty(e){const t=this._runtimeAnimations;for(let i=0;i<t.length;i++)if(t[i].animation.targetProperty===e)return t[i];return null}reset(){const e=this._runtimeAnimations;for(let t=0;t<e.length;t++)e[t].reset(!0);this._localDelayOffset=null,this._pausedDelay=null}enableBlending(e){const t=this._runtimeAnimations;for(let i=0;i<t.length;i++)t[i].animation.enableBlending=!0,t[i].animation.blendingSpeed=e}disableBlending(){const e=this._runtimeAnimations;for(let t=0;t<e.length;t++)e[t].animation.enableBlending=!1}goToFrame(e){const t=this._runtimeAnimations;if(t[0]){const i=t[0].animation.framePerSecond;this._frameToSyncFromJump=this._frameToSyncFromJump??t[0].currentFrame;const r=0===this.speedRatio?0:(e-this._frameToSyncFromJump)/i*1e3/this.speedRatio;this._manualJumpDelay=-r}for(let i=0;i<t.length;i++)t[i].goToFrame(e,this._weight);this._goToFrame=e}get paused(){return this._paused}pause(){this._paused||(this._paused=!0)}restart(){this._paused=!1}_raiseOnAnimationEnd(){this.onAnimationEnd&&this.onAnimationEnd(),this.onAnimationEndObservable.notifyObservers(this)}stop(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e||t){const s=this._scene._activeAnimatables.indexOf(this);if(s>-1){const n=this._runtimeAnimations;for(let i=n.length-1;i>=0;i--){const r=n[i];e&&r.animation.name!=e||(t&&!t(r.target)||(r.dispose(),n.splice(i,1)))}0==n.length&&(i||this._scene._activeAnimatables.splice(s,1),r||this._raiseOnAnimationEnd())}}else{const e=this._scene._activeAnimatables.indexOf(this);if(e>-1){i||this._scene._activeAnimatables.splice(e,1);const t=this._runtimeAnimations;for(let e=0;e<t.length;e++)t[e].dispose();this._runtimeAnimations.length=0,r||this._raiseOnAnimationEnd()}}}waitAsync(){return new Promise((e=>{this.onAnimationEndObservable.add((()=>{e(this)}),void 0,void 0,this,!0)}))}_animate(e){if(this._paused)return this.animationStarted=!1,null===this._pausedDelay&&(this._pausedDelay=e),!0;if(null===this._localDelayOffset?(this._localDelayOffset=e,this._pausedDelay=null):null!==this._pausedDelay&&(this._localDelayOffset+=e-this._pausedDelay,this._pausedDelay=null),null!==this._manualJumpDelay&&(this._localDelayOffset+=this._manualJumpDelay,this._manualJumpDelay=null,this._frameToSyncFromJump=null),this._goToFrame=null,0===this._weight)return!0;let t=!1;const i=this._runtimeAnimations;let r;for(r=0;r<i.length;r++){const s=i[r].animate(e-this._localDelayOffset,this.fromFrame,this.toFrame,this.loopAnimation,this._speedRatio,this._weight);t=t||s}if(this.animationStarted=t,!t){if(this.disposeOnEnd)for(r=this._scene._activeAnimatables.indexOf(this),this._scene._activeAnimatables.splice(r,1),r=0;r<i.length;r++)i[r].dispose();this._raiseOnAnimationEnd(),this.disposeOnEnd&&(this.onAnimationEnd=null,this.onAnimationLoop=null,this.onAnimationLoopObservable.clear(),this.onAnimationEndObservable.clear())}return t}}Gt.Z.prototype._animate=function(e){if(!this.animationsEnabled)return;const t=Ye.j.Now;if(!this._animationTimeLast){if(this._pendingData.length>0)return;this._animationTimeLast=t}this.deltaTime=void 0!==e?e:this.useConstantAnimationDeltaTime?16:(t-this._animationTimeLast)*this.animationTimeScale,this._animationTimeLast=t;const i=this._activeAnimatables;if(0===i.length)return;this._animationTime+=this.deltaTime;const r=this._animationTime;for(let s=0;s<i.length;s++){const e=i[s];!e._animate(r)&&e.disposeOnEnd&&s--}this._processLateAnimationBindings()},Gt.Z.prototype.sortActiveAnimatables=function(){this._activeAnimatables.sort(((e,t)=>e.playOrder-t.playOrder))},Gt.Z.prototype.beginWeightedAnimation=function(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4?arguments[4]:void 0,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,a=arguments.length>6?arguments[6]:void 0,o=arguments.length>7?arguments[7]:void 0,l=arguments.length>8?arguments[8]:void 0,h=arguments.length>9?arguments[9]:void 0,c=arguments.length>10&&void 0!==arguments[10]&&arguments[10];const u=this.beginAnimation(e,t,i,s,n,a,o,!1,l,h,c);return u.weight=r,u},Gt.Z.prototype.beginAnimation=function(e,t,i,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,n=arguments.length>5?arguments[5]:void 0,a=arguments.length>6?arguments[6]:void 0,o=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],l=arguments.length>8?arguments[8]:void 0,h=arguments.length>9?arguments[9]:void 0,c=arguments.length>10&&void 0!==arguments[10]&&arguments[10];if(s<0){const e=t;t=i,i=e,s=-s}t>i&&(s=-s),o&&this.stopAnimation(e,void 0,l),a||(a=new Ns(this,e,t,i,r,s,n,void 0,h,c));const u=!l||l(e);if(e.animations&&u&&a.appendAnimations(e,e.animations),e.getAnimatables){const c=e.getAnimatables();for(let e=0;e<c.length;e++)this.beginAnimation(c[e],t,i,r,s,n,a,o,l,h)}return a.reset(),a},Gt.Z.prototype.beginHierarchyAnimation=function(e,t,i,r,s){let n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,a=arguments.length>6?arguments[6]:void 0,o=arguments.length>7?arguments[7]:void 0,l=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],h=arguments.length>9?arguments[9]:void 0,c=arguments.length>11&&void 0!==arguments[11]&&arguments[11];const u=e.getDescendants(t),d=[];d.push(this.beginAnimation(e,i,r,s,n,a,o,l,h,void 0,c));for(const _ of u)d.push(this.beginAnimation(_,i,r,s,n,a,o,l,h,void 0,c));return d},Gt.Z.prototype.beginDirectAnimation=function(e,t,i,r,s){let n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;if(n<0){const e=i;i=r,r=e,n=-n}i>r&&(n=-n);return new Ns(this,e,i,r,s,n,arguments.length>6?arguments[6]:void 0,t,arguments.length>7?arguments[7]:void 0,arguments.length>8&&void 0!==arguments[8]&&arguments[8])},Gt.Z.prototype.beginDirectHierarchyAnimation=function(e,t,i,r,s,n,a,o,l){let h=arguments.length>9&&void 0!==arguments[9]&&arguments[9];const c=e.getDescendants(t),u=[];u.push(this.beginDirectAnimation(e,i,r,s,n,a,o,l,h));for(const d of c)u.push(this.beginDirectAnimation(d,i,r,s,n,a,o,l,h));return u},Gt.Z.prototype.getAnimatableByTarget=function(e){for(let t=0;t<this._activeAnimatables.length;t++)if(this._activeAnimatables[t].target===e)return this._activeAnimatables[t];return null},Gt.Z.prototype.getAllAnimatablesByTarget=function(e){const t=[];for(let i=0;i<this._activeAnimatables.length;i++)this._activeAnimatables[i].target===e&&t.push(this._activeAnimatables[i]);return t},Gt.Z.prototype.stopAnimation=function(e,t,i){const r=this.getAllAnimatablesByTarget(e);for(const s of r)s.stop(t,i)},Gt.Z.prototype.stopAllAnimations=function(){if(this._activeAnimatables){for(let e=0;e<this._activeAnimatables.length;e++)this._activeAnimatables[e].stop(void 0,void 0,!0);this._activeAnimatables.length=0}for(const e of this.animationGroups)e.stop()},Gt.Z.prototype._registerTargetForLateAnimationBinding=function(e,t){const i=e.target;this._registeredForLateAnimationBindings.pushNoDuplicate(i),i._lateAnimationHolders||(i._lateAnimationHolders={}),i._lateAnimationHolders[e.targetPath]||(i._lateAnimationHolders[e.targetPath]={totalWeight:0,totalAdditiveWeight:0,animations:[],additiveAnimations:[],originalValue:t}),e.isAdditive?(i._lateAnimationHolders[e.targetPath].additiveAnimations.push(e),i._lateAnimationHolders[e.targetPath].totalAdditiveWeight+=e.weight):(i._lateAnimationHolders[e.targetPath].animations.push(e),i._lateAnimationHolders[e.targetPath].totalWeight+=e.weight)},Gt.Z.prototype._processLateAnimationBindingsForMatrices=function(e){if(0===e.totalWeight&&0===e.totalAdditiveWeight)return e.originalValue;let t=1;const i=o.AA.Vector3[0],r=o.AA.Vector3[1],s=o.AA.Quaternion[0];let n=0;const a=e.animations[0],l=e.originalValue;let h=1,c=!1;if(e.totalWeight<1)h=1-e.totalWeight,l.decompose(r,s,i);else{if(n=1,t=e.totalWeight,h=a.weight/t,1==h){if(!e.totalAdditiveWeight)return a.currentValue;c=!0}a.currentValue.decompose(r,s,i)}if(!c){r.scaleInPlace(h),i.scaleInPlace(h),s.scaleInPlace(h);for(let a=n;a<e.animations.length;a++){const n=e.animations[a];if(0===n.weight)continue;h=n.weight/t;const l=o.AA.Vector3[2],c=o.AA.Vector3[3],u=o.AA.Quaternion[1];n.currentValue.decompose(c,u,l),c.scaleAndAddToRef(h,r),u.scaleAndAddToRef(o.PT.Dot(s,u)>0?h:-h,s),l.scaleAndAddToRef(h,i)}s.normalize()}for(let d=0;d<e.additiveAnimations.length;d++){const t=e.additiveAnimations[d];if(0===t.weight)continue;const n=o.AA.Vector3[2],a=o.AA.Vector3[3],l=o.AA.Quaternion[1];t.currentValue.decompose(a,l,n),a.multiplyToRef(r,a),o.Pq.LerpToRef(r,a,t.weight,r),s.multiplyToRef(l,l),o.PT.SlerpToRef(s,l,t.weight,s),n.scaleAndAddToRef(t.weight,i)}const u=a?a._animationState.workValue:o.AA.Matrix[0].clone();return o.uq.ComposeToRef(r,s,i,u),u},Gt.Z.prototype._processLateAnimationBindingsForQuaternions=function(e,t){if(0===e.totalWeight&&0===e.totalAdditiveWeight)return t;const i=e.animations[0],r=e.originalValue;let s=t;if(0===e.totalWeight&&e.totalAdditiveWeight>0)s.copyFrom(r);else if(1===e.animations.length){if(o.PT.SlerpToRef(r,i.currentValue,Math.min(1,e.totalWeight),s),0===e.totalAdditiveWeight)return s}else if(e.animations.length>1){let i,n,a=1;if(e.totalWeight<1){const t=1-e.totalWeight;i=[],n=[],i.push(r),n.push(t)}else{if(2===e.animations.length&&(o.PT.SlerpToRef(e.animations[0].currentValue,e.animations[1].currentValue,e.animations[1].weight/e.totalWeight,t),0===e.totalAdditiveWeight))return t;i=[],n=[],a=e.totalWeight}for(let t=0;t<e.animations.length;t++){const r=e.animations[t];i.push(r.currentValue),n.push(r.weight/a)}let l=0;for(let e=0;e<i.length;)e?(l+=n[e],o.PT.SlerpToRef(s,i[e],n[e]/l,s),e++):(o.PT.SlerpToRef(i[e],i[e+1],n[e+1]/(n[e]+n[e+1]),t),s=t,l=n[e]+n[e+1],e+=2)}for(let n=0;n<e.additiveAnimations.length;n++){const t=e.additiveAnimations[n];0!==t.weight&&(s.multiplyToRef(t.currentValue,o.AA.Quaternion[0]),o.PT.SlerpToRef(s,o.AA.Quaternion[0],t.weight,s))}return s},Gt.Z.prototype._processLateAnimationBindings=function(){if(this._registeredForLateAnimationBindings.length){for(let e=0;e<this._registeredForLateAnimationBindings.length;e++){const t=this._registeredForLateAnimationBindings.data[e];for(const e in t._lateAnimationHolders){const i=t._lateAnimationHolders[e],r=i.animations[0],s=i.originalValue;if(void 0===s||null===s)continue;const n=dt.AllowMatrixDecomposeForInterpolation&&s.m;let a=t[e];if(n)a=this._processLateAnimationBindingsForMatrices(i);else{if(void 0!==s.w)a=this._processLateAnimationBindingsForQuaternions(i,a||o.PT.Identity());else{let e=0,t=1;const n=r&&r._animationState.loopMode===dt.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT;if(i.totalWeight<1)a=n?s.clone?s.clone():s:r&&s.scale?s.scale(1-i.totalWeight):r?s*(1-i.totalWeight):s.clone?s.clone():s;else if(r){t=i.totalWeight;const o=r.weight/t;a=1!==o?r.currentValue.scale?r.currentValue.scale(o):r.currentValue*o:r.currentValue,n&&(a.addToRef?a.addToRef(s,a):a+=s),e=1}for(let r=e;r<i.animations.length;r++){const e=i.animations[r],s=e.weight/t;s&&(e.currentValue.scaleAndAddToRef?e.currentValue.scaleAndAddToRef(s,a):a+=e.currentValue*s)}for(let r=0;r<i.additiveAnimations.length;r++){const e=i.additiveAnimations[r],t=e.weight;t&&(e.currentValue.scaleAndAddToRef?e.currentValue.scaleAndAddToRef(t,a):a+=e.currentValue*t)}}}t[e]=a}t._lateAnimationHolders={}}this._registeredForLateAnimationBindings.reset()}},Bs.prototype.copyAnimationRange=function(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;0===this.animations.length&&(this.animations.push(new dt(this.name,"_matrix",e.animations[0].framePerSecond,dt.ANIMATIONTYPE_MATRIX,0)),this.animations[0].setKeys([]));const n=e.animations[0].getRange(t);if(!n)return!1;const a=n.from,o=n.to,l=e.animations[0].getKeys(),h=e.length,c=e.getParent(),u=this.getParent(),d=r&&c&&h&&this.length&&h!==this.length,_=d&&u&&c?u.length/c.length:1,p=r&&!u&&s&&(1!==s.x||1!==s.y||1!==s.z),f=this.animations[0].getKeys();let g,m,b;for(let v=0,y=l.length;v<y;v++)g=l[v],g.frame>=a&&g.frame<=o&&(r?(b=g.value.clone(),d?(m=b.getTranslation(),b.setTranslation(m.scaleInPlace(_))):p&&s?(m=b.getTranslation(),b.setTranslation(m.multiplyInPlace(s))):b=g.value):b=g.value,f.push({frame:g.frame+i,value:b}));return this.animations[0].createRange(t,a+i,o+i),!0};class ks{get isFixedFoveationSupported(){return"XRWebGLLayer"==this.layerType&&"number"==typeof this.layer.fixedFoveation}get fixedFoveation(){return this.isFixedFoveationSupported?this.layer.fixedFoveation:null}set fixedFoveation(e){if(this.isFixedFoveationSupported){const t=Math.max(0,Math.min(1,e||0));this.layer.fixedFoveation=t}}createRenderTargetTextureProvider(e){return this._rttWrapper=this._createRenderTargetTextureProvider(e),this._rttWrapper}dispose(){this._rttWrapper&&(this._rttWrapper.dispose(),this._rttWrapper=null)}constructor(e,t,i,r,s){this.getWidth=e,this.getHeight=t,this.layer=i,this.layerType=r,this._createRenderTargetTextureProvider=s,this._rttWrapper=null}}class Us{constructor(e,t){this._scene=e,this.layerWrapper=t,this._renderTargetTextures=new Array,this._engine=e.getEngine()}_createInternalTexture(e,t){const i=new Et.h(this._engine,0,!0);return i.width=e.width,i.height=e.height,i._hardwareTexture=new Ot.d(t,this._engine._gl),i.isReady=!0,i}_createRenderTargetTexture(e,t,i,r,s,n){if(!this._engine)throw new Error("Engine is disposed");const a={width:e,height:t},o=n?new fs(this._scene,a):new qr.$("XR renderTargetTexture",a,this._scene),l=o.renderTarget;if(l._samples=o.samples,!i&&r||(l._framebuffer=i),r)if(n)l._colorTextureArray=r;else{const e=this._createInternalTexture(a,r);l.setTexture(e,0),o._texture=e}return s&&(n?l._depthStencilTextureArray=s:l._depthStencilTexture=this._createInternalTexture(a,s)),o.disableRescaling(),this._renderTargetTextures.push(o),o}_destroyRenderTargetTexture(e){this._renderTargetTextures.splice(this._renderTargetTextures.indexOf(e),1),e.dispose()}getFramebufferDimensions(){return this._framebufferDimensions}dispose(){this._renderTargetTextures.forEach((e=>e.dispose())),this._renderTargetTextures.length=0}}class Vs extends ks{constructor(e){super((()=>e.framebufferWidth),(()=>e.framebufferHeight),e,"XRWebGLLayer",(e=>new zs(e.scene,this))),this.layer=e}}class zs extends Us{constructor(e,t){super(e,t),this.layerWrapper=t,this._layer=t.layer,this._framebufferDimensions={framebufferWidth:this._layer.framebufferWidth,framebufferHeight:this._layer.framebufferHeight}}trySetViewportForView(e,t){const i=this._layer.getViewport(t);if(!i)return!1;const r=this._framebufferDimensions.framebufferWidth,s=this._framebufferDimensions.framebufferHeight;return e.x=i.x/r,e.y=i.y/s,e.width=i.width/r,e.height=i.height/s,!0}getRenderTargetTextureForEye(e){const t=this._layer.framebufferWidth,i=this._layer.framebufferHeight,r=this._layer.framebuffer;return this._rtt&&t===this._framebufferDimensions.framebufferWidth&&i===this._framebufferDimensions.framebufferHeight&&r===this._framebuffer||(this._rtt=this._createRenderTargetTexture(t,i,r),this._framebufferDimensions.framebufferWidth=t,this._framebufferDimensions.framebufferHeight=i,this._framebuffer=r),this._rtt}getRenderTargetTextureForView(e){return this.getRenderTargetTextureForEye(e.eye)}}class Gs{static GetDefaults(e){const t=new Gs;return t.canvasOptions={antialias:!0,depth:!0,stencil:!e||e.isStencilEnable,alpha:!0,framebufferScaleFactor:1},t.newCanvasCssStyle="position:absolute; bottom:0px;right:0px;z-index:10;width:90%;height:100%;background-color: #000000;",t}}class Hs{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Gs.GetDefaults();if(this._options=t,this._canvas=null,this._engine=null,this.xrLayer=null,this._xrLayerWrapper=null,this.onXRLayerInitObservable=new a.cP,this._engine=e.scene.getEngine(),this._engine.onDisposeObservable.addOnce((()=>{this._engine=null})),t.canvasElement)this._setManagedOutputCanvas(t.canvasElement);else{const e=document.createElement("canvas");e.style.cssText=this._options.newCanvasCssStyle||"position:absolute; bottom:0px;right:0px;",this._setManagedOutputCanvas(e)}e.onXRSessionInit.add((()=>{this._addCanvas()})),e.onXRSessionEnded.add((()=>{this._removeCanvas()})),this._makeCanvasCompatibleAsync()}dispose(){this._removeCanvas(),this._setManagedOutputCanvas(null)}_makeCanvasCompatibleAsync(){this._canvasCompatiblePromise=new Promise(((e,t)=>{try{this.canvasContext&&this.canvasContext.makeXRCompatible?this.canvasContext.makeXRCompatible().then((()=>{e()}),(()=>{_.S0.Warn("Error executing makeXRCompatible. This does not mean that the session will work incorrectly."),e()})):e()}catch(Qp){t(Qp)}}))}async initializeXRLayerAsync(e){const t=()=>(this.xrLayer=new XRWebGLLayer(e,this.canvasContext,this._options.canvasOptions),this._xrLayerWrapper=new Vs(this.xrLayer),this.onXRLayerInitObservable.notifyObservers(this.xrLayer),this.xrLayer);return this._canvasCompatiblePromise.then((()=>{}),(()=>{})).then((()=>t()))}_addCanvas(){this._canvas&&this._engine&&this._canvas!==this._engine.getRenderingCanvas()&&document.body.appendChild(this._canvas),this.xrLayer?this._setCanvasSize(!0):this.onXRLayerInitObservable.addOnce((()=>{this._setCanvasSize(!0)}))}_removeCanvas(){this._canvas&&this._engine&&document.body.contains(this._canvas)&&this._canvas!==this._engine.getRenderingCanvas()&&document.body.removeChild(this._canvas),this._setCanvasSize(!1)}_setCanvasSize(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._xrLayerWrapper;this._canvas&&this._engine&&(e?t&&(this._canvas!==this._engine.getRenderingCanvas()?(this._canvas.style.width=t.getWidth()+"px",this._canvas.style.height=t.getHeight()+"px"):this._engine.setSize(t.getWidth(),t.getHeight())):this._originalCanvasSize&&(this._canvas!==this._engine.getRenderingCanvas()?(this._canvas.style.width=this._originalCanvasSize.width+"px",this._canvas.style.height=this._originalCanvasSize.height+"px"):this._engine.setSize(this._originalCanvasSize.width,this._originalCanvasSize.height)))}_setManagedOutputCanvas(e){this._removeCanvas(),e?(this._originalCanvasSize={width:e.offsetWidth,height:e.offsetHeight},this._canvas=e,this.canvasContext=this._canvas.getContext("webgl2"),this.canvasContext||(this.canvasContext=this._canvas.getContext("webgl"))):(this._canvas=null,this.canvasContext=null)}}class Ws extends ks{constructor(e){super((()=>e.framebufferWidth),(()=>e.framebufferHeight),e,"XRWebGLLayer",(e=>new qs(e,this))),this.layer=e}}class qs extends Us{constructor(e,t){super(e.scene,t),this.layerWrapper=t,this._nativeRTTProvider=navigator.xr.getNativeRenderTargetProvider(e.session,this._createRenderTargetTexture.bind(this),this._destroyRenderTargetTexture.bind(this)),this._nativeLayer=t.layer}trySetViewportForView(e){return e.x=0,e.y=0,e.width=1,e.height=1,!0}getRenderTargetTextureForEye(e){return this._nativeRTTProvider.getRenderTargetForEye(e)}getRenderTargetTextureForView(e){return this._nativeRTTProvider.getRenderTargetForEye(e.eye)}getFramebufferDimensions(){return{framebufferWidth:this._nativeLayer.framebufferWidth,framebufferHeight:this._nativeLayer.framebufferHeight}}}class Xs{constructor(e){this._nativeRenderTarget=navigator.xr.getWebXRRenderTarget(e.scene.getEngine())}async initializeXRLayerAsync(e){return await this._nativeRenderTarget.initializeXRLayerAsync(e),this.xrLayer=this._nativeRenderTarget.xrLayer,this.xrLayer}dispose(){}}class Ks{get worldScalingFactor(){return this._worldScalingFactor}set worldScalingFactor(e){const t=this._worldScalingFactor;this._worldScalingFactor=e,this.onWorldScaleFactorChangedObservable.notifyObservers({previousScaleFactor:t,newScaleFactor:e})}constructor(e){this.scene=e,this.currentTimestamp=-1,this.defaultHeightCompensation=1.7,this.onXRFrameObservable=new a.cP,this.onXRReferenceSpaceChanged=new a.cP,this.onXRSessionEnded=new a.cP,this.onXRSessionInit=new a.cP,this.onXRReferenceSpaceInitialized=new a.cP,this.onXRReady=new a.cP,this.inXRFrameLoop=!1,this.inXRSession=!1,this._worldScalingFactor=1,this.onWorldScaleFactorChangedObservable=new a.cP(void 0,!0),this._engine=e.getEngine(),this._onEngineDisposedObserver=this._engine.onDisposeObservable.addOnce((()=>{this._engine=null})),e.onDisposeObservable.addOnce((()=>{this.dispose()}))}get referenceSpace(){return this._referenceSpace}set referenceSpace(e){this._referenceSpace=e,this.onXRReferenceSpaceChanged.notifyObservers(this._referenceSpace)}get sessionMode(){return this._sessionMode}dispose(){this.inXRSession&&this.exitXRAsync(),this.onXRFrameObservable.clear(),this.onXRSessionEnded.clear(),this.onXRReferenceSpaceChanged.clear(),this.onXRSessionInit.clear(),this.onWorldScaleFactorChangedObservable.clear(),this._engine?.onDisposeObservable.remove(this._onEngineDisposedObserver),this._engine=null}async exitXRAsync(){if(this.session&&this.inXRSession){this.inXRSession=!1;try{return await this.session.end()}catch{T.V.Warn("Could not end XR session.")}}return Promise.resolve()}trySetViewportForView(e,t){return this._baseLayerRTTProvider?.trySetViewportForView(e,t)||!1}getRenderTargetTextureForEye(e){return this._baseLayerRTTProvider?.getRenderTargetTextureForEye(e)||null}getRenderTargetTextureForView(e){return this._baseLayerRTTProvider?.getRenderTargetTextureForView(e)||null}getWebXRRenderTarget(e){const t=this.scene.getEngine();return this._xrNavigator.xr.native?new Xs(this):((e=e||Gs.GetDefaults(t)).canvasElement=e.canvasElement||t.getRenderingCanvas()||void 0,new Hs(this,e))}initializeAsync(){return this._xrNavigator=navigator,this._xrNavigator.xr?Promise.resolve():Promise.reject("WebXR not available")}initializeSessionAsync(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"immersive-vr",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this._xrNavigator.xr.requestSession(e,t).then((t=>(this.session=t,this._sessionMode=e,this.inXRSession=!0,this.onXRSessionInit.notifyObservers(t),this.session.addEventListener("end",(()=>{this.inXRSession=!1,this.onXRSessionEnded.notifyObservers(null),this._engine&&(this._engine.framebufferDimensionsObject=null,this._engine.restoreDefaultFramebuffer(),this._engine.customAnimationFrameRequester=null,this._engine._renderLoop()),this.isNative&&this._baseLayerRTTProvider?.dispose(),this._baseLayerRTTProvider=null,this._baseLayerWrapper=null}),{once:!0}),this.session)))}isSessionSupportedAsync(e){return Ks.IsSessionSupportedAsync(e)}resetReferenceSpace(){this.referenceSpace=this.baseReferenceSpace}runXRRenderLoop(){this.inXRSession&&this._engine&&(this._engine.customAnimationFrameRequester={requestAnimationFrame:e=>this.session.requestAnimationFrame(e),renderFunction:(e,t)=>{if(this.inXRSession&&this._engine&&(this.currentFrame=t,this.currentTimestamp=e,t)){this.inXRFrameLoop=!0;const e=this._baseLayerRTTProvider?.getFramebufferDimensions()||null;this._engine.framebufferDimensionsObject!==e&&(this._engine.framebufferDimensionsObject=e),this.onXRFrameObservable.notifyObservers(t),this._engine._renderLoop(),this._engine.framebufferDimensionsObject=null,this.inXRFrameLoop=!1}}},this._engine.framebufferDimensionsObject=this._baseLayerRTTProvider?.getFramebufferDimensions()||null,this.onXRFrameObservable.addOnce((()=>{this.onXRReady.notifyObservers(this)})),"undefined"!==typeof window&&window.cancelAnimationFrame&&window.cancelAnimationFrame(this._engine._frameHandler),this._engine._renderLoop())}setReferenceSpaceTypeAsync(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"local-floor";return this.session.requestReferenceSpace(e).then((e=>e),(e=>(T.V.Error("XR.requestReferenceSpace failed for the following reason: "),T.V.Error(e),T.V.Log('Defaulting to universally-supported "viewer" reference space type.'),this.session.requestReferenceSpace("viewer").then((e=>{const t=new XRRigidTransform({x:0,y:-this.defaultHeightCompensation,z:0});return e.getOffsetReferenceSpace(t)}),(e=>{throw T.V.Error(e),'XR initialization failed: required "viewer" reference space type not supported.'}))))).then((e=>this.session.requestReferenceSpace("viewer").then((t=>(this.viewerReferenceSpace=t,e))))).then((e=>(this.referenceSpace=this.baseReferenceSpace=e,this.onXRReferenceSpaceInitialized.notifyObservers(e),this.referenceSpace)))}updateRenderStateAsync(e){return Promise.resolve(this.session.updateRenderState(e))}_setBaseLayerWrapper(e){this.isNative&&this._baseLayerRTTProvider?.dispose(),this._baseLayerWrapper=e,this._baseLayerRTTProvider=this._baseLayerWrapper?.createRenderTargetTextureProvider(this)||null}_getBaseLayerWrapper(){return this._baseLayerWrapper}updateRenderState(e){e.baseLayer&&this._setBaseLayerWrapper(this.isNative?new Ws(e.baseLayer):new Vs(e.baseLayer)),this.session.updateRenderState(e)}static IsSessionSupportedAsync(e){if(!navigator.xr)return Promise.resolve(!1);const t=navigator.xr.isSessionSupported||navigator.xr.supportsSession;return t?t.call(navigator.xr,e).then((e=>{const t="undefined"===typeof e||e;return Promise.resolve(t)})).catch((e=>(T.V.Warn(e),Promise.resolve(!1)))):Promise.resolve(!1)}get isNative(){return this._xrNavigator.xr.native??!1}get currentFrameRate(){return this.session?.frameRate}get supportedFrameRates(){return this.session?.supportedFrameRates}updateTargetFrameRate(e){return this.session.updateTargetFrameRate(e)}runInXRFrame(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.inXRFrameLoop?e():!this.inXRSession&&t||this.onXRFrameObservable.addOnce(e)}get isFixedFoveationSupported(){return this._baseLayerWrapper?.isFixedFoveationSupported||!1}get fixedFoveation(){return this._baseLayerWrapper?.fixedFoveation||null}set fixedFoveation(e){const t=Math.max(0,Math.min(1,e||0));this._baseLayerWrapper&&(this._baseLayerWrapper.fixedFoveation=t)}get enabledFeatures(){return this.session?.enabledFeatures??null}}class Ys{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.scene=e,this._pointerDownOnMeshAsked=!1,this._isActionableMesh=!1,this._teleportationRequestInitiated=!1,this._teleportationBackRequestInitiated=!1,this._rotationRightAsked=!1,this._rotationLeftAsked=!1,this._dpadPressed=!0,this._activePointer=!1,this._id=Ys._IdCounter++,t)this._gazeTracker=t.clone("gazeTracker");else{this._gazeTracker=qi("gazeTracker",{diameter:.0035,thickness:.0025,tessellation:20,updatable:!1},e),this._gazeTracker.bakeCurrentTransformIntoVertices(),this._gazeTracker.isPickable=!1,this._gazeTracker.isVisible=!1;const t=new zr("targetMat",e);t.specularColor=E.v9.Black(),t.emissiveColor=new E.v9(.7,.7,.7),t.backFaceCulling=!1,this._gazeTracker.material=t}}_getForwardRay(e){return new xs(o.Pq.Zero(),new o.Pq(0,0,e))}_selectionPointerDown(){this._pointerDownOnMeshAsked=!0,this._currentHit&&this.scene.simulatePointerDown(this._currentHit,{pointerId:this._id})}_selectionPointerUp(){this._currentHit&&this.scene.simulatePointerUp(this._currentHit,{pointerId:this._id}),this._pointerDownOnMeshAsked=!1}_activatePointer(){this._activePointer=!0}_deactivatePointer(){this._activePointer=!1}_updatePointerDistance(){}dispose(){this._interactionsEnabled=!1,this._teleportationEnabled=!1,this._gazeTracker&&this._gazeTracker.dispose()}}Ys._IdCounter=0;class js extends Ys{constructor(e,t){super(t),this._getCamera=e}_getForwardRay(e){const t=this._getCamera();return t?t.getForwardRay(e):new xs(o.Pq.Zero(),o.Pq.Forward())}}class Qs{get onEnteringVR(){return this.onEnteringVRObservable}get onExitingVR(){return this.onExitingVRObservable}get teleportationTarget(){return this._teleportationTarget}set teleportationTarget(e){e&&(e.name="teleportationTarget",this._isDefaultTeleportationTarget=!1,this._teleportationTarget=e)}get gazeTrackerMesh(){return this._cameraGazer._gazeTracker}set gazeTrackerMesh(e){e&&(this._cameraGazer._gazeTracker&&this._cameraGazer._gazeTracker.dispose(),this._cameraGazer._gazeTracker=e,this._cameraGazer._gazeTracker.bakeCurrentTransformIntoVertices(),this._cameraGazer._gazeTracker.isPickable=!1,this._cameraGazer._gazeTracker.isVisible=!1,this._cameraGazer._gazeTracker.name="gazeTracker")}get displayGaze(){return this._displayGaze}set displayGaze(e){this._displayGaze=e,e||(this._cameraGazer._gazeTracker.isVisible=!1)}get displayLaserPointer(){return this._displayLaserPointer}set displayLaserPointer(e){this._displayLaserPointer=e}get deviceOrientationCamera(){return this._deviceOrientationCamera}get currentVRCamera(){return this._scene.activeCamera}get vrDeviceOrientationCamera(){return this._vrDeviceOrientationCamera}get vrButton(){return this._btnVR}get _teleportationRequestInitiated(){return this._cameraGazer._teleportationRequestInitiated}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.webVROptions=t,this._fullscreenVRpresenting=!1,this.enableGazeEvenWhenNoPointerLock=!1,this.exitVROnDoubleTap=!0,this.onEnteringVRObservable=new a.cP,this.onAfterEnteringVRObservable=new a.cP,this.onExitingVRObservable=new a.cP,this._useCustomVRButton=!1,this._teleportActive=!1,this._floorMeshesCollection=[],this._teleportationMode=Qs.TELEPORTATIONMODE_CONSTANTTIME,this._teleportationTime=122,this._teleportationSpeed=20,this._rotationAllowed=!0,this._teleportBackwardsVector=new o.Pq(0,-1,-1),this._isDefaultTeleportationTarget=!0,this._teleportationFillColor="#444444",this._teleportationBorderColor="#FFFFFF",this._rotationAngle=0,this._haloCenter=new o.Pq(0,0,0),this._padSensibilityUp=.65,this._padSensibilityDown=.35,this._pickedLaserColor=new E.v9(.2,.2,1),this._pickedGazeColor=new E.v9(0,0,1),this.onNewMeshSelected=new a.cP,this.onNewMeshPicked=new a.cP,this.onBeforeCameraTeleport=new a.cP,this.onAfterCameraTeleport=new a.cP,this.onSelectedMeshUnselected=new a.cP,this.teleportationEnabled=!0,this._teleportationInitialized=!1,this._interactionsEnabled=!1,this._displayGaze=!0,this._displayLaserPointer=!0,this.updateGazeTrackerScale=!0,this.updateGazeTrackerColor=!0,this.updateControllerLaserColor=!0,this.requestPointerLockOnFullScreen=!0,this.xrTestDone=!1,this._onResize=()=>{this._moveButtonToBottomRight()},this._onFullscreenChange=()=>{this._fullscreenVRpresenting=!!document.fullscreenElement,!this._fullscreenVRpresenting&&this._inputElement&&(this.exitVR(),!this._useCustomVRButton&&this._btnVR&&(this._btnVR.style.top=this._inputElement.offsetTop+this._inputElement.offsetHeight-70+"px",this._btnVR.style.left=this._inputElement.offsetLeft+this._inputElement.offsetWidth-100+"px",this._updateButtonVisibility()))},this._cachedAngularSensibility={angularSensibilityX:null,angularSensibilityY:null,angularSensibility:null},this._beforeRender=()=>{this._scene.getEngine().isPointerLock||this.enableGazeEvenWhenNoPointerLock||(this._cameraGazer._gazeTracker.isVisible=!1)},this._onNewGamepadConnected=e=>{e.type!==ys.POSE_ENABLED&&(e.leftStick&&e.onleftstickchanged((e=>{this._teleportationInitialized&&this.teleportationEnabled&&(this._checkTeleportWithRay(e,this._cameraGazer),this._checkTeleportBackwards(e,this._cameraGazer))})),e.rightStick&&e.onrightstickchanged((e=>{this._teleportationInitialized&&this._checkRotate(e,this._cameraGazer)})),e.type===ys.XBOX&&(e.onbuttondown((e=>{this._interactionsEnabled&&0===e&&this._cameraGazer._selectionPointerDown()})),e.onbuttonup((e=>{this._interactionsEnabled&&0===e&&this._cameraGazer._selectionPointerUp()}))))},this._workingVector=o.Pq.Zero(),this._workingQuaternion=o.PT.Identity(),this._workingMatrix=o.uq.Identity(),T.V.Warn("WebVR is deprecated. Please avoid using this experience helper and use the WebXR experience helper instead"),this._scene=e,this._inputElement=e.getEngine().getInputElement();if("getVRDisplays"in navigator||void 0!==t.useXR||(t.useXR=!0),void 0===t.createFallbackVRDeviceOrientationFreeCamera&&(t.createFallbackVRDeviceOrientationFreeCamera=!0),void 0===t.createDeviceOrientationCamera&&(t.createDeviceOrientationCamera=!0),void 0===t.laserToggle&&(t.laserToggle=!0),this._hasEnteredVR=!1,this._scene.activeCamera?this._position=this._scene.activeCamera.position.clone():this._position=new o.Pq(0,this._defaultHeight,0),t.createDeviceOrientationCamera||!this._scene.activeCamera){if(this._deviceOrientationCamera=new cs("deviceOrientationVRHelper",this._position.clone(),e),this._scene.activeCamera&&(this._deviceOrientationCamera.minZ=this._scene.activeCamera.minZ,this._deviceOrientationCamera.maxZ=this._scene.activeCamera.maxZ,this._scene.activeCamera instanceof ft&&this._scene.activeCamera.rotation)){const e=this._scene.activeCamera;e.rotationQuaternion?this._deviceOrientationCamera.rotationQuaternion.copyFrom(e.rotationQuaternion):this._deviceOrientationCamera.rotationQuaternion.copyFrom(o.PT.RotationYawPitchRoll(e.rotation.y,e.rotation.x,e.rotation.z)),this._deviceOrientationCamera.rotation=e.rotation.clone()}this._scene.activeCamera=this._deviceOrientationCamera,this._inputElement&&this._scene.activeCamera.attachControl()}else this._existingCamera=this._scene.activeCamera;this.webVROptions.useXR&&navigator.xr?Ks.IsSessionSupportedAsync("immersive-vr").then((i=>{i?(T.V.Log("Using WebXR. It is recommended to use the WebXRDefaultExperience directly"),e.createDefaultXRExperienceAsync({floorMeshes:t.floorMeshes||[]}).then((t=>{this.xr=t,this.xrTestDone=!0,this._cameraGazer=new js((()=>this.xr.baseExperience.camera),e),this.xr.baseExperience.onStateChangedObservable.add((e=>{switch(e){case 0:this.onEnteringVRObservable.notifyObservers(this),this._interactionsEnabled||this.xr.pointerSelection.detach(),this.xr.pointerSelection.displayLaserPointer=this._displayLaserPointer;break;case 1:this.onExitingVRObservable.notifyObservers(this),this._scene.getEngine().resize();break;case 2:this._hasEnteredVR=!0;break;case 3:this._hasEnteredVR=!1}}))}))):this._completeVRInit(e,t)})):this._completeVRInit(e,t)}_completeVRInit(e,t){if(this.xrTestDone=!0,t.createFallbackVRDeviceOrientationFreeCamera&&(this._vrDeviceOrientationCamera=new vs("VRDeviceOrientationVRHelper",this._position,this._scene,!0,t.vrDeviceOrientationCameraMetrics),this._vrDeviceOrientationCamera.angularSensibility=Number.MAX_VALUE),this._cameraGazer=new js((()=>this.currentVRCamera),e),!this._useCustomVRButton){this._btnVR=document.createElement("BUTTON"),this._btnVR.className="babylonVRicon",this._btnVR.id="babylonVRiconbtn",this._btnVR.title="Click to switch to VR";let e=".babylonVRicon { position: absolute; right: 20px; height: 50px; width: 80px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%222048%22%20height%3D%221152%22%20viewBox%3D%220%200%202048%201152%22%20version%3D%221.1%22%3E%3Cpath%20transform%3D%22rotate%28180%201024%2C576.0000000000001%29%22%20d%3D%22m1109%2C896q17%2C0%2030%2C-12t13%2C-30t-12.5%2C-30.5t-30.5%2C-12.5l-170%2C0q-18%2C0%20-30.5%2C12.5t-12.5%2C30.5t13%2C30t30%2C12l170%2C0zm-85%2C256q59%2C0%20132.5%2C-1.5t154.5%2C-5.5t164.5%2C-11.5t163%2C-20t150%2C-30t124.5%2C-41.5q23%2C-11%2042%2C-24t38%2C-30q27%2C-25%2041%2C-61.5t14%2C-72.5l0%2C-257q0%2C-123%20-47%2C-232t-128%2C-190t-190%2C-128t-232%2C-47l-81%2C0q-37%2C0%20-68.5%2C14t-60.5%2C34.5t-55.5%2C45t-53%2C45t-53%2C34.5t-55.5%2C14t-55.5%2C-14t-53%2C-34.5t-53%2C-45t-55.5%2C-45t-60.5%2C-34.5t-68.5%2C-14l-81%2C0q-123%2C0%20-232%2C47t-190%2C128t-128%2C190t-47%2C232l0%2C257q0%2C68%2038%2C115t97%2C73q54%2C24%20124.5%2C41.5t150%2C30t163%2C20t164.5%2C11.5t154.5%2C5.5t132.5%2C1.5zm939%2C-298q0%2C39%20-24.5%2C67t-58.5%2C42q-54%2C23%20-122%2C39.5t-143.5%2C28t-155.5%2C19t-157%2C11t-148.5%2C5t-129.5%2C1.5q-59%2C0%20-130%2C-1.5t-148%2C-5t-157%2C-11t-155.5%2C-19t-143.5%2C-28t-122%2C-39.5q-34%2C-14%20-58.5%2C-42t-24.5%2C-67l0%2C-257q0%2C-106%2040.5%2C-199t110%2C-162.5t162.5%2C-109.5t199%2C-40l81%2C0q27%2C0%2052%2C14t50%2C34.5t51%2C44.5t55.5%2C44.5t63.5%2C34.5t74%2C14t74%2C-14t63.5%2C-34.5t55.5%2C-44.5t51%2C-44.5t50%2C-34.5t52%2C-14l14%2C0q37%2C0%2070%2C0.5t64.5%2C4.5t63.5%2C12t68%2C23q71%2C30%20128.5%2C78.5t98.5%2C110t63.5%2C133.5t22.5%2C149l0%2C257z%22%20fill%3D%22white%22%20/%3E%3C/svg%3E%0A":"https://cdn.babylonjs.com/Assets/vrButton.png")+"); background-size: 80%; background-repeat:no-repeat; background-position: center; border: none; outline: none; transition: transform 0.125s ease-out } .babylonVRicon:hover { transform: scale(1.05) } .babylonVRicon:active {background-color: rgba(51,51,51,1) } .babylonVRicon:focus {background-color: rgba(51,51,51,1) }";e+=".babylonVRicon.vrdisplaypresenting { display: none; }";const t=document.createElement("style");t.appendChild(document.createTextNode(e)),document.getElementsByTagName("head")[0].appendChild(t),this._moveButtonToBottomRight()}this._btnVR&&this._btnVR.addEventListener("click",(()=>{this.isInVRMode||this.enterVR()}));const i=this._scene.getEngine().getHostWindow();i&&(i.addEventListener("resize",this._onResize),document.addEventListener("fullscreenchange",this._onFullscreenChange,!1),t.createFallbackVRDeviceOrientationFreeCamera&&this._displayVRButton(),this._onKeyDown=e=>{27===e.keyCode&&this.isInVRMode&&this.exitVR()},document.addEventListener("keydown",this._onKeyDown),this._scene.onPrePointerObservable.add((()=>{this._hasEnteredVR&&this.exitVROnDoubleTap&&(this.exitVR(),this._fullscreenVRpresenting&&this._scene.getEngine().exitFullscreen())}),Ke.Zp.POINTERDOUBLETAP,!1),e.onDisposeObservable.add((()=>{this.dispose()})),this._updateButtonVisibility(),this._circleEase=new Ze,this._circleEase.setEasingMode($e.EASINGMODE_EASEINOUT),this._teleportationEasing=this._circleEase,e.onPointerObservable.add((t=>{this._interactionsEnabled&&e.activeCamera===this.vrDeviceOrientationCamera&&"mouse"===t.event.pointerType&&(t.type===Ke.Zp.POINTERDOWN?this._cameraGazer._selectionPointerDown():t.type===Ke.Zp.POINTERUP&&this._cameraGazer._selectionPointerUp())})),this.webVROptions.floorMeshes&&this.enableTeleportation({floorMeshes:this.webVROptions.floorMeshes}))}get isInVRMode(){return this.xr&&this.webVROptions.useXR&&2===this.xr.baseExperience.state||this._fullscreenVRpresenting}_moveButtonToBottomRight(){if(this._inputElement&&!this._useCustomVRButton&&this._btnVR){const e=this._inputElement.getBoundingClientRect();this._btnVR.style.top=e.top+e.height-70+"px",this._btnVR.style.left=e.left+e.width-100+"px"}}_displayVRButton(){this._useCustomVRButton||this._btnVRDisplayed||!this._btnVR||(document.body.appendChild(this._btnVR),this._btnVRDisplayed=!0)}_updateButtonVisibility(){this._btnVR&&!this._useCustomVRButton&&(this._btnVR.className="babylonVRicon",this.isInVRMode&&(this._btnVR.className+=" vrdisplaypresenting"))}enterVR(){if(this.xr)this.xr.baseExperience.enterXRAsync("immersive-vr","local-floor",this.xr.renderTarget);else{if(this.onEnteringVRObservable)try{this.onEnteringVRObservable.notifyObservers(this)}catch(e){T.V.Warn("Error in your custom logic onEnteringVR: "+e)}this._scene.activeCamera&&(this._position=this._scene.activeCamera.position.clone(),this.vrDeviceOrientationCamera&&(this.vrDeviceOrientationCamera.rotation=o.PT.FromRotationMatrix(this._scene.activeCamera.getWorldMatrix().getRotationMatrix()).toEulerAngles(),this.vrDeviceOrientationCamera.angularSensibility=2e3),this._existingCamera=this._scene.activeCamera,this._existingCamera.angularSensibilityX&&(this._cachedAngularSensibility.angularSensibilityX=this._existingCamera.angularSensibilityX,this._existingCamera.angularSensibilityX=Number.MAX_VALUE),this._existingCamera.angularSensibilityY&&(this._cachedAngularSensibility.angularSensibilityY=this._existingCamera.angularSensibilityY,this._existingCamera.angularSensibilityY=Number.MAX_VALUE),this._existingCamera.angularSensibility&&(this._cachedAngularSensibility.angularSensibility=this._existingCamera.angularSensibility,this._existingCamera.angularSensibility=Number.MAX_VALUE)),this._vrDeviceOrientationCamera&&(this._vrDeviceOrientationCamera.position=this._position,this._scene.activeCamera&&(this._vrDeviceOrientationCamera.minZ=this._scene.activeCamera.minZ),this._scene.activeCamera=this._vrDeviceOrientationCamera,this._scene.getEngine().enterFullscreen(this.requestPointerLockOnFullScreen),this._updateButtonVisibility(),this._vrDeviceOrientationCamera.onViewMatrixChangedObservable.addOnce((()=>{this.onAfterEnteringVRObservable.notifyObservers({success:!0})}))),this._scene.activeCamera&&this._inputElement&&this._scene.activeCamera.attachControl(),this._interactionsEnabled&&this._scene.registerBeforeRender(this._beforeRender),this._hasEnteredVR=!0}}exitVR(){if(this.xr)this.xr.baseExperience.exitXRAsync();else if(this._hasEnteredVR){if(this.onExitingVRObservable)try{this.onExitingVRObservable.notifyObservers(this)}catch(e){T.V.Warn("Error in your custom logic onExitingVR: "+e)}this._scene.activeCamera&&(this._position=this._scene.activeCamera.position.clone()),this.vrDeviceOrientationCamera&&(this.vrDeviceOrientationCamera.angularSensibility=Number.MAX_VALUE),this._deviceOrientationCamera?(this._deviceOrientationCamera.position=this._position,this._scene.activeCamera=this._deviceOrientationCamera,this._cachedAngularSensibility.angularSensibilityX&&(this._deviceOrientationCamera.angularSensibilityX=this._cachedAngularSensibility.angularSensibilityX,this._cachedAngularSensibility.angularSensibilityX=null),this._cachedAngularSensibility.angularSensibilityY&&(this._deviceOrientationCamera.angularSensibilityY=this._cachedAngularSensibility.angularSensibilityY,this._cachedAngularSensibility.angularSensibilityY=null),this._cachedAngularSensibility.angularSensibility&&(this._deviceOrientationCamera.angularSensibility=this._cachedAngularSensibility.angularSensibility,this._cachedAngularSensibility.angularSensibility=null)):this._existingCamera&&(this._existingCamera.position=this._position,this._scene.activeCamera=this._existingCamera,this._inputElement&&this._scene.activeCamera.attachControl(),this._cachedAngularSensibility.angularSensibilityX&&(this._existingCamera.angularSensibilityX=this._cachedAngularSensibility.angularSensibilityX,this._cachedAngularSensibility.angularSensibilityX=null),this._cachedAngularSensibility.angularSensibilityY&&(this._existingCamera.angularSensibilityY=this._cachedAngularSensibility.angularSensibilityY,this._cachedAngularSensibility.angularSensibilityY=null),this._cachedAngularSensibility.angularSensibility&&(this._existingCamera.angularSensibility=this._cachedAngularSensibility.angularSensibility,this._cachedAngularSensibility.angularSensibility=null)),this._updateButtonVisibility(),this._interactionsEnabled&&(this._scene.unregisterBeforeRender(this._beforeRender),this._cameraGazer._gazeTracker.isVisible=!1),this._scene.getEngine().resize(),this._hasEnteredVR=!1}}get position(){return this._position}set position(e){this._position=e,this._scene.activeCamera&&(this._scene.activeCamera.position=e)}enableInteractions(){if(!this._interactionsEnabled){if(this.xr)return void(2===this.xr.baseExperience.state&&this.xr.pointerSelection.attach());this.raySelectionPredicate=e=>e.isVisible&&(e.isPickable||e.name===this._floorMeshName),this.meshSelectionPredicate=()=>!0,this._raySelectionPredicate=e=>!!(this._isTeleportationFloor(e)||-1===e.name.indexOf("gazeTracker")&&-1===e.name.indexOf("teleportationTarget")&&-1===e.name.indexOf("torusTeleportation"))&&this.raySelectionPredicate(e),this._interactionsEnabled=!0}}_isTeleportationFloor(e){for(let t=0;t<this._floorMeshesCollection.length;t++)if(this._floorMeshesCollection[t].id===e.id)return!0;return!(!this._floorMeshName||e.name!==this._floorMeshName)}addFloorMesh(e){this._floorMeshesCollection&&(this._floorMeshesCollection.indexOf(e)>-1||this._floorMeshesCollection.push(e))}removeFloorMesh(e){if(!this._floorMeshesCollection)return;const t=this._floorMeshesCollection.indexOf(e);-1!==t&&this._floorMeshesCollection.splice(t,1)}enableTeleportation(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this._teleportationInitialized){if(this.enableInteractions(),this.webVROptions.useXR&&(e.floorMeshes||e.floorMeshName)){const t=e.floorMeshes||[];if(!t.length){const i=this._scene.getMeshByName(e.floorMeshName);i&&t.push(i)}if(this.xr)return t.forEach((e=>{this.xr.teleportation.addFloorMesh(e)})),void(this.xr.teleportation.attached||this.xr.teleportation.attach());if(!this.xrTestDone){const t=()=>{this.xrTestDone&&(this._scene.unregisterBeforeRender(t),this.xr?this.xr.teleportation.attached||this.xr.teleportation.attach():this.enableTeleportation(e))};return void this._scene.registerBeforeRender(t)}}e.floorMeshName&&(this._floorMeshName=e.floorMeshName),e.floorMeshes&&(this._floorMeshesCollection=e.floorMeshes),e.teleportationMode&&(this._teleportationMode=e.teleportationMode),e.teleportationTime&&e.teleportationTime>0&&(this._teleportationTime=e.teleportationTime),e.teleportationSpeed&&e.teleportationSpeed>0&&(this._teleportationSpeed=e.teleportationSpeed),void 0!==e.easingFunction&&(this._teleportationEasing=e.easingFunction);const t=new ii.p;t.vignetteColor=new E.ov(0,0,0,0),t.vignetteEnabled=!0,this._teleportationInitialized=!0,this._isDefaultTeleportationTarget&&this._createTeleportationCircles()}}_checkTeleportWithRay(e,t){this._teleportationRequestInitiated&&!t._teleportationRequestInitiated||(t._teleportationRequestInitiated?Math.sqrt(e.y*e.y+e.x*e.x)<this._padSensibilityDown&&(this._teleportActive&&this.teleportCamera(this._haloCenter),t._teleportationRequestInitiated=!1):e.y<-this._padSensibilityUp&&t._dpadPressed&&(t._activatePointer(),t._teleportationRequestInitiated=!0))}_checkRotate(e,t){t._teleportationRequestInitiated||(t._rotationLeftAsked?e.x>-this._padSensibilityDown&&(t._rotationLeftAsked=!1):e.x<-this._padSensibilityUp&&t._dpadPressed&&(t._rotationLeftAsked=!0,this._rotationAllowed&&this._rotateCamera(!1)),t._rotationRightAsked?e.x<this._padSensibilityDown&&(t._rotationRightAsked=!1):e.x>this._padSensibilityUp&&t._dpadPressed&&(t._rotationRightAsked=!0,this._rotationAllowed&&this._rotateCamera(!0)))}_checkTeleportBackwards(e,t){if(!t._teleportationRequestInitiated)if(e.y>this._padSensibilityUp&&t._dpadPressed){if(!t._teleportationBackRequestInitiated){if(!this.currentVRCamera)return;const e=o.PT.FromRotationMatrix(this.currentVRCamera.getWorldMatrix().getRotationMatrix()),i=this.currentVRCamera.position;e.toEulerAnglesToRef(this._workingVector),this._workingVector.z=0,this._workingVector.x=0,o.PT.RotationYawPitchRollToRef(this._workingVector.y,this._workingVector.x,this._workingVector.z,this._workingQuaternion),this._workingQuaternion.toRotationMatrix(this._workingMatrix),o.Pq.TransformCoordinatesToRef(this._teleportBackwardsVector,this._workingMatrix,this._workingVector);const r=new xs(i,this._workingVector),s=this._scene.pickWithRay(r,this._raySelectionPredicate);s&&s.pickedPoint&&s.pickedMesh&&this._isTeleportationFloor(s.pickedMesh)&&s.distance<5&&this.teleportCamera(s.pickedPoint),t._teleportationBackRequestInitiated=!0}}else t._teleportationBackRequestInitiated=!1}_createTeleportationCircles(){this._teleportationTarget=Oi("teleportationTarget",{width:2,height:2,subdivisions:2},this._scene),this._teleportationTarget.isPickable=!1;const e=new Ms("DynamicTexture",512,this._scene,!0);e.hasAlpha=!0;const t=e.getContext();t.beginPath(),t.arc(256,256,200,0,2*Math.PI,!1),t.fillStyle=this._teleportationFillColor,t.fill(),t.lineWidth=10,t.strokeStyle=this._teleportationBorderColor,t.stroke(),t.closePath(),e.update();const i=new zr("TextPlaneMaterial",this._scene);i.diffuseTexture=e,this._teleportationTarget.material=i;const r=qi("torusTeleportation",{diameter:.75,thickness:.1,tessellation:25,updatable:!1},this._scene);r.isPickable=!1,r.parent=this._teleportationTarget;const s=new dt("animationInnerCircle","position.y",30,dt.ANIMATIONTYPE_FLOAT,dt.ANIMATIONLOOPMODE_CYCLE),n=[];n.push({frame:0,value:0}),n.push({frame:30,value:.4}),n.push({frame:60,value:0}),s.setKeys(n);const a=new et;a.setEasingMode($e.EASINGMODE_EASEINOUT),s.setEasingFunction(a),r.animations=[],r.animations.push(s),this._scene.beginAnimation(r,0,60,!0),this._hideTeleportationTarget()}_hideTeleportationTarget(){this._teleportActive=!1,this._teleportationInitialized&&(this._teleportationTarget.isVisible=!1,this._isDefaultTeleportationTarget&&(this._teleportationTarget.getChildren()[0].isVisible=!1))}_rotateCamera(e){if(!(this.currentVRCamera instanceof ls))return;e?this._rotationAngle++:this._rotationAngle--,this.currentVRCamera.animations=[];const t=o.PT.FromRotationMatrix(o.uq.RotationY(Math.PI/4*this._rotationAngle)),i=new dt("animationRotation","rotationQuaternion",90,dt.ANIMATIONTYPE_QUATERNION,dt.ANIMATIONLOOPMODE_CONSTANT),r=[];r.push({frame:0,value:this.currentVRCamera.rotationQuaternion}),r.push({frame:6,value:t}),i.setKeys(r),i.setEasingFunction(this._circleEase),this.currentVRCamera.animations.push(i),this._postProcessMove.animations=[];const s=new dt("animationPP","vignetteWeight",90,dt.ANIMATIONTYPE_FLOAT,dt.ANIMATIONLOOPMODE_CONSTANT),n=[];n.push({frame:0,value:0}),n.push({frame:3,value:4}),n.push({frame:6,value:0}),s.setKeys(n),s.setEasingFunction(this._circleEase),this._postProcessMove.animations.push(s);const a=new dt("animationPP2","vignetteStretch",90,dt.ANIMATIONTYPE_FLOAT,dt.ANIMATIONLOOPMODE_CONSTANT),l=[];l.push({frame:0,value:0}),l.push({frame:3,value:10}),l.push({frame:6,value:0}),a.setKeys(l),a.setEasingFunction(this._circleEase),this._postProcessMove.animations.push(a),this._postProcessMove.imageProcessingConfiguration.vignetteWeight=0,this._postProcessMove.imageProcessingConfiguration.vignetteStretch=0,this._postProcessMove.samples=4,this._scene.beginAnimation(this.currentVRCamera,0,6,!1,1)}teleportCamera(e){if(!(this.currentVRCamera instanceof ls))return;this._workingVector.copyFrom(e),this.isInVRMode||(this._workingVector.y+=this._defaultHeight),this.onBeforeCameraTeleport.notifyObservers(this._workingVector);let t,i;if(this._teleportationMode==Qs.TELEPORTATIONMODE_CONSTANTSPEED){i=90;const e=o.Pq.Distance(this.currentVRCamera.position,this._workingVector);t=this._teleportationSpeed/e}else i=Math.round(90*this._teleportationTime/1e3),t=1;this.currentVRCamera.animations=[];const r=new dt("animationCameraTeleportation","position",90,dt.ANIMATIONTYPE_VECTOR3,dt.ANIMATIONLOOPMODE_CONSTANT),s=[{frame:0,value:this.currentVRCamera.position},{frame:i,value:this._workingVector}];r.setKeys(s),r.setEasingFunction(this._teleportationEasing),this.currentVRCamera.animations.push(r),this._postProcessMove.animations=[];const n=Math.round(i/2),a=new dt("animationPP","vignetteWeight",90,dt.ANIMATIONTYPE_FLOAT,dt.ANIMATIONLOOPMODE_CONSTANT),l=[];l.push({frame:0,value:0}),l.push({frame:n,value:8}),l.push({frame:i,value:0}),a.setKeys(l),this._postProcessMove.animations.push(a);const h=new dt("animationPP2","vignetteStretch",90,dt.ANIMATIONTYPE_FLOAT,dt.ANIMATIONLOOPMODE_CONSTANT),c=[];c.push({frame:0,value:0}),c.push({frame:n,value:10}),c.push({frame:i,value:0}),h.setKeys(c),this._postProcessMove.animations.push(h),this._postProcessMove.imageProcessingConfiguration.vignetteWeight=0,this._postProcessMove.imageProcessingConfiguration.vignetteStretch=0,this._scene.beginAnimation(this.currentVRCamera,0,i,!1,t,(()=>{this.onAfterCameraTeleport.notifyObservers(this._workingVector)})),this._hideTeleportationTarget()}setLaserColor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._pickedLaserColor;this._pickedLaserColor=t}setLaserLightingState(){}setGazeColor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._pickedGazeColor;this._pickedGazeColor=t}changeLaserColor(e){this.updateControllerLaserColor}changeGazeColor(e){this.updateGazeTrackerColor&&this._cameraGazer._gazeTracker.material&&(this._cameraGazer._gazeTracker.material.emissiveColor=e)}dispose(){this.isInVRMode&&this.exitVR(),this._postProcessMove&&this._postProcessMove.dispose(),this._vrDeviceOrientationCamera&&this._vrDeviceOrientationCamera.dispose(),!this._useCustomVRButton&&this._btnVR&&this._btnVR.parentNode&&document.body.removeChild(this._btnVR),this._deviceOrientationCamera&&this._scene.activeCamera!=this._deviceOrientationCamera&&this._deviceOrientationCamera.dispose(),this._cameraGazer&&this._cameraGazer.dispose(),this._teleportationTarget&&this._teleportationTarget.dispose(),this.xr&&this.xr.dispose(),this._floorMeshesCollection.length=0,document.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChangeBind),window.removeEventListener("resize",this._onResize),document.removeEventListener("fullscreenchange",this._onFullscreenChange),this._scene.gamepadManager.onGamepadConnectedObservable.removeCallback(this._onNewGamepadConnected),this._scene.unregisterBeforeRender(this._beforeRender)}getClassName(){return"VRExperienceHelper"}}Qs.TELEPORTATIONMODE_CONSTANTTIME=0,Qs.TELEPORTATIONMODE_CONSTANTSPEED=1;i(6141),i(7189),i(8598);class $s extends ls{constructor(e,t,i){super(e,o.Pq.Zero(),t),this._xrSessionManager=i,this._firstFrame=!1,this._referenceQuaternion=o.PT.Identity(),this._referencedPosition=new o.Pq,this._trackingState=0,this.onXRCameraInitializedObservable=new a.cP,this.onBeforeCameraTeleport=new a.cP,this.onAfterCameraTeleport=new a.cP,this.onTrackingStateChanged=new a.cP,this.compensateOnFirstFrame=!0,this._rotate180=new o.PT(0,1,0,0),this.minZ=.1,this.rotationQuaternion=new o.PT,this.cameraRigMode=R.RIG_MODE_CUSTOM,this.updateUpVectorFromRotation=!0,this._updateNumberOfRigCameras(1),this.freezeProjectionMatrix(),this._deferOnly=!0,this._xrSessionManager.onXRSessionInit.add((()=>{this._referencedPosition.copyFromFloats(0,0,0),this._referenceQuaternion.copyFromFloats(0,0,0,1),this._firstFrame=this.compensateOnFirstFrame,this._xrSessionManager.onWorldScaleFactorChangedObservable.add((()=>{this._xrSessionManager.currentFrame&&this._updateDepthNearFar()}))})),this._xrSessionManager.onXRFrameObservable.add((()=>{this._firstFrame&&this._updateFromXRSession(),this.onXRCameraInitializedObservable.hasObservers()&&(this.onXRCameraInitializedObservable.notifyObservers(this),this.onXRCameraInitializedObservable.clear()),this._deferredUpdated&&(this.position.copyFrom(this._deferredPositionUpdate),this.rotationQuaternion.copyFrom(this._deferredRotationQuaternionUpdate)),this._updateReferenceSpace(),this._updateFromXRSession()}),void 0,!0)}get trackingState(){return this._trackingState}_setTrackingState(e){this._trackingState!==e&&(this._trackingState=e,this.onTrackingStateChanged.notifyObservers(e))}get realWorldHeight(){const e=this._xrSessionManager.currentFrame&&this._xrSessionManager.currentFrame.getViewerPose(this._xrSessionManager.baseReferenceSpace);return e&&e.transform?e.transform.position.y*this._xrSessionManager.worldScalingFactor:0}_updateForDualEyeDebugging(){this._updateNumberOfRigCameras(2),this.rigCameras[0].viewport=new A.L(0,0,.5,1),this.rigCameras[0].outputRenderTarget=null,this.rigCameras[1].viewport=new A.L(.5,0,.5,1),this.rigCameras[1].outputRenderTarget=null}setTransformationFromNonVRCamera(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getScene().activeCamera,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!e||e===this)return;e.computeWorldMatrix().decompose(void 0,this.rotationQuaternion,this.position),this.position.y=0,o.PT.FromEulerAnglesToRef(0,this.rotationQuaternion.toEulerAngles().y,0,this.rotationQuaternion),this._firstFrame=!0,t&&this._xrSessionManager.resetReferenceSpace()}getClassName(){return"WebXRCamera"}setTarget(e){const t=o.AA.Vector3[1];e.subtractToRef(this.position,t),t.y=0,t.normalize();const i=Math.atan2(t.x,t.z);this.rotationQuaternion.toEulerAnglesToRef(t),o.PT.FromEulerAnglesToRef(t.x,i,t.z,this.rotationQuaternion)}dispose(){super.dispose(),this._lastXRViewerPose=void 0}_updateDepthNearFar(){const e=(this.maxZ||1e4)*this._xrSessionManager.worldScalingFactor,t={depthFar:e,depthNear:this.minZ};this._xrSessionManager.updateRenderState(t),this._cache.minZ=this.minZ,this._cache.maxZ=e}_updateFromXRSession(){const e=this._xrSessionManager.currentFrame&&this._xrSessionManager.currentFrame.getViewerPose(this._xrSessionManager.referenceSpace);if(this._lastXRViewerPose=e||void 0,!e)return void this._setTrackingState(0);const t=e.emulatedPosition?1:2;if(this._setTrackingState(t),this.minZ===this._cache.minZ&&this.maxZ===this._cache.maxZ||this._updateDepthNearFar(),e.transform){const t=e.transform.orientation;if(void 0===e.transform.orientation.x)return;const i=e.transform.position;this._referencedPosition.set(i.x,i.y,i.z).scaleInPlace(this._xrSessionManager.worldScalingFactor),this._referenceQuaternion.set(t.x,t.y,t.z,t.w),this._scene.useRightHandedSystem||(this._referencedPosition.z*=-1,this._referenceQuaternion.z*=-1,this._referenceQuaternion.w*=-1),this._firstFrame?(this._firstFrame=!1,this.position.y+=this._referencedPosition.y,this._referenceQuaternion.copyFromFloats(0,0,0,1)):(this.rotationQuaternion.copyFrom(this._referenceQuaternion),this.position.copyFrom(this._referencedPosition))}this.rigCameras.length!==e.views.length&&this._updateNumberOfRigCameras(e.views.length),e.views.forEach(((e,t)=>{const i=this.rigCameras[t];i.isLeftCamera||i.isRightCamera||("right"===e.eye?i._isRightCamera=!0:"left"===e.eye&&(i._isLeftCamera=!0));const r=this.getScene().customRenderTargets;for(let o=0;o<r.length;o++){const e=r[o];-1===i.customRenderTargets.indexOf(e)&&i.customRenderTargets.push(e)}const s=e.transform.position,n=e.transform.orientation;i.parent=this.parent,i.position.set(s.x,s.y,s.z).scaleInPlace(this._xrSessionManager.worldScalingFactor),i.rotationQuaternion.set(n.x,n.y,n.z,n.w),this._scene.useRightHandedSystem?i.rotationQuaternion.multiplyInPlace(this._rotate180):(i.position.z*=-1,i.rotationQuaternion.z*=-1,i.rotationQuaternion.w*=-1),o.uq.FromFloat32ArrayToRefScaled(e.projectionMatrix,0,1,i._projectionMatrix),this._scene.useRightHandedSystem||i._projectionMatrix.toggleProjectionMatrixHandInPlace();const a=2*Math.atan2(1,e.projectionMatrix[5]);i.fov=a,0===t&&(this.fov=a,this._projectionMatrix.copyFrom(i._projectionMatrix));const l=this._xrSessionManager.getRenderTargetTextureForView(e);this._renderingMultiview=l?._texture?.isMultiview||!1,this._renderingMultiview?0==t&&(this._xrSessionManager.trySetViewportForView(this.viewport,e),this.outputRenderTarget=l):(this._xrSessionManager.trySetViewportForView(i.viewport,e),i.outputRenderTarget=l||this._xrSessionManager.getRenderTargetTextureForView(e)),i.layerMask=this.layerMask}))}_updateNumberOfRigCameras(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;for(;this.rigCameras.length<e;){const e=new ft("XR-RigCamera: "+this.rigCameras.length,o.Pq.Zero(),this.getScene());e.minZ=.1,e.rotationQuaternion=new o.PT,e.updateUpVectorFromRotation=!0,e.isRigCamera=!0,e.rigParent=this,e.freezeProjectionMatrix(),this.rigCameras.push(e)}for(;this.rigCameras.length>e;){const e=this.rigCameras.pop();e&&e.dispose()}}_updateReferenceSpace(){if(!this.position.equals(this._referencedPosition)||!this.rotationQuaternion.equals(this._referenceQuaternion)){const e=o.AA.Matrix[0],t=o.AA.Matrix[1],i=o.AA.Matrix[2];o.uq.ComposeToRef($s._ScaleReadOnly,this._referenceQuaternion,this._referencedPosition,e),o.uq.ComposeToRef($s._ScaleReadOnly,this.rotationQuaternion,this.position,t),e.invert().multiplyToRef(t,i),i.invert(),this._scene.useRightHandedSystem||i.toggleModelMatrixHandInPlace(),i.decompose(void 0,this._referenceQuaternion,this._referencedPosition);const r=new XRRigidTransform({x:this._referencedPosition.x/this._xrSessionManager.worldScalingFactor,y:this._referencedPosition.y/this._xrSessionManager.worldScalingFactor,z:this._referencedPosition.z/this._xrSessionManager.worldScalingFactor},{x:this._referenceQuaternion.x,y:this._referenceQuaternion.y,z:this._referenceQuaternion.z,w:this._referenceQuaternion.w});this._xrSessionManager.referenceSpace=this._xrSessionManager.referenceSpace.getOffsetReferenceSpace(r)}}}$s._ScaleReadOnly=o.Pq.One();class Zs{}Zs.ANCHOR_SYSTEM="xr-anchor-system",Zs.BACKGROUND_REMOVER="xr-background-remover",Zs.HIT_TEST="xr-hit-test",Zs.MESH_DETECTION="xr-mesh-detection",Zs.PHYSICS_CONTROLLERS="xr-physics-controller",Zs.PLANE_DETECTION="xr-plane-detection",Zs.POINTER_SELECTION="xr-controller-pointer-selection",Zs.TELEPORTATION="xr-controller-teleportation",Zs.FEATURE_POINTS="xr-feature-points",Zs.HAND_TRACKING="xr-hand-tracking",Zs.IMAGE_TRACKING="xr-image-tracking",Zs.NEAR_INTERACTION="xr-near-interaction",Zs.DOM_OVERLAY="xr-dom-overlay",Zs.MOVEMENT="xr-controller-movement",Zs.LIGHT_ESTIMATION="xr-light-estimation",Zs.EYE_TRACKING="xr-eye-tracking",Zs.WALKING_LOCOMOTION="xr-walking-locomotion",Zs.LAYERS="xr-layers",Zs.DEPTH_SENSING="xr-depth-sensing",Zs.SPACE_WARP="xr-space-warp",Zs.RAW_CAMERA_ACCESS="xr-raw-camera-access";class Js{constructor(e){this._xrSessionManager=e,this._features={},this._xrSessionManager.onXRSessionInit.add((()=>{this.getEnabledFeatures().forEach((e=>{const t=this._features[e];!t.enabled||t.featureImplementation.attached||t.featureImplementation.disableAutoAttach||this.attachFeature(e)}))})),this._xrSessionManager.onXRSessionEnded.add((()=>{this.getEnabledFeatures().forEach((e=>{const t=this._features[e];t.enabled&&t.featureImplementation.attached&&this.detachFeature(e)}))}))}static AddWebXRFeature(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._AvailableFeatures[e]=this._AvailableFeatures[e]||{latest:i},i>this._AvailableFeatures[e].latest&&(this._AvailableFeatures[e].latest=i),r&&(this._AvailableFeatures[e].stable=i),this._AvailableFeatures[e][i]=t}static ConstructFeature(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;const s=this._AvailableFeatures[e][t];if(!s)throw new Error("feature not found");return s(i,r)}static GetAvailableFeatures(){return Object.keys(this._AvailableFeatures)}static GetAvailableVersions(e){return Object.keys(this._AvailableFeatures[e])}static GetLatestVersionOfFeature(e){return this._AvailableFeatures[e]&&this._AvailableFeatures[e].latest||-1}static GetStableVersionOfFeature(e){return this._AvailableFeatures[e]&&this._AvailableFeatures[e].stable||-1}attachFeature(e){const t=this._features[e];if(t&&t.enabled&&!t.featureImplementation.attached){t.featureImplementation.attach()||_.S0.Warn(`Feature ${e} failed to attach`)}}detachFeature(e){const t=this._features[e];if(t&&t.featureImplementation.attached){t.featureImplementation.detach()||_.S0.Warn(`Feature ${e} failed to detach`)}}disableFeature(e){const t="string"===typeof e?e:e.Name,i=this._features[t];return!(!i||!i.enabled)&&(i.enabled=!1,this.detachFeature(t),i.featureImplementation.dispose(),delete this._features[t],!0)}dispose(){this.getEnabledFeatures().forEach((e=>{this.disableFeature(e)}))}enableFeature(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"latest",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const n="string"===typeof e?e:e.Name;let a=0;if("string"===typeof t){if(!t)throw new Error(`Error in provided version - ${n} (${t})`);if(a="stable"===t?Js.GetStableVersionOfFeature(n):"latest"===t?Js.GetLatestVersionOfFeature(n):+t,-1===a||isNaN(a))throw new Error(`feature not found - ${n} (${t})`)}else a=t;const o=Js._ConflictingFeatures[n];if(void 0!==o&&-1!==this.getEnabledFeatures().indexOf(o))throw new Error(`Feature ${n} cannot be enabled while ${o} is enabled.`);const l=this._features[n],h=Js.ConstructFeature(n,a,this._xrSessionManager,i);if(!h)throw new Error(`feature not found - ${n}`);l&&this.disableFeature(n);const c=h();if(c.dependsOn){const e=c.dependsOn.every((e=>!!this._features[e]));if(!e)throw new Error(`Dependant features missing. Make sure the following features are enabled - ${c.dependsOn.join(", ")}`)}if(c.isCompatible())return this._features[n]={featureImplementation:c,enabled:!0,version:a,required:s},r?this._xrSessionManager.session&&!this._features[n].featureImplementation.attached&&this.attachFeature(n):this._features[n].featureImplementation.disableAutoAttach=!0,this._features[n].featureImplementation;if(s)throw new Error("required feature not compatible");return _.S0.Warn(`Feature ${n} not compatible with the current environment/browser and was not enabled.`),c}getEnabledFeature(e){return this._features[e]&&this._features[e].featureImplementation}getEnabledFeatures(){return Object.keys(this._features)}async _extendXRSessionInitObject(e){const t=this.getEnabledFeatures();for(const i of t){const t=this._features[i],r=t.featureImplementation.xrNativeFeatureName;if(r&&(t.required?(e.requiredFeatures=e.requiredFeatures||[],-1===e.requiredFeatures.indexOf(r)&&e.requiredFeatures.push(r)):(e.optionalFeatures=e.optionalFeatures||[],-1===e.optionalFeatures.indexOf(r)&&e.optionalFeatures.push(r))),t.featureImplementation.getXRSessionInitExtension){const i=await t.featureImplementation.getXRSessionInitExtension();e={...e,...i}}}return e}}Js._AvailableFeatures={},Js._ConflictingFeatures={[Zs.TELEPORTATION]:Zs.MOVEMENT,[Zs.MOVEMENT]:Zs.TELEPORTATION},d.AddNodeConstructor("TouchCamera",((e,t)=>()=>new en(e,o.Pq.Zero(),t)));class en extends ls{get touchAngularSensibility(){const e=this.inputs.attached.touch;return e?e.touchAngularSensibility:0}set touchAngularSensibility(e){const t=this.inputs.attached.touch;t&&(t.touchAngularSensibility=e)}get touchMoveSensibility(){const e=this.inputs.attached.touch;return e?e.touchMoveSensibility:0}set touchMoveSensibility(e){const t=this.inputs.attached.touch;t&&(t.touchMoveSensibility=e)}constructor(e,t,i){super(e,t,i),this.inputs.addTouch(),this._setupInputs()}getClassName(){return"TouchCamera"}_setupInputs(){const e=this.inputs.attached.touch,t=this.inputs.attached.mouse;t?t.touchEnabled=!e:e.allowMouse=!t}}d.AddNodeConstructor("FreeCamera",((e,t)=>()=>new tn(e,o.Pq.Zero(),t)));class tn extends en{get gamepadAngularSensibility(){const e=this.inputs.attached.gamepad;return e?e.gamepadAngularSensibility:0}set gamepadAngularSensibility(e){const t=this.inputs.attached.gamepad;t&&(t.gamepadAngularSensibility=e)}get gamepadMoveSensibility(){const e=this.inputs.attached.gamepad;return e?e.gamepadMoveSensibility:0}set gamepadMoveSensibility(e){const t=this.inputs.attached.gamepad;t&&(t.gamepadMoveSensibility=e)}constructor(e,t,i){super(e,t,i),this.inputs.addGamepad()}getClassName(){return"UniversalCamera"}}R._CreateDefaultParsedCamera=(e,t)=>new tn(e,o.Pq.Zero(),t);class rn{constructor(e){this._scene=e,this._nonVRCamera=null,this._attachedToElement=!1,this._spectatorCamera=null,this._originalSceneAutoClear=!0,this._supported=!1,this._spectatorMode=!1,this._lastTimestamp=0,this.onInitialXRPoseSetObservable=new a.cP,this.onStateChangedObservable=new a.cP,this.state=3,this.sessionManager=new Ks(e),this.camera=new $s("webxr",e,this.sessionManager),this.featuresManager=new Js(this.sessionManager),e.onDisposeObservable.addOnce((()=>{this.dispose()}))}static CreateAsync(e){const t=new rn(e);return t.sessionManager.initializeAsync().then((()=>(t._supported=!0,t))).catch((e=>{throw t._setState(3),t.dispose(),e}))}dispose(){this.exitXRAsync(),this.camera.dispose(),this.onStateChangedObservable.clear(),this.onInitialXRPoseSetObservable.clear(),this.sessionManager.dispose(),this._spectatorCamera?.dispose(),this._nonVRCamera&&(this._scene.activeCamera=this._nonVRCamera)}async enterXRAsync(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.sessionManager.getWebXRRenderTarget(),r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!this._supported)throw"WebXR not supported in this browser or environment";this._setState(0),"viewer"!==t&&"local"!==t&&(r.optionalFeatures=r.optionalFeatures||[],r.optionalFeatures.push(t)),r=await this.featuresManager._extendXRSessionInitObject(r),"immersive-ar"===e&&"unbounded"!==t&&T.V.Warn("We recommend using 'unbounded' reference space type when using 'immersive-ar' session mode");try{await this.sessionManager.initializeSessionAsync(e,r),await this.sessionManager.setReferenceSpaceTypeAsync(t);const s={depthFar:this.camera.maxZ||1e4,depthNear:this.camera.minZ};if(!this.featuresManager.getEnabledFeature(Zs.LAYERS)){const e=await i.initializeXRLayerAsync(this.sessionManager.session);s.baseLayer=e}return this.sessionManager.updateRenderState(s),this.sessionManager.runXRRenderLoop(),this._originalSceneAutoClear=this._scene.autoClear,this._nonVRCamera=this._scene.activeCamera,this._attachedToElement=!!this._nonVRCamera?.inputs?.attachedToElement,this._nonVRCamera?.detachControl(),this._scene.activeCamera=this.camera,"immersive-ar"!==e?this._nonXRToXRCamera():(this._scene.autoClear=!1,this.camera.compensateOnFirstFrame=!1,this.camera.position.set(0,0,0),this.camera.rotationQuaternion.set(0,0,0,1),this.onInitialXRPoseSetObservable.notifyObservers(this.camera)),ee.$.audioEngine?._resumeAudioContextOnStateChange(),this.sessionManager.onXRSessionEnded.addOnce((()=>{1!==this.state&&this._setState(1),this.camera.rigCameras.forEach((e=>{e.outputRenderTarget=null})),this._scene.autoClear=this._originalSceneAutoClear,this._scene.activeCamera=this._nonVRCamera,this._attachedToElement&&this._nonVRCamera&&this._nonVRCamera.attachControl(!!this._nonVRCamera.inputs.noPreventDefault),"immersive-ar"!==e&&this.camera.compensateOnFirstFrame&&(this._nonVRCamera.setPosition?this._nonVRCamera.setPosition(this.camera.position):this._nonVRCamera.position.copyFrom(this.camera.position)),this._setState(3)})),this.sessionManager.onXRFrameObservable.addOnce((()=>{this._setState(2)})),this.sessionManager}catch(Qp){throw T.V.Log(Qp),T.V.Log(Qp.message),this._setState(3),Qp}}exitXRAsync(){return 2!==this.state?Promise.resolve():(this._setState(1),this.sessionManager.exitXRAsync())}enableSpectatorMode(e){this._spectatorMode||(this._spectatorMode=!0,this._switchSpectatorMode(e))}disableSpecatatorMode(){this._spectatorMode&&(this._spectatorMode=!1,this._switchSpectatorMode())}_switchSpectatorMode(e){const t=1/(e?.fps?e.fps:1e3)*1e3,i=e?.preferredCameraIndex?e?.preferredCameraIndex:0,r=()=>{if(this._spectatorCamera){this.sessionManager.currentTimestamp-this._lastTimestamp>=t&&(this._lastTimestamp=this.sessionManager.currentTimestamp,this._spectatorCamera.position.copyFrom(this.camera.rigCameras[i].globalPosition),this._spectatorCamera.rotationQuaternion.copyFrom(this.camera.rigCameras[i].absoluteRotation))}};if(this._spectatorMode){if(i>=this.camera.rigCameras.length)throw new Error("the preferred camera index is beyond the length of rig camera array.");const e=()=>{2===this.state?(this._spectatorCamera=new tn("webxr-spectator",o.Pq.Zero(),this._scene),this._spectatorCamera.rotationQuaternion=new o.PT,this._scene.activeCameras=[this.camera,this._spectatorCamera],this.sessionManager.onXRFrameObservable.add(r),this._scene.onAfterRenderCameraObservable.add((e=>{e===this.camera&&(this._scene.getEngine().framebufferDimensionsObject=null)}))):1===this.state&&(this.sessionManager.onXRFrameObservable.removeCallback(r),this._scene.activeCameras=null)};this.onStateChangedObservable.add(e),e()}else this.sessionManager.onXRFrameObservable.removeCallback(r),this._scene.activeCameras=[this.camera]}_nonXRToXRCamera(){this.camera.setTransformationFromNonVRCamera(this._nonVRCamera),this.onInitialXRPoseSetObservable.notifyObservers(this.camera)}_setState(e){this.state!==e&&(this.state=e,this.onStateChangedObservable.notifyObservers(this.state))}}class sn{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];this.id=e,this.type=t,this._buttonIndex=i,this._axesIndices=r,this._axes={x:0,y:0},this._changes={},this._currentValue=0,this._hasChanges=!1,this._pressed=!1,this._touched=!1,this.onAxisValueChangedObservable=new a.cP,this.onButtonStateChangedObservable=new a.cP}get axes(){return this._axes}get changes(){return this._changes}get hasChanges(){return this._hasChanges}get pressed(){return this._pressed}get touched(){return this._touched}get value(){return this._currentValue}dispose(){this.onAxisValueChangedObservable.clear(),this.onButtonStateChangedObservable.clear()}isAxes(){return 0!==this._axesIndices.length}isButton(){return-1!==this._buttonIndex}update(e){let t=!1,i=!1;if(this._hasChanges=!1,this._changes={},this.isButton()){const i=e.buttons[this._buttonIndex];if(!i)return;this._currentValue!==i.value&&(this.changes.value={current:i.value,previous:this._currentValue},t=!0,this._currentValue=i.value),this._touched!==i.touched&&(this.changes.touched={current:i.touched,previous:this._touched},t=!0,this._touched=i.touched),this._pressed!==i.pressed&&(this.changes.pressed={current:i.pressed,previous:this._pressed},t=!0,this._pressed=i.pressed)}this.isAxes()&&(this._axes.x!==e.axes[this._axesIndices[0]]&&(this.changes.axes={current:{x:e.axes[this._axesIndices[0]],y:this._axes.y},previous:{x:this._axes.x,y:this._axes.y}},this._axes.x=e.axes[this._axesIndices[0]],i=!0),this._axes.y!==e.axes[this._axesIndices[1]]&&(this.changes.axes?this.changes.axes.current.y=e.axes[this._axesIndices[1]]:this.changes.axes={current:{x:this._axes.x,y:e.axes[this._axesIndices[1]]},previous:{x:this._axes.x,y:this._axes.y}},this._axes.y=e.axes[this._axesIndices[1]],i=!0)),t&&(this._hasChanges=!0,this.onButtonStateChangedObservable.notifyObservers(this)),i&&(this._hasChanges=!0,this.onAxisValueChangedObservable.notifyObservers(this._axes))}}sn.BUTTON_TYPE="button",sn.SQUEEZE_TYPE="squeeze",sn.THUMBSTICK_TYPE="thumbstick",sn.TOUCHPAD_TYPE="touchpad",sn.TRIGGER_TYPE="trigger";var nn,an=i(242),on=i(7999);!function(e){e[e.Clean=0]="Clean",e[e.Stop=1]="Stop",e[e.Sync=2]="Sync",e[e.NoSync=3]="NoSync"}(nn||(nn={}));const ln=new a.cP,hn={};let cn=!1;function un(){return hn[".babylon"]}function dn(e){const t=hn[e];return t||(T.V.Warn("Unable to find a plugin to load "+e+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),un())}function _n(e,t,i){let r="Unable to load from "+(e.rawData?"binary data":e.url);return t?r+=`: ${t}`:i&&(r+=`: ${i}`),r}function pn(e,t,i,r,s,n,a,o,l){const h="data:"===(c=e.url).substr(0,5)?c.substr(5):null;var c;if(e.rawData&&!a)throw"When using ArrayBufferView to load data the file extension must be provided.";const u=a?dn(a):h?function(e){for(const t in hn){const i=hn[t].plugin;if(i.canDirectLoad&&i.canDirectLoad(e))return hn[t]}return un()}(e.url):function(e){const t=e.indexOf("?");-1!==t&&(e=e.substring(0,t));const i=e.lastIndexOf(".");return dn(e.substring(i,e.length).toLowerCase())}(e.url);if(!u)throw new Error(`No plugin or fallback for ${a??e.url}`);if(!1===l?.[u.plugin.name]?.enabled)throw new Error(`The '${u.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(e.rawData&&!u.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(e=>{if(u.plugin.createPlugin){const t=u.plugin.createPlugin(l??{});return t instanceof Promise?(t.then(e).catch((e=>{s("Error instantiating plugin.",e)})),null):(e(t),t)}return e(u.plugin),u.plugin})((l=>{if(!l)throw`The loader plugin corresponding to the '${a}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(ln.notifyObservers(l),h&&(l.canDirectLoad&&l.canDirectLoad(e.url)||!(0,an.f2)(e.url))){if(l.directLoad){const e=l.directLoad(t,h);e instanceof Promise?e.then((e=>{i(l,e)})).catch((e=>{s("Error in directLoad of _loadData: "+e,e)})):i(l,e)}else i(l,h);return}const c=u.isBinary,d=(e,r)=>{t.isDisposed?s("Scene has been disposed"):i(l,e,r)};let _=null,p=!1;l.onDisposeObservable?.add((()=>{p=!0,_&&(_.abort(),_=null),n()}));const f=()=>{if(p)return;const i=(e,t)=>{s(e?.statusText,t)};if(!l.loadFile&&e.rawData)throw"Plugin does not support loading ArrayBufferView.";_=l.loadFile?l.loadFile(t,e.rawData||e.file||e.url,e.rootUrl,d,r,c,i,o):t._loadFile(e.file||e.url,d,r,!0,c,i)},g=t.getEngine();let m=g.enableOfflineSupport;if(m){let i=!1;for(const r of t.disableOfflineSupportExceptionRules)if(r.test(e.url)){i=!0;break}m=!i}m&&ee.$.OfflineProviderFactory?t.offlineProvider=ee.$.OfflineProviderFactory(e.url,f,g.disableManifestCheck):f()}))}function fn(e,t){let i,r,s=null,n=null;if(t)if(t.name)i=`file:${t.name}`,r=t.name,s=t;else if(ArrayBuffer.isView(t))i="",r=(0,on.z)(),n=t;else if(t.startsWith("data:"))i=t,r="";else if(e){const s=t;if("/"===s.substr(0,1))return _.S0.Error("Wrong sceneFilename parameter"),null;i=e+s,r=s}else i=t,r=_.S0.GetFilename(t),e=_.S0.GetFolderPath(t);else i=e,r=_.S0.GetFilename(e),e=_.S0.GetFolderPath(e);return{url:i,rootUrl:e,name:r,file:s,rawData:n}}function gn(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:l.q.LastCreatedScene,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!r)return T.V.Error("No scene available to import mesh to"),null;const u=fn(t,i);if(!u)return null;const d={};r.addPendingData(d);const _=()=>{r.removePendingData(d)},p=(e,t)=>{const i=_n(u,e,t);a?a(r,i,new M.bu(i,M.tG.SceneLoaderError,t)):T.V.Error(i),_()},f=n?e=>{try{n(e)}catch(Qp){p("Error in onProgress callback: "+Qp,Qp)}}:void 0,g=(e,t,i,n,a,o,l,h)=>{if(r.importedMeshesFiles.push(u.url),s)try{s(e,t,i,n,a,o,l,h)}catch(Qp){p("Error in onSuccess callback: "+Qp,Qp)}r.removePendingData(d)};return pn(u,r,((t,i,s)=>{if(t.rewriteRootURL&&(u.rootUrl=t.rewriteRootURL(u.rootUrl,s)),t.importMesh){const s=[],n=[],a=[];if(!t.importMesh(e,r,i,u.rootUrl,s,n,a,p))return;r.loadingPluginName=t.name,g(s,n,a,[],[],[],[],[])}else{t.importMeshAsync(e,r,i,u.rootUrl,f,u.name).then((e=>{r.loadingPluginName=t.name,g(e.meshes,e.particleSystems,e.skeletons,e.animationGroups,e.transformNodes,e.geometries,e.lights,e.spriteManagers)})).catch((e=>{p(e.message,e)}))}}),f,p,_,o,h,c)}function mn(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l.q.LastCreatedEngine,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};return i?vn(e,t,new Gt.Z(i),r,s,n,a,o,h):(_.S0.Error("No engine available"),null)}function bn(e,t,i,r,s,n,a){return new Promise(((o,l)=>{mn(e,t,i,(e=>{o(e)}),r,((e,t,i)=>{l(i||new Error(t))}),s,n,a)}))}function vn(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l.q.LastCreatedScene,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!i)return T.V.Error("No scene available to append to"),null;const c=fn(e,t);if(!c)return null;const u={};i.addPendingData(u);const d=()=>{i.removePendingData(u)};q.ShowLoadingScreen&&!cn&&(cn=!0,i.getEngine().displayLoadingUI(),i.executeWhenReady((()=>{i.getEngine().hideLoadingUI(),cn=!1})));const _=(e,t)=>{const r=_n(c,e,t);n?n(i,r,new M.bu(r,M.tG.SceneLoaderError,t)):T.V.Error(r),d()},p=s?e=>{try{s(e)}catch(Qp){_("Error in onProgress callback",Qp)}}:void 0,f=()=>{if(r)try{r(i)}catch(Qp){_("Error in onSuccess callback",Qp)}i.removePendingData(u)};return pn(c,i,((e,t)=>{if(e.load){if(!e.load(i,t,c.rootUrl,_))return;i.loadingPluginName=e.name,f()}else{e.loadAsync(i,t,c.rootUrl,p,c.name).then((()=>{i.loadingPluginName=e.name,f()})).catch((e=>{_(e.message,e)}))}}),p,_,d,a,o,h)}function yn(e,t,i,r,s,n,a){return new Promise(((o,l)=>{vn(e,t,i,(e=>{o(e)}),r,((e,t,i)=>{l(i||new Error(t))}),s,n,a)}))}function Tn(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l.q.LastCreatedScene,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!i)return T.V.Error("No scene available to load asset container to"),null;const c=fn(e,t);if(!c)return null;const u={};i.addPendingData(u);const d=()=>{i.removePendingData(u)},_=(e,t)=>{const r=_n(c,e,t);n?n(i,r,new M.bu(r,M.tG.SceneLoaderError,t)):T.V.Error(r),d()},p=s?e=>{try{s(e)}catch(Qp){_("Error in onProgress callback",Qp)}}:void 0,f=e=>{if(r)try{r(e)}catch(Qp){_("Error in onSuccess callback",Qp)}i.removePendingData(u)};return pn(c,i,((e,t)=>{if(e.loadAssetContainer){const r=e.loadAssetContainer(i,t,c.rootUrl,_);if(!r)return;r.populateRootNodes(),i.loadingPluginName=e.name,f(r)}else if(e.loadAssetContainerAsync){e.loadAssetContainerAsync(i,t,c.rootUrl,p,c.name).then((t=>{t.populateRootNodes(),i.loadingPluginName=e.name,f(t)})).catch((e=>{_(e.message,e)}))}else _("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),p,_,d,a,o,h)}function xn(e,t,i,r,s,n,a){return new Promise(((o,l)=>{Tn(e,t,i,(e=>{o(e)}),r,((e,t,i)=>{l(i||new Error(t))}),s,n,a)}))}function An(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l.q.LastCreatedScene,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,u=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",d=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!i)return void T.V.Error("No scene available to load animations to");if(r){for(const e of i.animatables)e.reset();i.stopAllAnimations(),i.animationGroups.slice().forEach((e=>{e.dispose()}));i.getNodes().forEach((e=>{e.animations&&(e.animations=[])}))}else switch(s){case 0:i.animationGroups.slice().forEach((e=>{e.dispose()}));break;case 1:i.animationGroups.forEach((e=>{e.stop()}));break;case 2:i.animationGroups.forEach((e=>{e.reset(),e.restart()}));break;case 3:break;default:return void T.V.Error("Unknown animation group loading mode value '"+s+"'")}const _=i.animatables.length;Tn(e,t,i,(e=>{e.mergeAnimationsTo(i,i.animatables.slice(_),n),e.dispose(),i.onAnimationFileImportedObservable.notifyObservers(i),a&&a(i)}),o,h,c,u,d)}function Cn(e,t,i,r,s,n,a,o,l,h){return new Promise(((c,u)=>{An(e,t,i,r,s,n,(e=>{c(e)}),a,((e,t,i)=>{u(i||new Error(t))}),o,l,h)}))}class Rn{static get ForceFullSceneLoadingForIncremental(){return q.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(e){q.ForceFullSceneLoadingForIncremental=e}static get ShowLoadingScreen(){return q.ShowLoadingScreen}static set ShowLoadingScreen(e){q.ShowLoadingScreen=e}static get loggingLevel(){return q.loggingLevel}static set loggingLevel(e){q.loggingLevel=e}static get CleanBoneMatrixWeights(){return q.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(e){q.CleanBoneMatrixWeights=e}static GetDefaultPlugin(){return un()}static GetPluginForExtension(e){return dn(e)?.plugin}static IsPluginForExtensionAvailable(e){return function(e){return!!hn[e]}(e)}static RegisterPlugin(e){!function(e){if("string"===typeof e.extensions){const t=e.extensions;hn[t.toLowerCase()]={plugin:e,isBinary:!1}}else{const t=e.extensions;Object.keys(t).forEach((i=>{hn[i.toLowerCase()]={plugin:e,isBinary:t[i].isBinary}}))}}(e)}static ImportMesh(e,t,i,r,s,n,a,o,l){return gn(e,t,i,r,s,n,a,o,l)}static ImportMeshAsync(e,t,i,r,s,n,a){return function(e,t,i,r,s,n,a,o){return new Promise(((l,h)=>{gn(e,t,i,r,((e,t,i,r,s,n,a,o)=>{l({meshes:e,particleSystems:t,skeletons:i,animationGroups:r,transformNodes:s,geometries:n,lights:a,spriteManagers:o})}),s,((e,t,i)=>{h(i||new Error(t))}),n,a,o)}))}(e,t,i,r,s,n,a)}static Load(e,t,i,r,s,n,a,o){return mn(e,t,i,r,s,n,a,o)}static LoadAsync(e,t,i,r,s,n){return bn(e,t,i,r,s,n)}static Append(e,t,i,r,s,n,a,o){return vn(e,t,i,r,s,n,a,o)}static AppendAsync(e,t,i,r,s,n){return yn(e,t,i,r,s,n)}static LoadAssetContainer(e,t,i,r,s,n,a,o){return Tn(e,t,i,r,s,n,a,o)}static LoadAssetContainerAsync(e,t,i,r,s,n){return xn(e,t,i,r,s,n)}static ImportAnimations(e,t,i,r,s,n,a,o,l,h,c){An(e,t,i,r,s,n,a,o,l,h,c)}static ImportAnimationsAsync(e,t,i,r,s,n,a,o,l,h,c){return Cn(e,t,i,r,s,n,o,h,c)}}Rn.NO_LOGGING=0,Rn.MINIMAL_LOGGING=1,Rn.SUMMARY_LOGGING=2,Rn.DETAILED_LOGGING=3,Rn.OnPluginActivatedObservable=ln;class En{constructor(e,t,i,r){let s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],n=arguments.length>5?arguments[5]:void 0;this.scene=e,this.layout=t,this.gamepadObject=i,this.handedness=r,this._doNotLoadControllerMesh=s,this._controllerCache=n,this._initComponent=e=>{if(!e)return;const t=this.layout.components[e],i=t.type,r=t.gamepadIndices.button,s=[];void 0!==t.gamepadIndices.xAxis&&void 0!==t.gamepadIndices.yAxis&&s.push(t.gamepadIndices.xAxis,t.gamepadIndices.yAxis),this.components[e]=new sn(e,i,r,s)},this._modelReady=!1,this.components={},this.disableAnimation=!1,this.onModelLoadedObservable=new a.cP,t.components&&Object.keys(t.components).forEach(this._initComponent)}dispose(){this.getComponentIds().forEach((e=>this.getComponent(e).dispose())),this.rootMesh&&(this.rootMesh.getChildren(void 0,!0).forEach((e=>{e.setEnabled(!1)})),this.rootMesh.dispose(!!this._controllerCache,!this._controllerCache))}getAllComponentsOfType(e){return this.getComponentIds().map((e=>this.components[e])).filter((t=>t.type===e))}getComponent(e){return this.components[e]}getComponentIds(){return Object.keys(this.components)}getComponentOfType(e){return this.getAllComponentsOfType(e)[0]||null}getMainComponent(){return this.getComponent(this.layout.selectComponentId)}async loadModel(){const e=!this._getModelLoadingConstraints();let t=this._getGenericFilenameAndPath();return e?T.V.Warn("Falling back to generic models"):t=this._getFilenameAndPath(),new Promise(((i,r)=>{const s=t=>{e?this._getGenericParentMesh(t):this._setRootMesh(t),this._processLoadedModel(t),this._modelReady=!0,this.onModelLoadedObservable.notifyObservers(this),i(!0)};if(this._controllerCache){const e=this._controllerCache.filter((e=>e.filename===t.filename&&e.path===t.path));if(e[0])return e[0].meshes.forEach((e=>e.setEnabled(!0))),void s(e[0].meshes)}Rn.ImportMesh("",t.path,t.filename,this.scene,(e=>{this._controllerCache&&this._controllerCache.push({...t,meshes:e}),s(e)}),null,((e,i)=>{T.V.Log(i),T.V.Warn(`Failed to retrieve controller model of type ${this.profileId} from the remote server: ${t.path}${t.filename}`),r(i)}))}))}updateFromXRFrame(e){this.getComponentIds().forEach((e=>this.getComponent(e).update(this.gamepadObject))),this.updateModel(e)}get handness(){return this.handedness}pulse(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.gamepadObject.hapticActuators&&this.gamepadObject.hapticActuators[i]?this.gamepadObject.hapticActuators[i].pulse(e,t):Promise.resolve(!1)}_getChildByName(e,t){return e.getChildren((e=>e.name===t),!1)[0]}_getImmediateChildByName(e,t){return e.getChildren((e=>e.name==t),!0)[0]}_lerpTransform(e,t,i){if(!e.minMesh||!e.maxMesh||!e.valueMesh)return;if(!e.minMesh.rotationQuaternion||!e.maxMesh.rotationQuaternion||!e.valueMesh.rotationQuaternion)return;const r=i?.5*t+.5:t;o.PT.SlerpToRef(e.minMesh.rotationQuaternion,e.maxMesh.rotationQuaternion,r,e.valueMesh.rotationQuaternion),o.Pq.LerpToRef(e.minMesh.position,e.maxMesh.position,r,e.valueMesh.position)}updateModel(e){this._modelReady&&this._updateModel(e)}_getGenericFilenameAndPath(){return{filename:"generic.babylon",path:"https://controllers.babylonjs.com/generic/"}}_getGenericParentMesh(e){this.rootMesh=new Xe(this.profileId+" "+this.handedness,this.scene),e.forEach((e=>{e.parent||(e.isPickable=!1,e.setParent(this.rootMesh))})),this.rootMesh.rotationQuaternion=o.PT.FromEulerAngles(0,Math.PI,0)}}class Sn extends En{constructor(e,t,i){super(e,Mn[i],t,i),this.profileId=Sn.ProfileId}_getFilenameAndPath(){return{filename:"generic.babylon",path:"https://controllers.babylonjs.com/generic/"}}_getModelLoadingConstraints(){return!0}_processLoadedModel(e){}_setRootMesh(e){this.rootMesh=new Xe(this.profileId+" "+this.handedness,this.scene),e.forEach((e=>{e.isPickable=!1,e.parent||e.setParent(this.rootMesh)})),this.rootMesh.rotationQuaternion=o.PT.FromEulerAngles(0,Math.PI,0)}_updateModel(){}}Sn.ProfileId="generic-trigger";const Mn={left:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"generic-trigger-left",assetPath:"left.glb"},right:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"generic-trigger-right",assetPath:"right.glb"},none:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"generic-trigger-none",assetPath:"none.glb"}};class Pn extends En{constructor(e,t,i,r,s){super(e,i.layouts[t.handedness||"none"],t.gamepad,t.handedness,void 0,s),this._repositoryUrl=r,this.controllerCache=s,this._buttonMeshMapping={},this._touchDots={},this.profileId=i.profileId}dispose(){super.dispose(),this.controllerCache||Object.keys(this._touchDots).forEach((e=>{this._touchDots[e].dispose()}))}_getFilenameAndPath(){return{filename:this.layout.assetPath,path:`${this._repositoryUrl}/profiles/${this.profileId}/`}}_getModelLoadingConstraints(){const e=Rn.IsPluginForExtensionAvailable(".glb");return e||T.V.Warn("glTF / glb loader was not registered, using generic controller instead"),e}_processLoadedModel(e){this.getComponentIds().forEach((e=>{const t=this.layout.components[e];this._buttonMeshMapping[e]={mainMesh:this._getChildByName(this.rootMesh,t.rootNodeName),states:{}},Object.keys(t.visualResponses).forEach((i=>{const r=t.visualResponses[i];if("transform"===r.valueNodeProperty)this._buttonMeshMapping[e].states[i]={valueMesh:this._getChildByName(this.rootMesh,r.valueNodeName),minMesh:this._getChildByName(this.rootMesh,r.minNodeName),maxMesh:this._getChildByName(this.rootMesh,r.maxNodeName)};else{const s=t.type===sn.TOUCHPAD_TYPE&&t.touchPointNodeName?t.touchPointNodeName:r.valueNodeName;if(this._buttonMeshMapping[e].states[i]={valueMesh:this._getChildByName(this.rootMesh,s)},t.type===sn.TOUCHPAD_TYPE&&!this._touchDots[i]){const t=zi(i+"dot",{diameter:.0015,segments:8},this.scene);t.material=new zr(i+"mat",this.scene),t.material.diffuseColor=E.v9.Red(),t.parent=this._buttonMeshMapping[e].states[i].valueMesh||null,t.isVisible=!1,this._touchDots[i]=t}}}))}))}_setRootMesh(e){let t;this.rootMesh=new Xe(this.profileId+"-"+this.handedness,this.scene),this.rootMesh.isPickable=!1;for(let i=0;i<e.length;i++){const r=e[i];r.isPickable=!1,r.parent||(t=r)}t&&t.setParent(this.rootMesh),this.scene.useRightHandedSystem||this.rootMesh.rotate(J._0.Y,Math.PI,1)}_updateModel(e){this.disableAnimation||this.getComponentIds().forEach((e=>{const t=this.getComponent(e);if(!t.hasChanges)return;const i=this._buttonMeshMapping[e],r=this.layout.components[e];Object.keys(r.visualResponses).forEach((e=>{const s=r.visualResponses[e];let n=t.value;if("xAxis"===s.componentProperty?n=t.axes.x:"yAxis"===s.componentProperty&&(n=t.axes.y),"transform"===s.valueNodeProperty)this._lerpTransform(i.states[e],n,"button"!==s.componentProperty);else{const r=i.states[e].valueMesh;r&&(r.isVisible=t.touched||t.pressed),this._touchDots[e]&&(this._touchDots[e].isVisible=t.touched||t.pressed)}}))}))}}const In=[];class On{static ClearProfilesCache(){this._ProfilesList=null,this._ProfileLoadingPromises={}}static DefaultFallbacks(){this.RegisterFallbacksForProfileId("google-daydream",["generic-touchpad"]),this.RegisterFallbacksForProfileId("htc-vive-focus",["generic-trigger-touchpad"]),this.RegisterFallbacksForProfileId("htc-vive",["generic-trigger-squeeze-touchpad"]),this.RegisterFallbacksForProfileId("magicleap-one",["generic-trigger-squeeze-touchpad"]),this.RegisterFallbacksForProfileId("windows-mixed-reality",["generic-trigger-squeeze-touchpad-thumbstick"]),this.RegisterFallbacksForProfileId("microsoft-mixed-reality",["windows-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"]),this.RegisterFallbacksForProfileId("oculus-go",["generic-trigger-touchpad"]),this.RegisterFallbacksForProfileId("oculus-touch-v2",["oculus-touch","generic-trigger-squeeze-thumbstick"]),this.RegisterFallbacksForProfileId("oculus-touch",["generic-trigger-squeeze-thumbstick"]),this.RegisterFallbacksForProfileId("samsung-gearvr",["windows-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"]),this.RegisterFallbacksForProfileId("samsung-odyssey",["generic-touchpad"]),this.RegisterFallbacksForProfileId("valve-index",["generic-trigger-squeeze-touchpad-thumbstick"]),this.RegisterFallbacksForProfileId("generic-hand-select",["generic-trigger"])}static FindFallbackWithProfileId(e){const t=this._Fallbacks[e]||[];return t.unshift(e),t}static GetMotionControllerWithXRInput(e,t,i){const r=[];if(i&&r.push(i),r.push(...e.profiles||[]),r.length&&!r[0]&&r.pop(),e.gamepad&&e.gamepad.id&&e.gamepad.id===(e.gamepad.id.match(/oculus touch/gi)?e.gamepad.id:void 0))r.push("oculus-touch-v2");const s=r.indexOf("windows-mixed-reality");if(-1!==s&&r.splice(s,0,"microsoft-mixed-reality"),r.length||r.push("generic-trigger"),this.UseOnlineRepository){const i=this.PrioritizeOnlineRepository?this._LoadProfileFromRepository:this._LoadProfilesFromAvailableControllers,s=this.PrioritizeOnlineRepository?this._LoadProfilesFromAvailableControllers:this._LoadProfileFromRepository;return i.call(this,r,e,t).catch((()=>s.call(this,r,e,t)))}return this._LoadProfilesFromAvailableControllers(r,e,t)}static RegisterController(e,t){this._AvailableControllers[e]=t}static RegisterFallbacksForProfileId(e,t){this._Fallbacks[e]?this._Fallbacks[e].push(...t):this._Fallbacks[e]=t}static UpdateProfilesList(){return this._ProfilesList=_.S0.LoadFileAsync(this.BaseRepositoryUrl+"/profiles/profilesList.json",!1).then((e=>JSON.parse(e))),this._ProfilesList}static ClearControllerCache(){In.forEach((e=>{e.meshes.forEach((e=>{e.dispose(!1,!0)}))})),In.length=0}static _LoadProfileFromRepository(e,t,i){return Promise.resolve().then((()=>this._ProfilesList?this._ProfilesList:this.UpdateProfilesList())).then((t=>{for(let i=0;i<e.length;++i)if(e[i]&&t[e[i]])return e[i];throw new Error(`neither controller ${e[0]} nor all fallbacks were found in the repository,`)})).then((e=>(this._ProfileLoadingPromises[e]||(this._ProfileLoadingPromises[e]=_.S0.LoadFileAsync(`${this.BaseRepositoryUrl}/profiles/${e}/profile.json`,!1).then((e=>JSON.parse(e)))),this._ProfileLoadingPromises[e]))).then((e=>new Pn(i,t,e,this.BaseRepositoryUrl,this.DisableControllerCache?void 0:In)))}static _LoadProfilesFromAvailableControllers(e,t,i){for(let r=0;r<e.length;++r){if(!e[r])continue;const s=this.FindFallbackWithProfileId(e[r]);for(let e=0;e<s.length;++e){const r=this._AvailableControllers[s[e]];if(r)return Promise.resolve(r(t,i))}}throw new Error("no controller requested was found in the available controllers list")}}On._AvailableControllers={},On._Fallbacks={},On._ProfileLoadingPromises={},On.BaseRepositoryUrl="https://immersive-web.github.io/webxr-input-profiles/packages/viewer/dist",On.PrioritizeOnlineRepository=!0,On.UseOnlineRepository=!0,On.DisableControllerCache=!0,On.RegisterController(Sn.ProfileId,((e,t)=>new Sn(t,e.gamepad,e.handedness))),On.DefaultFallbacks();let Dn=0;class wn{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._scene=e,this.inputSource=t,this._options=i,this._tmpVector=new o.Pq,this._disposed=!1,this.onDisposeObservable=new a.cP,this.onMeshLoadedObservable=new a.cP,this.onMotionControllerInitObservable=new a.cP,this._uniqueId=`controller-${Dn++}-${t.targetRayMode}-${t.handedness}`,this.pointer=new Xe(`${this._uniqueId}-pointer`,e),this.pointer.rotationQuaternion=new o.PT,this.inputSource.gripSpace&&(this.grip=new Xe(`${this._uniqueId}-grip`,this._scene),this.grip.rotationQuaternion=new o.PT),this._tmpVector.set(0,0,this._scene.useRightHandedSystem?-1:1),this.inputSource.gamepad&&"tracked-pointer"===this.inputSource.targetRayMode&&On.GetMotionControllerWithXRInput(t,e,this._options.forceControllerProfile).then((e=>{this.motionController=e,this.onMotionControllerInitObservable.notifyObservers(e),this._options.doNotLoadControllerMesh||this.motionController._doNotLoadControllerMesh||this.motionController.loadModel().then((e=>{e&&this.motionController&&this.motionController.rootMesh&&(this._options.renderingGroupId&&(this.motionController.rootMesh.renderingGroupId=this._options.renderingGroupId,this.motionController.rootMesh.getChildMeshes(!1).forEach((e=>e.renderingGroupId=this._options.renderingGroupId))),this.onMeshLoadedObservable.notifyObservers(this.motionController.rootMesh),this.motionController.rootMesh.parent=this.grip||this.pointer,this.motionController.disableAnimation=!!this._options.disableMotionControllerAnimation),this._disposed&&this.motionController?.dispose()}))}),(()=>{_.S0.Warn("Could not find a matching motion controller for the registered input source")}))}get uniqueId(){return this._uniqueId}dispose(){this.grip&&this.grip.dispose(!0),this.motionController&&this.motionController.dispose(),this.pointer.dispose(!0),this.onMotionControllerInitObservable.clear(),this.onMeshLoadedObservable.clear(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this._disposed=!0}getWorldPointerRayToRef(e){const t=arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&this.grip?this.grip:this.pointer;o.Pq.TransformNormalToRef(this._tmpVector,t.getWorldMatrix(),e.direction),e.direction.normalize(),e.origin.copyFrom(t.absolutePosition),e.length=1e3}updateFromXRFrame(e,t,i,r){const s=e.getPose(this.inputSource.targetRaySpace,t);if(this._lastXRPose=s,s){const e=s.transform.position;this.pointer.position.set(e.x,e.y,e.z).scaleInPlace(r.worldScalingFactor);const t=s.transform.orientation;this.pointer.rotationQuaternion.set(t.x,t.y,t.z,t.w),this._scene.useRightHandedSystem||(this.pointer.position.z*=-1,this.pointer.rotationQuaternion.z*=-1,this.pointer.rotationQuaternion.w*=-1),this.pointer.parent=i.parent,this.pointer.scaling.setAll(r.worldScalingFactor)}if(this.inputSource.gripSpace&&this.grip){const s=e.getPose(this.inputSource.gripSpace,t);if(s){const e=s.transform.position,t=s.transform.orientation;this.grip.position.set(e.x,e.y,e.z).scaleInPlace(r.worldScalingFactor),this.grip.rotationQuaternion.set(t.x,t.y,t.z,t.w),this._scene.useRightHandedSystem||(this.grip.position.z*=-1,this.grip.rotationQuaternion.z*=-1,this.grip.rotationQuaternion.w*=-1)}this.grip.parent=i.parent,this.grip.scaling.setAll(r.worldScalingFactor)}this.motionController&&this.motionController.updateFromXRFrame(e)}}class Fn{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this.xrSessionManager=e,this.xrCamera=t,this._options=i,this.controllers=[],this.onControllerAddedObservable=new a.cP,this.onControllerRemovedObservable=new a.cP,this._onInputSourcesChange=e=>{this._addAndRemoveControllers(e.added,e.removed)},this._sessionEndedObserver=this.xrSessionManager.onXRSessionEnded.add((()=>{this._addAndRemoveControllers([],this.controllers.map((e=>e.inputSource)))})),this._sessionInitObserver=this.xrSessionManager.onXRSessionInit.add((e=>{e.addEventListener("inputsourceschange",this._onInputSourcesChange)})),this._frameObserver=this.xrSessionManager.onXRFrameObservable.add((e=>{this.controllers.forEach((t=>{t.updateFromXRFrame(e,this.xrSessionManager.referenceSpace,this.xrCamera,this.xrSessionManager)}))})),this._options.customControllersRepositoryURL&&(On.BaseRepositoryUrl=this._options.customControllersRepositoryURL),On.UseOnlineRepository=!this._options.disableOnlineControllerRepository,On.UseOnlineRepository)try{On.UpdateProfilesList().catch((()=>{On.UseOnlineRepository=!1}))}catch(Qp){On.UseOnlineRepository=!1}}_addAndRemoveControllers(e,t){const i=this.controllers.map((e=>e.inputSource));for(const n of e)if(-1===i.indexOf(n)){const e=new wn(this.xrSessionManager.scene,n,{...this._options.controllerOptions||{},forceControllerProfile:this._options.forceInputProfile,doNotLoadControllerMesh:this._options.doNotLoadControllerMeshes,disableMotionControllerAnimation:this._options.disableControllerAnimation});this.controllers.push(e),this.onControllerAddedObservable.notifyObservers(e)}const r=[],s=[];this.controllers.forEach((e=>{-1===t.indexOf(e.inputSource)?r.push(e):s.push(e)})),this.controllers=r,s.forEach((e=>{this.onControllerRemovedObservable.notifyObservers(e),e.dispose()}))}dispose(){this.controllers.forEach((e=>{e.dispose()})),this.xrSessionManager.onXRFrameObservable.remove(this._frameObserver),this.xrSessionManager.onXRSessionInit.remove(this._sessionInitObserver),this.xrSessionManager.onXRSessionEnded.remove(this._sessionEndedObserver),this.onControllerAddedObservable.clear(),this.onControllerRemovedObservable.clear(),On.ClearControllerCache()}}class Ln{get xrNativeFeatureName(){return this._xrNativeFeatureName}set xrNativeFeatureName(e){!this._xrSessionManager.isNative&&e&&this._xrSessionManager.inXRSession&&-1===this._xrSessionManager.enabledFeatures?.indexOf(e)&&T.V.Warn(`The feature ${e} needs to be enabled before starting the XR session. Note - It is still possible it is not supported.`),this._xrNativeFeatureName=e}constructor(e){this._xrSessionManager=e,this._attached=!1,this._removeOnDetach=[],this.isDisposed=!1,this.disableAutoAttach=!1,this._xrNativeFeatureName="",this.onFeatureAttachObservable=new a.cP,this.onFeatureDetachObservable=new a.cP}get attached(){return this._attached}attach(e){if(this.isDisposed)return!1;if(e)this.attached&&this.detach();else if(this.attached)return!1;if(this._xrSessionManager.enabledFeatures){if(!this._xrSessionManager.isNative&&this.xrNativeFeatureName&&-1===this._xrSessionManager.enabledFeatures.indexOf(this.xrNativeFeatureName))return!1}else T.V.Warn("session.enabledFeatures is not available on this device. It is possible that this feature is not supported.");return this._attached=!0,this._addNewAttachObserver(this._xrSessionManager.onXRFrameObservable,(e=>this._onXRFrame(e))),this.onFeatureAttachObservable.notifyObservers(this),!0}detach(){return this._attached?(this._attached=!1,this._removeOnDetach.forEach((e=>{e.observable.remove(e.observer)})),this.onFeatureDetachObservable.notifyObservers(this),!0):(this.disableAutoAttach=!0,!1)}dispose(){this.detach(),this.isDisposed=!0,this.onFeatureAttachObservable.clear(),this.onFeatureDetachObservable.clear()}isCompatible(){return!0}_addNewAttachObserver(e,t,i){this._removeOnDetach.push({observable:e,observer:e.add(t,void 0,i)})}}class Bn{getRenderCamera(e){if(this._renderCamera)return this._renderCamera;{let t;return t=this.originalScene.activeCameras&&this.originalScene.activeCameras.length>1?this.originalScene.activeCameras[this.originalScene.activeCameras.length-1]:this.originalScene.activeCamera,e&&t&&t.isRigCamera?t.rigParent:t}}setRenderCamera(e){this._renderCamera=e}_getSharedGizmoLight(){return this._sharedGizmoLight||(this._sharedGizmoLight=new Hr("shared gizmo light",new o.Pq(0,1,0),this.utilityLayerScene),this._sharedGizmoLight.intensity=2,this._sharedGizmoLight.groundColor=E.v9.Gray()),this._sharedGizmoLight}static get DefaultUtilityLayer(){return null==Bn._DefaultUtilityLayer?Bn._CreateDefaultUtilityLayerFromScene(l.q.LastCreatedScene):Bn._DefaultUtilityLayer}static _CreateDefaultUtilityLayerFromScene(e){return Bn._DefaultUtilityLayer=new Bn(e),Bn._DefaultUtilityLayer.originalScene.onDisposeObservable.addOnce((()=>{Bn._DefaultUtilityLayer=null})),Bn._DefaultUtilityLayer}static get DefaultKeepDepthUtilityLayer(){return null==Bn._DefaultKeepDepthUtilityLayer&&(Bn._DefaultKeepDepthUtilityLayer=new Bn(l.q.LastCreatedScene),Bn._DefaultKeepDepthUtilityLayer.utilityLayerScene.autoClearDepthAndStencil=!1,Bn._DefaultKeepDepthUtilityLayer.originalScene.onDisposeObservable.addOnce((()=>{Bn._DefaultKeepDepthUtilityLayer=null}))),Bn._DefaultKeepDepthUtilityLayer}constructor(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.originalScene=e,this._pointerCaptures={},this._lastPointerEvents={},this._sharedGizmoLight=null,this._renderCamera=null,this.pickUtilitySceneFirst=!0,this.shouldRender=!0,this.onlyCheckPointerDownEvents=!0,this.processAllEvents=!1,this.pickingEnabled=!0,this.onPointerOutObservable=new a.cP,this.utilityLayerScene=new Gt.Z(e.getEngine(),{virtual:!0}),this.utilityLayerScene.useRightHandedSystem=e.useRightHandedSystem,this.utilityLayerScene._allowPostProcessClearColor=!1,this.utilityLayerScene.postProcessesEnabled=!1,this.utilityLayerScene.detachControl(),t&&(this._originalPointerObserver=e.onPrePointerObservable.add((t=>{if(!this.utilityLayerScene.activeCamera)return;if(!this.pickingEnabled)return;if(!this.processAllEvents&&t.type!==Ke.Zp.POINTERMOVE&&t.type!==Ke.Zp.POINTERUP&&t.type!==Ke.Zp.POINTERDOWN&&t.type!==Ke.Zp.POINTERDOUBLETAP)return;this.utilityLayerScene.pointerX=e.pointerX,this.utilityLayerScene.pointerY=e.pointerY;const i=t.event;if(e.isPointerCaptured(i.pointerId))return void(this._pointerCaptures[i.pointerId]=!1);const r=i=>{let r=null;if(t.nearInteractionPickingInfo)r=t.nearInteractionPickingInfo.pickedMesh.getScene()==i?t.nearInteractionPickingInfo:new Q.G;else if(i!==this.utilityLayerScene&&t.originalPickingInfo)r=t.originalPickingInfo;else{let s=null;this._renderCamera&&(s=i._activeCamera,i._activeCamera=this._renderCamera,t.ray=null),r=t.ray?i.pickWithRay(t.ray):i.pick(e.pointerX,e.pointerY),s&&(i._activeCamera=s)}return r},s=r(this.utilityLayerScene);if(!t.ray&&s&&(t.ray=s.ray),this.utilityLayerScene.onPrePointerObservable.notifyObservers(t),this.onlyCheckPointerDownEvents&&t.type!=Ke.Zp.POINTERDOWN)return t.skipOnPointerObservable||this.utilityLayerScene.onPointerObservable.notifyObservers(new Ke.mx(t.type,t.event,s),t.type),void(t.type===Ke.Zp.POINTERUP&&this._pointerCaptures[i.pointerId]&&(this._pointerCaptures[i.pointerId]=!1));if(this.utilityLayerScene.autoClearDepthAndStencil||this.pickUtilitySceneFirst)s&&s.hit&&(t.skipOnPointerObservable||this.utilityLayerScene.onPointerObservable.notifyObservers(new Ke.mx(t.type,t.event,s),t.type),t.skipOnPointerObservable=!0);else{const i=r(e),n=t.event;i&&s&&(0===s.distance&&i.pickedMesh?this.mainSceneTrackerPredicate&&this.mainSceneTrackerPredicate(i.pickedMesh)?(this._notifyObservers(t,i,n),t.skipOnPointerObservable=!0):t.type===Ke.Zp.POINTERDOWN?this._pointerCaptures[n.pointerId]=!0:t.type!==Ke.Zp.POINTERMOVE&&t.type!==Ke.Zp.POINTERUP||(this._lastPointerEvents[n.pointerId]&&(this.onPointerOutObservable.notifyObservers(n.pointerId),delete this._lastPointerEvents[n.pointerId]),this._notifyObservers(t,i,n)):!this._pointerCaptures[n.pointerId]&&(s.distance<i.distance||0===i.distance)?(this._notifyObservers(t,s,n),t.skipOnPointerObservable||(t.skipOnPointerObservable=s.distance>0)):!this._pointerCaptures[n.pointerId]&&s.distance>=i.distance&&(this.mainSceneTrackerPredicate&&this.mainSceneTrackerPredicate(i.pickedMesh)?(this._notifyObservers(t,i,n),t.skipOnPointerObservable=!0):(t.type!==Ke.Zp.POINTERMOVE&&t.type!==Ke.Zp.POINTERUP||this._lastPointerEvents[n.pointerId]&&(this.onPointerOutObservable.notifyObservers(n.pointerId),delete this._lastPointerEvents[n.pointerId]),this._notifyObservers(t,s,n))),t.type===Ke.Zp.POINTERUP&&this._pointerCaptures[n.pointerId]&&(this._pointerCaptures[n.pointerId]=!1))}})),this._originalPointerObserver&&e.onPrePointerObservable.makeObserverTopPriority(this._originalPointerObserver)),this.utilityLayerScene.autoClear=!1,this._afterRenderObserver=this.originalScene.onAfterRenderCameraObservable.add((e=>{this.shouldRender&&e==this.getRenderCamera()&&this.render()})),this._sceneDisposeObserver=this.originalScene.onDisposeObservable.add((()=>{this.dispose()})),this._updateCamera()}_notifyObservers(e,t,i){e.skipOnPointerObservable||(this.utilityLayerScene.onPointerObservable.notifyObservers(new Ke.mx(e.type,e.event,t),e.type),this._lastPointerEvents[i.pointerId]=!0)}render(){if(this._updateCamera(),this.utilityLayerScene.activeCamera){const e=this.utilityLayerScene.activeCamera.getScene(),t=this.utilityLayerScene.activeCamera;t._scene=this.utilityLayerScene,t.leftCamera&&(t.leftCamera._scene=this.utilityLayerScene),t.rightCamera&&(t.rightCamera._scene=this.utilityLayerScene),this.utilityLayerScene.render(!1),t._scene=e,t.leftCamera&&(t.leftCamera._scene=e),t.rightCamera&&(t.rightCamera._scene=e)}}dispose(){this.onPointerOutObservable.clear(),this._afterRenderObserver&&this.originalScene.onAfterCameraRenderObservable.remove(this._afterRenderObserver),this._sceneDisposeObserver&&this.originalScene.onDisposeObservable.remove(this._sceneDisposeObserver),this._originalPointerObserver&&this.originalScene.onPrePointerObservable.remove(this._originalPointerObserver),this.utilityLayerScene.dispose()}_updateCamera(){this.utilityLayerScene.cameraToUseForPointers=this.getRenderCamera(),this.utilityLayerScene.activeCamera=this.getRenderCamera()}}Bn._DefaultUtilityLayer=null,Bn._DefaultKeepDepthUtilityLayer=null;class Nn extends Ln{constructor(e,t){super(e),this._options=t,this._attachController=e=>{if(this._controllers[e.uniqueId])return;const{laserPointer:t,selectionMesh:i}=this._generateNewMeshPair(this._options.forceGripIfAvailable&&e.grip?e.grip:e.pointer);switch(this._controllers[e.uniqueId]={xrController:e,laserPointer:t,selectionMesh:i,meshUnderPointer:null,pick:null,tmpRay:new xs(new o.Pq,new o.Pq),disabledByNearInteraction:!1,id:Nn._IdCounter++},this._attachedController?!this._options.enablePointerSelectionOnAllControllers&&this._options.preferredHandedness&&e.inputSource.handedness===this._options.preferredHandedness&&(this._attachedController=e.uniqueId):this._options.enablePointerSelectionOnAllControllers||(this._attachedController=e.uniqueId),e.inputSource.targetRayMode){case"tracked-pointer":return this._attachTrackedPointerRayMode(e);case"gaze":return this._attachGazeMode(e);case"screen":case"transient-pointer":return this._attachScreenRayMode(e)}},this._controllers={},this._tmpVectorForPickCompare=new o.Pq,this.disablePointerLighting=!0,this.disableSelectionMeshLighting=!0,this.displayLaserPointer=!0,this.displaySelectionMesh=!0,this.laserPointerPickedColor=new E.v9(.9,.9,.9),this.laserPointerDefaultColor=new E.v9(.7,.7,.7),this.selectionMeshDefaultColor=new E.v9(.8,.8,.8),this.selectionMeshPickedColor=new E.v9(.3,.3,1),this._identityMatrix=o.uq.Identity(),this._screenCoordinatesRef=o.Pq.Zero(),this._viewportRef=new A.L(0,0,0,0),this._scene=this._xrSessionManager.scene,void 0===this._options.lookAndPickMode&&(this._scene.getEngine()._badDesktopOS||this._scene.getEngine()._badOS)&&(this._options.lookAndPickMode=!0),this._options.lookAndPickMode&&(this._options.enablePointerSelectionOnAllControllers=!0,this.displayLaserPointer=!1)}attach(){if(!super.attach())return!1;if(this._options.xrInput.controllers.forEach(this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerAddedObservable,this._attachController,!0),this._addNewAttachObserver(this._options.xrInput.onControllerRemovedObservable,(e=>{this._detachController(e.uniqueId)}),!0),this._scene.constantlyUpdateMeshUnderPointer=!0,this._options.gazeCamera){const e=this._options.gazeCamera,{laserPointer:t,selectionMesh:i}=this._generateNewMeshPair(e);this._controllers.camera={webXRCamera:e,laserPointer:t,selectionMesh:i,meshUnderPointer:null,pick:null,tmpRay:new xs(new o.Pq,new o.Pq),disabledByNearInteraction:!1,id:Nn._IdCounter++},this._attachGazeMode()}return!0}detach(){return!!super.detach()&&(Object.keys(this._controllers).forEach((e=>{this._detachController(e)})),!0)}getMeshUnderPointer(e){return this._controllers[e]?this._controllers[e].meshUnderPointer:null}getXRControllerByPointerId(e){const t=Object.keys(this._controllers);for(let i=0;i<t.length;++i)if(this._controllers[t[i]].id===e)return this._controllers[t[i]].xrController||null;return null}_getPointerSelectionDisabledByPointerId(e){const t=Object.keys(this._controllers);for(let i=0;i<t.length;++i)if(this._controllers[t[i]].id===e)return this._controllers[t[i]].disabledByNearInteraction;return!0}_setPointerSelectionDisabledByPointerId(e,t){const i=Object.keys(this._controllers);for(let r=0;r<i.length;++r)if(this._controllers[i[r]].id===e)return void(this._controllers[i[r]].disabledByNearInteraction=t)}_onXRFrame(e){Object.keys(this._controllers).forEach((e=>{const t=this._controllers[e];if(this._options.lookAndPickMode&&"transient-pointer"!==t.xrController?.inputSource.targetRayMode)return;if(!this._options.enablePointerSelectionOnAllControllers&&e!==this._attachedController||t.disabledByNearInteraction)return t.selectionMesh.isVisible=!1,t.laserPointer.isVisible=!1,void(t.pick=null);let i;if(t.laserPointer.isVisible=this.displayLaserPointer,t.xrController)i=this._options.forceGripIfAvailable&&t.xrController.grip?t.xrController.grip.position:t.xrController.pointer.position,t.xrController.getWorldPointerRayToRef(t.tmpRay,this._options.forceGripIfAvailable);else{if(!t.webXRCamera)return;i=t.webXRCamera.position,t.webXRCamera.getForwardRayToRef(t.tmpRay)}if(this._options.maxPointerDistance&&(t.tmpRay.length=this._options.maxPointerDistance),!this._options.disableScenePointerVectorUpdate&&i){const e=this._xrSessionManager.scene,r=this._options.xrInput.xrCamera;r&&(r.viewport.toGlobalToRef(e.getEngine().getRenderWidth()/r.rigCameras.length,e.getEngine().getRenderHeight(),this._viewportRef),o.Pq.ProjectToRef(i,this._identityMatrix,r.getTransformationMatrix(),this._viewportRef,this._screenCoordinatesRef),"number"!==typeof this._screenCoordinatesRef.x||"number"!==typeof this._screenCoordinatesRef.y||isNaN(this._screenCoordinatesRef.x)||isNaN(this._screenCoordinatesRef.y)||this._screenCoordinatesRef.x===1/0||this._screenCoordinatesRef.y===1/0||(e.pointerX=this._screenCoordinatesRef.x,e.pointerY=this._screenCoordinatesRef.y,t.screenCoordinates={x:this._screenCoordinatesRef.x,y:this._screenCoordinatesRef.y}))}let r=null;this._utilityLayerScene&&(r=this._utilityLayerScene.pickWithRay(t.tmpRay,this._utilityLayerScene.pointerMovePredicate||this.raySelectionPredicate));const s=this._scene.pickWithRay(t.tmpRay,this._scene.pointerMovePredicate||this.raySelectionPredicate);r&&r.hit?s&&s.hit?r.distance<s.distance?t.pick=r:t.pick=s:t.pick=r:t.pick=s,t.pick&&t.xrController&&(t.pick.aimTransform=t.xrController.pointer,t.pick.gripTransform=t.xrController.grip||null,t.pick.originMesh=t.xrController.pointer);const n=t.pick;if(n&&n.pickedPoint&&n.hit){this._updatePointerDistance(t.laserPointer,n.distance),t.selectionMesh.position.copyFrom(n.pickedPoint),t.selectionMesh.scaling.x=Math.sqrt(n.distance),t.selectionMesh.scaling.y=Math.sqrt(n.distance),t.selectionMesh.scaling.z=Math.sqrt(n.distance);const e=this._convertNormalToDirectionOfRay(n.getNormal(!0),t.tmpRay),i=.001;if(t.selectionMesh.position.copyFrom(n.pickedPoint),e){const r=o.Pq.Cross(J._0.Y,e),s=o.Pq.Cross(e,r);o.Pq.RotationFromAxisToRef(s,e,r,t.selectionMesh.rotation),t.selectionMesh.position.addInPlace(e.scale(i))}t.selectionMesh.isVisible=this.displaySelectionMesh,t.meshUnderPointer=n.pickedMesh}else t.selectionMesh.isVisible=!1,this._updatePointerDistance(t.laserPointer,1),t.meshUnderPointer=null}))}get _utilityLayerScene(){return this._options.customUtilityLayerScene||Bn.DefaultUtilityLayer.utilityLayerScene}_attachGazeMode(e){const t=this._controllers[e&&e.uniqueId||"camera"],i=this._options.timeToSelect||3e3,r=this._options.useUtilityLayer?this._utilityLayerScene:this._scene;let s=new Q.G;const n=qi("selection",{diameter:.0525,thickness:.015,tessellation:20},r);n.isVisible=!1,n.isPickable=!1,n.parent=t.selectionMesh;let a=0,o=!1;const l={pointerId:t.id,pointerType:"xr"};t.onFrameObserver=this._xrSessionManager.onXRFrameObservable.add((()=>{if(t.pick){if(this._augmentPointerInit(l,t.id,t.screenCoordinates),t.laserPointer.material.alpha=0,n.isVisible=!1,t.pick.hit)if(this._pickingMoved(s,t.pick))o&&(this._options.disablePointerUpOnTouchOut||this._scene.simulatePointerUp(t.pick,l)),o=!1,a=0;else if(a>i/10&&(n.isVisible=!0),a+=this._scene.getEngine().getDeltaTime(),a>=i)this._scene.simulatePointerDown(t.pick,l),o=!0,this._options.disablePointerUpOnTouchOut&&this._scene.simulatePointerUp(t.pick,l),n.isVisible=!1;else{const e=1-a/i;n.scaling.set(e,e,e)}else o=!1,a=0;this._scene.simulatePointerMove(t.pick,l),s=t.pick}})),void 0!==this._options.renderingGroupId&&(n.renderingGroupId=this._options.renderingGroupId),e&&e.onDisposeObservable.addOnce((()=>{t.pick&&!this._options.disablePointerUpOnTouchOut&&o&&(this._scene.simulatePointerUp(t.pick,l),t.finalPointerUpTriggered=!0),n.dispose()}))}_attachScreenRayMode(e){const t=this._controllers[e.uniqueId];let i=!1;const r={pointerId:t.id,pointerType:"xr"};t.onFrameObserver=this._xrSessionManager.onXRFrameObservable.add((()=>{this._augmentPointerInit(r,t.id,t.screenCoordinates),!t.pick||this._options.disablePointerUpOnTouchOut&&i||(i?this._scene.simulatePointerMove(t.pick,r):(this._scene.simulatePointerDown(t.pick,r),t.pointerDownTriggered=!0,i=!0,this._options.disablePointerUpOnTouchOut&&this._scene.simulatePointerUp(t.pick,r)))})),e.onDisposeObservable.addOnce((()=>{this._augmentPointerInit(r,t.id,t.screenCoordinates),this._xrSessionManager.runInXRFrame((()=>{t.pick&&!t.finalPointerUpTriggered&&i&&!this._options.disablePointerUpOnTouchOut&&(this._scene.simulatePointerUp(t.pick,r),t.finalPointerUpTriggered=!0)}))}))}_attachTrackedPointerRayMode(e){const t=this._controllers[e.uniqueId];if(this._options.forceGazeMode)return this._attachGazeMode(e);const i={pointerId:t.id,pointerType:"xr"};if(t.onFrameObserver=this._xrSessionManager.onXRFrameObservable.add((()=>{t.laserPointer.material.disableLighting=this.disablePointerLighting,t.selectionMesh.material.disableLighting=this.disableSelectionMeshLighting,t.pick&&(this._augmentPointerInit(i,t.id,t.screenCoordinates),this._scene.simulatePointerMove(t.pick,i))})),e.inputSource.gamepad){const r=r=>{this._options.overrideButtonId&&(t.selectionComponent=r.getComponent(this._options.overrideButtonId)),t.selectionComponent||(t.selectionComponent=r.getMainComponent()),t.onButtonChangedObserver=t.selectionComponent.onButtonStateChangedObservable.add((r=>{if(r.changes.pressed){const s=r.changes.pressed.current;if(t.pick)(this._options.enablePointerSelectionOnAllControllers||e.uniqueId===this._attachedController)&&(this._augmentPointerInit(i,t.id,t.screenCoordinates),s?(this._scene.simulatePointerDown(t.pick,i),t.pointerDownTriggered=!0,t.selectionMesh.material.emissiveColor=this.selectionMeshPickedColor,t.laserPointer.material.emissiveColor=this.laserPointerPickedColor):(this._scene.simulatePointerUp(t.pick,i),t.selectionMesh.material.emissiveColor=this.selectionMeshDefaultColor,t.laserPointer.material.emissiveColor=this.laserPointerDefaultColor));else if(s&&!this._options.enablePointerSelectionOnAllControllers&&!this._options.disableSwitchOnClick){const t=this._controllers[this._attachedController];t&&t.pointerDownTriggered&&!t.finalPointerUpTriggered&&(this._augmentPointerInit(i,t.id,t.screenCoordinates),this._scene.simulatePointerUp(new Q.G,{pointerId:t.id,pointerType:"xr"}),t.finalPointerUpTriggered=!0),this._attachedController=e.uniqueId}}}))};e.motionController?r(e.motionController):e.onMotionControllerInitObservable.add(r)}else{const e=e=>{this._xrSessionManager.onXRFrameObservable.addOnce((()=>{this._augmentPointerInit(i,t.id,t.screenCoordinates),t.xrController&&e.inputSource===t.xrController.inputSource&&t.pick&&(this._scene.simulatePointerDown(t.pick,i),t.pointerDownTriggered=!0,t.selectionMesh.material.emissiveColor=this.selectionMeshPickedColor,t.laserPointer.material.emissiveColor=this.laserPointerPickedColor)}))},r=e=>{this._xrSessionManager.onXRFrameObservable.addOnce((()=>{this._augmentPointerInit(i,t.id,t.screenCoordinates),t.xrController&&e.inputSource===t.xrController.inputSource&&t.pick&&(this._scene.simulatePointerUp(t.pick,i),t.selectionMesh.material.emissiveColor=this.selectionMeshDefaultColor,t.laserPointer.material.emissiveColor=this.laserPointerDefaultColor)}))};t.eventListeners={selectend:r,selectstart:e},this._xrSessionManager.session.addEventListener("selectstart",e),this._xrSessionManager.session.addEventListener("selectend",r)}}_convertNormalToDirectionOfRay(e,t){if(e){Math.acos(o.Pq.Dot(e,t.direction))<Math.PI/2&&e.scaleInPlace(-1)}return e}_detachController(e){const t=this._controllers[e];if(t){if(t.selectionComponent&&t.onButtonChangedObserver&&t.selectionComponent.onButtonStateChangedObservable.remove(t.onButtonChangedObserver),t.onFrameObserver&&this._xrSessionManager.onXRFrameObservable.remove(t.onFrameObserver),t.eventListeners&&Object.keys(t.eventListeners).forEach((e=>{const i=t.eventListeners&&t.eventListeners[e];i&&this._xrSessionManager.session.removeEventListener(e,i)})),!t.finalPointerUpTriggered&&t.pointerDownTriggered){const e={pointerId:t.id,pointerType:"xr"};this._xrSessionManager.runInXRFrame((()=>{this._augmentPointerInit(e,t.id,t.screenCoordinates),this._scene.simulatePointerUp(t.pick||new Q.G,e),t.finalPointerUpTriggered=!0}))}this._xrSessionManager.scene.onBeforeRenderObservable.addOnce((()=>{try{if(t.selectionMesh.dispose(),t.laserPointer.dispose(),delete this._controllers[e],this._attachedController===e){const e=Object.keys(this._controllers);e.length?this._attachedController=e[0]:this._attachedController=""}}catch(Qp){_.S0.Warn("controller already detached.")}}))}}_generateNewMeshPair(e){const t=this._options.useUtilityLayer?this._options.customUtilityLayerScene||Bn.DefaultUtilityLayer.utilityLayerScene:this._scene,i=this._options.customLasterPointerMeshGenerator?this._options.customLasterPointerMeshGenerator():Hi("laserPointer",{height:1,diameterTop:2e-4,diameterBottom:.004,tessellation:20,subdivisions:1},t);i.parent=e;const r=new zr("laserPointerMat",t);r.emissiveColor=this.laserPointerDefaultColor,r.alpha=.7,i.material=r,i.rotation.x=Math.PI/2,this._updatePointerDistance(i,1),i.isPickable=!1,i.isVisible=!1;const s=this._options.customSelectionMeshGenerator?this._options.customSelectionMeshGenerator():qi("gazeTracker",{diameter:.0105,thickness:.0075,tessellation:20},t);s.bakeCurrentTransformIntoVertices(),s.isPickable=!1,s.isVisible=!1;const n=new zr("targetMat",t);return n.specularColor=E.v9.Black(),n.emissiveColor=this.selectionMeshDefaultColor,n.backFaceCulling=!1,s.material=n,void 0!==this._options.renderingGroupId&&(i.renderingGroupId=this._options.renderingGroupId,s.renderingGroupId=this._options.renderingGroupId),{laserPointer:i,selectionMesh:s}}_pickingMoved(e,t){if(!e.hit||!t.hit)return!0;if(!e.pickedMesh||!e.pickedPoint||!t.pickedMesh||!t.pickedPoint)return!0;if(e.pickedMesh!==t.pickedMesh)return!0;e.pickedPoint?.subtractToRef(t.pickedPoint,this._tmpVectorForPickCompare),this._tmpVectorForPickCompare.set(Math.abs(this._tmpVectorForPickCompare.x),Math.abs(this._tmpVectorForPickCompare.y),Math.abs(this._tmpVectorForPickCompare.z));const i=.01*(this._options.gazeModePointerMovedFactor||1)*t.distance;return this._tmpVectorForPickCompare.length()>i}_updatePointerDistance(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;e.scaling.y=t,this._scene.useRightHandedSystem&&(t*=-1),e.position.z=t/2+.05}_augmentPointerInit(e,t,i){e.pointerId=t,e.pointerType="xr",i&&(e.screenX=i.x,e.screenY=i.y)}get lasterPointerDefaultColor(){return this.laserPointerDefaultColor}}var kn,Un;Nn._IdCounter=200,Nn.Name=Zs.POINTER_SELECTION,Nn.Version=1,Js.AddWebXRFeature(Nn.Name,((e,t)=>()=>new Nn(e,t)),Nn.Version,!0),function(e){e[e.Float=1]="Float",e[e.Int=2]="Int",e[e.Vector2=4]="Vector2",e[e.Vector3=8]="Vector3",e[e.Vector4=16]="Vector4",e[e.Color3=32]="Color3",e[e.Color4=64]="Color4",e[e.Matrix=128]="Matrix",e[e.Object=256]="Object",e[e.AutoDetect=1024]="AutoDetect",e[e.BasedOnInput=2048]="BasedOnInput",e[e.All=4095]="All"}(kn||(kn={})),function(e){e[e.Vertex=1]="Vertex",e[e.Fragment=2]="Fragment",e[e.Neutral=4]="Neutral",e[e.VertexAndFragment=3]="VertexAndFragment"}(Un||(Un={}));class Vn{constructor(){this.supportUniformBuffers=!1,this.attributes=[],this.uniforms=[],this.constants=[],this.samplers=[],this.functions={},this.extensions={},this.prePassOutput={},this.counters={},this._attributeDeclaration="",this._uniformDeclaration="",this._constantDeclaration="",this._samplerDeclaration="",this._varyingTransfer="",this._injectAtEnd="",this._repeatableContentAnchorIndex=0,this._builtCompilationString="",this.compilationString=""}get shaderLanguage(){return this.sharedData.nodeMaterial.shaderLanguage}get fSuffix(){return 1===this.shaderLanguage?"f":""}finalize(e){const t=e.sharedData.emitComments,i=this.target===Un.Fragment;1===this.shaderLanguage?this.compilationString=i?`\n${t?"//Entry point\n":""}@fragment\nfn main(input: FragmentInputs) -> FragmentOutputs {\n${this.compilationString}`:`\n${t?"//Entry point\n":""}@vertex\nfn main(input: VertexInputs) -> FragmentInputs{\n${this.compilationString}`:this.compilationString=`\n${t?"//Entry point\n":""}void main(void) {\n${this.compilationString}`,this._constantDeclaration&&(this.compilationString=`\n${t?"//Constants\n":""}${this._constantDeclaration}\n${this.compilationString}`);let r="";for(const s in this.functions)r+=this.functions[s]+"\n";if(this.compilationString=`\n${r}\n${this.compilationString}`,!i&&this._varyingTransfer&&(this.compilationString=`${this.compilationString}\n${this._varyingTransfer}`),this._injectAtEnd&&(this.compilationString=`${this.compilationString}\n${this._injectAtEnd}`),this.compilationString=`${this.compilationString}\n}`,this.sharedData.varyingDeclaration&&(this.compilationString=`\n${t?"//Varyings\n":""}${this.sharedData.varyingDeclaration}\n${this.compilationString}`),this._samplerDeclaration&&(this.compilationString=`\n${t?"//Samplers\n":""}${this._samplerDeclaration}\n${this.compilationString}`),this._uniformDeclaration&&(this.compilationString=`\n${t?"//Uniforms\n":""}${this._uniformDeclaration}\n${this.compilationString}`),this._attributeDeclaration&&!i&&(this.compilationString=`\n${t?"//Attributes\n":""}${this._attributeDeclaration}\n${this.compilationString}`),1!==this.shaderLanguage){this.compilationString="precision highp float;\n"+this.compilationString,this.compilationString="#if defined(WEBGL2) || defined(WEBGPU)\nprecision highp sampler2DArray;\n#endif\n"+this.compilationString,i&&(this.compilationString="#if defined(PREPASS)\r\n#extension GL_EXT_draw_buffers : require\r\nlayout(location = 0) out highp vec4 glFragData[SCENE_MRT_COUNT];\r\nhighp vec4 gl_FragColor;\r\n#endif\r\n"+this.compilationString);for(const e in this.extensions){const t=this.extensions[e];this.compilationString=`\n${t}\n${this.compilationString}`}}this._builtCompilationString=this.compilationString}get _repeatableContentAnchor(){return`###___ANCHOR${this._repeatableContentAnchorIndex++}___###`}_getFreeVariableName(e){return e=e.replace(/[^a-zA-Z_]+/g,""),void 0===this.sharedData.variableNames[e]?(this.sharedData.variableNames[e]=0,"output"===e||"texture"===e?e+this.sharedData.variableNames[e]:e):(this.sharedData.variableNames[e]++,e+this.sharedData.variableNames[e])}_getFreeDefineName(e){return void 0===this.sharedData.defineNames[e]?this.sharedData.defineNames[e]=0:this.sharedData.defineNames[e]++,e+this.sharedData.defineNames[e]}_excludeVariableName(e){this.sharedData.variableNames[e]=0}_emit2DSampler(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];(this.samplers.indexOf(e)<0||i)&&(t&&(this._samplerDeclaration+=`#if ${t}\n`),1===this.shaderLanguage?(this._samplerDeclaration+=`var ${e+"Sampler"}: sampler;\n`,this._samplerDeclaration+=`var ${e}: texture_2d<f32>;\n`):this._samplerDeclaration+=`uniform sampler2D ${e};\n`,t&&(this._samplerDeclaration+="#endif\n"),i||this.samplers.push(e))}_emitCubeSampler(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];(this.samplers.indexOf(e)<0||i)&&(t&&(this._samplerDeclaration+=`#if ${t}\n`),1===this.shaderLanguage?(this._samplerDeclaration+=`var ${e+"Sampler"}: sampler;\n`,this._samplerDeclaration+=`var ${e}: texture_cube<f32>;\n`):this._samplerDeclaration+=`uniform samplerCube ${e};\n`,t&&(this._samplerDeclaration+="#endif\n"),i||this.samplers.push(e))}_emit2DArraySampler(e){this.samplers.indexOf(e)<0&&(this._samplerDeclaration+=`uniform sampler2DArray ${e};\n`,this.samplers.push(e))}_getGLType(e){switch(e){case kn.Float:return"float";case kn.Int:return"int";case kn.Vector2:return"vec2";case kn.Color3:case kn.Vector3:return"vec3";case kn.Color4:case kn.Vector4:return"vec4";case kn.Matrix:return"mat4"}return""}_getShaderType(e){const t=1===this.shaderLanguage;switch(e){case kn.Float:return t?"f32":"float";case kn.Int:return t?"i32":"int";case kn.Vector2:return t?"vec2f":"vec2";case kn.Color3:case kn.Vector3:return t?"vec3f":"vec3";case kn.Color4:case kn.Vector4:return t?"vec4f":"vec4";case kn.Matrix:return t?"mat4x4f":"mat4"}return""}_emitExtension(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this.extensions[e]||(i&&(t=`#if ${i}\n${t}\n#endif`),this.extensions[e]=t)}_emitFunction(e,t,i){this.functions[e]||(this.sharedData.emitComments&&(t=i+"\n"+t),this.functions[e]=t)}_emitCodeFromInclude(e,t,i){const r=qt.l.GetIncludesShadersStore(this.shaderLanguage);if(i&&i.repeatKey)return`#include<${e}>${i.substitutionVars?"("+i.substitutionVars+")":""}[0..${i.repeatKey}]\n`;let s=r[e]+"\n";if(this.sharedData.emitComments&&(s=t+"\n"+s),!i)return s;if(i.replaceStrings)for(let n=0;n<i.replaceStrings.length;n++){const e=i.replaceStrings[n];s=s.replace(e.search,e.replace)}return s}_emitFunctionFromInclude(e,t,i){const r=e+(arguments.length>3&&void 0!==arguments[3]?arguments[3]:"");if(this.functions[r])return;const s=qt.l.GetIncludesShadersStore(this.shaderLanguage);if(!i||!i.removeAttributes&&!i.removeUniforms&&!i.removeVaryings&&!i.removeIfDef&&!i.replaceStrings)return i&&i.repeatKey?this.functions[r]=`#include<${e}>${i.substitutionVars?"("+i.substitutionVars+")":""}[0..${i.repeatKey}]\n`:this.functions[r]=`#include<${e}>${i?.substitutionVars?"("+i?.substitutionVars+")":""}\n`,void(this.sharedData.emitComments&&(this.functions[r]=t+"\n"+this.functions[r]));if(this.functions[r]=s[e],this.sharedData.emitComments&&(this.functions[r]=t+"\n"+this.functions[r]),i.removeIfDef&&(this.functions[r]=this.functions[r].replace(/^\s*?#ifdef.+$/gm,""),this.functions[r]=this.functions[r].replace(/^\s*?#endif.*$/gm,""),this.functions[r]=this.functions[r].replace(/^\s*?#else.*$/gm,""),this.functions[r]=this.functions[r].replace(/^\s*?#elif.*$/gm,"")),i.removeAttributes&&(this.functions[r]=this.functions[r].replace(/\s*?attribute .+?;/g,"\n")),i.removeUniforms&&(this.functions[r]=this.functions[r].replace(/\s*?uniform .*?;/g,"\n")),i.removeVaryings&&(this.functions[r]=this.functions[r].replace(/\s*?(varying|in) .+?;/g,"\n")),i.replaceStrings)for(let n=0;n<i.replaceStrings.length;n++){const e=i.replaceStrings[n];this.functions[r]=this.functions[r].replace(e.search,e.replace)}}_registerTempVariable(e){return-1===this.sharedData.temps.indexOf(e)&&(this.sharedData.temps.push(e),!0)}_emitVaryingFromString(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(-1!==this.sharedData.varyings.indexOf(e))return!1;this.sharedData.varyings.push(e),i&&(i.startsWith("defined(")?this.sharedData.varyingDeclaration+=`#if ${i}\n`:this.sharedData.varyingDeclaration+=`${r?"#ifndef":"#ifdef"} ${i}\n`);const s=this._getShaderType(t);return 1===this.shaderLanguage?this.sharedData.varyingDeclaration+=`varying ${e}: ${s};\n`:this.sharedData.varyingDeclaration+=`varying ${s} ${e};\n`,i&&(this.sharedData.varyingDeclaration+="#endif\n"),!0}_getVaryingName(e){return 1===this.shaderLanguage?(this.target!==Un.Fragment?"vertexOutputs.":"fragmentInputs.")+e:e}_emitUniformFromString(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(-1!==this.uniforms.indexOf(e))return;this.uniforms.push(e),i&&(i.startsWith("defined(")?this._uniformDeclaration+=`#if ${i}\n`:this._uniformDeclaration+=`${r?"#ifndef":"#ifdef"} ${i}\n`);const s=this._getShaderType(t);1===this.shaderLanguage?this._uniformDeclaration+=`uniform ${e}: ${s};\n`:this._uniformDeclaration+=`uniform ${s} ${e};\n`,i&&(this._uniformDeclaration+="#endif\n")}_generateTernary(e,t,i){return 1===this.shaderLanguage?`select(${t}, ${e}, ${i})`:`(${i}) ? ${e} : ${t}`}_emitFloat(e){return e.toString()===e.toFixed(0)?`${e}.0`:e.toString()}_declareOutput(e,t){return this._declareLocalVar(e.associatedVariableName,e.type,t)}_declareLocalVar(e,t,i){return 1===this.shaderLanguage?`${i?"const":"var"} ${e}: ${this._getShaderType(t)}`:`${this._getShaderType(t)} ${e}`}_samplerCubeFunc(){return 1===this.shaderLanguage?"textureSample":"textureCube"}_samplerFunc(){return 1===this.shaderLanguage?"textureSample":"texture2D"}_samplerLODFunc(){return 1===this.shaderLanguage?"textureSampleLevel":"texture2DLodEXT"}_toLinearSpace(e){return 1===this.shaderLanguage&&(e.type===kn.Color3||e.type===kn.Vector3)?`toLinearSpaceVec3(${e.associatedVariableName})`:`toLinearSpace(${e.associatedVariableName})`}_generateTextureSample(e,t){return 1===this.shaderLanguage?`${this._samplerFunc()}(${t},${t+"Sampler"}, ${e})`:`${this._samplerFunc()}(${t}, ${e})`}_generateTextureSampleLOD(e,t,i){return 1===this.shaderLanguage?`${this._samplerLODFunc()}(${t},${t+"Sampler"}, ${e}, ${i})`:`${this._samplerLODFunc()}(${t}, ${e}, ${i})`}_generateTextureSampleCube(e,t){return 1===this.shaderLanguage?`${this._samplerCubeFunc()}(${t},${t+"Sampler"}, ${e})`:`${this._samplerCubeFunc()}(${t}, ${e})`}_generateTextureSampleCubeLOD(e,t,i){return 1===this.shaderLanguage?`${this._samplerCubeFunc()}(${t},${t+"Sampler"}, ${e}, ${i})`:`${this._samplerCubeFunc()}(${t}, ${e}, ${i})`}_convertVariableDeclarationToWGSL(e,t,i){return i.replace(new RegExp(`(${e})\\s+(\\w+)`,"g"),`var $2: ${t}`)}_convertVariableConstructorsToWGSL(e,t,i){return i.replace(new RegExp(`(${e})\\(`,"g"),` ${t}(`)}_convertOutParametersToWGSL(e){return e.replace(new RegExp("out\\s+var\\s+(\\w+)\\s*:\\s*(\\w+)","g"),"$1: ptr<function, $2>")}_convertTernaryOperandsToWGSL(e){return e.replace(new RegExp("\\[(.*?)\\?(.*?):(.*)\\]","g"),((e,t,i,r)=>`select(${r}, ${i}, ${t})`))}_convertModOperatorsToWGSL(e){return e.replace(new RegExp("mod\\((.+?),\\s*(.+?)\\)","g"),((e,t,i)=>`((${t})%(${i}))`))}_convertConstToWGSL(e){return e.replace(new RegExp("const var","g"),"const")}_convertInnerFunctionsToWGSL(e){return e.replace(new RegExp("inversesqrt","g"),"inverseSqrt")}_convertFunctionsToWGSL(e){const t=/var\s+(\w+)\s*:\s*(\w+)\((.*)\)/g;let i;for(;null!==(i=t.exec(e));){const t=i[1],r=i[2],s=i[3].replace(/var\s/g,"");e=e.replace(i[0],`fn ${t}(${s}) -> ${r}`)}return e}_babylonSLtoWGSL(e){return e=this._convertVariableDeclarationToWGSL("void","voidnull",e),e=this._convertVariableDeclarationToWGSL("bool","bool",e),e=this._convertVariableDeclarationToWGSL("int","i32",e),e=this._convertVariableDeclarationToWGSL("uint","u32",e),e=this._convertVariableDeclarationToWGSL("float","f32",e),e=this._convertVariableDeclarationToWGSL("vec2","vec2f",e),e=this._convertVariableDeclarationToWGSL("vec3","vec3f",e),e=this._convertVariableDeclarationToWGSL("vec4","vec4f",e),e=this._convertVariableDeclarationToWGSL("mat2","mat2x2f",e),e=this._convertVariableDeclarationToWGSL("mat3","mat3x3f",e),e=this._convertVariableDeclarationToWGSL("mat4","mat4x4f",e),e=this._convertVariableConstructorsToWGSL("float","f32",e),e=this._convertVariableConstructorsToWGSL("vec2","vec2f",e),e=this._convertVariableConstructorsToWGSL("vec3","vec3f",e),e=this._convertVariableConstructorsToWGSL("vec4","vec4f",e),e=this._convertVariableConstructorsToWGSL("mat2","mat2x2f",e),e=this._convertVariableConstructorsToWGSL("mat3","mat3x3f",e),e=this._convertVariableConstructorsToWGSL("mat4","mat4x4f",e),e=this._convertTernaryOperandsToWGSL(e),e=this._convertModOperatorsToWGSL(e),e=this._convertConstToWGSL(e),e=this._convertInnerFunctionsToWGSL(e),e=(e=this._convertOutParametersToWGSL(e)).replace(/\[\*\]/g,"*"),e=(e=(e=(e=this._convertFunctionsToWGSL(e)).replace(/\s->\svoidnull/g,"")).replace(/dFdx/g,"dpdx")).replace(/dFdy/g,"dpdy")}_convertTernaryOperandsToGLSL(e){return e.replace(new RegExp("\\[(.+?)\\?(.+?):(.+)\\]","g"),((e,t,i,r)=>`${t} ? ${i} : ${r}`))}_babylonSLtoGLSL(e){return e=e.replace(/\[\*\]/g,""),e=this._convertTernaryOperandsToGLSL(e)}}var zn,Gn,Hn=i(4909);class Wn{constructor(){this.temps=[],this.varyings=[],this.varyingDeclaration="",this.inputBlocks=[],this.textureBlocks=[],this.bindableBlocks=[],this.forcedBindableBlocks=[],this.blocksWithFallbacks=[],this.blocksWithDefines=[],this.repeatableContentBlocks=[],this.dynamicUniformBlocks=[],this.blockingBlocks=[],this.animatedInputs=[],this.variableNames={},this.defineNames={},this.hints={needWorldViewMatrix:!1,needWorldViewProjectionMatrix:!1,needAlphaBlending:!1,needAlphaTesting:!1},this.checks={emitVertex:!1,emitFragment:!1,notConnectedNonOptionalInputs:new Array},this.allowEmptyVertexProgram=!1,this.variableNames.position=0,this.variableNames.normal=0,this.variableNames.tangent=0,this.variableNames.uv=0,this.variableNames.uv2=0,this.variableNames.uv3=0,this.variableNames.uv4=0,this.variableNames.uv5=0,this.variableNames.uv6=0,this.variableNames.color=0,this.variableNames.matricesIndices=0,this.variableNames.matricesWeights=0,this.variableNames.matricesIndicesExtra=0,this.variableNames.matricesWeightsExtra=0,this.variableNames.diffuseBase=0,this.variableNames.specularBase=0,this.variableNames.worldPos=0,this.variableNames.shadow=0,this.variableNames.view=0,this.variableNames.vTBN=0,this.defineNames.MAINUV0=0,this.defineNames.MAINUV1=0,this.defineNames.MAINUV2=0,this.defineNames.MAINUV3=0,this.defineNames.MAINUV4=0,this.defineNames.MAINUV5=0,this.defineNames.MAINUV6=0,this.defineNames.MAINUV7=0}emitErrors(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t="";this.checks.emitVertex||this.allowEmptyVertexProgram||(t+="NodeMaterial does not have a vertex output. You need to at least add a block that generates a position value.\n"),this.checks.emitFragment||(t+="NodeMaterial does not have a fragment output. You need to at least add a block that generates a color value.\n");for(const i of this.checks.notConnectedNonOptionalInputs)t+=`input ${i.name} from block ${i.ownerBlock.name}[${i.ownerBlock.getClassName()}] is not connected and is not optional.\n`;return!t||(e&&e.notifyObservers(t),T.V.Error("Build of NodeMaterial failed:\n"+t),!1)}}!function(e){e[e.Compatible=0]="Compatible",e[e.TypeIncompatible=1]="TypeIncompatible",e[e.TargetIncompatible=2]="TargetIncompatible",e[e.HierarchyIssue=3]="HierarchyIssue"}(zn||(zn={})),function(e){e[e.Input=0]="Input",e[e.Output=1]="Output"}(Gn||(Gn={}));class qn{static AreEquivalentTypes(e,t){switch(e){case kn.Vector3:if(t===kn.Color3)return!0;break;case kn.Vector4:if(t===kn.Color4)return!0;break;case kn.Color3:if(t===kn.Vector3)return!0;break;case kn.Color4:if(t===kn.Vector4)return!0}return!1}get _connectedPoint(){return this._connectedPointBackingField}set _connectedPoint(e){this._connectedPointBackingField!==e&&(this._connectedPointTypeChangedObserver?.remove(),this._updateTypeDependentState((()=>this._connectedPointBackingField=e)),this._connectedPointBackingField&&(this._connectedPointTypeChangedObserver=this._connectedPointBackingField.onTypeChangedObservable.add((()=>{this._notifyTypeChanged()}))))}get _typeConnectionSource(){return this._typeConnectionSourceBackingField}set _typeConnectionSource(e){this._typeConnectionSourceBackingField!==e&&(this._typeConnectionSourceTypeChangedObserver?.remove(),this._updateTypeDependentState((()=>this._typeConnectionSourceBackingField=e)),this._typeConnectionSourceBackingField&&(this._typeConnectionSourceTypeChangedObserver=this._typeConnectionSourceBackingField.onTypeChangedObservable.add((()=>{this._notifyTypeChanged()}))))}get _defaultConnectionPointType(){return this._defaultConnectionPointTypeBackingField}set _defaultConnectionPointType(e){this._updateTypeDependentState((()=>this._defaultConnectionPointTypeBackingField=e))}get _linkedConnectionSource(){return this._linkedConnectionSourceBackingField}set _linkedConnectionSource(e){this._linkedConnectionSourceBackingField!==e&&(this._linkedConnectionSourceTypeChangedObserver?.remove(),this._updateTypeDependentState((()=>this._linkedConnectionSourceBackingField=e)),this._linkedConnectionSourceBackingField&&(this._linkedConnectionSourceTypeChangedObserver=this._linkedConnectionSourceBackingField.onTypeChangedObservable.add((()=>{this._notifyTypeChanged()}))))}get direction(){return this._direction}get declarationVariableName(){return this._ownerBlock.isInput?this._ownerBlock.declarationVariableName:this._enforceAssociatedVariableName&&this._associatedVariableName||!this._connectedPoint?this._associatedVariableName:this._connectedPoint.declarationVariableName}get associatedVariableName(){return this._ownerBlock.isInput?this._ownerBlock.associatedVariableName:this._enforceAssociatedVariableName&&this._associatedVariableName||!this._connectedPoint?this._associatedVariableName:this._connectedPoint.associatedVariableName}set associatedVariableName(e){this._associatedVariableName=e}get innerType(){return this._linkedConnectionSource&&this._linkedConnectionSource.isConnected?this.type:this._type}get type(){if(this._type===kn.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource&&this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type}if(this._type===kn.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(e){this._updateTypeDependentState((()=>this._type=e))}get target(){return this._prioritizeVertex&&this._ownerBlock?this._target!==Un.VertexAndFragment?this._target:this._ownerBlock.target===Un.Fragment?Un.Fragment:Un.Vertex:this._target}set target(e){this._target=e}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get isConnectedToInputBlock(){return null!==this.connectedPoint&&this.connectedPoint.ownerBlock.isInput}get connectInputBlock(){return this.isConnectedToInputBlock?this.connectedPoint.ownerBlock:null}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((e=>e.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get isDirectlyConnectedToVertexOutput(){if(!this.hasEndpoints)return!1;for(const e of this._endpoints){if(e.ownerBlock.target===Un.Vertex)return!0;if((e.ownerBlock.target===Un.Neutral||e.ownerBlock.target===Un.VertexAndFragment)&&e.ownerBlock.outputs.some((e=>e.isDirectlyConnectedToVertexOutput)))return!0}return!1}get isConnectedInVertexShader(){if(this.target===Un.Vertex)return!0;if(!this.hasEndpoints)return!1;for(const e of this._endpoints){if(e.ownerBlock.target===Un.Vertex)return!0;if(e.target===Un.Vertex)return!0;if((e.ownerBlock.target===Un.Neutral||e.ownerBlock.target===Un.VertexAndFragment)&&e.ownerBlock.outputs.some((e=>e.isConnectedInVertexShader)))return!0}return!1}get isConnectedInFragmentShader(){if(this.target===Un.Fragment)return!0;if(!this.hasEndpoints)return!1;for(const e of this._endpoints){if(e.ownerBlock.target===Un.Fragment)return!0;if((e.ownerBlock.target===Un.Neutral||e.ownerBlock.target===Un.VertexAndFragment)&&e.ownerBlock.isConnectedInFragmentShader())return!0}return!1}createCustomInputBlock(){return null}constructor(e,t,i){this._connectedPointBackingField=null,this._endpoints=new Array,this._typeConnectionSourceBackingField=null,this._defaultConnectionPointTypeBackingField=null,this._linkedConnectionSourceBackingField=null,this._acceptedConnectionPointType=null,this._type=kn.Float,this._enforceAssociatedVariableName=!1,this.needDualDirectionValidation=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new a.cP,this.onDisconnectionObservable=new a.cP,this.onTypeChangedObservable=new a.cP,this._isTypeChangeObservableNotifying=!1,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this._prioritizeVertex=!1,this._target=Un.VertexAndFragment,this._ownerBlock=t,this.name=e,this._direction=i}getClassName(){return"NodeMaterialConnectionPoint"}canConnectTo(e){return 0===this.checkCompatibilityState(e)}checkCompatibilityState(e){const t=this._ownerBlock,i=e.ownerBlock;if(t.target===Un.Fragment){if(i.target===Un.Vertex)return 2;for(const e of i.outputs)if(e.ownerBlock.target!=Un.Neutral&&e.isConnectedInVertexShader)return 2}if(this.type!==e.type&&e.innerType!==kn.AutoDetect)return qn.AreEquivalentTypes(this.type,e.type)||e.acceptedConnectionPointTypes&&-1!==e.acceptedConnectionPointTypes.indexOf(this.type)||e._acceptedConnectionPointType&&qn.AreEquivalentTypes(e._acceptedConnectionPointType.type,this.type)?0:1;if(e.excludedConnectionPointTypes&&-1!==e.excludedConnectionPointTypes.indexOf(this.type))return 1;let r=i,s=t;return 0===this.direction&&(r=t,s=i),r.isAnAncestorOf(s)?3:0}connectTo(e){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(e))throw"Cannot connect these two connectors.";return this._endpoints.push(e),e._connectedPoint=this,this._enforceAssociatedVariableName=!1,this.onConnectionObservable.notifyObservers(e),e.onConnectionObservable.notifyObservers(this),this}disconnectFrom(e){const t=this._endpoints.indexOf(e);return-1===t||(this._endpoints.splice(t,1),e._connectedPoint=null,this._enforceAssociatedVariableName=!1,e._enforceAssociatedVariableName=!1,this.onDisconnectionObservable.notifyObservers(e),e.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(e){let t=1;for(;t<kn.All;)e&t||this.excludedConnectionPointTypes.push(t),t<<=1}serialize(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t={};return t.name=this.name,t.displayName=this.displayName,e&&this.connectedPoint&&(t.inputName=this.name,t.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,t.targetConnectionName=this.connectedPoint.name,t.isExposedOnFrame=!0,t.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(t.isExposedOnFrame=!0,t.exposedPortPosition=this.exposedPortPosition),t}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear(),this.onTypeChangedObservable.clear(),this._connectedPoint=null,this._typeConnectionSource=null,this._linkedConnectionSource=null}_updateTypeDependentState(e){const t=this.type;e(),this.type!==t&&this._notifyTypeChanged()}_notifyTypeChanged(){this._isTypeChangeObservableNotifying||(this._isTypeChangeObservableNotifying=!0,this.onTypeChangedObservable.notifyObservers(this.type),this._isTypeChangeObservableNotifying=!1)}}var Xn,Kn,Yn,jn=i(1179);class Qn{get name(){return this._name}get codeIsReady(){return this._codeIsReady}set name(e){this.validateBlockName(e)&&(this._name=e)}get isUnique(){return this._isUnique}get isFinalMerger(){return this._isFinalMerger}get isInput(){return this._isInput}get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get buildId(){return this._buildId}set buildId(e){this._buildId=e}get target(){return this._target}set target(e){0===(this._target&e)&&(this._target=e)}get inputs(){return this._inputs}get outputs(){return this._outputs}getInputByName(e){const t=this._inputs.filter((t=>t.name===e));return t.length?t[0]:null}getOutputByName(e){const t=this._outputs.filter((t=>t.name===e));return t.length?t[0]:null}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Un.Vertex,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._isFinalMerger=!1,this._isInput=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._name="",this._isUnique=!1,this._codeIsReady=!0,this.onCodeIsReadyObservable=new a.cP,this.inputsAreExclusive=!1,this._codeVariableName="",this._inputs=new Array,this._outputs=new Array,this.comments="",this.visibleInInspector=!1,this.visibleOnFrame=!1,this._target=t,this._originalTargetIsNeutral=t===Un.Neutral,this._isFinalMerger=i,this._isInput="InputBlock"===this.getClassName(),this._isTeleportOut="NodeMaterialTeleportOutBlock"===this.getClassName(),this._isTeleportIn="NodeMaterialTeleportInBlock"===this.getClassName(),this._name=e,this.uniqueId=jn.K.UniqueId}_setInitialTarget(e){this._target=e,this._originalTargetIsNeutral=e===Un.Neutral}initialize(e){}bind(e,t,i,r){}_writeVariable(e){return e.connectedPoint?`${e.associatedVariableName}`:"0."}_writeFloat(e){let t=e.toString();return-1===t.indexOf(".")&&(t+=".0"),`${t}`}getClassName(){return"NodeMaterialBlock"}isConnectedInFragmentShader(){return this.outputs.some((e=>e.isConnectedInFragmentShader))}registerInput(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;return s=s??new qn(e,this,0),s.type=t,s.isOptional=i,r&&(s.target=r),this._inputs.push(s),this}registerOutput(e,t,i,r){return(r=r??new qn(e,this,1)).type=t,i&&(r.target=i),this._outputs.push(r),this}getFirstAvailableInput(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const t of this._inputs)if(!t.connectedPoint&&(!e||e.type===t.type||t.type===kn.AutoDetect))return t;return null}getFirstAvailableOutput(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const t of this._outputs)if(!e||!e.target||e.target===Un.Neutral||0!==(e.target&t.target))return t;return null}getSiblingOutput(e){const t=this._outputs.indexOf(e);return-1===t||t>=this._outputs.length?null:this._outputs[t+1]}isAnAncestorOf(e){for(const t of this._outputs)if(t.hasEndpoints)for(const i of t.endpoints){if(i.ownerBlock===e)return!0;if(i.ownerBlock.isAnAncestorOf(e))return!0}return!1}connectTo(e,t){if(0===this._outputs.length)return;let i=t&&t.output?this.getOutputByName(t.output):this.getFirstAvailableOutput(e),r=!0;for(;r;){const s=t&&t.input?e.getInputByName(t.input):e.getFirstAvailableInput(i);if(i&&s&&i.canConnectTo(s))i.connectTo(s),r=!1;else{if(!i)throw"Unable to find a compatible match";i=this.getSiblingOutput(i)}}return this}_buildBlock(e){}updateUniformsAndSamples(e,t,i,r){}provideFallbacks(e,t){}initializeDefines(e,t,i){}prepareDefines(e,t,i){}autoConfigure(e){}replaceRepeatableContent(e,t,i,r){}get willBeGeneratedIntoVertexShaderFromFragmentShader(){return!this.isInput&&!this.isFinalMerger&&(!this._outputs.some((e=>e.isDirectlyConnectedToVertexOutput))&&(this.target!==Un.Vertex&&!(this.target!==Un.VertexAndFragment&&this.target!==Un.Neutral||!this._outputs.some((e=>e.isConnectedInVertexShader)))))}isReady(e,t,i){return!0}_linkConnectionTypes(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[t]._acceptedConnectionPointType=this._inputs[e]:this._inputs[e]._linkedConnectionSource=this._inputs[t],this._inputs[t]._linkedConnectionSource=this._inputs[e]}_processBuild(e,t,i,r){e.build(t,r);const s=null!=t._vertexState,n=e._buildTarget===Un.Vertex&&e.target!==Un.VertexAndFragment;if(s&&(0===(e.target&e._buildTarget)||0===(e.target&i.target)||this.target!==Un.VertexAndFragment&&n)&&(!e.isInput&&t.target!==e._buildTarget||e.isInput&&e.isAttribute&&!e._noContextSwitch)){const e=i.connectedPoint;if(t._vertexState._emitVaryingFromString("v_"+e.declarationVariableName,e.type)){const i=1===t.shaderLanguage?"vertexOutputs.":"";t._vertexState.compilationString+=`${i}${"v_"+e.declarationVariableName} = ${e.associatedVariableName};\n`}const r=1===t.shaderLanguage?"fragmentInputs.":"";i.associatedVariableName=r+"v_"+e.declarationVariableName,i._enforceAssociatedVariableName=!0}}validateBlockName(e){const t=["position","normal","tangent","particle_positionw","uv","uv2","uv3","uv4","uv5","uv6","position2d","particle_uv","matricesIndices","matricesWeights","world0","world1","world2","world3","particle_color","particle_texturemask"];for(const i of t)if(e===i)return!1;return!0}_customBuildStep(e,t){}build(e,t){if(this._buildId===e.sharedData.buildId)return!0;if(!this.isInput)for(const i of this._outputs)i.associatedVariableName||(i.associatedVariableName=e._getFreeVariableName(i.name));for(const i of this._inputs){if(!i.connectedPoint){i.isOptional||e.sharedData.checks.notConnectedNonOptionalInputs.push(i);continue}if(this.target!==Un.Neutral){if(0===(i.target&this.target))continue;if(0===(i.target&e.target))continue}const r=i.connectedPoint.ownerBlock;r&&r!==this&&this._processBuild(r,e,i,t)}if(this._customBuildStep(e,t),this._buildId===e.sharedData.buildId)return!0;if(e.sharedData.verbose&&T.V.Log(`${e.target===Un.Vertex?"Vertex shader":"Fragment shader"}: Building ${this.name} [${this.getClassName()}]`),this.isFinalMerger)switch(e.target){case Un.Vertex:e.sharedData.checks.emitVertex=!0;break;case Un.Fragment:e.sharedData.checks.emitFragment=!0}!this.isInput&&e.sharedData.emitComments&&(e.compilationString+=`\n//${this.name}\n`),this._buildBlock(e),this._buildId=e.sharedData.buildId,this._buildTarget=e.target;for(const i of this._outputs)if(0!==(i.target&e.target))for(const r of i.endpoints){const i=r.ownerBlock;i&&0!==(i.target&e.target)&&-1!==t.indexOf(i)&&this._processBuild(i,e,r,t)}return!1}_inputRename(e){return e}_outputRename(e){return e}_dumpPropertiesCode(){const e=this._codeVariableName;return`${e}.visibleInInspector = ${this.visibleInInspector};\n${e}.visibleOnFrame = ${this.visibleOnFrame};\n${e}.target = ${this.target};\n`}_dumpCode(e,t){t.push(this);const i=this.name.replace(/[^A-Za-z_]+/g,"");if(this._codeVariableName=i||`${this.getClassName()}_${this.uniqueId}`,-1!==e.indexOf(this._codeVariableName)){let t=0;do{t++,this._codeVariableName=i+t}while(-1!==e.indexOf(this._codeVariableName))}e.push(this._codeVariableName);let r=`\n// ${this.getClassName()}\n`;this.comments&&(r+=`// ${this.comments}\n`),r+=`var ${this._codeVariableName} = new BABYLON.${this.getClassName()}("${this.name}");\n`,r+=this._dumpPropertiesCode();for(const s of this.inputs){if(!s.isConnected)continue;const i=s.connectedPoint.ownerBlock;-1===t.indexOf(i)&&(r+=i._dumpCode(e,t))}for(const s of this.outputs)if(s.hasEndpoints)for(const i of s.endpoints){const s=i.ownerBlock;s&&-1===t.indexOf(s)&&(r+=s._dumpCode(e,t))}return r}_dumpCodeForOutputConnections(e){let t="";if(-1!==e.indexOf(this))return t;e.push(this);for(const i of this.inputs){if(!i.isConnected)continue;const r=i.connectedPoint,s=r.ownerBlock;t+=s._dumpCodeForOutputConnections(e),t+=`${s._codeVariableName}.${s._outputRename(r.name)}.connectTo(${this._codeVariableName}.${this._inputRename(i.name)});\n`}return t}clone(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const i=this.serialize(),r=(0,x.n9)(i.customType);if(r){const s=new r;return s._deserialize(i,e,t),s}return null}serialize(){const e={};e.customType="BABYLON."+this.getClassName(),e.id=this.uniqueId,e.name=this.name,e.comments=this.comments,e.visibleInInspector=this.visibleInInspector,e.visibleOnFrame=this.visibleOnFrame,e.target=this.target,e.inputs=[],e.outputs=[];for(const t of this.inputs)e.inputs.push(t.serialize());for(const t of this.outputs)e.outputs.push(t.serialize(!1));return e}_deserialize(e,t,i,r){this.name=e.name,this.comments=e.comments,this.visibleInInspector=!!e.visibleInInspector,this.visibleOnFrame=!!e.visibleOnFrame,this._target=e.target??this.target,this._deserializePortDisplayNamesAndExposedOnFrame(e)}_deserializePortDisplayNamesAndExposedOnFrame(e){const t=e.inputs,i=e.outputs;t&&t.forEach(((e,t)=>{e.displayName&&(this.inputs[t].displayName=e.displayName),e.isExposedOnFrame&&(this.inputs[t].isExposedOnFrame=e.isExposedOnFrame,this.inputs[t].exposedPortPosition=e.exposedPortPosition)})),i&&i.forEach(((e,t)=>{e.displayName&&(this.outputs[t].displayName=e.displayName),e.isExposedOnFrame&&(this.outputs[t].isExposedOnFrame=e.isExposedOnFrame,this.outputs[t].exposedPortPosition=e.exposedPortPosition)}))}dispose(){this.onCodeIsReadyObservable.clear();for(const e of this.inputs)e.dispose();for(const e of this.outputs)e.dispose()}}class $n extends Qn{constructor(e){super(e,Un.Neutral),this.complementW=1,this.complementZ=0,this.target=Un.Vertex,this.registerInput("vector",kn.AutoDetect),this.registerInput("transform",kn.Matrix),this.registerOutput("output",kn.Vector4),this.registerOutput("xyz",kn.Vector3),this._inputs[0].onConnectionObservable.add((e=>{if(e.ownerBlock.isInput){const t=e.ownerBlock;"normal"!==t.name&&"tangent"!==t.name||(this.complementW=0)}}))}getClassName(){return"TransformBlock"}get vector(){return this._inputs[0]}get output(){return this._outputs[0]}get xyz(){return this._outputs[1]}get transform(){return this._inputs[1]}_buildBlock(e){super._buildBlock(e);const t=this.vector,i=this.transform,r=e._getShaderType(kn.Vector4),s=e._getShaderType(kn.Vector3);if(t.connectedPoint){if(0===this.complementW){const n=`//${this.name}`;e._emitFunctionFromInclude("helperFunctions",n),e.sharedData.blocksWithDefines.push(this);const a=e._getFreeVariableName(`${i.associatedVariableName}_NUS`);switch(1===e.shaderLanguage?e.compilationString+=`var ${a}: mat3x3f = mat3x3f(${i.associatedVariableName}[0].xyz, ${i.associatedVariableName}[1].xyz, ${i.associatedVariableName}[2].xyz);\n`:e.compilationString+=`mat3 ${a} = mat3(${i.associatedVariableName});\n`,e.compilationString+="#ifdef NONUNIFORMSCALING\n",e.compilationString+=`${a} = transposeMat3(inverseMat3(${a}));\n`,e.compilationString+="#endif\n",t.connectedPoint.type){case kn.Vector2:e.compilationString+=e._declareOutput(this.output)+` = ${r}(${a} * ${s}(${t.associatedVariableName}, ${this._writeFloat(this.complementZ)}), ${this._writeFloat(this.complementW)});\n`;break;case kn.Vector3:case kn.Color3:e.compilationString+=e._declareOutput(this.output)+` = ${r}(${a} * ${t.associatedVariableName}, ${this._writeFloat(this.complementW)});\n`;break;default:e.compilationString+=e._declareOutput(this.output)+` = ${r}(${a} * ${t.associatedVariableName}.xyz, ${this._writeFloat(this.complementW)});\n`}}else{const s=i.associatedVariableName;switch(t.connectedPoint.type){case kn.Vector2:e.compilationString+=e._declareOutput(this.output)+` = ${s} * ${r}(${t.associatedVariableName}, ${this._writeFloat(this.complementZ)}, ${this._writeFloat(this.complementW)});\n`;break;case kn.Vector3:case kn.Color3:e.compilationString+=e._declareOutput(this.output)+` = ${s} * ${r}(${t.associatedVariableName}, ${this._writeFloat(this.complementW)});\n`;break;default:e.compilationString+=e._declareOutput(this.output)+` = ${s} * ${t.associatedVariableName};\n`}}this.xyz.hasEndpoints&&(e.compilationString+=e._declareOutput(this.xyz)+` = ${this.output.associatedVariableName}.xyz;\n`)}return this}prepareDefines(e,t,i){e.nonUniformScaling&&i.setValue("NONUNIFORMSCALING",!0)}serialize(){const e=super.serialize();return e.complementZ=this.complementZ,e.complementW=this.complementW,e}_deserialize(e,t,i){super._deserialize(e,t,i),this.complementZ=void 0!==e.complementZ?e.complementZ:0,this.complementW=void 0!==e.complementW?e.complementW:1}_dumpPropertiesCode(){let e=super._dumpPropertiesCode()+`${this._codeVariableName}.complementZ = ${this.complementZ};\n`;return e+=`${this._codeVariableName}.complementW = ${this.complementW};\n`,e}}(0,x.Y5)("BABYLON.TransformBlock",$n);class Zn extends Qn{constructor(e){super(e,Un.Vertex,!0),this.registerInput("vector",kn.Vector4)}getClassName(){return"VertexOutputBlock"}get vector(){return this._inputs[0]}_isLogarithmicDepthEnabled(e,t){if(t)return!0;for(const i of e)if(i.useLogarithmicDepth)return!0;return!1}_buildBlock(e){super._buildBlock(e);const t=this.vector,i=1===e.shaderLanguage;if(1===e.shaderLanguage?e.compilationString+=`vertexOutputs.position = ${t.associatedVariableName};\n`:e.compilationString+=`gl_Position = ${t.associatedVariableName};\n`,this._isLogarithmicDepthEnabled(e.sharedData.fragmentOutputNodes,e.sharedData.nodeMaterial.useLogarithmicDepth)){e._emitUniformFromString("logarithmicDepthConstant",kn.Float),e._emitVaryingFromString("vFragmentDepth",kn.Float);const t=i?"vertexOutputs.vFragmentDepth":"vFragmentDepth",r=i?"uniforms.":"",s=i?"vertexOutputs.position":"gl_Position";e.compilationString+=`${t} = 1.0 + ${s}.w;\n`,e.compilationString+=`${s}.z = log2(max(0.000001, ${t})) * ${r}logarithmicDepthConstant;\n`}return this}}function Jn(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",r=arguments.length>3?arguments[3]:void 0;return(s,n)=>{let a=s._propStore;a||(a=[],s._propStore=a),a.push({propertyName:n,displayName:e,type:t,groupName:i,options:r??{}})}}(0,x.Y5)("BABYLON.VertexOutputBlock",Zn),function(e){e[e.Boolean=0]="Boolean",e[e.Float=1]="Float",e[e.Int=2]="Int",e[e.Vector2=3]="Vector2",e[e.List=4]="List"}(Xn||(Xn={}));class ea extends Qn{constructor(e){super(e,Un.Fragment,!0),this.convertToGammaSpace=!1,this.convertToLinearSpace=!1,this.useLogarithmicDepth=!1,this.registerInput("rgba",kn.Color4,!0),this.registerInput("rgb",kn.AutoDetect,!0),this.registerInput("a",kn.Float,!0),this.rgb.addExcludedConnectionPointFromAllowedTypes(kn.Color3|kn.Vector3|kn.Float)}getClassName(){return"FragmentOutputBlock"}initialize(e){e._excludeVariableName("logarithmicDepthConstant"),e._excludeVariableName("vFragmentDepth")}get rgba(){return this._inputs[0]}get rgb(){return this._inputs[1]}get a(){return this._inputs[2]}prepareDefines(e,t,i){i.setValue(this._linearDefineName,this.convertToLinearSpace,!0),i.setValue(this._gammaDefineName,this.convertToGammaSpace,!0)}bind(e,t,i){(this.useLogarithmicDepth||t.useLogarithmicDepth)&&i&&ue(void 0,e,i.getScene())}_buildBlock(e){super._buildBlock(e);const t=this.rgba,i=this.rgb,r=this.a,s=1===e.shaderLanguage;e.sharedData.hints.needAlphaBlending=t.isConnected||r.isConnected,e.sharedData.blocksWithDefines.push(this),(this.useLogarithmicDepth||e.sharedData.nodeMaterial.useLogarithmicDepth)&&(e._emitUniformFromString("logarithmicDepthConstant",kn.Float),e._emitVaryingFromString("vFragmentDepth",kn.Float),e.sharedData.bindableBlocks.push(this)),this._linearDefineName=e._getFreeDefineName("CONVERTTOLINEAR"),this._gammaDefineName=e._getFreeDefineName("CONVERTTOGAMMA");const n=`//${this.name}`;e._emitFunctionFromInclude("helperFunctions",n);let a="gl_FragColor";1===e.shaderLanguage&&(e.compilationString+="var fragmentOutputsColor : vec4<f32>;\r\n",a="fragmentOutputsColor");const o=e._getShaderType(kn.Vector4);if(t.connectedPoint)r.isConnected?e.compilationString+=`${a} = ${o}(${t.associatedVariableName}.rgb, ${r.associatedVariableName});\n`:e.compilationString+=`${a}  = ${t.associatedVariableName};\n`;else if(i.connectedPoint){let t="1.0";r.connectedPoint&&(t=r.associatedVariableName),i.connectedPoint.type===kn.Float?e.compilationString+=`${a}  = ${o}(${i.associatedVariableName}, ${i.associatedVariableName}, ${i.associatedVariableName}, ${t});\n`:e.compilationString+=`${a}  = ${o}(${i.associatedVariableName}, ${t});\n`}else e.sharedData.checks.notConnectedNonOptionalInputs.push(t);if(e.compilationString+=`#ifdef ${this._linearDefineName}\n`,e.compilationString+=`${a}  = toLinearSpace(${a});\n`,e.compilationString+="#endif\n",e.compilationString+=`#ifdef ${this._gammaDefineName}\n`,e.compilationString+=`${a}  = toGammaSpace(${a});\n`,e.compilationString+="#endif\n",1===e.shaderLanguage&&(e.compilationString+="#if !defined(PREPASS)\r\n",e.compilationString+="fragmentOutputs.color = fragmentOutputsColor;\r\n",e.compilationString+="#endif\r\n"),this.useLogarithmicDepth||e.sharedData.nodeMaterial.useLogarithmicDepth){const t=s?"input.vFragmentDepth":"vFragmentDepth",i=s?"uniforms.":"",r=s?"fragmentOutputs.fragDepth":"gl_FragDepthEXT";e.compilationString+=`${r} = log2(${t}) * ${i}logarithmicDepthConstant * 0.5;\n`}return e.compilationString+="#if defined(PREPASS)\r\n",e.compilationString+=`${s?"fragmentOutputs.fragData0":"gl_FragData[0]"} = ${a};\r\n`,e.compilationString+="#endif\r\n",this}_dumpPropertiesCode(){let e=super._dumpPropertiesCode();return e+=`${this._codeVariableName}.convertToGammaSpace = ${this.convertToGammaSpace};\n`,e+=`${this._codeVariableName}.convertToLinearSpace = ${this.convertToLinearSpace};\n`,e+=`${this._codeVariableName}.useLogarithmicDepth = ${this.useLogarithmicDepth};\n`,e}serialize(){const e=super.serialize();return e.convertToGammaSpace=this.convertToGammaSpace,e.convertToLinearSpace=this.convertToLinearSpace,e.useLogarithmicDepth=this.useLogarithmicDepth,e}_deserialize(e,t,i){super._deserialize(e,t,i),this.convertToGammaSpace=!!e.convertToGammaSpace,this.convertToLinearSpace=!!e.convertToLinearSpace,this.useLogarithmicDepth=e.useLogarithmicDepth??!1}}(0,s.Cg)([Jn("Convert to gamma space",0,"PROPERTIES",{notifiers:{update:!0}})],ea.prototype,"convertToGammaSpace",void 0),(0,s.Cg)([Jn("Convert to linear space",0,"PROPERTIES",{notifiers:{update:!0}})],ea.prototype,"convertToLinearSpace",void 0),(0,s.Cg)([Jn("Use logarithmic depth",0,"PROPERTIES")],ea.prototype,"useLogarithmicDepth",void 0),(0,x.Y5)("BABYLON.FragmentOutputBlock",ea),function(e){e[e.World=1]="World",e[e.View=2]="View",e[e.Projection=3]="Projection",e[e.ViewProjection=4]="ViewProjection",e[e.WorldView=5]="WorldView",e[e.WorldViewProjection=6]="WorldViewProjection",e[e.CameraPosition=7]="CameraPosition",e[e.FogColor=8]="FogColor",e[e.DeltaTime=9]="DeltaTime",e[e.CameraParameters=10]="CameraParameters",e[e.MaterialAlpha=11]="MaterialAlpha"}(Kn||(Kn={})),function(e){e[e.None=0]="None",e[e.Time=1]="Time",e[e.RealTime=2]="RealTime",e[e.MouseInfo=3]="MouseInfo"}(Yn||(Yn={}));const ta={position2d:"position",particle_uv:"vUV",particle_color:"vColor",particle_texturemask:"textureMask",particle_positionw:"vPositionW"},ia={particle_uv:!0,particle_color:!0,particle_texturemask:!0,particle_positionw:!0},ra={particle_texturemask:!0};class sa extends Qn{get type(){if(this._type===kn.AutoDetect){if(this.isUniform&&null!=this.value){if(!isNaN(this.value))return this._type=kn.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=kn.Vector2,this._type;case"Vector3":return this._type=kn.Vector3,this._type;case"Vector4":return this._type=kn.Vector4,this._type;case"Color3":return this._type=kn.Color3,this._type;case"Color4":return this._type=kn.Color4,this._type;case"Matrix":return this._type=kn.Matrix,this._type}}if(this.isAttribute)switch(this.name){case"position":case"normal":case"particle_positionw":return this._type=kn.Vector3,this._type;case"uv":case"uv2":case"uv3":case"uv4":case"uv5":case"uv6":case"position2d":case"particle_uv":return this._type=kn.Vector2,this._type;case"matricesIndices":case"matricesWeights":case"matricesIndicesExtra":case"matricesWeightsExtra":case"world0":case"world1":case"world2":case"world3":case"tangent":return this._type=kn.Vector4,this._type;case"color":case"instanceColor":case"particle_color":case"particle_texturemask":return this._type=kn.Color4,this._type}if(this.isSystemValue)switch(this._systemValue){case Kn.World:case Kn.WorldView:case Kn.WorldViewProjection:case Kn.View:case Kn.ViewProjection:case Kn.Projection:return this._type=kn.Matrix,this._type;case Kn.CameraPosition:return this._type=kn.Vector3,this._type;case Kn.FogColor:return this._type=kn.Color3,this._type;case Kn.DeltaTime:case Kn.MaterialAlpha:return this._type=kn.Float,this._type;case Kn.CameraParameters:return this._type=kn.Vector4,this._type}}return this._type}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Un.Vertex,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:kn.AutoDetect;super(e,t,!1),this._mode=3,this._animationType=Yn.None,this._prefix="",this.min=0,this.max=0,this.isBoolean=!1,this.matrixMode=0,this._systemValue=null,this.isConstant=!1,this.groupInInspector="",this.onValueChangedObservable=new a.cP,this.convertToGammaSpace=!1,this.convertToLinearSpace=!1,this._type=i,this.setDefaultValue(),this.registerOutput("output",i)}validateBlockName(e){return!!this.isAttribute||super.validateBlockName(e)}get output(){return this._outputs[0]}setAsAttribute(e){return this._mode=1,e&&(this.name=e),this}setAsSystemValue(e){return this.systemValue=e,this}get value(){return this._storedValue}set value(e){this.type===kn.Float&&(this.isBoolean?e=e?1:0:this.min!==this.max&&(e=Math.max(this.min,e),e=Math.min(this.max,e))),this._storedValue=e,this._mode=0,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(e){this._valueCallback=e,this._mode=0}get declarationVariableName(){return this._associatedVariableName}get associatedVariableName(){return this._prefix+this._associatedVariableName}set associatedVariableName(e){this._associatedVariableName=e}get animationType(){return this._animationType}set animationType(e){this._animationType=e}get isUndefined(){return 3===this._mode}get isUniform(){return 0===this._mode}set isUniform(e){this._mode=e?0:3,this.associatedVariableName=""}get isAttribute(){return 1===this._mode}set isAttribute(e){this._mode=e?1:3,this.associatedVariableName=""}get isVarying(){return 2===this._mode}set isVarying(e){this._mode=e?2:3,this.associatedVariableName=""}get isSystemValue(){return null!=this._systemValue}get systemValue(){return this._systemValue}set systemValue(e){this._mode=0,this.associatedVariableName="",this._systemValue=e}getClassName(){return"InputBlock"}animate(e){switch(this._animationType){case Yn.Time:this.type===kn.Float&&(this.value+=.01*e.getAnimationRatio());break;case Yn.RealTime:this.type===kn.Float&&(this.value=(Ye.j.Now-e.getEngine().startTime)/1e3);break;case Yn.MouseInfo:if(this.type===kn.Vector4){const t=e._inputManager._originMouseEvent;if(t){const e=t.offsetX,i=t.offsetY,r=0!=(1&t.buttons)?1:0,s=0!=(2&t.buttons)?1:0;this.value=new o.IU(e,i,r,s)}else this.value=new o.IU(0,0,0,0)}}}_emitDefine(e){return"!"===e[0]?`#ifndef ${e.substring(1)}\n`:`#ifdef ${e}\n`}initialize(){this.associatedVariableName=""}setDefaultValue(){switch(this.type){case kn.Float:this.value=0;break;case kn.Vector2:this.value=o.I9.Zero();break;case kn.Vector3:this.value=o.Pq.Zero();break;case kn.Vector4:this.value=o.IU.Zero();break;case kn.Color3:this.value=xi.v9.White();break;case kn.Color4:this.value=new xi.ov(1,1,1,1);break;case kn.Matrix:this.value=o.uq.Identity()}}_emitConstant(e){switch(this.type){case kn.Float:return`${e._emitFloat(this.value)}`;case kn.Vector2:return`vec2(${this.value.x}, ${this.value.y})`;case kn.Vector3:return`vec3(${this.value.x}, ${this.value.y}, ${this.value.z})`;case kn.Vector4:return`vec4(${this.value.x}, ${this.value.y}, ${this.value.z}, ${this.value.w})`;case kn.Color3:return xi.IG.Color3[0].set(this.value.r,this.value.g,this.value.b),this.convertToGammaSpace&&xi.IG.Color3[0].toGammaSpaceToRef(xi.IG.Color3[0],e.sharedData.scene.getEngine().useExactSrgbConversions),this.convertToLinearSpace&&xi.IG.Color3[0].toLinearSpaceToRef(xi.IG.Color3[0],e.sharedData.scene.getEngine().useExactSrgbConversions),`vec3(${xi.IG.Color3[0].r}, ${xi.IG.Color3[0].g}, ${xi.IG.Color3[0].b})`;case kn.Color4:return xi.IG.Color4[0].set(this.value.r,this.value.g,this.value.b,this.value.a),this.convertToGammaSpace&&xi.IG.Color4[0].toGammaSpaceToRef(xi.IG.Color4[0],e.sharedData.scene.getEngine().useExactSrgbConversions),this.convertToLinearSpace&&xi.IG.Color4[0].toLinearSpaceToRef(xi.IG.Color4[0],e.sharedData.scene.getEngine().useExactSrgbConversions),`vec4(${xi.IG.Color4[0].r}, ${xi.IG.Color4[0].g}, ${xi.IG.Color4[0].b}, ${xi.IG.Color4[0].a})`}return""}get _noContextSwitch(){return ia[this.name]}_emit(e,t){if(this.isUniform){if(this._associatedVariableName||(this._associatedVariableName=e._getFreeVariableName("u_"+this.name)),this.isConstant){if(-1!==e.constants.indexOf(this.associatedVariableName))return;return e.constants.push(this.associatedVariableName),void(e._constantDeclaration+=e._declareOutput(this.output,!0)+` = ${this._emitConstant(e)};\n`)}if(-1!==e.uniforms.indexOf(this.associatedVariableName))return;e.uniforms.push(this.associatedVariableName),t&&(e._uniformDeclaration+=this._emitDefine(t));const i=e._getShaderType(this.type);1===e.shaderLanguage?(e._uniformDeclaration+=`uniform ${this._associatedVariableName}: ${i};\n`,this._prefix="uniforms."):e._uniformDeclaration+=`uniform ${i} ${this.associatedVariableName};\n`,t&&(e._uniformDeclaration+="#endif\n");const r=e.sharedData.hints;if(null!==this._systemValue&&void 0!==this._systemValue)switch(this._systemValue){case Kn.WorldView:r.needWorldViewMatrix=!0;break;case Kn.WorldViewProjection:r.needWorldViewProjectionMatrix=!0}else this._animationType!==Yn.None&&e.sharedData.animatedInputs.push(this)}else if(this.isAttribute){if(this.associatedVariableName=ta[this.name]??this.name,this.target===Un.Vertex&&e._vertexState)return void(ia[this.name]?ra[this.name]?(e._emitUniformFromString(this.declarationVariableName,this.type,t),1===e.shaderLanguage&&(this._prefix="vertexInputs.")):e._emitVaryingFromString(this.declarationVariableName,this.type,t):this._emit(e._vertexState,t));if(-1!==e.attributes.indexOf(this.declarationVariableName))return;e.attributes.push(this.declarationVariableName),ia[this.name]?ra[this.name]?(e._emitUniformFromString(this.declarationVariableName,this.type,t),1===e.shaderLanguage&&(this._prefix="uniforms.")):(e._emitVaryingFromString(this.declarationVariableName,this.type,t),1===e.shaderLanguage&&(this._prefix="fragmentInputs.")):(t&&(e._attributeDeclaration+=this._emitDefine(t)),1===e.shaderLanguage?(e._attributeDeclaration+=`attribute ${this.declarationVariableName}: ${e._getShaderType(this.type)};\n`,this._prefix="vertexInputs."):e._attributeDeclaration+=`attribute ${e._getShaderType(this.type)} ${this.declarationVariableName};\n`,t&&(e._attributeDeclaration+="#endif\n"))}}_transmitWorld(e,t,i,r){if(!this._systemValue)return;const s=this._associatedVariableName;switch(this._systemValue){case Kn.World:e.setMatrix(s,t);break;case Kn.WorldView:e.setMatrix(s,i);break;case Kn.WorldViewProjection:e.setMatrix(s,r)}}_transmit(e,t,i){if(this.isAttribute)return;const r=this._associatedVariableName;if(this._systemValue){switch(this._systemValue){case Kn.World:case Kn.WorldView:case Kn.WorldViewProjection:return;case Kn.View:e.setMatrix(r,t.getViewMatrix());break;case Kn.Projection:e.setMatrix(r,t.getProjectionMatrix());break;case Kn.ViewProjection:e.setMatrix(r,t.getTransformMatrix());break;case Kn.CameraPosition:t.bindEyePosition(e,r,!0);break;case Kn.FogColor:e.setColor3(r,t.fogColor);break;case Kn.DeltaTime:e.setFloat(r,t.deltaTime/1e3);break;case Kn.CameraParameters:t.activeCamera&&e.setFloat4(r,t.getEngine().hasOriginBottomLeft?-1:1,t.activeCamera.minZ,t.activeCamera.maxZ,1/t.activeCamera.maxZ);break;case Kn.MaterialAlpha:e.setFloat(r,i.alpha)}return}const s=this._valueCallback?this._valueCallback():this._storedValue;if(null!==s)switch(this.type){case kn.Float:e.setFloat(r,s);break;case kn.Int:e.setInt(r,s);break;case kn.Color3:xi.IG.Color3[0].set(this.value.r,this.value.g,this.value.b),this.convertToGammaSpace&&xi.IG.Color3[0].toGammaSpaceToRef(xi.IG.Color3[0],t.getEngine().useExactSrgbConversions),this.convertToLinearSpace&&xi.IG.Color3[0].toLinearSpaceToRef(xi.IG.Color3[0],t.getEngine().useExactSrgbConversions),e.setColor3(r,xi.IG.Color3[0]);break;case kn.Color4:xi.IG.Color4[0].set(this.value.r,this.value.g,this.value.b,this.value.a),this.convertToGammaSpace&&xi.IG.Color4[0].toGammaSpaceToRef(xi.IG.Color4[0],t.getEngine().useExactSrgbConversions),this.convertToLinearSpace&&xi.IG.Color4[0].toLinearSpaceToRef(xi.IG.Color4[0],t.getEngine().useExactSrgbConversions),e.setDirectColor4(r,xi.IG.Color4[0]);break;case kn.Vector2:e.setVector2(r,s);break;case kn.Vector3:e.setVector3(r,s);break;case kn.Vector4:e.setVector4(r,s);break;case kn.Matrix:e.setMatrix(r,s)}}_buildBlock(e){super._buildBlock(e),(this.isUniform||this.isSystemValue)&&e.sharedData.inputBlocks.push(this),this._emit(e)}_dumpPropertiesCode(){const e=this._codeVariableName;if(this.isAttribute)return super._dumpPropertiesCode()+`${e}.setAsAttribute("${this.name}");\n`;if(this.isSystemValue)return super._dumpPropertiesCode()+`${e}.setAsSystemValue(BABYLON.NodeMaterialSystemValues.${Kn[this._systemValue]});\n`;if(this.isUniform){const t=[];let i="";switch(this.type){case kn.Float:i=`${this.value}`;break;case kn.Vector2:i=`new BABYLON.Vector2(${this.value.x}, ${this.value.y})`;break;case kn.Vector3:i=`new BABYLON.Vector3(${this.value.x}, ${this.value.y}, ${this.value.z})`;break;case kn.Vector4:i=`new BABYLON.Vector4(${this.value.x}, ${this.value.y}, ${this.value.z}, ${this.value.w})`;break;case kn.Color3:i=`new BABYLON.Color3(${this.value.r}, ${this.value.g}, ${this.value.b})`,this.convertToGammaSpace&&(i+=".toGammaSpace()"),this.convertToLinearSpace&&(i+=".toLinearSpace()");break;case kn.Color4:i=`new BABYLON.Color4(${this.value.r}, ${this.value.g}, ${this.value.b}, ${this.value.a})`,this.convertToGammaSpace&&(i+=".toGammaSpace()"),this.convertToLinearSpace&&(i+=".toLinearSpace()");break;case kn.Matrix:i=`BABYLON.Matrix.FromArray([${this.value.m}])`}return t.push(`${e}.value = ${i}`),this.type===kn.Float&&t.push(`${e}.min = ${this.min}`,`${e}.max = ${this.max}`,`${e}.isBoolean = ${this.isBoolean}`,`${e}.matrixMode = ${this.matrixMode}`,`${e}.animationType = BABYLON.AnimatedInputBlockTypes.${Yn[this.animationType]}`),t.push(`${e}.isConstant = ${this.isConstant}`),t.push(""),super._dumpPropertiesCode()+t.join(";\n")}return super._dumpPropertiesCode()}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const e=super.serialize();return e.type=this.type,e.mode=this._mode,e.systemValue=this._systemValue,e.animationType=this._animationType,e.min=this.min,e.max=this.max,e.isBoolean=this.isBoolean,e.matrixMode=this.matrixMode,e.isConstant=this.isConstant,e.groupInInspector=this.groupInInspector,e.convertToGammaSpace=this.convertToGammaSpace,e.convertToLinearSpace=this.convertToLinearSpace,null!=this._storedValue&&0===this._mode&&(this._storedValue.asArray?(e.valueType="BABYLON."+this._storedValue.getClassName(),e.value=this._storedValue.asArray()):(e.valueType="number",e.value=this._storedValue)),e}_deserialize(e,t,i){if(this._mode=e.mode,super._deserialize(e,t,i),this._type=e.type,this._systemValue=e.systemValue||e.wellKnownValue,this._animationType=e.animationType,this.min=e.min||0,this.max=e.max||0,this.isBoolean=!!e.isBoolean,this.matrixMode=e.matrixMode||0,this.isConstant=!!e.isConstant,this.groupInInspector=e.groupInInspector||"",this.convertToGammaSpace=!!e.convertToGammaSpace,this.convertToLinearSpace=!!e.convertToLinearSpace,"tangent"===e.name&&1===e.mode&&e.type===kn.Vector3&&(this._type=kn.Vector4),e.valueType)if("number"===e.valueType)this._storedValue=e.value;else{const t=(0,x.n9)(e.valueType);t&&(this._storedValue=t.FromArray(e.value))}}}(0,x.Y5)("BABYLON.InputBlock",sa);class na extends Qn{constructor(e){super(e,Un.VertexAndFragment),this._samplerName="textureSampler",this.convertToGammaSpace=!1,this.convertToLinearSpace=!1,this._isUnique=!1,this.registerInput("uv",kn.AutoDetect,!1,Un.VertexAndFragment),this.registerOutput("rgba",kn.Color4,Un.Neutral),this.registerOutput("rgb",kn.Color3,Un.Neutral),this.registerOutput("r",kn.Float,Un.Neutral),this.registerOutput("g",kn.Float,Un.Neutral),this.registerOutput("b",kn.Float,Un.Neutral),this.registerOutput("a",kn.Float,Un.Neutral),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(kn.Vector2|kn.Vector3|kn.Vector4),this._inputs[0]._prioritizeVertex=!1}getClassName(){return"CurrentScreenBlock"}get uv(){return this._inputs[0]}get rgba(){return this._outputs[0]}get rgb(){return this._outputs[1]}get r(){return this._outputs[2]}get g(){return this._outputs[3]}get b(){return this._outputs[4]}get a(){return this._outputs[5]}initialize(e){e._excludeVariableName(this._samplerName)}get target(){return this.uv.isConnected?this.uv.sourceBlock.isInput?Un.VertexAndFragment:Un.Fragment:Un.VertexAndFragment}prepareDefines(e,t,i){i.setValue(this._linearDefineName,this.convertToGammaSpace,!0),i.setValue(this._gammaDefineName,this.convertToLinearSpace,!0)}isReady(){return!(this.texture&&!this.texture.isReadyOrNotBlocking())}_injectVertexCode(e){const t=this.uv;if(t.connectedPoint.ownerBlock.isInput){t.connectedPoint.ownerBlock.isAttribute||e._emitUniformFromString(t.associatedVariableName,kn.Vector2)}if(this._mainUVName="vMain"+t.associatedVariableName,e._emitVaryingFromString(this._mainUVName,kn.Vector2),e.compilationString+=`${this._mainUVName} = ${t.associatedVariableName}.xy;\n`,this._outputs.some((e=>e.isConnectedInVertexShader))){this._writeTextureRead(e,!0);for(const t of this._outputs)t.hasEndpoints&&this._writeOutput(e,t,t.name,!0)}}_writeTextureRead(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=this.uv;if(t){if(e.target===Un.Fragment)return;const t=0===e.shaderLanguage?`texture2D(${this._samplerName},`:`textureSampleLevel(${this._samplerName}, ${this._samplerName+"Sampler"},`,r=0===e.shaderLanguage?"":", 0";return void(e.compilationString+=`${e._declareLocalVar(this._tempTextureRead,kn.Vector4)} = ${t} ${i.associatedVariableName}${r});\n`)}const r=0===e.shaderLanguage?`texture2D(${this._samplerName},`:`textureSample(${this._samplerName}, ${this._samplerName+"Sampler"},`;this.uv.ownerBlock.target!==Un.Fragment?e.compilationString+=`${e._declareLocalVar(this._tempTextureRead,kn.Vector4)} = ${r} ${this._mainUVName});\n`:e.compilationString+=`${e._declareLocalVar(this._tempTextureRead,kn.Vector4)} = ${r} ${i.associatedVariableName});\n`}_writeOutput(e,t,i){if(arguments.length>3&&void 0!==arguments[3]&&arguments[3]){if(e.target===Un.Fragment)return;e.compilationString+=`${e._declareOutput(t)} = ${this._tempTextureRead}.${i};\n`}else this.uv.ownerBlock.target!==Un.Fragment?(e.compilationString+=`${e._declareOutput(t)} = ${this._tempTextureRead}.${i};\n`,e.compilationString+=`#ifdef ${this._linearDefineName}\n`,e.compilationString+=`${t.associatedVariableName} = toGammaSpace(${t.associatedVariableName});\n`,e.compilationString+="#endif\n",e.compilationString+=`#ifdef ${this._gammaDefineName}\n`,e.compilationString+=`${t.associatedVariableName} = toLinearSpace(${t.associatedVariableName});\n`,e.compilationString+="#endif\n"):e.compilationString+=`${e._declareOutput(t)} = ${this._tempTextureRead}.${i};\n`}_buildBlock(e){if(super._buildBlock(e),this._tempTextureRead=e._getFreeVariableName("tempTextureRead"),e.sharedData.blockingBlocks.indexOf(this)<0&&e.sharedData.blockingBlocks.push(this),e.sharedData.textureBlocks.indexOf(this)<0&&e.sharedData.textureBlocks.push(this),e.sharedData.blocksWithDefines.indexOf(this)<0&&e.sharedData.blocksWithDefines.push(this),e.target!==Un.Fragment)return e._emit2DSampler(this._samplerName),void this._injectVertexCode(e);if(!this._outputs.some((e=>e.isConnectedInFragmentShader)))return;e._emit2DSampler(this._samplerName),this._linearDefineName=e._getFreeDefineName("ISLINEAR"),this._gammaDefineName=e._getFreeDefineName("ISGAMMA");const t=`//${this.name}`;e._emitFunctionFromInclude("helperFunctions",t),this._writeTextureRead(e);for(const i of this._outputs)i.hasEndpoints&&this._writeOutput(e,i,i.name);return this}serialize(){const e=super.serialize();return e.convertToGammaSpace=this.convertToGammaSpace,e.convertToLinearSpace=this.convertToLinearSpace,this.texture&&!this.texture.isRenderTarget&&(e.texture=this.texture.serialize()),e}_deserialize(e,t,i){super._deserialize(e,t,i),this.convertToGammaSpace=e.convertToGammaSpace,this.convertToLinearSpace=!!e.convertToLinearSpace,e.texture&&(i=0===e.texture.url.indexOf("data:")?"":i,this.texture=kt.g.Parse(e.texture,t,i))}}(0,x.Y5)("BABYLON.CurrentScreenBlock",na);class aa extends Qn{constructor(e){super(e,Un.Fragment),this._samplerName="diffuseSampler",this.convertToGammaSpace=!1,this.convertToLinearSpace=!1,this._isUnique=!1,this.registerInput("uv",kn.AutoDetect,!1,Un.VertexAndFragment),this.registerOutput("rgba",kn.Color4,Un.Neutral),this.registerOutput("rgb",kn.Color3,Un.Neutral),this.registerOutput("r",kn.Float,Un.Neutral),this.registerOutput("g",kn.Float,Un.Neutral),this.registerOutput("b",kn.Float,Un.Neutral),this.registerOutput("a",kn.Float,Un.Neutral),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(kn.Vector2|kn.Vector3|kn.Vector4)}getClassName(){return"ParticleTextureBlock"}get uv(){return this._inputs[0]}get rgba(){return this._outputs[0]}get rgb(){return this._outputs[1]}get r(){return this._outputs[2]}get g(){return this._outputs[3]}get b(){return this._outputs[4]}get a(){return this._outputs[5]}initialize(e){e._excludeVariableName("diffuseSampler")}autoConfigure(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>!0;if(!this.uv.isConnected){let i=e.getInputBlockByPredicate((e=>e.isAttribute&&"particle_uv"===e.name&&t(e)));i||(i=new sa("uv"),i.setAsAttribute("particle_uv")),i.output.connectTo(this.uv)}}prepareDefines(e,t,i){i.setValue(this._linearDefineName,this.convertToGammaSpace,!0),i.setValue(this._gammaDefineName,this.convertToLinearSpace,!0)}isReady(){return!(this.texture&&!this.texture.isReadyOrNotBlocking())}_writeOutput(e,t,i){e.compilationString+=`${e._declareOutput(t)} = ${this._tempTextureRead}.${i};\n`,e.compilationString+=`#ifdef ${this._linearDefineName}\n`,e.compilationString+=`${t.associatedVariableName} = toGammaSpace(${t.associatedVariableName});\n`,e.compilationString+="#endif\n",e.compilationString+=`#ifdef ${this._gammaDefineName}\n`,e.compilationString+=`${t.associatedVariableName} = toLinearSpace(${t.associatedVariableName});\n`,e.compilationString+="#endif\n"}_buildBlock(e){if(super._buildBlock(e),e.target===Un.Vertex)return;this._tempTextureRead=e._getFreeVariableName("tempTextureRead"),e._emit2DSampler(this._samplerName),e.sharedData.blockingBlocks.push(this),e.sharedData.textureBlocks.push(this),e.sharedData.blocksWithDefines.push(this),this._linearDefineName=e._getFreeDefineName("ISLINEAR"),this._gammaDefineName=e._getFreeDefineName("ISGAMMA");const t=`//${this.name}`;e._emitFunctionFromInclude("helperFunctions",t),e.compilationString+=`${e._declareLocalVar(this._tempTextureRead,kn.Vector4)} = ${e._generateTextureSample(this.uv.associatedVariableName,this._samplerName)};\n`;for(const i of this._outputs)i.hasEndpoints&&this._writeOutput(e,i,i.name);return this}serialize(){const e=super.serialize();return e.convertToGammaSpace=this.convertToGammaSpace,e.convertToLinearSpace=this.convertToLinearSpace,this.texture&&!this.texture.isRenderTarget&&(e.texture=this.texture.serialize()),e}_deserialize(e,t,i){super._deserialize(e,t,i),this.convertToGammaSpace=e.convertToGammaSpace,this.convertToLinearSpace=!!e.convertToLinearSpace,e.texture&&(i=0===e.texture.url.indexOf("data:")?"":i,this.texture=kt.g.Parse(e.texture,t,i))}}(0,x.Y5)("BABYLON.ParticleTextureBlock",aa);class oa extends Qn{constructor(e){super(e,Un.Fragment),this._isUnique=!0,this.registerInput("color",kn.Color4,!1,Un.Fragment),this.registerOutput("rampColor",kn.Color4,Un.Fragment)}getClassName(){return"ParticleRampGradientBlock"}get color(){return this._inputs[0]}get rampColor(){return this._outputs[0]}initialize(e){e._excludeVariableName("remapRanges"),e._excludeVariableName("rampSampler"),e._excludeVariableName("baseColor"),e._excludeVariableName("alpha"),e._excludeVariableName("remappedColorIndex"),e._excludeVariableName("rampColor")}_buildBlock(e){if(super._buildBlock(e),e.target!==Un.Vertex)return e._emit2DSampler("rampSampler","RAMPGRADIENT"),e._emitVaryingFromString("remapRanges",kn.Vector4,"RAMPGRADIENT"),e.compilationString+=`\n            #ifdef RAMPGRADIENT\n                ${e._declareLocalVar("baseColor",kn.Vector4)} = ${this.color.associatedVariableName};\n                ${e._declareLocalVar("alpha",kn.Float)} = ${this.color.associatedVariableName}.a;\n\n                ${e._declareLocalVar("remappedColorIndex",kn.Float)} = clamp((alpha - remapRanges.x) / remapRanges.y, 0.0, 1.0);\n\n                ${e._declareLocalVar("rampColor",kn.Vector4)} = ${e._generateTextureSample("vec2(1.0 - remappedColorIndex, 0.)","rampSampler")};\n\n                // Remapped alpha\n                ${e._declareOutput(this.rampColor)} = vec4${e.fSuffix}(baseColor.rgb * rampColor.rgb, clamp((alpha * rampColor.a - remapRanges.z) / remapRanges.w, 0.0, 1.0));\n            #else\n                ${e._declareOutput(this.rampColor)} = ${this.color.associatedVariableName};\n            #endif\n        `,this}}(0,x.Y5)("BABYLON.ParticleRampGradientBlock",oa);class la extends Qn{constructor(e){super(e,Un.Fragment),this._isUnique=!0,this.registerInput("color",kn.Color4,!1,Un.Fragment),this.registerInput("alphaTexture",kn.Float,!1,Un.Fragment),this.registerInput("alphaColor",kn.Float,!1,Un.Fragment),this.registerOutput("blendColor",kn.Color4,Un.Fragment)}getClassName(){return"ParticleBlendMultiplyBlock"}get color(){return this._inputs[0]}get alphaTexture(){return this._inputs[1]}get alphaColor(){return this._inputs[2]}get blendColor(){return this._outputs[0]}initialize(e){e._excludeVariableName("sourceAlpha")}_buildBlock(e){if(super._buildBlock(e),e.target!==Un.Vertex)return e.compilationString+=`\n            #ifdef BLENDMULTIPLYMODE\n                ${e._declareOutput(this.blendColor)};\n                ${e._declareLocalVar("sourceAlpha",kn.Float)}  = ${this.alphaColor.associatedVariableName} * ${this.alphaTexture.associatedVariableName};\n                ${this.blendColor.associatedVariableName} = vec4${e.fSuffix}(${this.color.associatedVariableName}.rgb * sourceAlpha + vec3(1.0) * (1.0 - sourceAlpha), ${this.color.associatedVariableName}.a);\n            #else\n                ${e._declareOutput(this.blendColor)} = ${this.color.associatedVariableName};\n            #endif\n        `,this}}(0,x.Y5)("BABYLON.ParticleBlendMultiplyBlock",la);class ha extends Qn{constructor(e){super(e,Un.Neutral),this.xSwizzle="x",this.ySwizzle="y",this.zSwizzle="z",this.wSwizzle="w",this.registerInput("xyzw ",kn.Vector4,!0),this.registerInput("xyz ",kn.Vector3,!0),this.registerInput("xy ",kn.Vector2,!0),this.registerInput("zw ",kn.Vector2,!0),this.registerInput("x",kn.Float,!0),this.registerInput("y",kn.Float,!0),this.registerInput("z",kn.Float,!0),this.registerInput("w",kn.Float,!0),this.registerOutput("xyzw",kn.Vector4),this.registerOutput("xyz",kn.Vector3),this.registerOutput("xy",kn.Vector2),this.registerOutput("zw",kn.Vector2)}getClassName(){return"VectorMergerBlock"}get xyzwIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get x(){return this._inputs[4]}get y(){return this._inputs[5]}get z(){return this._inputs[6]}get w(){return this._inputs[7]}get xyzw(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xy(){return this.xyOut}get xyz(){return this.xyzOut}_inputRename(e){return"xyzw "===e?"xyzwIn":"xyz "===e?"xyzIn":"xy "===e?"xyIn":"zw "===e?"zwIn":e}_buildSwizzle(e){return"."+(this.xSwizzle+this.ySwizzle+this.zSwizzle+this.wSwizzle).substr(0,e)}_buildBlock(e){super._buildBlock(e);const t=this.x,i=this.y,r=this.z,s=this.w,n=this.xyIn,a=this.zwIn,o=this.xyzIn,l=this.xyzwIn,h=this._outputs[0],c=this._outputs[1],u=this._outputs[2],d=this._outputs[3],_=e._getShaderType(kn.Vector4),p=e._getShaderType(kn.Vector3),f=e._getShaderType(kn.Vector2);return l.isConnected?(h.hasEndpoints&&(e.compilationString+=e._declareOutput(h)+` = ${l.associatedVariableName}${this._buildSwizzle(4)};\n`),c.hasEndpoints&&(e.compilationString+=e._declareOutput(c)+` = ${l.associatedVariableName}${this._buildSwizzle(3)};\n`),u.hasEndpoints&&(e.compilationString+=e._declareOutput(u)+` = ${l.associatedVariableName}${this._buildSwizzle(2)};\n`)):o.isConnected?(h.hasEndpoints&&(e.compilationString+=e._declareOutput(h)+` = ${_}(${o.associatedVariableName}, ${s.isConnected?this._writeVariable(s):"0.0"})${this._buildSwizzle(4)};\n`),c.hasEndpoints&&(e.compilationString+=e._declareOutput(c)+` = ${o.associatedVariableName}${this._buildSwizzle(3)};\n`),u.hasEndpoints&&(e.compilationString+=e._declareOutput(u)+` = ${o.associatedVariableName}${this._buildSwizzle(2)};\n`)):n.isConnected?(h.hasEndpoints&&(a.isConnected?e.compilationString+=e._declareOutput(h)+` = ${_}(${n.associatedVariableName}, ${a.associatedVariableName})${this._buildSwizzle(4)};\n`:e.compilationString+=e._declareOutput(h)+` = ${_}(${n.associatedVariableName}, ${r.isConnected?this._writeVariable(r):"0.0"}, ${s.isConnected?this._writeVariable(s):"0.0"})${this._buildSwizzle(4)};\n`),c.hasEndpoints&&(e.compilationString+=e._declareOutput(c)+` = ${p}(${n.associatedVariableName}, ${r.isConnected?this._writeVariable(r):"0.0"})${this._buildSwizzle(3)};\n`),u.hasEndpoints&&(e.compilationString+=e._declareOutput(u)+` = ${n.associatedVariableName}${this._buildSwizzle(2)};\n`),d.hasEndpoints&&(a.isConnected?e.compilationString+=e._declareOutput(d)+` = ${a.associatedVariableName}${this._buildSwizzle(2)};\n`:e.compilationString+=e._declareOutput(d)+` = ${f}(${r.isConnected?this._writeVariable(r):"0.0"}, ${s.isConnected?this._writeVariable(s):"0.0"})${this._buildSwizzle(2)};\n`)):(h.hasEndpoints&&(a.isConnected?e.compilationString+=e._declareOutput(h)+` = ${_}(${t.isConnected?this._writeVariable(t):"0.0"}, ${i.isConnected?this._writeVariable(i):"0.0"}, ${a.associatedVariableName})${this._buildSwizzle(4)};\n`:e.compilationString+=e._declareOutput(h)+` = ${_}(${t.isConnected?this._writeVariable(t):"0.0"}, ${i.isConnected?this._writeVariable(i):"0.0"}, ${r.isConnected?this._writeVariable(r):"0.0"}, ${s.isConnected?this._writeVariable(s):"0.0"})${this._buildSwizzle(4)};\n`),c.hasEndpoints&&(e.compilationString+=e._declareOutput(c)+` = ${p}(${t.isConnected?this._writeVariable(t):"0.0"}, ${i.isConnected?this._writeVariable(i):"0.0"}, ${r.isConnected?this._writeVariable(r):"0.0"})${this._buildSwizzle(3)};\n`),u.hasEndpoints&&(e.compilationString+=e._declareOutput(u)+` = ${f}(${t.isConnected?this._writeVariable(t):"0.0"}, ${i.isConnected?this._writeVariable(i):"0.0"})${this._buildSwizzle(2)};\n`),d.hasEndpoints&&(a.isConnected?e.compilationString+=e._declareOutput(d)+` = ${a.associatedVariableName}${this._buildSwizzle(2)};\n`:e.compilationString+=e._declareOutput(d)+` = ${f}(${r.isConnected?this._writeVariable(r):"0.0"}, ${s.isConnected?this._writeVariable(s):"0.0"})${this._buildSwizzle(2)};\n`)),this}serialize(){const e=super.serialize();return e.xSwizzle=this.xSwizzle,e.ySwizzle=this.ySwizzle,e.zSwizzle=this.zSwizzle,e.wSwizzle=this.wSwizzle,e}_deserialize(e,t,i){super._deserialize(e,t,i),this.xSwizzle=e.xSwizzle??"x",this.ySwizzle=e.ySwizzle??"y",this.zSwizzle=e.zSwizzle??"z",this.wSwizzle=e.wSwizzle??"w"}_dumpPropertiesCode(){let e=super._dumpPropertiesCode();return e+=`${this._codeVariableName}.xSwizzle = "${this.xSwizzle}";\n`,e+=`${this._codeVariableName}.ySwizzle = "${this.ySwizzle}";\n`,e+=`${this._codeVariableName}.zSwizzle = "${this.zSwizzle}";\n`,e+=`${this._codeVariableName}.wSwizzle = "${this.wSwizzle}";\n`,e}}(0,x.Y5)("BABYLON.VectorMergerBlock",ha);class ca extends Qn{constructor(e){super(e,Un.Neutral),this.sourceRange=new o.I9(-1,1),this.targetRange=new o.I9(0,1),this.registerInput("input",kn.AutoDetect),this.registerInput("sourceMin",kn.Float,!0),this.registerInput("sourceMax",kn.Float,!0),this.registerInput("targetMin",kn.Float,!0),this.registerInput("targetMax",kn.Float,!0),this.registerOutput("output",kn.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"RemapBlock"}get input(){return this._inputs[0]}get sourceMin(){return this._inputs[1]}get sourceMax(){return this._inputs[2]}get targetMin(){return this._inputs[3]}get targetMax(){return this._inputs[4]}get output(){return this._outputs[0]}_buildBlock(e){super._buildBlock(e);const t=this._outputs[0],i=this.sourceMin.isConnected?this.sourceMin.associatedVariableName:this._writeFloat(this.sourceRange.x),r=this.sourceMax.isConnected?this.sourceMax.associatedVariableName:this._writeFloat(this.sourceRange.y),s=this.targetMin.isConnected?this.targetMin.associatedVariableName:this._writeFloat(this.targetRange.x),n=this.targetMax.isConnected?this.targetMax.associatedVariableName:this._writeFloat(this.targetRange.y);return e.compilationString+=e._declareOutput(t)+` = ${s} + (${this._inputs[0].associatedVariableName} - ${i}) * (${n} - ${s}) / (${r} - ${i});\n`,this}_dumpPropertiesCode(){let e=super._dumpPropertiesCode()+`${this._codeVariableName}.sourceRange = new BABYLON.Vector2(${this.sourceRange.x}, ${this.sourceRange.y});\n`;return e+=`${this._codeVariableName}.targetRange = new BABYLON.Vector2(${this.targetRange.x}, ${this.targetRange.y});\n`,e}serialize(){const e=super.serialize();return e.sourceRange=this.sourceRange.asArray(),e.targetRange=this.targetRange.asArray(),e}_deserialize(e,t,i){super._deserialize(e,t,i),this.sourceRange=o.I9.FromArray(e.sourceRange),this.targetRange=o.I9.FromArray(e.targetRange)}}(0,s.Cg)([Jn("From",3)],ca.prototype,"sourceRange",void 0),(0,s.Cg)([Jn("To",3)],ca.prototype,"targetRange",void 0),(0,x.Y5)("BABYLON.RemapBlock",ca);class ua extends Qn{constructor(e){super(e,Un.Neutral),this.registerInput("left",kn.AutoDetect),this.registerInput("right",kn.AutoDetect),this.registerOutput("output",kn.BasedOnInput),this.output._typeConnectionSource=this.left,this._linkConnectionTypes(0,1,!0),this.left.acceptedConnectionPointTypes.push(kn.Float),this.right.acceptedConnectionPointTypes.push(kn.Float),this._connectionObservers=[this.left.onTypeChangedObservable.add((()=>this._updateInputOutputTypes())),this.right.onTypeChangedObservable.add((()=>this._updateInputOutputTypes()))]}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===kn.Int||this.left.type===kn.Float&&this.right.type!==kn.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[e,t]of[[this.left,this.right],[this.right,this.left]])e.acceptedConnectionPointTypes=[kn.Int,kn.Float],t.isConnected&&(e.acceptedConnectionPointTypes.push(t.type),t.type!==kn.Int&&t.type!==kn.Float||e.acceptedConnectionPointTypes.push(kn.Vector2,kn.Vector3,kn.Vector4,kn.Color3,kn.Color4,kn.Matrix))}dispose(){super.dispose(),this._connectionObservers.forEach((e=>e.remove())),this._connectionObservers.length=0}}class da extends ua{constructor(e){super(e)}getClassName(){return"MultiplyBlock"}_buildBlock(e){super._buildBlock(e);const t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = ${this.left.associatedVariableName} * ${this.right.associatedVariableName};\n`,this}}var _a;(0,x.Y5)("BABYLON.MultiplyBlock",da),function(e){e[e.Material=0]="Material",e[e.PostProcess=1]="PostProcess",e[e.Particle=2]="Particle",e[e.ProceduralTexture=3]="ProceduralTexture"}(_a||(_a={}));class pa extends Ht{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}class fa{get noiseTexture(){return this._noiseTexture}set noiseTexture(e){this._noiseTexture!==e&&(this._noiseTexture=e,this._reset())}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(e){this._isAnimationSheetEnabled!=e&&(this._isAnimationSheetEnabled=e,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(e){this._useLogarithmicDepth=e&&this.getScene().getEngine().getCaps().fragmentDepthSupported}getScene(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:o.Pq.Zero()}set direction1(e){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=e)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:o.Pq.Zero()}set direction2(e){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=e)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:o.Pq.Zero()}set minEmitBox(e){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=e)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:o.Pq.Zero()}set maxEmitBox(e){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=e)}get billboardMode(){return this._billboardMode}set billboardMode(e){this._billboardMode!==e&&(this._billboardMode=e,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(e){this._isBillboardBased!==e&&(this._isBillboardBased=e,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(e){this._attachImageProcessingConfiguration(e)}_attachImageProcessingConfiguration(e){e!==this._imageProcessingConfiguration&&(!e&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=e)}_reset(){}_removeGradientAndTexture(e,t,i){if(!t)return this;let r=0;for(const s of t){if(s.gradient===e){t.splice(r,1);break}r++}return i&&i.dispose(),this}constructor(e){this.animations=[],this.renderingGroupId=0,this.emitter=o.Pq.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new o.Pq(10,10,10),this.onAnimationEnd=null,this.blendMode=fa.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new o.I9(0,0),this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.worldOffset=new o.Pq(0,0,0),this._useLogarithmicDepth=!1,this.gravity=o.Pq.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new E.ov(1,1,1,1),this.color2=new E.ov(1,1,1,1),this.colorDead=new E.ov(0,0,0,1),this.textureMask=new E.ov(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new pa,this.id=e,this.name=e}createPointEmitter(e,t){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new o.Pq(0,1,0),arguments.length>2&&void 0!==arguments[2]||new o.Pq(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new o.Pq(0,1,0),arguments.length>4&&void 0!==arguments[4]||new o.Pq(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new o.Pq(0,1,0),arguments.length>3&&void 0!==arguments[3]||new o.Pq(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(e,t,i,r){throw new Error("Method not implemented.")}}fa.BLENDMODE_ONEONE=0,fa.BLENDMODE_STANDARD=1,fa.BLENDMODE_ADD=2,fa.BLENDMODE_MULTIPLY=3,fa.BLENDMODE_MULTIPLYADD=4,(0,x.Y5)("BABYLON.BaseParticleSystem",fa);class ga extends Qn{constructor(e){super(e,Un.Neutral),this.registerInput("rgba",kn.Color4,!0),this.registerInput("rgb ",kn.Color3,!0),this.registerOutput("rgb",kn.Color3),this.registerOutput("r",kn.Float),this.registerOutput("g",kn.Float),this.registerOutput("b",kn.Float),this.registerOutput("a",kn.Float),this.inputsAreExclusive=!0}getClassName(){return"ColorSplitterBlock"}get rgba(){return this._inputs[0]}get rgbIn(){return this._inputs[1]}get rgbOut(){return this._outputs[0]}get r(){return this._outputs[1]}get g(){return this._outputs[2]}get b(){return this._outputs[3]}get a(){return this._outputs[4]}_inputRename(e){return"rgb "===e?"rgbIn":e}_outputRename(e){return"rgb"===e?"rgbOut":e}_buildBlock(e){super._buildBlock(e);const t=this.rgba.isConnected?this.rgba:this.rgbIn;if(!t.isConnected)return;const i=this._outputs[0],r=this._outputs[1],s=this._outputs[2],n=this._outputs[3],a=this._outputs[4];return i.hasEndpoints&&(e.compilationString+=e._declareOutput(i)+` = ${t.associatedVariableName}.rgb;\n`),r.hasEndpoints&&(e.compilationString+=e._declareOutput(r)+` = ${t.associatedVariableName}.r;\n`),s.hasEndpoints&&(e.compilationString+=e._declareOutput(s)+` = ${t.associatedVariableName}.g;\n`),n.hasEndpoints&&(e.compilationString+=e._declareOutput(n)+` = ${t.associatedVariableName}.b;\n`),a.hasEndpoints&&(e.compilationString+=e._declareOutput(a)+` = ${t.associatedVariableName}.a;\n`),this}}(0,x.Y5)("BABYLON.ColorSplitterBlock",ga);var ma=i(9581);class ba{constructor(e){this.name=Ue.v.NAME_PROCEDURALTEXTURE,this.scene=e,this.scene.proceduralTextures=[]}register(){this.scene._beforeClearStage.registerStep(Ue.v.STEP_BEFORECLEAR_PROCEDURALTEXTURE,this,this._beforeClear)}rebuild(){}dispose(){}_beforeClear(){if(this.scene.proceduralTexturesEnabled){_.S0.StartPerformanceCounter("Procedural textures",this.scene.proceduralTextures.length>0);for(let e=0;e<this.scene.proceduralTextures.length;e++){const t=this.scene.proceduralTextures[e];t._shouldRender()&&t.render()}_.S0.EndPerformanceCounter("Procedural textures",this.scene.proceduralTextures.length>0)}}}i(9289),i(9422);const va="proceduralVertexShader",ya="attribute vec2 position;varying vec2 vPosition;varying vec2 vUV;const vec2 madd=vec2(0.5,0.5);\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvPosition=position;vUV=position*madd+madd;gl_Position=vec4(position,0.0,1.0);\n#define CUSTOM_VERTEX_MAIN_END\n}";qt.l.ShadersStore[va]=ya;class Ta extends kt.g{constructor(e,t,i,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;super(null,r,!n),this.isEnabled=!0,this.autoClear=!0,this.onGeneratedObservable=new a.cP,this.onBeforeGenerationObservable=new a.cP,this.nodeMaterialSource=null,this.defines="",this._textures={},this._currentRefreshId=-1,this._frameId=-1,this._refreshRate=1,this._vertexBuffers={},this._uniforms=new Array,this._samplers=new Array,this._floats={},this._ints={},this._floatsArrays={},this._colors3={},this._colors4={},this._vectors2={},this._vectors3={},this._vectors4={},this._matrices={},this._fallbackTextureUsed=!1,this._cachedDefines=null,this._contentUpdateId=-1,this._rtWrapper=null,null===s||s instanceof kt.g?(this._options={},this._fallbackTexture=s):(this._options=s,this._fallbackTexture=s.fallbackTexture??null);let c=(r=this.getScene()||l.q.LastCreatedScene)._getComponent(Ue.v.NAME_PROCEDURALTEXTURE);c||(c=new ba(r),r._addComponent(c)),r.proceduralTextures.push(this),this._fullEngine=r.getEngine(),this.name=e,this.isRenderTarget=!0,this._size=t,this._textureType=h,this._generateMipMaps=n,this._drawWrapper=new z.E(this._fullEngine),this.setFragment(i);const u=this._createRtWrapper(o,t,n,h);this._texture=u.texture;const d=[];d.push(1,1),d.push(-1,1),d.push(-1,-1),d.push(1,-1),this._vertexBuffers[S.R.PositionKind]=new S.R(this._fullEngine,d,S.R.PositionKind,!1,!1,2),this._createIndexBuffer()}_createRtWrapper(e,t,i,r){return e?(this._rtWrapper=this._fullEngine.createRenderTargetCubeTexture(t,{generateMipMaps:i,generateDepthBuffer:!1,generateStencilBuffer:!1,type:r,...this._options}),this.setFloat("face",0)):(this._rtWrapper=this._fullEngine.createRenderTargetTexture(t,{generateMipMaps:i,generateDepthBuffer:!1,generateStencilBuffer:!1,type:r,...this._options}),this._rtWrapper.is3D&&(this.setFloat("layer",0),this.setInt("layerNum",0))),this._rtWrapper}getEffect(){return this._drawWrapper.effect}_setEffect(e){this._drawWrapper.effect=e}getContent(){return this._contentData&&this._frameId===this._contentUpdateId||(this._contentData?this._contentData.then((e=>{this._contentData=this.readPixels(0,0,e),this._contentUpdateId=this._frameId})):(this._contentData=this.readPixels(0,0),this._contentUpdateId=this._frameId)),this._contentData}_createIndexBuffer(){const e=this._fullEngine,t=[];t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),this._indexBuffer=e.createIndexBuffer(t)}_rebuild(){const e=this._vertexBuffers[S.R.PositionKind];e&&e._rebuild(),this._createIndexBuffer(),this.refreshRate===qr.$.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=qr.$.REFRESHRATE_RENDER_ONCE)}reset(){this._drawWrapper.effect?.dispose(),this._drawWrapper.effect=null,this._cachedDefines=null}_getDefines(){return this.defines}executeWhenReady(e){if(this.isReady())return void e(this);const t=this.getEffect();t&&t.executeWhenCompiled((()=>{e(this)}))}isReady(){const e=this._fullEngine;if(this.nodeMaterialSource)return this._drawWrapper.effect.isReady();if(!this._fragment)return!1;if(this._fallbackTextureUsed)return!0;if(!this._texture)return!1;const t=this._getDefines();if(this._drawWrapper.effect&&t===this._cachedDefines&&this._drawWrapper.effect.isReady())return!0;const i={vertex:"procedural",fragmentElement:this._fragment.fragmentElement,fragmentSource:this._fragment.fragmentSource,fragment:"string"===typeof this._fragment?this._fragment:void 0};return this._cachedDefines!==t&&(this._cachedDefines=t,this._drawWrapper.effect=e.createEffect(i,[S.R.PositionKind],this._uniforms,this._samplers,t,void 0,void 0,(()=>{this._rtWrapper?.dispose(),this._rtWrapper=this._texture=null,this._fallbackTexture&&(this._texture=this._fallbackTexture._texture,this._texture&&this._texture.incrementReferences()),this._fallbackTextureUsed=!0}))),this._drawWrapper.effect.isReady()}resetRefreshCounter(){this._currentRefreshId=-1}setFragment(e){this._fragment=e}get refreshRate(){return this._refreshRate}set refreshRate(e){this._refreshRate=e,this.resetRefreshCounter()}_shouldRender(){return this.isEnabled&&this.isReady()&&this._texture?!this._fallbackTextureUsed&&(-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,this._frameId++,!0):(this._currentRefreshId++,!1)):(this._texture&&(this._texture.isReady=!1),!1)}getRenderSize(){return this._size}resize(e,t){if(this._fallbackTextureUsed||!this._rtWrapper||!this._texture)return;const i=this._texture.isCube;this._rtWrapper.dispose();const r=this._createRtWrapper(i,e,t,this._textureType);this._texture=r.texture,this._size=e,this._generateMipMaps=t}_checkUniform(e){-1===this._uniforms.indexOf(e)&&this._uniforms.push(e)}setTexture(e,t){return-1===this._samplers.indexOf(e)&&this._samplers.push(e),this._textures[e]=t,this}setFloat(e,t){return this._checkUniform(e),this._floats[e]=t,this}setInt(e,t){return this._checkUniform(e),this._ints[e]=t,this}setFloats(e,t){return this._checkUniform(e),this._floatsArrays[e]=t,this}setColor3(e,t){return this._checkUniform(e),this._colors3[e]=t,this}setColor4(e,t){return this._checkUniform(e),this._colors4[e]=t,this}setVector2(e,t){return this._checkUniform(e),this._vectors2[e]=t,this}setVector3(e,t){return this._checkUniform(e),this._vectors3[e]=t,this}setVector4(e,t){return this._checkUniform(e),this._vectors4[e]=t,this}setMatrix(e,t){return this._checkUniform(e),this._matrices[e]=t,this}render(e){const t=this.getScene();if(!t)return;const i=this._fullEngine;if(i.enableEffect(this._drawWrapper),this.onBeforeGenerationObservable.notifyObservers(this),i.setState(!1),!this.nodeMaterialSource){for(const e in this._textures)this._drawWrapper.effect.setTexture(e,this._textures[e]);for(const e in this._ints)this._drawWrapper.effect.setInt(e,this._ints[e]);for(const e in this._floats)this._drawWrapper.effect.setFloat(e,this._floats[e]);for(const e in this._floatsArrays)this._drawWrapper.effect.setArray(e,this._floatsArrays[e]);for(const e in this._colors3)this._drawWrapper.effect.setColor3(e,this._colors3[e]);for(const e in this._colors4){const t=this._colors4[e];this._drawWrapper.effect.setFloat4(e,t.r,t.g,t.b,t.a)}for(const e in this._vectors2)this._drawWrapper.effect.setVector2(e,this._vectors2[e]);for(const e in this._vectors3)this._drawWrapper.effect.setVector3(e,this._vectors3[e]);for(const e in this._vectors4)this._drawWrapper.effect.setVector4(e,this._vectors4[e]);for(const e in this._matrices)this._drawWrapper.effect.setMatrix(e,this._matrices[e])}if(!this._texture||!this._rtWrapper)return;i._debugPushGroup?.(`procedural texture generation for ${this.name}`,1);const r=i.currentViewport;if(this.isCube)for(let s=0;s<6;s++)i.bindFramebuffer(this._rtWrapper,s,void 0,void 0,!0),i.bindBuffers(this._vertexBuffers,this._indexBuffer,this._drawWrapper.effect),this._drawWrapper.effect.setFloat("face",s),this.autoClear&&i.clear(t.clearColor,!0,!1,!1),i.drawElementsType(Ne.TriangleFillMode,0,6),i.unBindFramebuffer(this._rtWrapper,!0);else{let e=1;this._rtWrapper.is3D?e=this._rtWrapper.depth:this._rtWrapper.is2DArray&&(e=this._rtWrapper.layers);for(let r=0;r<e;r++){if(i.bindFramebuffer(this._rtWrapper,0,void 0,void 0,!0,0,r),i.bindBuffers(this._vertexBuffers,this._indexBuffer,this._drawWrapper.effect),this._rtWrapper.is3D||this._rtWrapper.is2DArray){this._drawWrapper.effect?.setFloat("layer",1!==e?r/(e-1):0),this._drawWrapper.effect?.setInt("layerNum",r);for(const e in this._textures)this._drawWrapper.effect.setTexture(e,this._textures[e])}this.autoClear&&i.clear(t.clearColor,!0,!1,!1),i.drawElementsType(Ne.TriangleFillMode,0,6),i.unBindFramebuffer(this._rtWrapper,!this._generateMipMaps)}}r&&i.setViewport(r),this.isCube&&i.generateMipMapsForCubemap(this._texture,!0),i._debugPopGroup?.(1),this.onGenerated&&this.onGenerated(),this.onGeneratedObservable.notifyObservers(this)}clone(){const e=this.getSize(),t=new Ta(this.name,e.width,this._fragment,this.getScene(),this._fallbackTexture,this._generateMipMaps);return t.hasAlpha=this.hasAlpha,t.level=this.level,t.coordinatesMode=this.coordinatesMode,t}dispose(){const e=this.getScene();if(!e)return;const t=e.proceduralTextures.indexOf(this);t>=0&&e.proceduralTextures.splice(t,1);const i=this._vertexBuffers[S.R.PositionKind];i&&(i.dispose(),this._vertexBuffers[S.R.PositionKind]=null),this._indexBuffer&&this._fullEngine._releaseBuffer(this._indexBuffer)&&(this._indexBuffer=null),this.onGeneratedObservable.clear(),this.onBeforeGenerationObservable.clear(),super.dispose()}}var xa;(0,s.Cg)([(0,n.lK)()],Ta.prototype,"isEnabled",void 0),(0,s.Cg)([(0,n.lK)()],Ta.prototype,"autoClear",void 0),(0,s.Cg)([(0,n.lK)()],Ta.prototype,"_generateMipMaps",void 0),(0,s.Cg)([(0,n.lK)()],Ta.prototype,"_size",void 0),(0,s.Cg)([(0,n.lK)()],Ta.prototype,"refreshRate",null),(0,x.Y5)("BABYLON.ProceduralTexture",Ta),function(e){e[e.Cos=0]="Cos",e[e.Sin=1]="Sin",e[e.Abs=2]="Abs",e[e.Exp=3]="Exp",e[e.Exp2=4]="Exp2",e[e.Round=5]="Round",e[e.Floor=6]="Floor",e[e.Ceiling=7]="Ceiling",e[e.Sqrt=8]="Sqrt",e[e.Log=9]="Log",e[e.Tan=10]="Tan",e[e.ArcTan=11]="ArcTan",e[e.ArcCos=12]="ArcCos",e[e.ArcSin=13]="ArcSin",e[e.Fract=14]="Fract",e[e.Sign=15]="Sign",e[e.Radians=16]="Radians",e[e.Degrees=17]="Degrees",e[e.Set=18]="Set"}(xa||(xa={}));class Aa extends Qn{constructor(e){super(e,Un.Neutral),this.operation=xa.Cos,this.registerInput("input",kn.AutoDetect),this.registerOutput("output",kn.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"TrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_buildBlock(e){super._buildBlock(e);const t=this._outputs[0];let i="";switch(this.operation){case xa.Cos:i="cos";break;case xa.Sin:i="sin";break;case xa.Abs:i="abs";break;case xa.Exp:i="exp";break;case xa.Exp2:i="exp2";break;case xa.Round:i="round";break;case xa.Floor:i="floor";break;case xa.Ceiling:i="ceil";break;case xa.Sqrt:i="sqrt";break;case xa.Log:i="log";break;case xa.Tan:i="tan";break;case xa.ArcTan:i="atan";break;case xa.ArcCos:i="acos";break;case xa.ArcSin:i="asin";break;case xa.Fract:i="fract";break;case xa.Sign:i="sign";break;case xa.Radians:i="radians";break;case xa.Degrees:i="degrees";break;case xa.Set:i=""}return e.compilationString+=e._declareOutput(t)+` = ${i}(${this.input.associatedVariableName});\n`,this}serialize(){const e=super.serialize();return e.operation=this.operation,e}_deserialize(e,t,i){super._deserialize(e,t,i),this.operation=e.operation}_dumpPropertiesCode(){return super._dumpPropertiesCode()+`${this._codeVariableName}.operation = BABYLON.TrigonometryBlockOperations.${xa[this.operation]};\n`}}(0,x.Y5)("BABYLON.TrigonometryBlock",Aa);const Ca={effect:null,subMesh:null};class Ra extends Ht{constructor(){super(),this.NORMAL=!1,this.TANGENT=!1,this.VERTEXCOLOR_NME=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.PREPASS=!1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_NDC_DEPTH=!1,this.PREPASS_NDC_DEPTH_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.EXPOSURE=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.BUMPDIRECTUV=0,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.rebuild()}setValue(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];void 0===this[e]&&this._keys.push(e),i&&this[e]!==t&&this.markAsUnprocessed(),this[e]=t}}class Ea extends ri{static _BlockIsTextureBlock(e){return"TextureBlock"===e.getClassName()||"ReflectionTextureBaseBlock"===e.getClassName()||"ReflectionTextureBlock"===e.getClassName()||"ReflectionBlock"===e.getClassName()||"RefractionBlock"===e.getClassName()||"CurrentScreenBlock"===e.getClassName()||"ParticleTextureBlock"===e.getClassName()||"ImageSourceBlock"===e.getClassName()||"TriPlanarBlock"===e.getClassName()||"BiPlanarBlock"===e.getClassName()||"PrePassTextureBlock"===e.getClassName()}_getGlobalNodeMaterialEditor(){return"undefined"!==typeof NODEEDITOR?NODEEDITOR:"undefined"!==typeof BABYLON&&"undefined"!==typeof BABYLON.NodeEditor?BABYLON:void 0}get shaderLanguage(){return this._options.shaderLanguage}set shaderLanguage(e){this._options.shaderLanguage=e}get options(){return this._options}set options(e){this._options=e}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()}get mode(){return this._mode}set mode(e){this._mode=e}get buildId(){return this._buildId}set buildId(e){this._buildId=e}constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(super(e,t||l.q.LastCreatedScene),this._buildId=Ea._BuildIdGenerator++,this._buildWasSuccessful=!1,this._cachedWorldViewMatrix=new o.uq,this._cachedWorldViewProjectionMatrix=new o.uq,this._optimizers=new Array,this._animationFrame=-1,this._buildIsInProgress=!1,this.BJSNODEMATERIALEDITOR=this._getGlobalNodeMaterialEditor(),this.editorData=null,this.ignoreAlpha=!1,this.maxSimultaneousLights=4,this.onBuildObservable=new a.cP,this.onBuildErrorObservable=new a.cP,this._vertexOutputNodes=new Array,this._fragmentOutputNodes=new Array,this.attachedBlocks=[],this._mode=_a.Material,this.forceAlphaBlending=!1,i&&1===i.shaderLanguage&&!this.getScene().getEngine().isWebGPU)throw new Error("WebGPU shader language is only supported with WebGPU engine");this._options={emitComments:!1,shaderLanguage:Ea.DefaultShaderLanguage,...i},this._attachImageProcessingConfiguration(null)}getClassName(){return"NodeMaterial"}_attachImageProcessingConfiguration(e){e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}getBlockByName(e){let t=null;for(const i of this.attachedBlocks)if(i.name===e){if(t)return _.S0.Warn("More than one block was found with the name `"+e+"`"),t;t=i}return t}getBlockByPredicate(e){for(const t of this.attachedBlocks)if(e(t))return t;return null}getInputBlockByPredicate(e){for(const t of this.attachedBlocks)if(t.isInput&&e(t))return t;return null}getInputBlocks(){const e=[];for(const t of this.attachedBlocks)t.isInput&&e.push(t);return e}registerOptimizer(e){if(!(this._optimizers.indexOf(e)>-1))return this._optimizers.push(e),this}unregisterOptimizer(e){const t=this._optimizers.indexOf(e);if(-1!==t)return this._optimizers.splice(t,1),this}addOutputNode(e){if(null===e.target)throw"This node is not meant to be an output node. You may want to explicitly set its target value.";return 0!==(e.target&Un.Vertex)&&this._addVertexOutputNode(e),0!==(e.target&Un.Fragment)&&this._addFragmentOutputNode(e),this}removeOutputNode(e){return null===e.target||(0!==(e.target&Un.Vertex)&&this._removeVertexOutputNode(e),0!==(e.target&Un.Fragment)&&this._removeFragmentOutputNode(e)),this}_addVertexOutputNode(e){if(-1===this._vertexOutputNodes.indexOf(e))return e.target=Un.Vertex,this._vertexOutputNodes.push(e),this}_removeVertexOutputNode(e){const t=this._vertexOutputNodes.indexOf(e);if(-1!==t)return this._vertexOutputNodes.splice(t,1),this}_addFragmentOutputNode(e){if(-1===this._fragmentOutputNodes.indexOf(e))return e.target=Un.Fragment,this._fragmentOutputNodes.push(e),this}_removeFragmentOutputNode(e){const t=this._fragmentOutputNodes.indexOf(e);if(-1!==t)return this._fragmentOutputNodes.splice(t,1),this}needAlphaBlending(){return!this.ignoreAlpha&&(this.forceAlphaBlending||this.alpha<1||this._sharedData&&this._sharedData.hints.needAlphaBlending)}needAlphaTesting(){return this._sharedData&&this._sharedData.hints.needAlphaTesting}_processInitializeOnLink(e,t,i){let r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];(e.target===Un.VertexAndFragment||t.target===Un.Fragment&&e.target===Un.Vertex&&e._preparationId!==this._buildId)&&i.push(e),this._initializeBlock(e,t,i,r)}_initializeBlock(e,t,i){let r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(e.initialize(t),r&&e.autoConfigure(this),e._preparationId=this._buildId,-1===this.attachedBlocks.indexOf(e)){if(e.isUnique){const t=e.getClassName();for(const e of this.attachedBlocks)if(e.getClassName()===t)throw`Cannot have multiple blocks of type ${t} in the same NodeMaterial`}this.attachedBlocks.push(e)}for(const s of e.inputs){s.associatedVariableName="";const n=s.connectedPoint;if(n){const s=n.ownerBlock;s!==e&&this._processInitializeOnLink(s,t,i,r)}}if(e.isTeleportOut){const s=e;s.entryPoint&&this._processInitializeOnLink(s.entryPoint,t,i,r)}for(const s of e.outputs)s.associatedVariableName=""}_resetDualBlocks(e,t){e.target===Un.VertexAndFragment&&(e.buildId=t);for(const i of e.inputs){const r=i.connectedPoint;if(r){const i=r.ownerBlock;i!==e&&this._resetDualBlocks(i,t)}}if(e.isTeleportOut){const i=e;i.entryPoint&&this._resetDualBlocks(i.entryPoint,t)}}removeBlock(e){const t=this.attachedBlocks.indexOf(e);t>-1&&this.attachedBlocks.splice(t,1),e.isFinalMerger&&this.removeOutputNode(e)}build(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._buildIsInProgress)return void T.V.Warn("Build is already in progress, You can use NodeMaterial.onBuildObservable to determine when the build is completed.");this._buildIsInProgress=!0,this._vertexCompilationState||i||(i=!0),this._buildWasSuccessful=!1;const r=this.getScene().getEngine(),s=this._mode===_a.Particle;if(0===this._vertexOutputNodes.length&&!s)throw"You must define at least one vertexOutputNode";if(0===this._fragmentOutputNodes.length)throw"You must define at least one fragmentOutputNode";this._vertexCompilationState=new Vn,this._vertexCompilationState.supportUniformBuffers=r.supportsUniformBuffers,this._vertexCompilationState.target=Un.Vertex,this._fragmentCompilationState=new Vn,this._fragmentCompilationState.supportUniformBuffers=r.supportsUniformBuffers,this._fragmentCompilationState.target=Un.Fragment,this._sharedData=new Wn,this._sharedData.nodeMaterial=this,this._sharedData.fragmentOutputNodes=this._fragmentOutputNodes,this._vertexCompilationState.sharedData=this._sharedData,this._fragmentCompilationState.sharedData=this._sharedData,this._sharedData.buildId=this._buildId,this._sharedData.emitComments=this._options.emitComments,this._sharedData.verbose=e,this._sharedData.scene=this.getScene(),this._sharedData.allowEmptyVertexProgram=s;const n=[],a=[];for(const l of this._vertexOutputNodes)n.push(l),this._initializeBlock(l,this._vertexCompilationState,a,i);for(const l of this._fragmentOutputNodes)a.push(l),this._initializeBlock(l,this._fragmentCompilationState,n,i);let o=0;for(const l of this.attachedBlocks)l.codeIsReady||(o++,l.onCodeIsReadyObservable.addOnce((()=>{o--,0===o&&this._finishBuildProcess(e,t,n,a)})));0===o&&this._finishBuildProcess(e,t,n,a)}_finishBuildProcess(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;this.optimize();for(const o of i)o.build(this._vertexCompilationState,i);this._fragmentCompilationState.uniforms=this._vertexCompilationState.uniforms.slice(0),this._fragmentCompilationState._uniformDeclaration=this._vertexCompilationState._uniformDeclaration,this._fragmentCompilationState._constantDeclaration=this._vertexCompilationState._constantDeclaration,this._fragmentCompilationState._vertexState=this._vertexCompilationState;for(const o of r)this._resetDualBlocks(o,this._buildId-1);for(const o of r)o.build(this._fragmentCompilationState,r);this._vertexCompilationState.finalize(this._vertexCompilationState),this._fragmentCompilationState.finalize(this._fragmentCompilationState),t&&(this._buildId=Ea._BuildIdGenerator++);const s=this._sharedData.emitErrors(this.onBuildErrorObservable);e&&(T.V.Log("Vertex shader:"),T.V.Log(this._vertexCompilationState.compilationString),T.V.Log("Fragment shader:"),T.V.Log(this._fragmentCompilationState.compilationString)),this._buildIsInProgress=!1,this._buildWasSuccessful=!0,s&&this.onBuildObservable.notifyObservers(this);const n=this.getScene().meshes;for(const o of n)if(o.subMeshes)for(const e of o.subMeshes){if(e.getMaterial()!==this)continue;if(!e.materialDefines)continue;const t=e.materialDefines;t.markAllAsDirty(),t.reset()}this.prePassTextureInputs.length&&this.getScene().enablePrePassRenderer();const a=this.getScene().prePassRenderer;a&&a.markAsDirty()}optimize(){for(const e of this._optimizers)e.optimize(this._vertexOutputNodes,this._fragmentOutputNodes)}_prepareDefinesForAttributes(e,t){const i=t.NORMAL,r=t.TANGENT,s=t.VERTEXCOLOR_NME;t.NORMAL=e.isVerticesDataPresent(S.R.NormalKind),t.TANGENT=e.isVerticesDataPresent(S.R.TangentKind);const n=e.useVertexColors&&e.isVerticesDataPresent(S.R.ColorKind);t.VERTEXCOLOR_NME=n;let a=!1;for(let l=1;l<=6;++l){const i=t["UV"+l];t["UV"+l]=e.isVerticesDataPresent(`uv${1===l?"":l}`),a=a||t["UV"+l]!==i}const o=this.needAlphaBlendingForMesh(e)&&this.getScene().useOrderIndependentTransparency;we(this.getScene(),t,!o),(i!==t.NORMAL||r!==t.TANGENT||s!==t.VERTEXCOLOR_NME||a)&&t.markAsAttributesDirty()}get isPrePassCapable(){return!0}get prePassTextureOutputs(){const e=this.getBlockByPredicate((e=>"PrePassOutputBlock"===e.getClassName())),t=[4];return e?(this.prePassTextureInputs.length||(e.viewDepth.isConnected&&t.push(5),e.viewDepthNDC.isConnected&&t.push(10),e.viewNormal.isConnected&&t.push(6),e.worldNormal.isConnected&&t.push(8),e.worldPosition.isConnected&&t.push(1)),t):t}get prePassTextureInputs(){const e=this.getAllTextureBlocks().filter((e=>"PrePassTextureBlock"===e.getClassName())),t=[];for(const i of e)i.position.isConnected&&!t.includes(1)&&t.push(1),i.depth.isConnected&&!t.includes(5)&&t.push(5),i.clipSpaceDepth.isConnected&&!t.includes(10)&&t.push(10),i.normal.isConnected&&!t.includes(6)&&t.push(6),i.worldNormal.isConnected&&!t.includes(8)&&t.push(8);return t}setPrePassRenderer(e){const t=this.prePassTextureInputs.concat(this.prePassTextureOutputs);if(e&&t.length>1){let i=e.getEffectConfiguration("nodeMaterial");i||(i=e.addEffectConfiguration({enabled:!0,needsImageProcessing:!1,name:"nodeMaterial",texturesRequired:[]}));for(const e of t)i.texturesRequired.includes(e)||i.texturesRequired.push(e);i.enabled=!0}return t.length>1}createPostProcess(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:5;return this.mode!==_a.PostProcess?(T.V.Log("Incompatible material mode"),null):this._createEffectForPostProcess(null,e,t,i,r,s,n,a)}createEffectForPostProcess(e){this._createEffectForPostProcess(e)}_createEffectForPostProcess(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4?arguments[4]:void 0,n=arguments.length>5?arguments[5]:void 0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,l=this.name+this._buildId;const h=new Ra,c=new Xe(l+"PostProcess",this.getScene());let u=this._buildId;return this._processDefines(c,h),Hn.M.RegisterShader(l,this._fragmentCompilationState._builtCompilationString,this._vertexCompilationState._builtCompilationString,this.shaderLanguage),e?e.updateEffect(h.toString(),this._fragmentCompilationState.uniforms,this._fragmentCompilationState.samplers,{maxSimultaneousLights:this.maxSimultaneousLights},void 0,void 0,l,l):e=new Xr.w(this.name+"PostProcess",l,this._fragmentCompilationState.uniforms,this._fragmentCompilationState.samplers,i,t,r,s,n,h.toString(),a,l,{maxSimultaneousLights:this.maxSimultaneousLights},!1,o,this.shaderLanguage),e.nodeMaterialSource=this,e.onApplyObservable.add((t=>{u!==this._buildId&&(delete Hn.M.ShadersStore[l+"VertexShader"],delete Hn.M.ShadersStore[l+"PixelShader"],l=this.name+this._buildId,h.markAllAsDirty(),u=this._buildId);this._processDefines(c,h)&&(Hn.M.RegisterShader(l,this._fragmentCompilationState._builtCompilationString,this._vertexCompilationState._builtCompilationString),ma._.SetImmediate((()=>e.updateEffect(h.toString(),this._fragmentCompilationState.uniforms,this._fragmentCompilationState.samplers,{maxSimultaneousLights:this.maxSimultaneousLights},void 0,void 0,l,l)))),this._checkInternals(t)})),e}createProceduralTexture(e,t){if(this.mode!==_a.ProceduralTexture)return T.V.Log("Incompatible material mode"),null;let i=this.name+this._buildId;const r=new Ta(i,e,null,t),s=new Xe(i+"Procedural",this.getScene());s.reservedDataStore={hidden:!0};const n=new Ra,a=this._processDefines(s,n);Hn.M.RegisterShader(i,this._fragmentCompilationState._builtCompilationString,this._vertexCompilationState._builtCompilationString,this.shaderLanguage);let o=this.getScene().getEngine().createEffect({vertexElement:i,fragmentElement:i},[S.R.PositionKind],this._fragmentCompilationState.uniforms,this._fragmentCompilationState.samplers,n.toString(),a?.fallbacks,void 0,void 0,void 0,this.shaderLanguage);r.nodeMaterialSource=this,r._setEffect(o);let l=this._buildId;const h=()=>{l!==this._buildId&&(delete Hn.M.ShadersStore[i+"VertexShader"],delete Hn.M.ShadersStore[i+"PixelShader"],i=this.name+this._buildId,n.markAllAsDirty(),l=this._buildId);const e=this._processDefines(s,n);e&&(Hn.M.RegisterShader(i,this._fragmentCompilationState._builtCompilationString,this._vertexCompilationState._builtCompilationString,this.shaderLanguage),ma._.SetImmediate((()=>{o=this.getScene().getEngine().createEffect({vertexElement:i,fragmentElement:i},[S.R.PositionKind],this._fragmentCompilationState.uniforms,this._fragmentCompilationState.samplers,n.toString(),e?.fallbacks,void 0),r._setEffect(o)}))),this._checkInternals(o)};return r.onBeforeGenerationObservable.add((()=>{h()})),this.onBuildObservable.add((()=>{h()})),r}_createEffectForParticles(e,t,i,r,s,n,a){let o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",l=this.name+this._buildId+"_"+t;n||(n=new Ra),a||(a=this.getScene().getMeshByName(this.name+"Particle"))||((a=new Xe(this.name+"Particle",this.getScene())).reservedDataStore={hidden:!0});let h=this._buildId;const c=[];let u=o;if(!s){const o=this._processDefines(a,n);Hn.M.RegisterShader(l,this._fragmentCompilationState._builtCompilationString,void 0,this.shaderLanguage),e.fillDefines(c,t,!1),u=c.join("\n"),s=this.getScene().getEngine().createEffectForParticles(l,this._fragmentCompilationState.uniforms,this._fragmentCompilationState.samplers,n.toString()+"\n"+u,o?.fallbacks,i,r,e,this.shaderLanguage),e.setCustomEffect(s,t)}s.onBindObservable.add((s=>{h!==this._buildId&&(delete Hn.M.ShadersStore[l+"PixelShader"],l=this.name+this._buildId+"_"+t,n.markAllAsDirty(),h=this._buildId),c.length=0,e.fillDefines(c,t,!1);const d=c.join("\n");d!==u&&(n.markAllAsDirty(),u=d);const _=this._processDefines(a,n);if(_)return Hn.M.RegisterShader(l,this._fragmentCompilationState._builtCompilationString,void 0,this.shaderLanguage),s=this.getScene().getEngine().createEffectForParticles(l,this._fragmentCompilationState.uniforms,this._fragmentCompilationState.samplers,n.toString()+"\n"+u,_?.fallbacks,i,r,e),e.setCustomEffect(s,t),void this._createEffectForParticles(e,t,i,r,s,n,a,o);this._checkInternals(s)}))}_checkInternals(e){if(this._sharedData.animatedInputs){const e=this.getScene(),t=e.getFrameId();if(this._animationFrame!==t){for(const t of this._sharedData.animatedInputs)t.animate(e);this._animationFrame=t}}for(const t of this._sharedData.bindableBlocks)t.bind(e,this);for(const t of this._sharedData.inputBlocks)t._transmit(e,this.getScene(),this)}createEffectForParticles(e,t,i){this.mode===_a.Particle?(this._createEffectForParticles(e,fa.BLENDMODE_ONEONE,t,i),this._createEffectForParticles(e,fa.BLENDMODE_MULTIPLY,t,i)):T.V.Log("Incompatible material mode")}createAsShadowDepthWrapper(e){this.mode===_a.Material?e.shadowDepthWrapper=new BABYLON.ShadowDepthWrapper(this,this.getScene()):T.V.Log("Incompatible material mode")}_processDefines(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0,s=null;if(Fe(this.getScene(),t)&&t.markAsMiscDirty(),this._sharedData.blocksWithDefines.forEach((r=>{r.initializeDefines(e,this,t,i)})),this._sharedData.blocksWithDefines.forEach((s=>{s.prepareDefines(e,this,t,i,r)})),t.isDirty){const i=t._areLightsDisposed;t.markAsProcessed(),this._vertexCompilationState.compilationString=this._vertexCompilationState._builtCompilationString,this._fragmentCompilationState.compilationString=this._fragmentCompilationState._builtCompilationString,this._sharedData.repeatableContentBlocks.forEach((i=>{i.replaceRepeatableContent(this._vertexCompilationState,this._fragmentCompilationState,e,t)}));const r=[];this._sharedData.dynamicUniformBlocks.forEach((e=>{e.updateUniformsAndSamples(this._vertexCompilationState,this,t,r)}));const n=this._vertexCompilationState.uniforms;this._fragmentCompilationState.uniforms.forEach((e=>{-1===n.indexOf(e)&&n.push(e)}));const a=this._vertexCompilationState.samplers;this._fragmentCompilationState.samplers.forEach((e=>{-1===a.indexOf(e)&&a.push(e)}));const o=new ni;this._sharedData.blocksWithFallbacks.forEach((t=>{t.provideFallbacks(e,o)})),s={lightDisposed:i,uniformBuffers:r,mergedUniforms:n,mergedSamplers:a,fallbacks:o}}return s}isReadyForSubMesh(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._buildWasSuccessful)return!1;const r=this.getScene();if(this._sharedData.animatedInputs){const e=r.getFrameId();if(this._animationFrame!==e){for(const e of this._sharedData.animatedInputs)e.animate(r);this._animationFrame=e}}const s=t._drawWrapper;if(s.effect&&this.isFrozen&&s._wasPreviouslyReady&&s._wasPreviouslyUsingInstances===i)return!0;t.materialDefines||(t.materialDefines=new Ra);const n=t.materialDefines;if(this._isReadyForSubMesh(t))return!0;const a=r.getEngine();if(this._prepareDefinesForAttributes(e,n),this._sharedData.blockingBlocks.some((t=>!t.isReady(e,this,n,i))))return!1;const o=this._processDefines(e,n,i,t);if(o){const e=t.effect,i=n.toString();let s=a.createEffect({vertex:"nodeMaterial"+this._buildId,fragment:"nodeMaterial"+this._buildId,vertexSource:this._vertexCompilationState.compilationString,fragmentSource:this._fragmentCompilationState.compilationString},{attributes:this._vertexCompilationState.attributes,uniformsNames:o.mergedUniforms,uniformBuffersNames:o.uniformBuffers,samplers:o.mergedSamplers,defines:i,fallbacks:o.fallbacks,onCompiled:this.onCompiled,onError:this.onError,multiTarget:n.PREPASS,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights,maxSimultaneousMorphTargets:n.NUM_MORPH_INFLUENCERS},shaderLanguage:this.shaderLanguage},a);if(s)if(this._onEffectCreatedObservable&&(Ca.effect=s,Ca.subMesh=t,this._onEffectCreatedObservable.notifyObservers(Ca)),this.allowShaderHotSwapping&&e&&!s.isReady()){if(s=e,n.markAsUnprocessed(),o.lightDisposed)return n._areLightsDisposed=!0,!1}else r.resetCachedMaterial(),t.setEffect(s,n,this._materialContext)}return!(!t.effect||!t.effect.isReady())&&(n._renderId=r.getRenderId(),s._wasPreviouslyReady=!0,s._wasPreviouslyUsingInstances=i,this._checkScenePerformancePriority(),!0)}get compiledShaders(){return`// Vertex shader\n${this._vertexCompilationState.compilationString}\n\n// Fragment shader\n${this._fragmentCompilationState.compilationString}`}bindOnlyWorldMatrix(e){const t=this.getScene();if(!this._activeEffect)return;const i=this._sharedData.hints;i.needWorldViewMatrix&&e.multiplyToRef(t.getViewMatrix(),this._cachedWorldViewMatrix),i.needWorldViewProjectionMatrix&&e.multiplyToRef(t.getTransformMatrix(),this._cachedWorldViewProjectionMatrix);for(const r of this._sharedData.inputBlocks)r._transmitWorld(this._activeEffect,e,this._cachedWorldViewMatrix,this._cachedWorldViewProjectionMatrix)}bindForSubMesh(e,t,i){const r=this.getScene(),s=i.effect;if(!s)return;this._activeEffect=s,this.bindOnlyWorldMatrix(e);const n=this._mustRebind(r,s,i,t.visibility),a=this._sharedData;if(n){for(const e of a.bindableBlocks)e.bind(s,this,t,i);for(const e of a.forcedBindableBlocks)e.bind(s,this,t,i);for(const e of a.inputBlocks)e._transmit(s,r,this)}else if(!this.isFrozen)for(const o of a.forcedBindableBlocks)o.bind(s,this,t,i);this._afterBind(t,this._activeEffect,i)}getActiveTextures(){const e=super.getActiveTextures();return this._sharedData&&e.push(...this._sharedData.textureBlocks.filter((e=>e.texture)).map((e=>e.texture))),e}getTextureBlocks(){return this._sharedData?this._sharedData.textureBlocks:[]}getAllTextureBlocks(){const e=[];for(const t of this.attachedBlocks)Ea._BlockIsTextureBlock(t)&&e.push(t);return e}hasTexture(e){if(super.hasTexture(e))return!0;if(!this._sharedData)return!1;for(const t of this._sharedData.textureBlocks)if(t.texture===e)return!0;return!1}dispose(e,t,i){if(t)for(const r of this.getTextureBlocks().filter((e=>e.texture)).map((e=>e.texture)))r.dispose();for(const r of this.attachedBlocks)r.dispose();this.attachedBlocks.length=0,this._sharedData=null,this._vertexCompilationState=null,this._fragmentCompilationState=null,this.onBuildObservable.clear(),this.onBuildErrorObservable.clear(),this._imageProcessingObserver&&(this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingObserver=null),super.dispose(e,t,i)}_createNodeEditor(e){const t={nodeMaterial:this,...e};this.BJSNODEMATERIALEDITOR.NodeEditor.Show(t)}edit(e){return new Promise((t=>{if(this.BJSNODEMATERIALEDITOR=this.BJSNODEMATERIALEDITOR||this._getGlobalNodeMaterialEditor(),"undefined"==typeof this.BJSNODEMATERIALEDITOR){const i=e&&e.editorURL?e.editorURL:Ea.EditorURL;_.S0.LoadBabylonScript(i,(()=>{this.BJSNODEMATERIALEDITOR=this.BJSNODEMATERIALEDITOR||this._getGlobalNodeMaterialEditor(),this._createNodeEditor(e?.nodeEditorConfig),t()}))}else this._createNodeEditor(e?.nodeEditorConfig),t()}))}clear(){this._vertexOutputNodes.length=0,this._fragmentOutputNodes.length=0,this.attachedBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const e=new sa("Position");e.setAsAttribute("position");const t=new sa("World");t.setAsSystemValue(Kn.World);const i=new $n("WorldPos");e.connectTo(i),t.connectTo(i);const r=new sa("ViewProjection");r.setAsSystemValue(Kn.ViewProjection);const s=new $n("WorldPos * ViewProjectionTransform");i.connectTo(s),r.connectTo(s);const n=new Zn("VertexOutput");s.connectTo(n);const a=new sa("color");a.value=new E.ov(.8,.8,.8,1);const o=new ea("FragmentOutput");a.connectTo(o),this.addOutputNode(n),this.addOutputNode(o),this._mode=_a.Material}setToDefaultPostProcess(){this.clear(),this.editorData=null;const e=new sa("Position");e.setAsAttribute("position2d");const t=new sa("Constant1");t.isConstant=!0,t.value=1;const i=new ha("Position3D");e.connectTo(i),t.connectTo(i,{input:"w"});const r=new Zn("VertexOutput");i.connectTo(r);const s=new sa("Scale");s.visibleInInspector=!0,s.value=new o.I9(1,1);const n=new ca("uv0");e.connectTo(n);const a=new da("UV scale");n.connectTo(a),s.connectTo(a);const l=new na("CurrentScreen");a.connectTo(l),l.texture=new kt.g("https://assets.babylonjs.com/nme/currentScreenPostProcess.png",this.getScene());const h=new ea("FragmentOutput");l.connectTo(h,{output:"rgba"}),this.addOutputNode(r),this.addOutputNode(h),this._mode=_a.PostProcess}setToDefaultProceduralTexture(){this.clear(),this.editorData=null;const e=new sa("Position");e.setAsAttribute("position2d");const t=new sa("Constant1");t.isConstant=!0,t.value=1;const i=new ha("Position3D");e.connectTo(i),t.connectTo(i,{input:"w"});const r=new Zn("VertexOutput");i.connectTo(r);const s=new sa("Time");s.value=0,s.min=0,s.max=0,s.isBoolean=!1,s.matrixMode=0,s.animationType=Yn.Time,s.isConstant=!1;const n=new sa("Color3");n.value=new E.v9(1,1,1),n.isConstant=!1;const a=new ea("FragmentOutput"),o=new ha("VectorMerger");o.visibleInInspector=!1;const l=new Aa("Cos");l.operation=xa.Cos,e.connectTo(o),s.output.connectTo(l.input),l.output.connectTo(o.z),o.xyzOut.connectTo(a.rgb),this.addOutputNode(r),this.addOutputNode(a),this._mode=_a.ProceduralTexture}setToDefaultParticle(){this.clear(),this.editorData=null;const e=new sa("uv");e.setAsAttribute("particle_uv");const t=new aa("ParticleTexture");e.connectTo(t);const i=new sa("Color");i.setAsAttribute("particle_color");const r=new da("Texture * Color");t.connectTo(r),i.connectTo(r);const s=new oa("ParticleRampGradient");r.connectTo(s);const n=new ga("ColorSplitter");i.connectTo(n);const a=new la("ParticleBlendMultiply");s.connectTo(a),t.connectTo(a,{output:"a"}),n.connectTo(a,{output:"a"});const o=new ea("FragmentOutput");a.connectTo(o),this.addOutputNode(o),this._mode=_a.Particle}async loadAsync(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return Ea.ParseFromFileAsync("",e,this.getScene(),t,!0,this)}_gatherBlocks(e,t){if(-1===t.indexOf(e)){t.push(e);for(const i of e.inputs){const r=i.connectedPoint;if(r){const i=r.ownerBlock;i!==e&&this._gatherBlocks(i,t)}}if(e.isTeleportOut){const i=e;i.entryPoint&&this._gatherBlocks(i.entryPoint,t)}}}generateCode(){let e=[];const t=[],i=["const","var","let"];for(const n of this._vertexOutputNodes)this._gatherBlocks(n,t);const r=[];for(const n of this._fragmentOutputNodes)this._gatherBlocks(n,r);let s=`var nodeMaterial = new BABYLON.NodeMaterial("${this.name||"node material"}");\n`;s+=`nodeMaterial.mode = BABYLON.NodeMaterialModes.${_a[this.mode]};\n`;for(const n of t)n.isInput&&-1===e.indexOf(n)&&(s+=n._dumpCode(i,e));for(const n of r)n.isInput&&-1===e.indexOf(n)&&(s+=n._dumpCode(i,e));e=[],s+="\n// Connections\n";for(const n of this._vertexOutputNodes)s+=n._dumpCodeForOutputConnections(e);for(const n of this._fragmentOutputNodes)s+=n._dumpCodeForOutputConnections(e);s+="\n// Output nodes\n";for(const n of this._vertexOutputNodes)s+=`nodeMaterial.addOutputNode(${n._codeVariableName});\n`;for(const n of this._fragmentOutputNodes)s+=`nodeMaterial.addOutputNode(${n._codeVariableName});\n`;return s+="nodeMaterial.build();\n",s}serialize(e){const t=e?{}:c.p.Serialize(this);t.editorData=JSON.parse(JSON.stringify(this.editorData));let i=[];if(e)i=e;else{t.customType="BABYLON.NodeMaterial",t.outputNodes=[];for(const e of this._vertexOutputNodes)this._gatherBlocks(e,i),t.outputNodes.push(e.uniqueId);for(const e of this._fragmentOutputNodes)this._gatherBlocks(e,i),-1===t.outputNodes.indexOf(e.uniqueId)&&t.outputNodes.push(e.uniqueId)}t.blocks=[];for(const r of i)t.blocks.push(r.serialize());if(!e)for(const r of this.attachedBlocks)-1===i.indexOf(r)&&t.blocks.push(r.serialize());return t.uniqueId=this.uniqueId,t}_restoreConnections(e,t,i){for(const r of e.outputs)for(const s of t.blocks){const n=i[s.id];if(n)for(const a of s.inputs)if(i[a.targetBlockId]!==e||a.targetConnectionName!==r.name);else{const e=n.getInputByName(a.inputName);if(!e||e.isConnected)continue;r.connectTo(e,!0),this._restoreConnections(n,t,i)}}}parseSerializedObject(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0;i||this.clear();const s={};for(const n of e.blocks){const e=(0,x.n9)(n.customType);if(e){const i=new e;i._deserialize(n,this.getScene(),t,r),s[n.id]=i,this.attachedBlocks.push(i)}}for(const n of this.attachedBlocks)if(n.isTeleportOut){const e=n,t=e._tempEntryPointUniqueId;if(t){s[t].attachToEndpoint(e)}}for(let n=0;n<e.blocks.length;n++){const t=s[e.blocks[n].id];t&&(t.inputs.length&&!i||this._restoreConnections(t,e,s))}if(e.outputNodes)for(const n of e.outputNodes)this.addOutputNode(s[n]);if(e.locations||e.editorData&&e.editorData.locations){const t=e.locations||e.editorData.locations;for(const e of t)s[e.blockId]&&(e.blockId=s[e.blockId].uniqueId);i&&this.editorData&&this.editorData.locations&&t.concat(this.editorData.locations),e.locations?this.editorData={locations:t}:(this.editorData=e.editorData,this.editorData.locations=t);const r=[];for(const e in s)r[e]=s[e].uniqueId;this.editorData.map=r}this.comment=e.comment,void 0!==e.forceAlphaBlending&&(this.forceAlphaBlending=e.forceAlphaBlending),void 0!==e.alphaMode&&(this.alphaMode=e.alphaMode),i||(this._mode=e.mode??_a.Material)}loadFromSerialization(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.parseSerializedObject(e,t,i)}clone(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=this.serialize(),r=c.p.Clone((()=>new Ea(e,this.getScene(),this.options)),this);return r.id=e,r.name=e,r.parseSerializedObject(i),r._buildId=this._buildId,r.build(!1,!t),r}whenTexturesReadyAsync(){const e=[];return this.getActiveTextures().forEach((t=>{const i=t.getInternalTexture();i&&!i.isReady&&e.push(new Promise(((e,t)=>{i.onLoadedObservable.addOnce((()=>{e()})),i.onErrorObservable.addOnce((e=>{t(e)}))})))})),Promise.all(e)}static Parse(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const s=c.p.Parse((()=>new Ea(e.name,t,{shaderLanguage:r})),e,t,i);return s.parseSerializedObject(e,i),s.build(),s}static async ParseFromFileAsync(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],n=arguments.length>6?arguments[6]:void 0;const a=(arguments.length>5?arguments[5]:void 0)??new Ea(e,i),o=await i._loadFileAsync(t),l=JSON.parse(o);return a.parseSerializedObject(l,r,void 0,n),s||a.build(),a}static ParseFromSnippetAsync(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l.q.LastCreatedScene,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3?arguments[3]:void 0,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],n=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=arguments.length>6?arguments[6]:void 0;return"_BLANK"===e?Promise.resolve(Ea.CreateDefault("blank",t)):new Promise(((o,l)=>{const h=new st.u;h.addEventListener("readystatechange",(()=>{if(4==h.readyState)if(200==h.status){const d=JSON.parse(JSON.parse(h.responseText).jsonPayload),_=JSON.parse(d.nodeMaterial);r||(r=c.p.Parse((()=>new Ea(e,t)),_,t,i),r.uniqueId=t.getUniqueId()),r.parseSerializedObject(_,void 0,void 0,a),r.snippetId=e,r.sideOrientation=null;try{s||r.build()}catch(u){l(u)}n?r.whenTexturesReadyAsync().then((()=>{o(r)})).catch((e=>{l(e)})):o(r)}else l("Unable to load the snippet "+e)})),h.open("GET",this.SnippetUrl+"/"+e.replace(/#/g,"/")),h.send()}))}static CreateDefault(e,t){const i=new Ea(e,t);return i.setToDefault(),i.build(),i}}var Sa,Ma,Pa,Ia;Ea._BuildIdGenerator=0,Ea.EditorURL=`${_.S0._DefaultCdnUrl}/v${ee.$.Version}/nodeEditor/babylon.nodeEditor.js`,Ea.SnippetUrl="https://snippet.babylonjs.com",Ea.IgnoreTexturesAtLoadTime=!1,Ea.DefaultShaderLanguage=0,(0,s.Cg)([(0,n.lK)()],Ea.prototype,"ignoreAlpha",void 0),(0,s.Cg)([(0,n.lK)()],Ea.prototype,"maxSimultaneousLights",void 0),(0,s.Cg)([(0,n.lK)("mode")],Ea.prototype,"_mode",void 0),(0,s.Cg)([(0,n.lK)("comment")],Ea.prototype,"comment",void 0),(0,s.Cg)([(0,n.lK)()],Ea.prototype,"forceAlphaBlending",void 0),(0,x.Y5)("BABYLON.NodeMaterial",Ea),G.prototype._projectOnTrianglesToRef=function(e,t,i,r,s,n){const a=o.AA.Vector3[0],l=o.AA.Vector3[1];let h=1/0;for(let c=this.indexStart;c<this.indexStart+this.indexCount-(3-r);c+=r){const r=i[c],n=i[c+1],u=i[c+2];if(s&&4294967295===u){c+=2;continue}const d=t[r],_=t[n],p=t[u];if(!d||!_||!p)continue;const f=o.Pq.ProjectOnTriangleToRef(e,d,_,p,l);f<h&&(a.copyFrom(l),h=f)}return n.copyFrom(a),h},G.prototype._projectOnUnIndexedTrianglesToRef=function(e,t,i,r){const s=o.AA.Vector3[0],n=o.AA.Vector3[1];let a=1/0;for(let l=this.verticesStart;l<this.verticesStart+this.verticesCount;l+=3){const i=t[l],r=t[l+1],h=t[l+2],c=o.Pq.ProjectOnTriangleToRef(e,i,r,h,n);c<a&&(s.copyFrom(n),a=c)}return r.copyFrom(s),a},G.prototype.projectToRef=function(e,t,i,r){const s=this.getMaterial();if(!s)return-1;let n=3,a=!1;switch(s.fillMode){case 3:case 5:case 6:case 8:return-1;case 7:n=1,a=!0}return 4===s.fillMode?-1:!i.length&&this._mesh._unIndexed?this._projectOnUnIndexedTrianglesToRef(e,t,i,r):this._projectOnTrianglesToRef(e,t,i,n,a,r)},function(e){e[e.DEHYDRATED=0]="DEHYDRATED",e[e.HOVER=1]="HOVER",e[e.TOUCH=2]="TOUCH"}(Sa||(Sa={})),function(e){e[e.DISABLED=0]="DISABLED",e[e.CENTERED_ON_CONTROLLER=1]="CENTERED_ON_CONTROLLER",e[e.CENTERED_IN_FRONT=2]="CENTERED_IN_FRONT"}(Ma||(Ma={}));class Oa extends Ln{constructor(e,t){super(e),this._options=t,this._tmpRay=new xs(new o.Pq,new o.Pq),this._attachController=e=>{if(this._controllers[e.uniqueId])return;const{touchCollisionMesh:t,touchCollisionMeshFunction:i,hydrateCollisionMeshFunction:r}=this._generateNewTouchPointMesh(),s=this._generateVisualCue();switch(this._controllers[e.uniqueId]={xrController:e,meshUnderPointer:null,nearInteractionTargetMesh:null,pick:null,stalePick:null,touchCollisionMesh:t,touchCollisionMeshFunction:i,hydrateCollisionMeshFunction:r,currentAnimationState:Sa.DEHYDRATED,grabRay:new xs(new o.Pq,new o.Pq),hoverInteraction:!1,nearInteraction:!1,grabInteraction:!1,downTriggered:!1,id:Oa._IdCounter++,pickedPointVisualCue:s},this._controllers[e.uniqueId]._worldScaleObserver=this._controllers[e.uniqueId]._worldScaleObserver||this._xrSessionManager.onWorldScaleFactorChangedObservable.add((t=>{if(t.newScaleFactor!==t.previousScaleFactor){this._controllers[e.uniqueId].touchCollisionMesh.dispose(),this._controllers[e.uniqueId].pickedPointVisualCue.dispose();const{touchCollisionMesh:t,touchCollisionMeshFunction:i,hydrateCollisionMeshFunction:r}=this._generateNewTouchPointMesh();this._controllers[e.uniqueId].touchCollisionMesh=t,this._controllers[e.uniqueId].touchCollisionMeshFunction=i,this._controllers[e.uniqueId].hydrateCollisionMeshFunction=r,this._controllers[e.uniqueId].pickedPointVisualCue=this._generateVisualCue()}})),this._attachedController?!this._options.enableNearInteractionOnAllControllers&&this._options.preferredHandedness&&e.inputSource.handedness===this._options.preferredHandedness&&(this._attachedController=e.uniqueId):this._options.enableNearInteractionOnAllControllers||(this._attachedController=e.uniqueId),e.inputSource.targetRayMode){case"tracked-pointer":return this._attachNearInteractionMode(e);case"gaze":case"screen":return null}},this._controllers={},this._farInteractionFeature=null,this.selectionMeshDefaultColor=new E.v9(.8,.8,.8),this.selectionMeshPickedColor=new E.v9(.3,.3,1),this._hoverRadius=.1,this._pickRadius=.02,this._controllerPickRadius=.03,this._nearGrabLengthScale=5,this._scene=this._xrSessionManager.scene,void 0===this._options.nearInteractionControllerMode&&(this._options.nearInteractionControllerMode=2),this._options.farInteractionFeature&&(this._farInteractionFeature=this._options.farInteractionFeature)}attach(){return!!super.attach()&&(this._options.xrInput.controllers.forEach(this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerAddedObservable,this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerRemovedObservable,(e=>{this._detachController(e.uniqueId)})),this._scene.constantlyUpdateMeshUnderPointer=!0,!0)}detach(){return!!super.detach()&&(Object.keys(this._controllers).forEach((e=>{this._detachController(e)})),!0)}getMeshUnderPointer(e){return this._controllers[e]?this._controllers[e].meshUnderPointer:null}getXRControllerByPointerId(e){const t=Object.keys(this._controllers);for(let i=0;i<t.length;++i)if(this._controllers[t[i]].id===e)return this._controllers[t[i]].xrController||null;return null}setFarInteractionFeature(e){this._farInteractionFeature=e}_nearPickPredicate(e){return e.isEnabled()&&e.isVisible&&e.isPickable&&e.isNearPickable}_nearGrabPredicate(e){return e.isEnabled()&&e.isVisible&&e.isPickable&&e.isNearGrabbable}_nearInteractionPredicate(e){return e.isEnabled()&&e.isVisible&&e.isPickable&&(e.isNearPickable||e.isNearGrabbable)}_controllerAvailablePredicate(e,t){let i=e;for(;i;){if(i.reservedDataStore&&i.reservedDataStore.nearInteraction&&i.reservedDataStore.nearInteraction.excludedControllerId===t)return!1;i=i.parent}return!0}_handleTransitionAnimation(e,t){if(e.currentAnimationState!==t&&2===this._options.nearInteractionControllerMode&&!e.xrController?.inputSource.hand){if(t>e.currentAnimationState)switch(e.currentAnimationState){case Sa.DEHYDRATED:if(e.hydrateCollisionMeshFunction(!0),t===Sa.HOVER)break;case Sa.HOVER:if(e.touchCollisionMeshFunction(!0),t===Sa.TOUCH)break}else switch(e.currentAnimationState){case Sa.TOUCH:if(e.touchCollisionMeshFunction(!1),t===Sa.HOVER)break;case Sa.HOVER:if(e.hydrateCollisionMeshFunction(!1),t===Sa.DEHYDRATED)break}e.currentAnimationState=t}}_processTouchPoint(e,t,i){const r=this._controllers[e];r.grabRay.origin.copyFrom(t),i.toEulerAnglesToRef(o.AA.Vector3[0]),r.grabRay.direction.copyFrom(o.AA.Vector3[0]),2!==this._options.nearInteractionControllerMode||r.xrController?.inputSource.hand||(r.xrController.getWorldPointerRayToRef(this._tmpRay),r.grabRay.origin.addInPlace(this._tmpRay.direction.scale(.05))),r.grabRay.length=this._nearGrabLengthScale*this._hoverRadius*this._xrSessionManager.worldScalingFactor,r.touchCollisionMesh.position.copyFrom(r.grabRay.origin).scaleInPlace(this._xrSessionManager.worldScalingFactor)}_onXRFrame(e){Object.keys(this._controllers).forEach((t=>{const i=this._controllers[t],r=i.xrController?.inputSource.hand;if(!this._options.enableNearInteractionOnAllControllers&&t!==this._attachedController||!i.xrController||!r&&(!this._options.nearInteractionControllerMode||!i.xrController.inputSource.gamepad))return void(i.pick=null);if(i.hoverInteraction=!1,i.nearInteraction=!1,!i.xrController)return;if(r){const i=r.get("index-finger-tip");if(i){const r=e.getJointPose(i,this._xrSessionManager.referenceSpace);if(r&&r.transform){const e=this._scene.useRightHandedSystem?1:-1;o.AA.Vector3[0].set(r.transform.position.x,r.transform.position.y,r.transform.position.z*e),o.AA.Quaternion[0].set(r.transform.orientation.x,r.transform.orientation.y,r.transform.orientation.z*e,r.transform.orientation.w*e),this._processTouchPoint(t,o.AA.Vector3[0],o.AA.Quaternion[0])}}}else if(i.xrController.inputSource.gamepad&&0!==this._options.nearInteractionControllerMode){let e=i.xrController.pointer;i.xrController.grip&&1===this._options.nearInteractionControllerMode&&(e=i.xrController.grip),this._processTouchPoint(t,e.position,e.rotationQuaternion)}const s=(e,t)=>{let i=null;return i=t&&t.hit?e&&e.hit?t.distance<e.distance?t:e:t:e,i},n=e=>{let t=new Q.G,i=!1;const r=e&&e.pickedPoint&&e.hit;return e?.pickedPoint&&(i=0===e.pickedPoint.x&&0===e.pickedPoint.y&&0===e.pickedPoint.z),r&&!i&&(t=e),t};if(!i.grabInteraction){let e=null,t=null;this._options.useUtilityLayer&&this._utilityLayerScene&&(t=this._pickWithSphere(i,this._hoverRadius*this._xrSessionManager.worldScalingFactor,this._utilityLayerScene,(e=>this._nearInteractionPredicate(e))));const a=s(this._pickWithSphere(i,this._hoverRadius*this._xrSessionManager.worldScalingFactor,this._scene,(e=>this._nearInteractionPredicate(e))),t);if(a&&a.hit&&(e=n(a),e.hit&&(i.hoverInteraction=!0)),i.hoverInteraction){let t=null;const a=(r?this._pickRadius:this._controllerPickRadius)*this._xrSessionManager.worldScalingFactor;this._options.useUtilityLayer&&this._utilityLayerScene&&(t=this._pickWithSphere(i,a,this._utilityLayerScene,(e=>this._nearPickPredicate(e))));const o=n(s(this._pickWithSphere(i,a,this._scene,(e=>this._nearPickPredicate(e))),t));o.hit&&(e=o,i.nearInteraction=!0)}i.stalePick=i.pick,i.pick=e,i.pick&&i.pick.pickedPoint&&i.pick.hit?(i.meshUnderPointer=i.pick.pickedMesh,i.pickedPointVisualCue.position.copyFrom(i.pick.pickedPoint),i.pickedPointVisualCue.isVisible=!0,this._farInteractionFeature&&this._farInteractionFeature.attached&&this._farInteractionFeature._setPointerSelectionDisabledByPointerId(i.id,!0)):(i.meshUnderPointer=null,i.pickedPointVisualCue.isVisible=!1,this._farInteractionFeature&&this._farInteractionFeature.attached&&this._farInteractionFeature._setPointerSelectionDisabledByPointerId(i.id,!1))}let a=Sa.DEHYDRATED;i.grabInteraction||i.nearInteraction?a=Sa.TOUCH:i.hoverInteraction&&(a=Sa.HOVER),this._handleTransitionAnimation(i,a)}))}get _utilityLayerScene(){return this._options.customUtilityLayerScene||Bn.DefaultUtilityLayer.utilityLayerScene}_generateVisualCue(){const e=this._options.useUtilityLayer?this._options.customUtilityLayerScene||Bn.DefaultUtilityLayer.utilityLayerScene:this._scene,t=zi("nearInteraction",{diameter:.0105*this._xrSessionManager.worldScalingFactor},e);t.bakeCurrentTransformIntoVertices(),t.isPickable=!1,t.isVisible=!1,t.rotationQuaternion=o.PT.Identity();const i=new zr("targetMat",e);return i.specularColor=E.v9.Black(),i.emissiveColor=this.selectionMeshDefaultColor,i.backFaceCulling=!1,t.material=i,t}_isControllerReadyForNearInteraction(e){return!this._farInteractionFeature||this._farInteractionFeature._getPointerSelectionDisabledByPointerId(e)}_attachNearInteractionMode(e){const t=this._controllers[e.uniqueId],i={pointerId:t.id,pointerType:"xr-near"};t.onFrameObserver=this._xrSessionManager.onXRFrameObservable.add((()=>{(this._options.enableNearInteractionOnAllControllers||e.uniqueId===this._attachedController)&&t.xrController&&(t.xrController.inputSource.hand||this._options.nearInteractionControllerMode&&t.xrController.inputSource.gamepad)&&(t.pick&&(t.pick.ray=t.grabRay),t.pick&&this._isControllerReadyForNearInteraction(t.id)&&this._scene.simulatePointerMove(t.pick,i),t.nearInteraction&&t.pick&&t.pick.hit?t.nearInteractionTargetMesh||(this._scene.simulatePointerDown(t.pick,i),t.nearInteractionTargetMesh=t.meshUnderPointer,t.downTriggered=!0):t.nearInteractionTargetMesh&&t.stalePick&&(this._scene.simulatePointerUp(t.stalePick,i),t.downTriggered=!1,t.nearInteractionTargetMesh=null))}));const r=r=>{this._options.enableNearInteractionOnAllControllers||e.uniqueId===this._attachedController&&this._isControllerReadyForNearInteraction(t.id)?(t.pick&&(t.pick.ray=t.grabRay),r&&t.pick&&t.meshUnderPointer&&this._nearGrabPredicate(t.meshUnderPointer)?(t.grabInteraction=!0,t.pickedPointVisualCue.isVisible=!1,this._scene.simulatePointerDown(t.pick,i),t.downTriggered=!0):!r&&t.pick&&t.grabInteraction&&(this._scene.simulatePointerUp(t.pick,i),t.downTriggered=!1,t.grabInteraction=!1,t.pickedPointVisualCue.isVisible=!0)):!r||this._options.enableNearInteractionOnAllControllers||this._options.disableSwitchOnClick||(this._attachedController=e.uniqueId)};if(e.inputSource.gamepad){const i=e=>{t.squeezeComponent=e.getComponent("grasp"),t.squeezeComponent?t.onSqueezeButtonChangedObserver=t.squeezeComponent.onButtonStateChangedObservable.add((e=>{if(e.changes.pressed){const t=e.changes.pressed.current;r(t)}})):(t.selectionComponent=e.getMainComponent(),t.onButtonChangedObserver=t.selectionComponent.onButtonStateChangedObservable.add((e=>{if(e.changes.pressed){const t=e.changes.pressed.current;r(t)}})))};e.motionController?i(e.motionController):e.onMotionControllerInitObservable.add(i)}else{const e=e=>{t.xrController&&e.inputSource===t.xrController.inputSource&&t.pick&&this._isControllerReadyForNearInteraction(t.id)&&t.meshUnderPointer&&this._nearGrabPredicate(t.meshUnderPointer)&&(t.grabInteraction=!0,t.pickedPointVisualCue.isVisible=!1,this._scene.simulatePointerDown(t.pick,i),t.downTriggered=!0)},r=e=>{t.xrController&&e.inputSource===t.xrController.inputSource&&t.pick&&this._isControllerReadyForNearInteraction(t.id)&&(this._scene.simulatePointerUp(t.pick,i),t.grabInteraction=!1,t.pickedPointVisualCue.isVisible=!0,t.downTriggered=!1)};t.eventListeners={selectend:r,selectstart:e},this._xrSessionManager.session.addEventListener("selectstart",e),this._xrSessionManager.session.addEventListener("selectend",r)}}_detachController(e){const t=this._controllers[e];if(t&&(t.squeezeComponent&&t.onSqueezeButtonChangedObserver&&t.squeezeComponent.onButtonStateChangedObservable.remove(t.onSqueezeButtonChangedObserver),t.selectionComponent&&t.onButtonChangedObserver&&t.selectionComponent.onButtonStateChangedObservable.remove(t.onButtonChangedObserver),t.onFrameObserver&&this._xrSessionManager.onXRFrameObservable.remove(t.onFrameObserver),t.eventListeners&&Object.keys(t.eventListeners).forEach((e=>{const i=t.eventListeners&&t.eventListeners[e];i&&this._xrSessionManager.session.removeEventListener(e,i)})),t.touchCollisionMesh.dispose(),t.pickedPointVisualCue.dispose(),this._xrSessionManager.runInXRFrame((()=>{if(!t.downTriggered)return;const e={pointerId:t.id,pointerType:"xr-near"};this._scene.simulatePointerUp(new Q.G,e)})),t._worldScaleObserver&&this._xrSessionManager.onWorldScaleFactorChangedObservable.remove(t._worldScaleObserver),delete this._controllers[e],this._attachedController===e)){const e=Object.keys(this._controllers);e.length?this._attachedController=e[0]:this._attachedController=""}}_generateNewTouchPointMesh(){const e=this._xrSessionManager.worldScalingFactor,t=this._options.useUtilityLayer?this._options.customUtilityLayerScene||Bn.DefaultUtilityLayer.utilityLayerScene:this._scene,i=zi("PickSphere",{diameter:1*e},t);if(i.isVisible=!1,this._options.motionControllerOrbMaterial)i.material=this._options.motionControllerOrbMaterial;else{let e;e=this._options.motionControllerTouchMaterialSnippetUrl?Ea.ParseFromFileAsync("motionControllerTouchMaterial",this._options.motionControllerTouchMaterialSnippetUrl,t):Ea.ParseFromSnippetAsync("8RUNKL#3",t),e.then((e=>{i.material=e})).catch((e=>{T.V.Warn(`Error creating touch material in WebXRNearInteraction: ${e}`)}))}const r=new Je;r.setEasingMode($e.EASINGMODE_EASEINOUT);const s=new o.Pq(this._controllerPickRadius,this._controllerPickRadius,this._controllerPickRadius).scaleInPlace(e),n=this._controllerPickRadius*(4/3),a=new o.Pq(n,n,n).scaleInPlace(e),l=this._controllerPickRadius*(7/6),h=new o.Pq(l,l,l).scaleInPlace(e),c=.8*this._controllerPickRadius,u=new o.Pq(c,c,c).scaleInPlace(e),d=1.5*this._controllerPickRadius,_=[{frame:0,value:s},{frame:10,value:new o.Pq(d,d,d).scaleInPlace(e)},{frame:18,value:a}],p=[{frame:0,value:a},{frame:10,value:u},{frame:18,value:s}],f=[{frame:0,value:o.Pq.ZeroReadOnly},{frame:12,value:h},{frame:15,value:s}],g=[{frame:0,value:s},{frame:10,value:o.Pq.ZeroReadOnly},{frame:15,value:o.Pq.ZeroReadOnly}],m=new dt("touch","scaling",60,dt.ANIMATIONTYPE_VECTOR3,dt.ANIMATIONLOOPMODE_CONSTANT),b=new dt("release","scaling",60,dt.ANIMATIONTYPE_VECTOR3,dt.ANIMATIONLOOPMODE_CONSTANT),v=new dt("hydrate","scaling",60,dt.ANIMATIONTYPE_VECTOR3,dt.ANIMATIONLOOPMODE_CONSTANT),y=new dt("dehydrate","scaling",60,dt.ANIMATIONTYPE_VECTOR3,dt.ANIMATIONLOOPMODE_CONSTANT);m.setEasingFunction(r),b.setEasingFunction(r),v.setEasingFunction(r),y.setEasingFunction(r),m.setKeys(_),b.setKeys(p),v.setKeys(f),y.setKeys(g);return{touchCollisionMesh:i,touchCollisionMeshFunction:e=>{const r=e?m:b;t.beginDirectAnimation(i,[r],0,18,!1,1)},hydrateCollisionMeshFunction:e=>{const r=e?v:y;e&&(i.isVisible=!0),t.beginDirectAnimation(i,[r],0,15,!1,1,(()=>{e||(i.isVisible=!1)}))}}}_pickWithSphere(e,t,i,r){const s=new Q.G;if(s.distance=1/0,e.touchCollisionMesh&&e.xrController){const n=e.touchCollisionMesh.position,a=w.CreateFromCenterAndRadius(n,t);for(let t=0;t<i.meshes.length;t++){const n=i.meshes[t];if(!r(n)||!this._controllerAvailablePredicate(n,e.xrController.uniqueId))continue;const o=Oa.PickMeshWithSphere(n,a);o&&o.hit&&o.distance<s.distance&&(s.hit=o.hit,s.pickedMesh=n,s.pickedPoint=o.pickedPoint,s.aimTransform=e.xrController.pointer,s.gripTransform=e.xrController.grip||null,s.originMesh=e.touchCollisionMesh,s.distance=o.distance,s.bu=o.bu,s.bv=o.bv,s.faceId=o.faceId,s.subMeshId=o.subMeshId)}}return s}static PickMeshWithSphere(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=e.subMeshes,s=new Q.G,n=e.getBoundingInfo();if(!e._generatePointsArray())return s;if(!e.subMeshes||!n)return s;if(!i&&!w.Intersects(n.boundingSphere,t))return s;const a=o.AA.Vector3[0],l=o.AA.Vector3[1],h=new xs(o.Pq.Zero(),o.Pq.Zero(),1);let c,u,d,_,p=1/0;const f=o.AA.Vector3[2],g=o.AA.Matrix[0];g.copyFrom(e.getWorldMatrix()),g.invert(),o.Pq.TransformCoordinatesToRef(t.center,g,f);for(let m=0;m<r.length;m++){r[m].projectToRef(f,e._positions,e.getIndices(),l),o.Pq.TransformCoordinatesToRef(l,e.getWorldMatrix(),l),c=o.Pq.Distance(l,t.center),d=o.Pq.Distance(l,e.getAbsolutePosition()),u=o.Pq.Distance(t.center,e.getAbsolutePosition()),-1!==u&&-1!==d&&d>u&&(c=0,l.copyFrom(t.center)),-1!==c&&c<p&&(p=c,xs.CreateFromToToRef(t.center,l,h),h.length=2*p,_=h.intersectsMesh(e),a.copyFrom(l))}return p<t.radius&&(s.hit=!0,s.distance=p,s.pickedMesh=e,s.pickedPoint=a.clone(),_&&null!==_.bu&&null!==_.bv&&(s.faceId=_.faceId,s.subMeshId=_.subMeshId,s.bu=_.bu,s.bv=_.bv)),s}}Oa._IdCounter=200,Oa.Name=Zs.NEAR_INTERACTION,Oa.Version=1,Js.AddWebXRFeature(Oa.Name,((e,t)=>()=>new Oa(e,t)),Oa.Version,!0);class Da{constructor(e,t,i){this.element=e,this.sessionMode=t,this.referenceSpaceType=i}update(e){}}class wa{constructor(e,t){if(this._scene=e,this.options=t,this._activeButton=null,this._buttons=[],this.activeButtonChangedObservable=new a.cP,this._onSessionGranted=e=>{this._helper&&this._enterXRWithButtonIndex(0)},this.overlay=document.createElement("div"),this.overlay.classList.add("xr-button-overlay"),!t.ignoreSessionGrantedEvent&&navigator.xr&&navigator.xr.addEventListener("sessiongranted",this._onSessionGranted),"undefined"!==typeof window&&window.location&&"http:"===window.location.protocol&&"localhost"!==window.location.hostname)throw _.S0.Warn("WebXR can only be served over HTTPS"),new Error("WebXR can only be served over HTTPS");if(t.customButtons)this._buttons=t.customButtons;else{this.overlay.style.cssText="z-index:11;position: absolute; right: 20px;bottom: 50px;";const e=t.sessionMode||"immersive-vr",i=t.referenceSpaceType||"local-floor";let r=".babylonVRicon { color: #868686; border-color: #868686; border-style: solid; margin-left: 10px; height: 50px; width: 80px; background-color: rgba(51,51,51,0.7); background-image: url("+("undefined"===typeof SVGSVGElement?"https://cdn.babylonjs.com/Assets/vrButton.png":"data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%222048%22%20height%3D%221152%22%20viewBox%3D%220%200%202048%201152%22%20version%3D%221.1%22%3E%3Cpath%20transform%3D%22rotate%28180%201024%2C576.0000000000001%29%22%20d%3D%22m1109%2C896q17%2C0%2030%2C-12t13%2C-30t-12.5%2C-30.5t-30.5%2C-12.5l-170%2C0q-18%2C0%20-30.5%2C12.5t-12.5%2C30.5t13%2C30t30%2C12l170%2C0zm-85%2C256q59%2C0%20132.5%2C-1.5t154.5%2C-5.5t164.5%2C-11.5t163%2C-20t150%2C-30t124.5%2C-41.5q23%2C-11%2042%2C-24t38%2C-30q27%2C-25%2041%2C-61.5t14%2C-72.5l0%2C-257q0%2C-123%20-47%2C-232t-128%2C-190t-190%2C-128t-232%2C-47l-81%2C0q-37%2C0%20-68.5%2C14t-60.5%2C34.5t-55.5%2C45t-53%2C45t-53%2C34.5t-55.5%2C14t-55.5%2C-14t-53%2C-34.5t-53%2C-45t-55.5%2C-45t-60.5%2C-34.5t-68.5%2C-14l-81%2C0q-123%2C0%20-232%2C47t-190%2C128t-128%2C190t-47%2C232l0%2C257q0%2C68%2038%2C115t97%2C73q54%2C24%20124.5%2C41.5t150%2C30t163%2C20t164.5%2C11.5t154.5%2C5.5t132.5%2C1.5zm939%2C-298q0%2C39%20-24.5%2C67t-58.5%2C42q-54%2C23%20-122%2C39.5t-143.5%2C28t-155.5%2C19t-157%2C11t-148.5%2C5t-129.5%2C1.5q-59%2C0%20-130%2C-1.5t-148%2C-5t-157%2C-11t-155.5%2C-19t-143.5%2C-28t-122%2C-39.5q-34%2C-14%20-58.5%2C-42t-24.5%2C-67l0%2C-257q0%2C-106%2040.5%2C-199t110%2C-162.5t162.5%2C-109.5t199%2C-40l81%2C0q27%2C0%2052%2C14t50%2C34.5t51%2C44.5t55.5%2C44.5t63.5%2C34.5t74%2C14t74%2C-14t63.5%2C-34.5t55.5%2C-44.5t51%2C-44.5t50%2C-34.5t52%2C-14l14%2C0q37%2C0%2070%2C0.5t64.5%2C4.5t63.5%2C12t68%2C23q71%2C30%20128.5%2C78.5t98.5%2C110t63.5%2C133.5t22.5%2C149l0%2C257z%22%20fill%3D%22white%22%20/%3E%3C/svg%3E%0A")+"); background-size: 80%; background-repeat:no-repeat; background-position: center; border: none; outline: none; transition: transform 0.125s ease-out } .babylonVRicon:hover { transform: scale(1.05) } .babylonVRicon:active {background-color: rgba(51,51,51,1) } .babylonVRicon:focus {background-color: rgba(51,51,51,1) }";r+='.babylonVRicon.vrdisplaypresenting { background-image: none;} .vrdisplaypresenting::after { content: "EXIT"} .xr-error::after { content: "ERROR"}';const s=document.createElement("style");s.appendChild(document.createTextNode(r)),document.getElementsByTagName("head")[0].appendChild(s);const n=document.createElement("button");n.className="babylonVRicon",n.title=`${e} - ${i}`,this._buttons.push(new Da(n,e,i)),this._buttons[this._buttons.length-1].update=function(e){this.element.style.display=null===e||e===this?"":"none",n.className="babylonVRicon"+(e===this?" vrdisplaypresenting":"")},this._updateButtons(null)}const i=e.getEngine().getInputElement();i&&i.parentNode&&(i.parentNode.appendChild(this.overlay),e.onDisposeObservable.addOnce((()=>{this.dispose()})))}async setHelperAsync(e,t){this._helper=e,this._renderTarget=t;const i=this._buttons.map((t=>e.sessionManager.isSessionSupportedAsync(t.sessionMode)));e.onStateChangedObservable.add((e=>{3==e&&this._updateButtons(null)}));(await Promise.all(i)).forEach(((e,t)=>{e?(this.overlay.appendChild(this._buttons[t].element),this._buttons[t].element.onclick=this._enterXRWithButtonIndex.bind(this,t)):_.S0.Warn(`Session mode "${this._buttons[t].sessionMode}" not supported in browser`)}))}static async CreateAsync(e,t,i){const r=new wa(e,i);return await r.setHelperAsync(t,i.renderTarget||void 0),r}async _enterXRWithButtonIndex(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(2==this._helper.state)await this._helper.exitXRAsync(),this._updateButtons(null);else if(3==this._helper.state)try{await this._helper.enterXRAsync(this._buttons[e].sessionMode,this._buttons[e].referenceSpaceType,this._renderTarget,{optionalFeatures:this.options.optionalFeatures,requiredFeatures:this.options.requiredFeatures}),this._updateButtons(this._buttons[e])}catch(Qp){this._updateButtons(null);const i=this._buttons[e].element,r=i.title;i.title="Error entering XR session : "+r,i.classList.add("xr-error"),this.options.onError&&this.options.onError(Qp)}}dispose(){const e=this._scene.getEngine().getInputElement();e&&e.parentNode&&e.parentNode.contains(this.overlay)&&e.parentNode.removeChild(this.overlay),this.activeButtonChangedObservable.clear(),navigator.xr.removeEventListener("sessiongranted",this._onSessionGranted)}_updateButtons(e){this._activeButton=e,this._buttons.forEach((e=>{e.update(this._activeButton)})),this.activeButtonChangedObservable.notifyObservers(this._activeButton)}}class Fa{constructor(e,t){this.type=e,this.jointData=t,t.nativeParams=t.nativeParams||{}}get physicsJoint(){return this._physicsJoint}set physicsJoint(e){this._physicsJoint=e}set physicsPlugin(e){this._physicsPlugin=e}executeNativeFunction(e){e(this._physicsPlugin.world,this._physicsJoint)}}Fa.DistanceJoint=0,Fa.HingeJoint=1,Fa.BallAndSocketJoint=2,Fa.WheelJoint=3,Fa.SliderJoint=4,Fa.PrismaticJoint=5,Fa.UniversalJoint=6,Fa.Hinge2Joint=Fa.WheelJoint,Fa.PointToPointJoint=8,Fa.SpringJoint=9,Fa.LockJoint=10;Xe._PhysicsImpostorParser=function(e,t,i){return new La(t,i.physicsImpostor,{mass:i.physicsMass,friction:i.physicsFriction,restitution:i.physicsRestitution},e)};class La{get isDisposed(){return this._isDisposed}get mass(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyMass(this):0}set mass(e){this.setMass(e)}get friction(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyFriction(this):0}set friction(e){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyFriction(this,e)}get restitution(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyRestitution(this):0}set restitution(e){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyRestitution(this,e)}get pressure(){if(!this._physicsEngine)return 0;const e=this._physicsEngine.getPhysicsPlugin();return e.setBodyPressure?e.getBodyPressure(this):0}set pressure(e){if(!this._physicsEngine)return;const t=this._physicsEngine.getPhysicsPlugin();t.setBodyPressure&&t.setBodyPressure(this,e)}get stiffness(){if(!this._physicsEngine)return 0;const e=this._physicsEngine.getPhysicsPlugin();return e.getBodyStiffness?e.getBodyStiffness(this):0}set stiffness(e){if(!this._physicsEngine)return;const t=this._physicsEngine.getPhysicsPlugin();t.setBodyStiffness&&t.setBodyStiffness(this,e)}get velocityIterations(){if(!this._physicsEngine)return 0;const e=this._physicsEngine.getPhysicsPlugin();return e.getBodyVelocityIterations?e.getBodyVelocityIterations(this):0}set velocityIterations(e){if(!this._physicsEngine)return;const t=this._physicsEngine.getPhysicsPlugin();t.setBodyVelocityIterations&&t.setBodyVelocityIterations(this,e)}get positionIterations(){if(!this._physicsEngine)return 0;const e=this._physicsEngine.getPhysicsPlugin();return e.getBodyPositionIterations?e.getBodyPositionIterations(this):0}set positionIterations(e){if(!this._physicsEngine)return;const t=this._physicsEngine.getPhysicsPlugin();t.setBodyPositionIterations&&t.setBodyPositionIterations(this,e)}constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{mass:0},r=arguments.length>3?arguments[3]:void 0;this.object=e,this.type=t,this._options=i,this._scene=r,this._pluginData={},this._bodyUpdateRequired=!1,this._onBeforePhysicsStepCallbacks=new Array,this._onAfterPhysicsStepCallbacks=new Array,this._onPhysicsCollideCallbacks=[],this._deltaPosition=o.Pq.Zero(),this._isDisposed=!1,this.soft=!1,this.segments=0,this._tmpQuat=new o.PT,this._tmpQuat2=new o.PT,this.beforeStep=()=>{this._physicsEngine&&(this.object.translate(this._deltaPosition,-1),this._deltaRotationConjugated&&this.object.rotationQuaternion&&this.object.rotationQuaternion.multiplyToRef(this._deltaRotationConjugated,this.object.rotationQuaternion),this.object.computeWorldMatrix(!1),this.object.parent&&this.object.rotationQuaternion?(this.getParentsRotation(),this._tmpQuat.multiplyToRef(this.object.rotationQuaternion,this._tmpQuat)):this._tmpQuat.copyFrom(this.object.rotationQuaternion||new o.PT),this._options.disableBidirectionalTransformation||this.object.rotationQuaternion&&this._physicsEngine.getPhysicsPlugin().setPhysicsBodyTransformation(this,this.object.getAbsolutePosition(),this._tmpQuat),this._onBeforePhysicsStepCallbacks.forEach((e=>{e(this)})))},this.afterStep=()=>{this._physicsEngine&&(this._onAfterPhysicsStepCallbacks.forEach((e=>{e(this)})),this._physicsEngine.getPhysicsPlugin().setTransformationFromPhysicsBody(this),this.object.parent&&this.object.rotationQuaternion&&(this.getParentsRotation(),this._tmpQuat.conjugateInPlace(),this._tmpQuat.multiplyToRef(this.object.rotationQuaternion,this.object.rotationQuaternion)),this.object.setAbsolutePosition(this.object.position),this._deltaRotation?(this.object.rotationQuaternion&&this.object.rotationQuaternion.multiplyToRef(this._deltaRotation,this.object.rotationQuaternion),this._deltaPosition.applyRotationQuaternionToRef(this._deltaRotation,La._TmpVecs[0]),this.object.translate(La._TmpVecs[0],1)):this.object.translate(this._deltaPosition,1),this.object.computeWorldMatrix(!0))},this.onCollideEvent=null,this.onCollide=e=>{if(!this._onPhysicsCollideCallbacks.length&&!this.onCollideEvent)return;if(!this._physicsEngine)return;const t=this._physicsEngine.getImpostorWithPhysicsBody(e.body);t&&(this.onCollideEvent&&this.onCollideEvent(this,t),this._onPhysicsCollideCallbacks.filter((e=>-1!==e.otherImpostors.indexOf(t))).forEach((i=>{i.callback(this,t,e.point,e.distance,e.impulse,e.normal)})))},this.object?(this.object.parent&&0!==i.mass&&T.V.Warn("A physics impostor has been created for an object which has a parent. Babylon physics currently works in local space so unexpected issues may occur."),!this._scene&&e.getScene&&(this._scene=e.getScene()),this._scene&&(this.type>100&&(this.soft=!0),this._physicsEngine=this._scene.getPhysicsEngine(),this._physicsEngine?(this.object.rotationQuaternion||(this.object.rotation?this.object.rotationQuaternion=o.PT.RotationYawPitchRoll(this.object.rotation.y,this.object.rotation.x,this.object.rotation.z):this.object.rotationQuaternion=new o.PT),this._options.mass=void 0===i.mass?0:i.mass,this._options.friction=void 0===i.friction?.2:i.friction,this._options.restitution=void 0===i.restitution?.2:i.restitution,this.soft&&(this._options.mass=this._options.mass>0?this._options.mass:1,this._options.pressure=void 0===i.pressure?200:i.pressure,this._options.stiffness=void 0===i.stiffness?1:i.stiffness,this._options.velocityIterations=void 0===i.velocityIterations?20:i.velocityIterations,this._options.positionIterations=void 0===i.positionIterations?20:i.positionIterations,this._options.fixedPoints=void 0===i.fixedPoints?0:i.fixedPoints,this._options.margin=void 0===i.margin?0:i.margin,this._options.damping=void 0===i.damping?0:i.damping,this._options.path=void 0===i.path?null:i.path,this._options.shape=void 0===i.shape?null:i.shape),this._joints=[],!this.object.parent||this._options.ignoreParent?this._init():this.object.parent.physicsImpostor&&T.V.Warn("You must affect impostors to children before affecting impostor to parent.")):T.V.Error("Physics not enabled. Please use scene.enablePhysics(...) before creating impostors."))):T.V.Error("No object was provided. A physics object is obligatory")}_init(){this._physicsEngine&&(this._physicsEngine.removeImpostor(this),this.physicsBody=null,this._parent=this._parent||this._getPhysicsParent(),this._isDisposed||this.parent&&!this._options.ignoreParent||this._physicsEngine.addImpostor(this))}_getPhysicsParent(){if(this.object.parent instanceof re){return this.object.parent.physicsImpostor}return null}isBodyInitRequired(){return this._bodyUpdateRequired||!this._physicsBody&&(!this._parent||!!this._options.ignoreParent)}setScalingUpdated(){this.forceUpdate()}forceUpdate(){this._init(),this.parent&&!this._options.ignoreParent&&this.parent.forceUpdate()}get physicsBody(){return this._parent&&!this._options.ignoreParent?this._parent.physicsBody:this._physicsBody}get parent(){return!this._options.ignoreParent&&this._parent?this._parent:null}set parent(e){this._parent=e}set physicsBody(e){this._physicsBody&&this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().removePhysicsBody(this),this._physicsBody=e,this.resetUpdateFlags()}resetUpdateFlags(){this._bodyUpdateRequired=!1}getObjectExtents(){if(this.object.getBoundingInfo){const e=this.object.rotationQuaternion,t=this.object.scaling.clone();this.object.rotationQuaternion=La.IDENTITY_QUATERNION;const i=this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0);i&&i.decompose(t,void 0,void 0);const r=this.object.getBoundingInfo().boundingBox.extendSize.scale(2).multiplyInPlace(t);return r.x=Math.abs(r.x),r.y=Math.abs(r.y),r.z=Math.abs(r.z),this.object.rotationQuaternion=e,this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0),r}return La.DEFAULT_OBJECT_SIZE}getObjectCenter(){if(this.object.getBoundingInfo){return this.object.getBoundingInfo().boundingBox.centerWorld}return this.object.position}getParam(e){return this._options[e]}setParam(e,t){this._options[e]=t,this._bodyUpdateRequired=!0}setMass(e){this.getParam("mass")!==e&&this.setParam("mass",e),this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyMass(this,e)}getLinearVelocity(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getLinearVelocity(this):o.Pq.Zero()}setLinearVelocity(e){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setLinearVelocity(this,e)}getAngularVelocity(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getAngularVelocity(this):o.Pq.Zero()}setAngularVelocity(e){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setAngularVelocity(this,e)}executeNativeFunction(e){this._physicsEngine&&e(this._physicsEngine.getPhysicsPlugin().world,this.physicsBody)}registerBeforePhysicsStep(e){this._onBeforePhysicsStepCallbacks.push(e)}unregisterBeforePhysicsStep(e){const t=this._onBeforePhysicsStepCallbacks.indexOf(e);t>-1?this._onBeforePhysicsStepCallbacks.splice(t,1):T.V.Warn("Function to remove was not found")}registerAfterPhysicsStep(e){this._onAfterPhysicsStepCallbacks.push(e)}unregisterAfterPhysicsStep(e){const t=this._onAfterPhysicsStepCallbacks.indexOf(e);t>-1?this._onAfterPhysicsStepCallbacks.splice(t,1):T.V.Warn("Function to remove was not found")}registerOnPhysicsCollide(e,t){const i=e instanceof Array?e:[e];this._onPhysicsCollideCallbacks.push({callback:t,otherImpostors:i})}unregisterOnPhysicsCollide(e,t){const i=e instanceof Array?e:[e];let r=-1;this._onPhysicsCollideCallbacks.some(((e,s)=>{if(e.callback===t&&e.otherImpostors.length===i.length){const t=e.otherImpostors.every((e=>i.indexOf(e)>-1));return t&&(r=s),t}return!1}))?this._onPhysicsCollideCallbacks.splice(r,1):T.V.Warn("Function to remove was not found")}getParentsRotation(){let e=this.object.parent;for(this._tmpQuat.copyFromFloats(0,0,0,1);e;)e.rotationQuaternion?this._tmpQuat2.copyFrom(e.rotationQuaternion):o.PT.RotationYawPitchRollToRef(e.rotation.y,e.rotation.x,e.rotation.z,this._tmpQuat2),this._tmpQuat.multiplyToRef(this._tmpQuat2,this._tmpQuat),e=e.parent;return this._tmpQuat}applyForce(e,t){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().applyForce(this,e,t),this}applyImpulse(e,t){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().applyImpulse(this,e,t),this}createJoint(e,t,i){const r=new Fa(t,i);return this.addJoint(e,r),this}addJoint(e,t){return this._joints.push({otherImpostor:e,joint:t}),this._physicsEngine&&this._physicsEngine.addJoint(this,e,t),this}addAnchor(e,t,i,r,s){if(!this._physicsEngine)return this;const n=this._physicsEngine.getPhysicsPlugin();return n.appendAnchor?(this._physicsEngine&&n.appendAnchor(this,e,t,i,r,s),this):this}addHook(e,t,i,r){if(!this._physicsEngine)return this;const s=this._physicsEngine.getPhysicsPlugin();return s.appendAnchor?(this._physicsEngine&&s.appendHook(this,e,t,i,r),this):this}sleep(){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().sleepBody(this),this}wakeUp(){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().wakeUpBody(this),this}clone(e){return e?new La(e,this.type,this._options,this._scene):null}dispose(){this._physicsEngine&&(this._joints.forEach((e=>{this._physicsEngine&&this._physicsEngine.removeJoint(this,e.otherImpostor,e.joint)})),this._physicsEngine.removeImpostor(this),this.parent&&this.parent.forceUpdate(),this._isDisposed=!0)}setDeltaPosition(e){this._deltaPosition.copyFrom(e)}setDeltaRotation(e){this._deltaRotation||(this._deltaRotation=new o.PT),this._deltaRotation.copyFrom(e),this._deltaRotationConjugated=this._deltaRotation.conjugate()}getBoxSizeToRef(e){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().getBoxSizeToRef(this,e),this}getRadius(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getRadius(this):0}syncBoneWithImpostor(e,t,i,r,s){const n=La._TmpVecs[0],a=this.object;if(a.rotationQuaternion)if(s){const i=La._TmpQuat;a.rotationQuaternion.multiplyToRef(s,i),e.setRotationQuaternion(i,1,t)}else e.setRotationQuaternion(a.rotationQuaternion,1,t);n.x=0,n.y=0,n.z=0,i&&(n.x=i.x,n.y=i.y,n.z=i.z,e.getDirectionToRef(n,t,n),void 0!==r&&null!==r||(r=i.length()),n.x*=r,n.y*=r,n.z*=r),e.getParent()?(n.addInPlace(a.getAbsolutePosition()),e.setAbsolutePosition(n,t)):(t.setAbsolutePosition(a.getAbsolutePosition()),t.position.x-=n.x,t.position.y-=n.y,t.position.z-=n.z)}syncImpostorWithBone(e,t,i,r,s,n){const a=this.object;if(a.rotationQuaternion)if(s){const i=La._TmpQuat;e.getRotationQuaternionToRef(1,t,i),i.multiplyToRef(s,a.rotationQuaternion)}else e.getRotationQuaternionToRef(1,t,a.rotationQuaternion);const o=La._TmpVecs[0],l=La._TmpVecs[1];n||((n=La._TmpVecs[2]).x=0,n.y=1,n.z=0),e.getDirectionToRef(n,t,l),e.getAbsolutePositionToRef(t,o),void 0!==r&&null!==r||!i||(r=i.length()),void 0!==r&&null!==r&&(o.x+=l.x*r,o.y+=l.y*r,o.z+=l.z*r),a.setAbsolutePosition(o)}}La.DEFAULT_OBJECT_SIZE=new o.Pq(1,1,1),La.IDENTITY_QUATERNION=o.PT.Identity(),La._TmpVecs=(0,I.mI)(3,o.Pq.Zero),La._TmpQuat=o.PT.Identity(),La.NoImpostor=0,La.SphereImpostor=1,La.BoxImpostor=2,La.PlaneImpostor=3,La.MeshImpostor=4,La.CapsuleImpostor=6,La.CylinderImpostor=7,La.ParticleImpostor=8,La.HeightmapImpostor=9,La.ConvexHullImpostor=10,La.CustomImpostor=100,La.RopeImpostor=101,La.ClothImpostor=102,La.SoftbodyImpostor=103,function(e){e.WRIST="wrist",e.THUMB="thumb",e.INDEX="index",e.MIDDLE="middle",e.RING="ring",e.LITTLE="little"}(Pa||(Pa={})),function(e){e.WRIST="wrist",e.THUMB_METACARPAL="thumb-metacarpal",e.THUMB_PHALANX_PROXIMAL="thumb-phalanx-proximal",e.THUMB_PHALANX_DISTAL="thumb-phalanx-distal",e.THUMB_TIP="thumb-tip",e.INDEX_FINGER_METACARPAL="index-finger-metacarpal",e.INDEX_FINGER_PHALANX_PROXIMAL="index-finger-phalanx-proximal",e.INDEX_FINGER_PHALANX_INTERMEDIATE="index-finger-phalanx-intermediate",e.INDEX_FINGER_PHALANX_DISTAL="index-finger-phalanx-distal",e.INDEX_FINGER_TIP="index-finger-tip",e.MIDDLE_FINGER_METACARPAL="middle-finger-metacarpal",e.MIDDLE_FINGER_PHALANX_PROXIMAL="middle-finger-phalanx-proximal",e.MIDDLE_FINGER_PHALANX_INTERMEDIATE="middle-finger-phalanx-intermediate",e.MIDDLE_FINGER_PHALANX_DISTAL="middle-finger-phalanx-distal",e.MIDDLE_FINGER_TIP="middle-finger-tip",e.RING_FINGER_METACARPAL="ring-finger-metacarpal",e.RING_FINGER_PHALANX_PROXIMAL="ring-finger-phalanx-proximal",e.RING_FINGER_PHALANX_INTERMEDIATE="ring-finger-phalanx-intermediate",e.RING_FINGER_PHALANX_DISTAL="ring-finger-phalanx-distal",e.RING_FINGER_TIP="ring-finger-tip",e.PINKY_FINGER_METACARPAL="pinky-finger-metacarpal",e.PINKY_FINGER_PHALANX_PROXIMAL="pinky-finger-phalanx-proximal",e.PINKY_FINGER_PHALANX_INTERMEDIATE="pinky-finger-phalanx-intermediate",e.PINKY_FINGER_PHALANX_DISTAL="pinky-finger-phalanx-distal",e.PINKY_FINGER_TIP="pinky-finger-tip"}(Ia||(Ia={}));const Ba=["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"],Na={wrist:["wrist"],thumb:["thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip"],index:["index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip"],middle:["middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip"],ring:["ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip"],little:["pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"]};class ka{get handMesh(){return this._handMesh}getHandPartMeshes(e){return Na[e].map((e=>this._jointMeshes[Ba.indexOf(e)]))}getJointMesh(e){return this._jointMeshes[Ba.indexOf(e)]}constructor(e,t,i,r){let s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],n=arguments.length>5&&void 0!==arguments[5]&&arguments[5],l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;this.xrController=e,this._jointMeshes=t,this._handMesh=i,this.rigMapping=r,this._leftHandedMeshes=s,this._jointsInvisible=n,this._jointScaleFactor=l,this.onHandMeshSetObservable=new a.cP,this._jointTransforms=new Array(Ba.length),this._jointTransformMatrices=new Float32Array(16*Ba.length),this._tempJointMatrix=new o.uq,this._jointRadii=new Float32Array(Ba.length),this._scene=t[0].getScene();for(let a=0;a<this._jointTransforms.length;a++){(this._jointTransforms[a]=new j(Ba[a],this._scene)).rotationQuaternion=new o.PT,t[a].rotationQuaternion=new o.PT}i&&this.setHandMesh(i,r),this.xrController.motionController&&this.xrController.motionController.rootMesh&&this.xrController.motionController.rootMesh.dispose(!1,!0),this.xrController.onMotionControllerInitObservable.add((e=>{e._doNotLoadControllerMesh=!0}))}setHandMesh(e,t,i){if(this._handMesh=e,e.alwaysSelectAsActiveMesh=!0,e.getChildMeshes().forEach((e=>{e.alwaysSelectAsActiveMesh=!0})),this._handMesh.skeleton){const e=this._handMesh.skeleton;Ba.forEach(((i,r)=>{const s=e.getBoneIndexByName(t?t[i]:i);-1!==s&&e.bones[s].linkTransformNode(this._jointTransforms[r])}))}this.onHandMeshSetObservable.notifyObservers(this)}updateFromXRFrame(e,t){const i=this.xrController.inputSource.hand;if(!i)return;const r=i,s=Ba.map((e=>r[e]||i.get(e)));let n=!1;if(e.fillPoses&&e.fillJointRadii)n=e.fillPoses(s,t,this._jointTransformMatrices)&&e.fillJointRadii(s,this._jointRadii);else if(e.getJointPose){n=!0;for(let i=0;i<s.length;i++){const r=e.getJointPose(s[i],t);if(!r){n=!1;break}this._jointTransformMatrices.set(r.transform.matrix,16*i),this._jointRadii[i]=r.radius||.008}}n&&(Ba.forEach(((e,t)=>{const i=this._jointTransforms[t];o.uq.FromArrayToRef(this._jointTransformMatrices,16*t,this._tempJointMatrix),this._tempJointMatrix.decompose(void 0,i.rotationQuaternion,i.position);const r=this._jointRadii[t]*this._jointScaleFactor,s=this._jointMeshes[t];s.isVisible=!this._handMesh&&!this._jointsInvisible,s.position.copyFrom(i.position),s.rotationQuaternion.copyFrom(i.rotationQuaternion),s.scaling.setAll(r),this._scene.useRightHandedSystem||(s.position.z*=-1,s.rotationQuaternion.z*=-1,s.rotationQuaternion.w*=-1,this._leftHandedMeshes&&this._handMesh&&(i.position.z*=-1,i.rotationQuaternion.z*=-1,i.rotationQuaternion.w*=-1))})),this._handMesh&&(this._handMesh.isVisible=!0))}dispose(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._handMesh&&(e?(this._handMesh.skeleton?.dispose(),this._handMesh.dispose(!1,!0)):this._handMesh.isVisible=!1)}}class Ua extends Ln{static _GenerateTrackedJointMeshes(e){const t={};return["left","right"].map((i=>{const r=[],s=e.jointMeshes?.sourceMesh||yr("jointParent",Ua._ICOSPHERE_PARAMS);s.isVisible=!!e.jointMeshes?.keepOriginalVisible;for(let t=0;t<Ba.length;++t){let n=s.createInstance(`${i}-handJoint-${t}`);if(e.jointMeshes?.onHandJointMeshGenerated){const r=e.jointMeshes.onHandJointMeshGenerated(n,t,i);r&&r!==n&&(n.dispose(),n=r)}if(n.isPickable=!1,e.jointMeshes?.enablePhysics){const t=e.jointMeshes?.physicsProps||{};n.scaling.setAll(.02);const i=void 0!==t.impostorType?t.impostorType:La.SphereImpostor;n.physicsImpostor=new La(n,i,{mass:0,...t})}n.rotationQuaternion=new o.PT,n.isVisible=!1,r.push(n)}t[i]=r})),{left:t.left,right:t.right}}static _GenerateDefaultHandMeshesAsync(e,t,i){return new Promise((async r=>{const s={};Ua._RightHandGLB?.meshes[1]?.isDisposed()&&(Ua._RightHandGLB=null),Ua._LeftHandGLB?.meshes[1]?.isDisposed()&&(Ua._LeftHandGLB=null);const n=!(!Ua._RightHandGLB||!Ua._LeftHandGLB),a=await Promise.all([Ua._RightHandGLB||Rn.ImportMeshAsync("",Ua.DEFAULT_HAND_MODEL_BASE_URL,Ua.DEFAULT_HAND_MODEL_RIGHT_FILENAME,e),Ua._LeftHandGLB||Rn.ImportMeshAsync("",Ua.DEFAULT_HAND_MODEL_BASE_URL,Ua.DEFAULT_HAND_MODEL_LEFT_FILENAME,e)]);Ua._RightHandGLB=a[0],Ua._LeftHandGLB=a[1];const o=await Ea.ParseFromFileAsync("handShader",Ua.DEFAULT_HAND_MODEL_SHADER_URL,e);o.needDepthPrePass=!0,o.transparencyMode=Ne.MATERIAL_ALPHABLEND,o.alphaMode=2,o.build(!1);const l={base:E.v9.FromInts(116,63,203),fresnel:E.v9.FromInts(149,102,229),fingerColor:E.v9.FromInts(177,130,255),tipFresnel:E.v9.FromInts(220,200,255),...i?.handMeshes?.customColors},h={base:o.getBlockByName("baseColor"),fresnel:o.getBlockByName("fresnelColor"),fingerColor:o.getBlockByName("fingerColor"),tipFresnel:o.getBlockByName("tipFresnelColor")};h.base.value=l.base,h.fresnel.value=l.fresnel,h.fingerColor.value=l.fingerColor,h.tipFresnel.value=l.tipFresnel;const c=t._getBaseLayerWrapper()?.isMultiview;["left","right"].forEach((t=>{const i="left"==t?Ua._LeftHandGLB:Ua._RightHandGLB;if(!i)throw new Error("Could not load hand model");const r=i.meshes[1];r._internalAbstractMeshDataInfo._computeBonesUsingShaders=!0,c||(r.material=o.clone(`${t}HandShaderClone`,!0)),r.isVisible=!1,s[t]=r,n||e.useRightHandedSystem||i.meshes[1].rotate(J._0.Y,Math.PI)})),o.dispose(),r({left:s.left,right:s.right})}))}static _GenerateDefaultHandMeshRigMapping(e){const t="right"==e?"R":"L";return{wrist:`wrist_${t}`,"thumb-metacarpal":`thumb_metacarpal_${t}`,"thumb-phalanx-proximal":`thumb_proxPhalanx_${t}`,"thumb-phalanx-distal":`thumb_distPhalanx_${t}`,"thumb-tip":`thumb_tip_${t}`,"index-finger-metacarpal":`index_metacarpal_${t}`,"index-finger-phalanx-proximal":`index_proxPhalanx_${t}`,"index-finger-phalanx-intermediate":`index_intPhalanx_${t}`,"index-finger-phalanx-distal":`index_distPhalanx_${t}`,"index-finger-tip":`index_tip_${t}`,"middle-finger-metacarpal":`middle_metacarpal_${t}`,"middle-finger-phalanx-proximal":`middle_proxPhalanx_${t}`,"middle-finger-phalanx-intermediate":`middle_intPhalanx_${t}`,"middle-finger-phalanx-distal":`middle_distPhalanx_${t}`,"middle-finger-tip":`middle_tip_${t}`,"ring-finger-metacarpal":`ring_metacarpal_${t}`,"ring-finger-phalanx-proximal":`ring_proxPhalanx_${t}`,"ring-finger-phalanx-intermediate":`ring_intPhalanx_${t}`,"ring-finger-phalanx-distal":`ring_distPhalanx_${t}`,"ring-finger-tip":`ring_tip_${t}`,"pinky-finger-metacarpal":`little_metacarpal_${t}`,"pinky-finger-phalanx-proximal":`little_proxPhalanx_${t}`,"pinky-finger-phalanx-intermediate":`little_intPhalanx_${t}`,"pinky-finger-phalanx-distal":`little_distPhalanx_${t}`,"pinky-finger-tip":`little_tip_${t}`}}isCompatible(){return"undefined"!==typeof XRHand}getHandByControllerId(e){return this._attachedHands[e]}getHandByHandedness(e){return"none"==e?null:this._trackingHands[e]}constructor(e,t){super(e),this.options=t,this._attachedHands={},this._trackingHands={left:null,right:null},this._handResources={jointMeshes:null,handMeshes:null,rigMappings:null},this._worldScaleObserver=null,this.onHandAddedObservable=new a.cP,this.onHandRemovedObservable=new a.cP,this._attachHand=e=>{if(!e.inputSource.hand||"none"==e.inputSource.handedness||!this._handResources.jointMeshes)return;const t=e.inputSource.handedness,i=new ka(e,this._handResources.jointMeshes[t],this._handResources.handMeshes&&this._handResources.handMeshes[t],this._handResources.rigMappings&&this._handResources.rigMappings[t],this.options.handMeshes?.meshesUseLeftHandedCoordinates,this.options.jointMeshes?.invisible,this.options.jointMeshes?.scaleFactor);this._attachedHands[e.uniqueId]=i,this._trackingHands[t]=i,this.onHandAddedObservable.notifyObservers(i)},this._detachHand=e=>{this._detachHandById(e.uniqueId)},this.xrNativeFeatureName="hand-tracking";const i=t.jointMeshes;if(i&&("undefined"!==typeof i.disableDefaultHandMesh&&(t.handMeshes=t.handMeshes||{},t.handMeshes.disableDefaultMeshes=i.disableDefaultHandMesh),"undefined"!==typeof i.handMeshes&&(t.handMeshes=t.handMeshes||{},t.handMeshes.customMeshes=i.handMeshes),"undefined"!==typeof i.leftHandedSystemMeshes&&(t.handMeshes=t.handMeshes||{},t.handMeshes.meshesUseLeftHandedCoordinates=i.leftHandedSystemMeshes),"undefined"!==typeof i.rigMapping)){t.handMeshes=t.handMeshes||{};const e={},r={};[[i.rigMapping.left,e],[i.rigMapping.right,r]].forEach((e=>{const t=e[0],i=e[1];t.forEach(((e,t)=>{i[Ba[t]]=e}))})),t.handMeshes.customRigMappings={left:e,right:r}}}attach(){return!!super.attach()&&(this._handResources={jointMeshes:Ua._GenerateTrackedJointMeshes(this.options),handMeshes:this.options.handMeshes?.customMeshes||null,rigMappings:this.options.handMeshes?.customRigMappings||null},this.options.handMeshes?.customMeshes||this.options.handMeshes?.disableDefaultMeshes||(Ua._GenerateDefaultHandMeshesAsync(l.q.LastCreatedScene,this._xrSessionManager,this.options).then((e=>{this._handResources.handMeshes=e,this._handResources.rigMappings={left:Ua._GenerateDefaultHandMeshRigMapping("left"),right:Ua._GenerateDefaultHandMeshRigMapping("right")},this._trackingHands.left?.setHandMesh(this._handResources.handMeshes.left,this._handResources.rigMappings.left,this._xrSessionManager),this._trackingHands.right?.setHandMesh(this._handResources.handMeshes.right,this._handResources.rigMappings.right,this._xrSessionManager),this._handResources.handMeshes.left.scaling.setAll(this._xrSessionManager.worldScalingFactor),this._handResources.handMeshes.right.scaling.setAll(this._xrSessionManager.worldScalingFactor)})),this._worldScaleObserver=this._xrSessionManager.onWorldScaleFactorChangedObservable.add((e=>{this._handResources.handMeshes&&(this._handResources.handMeshes.left.scaling.scaleInPlace(e.newScaleFactor/e.previousScaleFactor),this._handResources.handMeshes.right.scaling.scaleInPlace(e.newScaleFactor/e.previousScaleFactor))}))),this.options.xrInput.controllers.forEach(this._attachHand),this._addNewAttachObserver(this.options.xrInput.onControllerAddedObservable,this._attachHand),this._addNewAttachObserver(this.options.xrInput.onControllerRemovedObservable,this._detachHand),!0)}_onXRFrame(e){this._trackingHands.left?.updateFromXRFrame(e,this._xrSessionManager.referenceSpace),this._trackingHands.right?.updateFromXRFrame(e,this._xrSessionManager.referenceSpace)}_detachHandById(e,t){const i=this.getHandByControllerId(e);if(i){const r="left"==i.xrController.inputSource.handedness?"left":"right";this._trackingHands[r]?.xrController.uniqueId===e&&(this._trackingHands[r]=null),this.onHandRemovedObservable.notifyObservers(i),i.dispose(t),delete this._attachedHands[e]}}detach(){return!!super.detach()&&(Object.keys(this._attachedHands).forEach((e=>this._detachHandById(e,this.options.handMeshes?.disposeOnSessionEnd))),this.options.handMeshes?.disposeOnSessionEnd&&this._handResources.jointMeshes&&(this._handResources.jointMeshes.left.forEach((e=>e.dispose())),this._handResources.jointMeshes.right.forEach((e=>e.dispose()))),this._worldScaleObserver&&this._xrSessionManager.onWorldScaleFactorChangedObservable.remove(this._worldScaleObserver),!0)}dispose(){super.dispose(),this.onHandAddedObservable.clear(),this.onHandRemovedObservable.clear(),this._handResources.handMeshes&&!this.options.handMeshes?.customMeshes&&(this._handResources.handMeshes.left.dispose(),this._handResources.handMeshes.right.dispose(),Ua._RightHandGLB=null,Ua._LeftHandGLB=null),this._handResources.jointMeshes&&(this._handResources.jointMeshes.left.forEach((e=>e.dispose())),this._handResources.jointMeshes.right.forEach((e=>e.dispose())))}}var Va;function za(e){let t=0;const i=Date.now();e.observableParameters=e.observableParameters??{};const r=e.contextObservable.add((s=>{const n=Date.now();t=n-i;const a={startTime:i,currentTime:n,deltaTime:t,completeRate:t/e.timeout,payload:s};e.onTick&&e.onTick(a),e.breakCondition&&e.breakCondition()&&(e.contextObservable.remove(r),e.onAborted&&e.onAborted(a)),t>=e.timeout&&(e.contextObservable.remove(r),e.onEnded&&e.onEnded(a))}),e.observableParameters.mask,e.observableParameters.insertFirst,e.observableParameters.scope);return r}Ua.Name=Zs.HAND_TRACKING,Ua.Version=1,Ua.DEFAULT_HAND_MODEL_BASE_URL="https://assets.babylonjs.com/meshes/HandMeshes/",Ua.DEFAULT_HAND_MODEL_RIGHT_FILENAME="r_hand_rhs.glb",Ua.DEFAULT_HAND_MODEL_LEFT_FILENAME="l_hand_rhs.glb",Ua.DEFAULT_HAND_MODEL_SHADER_URL="https://assets.babylonjs.com/meshes/HandMeshes/handsShader.json",Ua._ICOSPHERE_PARAMS={radius:.5,flat:!1,subdivisions:2},Ua._RightHandGLB=null,Ua._LeftHandGLB=null,Js.AddWebXRFeature(Ua.Name,((e,t)=>()=>new Ua(e,t)),Ua.Version,!1),function(e){e[e.INIT=0]="INIT",e[e.STARTED=1]="STARTED",e[e.ENDED=2]="ENDED"}(Va||(Va={}));class Ga extends Ln{get rotationEnabled(){return this._rotationEnabled}set rotationEnabled(e){if(this._rotationEnabled=e,this._options.teleportationTargetMesh){const t=this._options.teleportationTargetMesh.getChildMeshes(!1,(e=>"rotationCone"===e.name));t[0]&&t[0].setEnabled(e)}}get teleportationTargetMesh(){return this._options.teleportationTargetMesh||null}constructor(e,t){super(e),this._options=t,this._controllers={},this._snappedToPoint=!1,this._cachedColor4White=new E.ov(1,1,1,1),this._tmpRay=new xs(new o.Pq,new o.Pq),this._tmpVector=new o.Pq,this._tmpQuaternion=new o.PT,this._worldScaleObserver=null,this.skipNextTeleportation=!1,this.backwardsMovementEnabled=!0,this.backwardsTeleportationDistance=.7,this.parabolicCheckRadius=5,this.parabolicRayEnabled=!0,this.straightRayEnabled=!0,this.rotationAngle=Math.PI/8,this.onTargetMeshPositionUpdatedObservable=new a.cP,this.teleportationEnabled=!0,this._rotationEnabled=!0,this.onBeforeCameraTeleportRotation=new a.cP,this.onAfterCameraTeleportRotation=new a.cP,this._attachController=e=>{if(this._controllers[e.uniqueId]||this._options.forceHandedness&&e.inputSource.handedness!==this._options.forceHandedness)return;this._controllers[e.uniqueId]={xrController:e,teleportationState:{forward:!1,backwards:!1,rotating:!1,currentRotation:0,baseRotation:0,blocked:!1,initialHit:!1,mainComponentUsed:!1}};const t=this._controllers[e.uniqueId];if("tracked-pointer"===t.xrController.inputSource.targetRayMode&&t.xrController.inputSource.gamepad){const i=()=>{if(e.motionController){const i=e.motionController.getComponentOfType(sn.THUMBSTICK_TYPE)||e.motionController.getComponentOfType(sn.TOUCHPAD_TYPE);if(!i||this._options.useMainComponentOnly){const i=e.motionController.getMainComponent();if(!i)return;t.teleportationState.mainComponentUsed=!0,t.teleportationComponent=i,t.onButtonChangedObserver=i.onButtonStateChangedObservable.add((()=>{if(!this.teleportationEnabled)return;const r=()=>{t.teleportationState.forward=!0,t.teleportationState.initialHit=!1,this._currentTeleportationControllerId=t.xrController.uniqueId,t.teleportationState.baseRotation=this._options.xrInput.xrCamera.rotationQuaternion.toEulerAngles().y,t.teleportationState.currentRotation=0;za({timeout:this._options.timeToTeleport||3e3,contextObservable:this._xrSessionManager.onXRFrameObservable,breakCondition:()=>!i.pressed,onEnded:()=>{this._currentTeleportationControllerId===t.xrController.uniqueId&&t.teleportationState.forward&&this._teleportForward(e.uniqueId)}})};i.changes.pressed&&(i.changes.pressed.current?this._options.timeToTeleportStart?za({timeout:this._options.timeToTeleportStart,contextObservable:this._xrSessionManager.onXRFrameObservable,onEnded:()=>{i.pressed&&r()}}):r():(t.teleportationState.forward=!1,this._currentTeleportationControllerId=""))}))}else t.teleportationComponent=i,t.onAxisChangedObserver=i.onAxisValueChangedObservable.add((i=>{if(i.y<=.7&&t.teleportationState.backwards&&(t.teleportationState.backwards=!1),i.y>.7&&!t.teleportationState.forward&&this.backwardsMovementEnabled&&!this.snapPointsOnly&&!t.teleportationState.backwards){t.teleportationState.backwards=!0,this._tmpQuaternion.copyFrom(this._options.xrInput.xrCamera.rotationQuaternion),this._tmpQuaternion.toEulerAnglesToRef(this._tmpVector),this._tmpVector.x=0,this._tmpVector.z=0,o.PT.FromEulerVectorToRef(this._tmpVector,this._tmpQuaternion),this._tmpVector.set(0,0,this.backwardsTeleportationDistance*(this._xrSessionManager.scene.useRightHandedSystem?1:-1)),this._tmpVector.rotateByQuaternionToRef(this._tmpQuaternion,this._tmpVector),this._tmpVector.addInPlace(this._options.xrInput.xrCamera.position),this._tmpRay.origin.copyFrom(this._tmpVector),this._tmpRay.length=this._options.xrInput.xrCamera.realWorldHeight+.1,this._tmpRay.direction.set(0,-1,0);const e=this._xrSessionManager.scene.pickWithRay(this._tmpRay,(e=>-1!==this._floorMeshes.indexOf(e)));e&&e.pickedPoint&&(this._options.xrInput.xrCamera.position.x=e.pickedPoint.x,this._options.xrInput.xrCamera.position.z=e.pickedPoint.z)}if(i.y<-.7&&!this._currentTeleportationControllerId&&!t.teleportationState.rotating&&this.teleportationEnabled&&(t.teleportationState.forward=!0,this._currentTeleportationControllerId=t.xrController.uniqueId,t.teleportationState.baseRotation=this._options.xrInput.xrCamera.rotationQuaternion.toEulerAngles().y),i.x){if(t.teleportationState.forward)this._currentTeleportationControllerId===t.xrController.uniqueId&&(this.rotationEnabled?setTimeout((()=>{t.teleportationState.currentRotation=Math.atan2(i.x,i.y*(this._xrSessionManager.scene.useRightHandedSystem?1:-1))})):t.teleportationState.currentRotation=0);else if(!t.teleportationState.rotating&&Math.abs(i.x)>.7){t.teleportationState.rotating=!0;const e=this.rotationAngle*(i.x>0?1:-1)*(this._xrSessionManager.scene.useRightHandedSystem?-1:1);this.onBeforeCameraTeleportRotation.notifyObservers(e),o.PT.FromEulerAngles(0,e,0).multiplyToRef(this._options.xrInput.xrCamera.rotationQuaternion,this._options.xrInput.xrCamera.rotationQuaternion),this.onAfterCameraTeleportRotation.notifyObservers(this._options.xrInput.xrCamera.rotationQuaternion)}}else t.teleportationState.rotating=!1;0===i.x&&0===i.y&&(t.teleportationState.blocked&&(t.teleportationState.blocked=!1,this._setTargetMeshVisibility(!1)),t.teleportationState.forward&&this._teleportForward(e.uniqueId))}))}};e.motionController?i():e.onMotionControllerInitObservable.addOnce((()=>{i()}))}else{t.teleportationState.mainComponentUsed=!0;let i=!1;const r=()=>{this._currentTeleportationControllerId=t.xrController.uniqueId,t.teleportationState.forward=!0,t.teleportationState.initialHit=!1,t.teleportationState.baseRotation=this._options.xrInput.xrCamera.rotationQuaternion.toEulerAngles().y,t.teleportationState.currentRotation=0;za({timeout:this._options.timeToTeleport||3e3,contextObservable:this._xrSessionManager.onXRFrameObservable,onEnded:()=>{this._currentTeleportationControllerId===t.xrController.uniqueId&&t.teleportationState.forward&&this._teleportForward(e.uniqueId)}})};this._xrSessionManager.scene.onPointerObservable.add((e=>{e.type===Ke.Zp.POINTERDOWN?(i=!1,this._options.timeToTeleportStart?za({timeout:this._options.timeToTeleportStart,contextObservable:this._xrSessionManager.onXRFrameObservable,onEnded:()=>{this._currentTeleportationControllerId===t.xrController.uniqueId&&r()},breakCondition:()=>!!i&&(i=!1,!0)}):r()):e.type===Ke.Zp.POINTERUP&&(i=!0,t.teleportationState.forward=!1,this._currentTeleportationControllerId="")}))}},this._colorArray=Array(24).fill(this._cachedColor4White),this._options.teleportationTargetMesh||this._createDefaultTargetMesh(),this._floorMeshes=this._options.floorMeshes||[],this._snapToPositions=this._options.snapPositions||[],this._blockedRayColor=this._options.blockedRayColor||new E.ov(1,0,0,.75),this._setTargetMeshVisibility(!1),this.onBeforeCameraTeleport=t.xrInput.xrCamera.onBeforeCameraTeleport,this.onAfterCameraTeleport=t.xrInput.xrCamera.onAfterCameraTeleport,this.parabolicCheckRadius*=this._xrSessionManager.worldScalingFactor,this._worldScaleObserver=e.onWorldScaleFactorChangedObservable.add((e=>{this.parabolicCheckRadius=this.parabolicCheckRadius/e.previousScaleFactor*e.newScaleFactor,this._options.teleportationTargetMesh?.scaling.scaleInPlace(e.newScaleFactor/e.previousScaleFactor)}))}get snapPointsOnly(){return!!this._options.snapPointsOnly}set snapPointsOnly(e){this._options.snapPointsOnly=e}addFloorMesh(e){this._floorMeshes.push(e)}addBlockerMesh(e){this._options.pickBlockerMeshes=this._options.pickBlockerMeshes||[],this._options.pickBlockerMeshes.push(e)}addSnapPoint(e){this._snapToPositions.push(e)}attach(){return!!super.attach()&&(this._currentTeleportationControllerId="",this._options.xrInput.controllers.forEach(this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerAddedObservable,this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerRemovedObservable,(e=>{this._detachController(e.uniqueId)})),!0)}detach(){return!!super.detach()&&(Object.keys(this._controllers).forEach((e=>{this._detachController(e)})),this._setTargetMeshVisibility(!1),this._currentTeleportationControllerId="",this._controllers={},!0)}dispose(){super.dispose(),this._options.teleportationTargetMesh&&this._options.teleportationTargetMesh.dispose(!1,!0),this._worldScaleObserver&&this._xrSessionManager.onWorldScaleFactorChangedObservable.remove(this._worldScaleObserver)}removeFloorMesh(e){const t=this._floorMeshes.indexOf(e);-1!==t&&this._floorMeshes.splice(t,1)}removeBlockerMesh(e){this._options.pickBlockerMeshes=this._options.pickBlockerMeshes||[];const t=this._options.pickBlockerMeshes.indexOf(e);-1!==t&&this._options.pickBlockerMeshes.splice(t,1)}removeFloorMeshByName(e){const t=this._xrSessionManager.scene.getMeshByName(e);t&&this.removeFloorMesh(t)}removeSnapPoint(e){let t=this._snapToPositions.indexOf(e);if(-1===t)for(let i=0;i<this._snapToPositions.length;++i)if(this._snapToPositions[i].equals(e)){t=i;break}return-1!==t&&(this._snapToPositions.splice(t,1),!0)}setSelectionFeature(e){this._selectionFeature=e}_onXRFrame(e){const t=this._xrSessionManager.currentFrame,i=this._xrSessionManager.scene;if(!this.attach||!t)return;const r=this._options.teleportationTargetMesh;if(this._currentTeleportationControllerId){if(!r)return;r.rotationQuaternion=r.rotationQuaternion||new o.PT;const e=this._controllers[this._currentTeleportationControllerId];if(e&&e.teleportationState.forward){o.PT.RotationYawPitchRollToRef(e.teleportationState.currentRotation+e.teleportationState.baseRotation,0,0,r.rotationQuaternion);let t=!1;const s="transient-pointer"!==e.xrController.inputSource.targetRayMode;if(e.xrController.getWorldPointerRayToRef(this._tmpRay),this.straightRayEnabled){const r=i.pickWithRay(this._tmpRay,(e=>{if(this._options.blockerMeshesPredicate&&this._options.blockerMeshesPredicate(e))return!0;if(this._options.blockAllPickableMeshes&&e.isPickable)return!0;if(this._options.pickBlockerMeshes&&-1!==this._options.pickBlockerMeshes.indexOf(e))return!0;const t=this._floorMeshes.indexOf(e);return-1!==t&&this._floorMeshes[t].absolutePosition.y<this._options.xrInput.xrCamera.globalPosition.y})),n=r&&r.pickedMesh&&-1!==this._floorMeshes.indexOf(r.pickedMesh);if(r&&r.pickedMesh&&!n)return e.teleportationState.mainComponentUsed&&!e.teleportationState.initialHit?void(e.teleportationState.forward=!1):(e.teleportationState.blocked=!0,this._setTargetMeshVisibility(!1,!1,s),void this._showParabolicPath(r));r&&r.pickedPoint&&(e.teleportationState.initialHit=!0,e.teleportationState.blocked=!1,t=!0,this._setTargetMeshPosition(r),this._setTargetMeshVisibility(!0,!1,s),this._showParabolicPath(r))}if(this.parabolicRayEnabled&&!t){const r=e.xrController.pointer.rotationQuaternion.toEulerAngles().x,n=Math.PI/2-Math.abs(r)+1,a=this.parabolicCheckRadius*n;this._tmpRay.origin.addToRef(this._tmpRay.direction.scale(2*a),this._tmpVector),this._tmpVector.y=this._tmpRay.origin.y,this._tmpRay.origin.addInPlace(this._tmpRay.direction.scale(a)),this._tmpVector.subtractToRef(this._tmpRay.origin,this._tmpRay.direction),this._tmpRay.direction.normalize();const o=i.pickWithRay(this._tmpRay,(e=>!(!this._options.blockerMeshesPredicate||!this._options.blockerMeshesPredicate(e))||(!(!this._options.blockAllPickableMeshes||!e.isPickable)||(!(!this._options.pickBlockerMeshes||-1===this._options.pickBlockerMeshes.indexOf(e))||-1!==this._floorMeshes.indexOf(e))))),l=o&&o.pickedMesh&&-1!==this._floorMeshes.indexOf(o.pickedMesh);if(o&&o.pickedMesh&&!l)return e.teleportationState.mainComponentUsed&&!e.teleportationState.initialHit?void(e.teleportationState.forward=!1):(e.teleportationState.blocked=!0,this._setTargetMeshVisibility(!1,!1,s),void this._showParabolicPath(o));o&&o.pickedPoint&&(e.teleportationState.initialHit=!0,e.teleportationState.blocked=!1,t=!0,this._setTargetMeshPosition(o),this._setTargetMeshVisibility(!0,!1,s),this._showParabolicPath(o))}this._setTargetMeshVisibility(t,!1,s)}else this._setTargetMeshVisibility(!1,!1,!0)}else this._disposeBezierCurve(),this._setTargetMeshVisibility(!1,!1,!0)}_createDefaultTargetMesh(){this._options.defaultTargetMeshOptions=this._options.defaultTargetMeshOptions||{};const e=this._options.useUtilityLayer?this._options.customUtilityLayerScene||Bn.DefaultUtilityLayer.utilityLayerScene:this._xrSessionManager.scene,t=Oi("teleportationTarget",{width:2,height:2,subdivisions:2},e);if(t.isPickable=!1,this._options.defaultTargetMeshOptions.teleportationCircleMaterial)t.material=this._options.defaultTargetMeshOptions.teleportationCircleMaterial;else{const i=512,r=new Ms("teleportationPlaneDynamicTexture",i,e,!0);r.hasAlpha=!0;const s=r.getContext(),n=i/2,a=i/2,o=200;s.beginPath(),s.arc(n,a,o,0,2*Math.PI,!1),s.fillStyle=this._options.defaultTargetMeshOptions.teleportationFillColor||"#444444",s.fill(),s.lineWidth=10,s.strokeStyle=this._options.defaultTargetMeshOptions.teleportationBorderColor||"#FFFFFF",s.stroke(),s.closePath(),r.update();const l=new zr("teleportationPlaneMaterial",e);l.diffuseTexture=r,t.material=l}const i=qi("torusTeleportation",{diameter:.75,thickness:.1,tessellation:20},e);if(i.isPickable=!1,i.parent=t,!this._options.defaultTargetMeshOptions.disableAnimation){const t=new dt("animationInnerCircle","position.y",30,dt.ANIMATIONTYPE_FLOAT,dt.ANIMATIONLOOPMODE_CYCLE),r=[];r.push({frame:0,value:0}),r.push({frame:30,value:.4}),r.push({frame:60,value:0}),t.setKeys(r);const s=new et;s.setEasingMode($e.EASINGMODE_EASEINOUT),t.setEasingFunction(s),i.animations=[],i.animations.push(t),e.beginAnimation(i,0,60,!0)}const r=Hi("rotationCone",{diameterTop:0,tessellation:4},e);if(r.isPickable=!1,r.scaling.set(.5,.12,.2),r.rotate(J._0.X,Math.PI/2),r.position.z=.6,r.parent=i,this._options.defaultTargetMeshOptions.torusArrowMaterial)i.material=this._options.defaultTargetMeshOptions.torusArrowMaterial,r.material=this._options.defaultTargetMeshOptions.torusArrowMaterial;else{const t=new zr("torusConsMat",e);t.disableLighting=!!this._options.defaultTargetMeshOptions.disableLighting,t.disableLighting?t.emissiveColor=new E.v9(.3,.3,1):t.diffuseColor=new E.v9(.3,.3,1),t.alpha=.9,i.material=t,r.material=t,this._teleportationRingMaterial=t}void 0!==this._options.renderingGroupId&&(t.renderingGroupId=this._options.renderingGroupId,i.renderingGroupId=this._options.renderingGroupId,r.renderingGroupId=this._options.renderingGroupId),this._options.teleportationTargetMesh=t,this._options.teleportationTargetMesh.scaling.setAll(this._xrSessionManager.worldScalingFactor),this._setTargetMeshVisibility(!1)}_detachController(e){const t=this._controllers[e];t&&(t.teleportationComponent&&(t.onAxisChangedObserver&&t.teleportationComponent.onAxisValueChangedObservable.remove(t.onAxisChangedObserver),t.onButtonChangedObserver&&t.teleportationComponent.onButtonStateChangedObservable.remove(t.onButtonChangedObserver)),delete this._controllers[e])}_findClosestSnapPointWithRadius(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._options.snapToPositionRadius||.8,i=null,r=Number.MAX_VALUE;if(this._snapToPositions.length){const s=t*t;this._snapToPositions.forEach((t=>{const n=o.Pq.DistanceSquared(t,e);n<=s&&n<r&&(r=n,i=t)}))}return i}_setTargetMeshPosition(e){const t=e.pickedPoint;if(!this._options.teleportationTargetMesh||!t)return;const i=this._findClosestSnapPointWithRadius(t);this._snappedToPoint=!!i,this.snapPointsOnly&&!this._snappedToPoint&&this._teleportationRingMaterial?this._teleportationRingMaterial.diffuseColor.set(1,.3,.3):this.snapPointsOnly&&this._snappedToPoint&&this._teleportationRingMaterial&&this._teleportationRingMaterial.diffuseColor.set(.3,.3,1),this._options.teleportationTargetMesh.position.copyFrom(i||t),this._options.teleportationTargetMesh.position.y+=.01,this.onTargetMeshPositionUpdatedObservable.notifyObservers(e)}_setTargetMeshVisibility(e,t,i){this._options.teleportationTargetMesh&&(this._options.teleportationTargetMesh.isVisible!==e||t)&&(this._options.teleportationTargetMesh.isVisible=e,this._options.teleportationTargetMesh.getChildren(void 0,!1).forEach((t=>{t.isVisible=e})),e?this._selectionFeature&&i&&this._selectionFeature.detach():(this._quadraticBezierCurve&&(this._quadraticBezierCurve.dispose(),this._quadraticBezierCurve=null),this._selectionFeature&&i&&this._selectionFeature.attach()))}_disposeBezierCurve(){this._quadraticBezierCurve&&(this._quadraticBezierCurve.dispose(),this._quadraticBezierCurve=null)}_showParabolicPath(e){if(!e.pickedPoint||!this._currentTeleportationControllerId)return;const t=this._options.useUtilityLayer?this._options.customUtilityLayerScene||Bn.DefaultUtilityLayer.utilityLayerScene:this._xrSessionManager.scene,i=this._controllers[this._currentTeleportationControllerId],r=Qe.jj.CreateQuadraticBezier(i.xrController.pointer.absolutePosition,e.ray.origin,e.pickedPoint,25),s=i.teleportationState.blocked?this._blockedRayColor:void 0,n=this._colorArray.fill(s||this._cachedColor4White),a=r.getPoints();a.shift(),a.shift(),this._options.generateRayPathMesh?this._quadraticBezierCurve=this._options.generateRayPathMesh(r.getPoints(),e):this._quadraticBezierCurve=ir("teleportation path line",{points:a,instance:this._quadraticBezierCurve,updatable:!0,colors:n},t),this._quadraticBezierCurve.isPickable=!1,void 0!==this._options.renderingGroupId&&(this._quadraticBezierCurve.renderingGroupId=this._options.renderingGroupId)}_teleportForward(e){const t=this._controllers[e];if(t&&t.teleportationState.forward&&this.teleportationEnabled&&(t.teleportationState.forward=!1,this._currentTeleportationControllerId="",!this.snapPointsOnly||this._snappedToPoint))if(this.skipNextTeleportation)this.skipNextTeleportation=!1;else if(this._options.teleportationTargetMesh&&this._options.teleportationTargetMesh.isVisible){const e=this._options.xrInput.xrCamera.realWorldHeight;this.onBeforeCameraTeleport.notifyObservers(this._options.xrInput.xrCamera.position),this._options.xrInput.xrCamera.position.copyFrom(this._options.teleportationTargetMesh.position),this._options.xrInput.xrCamera.position.y+=e,o.PT.FromEulerAngles(0,t.teleportationState.currentRotation-(this._xrSessionManager.scene.useRightHandedSystem?Math.PI:0),0).multiplyToRef(this._options.xrInput.xrCamera.rotationQuaternion,this._options.xrInput.xrCamera.rotationQuaternion),this.onAfterCameraTeleport.notifyObservers(this._options.xrInput.xrCamera.position)}}}Ga.Name=Zs.TELEPORTATION,Ga.Version=1,Js.AddWebXRFeature(Ga.Name,((e,t)=>()=>new Ga(e,t)),Ga.Version,!0);class Ha{constructor(){}static CreateAsync(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=new Ha;if(e.onDisposeObservable.addOnce((()=>{i.dispose()})),!t.disableDefaultUI){const r={renderTarget:i.renderTarget,...t.uiOptions||{}};t.optionalFeatures&&("boolean"===typeof t.optionalFeatures?r.optionalFeatures=["hit-test","anchors","plane-detection","hand-tracking"]:r.optionalFeatures=t.optionalFeatures),i.enterExitUI=new wa(e,r)}return rn.CreateAsync(e).then((e=>{if(i.baseExperience=e,t.ignoreNativeCameraTransformation&&(i.baseExperience.camera.compensateOnFirstFrame=!1),i.input=new Fn(e.sessionManager,e.camera,{controllerOptions:{renderingGroupId:t.renderingGroupId},...t.inputOptions||{}}),!t.disablePointerSelection){const e={...t.pointerSelectionOptions,xrInput:i.input,renderingGroupId:t.renderingGroupId};i.pointerSelection=i.baseExperience.featuresManager.enableFeature(Nn.Name,t.useStablePlugins?"stable":"latest",e),t.disableTeleportation||(i.teleportation=i.baseExperience.featuresManager.enableFeature(Ga.Name,t.useStablePlugins?"stable":"latest",{floorMeshes:t.floorMeshes,xrInput:i.input,renderingGroupId:t.renderingGroupId,...t.teleportationOptions}),i.teleportation.setSelectionFeature(i.pointerSelection))}return t.disableNearInteraction||(i.nearInteraction=i.baseExperience.featuresManager.enableFeature(Oa.Name,t.useStablePlugins?"stable":"latest",{xrInput:i.input,farInteractionFeature:i.pointerSelection,renderingGroupId:t.renderingGroupId,useUtilityLayer:!0,enableNearInteractionOnAllControllers:!0,...t.nearInteractionOptions})),t.disableHandTracking||i.baseExperience.featuresManager.enableFeature(Ua.Name,t.useStablePlugins?"stable":"latest",{xrInput:i.input,...t.handSupportOptions},void 0,!1),i.renderTarget=i.baseExperience.sessionManager.getWebXRRenderTarget(t.outputCanvasOptions),t.disableDefaultUI?void 0:i.enterExitUI.setHelperAsync(i.baseExperience,i.renderTarget)})).then((()=>i)).catch((e=>(T.V.Error("Error initializing XR"),T.V.Error(e),i)))}dispose(){this.baseExperience&&this.baseExperience.dispose(),this.input&&this.input.dispose(),this.enterExitUI&&this.enterExitUI.dispose(),this.renderTarget&&this.renderTarget.dispose()}}Gt.Z.prototype.createDefaultLight=function(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this.lights)for(let e=0;e<this.lights.length;e++)this.lights[e].dispose();0===this.lights.length&&new Hr("default light",o.Pq.Up(),this)},Gt.Z.prototype.createDefaultCamera=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&this.activeCamera&&(this.activeCamera.dispose(),this.activeCamera=null),!this.activeCamera){const i=this.getWorldExtends((e=>e.isVisible&&e.isEnabled())),r=i.max.subtract(i.min),s=i.min.add(r.scale(.5));let n,a=1.5*r.length();if(isFinite(a)||(a=1,s.copyFromFloats(0,0,0)),e){const e=new Rt("default camera",-Math.PI/2,Math.PI/2,a,s,this);e.lowerRadiusLimit=.01*a,e.wheelPrecision=100/a,n=e}else{const e=new ls("default camera",new o.Pq(s.x,s.y,-a),this);e.setTarget(s),n=e}n.minZ=.01*a,n.maxZ=1e3*a,n.speed=.2*a,this.activeCamera=n,t&&n.attachControl()}},Gt.Z.prototype.createDefaultCameraOrLight=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.createDefaultLight(t),this.createDefaultCamera(e,t,i)},Gt.Z.prototype.createDefaultSkybox=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(!e)return T.V.Warn("Can not create default skybox without environment texture."),null;s&&e&&(this.environmentTexture=e);const n=Li("hdrSkyBox",{size:i},this);if(t){const t=new Ti("skyBox",this);t.backFaceCulling=!1,t.reflectionTexture=e.clone(),t.reflectionTexture&&(t.reflectionTexture.coordinatesMode=kt.g.SKYBOX_MODE),t.microSurface=1-r,t.disableLighting=!0,t.twoSidedLighting=!0,n.material=t}else{const t=new zr("skyBox",this);t.backFaceCulling=!1,t.reflectionTexture=e.clone(),t.reflectionTexture&&(t.reflectionTexture.coordinatesMode=kt.g.SKYBOX_MODE),t.disableLighting=!0,n.material=t}return n.isPickable=!1,n.infiniteDistance=!0,n.ignoreCameraMaxZ=!0,n},Gt.Z.prototype.createDefaultEnvironment=function(e){return es?new es(e,this):null},Gt.Z.prototype.createDefaultVRExperience=function(){return new Qs(this,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})},Gt.Z.prototype.createDefaultXRExperienceAsync=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Ha.CreateAsync(this,e).then((e=>e))};class Wa{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"black";this._renderingCanvas=e,this._loadingText=t,this._loadingDivBackgroundColor=i,this._resizeLoadingUI=()=>{const e=this._renderingCanvas.getBoundingClientRect(),t=window.getComputedStyle(this._renderingCanvas).position;this._loadingDiv&&(this._loadingDiv.style.position="fixed"===t?"fixed":"absolute",this._loadingDiv.style.left=e.left+"px",this._loadingDiv.style.top=e.top+"px",this._loadingDiv.style.width=e.width+"px",this._loadingDiv.style.height=e.height+"px")}}displayLoadingUI(){if(this._loadingDiv)return;this._loadingDiv=document.createElement("div"),this._loadingDiv.id="babylonjsLoadingDiv",this._loadingDiv.style.opacity="0",this._loadingDiv.style.transition="opacity 1.5s ease",this._loadingDiv.style.pointerEvents="none",this._loadingDiv.style.display="grid",this._loadingDiv.style.gridTemplateRows="100%",this._loadingDiv.style.gridTemplateColumns="100%",this._loadingDiv.style.justifyItems="center",this._loadingDiv.style.alignItems="center",this._loadingTextDiv=document.createElement("div"),this._loadingTextDiv.style.position="absolute",this._loadingTextDiv.style.left="0",this._loadingTextDiv.style.top="50%",this._loadingTextDiv.style.marginTop="80px",this._loadingTextDiv.style.width="100%",this._loadingTextDiv.style.height="20px",this._loadingTextDiv.style.fontFamily="Arial",this._loadingTextDiv.style.fontSize="14px",this._loadingTextDiv.style.color="white",this._loadingTextDiv.style.textAlign="center",this._loadingTextDiv.style.zIndex="1",this._loadingTextDiv.innerHTML="Loading",this._loadingDiv.appendChild(this._loadingTextDiv),this._loadingTextDiv.innerHTML=this._loadingText,this._style=document.createElement("style"),this._style.type="text/css";this._style.innerHTML="@-webkit-keyframes spin1 {                    0% { -webkit-transform: rotate(0deg);}\n                    100% { -webkit-transform: rotate(360deg);}\n                }                @keyframes spin1 {                    0% { transform: rotate(0deg);}\n                    100% { transform: rotate(360deg);}\n                }",document.getElementsByTagName("head")[0].appendChild(this._style);const e=!!window.SVGSVGElement,t=new Image;Wa.DefaultLogoUrl?t.src=Wa.DefaultLogoUrl:t.src=e?"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxODAuMTcgMjA4LjA0Ij48ZGVmcz48c3R5bGU+LmNscy0xe2ZpbGw6I2ZmZjt9LmNscy0ye2ZpbGw6I2UwNjg0Yjt9LmNscy0ze2ZpbGw6I2JiNDY0Yjt9LmNscy00e2ZpbGw6I2UwZGVkODt9LmNscy01e2ZpbGw6I2Q1ZDJjYTt9PC9zdHlsZT48L2RlZnM+PHRpdGxlPkJhYnlsb25Mb2dvPC90aXRsZT48ZyBpZD0iTGF5ZXJfMiIgZGF0YS1uYW1lPSJMYXllciAyIj48ZyBpZD0iUGFnZV9FbGVtZW50cyIgZGF0YS1uYW1lPSJQYWdlIEVsZW1lbnRzIj48cGF0aCBjbGFzcz0iY2xzLTEiIGQ9Ik05MC4wOSwwLDAsNTJWMTU2bDkwLjA5LDUyLDkwLjA4LTUyVjUyWiIvPjxwb2x5Z29uIGNsYXNzPSJjbHMtMiIgcG9pbnRzPSIxODAuMTcgNTIuMDEgMTUxLjk3IDM1LjczIDEyNC44NSA1MS4zOSAxNTMuMDUgNjcuNjcgMTgwLjE3IDUyLjAxIi8+PHBvbHlnb24gY2xhc3M9ImNscy0yIiBwb2ludHM9IjI3LjEyIDY3LjY3IDExNy4yMSAxNS42NiA5MC4wOCAwIDAgNTIuMDEgMjcuMTIgNjcuNjciLz48cG9seWdvbiBjbGFzcz0iY2xzLTIiIHBvaW50cz0iNjEuODkgMTIwLjMgOTAuMDggMTM2LjU4IDExOC4yOCAxMjAuMyA5MC4wOCAxMDQuMDIgNjEuODkgMTIwLjMiLz48cG9seWdvbiBjbGFzcz0iY2xzLTMiIHBvaW50cz0iMTUzLjA1IDY3LjY3IDE1My4wNSAxNDAuMzcgOTAuMDggMTc2LjcyIDI3LjEyIDE0MC4zNyAyNy4xMiA2Ny42NyAwIDUyLjAxIDAgMTU2LjAzIDkwLjA4IDIwOC4wNCAxODAuMTcgMTU2LjAzIDE4MC4xNyA1Mi4wMSAxNTMuMDUgNjcuNjciLz48cG9seWdvbiBjbGFzcz0iY2xzLTMiIHBvaW50cz0iOTAuMDggNzEuNDYgNjEuODkgODcuNzQgNjEuODkgMTIwLjMgOTAuMDggMTA0LjAyIDExOC4yOCAxMjAuMyAxMTguMjggODcuNzQgOTAuMDggNzEuNDYiLz48cG9seWdvbiBjbGFzcz0iY2xzLTQiIHBvaW50cz0iMTUzLjA1IDY3LjY3IDExOC4yOCA4Ny43NCAxMTguMjggMTIwLjMgOTAuMDggMTM2LjU4IDkwLjA4IDE3Ni43MiAxNTMuMDUgMTQwLjM3IDE1My4wNSA2Ny42NyIvPjxwb2x5Z29uIGNsYXNzPSJjbHMtNSIgcG9pbnRzPSIyNy4xMiA2Ny42NyA2MS44OSA4Ny43NCA2MS44OSAxMjAuMyA5MC4wOCAxMzYuNTggOTAuMDggMTc2LjcyIDI3LjEyIDE0MC4zNyAyNy4xMiA2Ny42NyIvPjwvZz48L2c+PC9zdmc+":"https://cdn.babylonjs.com/Assets/babylonLogo.png",t.style.width="150px",t.style.gridColumn="1",t.style.gridRow="1",t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",t.style.position="absolute";const i=document.createElement("div");i.style.width="300px",i.style.gridColumn="1",i.style.gridRow="1",i.style.top="50%",i.style.left="50%",i.style.transform="translate(-50%, -50%)",i.style.position="absolute";const r=new Image;if(Wa.DefaultSpinnerUrl?r.src=Wa.DefaultSpinnerUrl:r.src=e?"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzOTIgMzkyIj48ZGVmcz48c3R5bGU+LmNscy0xe2ZpbGw6I2UwNjg0Yjt9LmNscy0ye2ZpbGw6bm9uZTt9PC9zdHlsZT48L2RlZnM+PHRpdGxlPlNwaW5uZXJJY29uPC90aXRsZT48ZyBpZD0iTGF5ZXJfMiIgZGF0YS1uYW1lPSJMYXllciAyIj48ZyBpZD0iU3Bpbm5lciI+PHBhdGggY2xhc3M9ImNscy0xIiBkPSJNNDAuMjEsMTI2LjQzYzMuNy03LjMxLDcuNjctMTQuNDQsMTItMjEuMzJsMy4zNi01LjEsMy41Mi01YzEuMjMtMS42MywyLjQxLTMuMjksMy42NS00LjkxczIuNTMtMy4yMSwzLjgyLTQuNzlBMTg1LjIsMTg1LjIsMCwwLDEsODMuNCw2Ny40M2EyMDgsMjA4LDAsMCwxLDE5LTE1LjY2YzMuMzUtMi40MSw2Ljc0LTQuNzgsMTAuMjUtN3M3LjExLTQuMjgsMTAuNzUtNi4zMmM3LjI5LTQsMTQuNzMtOCwyMi41My0xMS40OSwzLjktMS43Miw3Ljg4LTMuMywxMi00LjY0YTEwNC4yMiwxMDQuMjIsMCwwLDEsMTIuNDQtMy4yMyw2Mi40NCw2Mi40NCwwLDAsMSwxMi43OC0xLjM5QTI1LjkyLDI1LjkyLDAsMCwxLDE5NiwyMS40NGE2LjU1LDYuNTUsMCwwLDEsMi4wNSw5LDYuNjYsNi42NiwwLDAsMS0xLjY0LDEuNzhsLS40MS4yOWEyMi4wNywyMi4wNywwLDAsMS01Ljc4LDMsMzAuNDIsMzAuNDIsMCwwLDEtNS42NywxLjYyLDM3LjgyLDM3LjgyLDAsMCwxLTUuNjkuNzFjLTEsMC0xLjkuMTgtMi44NS4yNmwtMi44NS4yNHEtNS43Mi41MS0xMS40OCwxLjFjLTMuODQuNC03LjcxLjgyLTExLjU4LDEuNGExMTIuMzQsMTEyLjM0LDAsMCwwLTIyLjk0LDUuNjFjLTMuNzIsMS4zNS03LjM0LDMtMTAuOTQsNC42NHMtNy4xNCwzLjUxLTEwLjYsNS41MUExNTEuNiwxNTEuNiwwLDAsMCw2OC41Niw4N0M2Ny4yMyw4OC40OCw2Niw5MCw2NC42NCw5MS41NnMtMi41MSwzLjE1LTMuNzUsNC43M2wtMy41NCw0LjljLTEuMTMsMS42Ni0yLjIzLDMuMzUtMy4zMyw1YTEyNywxMjcsMCwwLDAtMTAuOTMsMjEuNDksMS41OCwxLjU4LDAsMSwxLTMtMS4xNVM0MC4xOSwxMjYuNDcsNDAuMjEsMTI2LjQzWiIvPjxyZWN0IGNsYXNzPSJjbHMtMiIgd2lkdGg9IjM5MiIgaGVpZ2h0PSIzOTIiLz48L2c+PC9nPjwvc3ZnPg==":"https://cdn.babylonjs.com/Assets/loadingIcon.png",r.style.animation="spin1 0.75s infinite linear",r.style.webkitAnimation="spin1 0.75s infinite linear",r.style.transformOrigin="50% 50%",r.style.webkitTransformOrigin="50% 50%",!e){const e={w:16,h:18.5},i={w:30,h:30};t.style.width=`${e.w}vh`,t.style.height=`${e.h}vh`,t.style.left=`calc(50% - ${e.w/2}vh)`,t.style.top=`calc(50% - ${e.h/2}vh)`,r.style.width=`${i.w}vh`,r.style.height=`${i.h}vh`,r.style.left=`calc(50% - ${i.w/2}vh)`,r.style.top=`calc(50% - ${i.h/2}vh)`}i.appendChild(r),this._loadingDiv.appendChild(t),this._loadingDiv.appendChild(i),this._resizeLoadingUI(),window.addEventListener("resize",this._resizeLoadingUI),this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor,document.body.appendChild(this._loadingDiv),this._loadingDiv.style.opacity="1"}hideLoadingUI(){if(!this._loadingDiv)return;this._loadingDiv.style.opacity="0",this._loadingDiv.addEventListener("transitionend",(()=>{this._loadingTextDiv&&(this._loadingTextDiv.remove(),this._loadingTextDiv=null),this._loadingDiv&&(this._loadingDiv.remove(),this._loadingDiv=null),this._style&&(this._style.remove(),this._style=null),window.removeEventListener("resize",this._resizeLoadingUI)}))}set loadingUIText(e){this._loadingText=e,this._loadingTextDiv&&(this._loadingTextDiv.innerHTML=this._loadingText)}get loadingUIText(){return this._loadingText}get loadingUIBackgroundColor(){return this._loadingDivBackgroundColor}set loadingUIBackgroundColor(e){this._loadingDivBackgroundColor=e,this._loadingDiv&&(this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor)}}Wa.DefaultLogoUrl="",Wa.DefaultSpinnerUrl="",ee.$.DefaultLoadingScreenFactory=e=>new Wa(e);const qa=i.p+"static/media/backgroundGround.90ee5ab92c7b67538443.png",Xa=i.p+"static/media/backgroundSkybox.5db1bcaca17ebcc583c0.dds",Ka=i.p+"static/media/environmentSpecular.6931523fdff509a07700.env";var Ya=i(8139),ja=i.n(Ya);function Qa(e){return Qa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Qa(e)}var $a=i(6816);var Za=function(e,t){"function"===typeof e?e(t):"object"===Qa(e)&&e&&"current"in e&&(e.current=t)},Ja=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var r=t.filter(Boolean);return r.length<=1?r[0]:function(e){t.forEach((function(t){Za(t,e)}))}},eo=function(e){var t,i,r=(0,$a.isMemo)(e)?e.type.type:e.type;return!!("function"!==typeof r||null!==(t=r.prototype)&&void 0!==t&&t.render||r.$$typeof===$a.ForwardRef)&&!!("function"!==typeof e||null!==(i=e.prototype)&&void 0!==i&&i.render||e.$$typeof===$a.ForwardRef)};function to(t){return(0,e.isValidElement)(t)&&!(0,$a.isFragment)(t)}Number(e.version.split(".")[0]);const io="ant",ro=e.createContext({getPrefixCls:(e,t)=>t||(e?`${io}-${e}`:io),iconPrefixCls:"anticon"}),{Consumer:so}=ro;const no=(t,i,r)=>e.isValidElement(t)?e.cloneElement(t,"function"===typeof r?r(t.props||{}):r):i;function ao(e,t){return no(e,e,t)}function oo(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=Array(t);i<t;i++)r[i]=e[i];return r}function lo(e,t){if(e){if("string"==typeof e)return oo(e,t);var i={}.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?oo(e,t):void 0}}function ho(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var r,s,n,a,o=[],l=!0,h=!1;try{if(n=(i=i.call(e)).next,0===t){if(Object(i)!==i)return;l=!1}else for(;!(l=(r=n.call(i)).done)&&(o.push(r.value),o.length!==t);l=!0);}catch(e){h=!0,s=e}finally{try{if(!l&&null!=i.return&&(a=i.return(),Object(a)!==a))return}finally{if(h)throw s}}return o}}(e,t)||lo(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function co(e){var t=function(e,t){if("object"!=Qa(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=Qa(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Qa(t)?t:t+""}function uo(e,t,i){return(t=co(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _o(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function po(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?_o(Object(i),!0).forEach((function(t){uo(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):_o(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function fo(e){return function(e){if(Array.isArray(e))return oo(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||lo(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}const go=function(e){for(var t,i=0,r=0,s=e.length;s>=4;++r,s-=4)t=1540483477*(65535&(t=255&e.charCodeAt(r)|(255&e.charCodeAt(++r))<<8|(255&e.charCodeAt(++r))<<16|(255&e.charCodeAt(++r))<<24))+(59797*(t>>>16)<<16),i=1540483477*(65535&(t^=t>>>24))+(59797*(t>>>16)<<16)^1540483477*(65535&i)+(59797*(i>>>16)<<16);switch(s){case 3:i^=(255&e.charCodeAt(r+2))<<16;case 2:i^=(255&e.charCodeAt(r+1))<<8;case 1:i=1540483477*(65535&(i^=255&e.charCodeAt(r)))+(59797*(i>>>16)<<16)}return(((i=1540483477*(65535&(i^=i>>>13))+(59797*(i>>>16)<<16))^i>>>15)>>>0).toString(36)};function mo(){return!("undefined"===typeof window||!window.document||!window.document.createElement)}var bo="data-rc-order",vo="data-rc-priority",yo="rc-util-key",To=new Map;function xo(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).mark;return e?e.startsWith("data-")?e:"data-".concat(e):yo}function Ao(e){return e.attachTo?e.attachTo:document.querySelector("head")||document.body}function Co(e){return Array.from((To.get(e)||e).children).filter((function(e){return"STYLE"===e.tagName}))}function Ro(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!mo())return null;var i=t.csp,r=t.prepend,s=t.priority,n=void 0===s?0:s,a=function(e){return"queue"===e?"prependQueue":e?"prepend":"append"}(r),o="prependQueue"===a,l=document.createElement("style");l.setAttribute(bo,a),o&&n&&l.setAttribute(vo,"".concat(n)),null!==i&&void 0!==i&&i.nonce&&(l.nonce=null===i||void 0===i?void 0:i.nonce),l.innerHTML=e;var h=Ao(t),c=h.firstChild;if(r){if(o){var u=(t.styles||Co(h)).filter((function(e){if(!["prepend","prependQueue"].includes(e.getAttribute(bo)))return!1;var t=Number(e.getAttribute(vo)||0);return n>=t}));if(u.length)return h.insertBefore(l,u[u.length-1].nextSibling),l}h.insertBefore(l,c)}else h.appendChild(l);return l}function Eo(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=Ao(t);return(t.styles||Co(i)).find((function(i){return i.getAttribute(xo(t))===e}))}function So(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=Eo(e,t);i&&Ao(t).removeChild(i)}function Mo(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=Ao(i),s=Co(r),n=po(po({},i),{},{styles:s});!function(e,t){var i=To.get(e);if(!i||!function(e,t){if(!e)return!1;if(e.contains)return e.contains(t);for(var i=t;i;){if(i===e)return!0;i=i.parentNode}return!1}(document,i)){var r=Ro("",t),s=r.parentNode;To.set(e,s),e.removeChild(r)}}(r,n);var a=Eo(t,n);if(a){var o,l,h;if(null!==(o=n.csp)&&void 0!==o&&o.nonce&&a.nonce!==(null===(l=n.csp)||void 0===l?void 0:l.nonce))a.nonce=null===(h=n.csp)||void 0===h?void 0:h.nonce;return a.innerHTML!==e&&(a.innerHTML=e),a}var c=Ro(e,n);return c.setAttribute(xo(n),t),c}var Po={},Io=[];function Oo(e,t){}function Do(e,t){}function wo(e,t,i){t||Po[i]||(e(!1,i),Po[i]=!0)}function Fo(e,t){wo(Oo,e,t)}Fo.preMessage=function(e){Io.push(e)},Fo.resetWarned=function(){Po={}},Fo.noteOnce=function(e,t){wo(Do,e,t)};const Lo=Fo;function Bo(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function No(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,co(r.key),r)}}function ko(e,t,i){return t&&No(e.prototype,t),i&&No(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}var Uo="%";function Vo(e){return e.join(Uo)}var zo=function(){function e(t){Bo(this,e),uo(this,"instanceId",void 0),uo(this,"cache",new Map),this.instanceId=t}return ko(e,[{key:"get",value:function(e){return this.opGet(Vo(e))}},{key:"opGet",value:function(e){return this.cache.get(e)||null}},{key:"update",value:function(e,t){return this.opUpdate(Vo(e),t)}},{key:"opUpdate",value:function(e,t){var i=t(this.cache.get(e));null===i?this.cache.delete(e):this.cache.set(e,i)}}]),e}();const Go=zo;var Ho="data-token-hash",Wo="data-css-hash",qo="__cssinjs_instance__";function Xo(){var e=Math.random().toString(12).slice(2);if("undefined"!==typeof document&&document.head&&document.body){var t=document.body.querySelectorAll("style[".concat(Wo,"]"))||[],i=document.head.firstChild;Array.from(t).forEach((function(t){t[qo]=t[qo]||e,t[qo]===e&&document.head.insertBefore(t,i)}));var r={};Array.from(document.querySelectorAll("style[".concat(Wo,"]"))).forEach((function(t){var i,s=t.getAttribute(Wo);r[s]?t[qo]===e&&(null===(i=t.parentNode)||void 0===i||i.removeChild(t)):r[s]=!0}))}return new Go(e)}var Ko=e.createContext({hashPriority:"low",cache:Xo(),defaultCache:!0});const Yo=Ko;var jo="CALC_UNIT";new RegExp(jo,"g");var Qo=function(){function e(){Bo(this,e),uo(this,"cache",void 0),uo(this,"keys",void 0),uo(this,"cacheCallTimes",void 0),this.cache=new Map,this.keys=[],this.cacheCallTimes=0}return ko(e,[{key:"size",value:function(){return this.keys.length}},{key:"internalGet",value:function(e){var t,i,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s={map:this.cache};return e.forEach((function(e){var t;s?s=null===(t=s)||void 0===t||null===(t=t.map)||void 0===t?void 0:t.get(e):s=void 0})),null!==(t=s)&&void 0!==t&&t.value&&r&&(s.value[1]=this.cacheCallTimes++),null===(i=s)||void 0===i?void 0:i.value}},{key:"get",value:function(e){var t;return null===(t=this.internalGet(e,!0))||void 0===t?void 0:t[0]}},{key:"has",value:function(e){return!!this.internalGet(e)}},{key:"set",value:function(t,i){var r=this;if(!this.has(t)){if(this.size()+1>e.MAX_CACHE_SIZE+e.MAX_CACHE_OFFSET){var s=this.keys.reduce((function(e,t){var i=ho(e,2)[1];return r.internalGet(t)[1]<i?[t,r.internalGet(t)[1]]:e}),[this.keys[0],this.cacheCallTimes]),n=ho(s,1)[0];this.delete(n)}this.keys.push(t)}var a=this.cache;t.forEach((function(e,s){if(s===t.length-1)a.set(e,{value:[i,r.cacheCallTimes++]});else{var n=a.get(e);n?n.map||(n.map=new Map):a.set(e,{map:new Map}),a=a.get(e).map}}))}},{key:"deleteByPath",value:function(e,t){var i,r=e.get(t[0]);if(1===t.length)return r.map?e.set(t[0],{map:r.map}):e.delete(t[0]),null===(i=r.value)||void 0===i?void 0:i[0];var s=this.deleteByPath(r.map,t.slice(1));return r.map&&0!==r.map.size||r.value||e.delete(t[0]),s}},{key:"delete",value:function(e){if(this.has(e))return this.keys=this.keys.filter((function(t){return!function(e,t){if(e.length!==t.length)return!1;for(var i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}(t,e)})),this.deleteByPath(this.cache,e)}}]),e}();uo(Qo,"MAX_CACHE_SIZE",20),uo(Qo,"MAX_CACHE_OFFSET",5);var $o=0,Zo=function(){function e(t){Bo(this,e),uo(this,"derivatives",void 0),uo(this,"id",void 0),this.derivatives=Array.isArray(t)?t:[t],this.id=$o,0===t.length&&t.length,$o+=1}return ko(e,[{key:"getDerivativeToken",value:function(e){return this.derivatives.reduce((function(t,i){return i(e,t)}),void 0)}}]),e}(),Jo=new Qo;var el=new WeakMap,tl={};var il=new WeakMap;function rl(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=il.get(e)||"";return i||(Object.keys(e).forEach((function(r){var s=e[r];i+=r,s instanceof Zo?i+=s.id:s&&"object"===Qa(s)?i+=rl(s,t):i+=s})),t&&(i=go(i)),il.set(e,i)),i}function sl(e,t){return go("".concat(t,"_").concat(rl(e,!0)))}"random-".concat(Date.now(),"-").concat(Math.random()).replace(/\./g,"");var nl=mo();function al(e){return"number"===typeof e?"".concat(e,"px"):e}function ol(e,t,i){if(arguments.length>4&&void 0!==arguments[4]&&arguments[4])return e;var r=po(po({},arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}),{},uo(uo({},Ho,t),Wo,i)),s=Object.keys(r).map((function(e){var t=r[e];return t?"".concat(e,'="').concat(t,'"'):null})).filter((function(e){return e})).join(" ");return"<style ".concat(s,">").concat(e,"</style>")}var ll=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return"--".concat(t?"".concat(t,"-"):"").concat(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").replace(/([A-Z]+)([A-Z][a-z0-9]+)/g,"$1-$2").replace(/([a-z])([A-Z0-9])/g,"$1-$2").toLowerCase()},hl=function(e,t,i){return Object.keys(e).length?".".concat(t).concat(null!==i&&void 0!==i&&i.scope?".".concat(i.scope):"","{").concat(Object.entries(e).map((function(e){var t=ho(e,2),i=t[0],r=t[1];return"".concat(i,":").concat(r,";")})).join(""),"}"):""},cl=function(e,t,i){var r={},s={};return Object.entries(e).forEach((function(e){var t,n,a=ho(e,2),o=a[0],l=a[1];if(null!==i&&void 0!==i&&null!==(t=i.preserve)&&void 0!==t&&t[o])s[o]=l;else if(("string"===typeof l||"number"===typeof l)&&(null===i||void 0===i||null===(n=i.ignore)||void 0===n||!n[o])){var h,c=ll(o,null===i||void 0===i?void 0:i.prefix);r[c]="number"!==typeof l||null!==i&&void 0!==i&&null!==(h=i.unitless)&&void 0!==h&&h[o]?String(l):"".concat(l,"px"),s[o]="var(".concat(c,")")}})),[s,hl(r,t,{scope:null===i||void 0===i?void 0:i.scope})]},ul=mo()?e.useLayoutEffect:e.useEffect,dl=function(t,i){var r=e.useRef(!0);ul((function(){return t(r.current)}),i),ul((function(){return r.current=!1,function(){r.current=!0}}),[])};const _l=dl;var pl=po({},t).useInsertionEffect;const fl=pl?function(e,t,i){return pl((function(){return e(),t()}),i)}:function(t,i,r){e.useMemo(t,r),_l((function(){return i(!0)}),r)};const gl="undefined"!==typeof po({},t).useInsertionEffect?function(t){var i=[],r=!1;return e.useEffect((function(){return r=!1,function(){r=!0,i.length&&i.forEach((function(e){return e()}))}}),t),function(e){r||i.push(e)}}:function(){return function(e){e()}};const ml=function(){return!1};function bl(t,i,r,s,n){var a=e.useContext(Yo).cache,o=Vo([t].concat(fo(i))),l=gl([o]),h=(ml(),function(e){a.opUpdate(o,(function(t){var i=ho(t||[void 0,void 0],2),s=i[0];var n=[void 0===s?0:s,i[1]||r()];return e?e(n):n}))});e.useMemo((function(){h()}),[o]);var c=a.opGet(o)[1];return fl((function(){null===n||void 0===n||n(c)}),(function(e){return h((function(t){var i=ho(t,2),r=i[0],s=i[1];return e&&0===r&&(null===n||void 0===n||n(c)),[r+1,s]})),function(){a.opUpdate(o,(function(t){var i=ho(t||[],2),r=i[0],n=void 0===r?0:r,h=i[1];return 0===n-1?(l((function(){!e&&a.opGet(o)||null===s||void 0===s||s(h,!1)})),null):[n-1,h]}))}}),[o]),c}var vl={},yl="css",Tl=new Map;var xl=0;function Al(e,t){Tl.set(e,(Tl.get(e)||0)-1);var i=Array.from(Tl.keys()),r=i.filter((function(e){return(Tl.get(e)||0)<=0}));i.length-r.length>xl&&r.forEach((function(e){!function(e,t){"undefined"!==typeof document&&document.querySelectorAll("style[".concat(Ho,'="').concat(e,'"]')).forEach((function(e){var i;e[qo]===t&&(null===(i=e.parentNode)||void 0===i||i.removeChild(e))}))}(e,t),Tl.delete(e)}))}var Cl=function(e,t,i,r){var s=po(po({},i.getDerivativeToken(e)),t);return r&&(s=r(s)),s},Rl="token";function El(t,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=(0,e.useContext)(Yo),n=s.cache.instanceId,a=s.container,o=r.salt,l=void 0===o?"":o,h=r.override,c=void 0===h?vl:h,u=r.formatToken,d=r.getComputedToken,_=r.cssVar,p=function(e,t){for(var i=el,r=0;r<t.length;r+=1){var s=t[r];i.has(s)||i.set(s,new WeakMap),i=i.get(s)}return i.has(tl)||i.set(tl,e()),i.get(tl)}((function(){return Object.assign.apply(Object,[{}].concat(fo(i)))}),i),f=rl(p),g=rl(c),m=_?rl(_):"",b=bl(Rl,[l,t.id,f,g,m],(function(){var e,i=d?d(p,c,t):Cl(p,c,t,u),r=po({},i),s="";if(_){var n=ho(cl(i,_.key,{prefix:_.prefix,ignore:_.ignore,unitless:_.unitless,preserve:_.preserve}),2);i=n[0],s=n[1]}var a=sl(i,l);i._tokenKey=a,r._tokenKey=sl(r,l);var o=null!==(e=null===_||void 0===_?void 0:_.key)&&void 0!==e?e:a;i._themeKey=o,function(e){Tl.set(e,(Tl.get(e)||0)+1)}(o);var h="".concat(yl,"-").concat(go(a));return i._hashId=h,[i,h,r,s,(null===_||void 0===_?void 0:_.key)||""]}),(function(e){Al(e[0]._themeKey,n)}),(function(e){var t=ho(e,4),i=t[0],r=t[3];if(_&&r){var s=Mo(r,go("css-variables-".concat(i._themeKey)),{mark:Wo,prepend:"queue",attachTo:a,priority:-999});s[qo]=n,s.setAttribute(Ho,i._themeKey)}}));return b}function Sl(){return Sl=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)({}).hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},Sl.apply(null,arguments)}const Ml={animationIterationCount:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1};var Pl="comm",Il="rule",Ol="decl",Dl="@import",wl="@keyframes",Fl="@layer",Ll=Math.abs,Bl=String.fromCharCode;Object.assign;function Nl(e){return e.trim()}function kl(e,t,i){return e.replace(t,i)}function Ul(e,t,i){return e.indexOf(t,i)}function Vl(e,t){return 0|e.charCodeAt(t)}function zl(e,t,i){return e.slice(t,i)}function Gl(e){return e.length}function Hl(e,t){return t.push(e),e}function Wl(e,t){for(var i="",r=0;r<e.length;r++)i+=t(e[r],r,e,t)||"";return i}function ql(e,t,i,r){switch(e.type){case Fl:if(e.children.length)break;case Dl:case Ol:return e.return=e.return||e.value;case Pl:return"";case wl:return e.return=e.value+"{"+Wl(e.children,r)+"}";case Il:if(!Gl(e.value=e.props.join(",")))return""}return Gl(i=Wl(e.children,r))?e.return=e.value+"{"+i+"}":""}var Xl=1,Kl=1,Yl=0,jl=0,Ql=0,$l="";function Zl(e,t,i,r,s,n,a,o){return{value:e,root:t,parent:i,type:r,props:s,children:n,line:Xl,column:Kl,length:a,return:"",siblings:o}}function Jl(){return Ql=jl>0?Vl($l,--jl):0,Kl--,10===Ql&&(Kl=1,Xl--),Ql}function eh(){return Ql=jl<Yl?Vl($l,jl++):0,Kl++,10===Ql&&(Kl=1,Xl++),Ql}function th(){return Vl($l,jl)}function ih(){return jl}function rh(e,t){return zl($l,e,t)}function sh(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function nh(e){return Xl=Kl=1,Yl=Gl($l=e),jl=0,[]}function ah(e){return $l="",e}function oh(e){return Nl(rh(jl-1,ch(91===e?e+2:40===e?e+1:e)))}function lh(e){for(;(Ql=th())&&Ql<33;)eh();return sh(e)>2||sh(Ql)>3?"":" "}function hh(e,t){for(;--t&&eh()&&!(Ql<48||Ql>102||Ql>57&&Ql<65||Ql>70&&Ql<97););return rh(e,ih()+(t<6&&32==th()&&32==eh()))}function ch(e){for(;eh();)switch(Ql){case e:return jl;case 34:case 39:34!==e&&39!==e&&ch(Ql);break;case 40:41===e&&ch(e);break;case 92:eh()}return jl}function uh(e,t){for(;eh()&&e+Ql!==57&&(e+Ql!==84||47!==th()););return"/*"+rh(t,jl-1)+"*"+Bl(47===e?e:eh())}function dh(e){for(;!sh(th());)eh();return rh(e,jl)}function _h(e){return ah(ph("",null,null,null,[""],e=nh(e),0,[0],e))}function ph(e,t,i,r,s,n,a,o,l){for(var h=0,c=0,u=a,d=0,_=0,p=0,f=1,g=1,m=1,b=0,v="",y=s,T=n,x=r,A=v;g;)switch(p=b,b=eh()){case 40:if(108!=p&&58==Vl(A,u-1)){-1!=Ul(A+=kl(oh(b),"&","&\f"),"&\f",Ll(h?o[h-1]:0))&&(m=-1);break}case 34:case 39:case 91:A+=oh(b);break;case 9:case 10:case 13:case 32:A+=lh(p);break;case 92:A+=hh(ih()-1,7);continue;case 47:switch(th()){case 42:case 47:Hl(gh(uh(eh(),ih()),t,i,l),l),5!=sh(p||1)&&5!=sh(th()||1)||!Gl(A)||" "===zl(A,-1,void 0)||(A+=" ");break;default:A+="/"}break;case 123*f:o[h++]=Gl(A)*m;case 125*f:case 59:case 0:switch(b){case 0:case 125:g=0;case 59+c:-1==m&&(A=kl(A,/\f/g,"")),_>0&&(Gl(A)-u||0===f&&47===p)&&Hl(_>32?mh(A+";",r,i,u-1,l):mh(kl(A," ","")+";",r,i,u-2,l),l);break;case 59:A+=";";default:if(Hl(x=fh(A,t,i,h,c,s,o,v,y=[],T=[],u,n),n),123===b)if(0===c)ph(A,t,x,x,y,n,u,o,T);else switch(99===d&&110===Vl(A,3)?100:d){case 100:case 108:case 109:case 115:ph(e,x,x,r&&Hl(fh(e,x,x,0,0,s,o,v,s,y=[],u,T),T),s,T,u,o,r?y:T);break;default:ph(A,x,x,x,[""],T,0,o,T)}}h=c=_=0,f=m=1,v=A="",u=a;break;case 58:u=1+Gl(A),_=p;default:if(f<1)if(123==b)--f;else if(125==b&&0==f++&&125==Jl())continue;switch(A+=Bl(b),b*f){case 38:m=c>0?1:(A+="\f",-1);break;case 44:o[h++]=(Gl(A)-1)*m,m=1;break;case 64:45===th()&&(A+=oh(eh())),d=th(),c=u=Gl(v=A+=dh(ih())),b++;break;case 45:45===p&&2==Gl(A)&&(f=0)}}return n}function fh(e,t,i,r,s,n,a,o,l,h,c,u){for(var d=s-1,_=0===s?n:[""],p=function(e){return e.length}(_),f=0,g=0,m=0;f<r;++f)for(var b=0,v=zl(e,d+1,d=Ll(g=a[f])),y=e;b<p;++b)(y=Nl(g>0?_[b]+" "+v:kl(v,/&\f/g,_[b])))&&(l[m++]=y);return Zl(e,t,i,0===s?Il:o,l,h,c,u)}function gh(e,t,i,r){return Zl(e,t,i,Pl,Bl(Ql),zl(e,2,-2),0,r)}function mh(e,t,i,r,s){return Zl(e,t,i,Ol,zl(e,0,r),zl(e,r+1,-1),r,s)}var bh,vh="data-ant-cssinjs-cache-path",yh="_FILE_STYLE__";var Th=!0;function xh(e){return function(){if(!bh&&(bh={},mo())){var e=document.createElement("div");e.className=vh,e.style.position="fixed",e.style.visibility="hidden",e.style.top="-9999px",document.body.appendChild(e);var t=getComputedStyle(e).content||"";(t=t.replace(/^"/,"").replace(/"$/,"")).split(";").forEach((function(e){var t=ho(e.split(":"),2),i=t[0],r=t[1];bh[i]=r}));var i,r=document.querySelector("style[".concat(vh,"]"));r&&(Th=!1,null===(i=r.parentNode)||void 0===i||i.removeChild(r)),document.body.removeChild(e)}}(),!!bh[e]}var Ah="_multi_value_";function Ch(e){return Wl(_h(e),ql).replace(/\{%%%\:[^;];}/g,";")}function Rh(e,t,i){if(!t)return e;var r=".".concat(t),s="low"===i?":where(".concat(r,")"):r;return e.split(",").map((function(e){var t,i=e.trim().split(/\s+/),r=i[0]||"",n=(null===(t=r.match(/^\w+/))||void 0===t?void 0:t[0])||"";return[r="".concat(n).concat(s).concat(r.slice(n.length))].concat(fo(i.slice(1))).join(" ")})).join(",")}var Eh=function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{root:!0,parentSelectors:[]},s=r.root,n=r.injectHash,a=r.parentSelectors,o=i.hashId,l=i.layer,h=(i.path,i.hashPriority),c=i.transformers,u=void 0===c?[]:c,d=(i.linters,""),_={};function p(t){var r=t.getName(o);if(!_[r]){var s=ho(e(t.style,i,{root:!1,parentSelectors:a}),1)[0];_[r]="@keyframes ".concat(t.getName(o)).concat(s)}}var f=function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t.forEach((function(t){Array.isArray(t)?e(t,i):t&&i.push(t)})),i}(Array.isArray(t)?t:[t]);return f.forEach((function(t){var r="string"!==typeof t||s?t:{};if("string"===typeof r)d+="".concat(r,"\n");else if(r._keyframe)p(r);else{var l=u.reduce((function(e,t){var i;return(null===t||void 0===t||null===(i=t.visit)||void 0===i?void 0:i.call(t,e))||e}),r);Object.keys(l).forEach((function(t){var r=l[t];if("object"!==Qa(r)||!r||"animationName"===t&&r._keyframe||function(e){return"object"===Qa(e)&&e&&("_skip_check_"in e||Ah in e)}(r)){var c;function T(e,t){var i=e.replace(/[A-Z]/g,(function(e){return"-".concat(e.toLowerCase())})),r=t;Ml[e]||"number"!==typeof r||0===r||(r="".concat(r,"px")),"animationName"===e&&null!==t&&void 0!==t&&t._keyframe&&(p(t),r=t.getName(o)),d+="".concat(i,":").concat(r,";")}var u=null!==(c=null===r||void 0===r?void 0:r.value)&&void 0!==c?c:r;"object"===Qa(r)&&null!==r&&void 0!==r&&r[Ah]&&Array.isArray(u)?u.forEach((function(e){T(t,e)})):T(t,u)}else{var f=!1,g=t.trim(),m=!1;(s||n)&&o?g.startsWith("@")?f=!0:g=Rh("&"===g?"":t,o,h):!s||o||"&"!==g&&""!==g||(g="",m=!0);var b=ho(e(r,i,{root:m,injectHash:f,parentSelectors:[].concat(fo(a),[g])}),2),v=b[0],y=b[1];_=po(po({},_),y),d+="".concat(g).concat(v)}}))}})),s?l&&(d="@layer ".concat(l.name," {").concat(d,"}"),l.dependencies&&(_["@layer ".concat(l.name)]=l.dependencies.map((function(e){return"@layer ".concat(e,", ").concat(l.name,";")})).join("\n"))):d="{".concat(d,"}"),[d,_]};function Sh(e,t){return go("".concat(e.join("%")).concat(t))}function Mh(){return null}var Ph="style";function Ih(t,i){var r=t.token,s=t.path,n=t.hashId,a=t.layer,o=t.nonce,l=t.clientOnly,h=t.order,c=void 0===h?0:h,u=e.useContext(Yo),d=u.autoClear,_=(u.mock,u.defaultCache),p=u.hashPriority,f=u.container,g=u.ssrInline,m=u.transformers,b=u.linters,v=u.cache,y=u.layer,T=r._tokenKey,x=[T];y&&x.push("layer"),x.push.apply(x,fo(s));var A=nl;var C=bl(Ph,x,(function(){var e=x.join("|");if(xh(e)){var t=function(e){var t=bh[e],i=null;if(t&&mo())if(Th)i=yh;else{var r=document.querySelector("style[".concat(Wo,'="').concat(bh[e],'"]'));r?i=r.innerHTML:delete bh[e]}return[i,t]}(e),r=ho(t,2),o=r[0],h=r[1];if(o)return[o,T,h,{},l,c]}var u=i(),d=ho(Eh(u,{hashId:n,hashPriority:p,layer:y?a:void 0,path:s.join("-"),transformers:m,linters:b}),2),_=d[0],f=d[1],g=Ch(_),v=Sh(x,g);return[g,T,v,f,l,c]}),(function(e,t){var i=ho(e,3)[2];(t||d)&&nl&&So(i,{mark:Wo})}),(function(e){var t=ho(e,4),i=t[0],r=(t[1],t[2]),s=t[3];if(A&&i!==yh){var n={mark:Wo,prepend:!y&&"queue",attachTo:f,priority:c},a="function"===typeof o?o():o;a&&(n.csp={nonce:a});var l=[],h=[];Object.keys(s).forEach((function(e){e.startsWith("@layer")?l.push(e):h.push(e)})),l.forEach((function(e){Mo(Ch(s[e]),"_layer-".concat(e),po(po({},n),{},{prepend:!0}))}));var u=Mo(i,r,n);u[qo]=v.instanceId,u.setAttribute(Ho,T),h.forEach((function(e){Mo(Ch(s[e]),"_effect-".concat(e),n)}))}})),R=ho(C,3),E=R[0],S=R[1],M=R[2];return function(t){var i;return i=g&&!A&&_?e.createElement("style",Sl({},uo(uo({},Ho,S),Wo,M),{dangerouslySetInnerHTML:{__html:E}})):e.createElement(Mh,null),e.createElement(e.Fragment,null,i,t)}}var Oh="cssVar";const Dh=function(t,i){var r=t.key,s=t.prefix,n=t.unitless,a=t.ignore,o=t.token,l=t.scope,h=void 0===l?"":l,c=(0,e.useContext)(Yo),u=c.cache.instanceId,d=c.container,_=o._tokenKey,p=[].concat(fo(t.path),[r,h,_]),f=bl(Oh,p,(function(){var e=i(),t=ho(cl(e,r,{prefix:s,unitless:n,ignore:a,scope:h}),2),o=t[0],l=t[1];return[o,l,Sh(p,l),r]}),(function(e){var t=ho(e,3)[2];nl&&So(t,{mark:Wo})}),(function(e){var t=ho(e,3),i=t[1],s=t[2];if(i){var n=Mo(i,s,{mark:Wo,prepend:"queue",attachTo:d,priority:-999});n[qo]=u,n.setAttribute(Ho,r)}}));return f};uo(uo(uo({},Ph,(function(e,t,i){var r=ho(e,6),s=r[0],n=r[1],a=r[2],o=r[3],l=r[4],h=r[5],c=(i||{}).plain;if(l)return null;var u=s,d={"data-rc-order":"prependQueue","data-rc-priority":"".concat(h)};return u=ol(s,n,a,d,c),o&&Object.keys(o).forEach((function(e){if(!t[e]){t[e]=!0;var i=ol(Ch(o[e]),n,"_effect-".concat(e),d,c);e.startsWith("@layer")?u=i+u:u+=i}})),[h,a,u]})),Rl,(function(e,t,i){var r=ho(e,5),s=r[2],n=r[3],a=r[4],o=(i||{}).plain;if(!n)return null;var l=s._tokenKey;return[-999,l,ol(n,a,l,{"data-rc-order":"prependQueue","data-rc-priority":"".concat(-999)},o)]})),Oh,(function(e,t,i){var r=ho(e,4),s=r[1],n=r[2],a=r[3],o=(i||{}).plain;if(!s)return null;return[-999,n,ol(s,a,n,{"data-rc-order":"prependQueue","data-rc-priority":"".concat(-999)},o)]}));function wh(e){return e.notSplit=!0,e}wh(["borderTop","borderBottom"]),wh(["borderTop"]),wh(["borderBottom"]),wh(["borderLeft","borderRight"]),wh(["borderLeft"]),wh(["borderRight"]);function Fh(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Lh(e,t){return Lh=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Lh(e,t)}function Bh(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Lh(e,t)}function Nh(e){return Nh=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Nh(e)}function kh(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(kh=function(){return!!e})()}function Uh(e){var t=kh();return function(){var i,r=Nh(e);if(t){var s=Nh(this).constructor;i=Reflect.construct(r,arguments,s)}else i=r.apply(this,arguments);return function(e,t){if(t&&("object"==Qa(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Fh(e)}(this,i)}}const Vh=ko((function e(){Bo(this,e)}));var zh="CALC_UNIT",Gh=new RegExp(zh,"g");function Hh(e){return"number"===typeof e?"".concat(e).concat(zh):e}var Wh=function(e){Bh(i,e);var t=Uh(i);function i(e,r){var s;Bo(this,i),uo(Fh(s=t.call(this)),"result",""),uo(Fh(s),"unitlessCssVar",void 0),uo(Fh(s),"lowPriority",void 0);var n=Qa(e);return s.unitlessCssVar=r,e instanceof i?s.result="(".concat(e.result,")"):"number"===n?s.result=Hh(e):"string"===n&&(s.result=e),s}return ko(i,[{key:"add",value:function(e){return e instanceof i?this.result="".concat(this.result," + ").concat(e.getResult()):"number"!==typeof e&&"string"!==typeof e||(this.result="".concat(this.result," + ").concat(Hh(e))),this.lowPriority=!0,this}},{key:"sub",value:function(e){return e instanceof i?this.result="".concat(this.result," - ").concat(e.getResult()):"number"!==typeof e&&"string"!==typeof e||(this.result="".concat(this.result," - ").concat(Hh(e))),this.lowPriority=!0,this}},{key:"mul",value:function(e){return this.lowPriority&&(this.result="(".concat(this.result,")")),e instanceof i?this.result="".concat(this.result," * ").concat(e.getResult(!0)):"number"!==typeof e&&"string"!==typeof e||(this.result="".concat(this.result," * ").concat(e)),this.lowPriority=!1,this}},{key:"div",value:function(e){return this.lowPriority&&(this.result="(".concat(this.result,")")),e instanceof i?this.result="".concat(this.result," / ").concat(e.getResult(!0)):"number"!==typeof e&&"string"!==typeof e||(this.result="".concat(this.result," / ").concat(e)),this.lowPriority=!1,this}},{key:"getResult",value:function(e){return this.lowPriority||e?"(".concat(this.result,")"):this.result}},{key:"equal",value:function(e){var t=this,i=(e||{}).unit,r=!0;return"boolean"===typeof i?r=i:Array.from(this.unitlessCssVar).some((function(e){return t.result.includes(e)}))&&(r=!1),this.result=this.result.replace(Gh,r?"px":""),"undefined"!==typeof this.lowPriority?"calc(".concat(this.result,")"):this.result}}]),i}(Vh),qh=function(e){Bh(i,e);var t=Uh(i);function i(e){var r;return Bo(this,i),uo(Fh(r=t.call(this)),"result",0),e instanceof i?r.result=e.result:"number"===typeof e&&(r.result=e),r}return ko(i,[{key:"add",value:function(e){return e instanceof i?this.result+=e.result:"number"===typeof e&&(this.result+=e),this}},{key:"sub",value:function(e){return e instanceof i?this.result-=e.result:"number"===typeof e&&(this.result-=e),this}},{key:"mul",value:function(e){return e instanceof i?this.result*=e.result:"number"===typeof e&&(this.result*=e),this}},{key:"div",value:function(e){return e instanceof i?this.result/=e.result:"number"===typeof e&&(this.result/=e),this}},{key:"equal",value:function(){return this.result}}]),i}(Vh);const Xh=function(e,t){var i="css"===e?Wh:qh;return function(e){return new i(e,t)}};const Kh=function(e,t){return"".concat([t,e.replace(/([A-Z]+)([A-Z][a-z]+)/g,"$1-$2").replace(/([a-z])([A-Z])/g,"$1-$2")].filter(Boolean).join("-"))};function Yh(t){var i=e.useRef();i.current=t;var r=e.useCallback((function(){for(var e,t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return null===(e=i.current)||void 0===e?void 0:e.call.apply(e,[i].concat(r))}),[]);return r}function jh(t){var i=e.useRef(!1),r=ho(e.useState(t),2),s=r[0],n=r[1];return e.useEffect((function(){return i.current=!1,function(){i.current=!0}}),[]),[s,function(e,t){t&&i.current||n(e)}]}"undefined"===typeof Reflect?Object.keys:Reflect.ownKeys;function Qh(e,t,i,r){var s=po({},t[e]);null!==r&&void 0!==r&&r.deprecatedTokens&&r.deprecatedTokens.forEach((function(e){var t,i=ho(e,2),r=i[0],n=i[1];(null!==s&&void 0!==s&&s[r]||null!==s&&void 0!==s&&s[n])&&(null!==(t=s[n])&&void 0!==t||(s[n]=null===s||void 0===s?void 0:s[r]))}));var n=po(po({},i),s);return Object.keys(n).forEach((function(e){n[e]===t[e]&&delete n[e]})),n}var $h="undefined"!==typeof CSSINJS_STATISTIC,Zh=!0;function Jh(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];if(!$h)return Object.assign.apply(Object,[{}].concat(t));Zh=!1;var r={};return t.forEach((function(e){"object"===Qa(e)&&Object.keys(e).forEach((function(t){Object.defineProperty(r,t,{configurable:!0,enumerable:!0,get:function(){return e[t]}})}))})),Zh=!0,r}var ec={};function tc(){}const ic=function(e){var t,i=e,r=tc;return $h&&"undefined"!==typeof Proxy&&(t=new Set,i=new Proxy(e,{get:function(e,i){return Zh&&t.add(i),e[i]}}),r=function(e,i){var r;ec[e]={global:Array.from(t),component:po(po({},null===(r=ec[e])||void 0===r?void 0:r.component),i)}}),{token:i,keys:t,flush:r}};function rc(e,t,i){var r;return"function"===typeof i?i(Jh(t,null!==(r=t[e])&&void 0!==r?r:{})):null!==i&&void 0!==i?i:{}}var sc=function(){function e(){Bo(this,e),uo(this,"map",new Map),uo(this,"objectIDMap",new WeakMap),uo(this,"nextID",0),uo(this,"lastAccessBeat",new Map),uo(this,"accessBeat",0)}return ko(e,[{key:"set",value:function(e,t){this.clear();var i=this.getCompositeKey(e);this.map.set(i,t),this.lastAccessBeat.set(i,Date.now())}},{key:"get",value:function(e){var t=this.getCompositeKey(e),i=this.map.get(t);return this.lastAccessBeat.set(t,Date.now()),this.accessBeat+=1,i}},{key:"getCompositeKey",value:function(e){var t=this;return e.map((function(e){return e&&"object"===Qa(e)?"obj_".concat(t.getObjectID(e)):"".concat(Qa(e),"_").concat(e)})).join("|")}},{key:"getObjectID",value:function(e){if(this.objectIDMap.has(e))return this.objectIDMap.get(e);var t=this.nextID;return this.objectIDMap.set(e,t),this.nextID+=1,t}},{key:"clear",value:function(){var e=this;if(this.accessBeat>1e4){var t=Date.now();this.lastAccessBeat.forEach((function(i,r){t-i>6e5&&(e.map.delete(r),e.lastAccessBeat.delete(r))})),this.accessBeat=0}}}]),e}(),nc=new sc;const ac=function(t,i){return e.useMemo((function(){var e=nc.get(i);if(e)return e;var r=t();return nc.set(i,r),r}),i)};const oc=function(){return{}};const lc=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{boxSizing:"border-box",margin:0,padding:0,color:e.colorText,fontSize:e.fontSize,lineHeight:e.lineHeight,listStyle:"none",fontFamily:t?"inherit":e.fontFamily}},hc=e=>({a:{color:e.colorLink,textDecoration:e.linkDecoration,backgroundColor:"transparent",outline:"none",cursor:"pointer",transition:`color ${e.motionDurationSlow}`,"-webkit-text-decoration-skip":"objects","&:hover":{color:e.colorLinkHover},"&:active":{color:e.colorLinkActive},"&:active, &:hover":{textDecoration:e.linkHoverDecoration,outline:0},"&:focus":{textDecoration:e.linkFocusDecoration,outline:0},"&[disabled]":{color:e.colorTextDisabled,cursor:"not-allowed"}}}),cc=e=>({outline:`${al(e.lineWidthFocus)} solid ${e.colorPrimaryBorder}`,outlineOffset:1,transition:"outline-offset 0s, outline 0s"}),uc=e=>({"&:focus-visible":Object.assign({},cc(e))});function dc(e,t){(function(e){return"string"===typeof e&&-1!==e.indexOf(".")&&1===parseFloat(e)})(e)&&(e="100%");var i=function(e){return"string"===typeof e&&-1!==e.indexOf("%")}(e);return e=360===t?e:Math.min(t,Math.max(0,parseFloat(e))),i&&(e=parseInt(String(e*t),10)/100),Math.abs(e-t)<1e-6?1:e=360===t?(e<0?e%t+t:e%t)/parseFloat(String(t)):e%t/parseFloat(String(t))}function _c(e){return Math.min(1,Math.max(0,e))}function pc(e){return e=parseFloat(e),(isNaN(e)||e<0||e>1)&&(e=1),e}function fc(e){return e<=1?"".concat(100*Number(e),"%"):e}function gc(e){return 1===e.length?"0"+e:String(e)}function mc(e,t,i){e=dc(e,255),t=dc(t,255),i=dc(i,255);var r=Math.max(e,t,i),s=Math.min(e,t,i),n=0,a=0,o=(r+s)/2;if(r===s)a=0,n=0;else{var l=r-s;switch(a=o>.5?l/(2-r-s):l/(r+s),r){case e:n=(t-i)/l+(t<i?6:0);break;case t:n=(i-e)/l+2;break;case i:n=(e-t)/l+4}n/=6}return{h:n,s:a,l:o}}function bc(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*i*(t-e):i<.5?t:i<2/3?e+(t-e)*(2/3-i)*6:e}function vc(e,t,i){e=dc(e,255),t=dc(t,255),i=dc(i,255);var r=Math.max(e,t,i),s=Math.min(e,t,i),n=0,a=r,o=r-s,l=0===r?0:o/r;if(r===s)n=0;else{switch(r){case e:n=(t-i)/o+(t<i?6:0);break;case t:n=(i-e)/o+2;break;case i:n=(e-t)/o+4}n/=6}return{h:n,s:l,v:a}}function yc(e,t,i,r){var s=[gc(Math.round(e).toString(16)),gc(Math.round(t).toString(16)),gc(Math.round(i).toString(16))];return r&&s[0].startsWith(s[0].charAt(1))&&s[1].startsWith(s[1].charAt(1))&&s[2].startsWith(s[2].charAt(1))?s[0].charAt(0)+s[1].charAt(0)+s[2].charAt(0):s.join("")}function Tc(e){return Math.round(255*parseFloat(e)).toString(16)}function xc(e){return Ac(e)/255}function Ac(e){return parseInt(e,16)}var Cc={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};function Rc(e){var t={r:0,g:0,b:0},i=1,r=null,s=null,n=null,a=!1,o=!1;return"string"===typeof e&&(e=function(e){if(e=e.trim().toLowerCase(),0===e.length)return!1;var t=!1;if(Cc[e])e=Cc[e],t=!0;else if("transparent"===e)return{r:0,g:0,b:0,a:0,format:"name"};var i=Pc.rgb.exec(e);if(i)return{r:i[1],g:i[2],b:i[3]};if(i=Pc.rgba.exec(e),i)return{r:i[1],g:i[2],b:i[3],a:i[4]};if(i=Pc.hsl.exec(e),i)return{h:i[1],s:i[2],l:i[3]};if(i=Pc.hsla.exec(e),i)return{h:i[1],s:i[2],l:i[3],a:i[4]};if(i=Pc.hsv.exec(e),i)return{h:i[1],s:i[2],v:i[3]};if(i=Pc.hsva.exec(e),i)return{h:i[1],s:i[2],v:i[3],a:i[4]};if(i=Pc.hex8.exec(e),i)return{r:Ac(i[1]),g:Ac(i[2]),b:Ac(i[3]),a:xc(i[4]),format:t?"name":"hex8"};if(i=Pc.hex6.exec(e),i)return{r:Ac(i[1]),g:Ac(i[2]),b:Ac(i[3]),format:t?"name":"hex"};if(i=Pc.hex4.exec(e),i)return{r:Ac(i[1]+i[1]),g:Ac(i[2]+i[2]),b:Ac(i[3]+i[3]),a:xc(i[4]+i[4]),format:t?"name":"hex8"};if(i=Pc.hex3.exec(e),i)return{r:Ac(i[1]+i[1]),g:Ac(i[2]+i[2]),b:Ac(i[3]+i[3]),format:t?"name":"hex"};return!1}(e)),"object"===typeof e&&(Ic(e.r)&&Ic(e.g)&&Ic(e.b)?(t=function(e,t,i){return{r:255*dc(e,255),g:255*dc(t,255),b:255*dc(i,255)}}(e.r,e.g,e.b),a=!0,o="%"===String(e.r).substr(-1)?"prgb":"rgb"):Ic(e.h)&&Ic(e.s)&&Ic(e.v)?(r=fc(e.s),s=fc(e.v),t=function(e,t,i){e=6*dc(e,360),t=dc(t,100),i=dc(i,100);var r=Math.floor(e),s=e-r,n=i*(1-t),a=i*(1-s*t),o=i*(1-(1-s)*t),l=r%6;return{r:255*[i,a,n,n,o,i][l],g:255*[o,i,i,a,n,n][l],b:255*[n,n,o,i,i,a][l]}}(e.h,r,s),a=!0,o="hsv"):Ic(e.h)&&Ic(e.s)&&Ic(e.l)&&(r=fc(e.s),n=fc(e.l),t=function(e,t,i){var r,s,n;if(e=dc(e,360),t=dc(t,100),i=dc(i,100),0===t)s=i,n=i,r=i;else{var a=i<.5?i*(1+t):i+t-i*t,o=2*i-a;r=bc(o,a,e+1/3),s=bc(o,a,e),n=bc(o,a,e-1/3)}return{r:255*r,g:255*s,b:255*n}}(e.h,r,n),a=!0,o="hsl"),Object.prototype.hasOwnProperty.call(e,"a")&&(i=e.a)),i=pc(i),{ok:a,format:e.format||o,r:Math.min(255,Math.max(t.r,0)),g:Math.min(255,Math.max(t.g,0)),b:Math.min(255,Math.max(t.b,0)),a:i}}var Ec="(?:".concat("[-\\+]?\\d*\\.\\d+%?",")|(?:").concat("[-\\+]?\\d+%?",")"),Sc="[\\s|\\(]+(".concat(Ec,")[,|\\s]+(").concat(Ec,")[,|\\s]+(").concat(Ec,")\\s*\\)?"),Mc="[\\s|\\(]+(".concat(Ec,")[,|\\s]+(").concat(Ec,")[,|\\s]+(").concat(Ec,")[,|\\s]+(").concat(Ec,")\\s*\\)?"),Pc={CSS_UNIT:new RegExp(Ec),rgb:new RegExp("rgb"+Sc),rgba:new RegExp("rgba"+Mc),hsl:new RegExp("hsl"+Sc),hsla:new RegExp("hsla"+Mc),hsv:new RegExp("hsv"+Sc),hsva:new RegExp("hsva"+Mc),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};function Ic(e){return Boolean(Pc.CSS_UNIT.exec(String(e)))}var Oc=2,Dc=.16,wc=.05,Fc=.05,Lc=.15,Bc=5,Nc=4,kc=[{index:7,opacity:.15},{index:6,opacity:.25},{index:5,opacity:.3},{index:5,opacity:.45},{index:5,opacity:.65},{index:5,opacity:.85},{index:4,opacity:.9},{index:3,opacity:.95},{index:2,opacity:.97},{index:1,opacity:.98}];function Uc(e){var t=vc(e.r,e.g,e.b);return{h:360*t.h,s:t.s,v:t.v}}function Vc(e){var t=e.r,i=e.g,r=e.b;return"#".concat(yc(t,i,r,!1))}function zc(e,t,i){var r;return(r=Math.round(e.h)>=60&&Math.round(e.h)<=240?i?Math.round(e.h)-Oc*t:Math.round(e.h)+Oc*t:i?Math.round(e.h)+Oc*t:Math.round(e.h)-Oc*t)<0?r+=360:r>=360&&(r-=360),r}function Gc(e,t,i){return 0===e.h&&0===e.s?e.s:((r=i?e.s-Dc*t:t===Nc?e.s+Dc:e.s+wc*t)>1&&(r=1),i&&t===Bc&&r>.1&&(r=.1),r<.06&&(r=.06),Number(r.toFixed(2)));var r}function Hc(e,t,i){var r;return(r=i?e.v+Fc*t:e.v-Lc*t)>1&&(r=1),Number(r.toFixed(2))}function Wc(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=[],r=Rc(e),s=Bc;s>0;s-=1){var n=Uc(r),a=Vc(Rc({h:zc(n,s,!0),s:Gc(n,s,!0),v:Hc(n,s,!0)}));i.push(a)}i.push(Vc(r));for(var o=1;o<=Nc;o+=1){var l=Uc(r),h=Vc(Rc({h:zc(l,o),s:Gc(l,o),v:Hc(l,o)}));i.push(h)}return"dark"===t.theme?kc.map((function(e){var r=e.index,s=e.opacity;return Vc(function(e,t,i){var r=i/100;return{r:(t.r-e.r)*r+e.r,g:(t.g-e.g)*r+e.g,b:(t.b-e.b)*r+e.b}}(Rc(t.backgroundColor||"#141414"),Rc(i[r]),100*s))})):i}var qc={red:"#F5222D",volcano:"#FA541C",orange:"#FA8C16",gold:"#FAAD14",yellow:"#FADB14",lime:"#A0D911",green:"#52C41A",cyan:"#13C2C2",blue:"#1677FF",geekblue:"#2F54EB",purple:"#722ED1",magenta:"#EB2F96",grey:"#666666"},Xc=["#fff1f0","#ffccc7","#ffa39e","#ff7875","#ff4d4f","#f5222d","#cf1322","#a8071a","#820014","#5c0011"];Xc.primary=Xc[5];var Kc=["#fff2e8","#ffd8bf","#ffbb96","#ff9c6e","#ff7a45","#fa541c","#d4380d","#ad2102","#871400","#610b00"];Kc.primary=Kc[5];var Yc=["#fff7e6","#ffe7ba","#ffd591","#ffc069","#ffa940","#fa8c16","#d46b08","#ad4e00","#873800","#612500"];Yc.primary=Yc[5];var jc=["#fffbe6","#fff1b8","#ffe58f","#ffd666","#ffc53d","#faad14","#d48806","#ad6800","#874d00","#613400"];jc.primary=jc[5];var Qc=["#feffe6","#ffffb8","#fffb8f","#fff566","#ffec3d","#fadb14","#d4b106","#ad8b00","#876800","#614700"];Qc.primary=Qc[5];var $c=["#fcffe6","#f4ffb8","#eaff8f","#d3f261","#bae637","#a0d911","#7cb305","#5b8c00","#3f6600","#254000"];$c.primary=$c[5];var Zc=["#f6ffed","#d9f7be","#b7eb8f","#95de64","#73d13d","#52c41a","#389e0d","#237804","#135200","#092b00"];Zc.primary=Zc[5];var Jc=["#e6fffb","#b5f5ec","#87e8de","#5cdbd3","#36cfc9","#13c2c2","#08979c","#006d75","#00474f","#002329"];Jc.primary=Jc[5];var eu=["#e6f4ff","#bae0ff","#91caff","#69b1ff","#4096ff","#1677ff","#0958d9","#003eb3","#002c8c","#001d66"];eu.primary=eu[5];var tu=["#f0f5ff","#d6e4ff","#adc6ff","#85a5ff","#597ef7","#2f54eb","#1d39c4","#10239e","#061178","#030852"];tu.primary=tu[5];var iu=["#f9f0ff","#efdbff","#d3adf7","#b37feb","#9254de","#722ed1","#531dab","#391085","#22075e","#120338"];iu.primary=iu[5];var ru=["#fff0f6","#ffd6e7","#ffadd2","#ff85c0","#f759ab","#eb2f96","#c41d7f","#9e1068","#780650","#520339"];ru.primary=ru[5];var su=["#a6a6a6","#999999","#8c8c8c","#808080","#737373","#666666","#404040","#1a1a1a","#000000","#000000"];su.primary=su[5];var nu={red:Xc,volcano:Kc,orange:Yc,gold:jc,yellow:Qc,lime:$c,green:Zc,cyan:Jc,blue:eu,geekblue:tu,purple:iu,magenta:ru,grey:su},au=["#2a1215","#431418","#58181c","#791a1f","#a61d24","#d32029","#e84749","#f37370","#f89f9a","#fac8c3"];au.primary=au[5];var ou=["#2b1611","#441d12","#592716","#7c3118","#aa3e19","#d84a1b","#e87040","#f3956a","#f8b692","#fad4bc"];ou.primary=ou[5];var lu=["#2b1d11","#442a11","#593815","#7c4a15","#aa6215","#d87a16","#e89a3c","#f3b765","#f8cf8d","#fae3b7"];lu.primary=lu[5];var hu=["#2b2111","#443111","#594214","#7c5914","#aa7714","#d89614","#e8b339","#f3cc62","#f8df8b","#faedb5"];hu.primary=hu[5];var cu=["#2b2611","#443b11","#595014","#7c6e14","#aa9514","#d8bd14","#e8d639","#f3ea62","#f8f48b","#fafab5"];cu.primary=cu[5];var uu=["#1f2611","#2e3c10","#3e4f13","#536d13","#6f9412","#8bbb11","#a9d134","#c9e75d","#e4f88b","#f0fab5"];uu.primary=uu[5];var du=["#162312","#1d3712","#274916","#306317","#3c8618","#49aa19","#6abe39","#8fd460","#b2e58b","#d5f2bb"];du.primary=du[5];var _u=["#112123","#113536","#144848","#146262","#138585","#13a8a8","#33bcb7","#58d1c9","#84e2d8","#b2f1e8"];_u.primary=_u[5];var pu=["#111a2c","#112545","#15325b","#15417e","#1554ad","#1668dc","#3c89e8","#65a9f3","#8dc5f8","#b7dcfa"];pu.primary=pu[5];var fu=["#131629","#161d40","#1c2755","#203175","#263ea0","#2b4acb","#5273e0","#7f9ef3","#a8c1f8","#d2e0fa"];fu.primary=fu[5];var gu=["#1a1325","#24163a","#301c4d","#3e2069","#51258f","#642ab5","#854eca","#ab7ae0","#cda8f0","#ebd7fa"];gu.primary=gu[5];var mu=["#291321","#40162f","#551c3b","#75204f","#a02669","#cb2b83","#e0529c","#f37fb7","#f8a8cc","#fad2e3"];mu.primary=mu[5];var bu=["#151515","#1f1f1f","#2d2d2d","#393939","#494949","#5a5a5a","#6a6a6a","#7b7b7b","#888888","#969696"];bu.primary=bu[5];const vu={blue:"#1677FF",purple:"#722ED1",cyan:"#13C2C2",green:"#52C41A",magenta:"#EB2F96",pink:"#EB2F96",red:"#F5222D",orange:"#FA8C16",yellow:"#FADB14",volcano:"#FA541C",geekblue:"#2F54EB",gold:"#FAAD14",lime:"#A0D911"},yu=Object.assign(Object.assign({},vu),{colorPrimary:"#1677ff",colorSuccess:"#52c41a",colorWarning:"#faad14",colorError:"#ff4d4f",colorInfo:"#1677ff",colorLink:"",colorTextBase:"",colorBgBase:"",fontFamily:"-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial,\n'Noto Sans', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol',\n'Noto Color Emoji'",fontFamilyCode:"'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace",fontSize:14,lineWidth:1,lineType:"solid",motionUnit:.1,motionBase:0,motionEaseOutCirc:"cubic-bezier(0.08, 0.82, 0.17, 1)",motionEaseInOutCirc:"cubic-bezier(0.78, 0.14, 0.15, 0.86)",motionEaseOut:"cubic-bezier(0.215, 0.61, 0.355, 1)",motionEaseInOut:"cubic-bezier(0.645, 0.045, 0.355, 1)",motionEaseOutBack:"cubic-bezier(0.12, 0.4, 0.29, 1.46)",motionEaseInBack:"cubic-bezier(0.71, -0.46, 0.88, 0.6)",motionEaseInQuint:"cubic-bezier(0.755, 0.05, 0.855, 0.06)",motionEaseOutQuint:"cubic-bezier(0.23, 1, 0.32, 1)",borderRadius:6,sizeUnit:4,sizeStep:4,sizePopupArrow:16,controlHeight:32,zIndexBase:0,zIndexPopupBase:1e3,opacityImage:1,wireframe:!1,motion:!0});var Tu=function(){function e(t,i){var r;if(void 0===t&&(t=""),void 0===i&&(i={}),t instanceof e)return t;"number"===typeof t&&(t=function(e){return{r:e>>16,g:(65280&e)>>8,b:255&e}}(t)),this.originalInput=t;var s=Rc(t);this.originalInput=t,this.r=s.r,this.g=s.g,this.b=s.b,this.a=s.a,this.roundA=Math.round(100*this.a)/100,this.format=null!==(r=i.format)&&void 0!==r?r:s.format,this.gradientType=i.gradientType,this.r<1&&(this.r=Math.round(this.r)),this.g<1&&(this.g=Math.round(this.g)),this.b<1&&(this.b=Math.round(this.b)),this.isValid=s.ok}return e.prototype.isDark=function(){return this.getBrightness()<128},e.prototype.isLight=function(){return!this.isDark()},e.prototype.getBrightness=function(){var e=this.toRgb();return(299*e.r+587*e.g+114*e.b)/1e3},e.prototype.getLuminance=function(){var e=this.toRgb(),t=e.r/255,i=e.g/255,r=e.b/255;return.2126*(t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4))+.7152*(i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4))+.0722*(r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4))},e.prototype.getAlpha=function(){return this.a},e.prototype.setAlpha=function(e){return this.a=pc(e),this.roundA=Math.round(100*this.a)/100,this},e.prototype.isMonochrome=function(){return 0===this.toHsl().s},e.prototype.toHsv=function(){var e=vc(this.r,this.g,this.b);return{h:360*e.h,s:e.s,v:e.v,a:this.a}},e.prototype.toHsvString=function(){var e=vc(this.r,this.g,this.b),t=Math.round(360*e.h),i=Math.round(100*e.s),r=Math.round(100*e.v);return 1===this.a?"hsv(".concat(t,", ").concat(i,"%, ").concat(r,"%)"):"hsva(".concat(t,", ").concat(i,"%, ").concat(r,"%, ").concat(this.roundA,")")},e.prototype.toHsl=function(){var e=mc(this.r,this.g,this.b);return{h:360*e.h,s:e.s,l:e.l,a:this.a}},e.prototype.toHslString=function(){var e=mc(this.r,this.g,this.b),t=Math.round(360*e.h),i=Math.round(100*e.s),r=Math.round(100*e.l);return 1===this.a?"hsl(".concat(t,", ").concat(i,"%, ").concat(r,"%)"):"hsla(".concat(t,", ").concat(i,"%, ").concat(r,"%, ").concat(this.roundA,")")},e.prototype.toHex=function(e){return void 0===e&&(e=!1),yc(this.r,this.g,this.b,e)},e.prototype.toHexString=function(e){return void 0===e&&(e=!1),"#"+this.toHex(e)},e.prototype.toHex8=function(e){return void 0===e&&(e=!1),function(e,t,i,r,s){var n=[gc(Math.round(e).toString(16)),gc(Math.round(t).toString(16)),gc(Math.round(i).toString(16)),gc(Tc(r))];return s&&n[0].startsWith(n[0].charAt(1))&&n[1].startsWith(n[1].charAt(1))&&n[2].startsWith(n[2].charAt(1))&&n[3].startsWith(n[3].charAt(1))?n[0].charAt(0)+n[1].charAt(0)+n[2].charAt(0)+n[3].charAt(0):n.join("")}(this.r,this.g,this.b,this.a,e)},e.prototype.toHex8String=function(e){return void 0===e&&(e=!1),"#"+this.toHex8(e)},e.prototype.toHexShortString=function(e){return void 0===e&&(e=!1),1===this.a?this.toHexString(e):this.toHex8String(e)},e.prototype.toRgb=function(){return{r:Math.round(this.r),g:Math.round(this.g),b:Math.round(this.b),a:this.a}},e.prototype.toRgbString=function(){var e=Math.round(this.r),t=Math.round(this.g),i=Math.round(this.b);return 1===this.a?"rgb(".concat(e,", ").concat(t,", ").concat(i,")"):"rgba(".concat(e,", ").concat(t,", ").concat(i,", ").concat(this.roundA,")")},e.prototype.toPercentageRgb=function(){var e=function(e){return"".concat(Math.round(100*dc(e,255)),"%")};return{r:e(this.r),g:e(this.g),b:e(this.b),a:this.a}},e.prototype.toPercentageRgbString=function(){var e=function(e){return Math.round(100*dc(e,255))};return 1===this.a?"rgb(".concat(e(this.r),"%, ").concat(e(this.g),"%, ").concat(e(this.b),"%)"):"rgba(".concat(e(this.r),"%, ").concat(e(this.g),"%, ").concat(e(this.b),"%, ").concat(this.roundA,")")},e.prototype.toName=function(){if(0===this.a)return"transparent";if(this.a<1)return!1;for(var e="#"+yc(this.r,this.g,this.b,!1),t=0,i=Object.entries(Cc);t<i.length;t++){var r=i[t],s=r[0];if(e===r[1])return s}return!1},e.prototype.toString=function(e){var t=Boolean(e);e=null!==e&&void 0!==e?e:this.format;var i=!1,r=this.a<1&&this.a>=0;return t||!r||!e.startsWith("hex")&&"name"!==e?("rgb"===e&&(i=this.toRgbString()),"prgb"===e&&(i=this.toPercentageRgbString()),"hex"!==e&&"hex6"!==e||(i=this.toHexString()),"hex3"===e&&(i=this.toHexString(!0)),"hex4"===e&&(i=this.toHex8String(!0)),"hex8"===e&&(i=this.toHex8String()),"name"===e&&(i=this.toName()),"hsl"===e&&(i=this.toHslString()),"hsv"===e&&(i=this.toHsvString()),i||this.toHexString()):"name"===e&&0===this.a?this.toName():this.toRgbString()},e.prototype.toNumber=function(){return(Math.round(this.r)<<16)+(Math.round(this.g)<<8)+Math.round(this.b)},e.prototype.clone=function(){return new e(this.toString())},e.prototype.lighten=function(t){void 0===t&&(t=10);var i=this.toHsl();return i.l+=t/100,i.l=_c(i.l),new e(i)},e.prototype.brighten=function(t){void 0===t&&(t=10);var i=this.toRgb();return i.r=Math.max(0,Math.min(255,i.r-Math.round(-t/100*255))),i.g=Math.max(0,Math.min(255,i.g-Math.round(-t/100*255))),i.b=Math.max(0,Math.min(255,i.b-Math.round(-t/100*255))),new e(i)},e.prototype.darken=function(t){void 0===t&&(t=10);var i=this.toHsl();return i.l-=t/100,i.l=_c(i.l),new e(i)},e.prototype.tint=function(e){return void 0===e&&(e=10),this.mix("white",e)},e.prototype.shade=function(e){return void 0===e&&(e=10),this.mix("black",e)},e.prototype.desaturate=function(t){void 0===t&&(t=10);var i=this.toHsl();return i.s-=t/100,i.s=_c(i.s),new e(i)},e.prototype.saturate=function(t){void 0===t&&(t=10);var i=this.toHsl();return i.s+=t/100,i.s=_c(i.s),new e(i)},e.prototype.greyscale=function(){return this.desaturate(100)},e.prototype.spin=function(t){var i=this.toHsl(),r=(i.h+t)%360;return i.h=r<0?360+r:r,new e(i)},e.prototype.mix=function(t,i){void 0===i&&(i=50);var r=this.toRgb(),s=new e(t).toRgb(),n=i/100;return new e({r:(s.r-r.r)*n+r.r,g:(s.g-r.g)*n+r.g,b:(s.b-r.b)*n+r.b,a:(s.a-r.a)*n+r.a})},e.prototype.analogous=function(t,i){void 0===t&&(t=6),void 0===i&&(i=30);var r=this.toHsl(),s=360/i,n=[this];for(r.h=(r.h-(s*t>>1)+720)%360;--t;)r.h=(r.h+s)%360,n.push(new e(r));return n},e.prototype.complement=function(){var t=this.toHsl();return t.h=(t.h+180)%360,new e(t)},e.prototype.monochromatic=function(t){void 0===t&&(t=6);for(var i=this.toHsv(),r=i.h,s=i.s,n=i.v,a=[],o=1/t;t--;)a.push(new e({h:r,s:s,v:n})),n=(n+o)%1;return a},e.prototype.splitcomplement=function(){var t=this.toHsl(),i=t.h;return[this,new e({h:(i+72)%360,s:t.s,l:t.l}),new e({h:(i+216)%360,s:t.s,l:t.l})]},e.prototype.onBackground=function(t){var i=this.toRgb(),r=new e(t).toRgb(),s=i.a+r.a*(1-i.a);return new e({r:(i.r*i.a+r.r*r.a*(1-i.a))/s,g:(i.g*i.a+r.g*r.a*(1-i.a))/s,b:(i.b*i.a+r.b*r.a*(1-i.a))/s,a:s})},e.prototype.triad=function(){return this.polyad(3)},e.prototype.tetrad=function(){return this.polyad(4)},e.prototype.polyad=function(t){for(var i=this.toHsl(),r=i.h,s=[this],n=360/t,a=1;a<t;a++)s.push(new e({h:(r+a*n)%360,s:i.s,l:i.l}));return s},e.prototype.equals=function(t){return this.toRgbString()===new e(t).toRgbString()},e}();const xu=e=>{let t=e,i=e,r=e,s=e;return e<6&&e>=5?t=e+1:e<16&&e>=6?t=e+2:e>=16&&(t=16),e<7&&e>=5?i=4:e<8&&e>=7?i=5:e<14&&e>=8?i=6:e<16&&e>=14?i=7:e>=16&&(i=8),e<6&&e>=2?r=1:e>=6&&(r=2),e>4&&e<8?s=4:e>=8&&(s=6),{borderRadius:e,borderRadiusXS:r,borderRadiusSM:i,borderRadiusLG:t,borderRadiusOuter:s}};const Au=e=>{const{controlHeight:t}=e;return{controlHeightSM:.75*t,controlHeightXS:.5*t,controlHeightLG:1.25*t}};function Cu(e){return(e+8)/e}const Ru=e=>{const t=function(e){const t=new Array(10).fill(null).map(((t,i)=>{const r=i-1,s=e*Math.pow(Math.E,r/5),n=i>1?Math.floor(s):Math.ceil(s);return 2*Math.floor(n/2)}));return t[1]=e,t.map((e=>({size:e,lineHeight:Cu(e)})))}(e),i=t.map((e=>e.size)),r=t.map((e=>e.lineHeight)),s=i[1],n=i[0],a=i[2],o=r[1],l=r[0],h=r[2];return{fontSizeSM:n,fontSize:s,fontSizeLG:a,fontSizeXL:i[3],fontSizeHeading1:i[6],fontSizeHeading2:i[5],fontSizeHeading3:i[4],fontSizeHeading4:i[3],fontSizeHeading5:i[2],lineHeight:o,lineHeightLG:h,lineHeightSM:l,fontHeight:Math.round(o*s),fontHeightLG:Math.round(h*a),fontHeightSM:Math.round(l*n),lineHeightHeading1:r[6],lineHeightHeading2:r[5],lineHeightHeading3:r[4],lineHeightHeading4:r[3],lineHeightHeading5:r[2]}};const Eu=(e,t)=>new Tu(e).setAlpha(t).toRgbString(),Su=(e,t)=>new Tu(e).darken(t).toHexString(),Mu=e=>{const t=Wc(e);return{1:t[0],2:t[1],3:t[2],4:t[3],5:t[4],6:t[5],7:t[6],8:t[4],9:t[5],10:t[6]}},Pu=(e,t)=>{const i=e||"#fff",r=t||"#000";return{colorBgBase:i,colorTextBase:r,colorText:Eu(r,.88),colorTextSecondary:Eu(r,.65),colorTextTertiary:Eu(r,.45),colorTextQuaternary:Eu(r,.25),colorFill:Eu(r,.15),colorFillSecondary:Eu(r,.06),colorFillTertiary:Eu(r,.04),colorFillQuaternary:Eu(r,.02),colorBgLayout:Su(i,4),colorBgContainer:Su(i,0),colorBgElevated:Su(i,0),colorBgSpotlight:Eu(r,.85),colorBgBlur:"transparent",colorBorder:Su(i,15),colorBorderSecondary:Su(i,6)}};const Iu=function(e){var t=Array.isArray(e)?e:[e];return Jo.has(t)||Jo.set(t,new Zo(t)),Jo.get(t)}((function(e){qc.pink=qc.magenta,nu.pink=nu.magenta;const t=Object.keys(vu).map((t=>{const i=e[t]===qc[t]?nu[t]:Wc(e[t]);return new Array(10).fill(1).reduce(((e,r,s)=>(e[`${t}-${s+1}`]=i[s],e[`${t}${s+1}`]=i[s],e)),{})})).reduce(((e,t)=>e=Object.assign(Object.assign({},e),t)),{});return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},e),t),function(e,t){let{generateColorPalettes:i,generateNeutralColorPalettes:r}=t;const{colorSuccess:s,colorWarning:n,colorError:a,colorInfo:o,colorPrimary:l,colorBgBase:h,colorTextBase:c}=e,u=i(l),d=i(s),_=i(n),p=i(a),f=i(o),g=r(h,c),m=i(e.colorLink||e.colorInfo);return Object.assign(Object.assign({},g),{colorPrimaryBg:u[1],colorPrimaryBgHover:u[2],colorPrimaryBorder:u[3],colorPrimaryBorderHover:u[4],colorPrimaryHover:u[5],colorPrimary:u[6],colorPrimaryActive:u[7],colorPrimaryTextHover:u[8],colorPrimaryText:u[9],colorPrimaryTextActive:u[10],colorSuccessBg:d[1],colorSuccessBgHover:d[2],colorSuccessBorder:d[3],colorSuccessBorderHover:d[4],colorSuccessHover:d[4],colorSuccess:d[6],colorSuccessActive:d[7],colorSuccessTextHover:d[8],colorSuccessText:d[9],colorSuccessTextActive:d[10],colorErrorBg:p[1],colorErrorBgHover:p[2],colorErrorBgActive:p[3],colorErrorBorder:p[3],colorErrorBorderHover:p[4],colorErrorHover:p[5],colorError:p[6],colorErrorActive:p[7],colorErrorTextHover:p[8],colorErrorText:p[9],colorErrorTextActive:p[10],colorWarningBg:_[1],colorWarningBgHover:_[2],colorWarningBorder:_[3],colorWarningBorderHover:_[4],colorWarningHover:_[4],colorWarning:_[6],colorWarningActive:_[7],colorWarningTextHover:_[8],colorWarningText:_[9],colorWarningTextActive:_[10],colorInfoBg:f[1],colorInfoBgHover:f[2],colorInfoBorder:f[3],colorInfoBorderHover:f[4],colorInfoHover:f[4],colorInfo:f[6],colorInfoActive:f[7],colorInfoTextHover:f[8],colorInfoText:f[9],colorInfoTextActive:f[10],colorLinkHover:m[4],colorLink:m[6],colorLinkActive:m[7],colorBgMask:new Tu("#000").setAlpha(.45).toRgbString(),colorWhite:"#fff"})}(e,{generateColorPalettes:Mu,generateNeutralColorPalettes:Pu})),Ru(e.fontSize)),function(e){const{sizeUnit:t,sizeStep:i}=e;return{sizeXXL:t*(i+8),sizeXL:t*(i+4),sizeLG:t*(i+2),sizeMD:t*(i+1),sizeMS:t*i,size:t*i,sizeSM:t*(i-1),sizeXS:t*(i-2),sizeXXS:t*(i-3)}}(e)),Au(e)),function(e){const{motionUnit:t,motionBase:i,borderRadius:r,lineWidth:s}=e;return Object.assign({motionDurationFast:`${(i+t).toFixed(1)}s`,motionDurationMid:`${(i+2*t).toFixed(1)}s`,motionDurationSlow:`${(i+3*t).toFixed(1)}s`,lineWidthBold:s+1},xu(r))}(e))})),Ou={token:yu,override:{override:yu},hashed:!0},Du=e.createContext(Ou);function wu(e){return e>=0&&e<=255}const Fu=function(e,t){const{r:i,g:r,b:s,a:n}=new Tu(e).toRgb();if(n<1)return e;const{r:a,g:o,b:l}=new Tu(t).toRgb();for(let h=.01;h<=1;h+=.01){const e=Math.round((i-a*(1-h))/h),t=Math.round((r-o*(1-h))/h),n=Math.round((s-l*(1-h))/h);if(wu(e)&&wu(t)&&wu(n))return new Tu({r:e,g:t,b:n,a:Math.round(100*h)/100}).toRgbString()}return new Tu({r:i,g:r,b:s,a:1}).toRgbString()};var Lu=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var s=0;for(r=Object.getOwnPropertySymbols(e);s<r.length;s++)t.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(i[r[s]]=e[r[s]])}return i};function Bu(e){const{override:t}=e,i=Lu(e,["override"]),r=Object.assign({},t);Object.keys(yu).forEach((e=>{delete r[e]}));const s=Object.assign(Object.assign({},i),r),n=1200,a=1600;if(!1===s.motion){const e="0s";s.motionDurationFast=e,s.motionDurationMid=e,s.motionDurationSlow=e}return Object.assign(Object.assign(Object.assign({},s),{colorFillContent:s.colorFillSecondary,colorFillContentHover:s.colorFill,colorFillAlter:s.colorFillQuaternary,colorBgContainerDisabled:s.colorFillTertiary,colorBorderBg:s.colorBgContainer,colorSplit:Fu(s.colorBorderSecondary,s.colorBgContainer),colorTextPlaceholder:s.colorTextQuaternary,colorTextDisabled:s.colorTextQuaternary,colorTextHeading:s.colorText,colorTextLabel:s.colorTextSecondary,colorTextDescription:s.colorTextTertiary,colorTextLightSolid:s.colorWhite,colorHighlight:s.colorError,colorBgTextHover:s.colorFillSecondary,colorBgTextActive:s.colorFill,colorIcon:s.colorTextTertiary,colorIconHover:s.colorText,colorErrorOutline:Fu(s.colorErrorBg,s.colorBgContainer),colorWarningOutline:Fu(s.colorWarningBg,s.colorBgContainer),fontSizeIcon:s.fontSizeSM,lineWidthFocus:4*s.lineWidth,lineWidth:s.lineWidth,controlOutlineWidth:2*s.lineWidth,controlInteractiveSize:s.controlHeight/2,controlItemBgHover:s.colorFillTertiary,controlItemBgActive:s.colorPrimaryBg,controlItemBgActiveHover:s.colorPrimaryBgHover,controlItemBgActiveDisabled:s.colorFill,controlTmpOutline:s.colorFillQuaternary,controlOutline:Fu(s.colorPrimaryBg,s.colorBgContainer),lineType:s.lineType,borderRadius:s.borderRadius,borderRadiusXS:s.borderRadiusXS,borderRadiusSM:s.borderRadiusSM,borderRadiusLG:s.borderRadiusLG,fontWeightStrong:600,opacityLoading:.65,linkDecoration:"none",linkHoverDecoration:"none",linkFocusDecoration:"none",controlPaddingHorizontal:12,controlPaddingHorizontalSM:8,paddingXXS:s.sizeXXS,paddingXS:s.sizeXS,paddingSM:s.sizeSM,padding:s.size,paddingMD:s.sizeMD,paddingLG:s.sizeLG,paddingXL:s.sizeXL,paddingContentHorizontalLG:s.sizeLG,paddingContentVerticalLG:s.sizeMS,paddingContentHorizontal:s.sizeMS,paddingContentVertical:s.sizeSM,paddingContentHorizontalSM:s.size,paddingContentVerticalSM:s.sizeXS,marginXXS:s.sizeXXS,marginXS:s.sizeXS,marginSM:s.sizeSM,margin:s.size,marginMD:s.sizeMD,marginLG:s.sizeLG,marginXL:s.sizeXL,marginXXL:s.sizeXXL,boxShadow:"\n      0 6px 16px 0 rgba(0, 0, 0, 0.08),\n      0 3px 6px -4px rgba(0, 0, 0, 0.12),\n      0 9px 28px 8px rgba(0, 0, 0, 0.05)\n    ",boxShadowSecondary:"\n      0 6px 16px 0 rgba(0, 0, 0, 0.08),\n      0 3px 6px -4px rgba(0, 0, 0, 0.12),\n      0 9px 28px 8px rgba(0, 0, 0, 0.05)\n    ",boxShadowTertiary:"\n      0 1px 2px 0 rgba(0, 0, 0, 0.03),\n      0 1px 6px -1px rgba(0, 0, 0, 0.02),\n      0 2px 4px 0 rgba(0, 0, 0, 0.02)\n    ",screenXS:480,screenXSMin:480,screenXSMax:575,screenSM:576,screenSMMin:576,screenSMMax:767,screenMD:768,screenMDMin:768,screenMDMax:991,screenLG:992,screenLGMin:992,screenLGMax:1199,screenXL:n,screenXLMin:n,screenXLMax:1599,screenXXL:a,screenXXLMin:a,boxShadowPopoverArrow:"2px 2px 5px rgba(0, 0, 0, 0.05)",boxShadowCard:`\n      0 1px 2px -2px ${new Tu("rgba(0, 0, 0, 0.16)").toRgbString()},\n      0 3px 6px 0 ${new Tu("rgba(0, 0, 0, 0.12)").toRgbString()},\n      0 5px 12px 4px ${new Tu("rgba(0, 0, 0, 0.09)").toRgbString()}\n    `,boxShadowDrawerRight:"\n      -6px 0 16px 0 rgba(0, 0, 0, 0.08),\n      -3px 0 6px -4px rgba(0, 0, 0, 0.12),\n      -9px 0 28px 8px rgba(0, 0, 0, 0.05)\n    ",boxShadowDrawerLeft:"\n      6px 0 16px 0 rgba(0, 0, 0, 0.08),\n      3px 0 6px -4px rgba(0, 0, 0, 0.12),\n      9px 0 28px 8px rgba(0, 0, 0, 0.05)\n    ",boxShadowDrawerUp:"\n      0 6px 16px 0 rgba(0, 0, 0, 0.08),\n      0 3px 6px -4px rgba(0, 0, 0, 0.12),\n      0 9px 28px 8px rgba(0, 0, 0, 0.05)\n    ",boxShadowDrawerDown:"\n      0 -6px 16px 0 rgba(0, 0, 0, 0.08),\n      0 -3px 6px -4px rgba(0, 0, 0, 0.12),\n      0 -9px 28px 8px rgba(0, 0, 0, 0.05)\n    ",boxShadowTabsOverflowLeft:"inset 10px 0 8px -8px rgba(0, 0, 0, 0.08)",boxShadowTabsOverflowRight:"inset -10px 0 8px -8px rgba(0, 0, 0, 0.08)",boxShadowTabsOverflowTop:"inset 0 10px 8px -8px rgba(0, 0, 0, 0.08)",boxShadowTabsOverflowBottom:"inset 0 -10px 8px -8px rgba(0, 0, 0, 0.08)"}),r)}var Nu=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var s=0;for(r=Object.getOwnPropertySymbols(e);s<r.length;s++)t.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(i[r[s]]=e[r[s]])}return i};const ku={lineHeight:!0,lineHeightSM:!0,lineHeightLG:!0,lineHeightHeading1:!0,lineHeightHeading2:!0,lineHeightHeading3:!0,lineHeightHeading4:!0,lineHeightHeading5:!0,opacityLoading:!0,fontWeightStrong:!0,zIndexPopupBase:!0,zIndexBase:!0,opacityImage:!0},Uu={size:!0,sizeSM:!0,sizeLG:!0,sizeMD:!0,sizeXS:!0,sizeXXS:!0,sizeMS:!0,sizeXL:!0,sizeXXL:!0,sizeUnit:!0,sizeStep:!0,motionBase:!0,motionUnit:!0},Vu={screenXS:!0,screenXSMin:!0,screenXSMax:!0,screenSM:!0,screenSMMin:!0,screenSMMax:!0,screenMD:!0,screenMDMin:!0,screenMDMax:!0,screenLG:!0,screenLGMin:!0,screenLGMax:!0,screenXL:!0,screenXLMin:!0,screenXLMax:!0,screenXXL:!0,screenXXLMin:!0},zu=(e,t,i)=>{const r=i.getDerivativeToken(e),{override:s}=t,n=Nu(t,["override"]);let a=Object.assign(Object.assign({},r),{override:s});return a=Bu(a),n&&Object.entries(n).forEach((e=>{let[t,i]=e;const{theme:r}=i,s=Nu(i,["theme"]);let n=s;r&&(n=zu(Object.assign(Object.assign({},a),s),{override:s},r)),a[t]=n})),a};function Gu(){const{token:t,hashed:i,theme:r,override:s,cssVar:n}=e.useContext(Du),a=`5.20.6-${i||""}`,o=r||Iu,[l,h,c]=El(o,[yu,t],{salt:a,override:s,getComputedToken:zu,formatToken:Bu,cssVar:n&&{prefix:n.prefix,key:n.key,unitless:ku,ignore:Uu,preserve:Vu}});return[o,c,i?h:"",l,n]}const Hu=(e,t)=>{const[i,r]=Gu();return Ih({theme:i,token:r,hashId:"",path:["ant-design-icons",e],nonce:()=>null===t||void 0===t?void 0:t.nonce,layer:{name:"antd"}},(()=>[{[`.${e}`]:Object.assign(Object.assign({},{display:"inline-flex",alignItems:"center",color:"inherit",fontStyle:"normal",lineHeight:0,textAlign:"center",textTransform:"none",verticalAlign:"-0.125em",textRendering:"optimizeLegibility","-webkit-font-smoothing":"antialiased","-moz-osx-font-smoothing":"grayscale","> *":{lineHeight:1},svg:{display:"inline-block"}}),{[`.${e} .${e}-icon`]:{display:"block"}})}]))},{genStyleHooks:Wu,genComponentStyleHook:qu,genSubStyleComponent:Xu}=function(t){var i=t.useCSP,r=void 0===i?oc:i,s=t.useToken,n=t.usePrefix,a=t.getResetStyles,o=t.getCommonStyle,l=t.getCompUnitless;function h(e,t,i){var l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},h=Array.isArray(e)?e:[e,e],c=ho(h,1)[0],u=h.join("-");return function(e){var h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,d=s(),_=d.theme,p=d.realToken,f=d.hashId,g=d.token,m=d.cssVar,b=n(),v=b.rootPrefixCls,y=b.iconPrefixCls,T=r(),x=m?"css":"js",A=ac((function(){var e=new Set;return m&&Object.keys(l.unitless||{}).forEach((function(t){e.add(ll(t,m.prefix)),e.add(ll(t,Kh(c,m.prefix)))})),Xh(x,e)}),[x,c,null===m||void 0===m?void 0:m.prefix]),C=function(e){return"js"===e?{max:Math.max,min:Math.min}:{max:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return"max(".concat(t.map((function(e){return al(e)})).join(","),")")},min:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return"min(".concat(t.map((function(e){return al(e)})).join(","),")")}}}(x),R=C.max,E=C.min,S={theme:_,token:g,hashId:f,nonce:function(){return T.nonce},clientOnly:l.clientOnly,layer:{name:"antd"},order:l.order||-999};return Ih(po(po({},S),{},{clientOnly:!1,path:["Shared",v]}),(function(){return"function"===typeof a?a(g):[]})),[Ih(po(po({},S),{},{path:[u,e,y]}),(function(){if(!1===l.injectStyle)return[];var r=ic(g),s=r.token,n=r.flush,a=rc(c,p,i),u=".".concat(e),d=Qh(c,p,a,{deprecatedTokens:l.deprecatedTokens});m&&"object"===Qa(a)&&Object.keys(a).forEach((function(e){a[e]="var(".concat(ll(e,Kh(c,m.prefix)),")")}));var _=Jh(s,{componentCls:u,prefixCls:e,iconCls:".".concat(y),antCls:".".concat(v),calc:A,max:R,min:E},m?a:d),b=t(_,{hashId:f,prefixCls:e,rootPrefixCls:v,iconPrefixCls:y});n(c,d);var T="function"===typeof o?o(_,e,h,l.resetFont):null;return[!1===l.resetStyle?null:T,b]})),f]}}return{genStyleHooks:function(t,i,r,n){var a=Array.isArray(t)?t[0]:t;function o(e){return"".concat(String(a)).concat(e.slice(0,1).toUpperCase()).concat(e.slice(1))}var c=(null===n||void 0===n?void 0:n.unitless)||{},u=po(po({},"function"===typeof l?l(t):{}),{},uo({},o("zIndexPopup"),!0));Object.keys(c).forEach((function(e){u[o(e)]=c[e]}));var d=po(po({},n),{},{unitless:u,prefixToken:o}),_=h(t,i,r,d),p=function(t,i,r){var n=r.unitless,a=r.injectStyle,o=void 0===a||a,l=r.prefixToken,h=r.ignore,c=function(e){var a=e.rootCls,o=e.cssVar,c=void 0===o?{}:o,u=s().realToken;return Dh({path:[t],prefix:c.prefix,key:c.key,unitless:n,ignore:h,token:u,scope:a},(function(){var e=rc(t,u,i),s=Qh(t,u,e,{deprecatedTokens:null===r||void 0===r?void 0:r.deprecatedTokens});return Object.keys(e).forEach((function(e){s[l(e)]=s[e],delete s[e]})),s})),null},u=function(i){var r=s().cssVar;return[function(s){return o&&r?e.createElement(e.Fragment,null,e.createElement(c,{rootCls:i,cssVar:r,component:t}),s):s},null===r||void 0===r?void 0:r.key]};return u}(a,r,d);return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,i=ho(_(e,t),2)[1],r=ho(p(t),2);return[r[0],i,r[1]]}},genSubStyleComponent:function(e,t,i){var r=h(e,t,i,po({resetStyle:!1,order:-998},arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}));return function(e){var t=e.prefixCls,i=e.rootCls;return r(t,void 0===i?t:i),null}},genComponentStyleHook:h}}({usePrefix:()=>{const{getPrefixCls:t,iconPrefixCls:i}=(0,e.useContext)(ro);return{rootPrefixCls:t(),iconPrefixCls:i}},useToken:()=>{const[e,t,i,r,s]=Gu();return{theme:e,realToken:t,hashId:i,token:r,cssVar:s}},useCSP:()=>{const{csp:t,iconPrefixCls:i}=(0,e.useContext)(ro);return Hu(i,t),null!==t&&void 0!==t?t:{}},getResetStyles:e=>[{"&":hc(e)}],getCommonStyle:(e,t,i,r)=>{const s=`[class^="${t}"], [class*=" ${t}"]`,n=i?`.${i}`:s,a={boxSizing:"border-box","&::before, &::after":{boxSizing:"border-box"}};let o={};return!1!==r&&(o={fontFamily:e.fontFamily,fontSize:e.fontSize}),{[n]:Object.assign(Object.assign(Object.assign({},o),a),{[s]:a})}},getCompUnitless:()=>ku}),Ku=e=>{const{componentCls:t,colorPrimary:i}=e;return{[t]:{position:"absolute",background:"transparent",pointerEvents:"none",boxSizing:"border-box",color:`var(--wave-color, ${i})`,boxShadow:"0 0 0 0 currentcolor",opacity:.2,"&.wave-motion-appear":{transition:[`box-shadow 0.4s ${e.motionEaseOutCirc}`,`opacity 2s ${e.motionEaseOutCirc}`].join(","),"&-active":{boxShadow:"0 0 0 6px currentcolor",opacity:0},"&.wave-quick":{transition:[`box-shadow ${e.motionDurationSlow} ${e.motionEaseInOut}`,`opacity ${e.motionDurationSlow} ${e.motionEaseInOut}`].join(",")}}}}},Yu=qu("Wave",(e=>[Ku(e)]));var ju=function(e){return+setTimeout(e,16)},Qu=function(e){return clearTimeout(e)};"undefined"!==typeof window&&"requestAnimationFrame"in window&&(ju=function(e){return window.requestAnimationFrame(e)},Qu=function(e){return window.cancelAnimationFrame(e)});var $u=0,Zu=new Map;function Ju(e){Zu.delete(e)}var ed=function(e){var t=$u+=1;return function i(r){if(0===r)Ju(t),e();else{var s=ju((function(){i(r-1)}));Zu.set(t,s)}}(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1),t};ed.cancel=function(e){var t=Zu.get(e);return Ju(e),Qu(t)};const td=ed,id=`${io}-wave-target`;var rd=i(7950),sd=i.t(rd,2);function nd(e){return e instanceof HTMLElement||e instanceof SVGElement}function ad(t){var i,r=function(e){return e&&"object"===Qa(e)&&nd(e.nativeElement)?e.nativeElement:nd(e)?e:null}(t);return r||(t instanceof e.Component?null===(i=rd.findDOMNode)||void 0===i?void 0:i.call(rd,t):null)}var od=e.createContext({});const ld=function(e){Bh(i,e);var t=Uh(i);function i(){return Bo(this,i),t.apply(this,arguments)}return ko(i,[{key:"render",value:function(){return this.props.children}}]),i}(e.Component);var hd="none",cd="appear",ud="enter",dd="leave",_d="none",pd="prepare",fd="start",gd="active",md="end",bd="prepared";function vd(e,t){var i={};return i[e.toLowerCase()]=t.toLowerCase(),i["Webkit".concat(e)]="webkit".concat(t),i["Moz".concat(e)]="moz".concat(t),i["ms".concat(e)]="MS".concat(t),i["O".concat(e)]="o".concat(t.toLowerCase()),i}var yd=function(e,t){var i={animationend:vd("Animation","AnimationEnd"),transitionend:vd("Transition","TransitionEnd")};return e&&("AnimationEvent"in t||delete i.animationend.animation,"TransitionEvent"in t||delete i.transitionend.transition),i}(mo(),"undefined"!==typeof window?window:{}),Td={};if(mo()){var xd=document.createElement("div");Td=xd.style}var Ad={};function Cd(e){if(Ad[e])return Ad[e];var t=yd[e];if(t)for(var i=Object.keys(t),r=i.length,s=0;s<r;s+=1){var n=i[s];if(Object.prototype.hasOwnProperty.call(t,n)&&n in Td)return Ad[e]=t[n],Ad[e]}return""}var Rd=Cd("animationend"),Ed=Cd("transitionend"),Sd=!(!Rd||!Ed),Md=Rd||"animationend",Pd=Ed||"transitionend";function Id(e,t){if(!e)return null;if("object"===Qa(e)){var i=t.replace(/-\w/g,(function(e){return e[1].toUpperCase()}));return e[i]}return"".concat(e,"-").concat(t)}const Od=function(t){var i=(0,e.useRef)();function r(e){e&&(e.removeEventListener(Pd,t),e.removeEventListener(Md,t))}return e.useEffect((function(){return function(){r(i.current)}}),[]),[function(e){i.current&&i.current!==e&&r(i.current),e&&e!==i.current&&(e.addEventListener(Pd,t),e.addEventListener(Md,t),i.current=e)},r]};const Dd=mo()?e.useLayoutEffect:e.useEffect;var wd=[pd,fd,gd,md],Fd=[pd,bd],Ld=!1,Bd=!0;function Nd(e){return e===gd||e===md}const kd=function(t,i,r){var s=ho(jh(_d),2),n=s[0],a=s[1],o=function(){var t=e.useRef(null);function i(){td.cancel(t.current)}return e.useEffect((function(){return function(){i()}}),[]),[function e(r){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;i();var n=td((function(){s<=1?r({isCanceled:function(){return n!==t.current}}):e(r,s-1)}));t.current=n},i]}(),l=ho(o,2),h=l[0],c=l[1];var u=i?Fd:wd;return Dd((function(){if(n!==_d&&n!==md){var e=u.indexOf(n),t=u[e+1],i=r(n);i===Ld?a(t,!0):t&&h((function(e){function r(){e.isCanceled()||a(t,!0)}!0===i?r():Promise.resolve(i).then(r)}))}}),[t,n]),e.useEffect((function(){return function(){c()}}),[]),[function(){a(pd,!0)},n]};function Ud(t,i,r,s){var n=s.motionEnter,a=void 0===n||n,o=s.motionAppear,l=void 0===o||o,h=s.motionLeave,c=void 0===h||h,u=s.motionDeadline,d=s.motionLeaveImmediately,_=s.onAppearPrepare,p=s.onEnterPrepare,f=s.onLeavePrepare,g=s.onAppearStart,m=s.onEnterStart,b=s.onLeaveStart,v=s.onAppearActive,y=s.onEnterActive,T=s.onLeaveActive,x=s.onAppearEnd,A=s.onEnterEnd,C=s.onLeaveEnd,R=s.onVisibleChanged,E=ho(jh(),2),S=E[0],M=E[1],P=function(t){var i=ho(e.useReducer((function(e){return e+1}),0),2)[1],r=e.useRef(t);return[Yh((function(){return r.current})),Yh((function(e){r.current="function"===typeof e?e(r.current):e,i()}))]}(hd),I=ho(P,2),O=I[0],D=I[1],w=ho(jh(null),2),F=w[0],L=w[1],B=O(),N=(0,e.useRef)(!1),k=(0,e.useRef)(null);function U(){return r()}var V=(0,e.useRef)(!1);function z(){D(hd),L(null,!0)}var G=Yh((function(e){var t=O();if(t!==hd){var i=U();if(!e||e.deadline||e.target===i){var r,s=V.current;t===cd&&s?r=null===x||void 0===x?void 0:x(i,e):t===ud&&s?r=null===A||void 0===A?void 0:A(i,e):t===dd&&s&&(r=null===C||void 0===C?void 0:C(i,e)),s&&!1!==r&&z()}}})),H=ho(Od(G),1)[0],W=function(e){switch(e){case cd:return uo(uo(uo({},pd,_),fd,g),gd,v);case ud:return uo(uo(uo({},pd,p),fd,m),gd,y);case dd:return uo(uo(uo({},pd,f),fd,b),gd,T);default:return{}}},q=e.useMemo((function(){return W(B)}),[B]),X=ho(kd(B,!t,(function(e){if(e===pd){var t=q[pd];return t?t(U()):Ld}var i;Y in q&&L((null===(i=q[Y])||void 0===i?void 0:i.call(q,U(),null))||null);return Y===gd&&B!==hd&&(H(U()),u>0&&(clearTimeout(k.current),k.current=setTimeout((function(){G({deadline:!0})}),u))),Y===bd&&z(),Bd})),2),K=X[0],Y=X[1],j=Nd(Y);V.current=j,Dd((function(){M(i);var e,r=N.current;N.current=!0,!r&&i&&l&&(e=cd),r&&i&&a&&(e=ud),(r&&!i&&c||!r&&d&&!i&&c)&&(e=dd);var s=W(e);e&&(t||s[pd])?(D(e),K()):D(hd)}),[i]),(0,e.useEffect)((function(){(B===cd&&!l||B===ud&&!a||B===dd&&!c)&&D(hd)}),[l,a,c]),(0,e.useEffect)((function(){return function(){N.current=!1,clearTimeout(k.current)}}),[]);var Q=e.useRef(!1);(0,e.useEffect)((function(){S&&(Q.current=!0),void 0!==S&&B===hd&&((Q.current||S)&&(null===R||void 0===R||R(S)),Q.current=!0)}),[S,B]);var $=F;return q[pd]&&Y===fd&&($=po({transition:"none"},$)),[B,Y,$,null!==S&&void 0!==S?S:i]}const Vd=function(t){var i=t;"object"===Qa(t)&&(i=t.transitionSupport);var r=e.forwardRef((function(t,r){var s=t.visible,n=void 0===s||s,a=t.removeOnLeave,o=void 0===a||a,l=t.forceRender,h=t.children,c=t.motionName,u=t.leavedClassName,d=t.eventProps,_=function(e,t){return!(!e.motionName||!i||!1===t)}(t,e.useContext(od).motion),p=(0,e.useRef)(),f=(0,e.useRef)();var g=ho(Ud(_,n,(function(){try{return p.current instanceof HTMLElement?p.current:ad(f.current)}catch(Qp){return null}}),t),4),m=g[0],b=g[1],v=g[2],y=g[3],T=e.useRef(y);y&&(T.current=!0);var x,A=e.useCallback((function(e){p.current=e,Za(r,e)}),[r]),C=po(po({},d),{},{visible:n});if(h)if(m===hd)x=y?h(po({},C),A):!o&&T.current&&u?h(po(po({},C),{},{className:u}),A):l||!o&&!u?h(po(po({},C),{},{style:{display:"none"}}),A):null;else{var R;b===pd?R="prepare":Nd(b)?R="active":b===fd&&(R="start");var E=Id(c,"".concat(m,"-").concat(R));x=h(po(po({},C),{},{className:ja()(Id(c,m),uo(uo({},E,E&&R),c,"string"===typeof c)),style:v}),A)}else x=null;e.isValidElement(x)&&eo(x)&&(x.ref||(x=e.cloneElement(x,{ref:A})));return e.createElement(ld,{ref:f},x)}));return r.displayName="CSSMotion",r}(Sd);function zd(e,t){if(null==e)return{};var i,r,s=function(e,t){if(null==e)return{};var i={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(t.includes(r))continue;i[r]=e[r]}return i}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(r=0;r<n.length;r++)i=n[r],t.includes(i)||{}.propertyIsEnumerable.call(e,i)&&(s[i]=e[i])}return s}var Gd="add",Hd="keep",Wd="remove",qd="removed";function Xd(e){var t;return po(po({},t=e&&"object"===Qa(e)&&"key"in e?e:{key:e}),{},{key:String(t.key)})}function Kd(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map(Xd)}var Yd=["component","children","onVisibleChanged","onAllRemoved"],jd=["status"],Qd=["eventProps","visible","children","motionName","motionAppear","motionEnter","motionLeave","motionLeaveImmediately","motionDeadline","removeOnLeave","leavedClassName","onAppearPrepare","onAppearStart","onAppearActive","onAppearEnd","onEnterStart","onEnterActive","onEnterEnd","onLeaveStart","onLeaveActive","onLeaveEnd"];!function(){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Vd,i=function(i){Bh(s,i);var r=Uh(s);function s(){var e;Bo(this,s);for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return uo(Fh(e=r.call.apply(r,[this].concat(i))),"state",{keyEntities:[]}),uo(Fh(e),"removeKey",(function(t){var i=e.state.keyEntities.map((function(e){return e.key!==t?e:po(po({},e),{},{status:qd})}));return e.setState({keyEntities:i}),i.filter((function(e){return e.status!==qd})).length})),e}return ko(s,[{key:"render",value:function(){var i=this,r=this.state.keyEntities,s=this.props,n=s.component,a=s.children,o=s.onVisibleChanged,l=s.onAllRemoved,h=zd(s,Yd),c=n||e.Fragment,u={};return Qd.forEach((function(e){u[e]=h[e],delete h[e]})),delete h.keys,e.createElement(c,h,r.map((function(r,s){var n=r.status,h=zd(r,jd),c=n===Gd||n===Hd;return e.createElement(t,Sl({},u,{key:h.key,visible:c,eventProps:h,onVisibleChanged:function(e){(null===o||void 0===o||o(e,{key:h.key}),e)||0===i.removeKey(h.key)&&l&&l()}}),(function(e,t){return a(po(po({},e),{},{index:s}),t)}))})))}}],[{key:"getDerivedStateFromProps",value:function(e,t){var i=e.keys,r=t.keyEntities,s=Kd(i),n=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=[],r=0,s=t.length,n=Kd(e),a=Kd(t);n.forEach((function(e){for(var t=!1,n=r;n<s;n+=1){var o=a[n];if(o.key===e.key){r<n&&(i=i.concat(a.slice(r,n).map((function(e){return po(po({},e),{},{status:Gd})}))),r=n),i.push(po(po({},o),{},{status:Hd})),r+=1,t=!0;break}}t||i.push(po(po({},e),{},{status:Wd}))})),r<s&&(i=i.concat(a.slice(r).map((function(e){return po(po({},e),{},{status:Gd})}))));var o={};return i.forEach((function(e){var t=e.key;o[t]=(o[t]||0)+1})),Object.keys(o).filter((function(e){return o[e]>1})).forEach((function(e){(i=i.filter((function(t){var i=t.key,r=t.status;return i!==e||r!==Wd}))).forEach((function(t){t.key===e&&(t.status=Hd)}))})),i}(r,s);return{keyEntities:n.filter((function(e){var t=r.find((function(t){var i=t.key;return e.key===i}));return!t||t.status!==qd||e.status!==Wd}))}}}]),s}(e.Component);uo(i,"defaultProps",{component:"div"})}(Sd);const $d=Vd;function Zd(){Zd=function(){return t};var e,t={},i=Object.prototype,r=i.hasOwnProperty,s=Object.defineProperty||function(e,t,i){e[t]=i.value},n="function"==typeof Symbol?Symbol:{},a=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",l=n.toStringTag||"@@toStringTag";function h(e,t,i){return Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{h({},"")}catch(e){h=function(e,t,i){return e[t]=i}}function c(e,t,i,r){var n=t&&t.prototype instanceof m?t:m,a=Object.create(n.prototype),o=new I(r||[]);return s(a,"_invoke",{value:E(e,i,o)}),a}function u(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(e){return{type:"throw",arg:e}}}t.wrap=c;var d="suspendedStart",_="suspendedYield",p="executing",f="completed",g={};function m(){}function b(){}function v(){}var y={};h(y,a,(function(){return this}));var T=Object.getPrototypeOf,x=T&&T(T(O([])));x&&x!==i&&r.call(x,a)&&(y=x);var A=v.prototype=m.prototype=Object.create(y);function C(e){["next","throw","return"].forEach((function(t){h(e,t,(function(e){return this._invoke(t,e)}))}))}function R(e,t){function i(s,n,a,o){var l=u(e[s],e,n);if("throw"!==l.type){var h=l.arg,c=h.value;return c&&"object"==Qa(c)&&r.call(c,"__await")?t.resolve(c.__await).then((function(e){i("next",e,a,o)}),(function(e){i("throw",e,a,o)})):t.resolve(c).then((function(e){h.value=e,a(h)}),(function(e){return i("throw",e,a,o)}))}o(l.arg)}var n;s(this,"_invoke",{value:function(e,r){function s(){return new t((function(t,s){i(e,r,t,s)}))}return n=n?n.then(s,s):s()}})}function E(t,i,r){var s=d;return function(n,a){if(s===p)throw Error("Generator is already running");if(s===f){if("throw"===n)throw a;return{value:e,done:!0}}for(r.method=n,r.arg=a;;){var o=r.delegate;if(o){var l=S(o,r);if(l){if(l===g)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(s===d)throw s=f,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);s=p;var h=u(t,i,r);if("normal"===h.type){if(s=r.done?f:_,h.arg===g)continue;return{value:h.arg,done:r.done}}"throw"===h.type&&(s=f,r.method="throw",r.arg=h.arg)}}}function S(t,i){var r=i.method,s=t.iterator[r];if(s===e)return i.delegate=null,"throw"===r&&t.iterator.return&&(i.method="return",i.arg=e,S(t,i),"throw"===i.method)||"return"!==r&&(i.method="throw",i.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var n=u(s,t.iterator,i.arg);if("throw"===n.type)return i.method="throw",i.arg=n.arg,i.delegate=null,g;var a=n.arg;return a?a.done?(i[t.resultName]=a.value,i.next=t.nextLoc,"return"!==i.method&&(i.method="next",i.arg=e),i.delegate=null,g):a:(i.method="throw",i.arg=new TypeError("iterator result is not an object"),i.delegate=null,g)}function M(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(M,this),this.reset(!0)}function O(t){if(t||""===t){var i=t[a];if(i)return i.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var s=-1,n=function i(){for(;++s<t.length;)if(r.call(t,s))return i.value=t[s],i.done=!1,i;return i.value=e,i.done=!0,i};return n.next=n}}throw new TypeError(Qa(t)+" is not iterable")}return b.prototype=v,s(A,"constructor",{value:v,configurable:!0}),s(v,"constructor",{value:b,configurable:!0}),b.displayName=h(v,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,h(e,l,"GeneratorFunction")),e.prototype=Object.create(A),e},t.awrap=function(e){return{__await:e}},C(R.prototype),h(R.prototype,o,(function(){return this})),t.AsyncIterator=R,t.async=function(e,i,r,s,n){void 0===n&&(n=Promise);var a=new R(c(e,i,r,s),n);return t.isGeneratorFunction(i)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},C(A),h(A,l,"Generator"),h(A,a,(function(){return this})),h(A,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),i=[];for(var r in t)i.push(r);return i.reverse(),function e(){for(;i.length;){var r=i.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=O,I.prototype={constructor:I,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var i in this)"t"===i.charAt(0)&&r.call(this,i)&&!isNaN(+i.slice(1))&&(this[i]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var i=this;function s(r,s){return o.type="throw",o.arg=t,i.next=r,s&&(i.method="next",i.arg=e),!!s}for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n],o=a.completion;if("root"===a.tryLoc)return s("end");if(a.tryLoc<=this.prev){var l=r.call(a,"catchLoc"),h=r.call(a,"finallyLoc");if(l&&h){if(this.prev<a.catchLoc)return s(a.catchLoc,!0);if(this.prev<a.finallyLoc)return s(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return s(a.catchLoc,!0)}else{if(!h)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return s(a.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var s=this.tryEntries[i];if(s.tryLoc<=this.prev&&r.call(s,"finallyLoc")&&this.prev<s.finallyLoc){var n=s;break}}n&&("break"===e||"continue"===e)&&n.tryLoc<=t&&t<=n.finallyLoc&&(n=null);var a=n?n.completion:{};return a.type=e,a.arg=t,n?(this.method="next",this.next=n.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),P(i),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var r=i.completion;if("throw"===r.type){var s=r.arg;P(i)}return s}}throw Error("illegal catch attempt")},delegateYield:function(t,i,r){return this.delegate={iterator:O(t),resultName:i,nextLoc:r},"next"===this.method&&(this.arg=e),g}},t}function Jd(e,t,i,r,s,n,a){try{var o=e[n](a),l=o.value}catch(e){return void i(e)}o.done?t(l):Promise.resolve(l).then(r,s)}function e_(e){return function(){var t=this,i=arguments;return new Promise((function(r,s){var n=e.apply(t,i);function a(e){Jd(n,r,s,a,o,"next",e)}function o(e){Jd(n,r,s,a,o,"throw",e)}a(void 0)}))}}var t_,i_=po({},sd),r_=i_.version,s_=i_.render,n_=i_.unmountComponentAtNode;try{Number((r_||"").split(".")[0])>=18&&(t_=i_.createRoot)}catch(Qp){}function a_(e){var t=i_.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;t&&"object"===Qa(t)&&(t.usingClientEntryPoint=e)}var o_="__rc_react_root__";function l_(e,t){t_?function(e,t){a_(!0);var i=t[o_]||t_(t);a_(!1),i.render(e),t[o_]=i}(e,t):function(e,t){s_(e,t)}(e,t)}function h_(e){return c_.apply(this,arguments)}function c_(){return(c_=e_(Zd().mark((function e(t){return Zd().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.resolve().then((function(){var e;null===(e=t[o_])||void 0===e||e.unmount(),delete t[o_]})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function u_(e){n_(e)}function d_(){return(d_=e_(Zd().mark((function e(t){return Zd().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===t_){e.next=2;break}return e.abrupt("return",h_(t));case 2:u_(t);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function __(e){return e&&"#fff"!==e&&"#ffffff"!==e&&"rgb(255, 255, 255)"!==e&&"rgba(255, 255, 255, 1)"!==e&&function(e){const t=(e||"").match(/rgba?\((\d*), (\d*), (\d*)(, [\d.]*)?\)/);return!(t&&t[1]&&t[2]&&t[3])||!(t[1]===t[2]&&t[2]===t[3])}(e)&&!/rgba\((?:\d*, ){3}0\)/.test(e)&&"transparent"!==e}function p_(e){return Number.isNaN(e)?0:e}const f_=t=>{const{className:i,target:r,component:s}=t,n=e.useRef(null),[a,o]=e.useState(null),[l,h]=e.useState([]),[c,u]=e.useState(0),[d,_]=e.useState(0),[p,f]=e.useState(0),[g,m]=e.useState(0),[b,v]=e.useState(!1),y={left:c,top:d,width:p,height:g,borderRadius:l.map((e=>`${e}px`)).join(" ")};function T(){const e=getComputedStyle(r);o(function(e){const{borderTopColor:t,borderColor:i,backgroundColor:r}=getComputedStyle(e);return __(t)?t:__(i)?i:__(r)?r:null}(r));const t="static"===e.position,{borderLeftWidth:i,borderTopWidth:s}=e;u(t?r.offsetLeft:p_(-parseFloat(i))),_(t?r.offsetTop:p_(-parseFloat(s))),f(r.offsetWidth),m(r.offsetHeight);const{borderTopLeftRadius:n,borderTopRightRadius:a,borderBottomLeftRadius:l,borderBottomRightRadius:c}=e;h([n,a,c,l].map((e=>p_(parseFloat(e)))))}if(a&&(y["--wave-color"]=a),e.useEffect((()=>{if(r){const e=td((()=>{T(),v(!0)}));let t;return"undefined"!==typeof ResizeObserver&&(t=new ResizeObserver(T),t.observe(r)),()=>{td.cancel(e),null===t||void 0===t||t.disconnect()}}}),[]),!b)return null;const x=("Checkbox"===s||"Radio"===s)&&(null===r||void 0===r?void 0:r.classList.contains(id));return e.createElement($d,{visible:!0,motionAppear:!0,motionName:"wave-motion",motionDeadline:5e3,onAppearEnd:(e,t)=>{var i;if(t.deadline||"opacity"===t.propertyName){const e=null===(i=n.current)||void 0===i?void 0:i.parentElement;(function(e){return d_.apply(this,arguments)})(e).then((()=>{null===e||void 0===e||e.remove()}))}return!1}},((t,r)=>{let{className:s}=t;return e.createElement("div",{ref:Ja(n,r),className:ja()(i,s,{"wave-quick":x}),style:y})}))},g_=(t,i)=>{var r;const{component:s}=i;if("Checkbox"===s&&!(null===(r=t.querySelector("input"))||void 0===r?void 0:r.checked))return;const n=document.createElement("div");n.style.position="absolute",n.style.left="0px",n.style.top="0px",null===t||void 0===t||t.insertBefore(n,null===t||void 0===t?void 0:t.firstChild),l_(e.createElement(f_,Object.assign({},i,{target:t})),n)},m_=(t,i,r)=>{const{wave:s}=e.useContext(ro),[,n,a]=Gu(),o=Yh((e=>{const o=t.current;if((null===s||void 0===s?void 0:s.disabled)||!o)return;const l=o.querySelector(`.${id}`)||o,{showEffect:h}=s||{};(h||g_)(l,{className:i,token:n,component:r,event:e,hashId:a})})),l=e.useRef();return e=>{td.cancel(l.current),l.current=td((()=>{o(e)}))}};const b_=t=>{const{children:i,disabled:r,component:s}=t,{getPrefixCls:n}=(0,e.useContext)(ro),a=(0,e.useRef)(null),o=n("wave"),[,l]=Yu(o),h=m_(a,ja()(o,l),s);if(e.useEffect((()=>{const e=a.current;if(!e||1!==e.nodeType||r)return;const t=t=>{!function(e){if(!e)return!1;if(e instanceof Element){if(e.offsetParent)return!0;if(e.getBBox){var t=e.getBBox(),i=t.width,r=t.height;if(i||r)return!0}if(e.getBoundingClientRect){var s=e.getBoundingClientRect(),n=s.width,a=s.height;if(n||a)return!0}}return!1}(t.target)||!e.getAttribute||e.getAttribute("disabled")||e.disabled||e.className.includes("disabled")||e.className.includes("-leave")||h(t)};return e.addEventListener("click",t,!0),()=>{e.removeEventListener("click",t,!0)}}),[r]),!e.isValidElement(i))return null!==i&&void 0!==i?i:null;return ao(i,{ref:eo(i)?Ja(i.ref,a):a})},v_=e.createContext(!1),y_=v_,T_=e.createContext(void 0),x_=T_,A_=t=>{const i=e.useContext(x_);return e.useMemo((()=>t?"string"===typeof t?null!==t&&void 0!==t?t:i:t instanceof Function?t(i):i:i),[t,i])};const C_=e.createContext(null);var R_=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var s=0;for(r=Object.getOwnPropertySymbols(e);s<r.length;s++)t.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(i[r[s]]=e[r[s]])}return i};const E_=e.createContext(void 0),S_=t=>{const{getPrefixCls:i,direction:r}=e.useContext(ro),{prefixCls:s,size:n,className:a}=t,o=R_(t,["prefixCls","size","className"]),l=i("btn-group",s),[,,h]=Gu();let c="";switch(n){case"large":c="lg";break;case"small":c="sm"}const u=ja()(l,{[`${l}-${c}`]:c,[`${l}-rtl`]:"rtl"===r},a,h);return e.createElement(E_.Provider,{value:n},e.createElement("div",Object.assign({},o,{className:u})))},M_=/^[\u4e00-\u9fa5]{2}$/,P_=M_.test.bind(M_);function I_(e){return"string"===typeof e}function O_(e){return"text"===e||"link"===e}function D_(t,i){if(null===t||void 0===t)return;const r=i?" ":"";return"string"!==typeof t&&"number"!==typeof t&&I_(t.type)&&P_(t.props.children)?ao(t,{children:t.props.children.split("").join(r)}):I_(t)?P_(t)?e.createElement("span",null,t.split("").join(r)):e.createElement("span",null,t):function(t){return t&&e.isValidElement(t)&&t.type===e.Fragment}(t)?e.createElement("span",null,t):t}const w_=(0,e.forwardRef)(((t,i)=>{const{className:r,style:s,children:n,prefixCls:a}=t,o=ja()(`${a}-icon`,r);return e.createElement("span",{ref:i,className:o,style:s},n)})),F_=w_;const L_={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M988 548c-19.9 0-36-16.1-36-36 0-59.4-11.6-117-34.6-171.3a440.45 440.45 0 00-94.3-139.9 437.71 437.71 0 00-139.9-94.3C629 83.6 571.4 72 512 72c-19.9 0-36-16.1-36-36s16.1-36 36-36c69.1 0 136.2 13.5 199.3 40.3C772.3 66 827 103 874 150c47 47 83.9 101.8 109.7 162.7 26.7 63.1 40.2 130.2 40.2 199.3.1 19.9-16 36-35.9 36z"}}]},name:"loading",theme:"outlined"};const B_=(0,e.createContext)({});function N_(e){var t;return null===e||void 0===e||null===(t=e.getRootNode)||void 0===t?void 0:t.call(e)}function k_(e){return function(e){return N_(e)instanceof ShadowRoot}(e)?N_(e):null}function U_(e){return"object"===Qa(e)&&"string"===typeof e.name&&"string"===typeof e.theme&&("object"===Qa(e.icon)||"function"===typeof e.icon)}function V_(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.keys(e).reduce((function(t,i){var r,s=e[i];if("class"===i)t.className=s,delete t.class;else delete t[i],t[(r=i,r.replace(/-(.)/g,(function(e,t){return t.toUpperCase()})))]=s;return t}),{})}function z_(t,i,r){return r?e.createElement(t.tag,po(po({key:i},V_(t.attrs)),r),(t.children||[]).map((function(e,r){return z_(e,"".concat(i,"-").concat(t.tag,"-").concat(r))}))):e.createElement(t.tag,po({key:i},V_(t.attrs)),(t.children||[]).map((function(e,r){return z_(e,"".concat(i,"-").concat(t.tag,"-").concat(r))})))}function G_(e){return Wc(e)[0]}function H_(e){return e?Array.isArray(e)?e:[e]:[]}var W_=["icon","className","onClick","style","primaryColor","secondaryColor"],q_={primaryColor:"#333",secondaryColor:"#E6E6E6",calculated:!1};var X_=function(t){var i,r,s=t.icon,n=t.className,a=t.onClick,o=t.style,l=t.primaryColor,h=t.secondaryColor,c=zd(t,W_),u=e.useRef(),d=q_;if(l&&(d={primaryColor:l,secondaryColor:h||G_(l)}),function(t){var i=(0,e.useContext)(B_),r=i.csp,s=i.prefixCls,n="\n.anticon {\n  display: inline-flex;\n  align-items: center;\n  color: inherit;\n  font-style: normal;\n  line-height: 0;\n  text-align: center;\n  text-transform: none;\n  vertical-align: -0.125em;\n  text-rendering: optimizeLegibility;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n.anticon > * {\n  line-height: 1;\n}\n\n.anticon svg {\n  display: inline-block;\n}\n\n.anticon::before {\n  display: none;\n}\n\n.anticon .anticon-icon {\n  display: block;\n}\n\n.anticon[tabindex] {\n  cursor: pointer;\n}\n\n.anticon-spin::before,\n.anticon-spin {\n  display: inline-block;\n  -webkit-animation: loadingCircle 1s infinite linear;\n  animation: loadingCircle 1s infinite linear;\n}\n\n@-webkit-keyframes loadingCircle {\n  100% {\n    -webkit-transform: rotate(360deg);\n    transform: rotate(360deg);\n  }\n}\n\n@keyframes loadingCircle {\n  100% {\n    -webkit-transform: rotate(360deg);\n    transform: rotate(360deg);\n  }\n}\n";s&&(n=n.replace(/anticon/g,s)),(0,e.useEffect)((function(){var e=k_(t.current);Mo(n,"@ant-design-icons",{prepend:!0,csp:r,attachTo:e})}),[])}(u),i=U_(s),r="icon should be icon definiton, but got ".concat(s),Lo(i,"[@ant-design/icons] ".concat(r)),!U_(s))return null;var _=s;return _&&"function"===typeof _.icon&&(_=po(po({},_),{},{icon:_.icon(d.primaryColor,d.secondaryColor)})),z_(_.icon,"svg-".concat(_.name),po(po({className:n,onClick:a,style:o,"data-icon":_.name,width:"1em",height:"1em",fill:"currentColor","aria-hidden":"true"},c),{},{ref:u}))};X_.displayName="IconReact",X_.getTwoToneColors=function(){return po({},q_)},X_.setTwoToneColors=function(e){var t=e.primaryColor,i=e.secondaryColor;q_.primaryColor=t,q_.secondaryColor=i||G_(t),q_.calculated=!!i};const K_=X_;function Y_(e){var t=ho(H_(e),2),i=t[0],r=t[1];return K_.setTwoToneColors({primaryColor:i,secondaryColor:r})}var j_=["className","icon","spin","rotate","tabIndex","onClick","twoToneColor"];Y_(eu.primary);var Q_=e.forwardRef((function(t,i){var r=t.className,s=t.icon,n=t.spin,a=t.rotate,o=t.tabIndex,l=t.onClick,h=t.twoToneColor,c=zd(t,j_),u=e.useContext(B_),d=u.prefixCls,_=void 0===d?"anticon":d,p=u.rootClassName,f=ja()(p,_,uo(uo({},"".concat(_,"-").concat(s.name),!!s.name),"".concat(_,"-spin"),!!n||"loading"===s.name),r),g=o;void 0===g&&l&&(g=-1);var m=a?{msTransform:"rotate(".concat(a,"deg)"),transform:"rotate(".concat(a,"deg)")}:void 0,b=ho(H_(h),2),v=b[0],y=b[1];return e.createElement("span",Sl({role:"img","aria-label":s.name},c,{ref:i,tabIndex:g,onClick:l,className:f}),e.createElement(K_,{icon:s,primaryColor:v,secondaryColor:y,style:m}))}));Q_.displayName="AntdIcon",Q_.getTwoToneColor=function(){var e=K_.getTwoToneColors();return e.calculated?[e.primaryColor,e.secondaryColor]:e.primaryColor},Q_.setTwoToneColor=Y_;const $_=Q_;var Z_=function(t,i){return e.createElement($_,Sl({},t,{ref:i,icon:L_}))};const J_=e.forwardRef(Z_),ep=(0,e.forwardRef)(((t,i)=>{const{prefixCls:r,className:s,style:n,iconClassName:a}=t,o=ja()(`${r}-loading-icon`,s);return e.createElement(F_,{prefixCls:r,className:o,style:n,ref:i},e.createElement(J_,{className:a}))})),tp=()=>({width:0,opacity:0,transform:"scale(0)"}),ip=e=>({width:e.scrollWidth,opacity:1,transform:"scale(1)"}),rp=t=>{const{prefixCls:i,loading:r,existIcon:s,className:n,style:a}=t,o=!!r;return s?e.createElement(ep,{prefixCls:i,className:n,style:a}):e.createElement($d,{visible:o,motionName:`${i}-loading-icon-motion`,motionLeave:o,removeOnLeave:!0,onAppearStart:tp,onAppearActive:ip,onEnterStart:tp,onEnterActive:ip,onLeaveStart:ip,onLeaveActive:tp},((t,r)=>{let{className:s,style:o}=t;return e.createElement(ep,{prefixCls:i,className:n,style:Object.assign(Object.assign({},a),o),ref:r,iconClassName:s})}))},sp=(e,t)=>({[`> span, > ${e}`]:{"&:not(:last-child)":{[`&, & > ${e}`]:{"&:not(:disabled)":{borderInlineEndColor:t}}},"&:not(:first-child)":{[`&, & > ${e}`]:{"&:not(:disabled)":{borderInlineStartColor:t}}}}}),np=e=>{const{componentCls:t,fontSize:i,lineWidth:r,groupBorderColor:s,colorErrorHover:n}=e;return{[`${t}-group`]:[{position:"relative",display:"inline-flex",[`> span, > ${t}`]:{"&:not(:last-child)":{[`&, & > ${t}`]:{borderStartEndRadius:0,borderEndEndRadius:0}},"&:not(:first-child)":{marginInlineStart:e.calc(r).mul(-1).equal(),[`&, & > ${t}`]:{borderStartStartRadius:0,borderEndStartRadius:0}}},[t]:{position:"relative",zIndex:1,"&:hover, &:focus, &:active":{zIndex:2},"&[disabled]":{zIndex:0}},[`${t}-icon-only`]:{fontSize:i}},sp(`${t}-primary`,s),sp(`${t}-danger`,n)]}},ap=e=>{const{paddingInline:t,onlyIconSize:i,paddingBlock:r}=e;return Jh(e,{buttonPaddingHorizontal:t,buttonPaddingVertical:r,buttonIconOnlyFontSize:i})},op=e=>{var t,i,r,s,n,a;const o=null!==(t=e.contentFontSize)&&void 0!==t?t:e.fontSize,l=null!==(i=e.contentFontSizeSM)&&void 0!==i?i:e.fontSize,h=null!==(r=e.contentFontSizeLG)&&void 0!==r?r:e.fontSizeLG,c=null!==(s=e.contentLineHeight)&&void 0!==s?s:Cu(o),u=null!==(n=e.contentLineHeightSM)&&void 0!==n?n:Cu(l),d=null!==(a=e.contentLineHeightLG)&&void 0!==a?a:Cu(h);return{fontWeight:400,defaultShadow:`0 ${e.controlOutlineWidth}px 0 ${e.controlTmpOutline}`,primaryShadow:`0 ${e.controlOutlineWidth}px 0 ${e.controlOutline}`,dangerShadow:`0 ${e.controlOutlineWidth}px 0 ${e.colorErrorOutline}`,primaryColor:e.colorTextLightSolid,dangerColor:e.colorTextLightSolid,borderColorDisabled:e.colorBorder,defaultGhostColor:e.colorBgContainer,ghostBg:"transparent",defaultGhostBorderColor:e.colorBgContainer,paddingInline:e.paddingContentHorizontal-e.lineWidth,paddingInlineLG:e.paddingContentHorizontal-e.lineWidth,paddingInlineSM:8-e.lineWidth,onlyIconSize:e.fontSizeLG,onlyIconSizeSM:e.fontSizeLG-2,onlyIconSizeLG:e.fontSizeLG+2,groupBorderColor:e.colorPrimaryHover,linkHoverBg:"transparent",textHoverBg:e.colorBgTextHover,defaultColor:e.colorText,defaultBg:e.colorBgContainer,defaultBorderColor:e.colorBorder,defaultBorderColorDisabled:e.colorBorder,defaultHoverBg:e.colorBgContainer,defaultHoverColor:e.colorPrimaryHover,defaultHoverBorderColor:e.colorPrimaryHover,defaultActiveBg:e.colorBgContainer,defaultActiveColor:e.colorPrimaryActive,defaultActiveBorderColor:e.colorPrimaryActive,contentFontSize:o,contentFontSizeSM:l,contentFontSizeLG:h,contentLineHeight:c,contentLineHeightSM:u,contentLineHeightLG:d,paddingBlock:Math.max((e.controlHeight-o*c)/2-e.lineWidth,0),paddingBlockSM:Math.max((e.controlHeightSM-l*u)/2-e.lineWidth,0),paddingBlockLG:Math.max((e.controlHeightLG-h*d)/2-e.lineWidth,0)}},lp=e=>{const{componentCls:t,iconCls:i,fontWeight:r}=e;return{[t]:{outline:"none",position:"relative",display:"inline-flex",gap:e.marginXS,alignItems:"center",justifyContent:"center",fontWeight:r,whiteSpace:"nowrap",textAlign:"center",backgroundImage:"none",background:"transparent",border:`${al(e.lineWidth)} ${e.lineType} transparent`,cursor:"pointer",transition:`all ${e.motionDurationMid} ${e.motionEaseInOut}`,userSelect:"none",touchAction:"manipulation",color:e.colorText,"&:disabled > *":{pointerEvents:"none"},"> span":{display:"inline-block"},[`${t}-icon`]:{lineHeight:1},"> a":{color:"currentColor"},"&:not(:disabled)":Object.assign({},uc(e)),[`&${t}-two-chinese-chars::first-letter`]:{letterSpacing:"0.34em"},[`&${t}-two-chinese-chars > *:not(${i})`]:{marginInlineEnd:"-0.34em",letterSpacing:"0.34em"},"&-icon-end":{flexDirection:"row-reverse"}}}},hp=(e,t,i)=>({[`&:not(:disabled):not(${e}-disabled)`]:{"&:hover":t,"&:active":i}}),cp=e=>({minWidth:e.controlHeight,paddingInlineStart:0,paddingInlineEnd:0,borderRadius:"50%"}),up=e=>({borderRadius:e.controlHeight,paddingInlineStart:e.calc(e.controlHeight).div(2).equal(),paddingInlineEnd:e.calc(e.controlHeight).div(2).equal()}),dp=e=>({cursor:"not-allowed",borderColor:e.borderColorDisabled,color:e.colorTextDisabled,background:e.colorBgContainerDisabled,boxShadow:"none"}),_p=(e,t,i,r,s,n,a,o)=>({[`&${e}-background-ghost`]:Object.assign(Object.assign({color:i||void 0,background:t,borderColor:r||void 0,boxShadow:"none"},hp(e,Object.assign({background:t},a),Object.assign({background:t},o))),{"&:disabled":{cursor:"not-allowed",color:s||void 0,borderColor:n||void 0}})}),pp=e=>({[`&:disabled, &${e.componentCls}-disabled`]:Object.assign({},dp(e))}),fp=e=>Object.assign({},pp(e)),gp=e=>({[`&:disabled, &${e.componentCls}-disabled`]:{cursor:"not-allowed",color:e.colorTextDisabled}}),mp=e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},fp(e)),{background:e.defaultBg,borderColor:e.defaultBorderColor,color:e.defaultColor,boxShadow:e.defaultShadow}),hp(e.componentCls,{color:e.defaultHoverColor,borderColor:e.defaultHoverBorderColor,background:e.defaultHoverBg},{color:e.defaultActiveColor,borderColor:e.defaultActiveBorderColor,background:e.defaultActiveBg})),_p(e.componentCls,e.ghostBg,e.defaultGhostColor,e.defaultGhostBorderColor,e.colorTextDisabled,e.colorBorder)),{[`&${e.componentCls}-dangerous`]:Object.assign(Object.assign(Object.assign({color:e.colorError,borderColor:e.colorError},hp(e.componentCls,{color:e.colorErrorHover,borderColor:e.colorErrorBorderHover},{color:e.colorErrorActive,borderColor:e.colorErrorActive})),_p(e.componentCls,e.ghostBg,e.colorError,e.colorError,e.colorTextDisabled,e.colorBorder)),pp(e))}),bp=e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},fp(e)),{color:e.primaryColor,background:e.colorPrimary,boxShadow:e.primaryShadow}),hp(e.componentCls,{color:e.colorTextLightSolid,background:e.colorPrimaryHover},{color:e.colorTextLightSolid,background:e.colorPrimaryActive})),_p(e.componentCls,e.ghostBg,e.colorPrimary,e.colorPrimary,e.colorTextDisabled,e.colorBorder,{color:e.colorPrimaryHover,borderColor:e.colorPrimaryHover},{color:e.colorPrimaryActive,borderColor:e.colorPrimaryActive})),{[`&${e.componentCls}-dangerous`]:Object.assign(Object.assign(Object.assign({background:e.colorError,boxShadow:e.dangerShadow,color:e.dangerColor},hp(e.componentCls,{background:e.colorErrorHover},{background:e.colorErrorActive})),_p(e.componentCls,e.ghostBg,e.colorError,e.colorError,e.colorTextDisabled,e.colorBorder,{color:e.colorErrorHover,borderColor:e.colorErrorHover},{color:e.colorErrorActive,borderColor:e.colorErrorActive})),pp(e))}),vp=e=>Object.assign(Object.assign({},mp(e)),{borderStyle:"dashed"}),yp=e=>Object.assign(Object.assign(Object.assign({color:e.colorLink},hp(e.componentCls,{color:e.colorLinkHover,background:e.linkHoverBg},{color:e.colorLinkActive})),gp(e)),{[`&${e.componentCls}-dangerous`]:Object.assign(Object.assign({color:e.colorError},hp(e.componentCls,{color:e.colorErrorHover},{color:e.colorErrorActive})),gp(e))}),Tp=e=>Object.assign(Object.assign(Object.assign({},hp(e.componentCls,{color:e.colorText,background:e.textHoverBg},{color:e.colorText,background:e.colorBgTextActive})),gp(e)),{[`&${e.componentCls}-dangerous`]:Object.assign(Object.assign({color:e.colorError},gp(e)),hp(e.componentCls,{color:e.colorErrorHover,background:e.colorErrorBg},{color:e.colorErrorHover,background:e.colorErrorBgActive}))}),xp=e=>{const{componentCls:t}=e;return{[`${t}-default`]:mp(e),[`${t}-primary`]:bp(e),[`${t}-dashed`]:vp(e),[`${t}-link`]:yp(e),[`${t}-text`]:Tp(e),[`${t}-ghost`]:_p(e.componentCls,e.ghostBg,e.colorBgContainer,e.colorBgContainer,e.colorTextDisabled,e.colorBorder)}},Ap=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const{componentCls:i,controlHeight:r,fontSize:s,lineHeight:n,borderRadius:a,buttonPaddingHorizontal:o,iconCls:l,buttonPaddingVertical:h}=e,c=`${i}-icon-only`;return[{[t]:{fontSize:s,lineHeight:n,height:r,padding:`${al(h)} ${al(o)}`,borderRadius:a,[`&${c}`]:{width:r,paddingInline:0,[`&${i}-compact-item`]:{flex:"none"},[`&${i}-round`]:{width:"auto"},[l]:{fontSize:e.buttonIconOnlyFontSize}},[`&${i}-loading`]:{opacity:e.opacityLoading,cursor:"default"},[`${i}-loading-icon`]:{transition:`width ${e.motionDurationSlow} ${e.motionEaseInOut}, opacity ${e.motionDurationSlow} ${e.motionEaseInOut}`}}},{[`${i}${i}-circle${t}`]:cp(e)},{[`${i}${i}-round${t}`]:up(e)}]},Cp=e=>{const t=Jh(e,{fontSize:e.contentFontSize,lineHeight:e.contentLineHeight});return Ap(t,e.componentCls)},Rp=e=>{const t=Jh(e,{controlHeight:e.controlHeightSM,fontSize:e.contentFontSizeSM,lineHeight:e.contentLineHeightSM,padding:e.paddingXS,buttonPaddingHorizontal:e.paddingInlineSM,buttonPaddingVertical:e.paddingBlockSM,borderRadius:e.borderRadiusSM,buttonIconOnlyFontSize:e.onlyIconSizeSM});return Ap(t,`${e.componentCls}-sm`)},Ep=e=>{const t=Jh(e,{controlHeight:e.controlHeightLG,fontSize:e.contentFontSizeLG,lineHeight:e.contentLineHeightLG,buttonPaddingHorizontal:e.paddingInlineLG,buttonPaddingVertical:e.paddingBlockLG,borderRadius:e.borderRadiusLG,buttonIconOnlyFontSize:e.onlyIconSizeLG});return Ap(t,`${e.componentCls}-lg`)},Sp=e=>{const{componentCls:t}=e;return{[t]:{[`&${t}-block`]:{width:"100%"}}}},Mp=Wu("Button",(e=>{const t=ap(e);return[lp(t),Cp(t),Rp(t),Ep(t),Sp(t),xp(t),np(t)]}),op,{unitless:{fontWeight:!0,contentLineHeight:!0,contentLineHeightSM:!0,contentLineHeightLG:!0}});function Pp(e,t,i){const{focusElCls:r,focus:s,borderElCls:n}=i,a=n?"> *":"",o=["hover",s?"focus":null,"active"].filter(Boolean).map((e=>`&:${e} ${a}`)).join(",");return{[`&-item:not(${t}-last-item)`]:{marginInlineEnd:e.calc(e.lineWidth).mul(-1).equal()},"&-item":Object.assign(Object.assign({[o]:{zIndex:2}},r?{[`&${r}`]:{zIndex:2}}:{}),{[`&[disabled] ${a}`]:{zIndex:0}})}}function Ip(e,t,i){const{borderElCls:r}=i,s=r?`> ${r}`:"";return{[`&-item:not(${t}-first-item):not(${t}-last-item) ${s}`]:{borderRadius:0},[`&-item:not(${t}-last-item)${t}-first-item`]:{[`& ${s}, &${e}-sm ${s}, &${e}-lg ${s}`]:{borderStartEndRadius:0,borderEndEndRadius:0}},[`&-item:not(${t}-first-item)${t}-last-item`]:{[`& ${s}, &${e}-sm ${s}, &${e}-lg ${s}`]:{borderStartStartRadius:0,borderEndStartRadius:0}}}}function Op(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{focus:!0};const{componentCls:i}=e,r=`${i}-compact`;return{[r]:Object.assign(Object.assign({},Pp(e,r,t)),Ip(i,r,t))}}function Dp(e,t){return{[`&-item:not(${t}-last-item)`]:{marginBottom:e.calc(e.lineWidth).mul(-1).equal()},"&-item":{"&:hover,&:focus,&:active":{zIndex:2},"&[disabled]":{zIndex:0}}}}function wp(e){const t=`${e.componentCls}-compact-vertical`;return{[t]:Object.assign(Object.assign({},Dp(e,t)),(i=e.componentCls,r=t,{[`&-item:not(${r}-first-item):not(${r}-last-item)`]:{borderRadius:0},[`&-item${r}-first-item:not(${r}-last-item)`]:{[`&, &${i}-sm, &${i}-lg`]:{borderEndEndRadius:0,borderEndStartRadius:0}},[`&-item${r}-last-item:not(${r}-first-item)`]:{[`&, &${i}-sm, &${i}-lg`]:{borderStartStartRadius:0,borderStartEndRadius:0}}}))};var i,r}const Fp=e=>{const{componentCls:t,calc:i}=e;return{[t]:{[`&-compact-item${t}-primary`]:{[`&:not([disabled]) + ${t}-compact-item${t}-primary:not([disabled])`]:{position:"relative","&:before":{position:"absolute",top:i(e.lineWidth).mul(-1).equal(),insetInlineStart:i(e.lineWidth).mul(-1).equal(),display:"inline-block",width:e.lineWidth,height:`calc(100% + ${al(e.lineWidth)} * 2)`,backgroundColor:e.colorPrimaryHover,content:'""'}}},"&-compact-vertical-item":{[`&${t}-primary`]:{[`&:not([disabled]) + ${t}-compact-vertical-item${t}-primary:not([disabled])`]:{position:"relative","&:before":{position:"absolute",top:i(e.lineWidth).mul(-1).equal(),insetInlineStart:i(e.lineWidth).mul(-1).equal(),display:"inline-block",width:`calc(100% + ${al(e.lineWidth)} * 2)`,height:e.lineWidth,backgroundColor:e.colorPrimaryHover,content:'""'}}}}}}},Lp=Xu(["Button","compact"],(e=>{const t=ap(e);return[Op(t),wp(t),Fp(t)]}),op);var Bp=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var s=0;for(r=Object.getOwnPropertySymbols(e);s<r.length;s++)t.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(i[r[s]]=e[r[s]])}return i};const Np=e.forwardRef(((t,i)=>{var r,s,n;const{loading:a=!1,prefixCls:o,type:l,danger:h=!1,shape:c="default",size:u,styles:d,disabled:_,className:p,rootClassName:f,children:g,icon:m,iconPosition:b="start",ghost:v=!1,block:y=!1,htmlType:T="button",classNames:x,style:A={},autoInsertSpace:C}=t,R=Bp(t,["loading","prefixCls","type","danger","shape","size","styles","disabled","className","rootClassName","children","icon","iconPosition","ghost","block","htmlType","classNames","style","autoInsertSpace"]),E=l||"default",{getPrefixCls:S,direction:M,button:P}=(0,e.useContext)(ro),I=null===(r=null!==C&&void 0!==C?C:null===P||void 0===P?void 0:P.autoInsertSpace)||void 0===r||r,O=S("btn",o),[D,w,F]=Mp(O),L=(0,e.useContext)(y_),B=null!==_&&void 0!==_?_:L,N=(0,e.useContext)(E_),k=(0,e.useMemo)((()=>function(e){if("object"===typeof e&&e){let t=null===e||void 0===e?void 0:e.delay;return t=Number.isNaN(t)||"number"!==typeof t?0:t,{loading:t<=0,delay:t}}return{loading:!!e,delay:0}}(a)),[a]),[U,V]=(0,e.useState)(k.loading),[z,G]=(0,e.useState)(!1),H=Ja(i,(0,e.createRef)()),W=1===e.Children.count(g)&&!m&&!O_(E);(0,e.useEffect)((()=>{let e=null;return k.delay>0?e=setTimeout((()=>{e=null,V(!0)}),k.delay):V(k.loading),function(){e&&(clearTimeout(e),e=null)}}),[k]),(0,e.useEffect)((()=>{if(!H||!H.current||!I)return;const e=H.current.textContent;W&&P_(e)?z||G(!0):z&&G(!1)}),[H]);const q=e=>{const{onClick:i}=t;U||B?e.preventDefault():null===i||void 0===i||i(e)};const{compactSize:X,compactItemClassnames:K}=((t,i)=>{const r=e.useContext(C_),s=e.useMemo((()=>{if(!r)return"";const{compactDirection:e,isFirstItem:s,isLastItem:n}=r,a="vertical"===e?"-vertical-":"-";return ja()(`${t}-compact${a}item`,{[`${t}-compact${a}first-item`]:s,[`${t}-compact${a}last-item`]:n,[`${t}-compact${a}item-rtl`]:"rtl"===i})}),[t,i,r]);return{compactSize:null===r||void 0===r?void 0:r.compactSize,compactDirection:null===r||void 0===r?void 0:r.compactDirection,compactItemClassnames:s}})(O,M),Y={large:"lg",small:"sm",middle:void 0},j=A_((e=>{var t,i;return null!==(i=null!==(t=null!==u&&void 0!==u?u:X)&&void 0!==t?t:N)&&void 0!==i?i:e})),Q=j&&Y[j]||"",$=U?"loading":m,Z=function(e,t){var i=Object.assign({},e);return Array.isArray(t)&&t.forEach((function(e){delete i[e]})),i}(R,["navigate"]),J=ja()(O,w,F,{[`${O}-${c}`]:"default"!==c&&c,[`${O}-${E}`]:E,[`${O}-${Q}`]:Q,[`${O}-icon-only`]:!g&&0!==g&&!!$,[`${O}-background-ghost`]:v&&!O_(E),[`${O}-loading`]:U,[`${O}-two-chinese-chars`]:z&&I&&!U,[`${O}-block`]:y,[`${O}-dangerous`]:h,[`${O}-rtl`]:"rtl"===M,[`${O}-icon-end`]:"end"===b},K,p,f,null===P||void 0===P?void 0:P.className),ee=Object.assign(Object.assign({},null===P||void 0===P?void 0:P.style),A),te=ja()(null===x||void 0===x?void 0:x.icon,null===(s=null===P||void 0===P?void 0:P.classNames)||void 0===s?void 0:s.icon),ie=Object.assign(Object.assign({},(null===d||void 0===d?void 0:d.icon)||{}),(null===(n=null===P||void 0===P?void 0:P.styles)||void 0===n?void 0:n.icon)||{}),re=m&&!U?e.createElement(F_,{prefixCls:O,className:te,style:ie},m):e.createElement(rp,{existIcon:!!m,prefixCls:O,loading:U}),se=g||0===g?function(t,i){let r=!1;const s=[];return e.Children.forEach(t,(e=>{const t=typeof e,i="string"===t||"number"===t;if(r&&i){const t=s.length-1,i=s[t];s[t]=`${i}${e}`}else s.push(e);r=i})),e.Children.map(s,(e=>D_(e,i)))}(g,W&&I):null;if(void 0!==Z.href)return D(e.createElement("a",Object.assign({},Z,{className:ja()(J,{[`${O}-disabled`]:B}),href:B?void 0:Z.href,style:ee,onClick:q,ref:H,tabIndex:B?-1:0}),re,se));let ne=e.createElement("button",Object.assign({},R,{type:T,className:J,style:ee,onClick:q,disabled:B,ref:H}),re,se,!!K&&e.createElement(Lp,{key:"compact",prefixCls:O}));return O_(E)||(ne=e.createElement(b_,{component:"Button",disabled:U},ne)),D(ne)})),kp=Np;kp.Group=S_,kp.__ANT_BUTTON=!0;const Up=kp,Vp=e=>{const{componentCls:t,sizePaddingEdgeHorizontal:i,colorSplit:r,lineWidth:s,textPaddingInline:n,orientationMargin:a,verticalMarginInline:o}=e;return{[t]:Object.assign(Object.assign({},lc(e)),{borderBlockStart:`${al(s)} solid ${r}`,"&-vertical":{position:"relative",top:"-0.06em",display:"inline-block",height:"0.9em",marginInline:o,marginBlock:0,verticalAlign:"middle",borderTop:0,borderInlineStart:`${al(s)} solid ${r}`},"&-horizontal":{display:"flex",clear:"both",width:"100%",minWidth:"100%",margin:`${al(e.dividerHorizontalGutterMargin)} 0`},[`&-horizontal${t}-with-text`]:{display:"flex",alignItems:"center",margin:`${al(e.dividerHorizontalWithTextGutterMargin)} 0`,color:e.colorTextHeading,fontWeight:500,fontSize:e.fontSizeLG,whiteSpace:"nowrap",textAlign:"center",borderBlockStart:`0 ${r}`,"&::before, &::after":{position:"relative",width:"50%",borderBlockStart:`${al(s)} solid transparent`,borderBlockStartColor:"inherit",borderBlockEnd:0,transform:"translateY(50%)",content:"''"}},[`&-horizontal${t}-with-text-left`]:{"&::before":{width:`calc(${a} * 100%)`},"&::after":{width:`calc(100% - ${a} * 100%)`}},[`&-horizontal${t}-with-text-right`]:{"&::before":{width:`calc(100% - ${a} * 100%)`},"&::after":{width:`calc(${a} * 100%)`}},[`${t}-inner-text`]:{display:"inline-block",paddingBlock:0,paddingInline:n},"&-dashed":{background:"none",borderColor:r,borderStyle:"dashed",borderWidth:`${al(s)} 0 0`},[`&-horizontal${t}-with-text${t}-dashed`]:{"&::before, &::after":{borderStyle:"dashed none none"}},[`&-vertical${t}-dashed`]:{borderInlineStartWidth:s,borderInlineEnd:0,borderBlockStart:0,borderBlockEnd:0},"&-dotted":{background:"none",borderColor:r,borderStyle:"dotted",borderWidth:`${al(s)} 0 0`},[`&-horizontal${t}-with-text${t}-dotted`]:{"&::before, &::after":{borderStyle:"dotted none none"}},[`&-vertical${t}-dotted`]:{borderInlineStartWidth:s,borderInlineEnd:0,borderBlockStart:0,borderBlockEnd:0},[`&-plain${t}-with-text`]:{color:e.colorText,fontWeight:"normal",fontSize:e.fontSize},[`&-horizontal${t}-with-text-left${t}-no-default-orientation-margin-left`]:{"&::before":{width:0},"&::after":{width:"100%"},[`${t}-inner-text`]:{paddingInlineStart:i}},[`&-horizontal${t}-with-text-right${t}-no-default-orientation-margin-right`]:{"&::before":{width:"100%"},"&::after":{width:0},[`${t}-inner-text`]:{paddingInlineEnd:i}}})}},zp=Wu("Divider",(e=>{const t=Jh(e,{dividerHorizontalWithTextGutterMargin:e.margin,dividerHorizontalGutterMargin:e.marginLG,sizePaddingEdgeHorizontal:0});return[Vp(t)]}),(e=>({textPaddingInline:"1em",orientationMargin:.05,verticalMarginInline:e.marginXS})),{unitless:{orientationMargin:!0}});var Gp=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var s=0;for(r=Object.getOwnPropertySymbols(e);s<r.length;s++)t.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(i[r[s]]=e[r[s]])}return i};const Hp=t=>{const{getPrefixCls:i,direction:r,divider:s}=e.useContext(ro),{prefixCls:n,type:a="horizontal",orientation:o="center",orientationMargin:l,className:h,rootClassName:c,children:u,dashed:d,variant:_="solid",plain:p,style:f}=t,g=Gp(t,["prefixCls","type","orientation","orientationMargin","className","rootClassName","children","dashed","variant","plain","style"]),m=i("divider",n),[b,v,y]=zp(m),T=!!u,x="left"===o&&null!=l,A="right"===o&&null!=l,C=ja()(m,null===s||void 0===s?void 0:s.className,v,y,`${m}-${a}`,{[`${m}-with-text`]:T,[`${m}-with-text-${o}`]:T,[`${m}-dashed`]:!!d,[`${m}-${_}`]:"solid"!==_,[`${m}-plain`]:!!p,[`${m}-rtl`]:"rtl"===r,[`${m}-no-default-orientation-margin-left`]:x,[`${m}-no-default-orientation-margin-right`]:A},h,c),R=e.useMemo((()=>"number"===typeof l?l:/^\d+$/.test(l)?Number(l):l),[l]),E=Object.assign(Object.assign({},x&&{marginLeft:R}),A&&{marginRight:R});return b(e.createElement("div",Object.assign({className:C,style:Object.assign(Object.assign({},null===s||void 0===s?void 0:s.style),f)},g,{role:"separator"}),u&&"vertical"!==a&&e.createElement("span",{className:`${m}-inner-text`,style:E},u)))};var Wp=i(579);const qp=t=>{const{title:i,items:r}=t;return(0,Wp.jsxs)("div",{className:"infoCard",children:[(0,Wp.jsx)("p",{children:i}),(0,Wp.jsx)(Hp,{className:"divider"}),(0,Wp.jsx)("div",{className:"cardGrid",children:r.map(((t,i)=>{let{label:r,value:s}=t;return(0,Wp.jsxs)(e.Fragment,{children:[(0,Wp.jsx)("label",{children:r}),(0,Wp.jsx)("span",{children:s})]},i)}))})]})},Xp=e=>[{label:"Average",value:e?e.average.toFixed(2):"-"},{label:"Max",value:e?e.max.toFixed(2):"-"},{label:"Min",value:e?e.min.toFixed(2):"-"}],Kp=()=>{const t=(0,e.useRef)(null),[i,r]=(0,e.useState)(),[s,n]=(0,e.useState)();(0,e.useEffect)((()=>()=>null===i||void 0===i?void 0:i()),[i]);return(0,Wp.jsxs)("div",{className:"container",children:[(0,Wp.jsxs)("div",{className:"titleRow",children:[(0,Wp.jsx)("p",{children:"renderer"}),i?(0,Wp.jsx)(Up,{onClick:()=>{null===i||void 0===i||i(),r(void 0)},children:"Stop"}):(0,Wp.jsx)(Up,{onClick:()=>{const e=t.current;if(i||!e);else{const t=new Bt(e),i=()=>{t.resize()};window.addEventListener("resize",i);const s=jp(t,e),a=Yp(s);console.log("start benchmarking renedr loop"),t.runRenderLoop((()=>{s.render()}));const o=setInterval((()=>{const{frameTimeCounter:e,cameraRenderTimeCounter:t,renderTimeCounter:i,activeMeshesEvaluationTimeCounter:r,renderTargetsRenderTimeCounter:s}=a;n({renderTimeCounter:i,frameTimeCounter:e,cameraRenderTimeCounter:t,activeMeshesEvaluationTimeCounter:r,renderTargetsRenderTimeCounter:s})}),1e3),l=()=>{console.log("tearing down benchmark setup"),clearInterval(o),t.stopRenderLoop(),s.dispose(),window.removeEventListener("resize",i),t.dispose(),clearInterval(o)};r((()=>l))}},children:"Start benchmark"})]}),(0,Wp.jsxs)("div",{className:"instrumentation",children:[(0,Wp.jsx)(qp,{title:"Render time",items:Xp(null===s||void 0===s?void 0:s.renderTimeCounter)}),(0,Wp.jsx)(qp,{title:"Frame time",items:Xp(null===s||void 0===s?void 0:s.frameTimeCounter)}),(0,Wp.jsx)(qp,{title:"Camera render time",items:Xp(null===s||void 0===s?void 0:s.cameraRenderTimeCounter)}),(0,Wp.jsx)(qp,{title:"Mesh evaluation time",items:Xp(null===s||void 0===s?void 0:s.activeMeshesEvaluationTimeCounter)}),(0,Wp.jsx)(qp,{title:"Render target time",items:Xp(null===s||void 0===s?void 0:s.renderTargetsRenderTimeCounter)})]}),(0,Wp.jsx)("canvas",{ref:t})]})},Yp=e=>{const t=new Nt(e);return t.captureFrameTime=!0,t.captureCameraRenderTime=!0,t.captureRenderTime=!0,t.captureActiveMeshesEvaluationTime=!0,t.captureRenderTargetsRenderTime=!0,t},jp=(e,t)=>{const i=new Gt.Z(e);new Rt("camera1",Math.PI/2,Math.PI/2,80,new o.Pq(0,0,0),i).attachControl(t,!0);const r=[];for(let n=0;n<50;n++){const e=new Ti("mat "+n,i);e.emissiveColor=new xi.v9(Math.random(),Math.random(),Math.random()),r.push(e)}for(let n=0;n<2500;n++){const e=kr.CreateSphere("sphere",{diameter:2,segments:32},i);e.position=new o.Pq(20-40*Math.random(),20-40*Math.random(),20-40*Math.random()),e.material=r[n%50]}let s=0;for(let n=0;n<2500;n++){if(0!==s){i.meshes[n].setParent(i.meshes[n-1])}s++,s>=5&&(s=0)}return i.createDefaultEnvironment({skyboxTexture:Xa,groundTexture:qa,environmentTexture:Ka}),i.onBeforeRenderObservable.add((()=>{for(let e=0;e<i.meshes.length;e++){i.meshes[e].rotation.y+=.01}})),i};function Qp(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{l(r.next(e))}catch(e){n(e)}}function o(e){try{l(r.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}l((r=r.apply(e,t||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;const $p=["geforce 320m","geforce 8600","geforce 8600m gt","geforce 8800 gs","geforce 8800 gt","geforce 9400","geforce 9400m g","geforce 9400m","geforce 9600m gt","geforce 9600m","geforce fx go5200","geforce gt 120","geforce gt 130","geforce gt 330m","geforce gtx 285","google swiftshader","intel g41","intel g45","intel gma 4500mhd","intel gma x3100","intel hd 3000","intel q45","legacy","mali-2","mali-3","mali-4","quadro fx 1500","quadro fx 4","quadro fx 5","radeon hd 2400","radeon hd 2600","radeon hd 4670","radeon hd 4850","radeon hd 4870","radeon hd 5670","radeon hd 5750","radeon hd 6290","radeon hd 6300","radeon hd 6310","radeon hd 6320","radeon hd 6490m","radeon hd 6630m","radeon hd 6750m","radeon hd 6770m","radeon hd 6970m","sgx 543","sgx543"];function Zp(e){return e.toLowerCase().replace(/.*angle ?\((.+)\)(?: on vulkan [0-9.]+)?$/i,"$1").replace(/\s(\d{1,2}gb|direct3d.+$)|\(r\)| \([^)]+\)$/g,"").replace(/(?:vulkan|opengl) \d+\.\d+(?:\.\d+)?(?: \((.*)\))?/,"$1")}const Jp="undefined"==typeof window,ef=(()=>{if(Jp)return;const{userAgent:e,platform:t,maxTouchPoints:i}=window.navigator,r=/(iphone|ipod|ipad)/i.test(e),s="iPad"===t||"MacIntel"===t&&i>0&&!window.MSStream;return{isIpad:s,isMobile:/android/i.test(e)||r||s,isSafari12:/Version\/12.+Safari/.test(e),isFirefox:/Firefox/.test(e)}})();class tf extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}const rf=[],sf=[];function nf(e,t){if(e===t)return 0;const i=e;e.length>t.length&&(e=t,t=i);let r=e.length,s=t.length;for(;r>0&&e.charCodeAt(~-r)===t.charCodeAt(~-s);)r--,s--;let n,a=0;for(;a<r&&e.charCodeAt(a)===t.charCodeAt(a);)a++;if(r-=a,s-=a,0===r)return s;let o,l,h=0,c=0,u=0;for(;c<r;)sf[c]=e.charCodeAt(a+c),rf[c]=++c;for(;u<s;)for(n=t.charCodeAt(a+u),o=u++,h=u,c=0;c<r;c++)l=n===sf[c]?o:o+1,o=rf[c],h=rf[c]=o>h?l>h?h+1:l:l>o?o+1:l;return h}function af(e){return null!=e}const of=function(){let{mobileTiers:e=[0,15,30,60],desktopTiers:t=[0,15,30,60],override:i={},glContext:r,failIfMajorPerformanceCaveat:s=!1,benchmarksURL:n="https://unpkg.com/detect-gpu@5.0.47/dist/benchmarks"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Qp(void 0,void 0,void 0,(function*(){const a={};if(Jp)return{tier:0,type:"SSR"};const{isIpad:o=!!(null==ef?void 0:ef.isIpad),isMobile:l=!!(null==ef?void 0:ef.isMobile),screenSize:h=window.screen,loadBenchmarks:c=e=>Qp(void 0,void 0,void 0,(function*(){const t=yield fetch(`${n}/${e}`).then((e=>e.json()));if(parseInt(t.shift().split(".")[0],10)<4)throw new tf("Detect GPU benchmark data is out of date. Please update to version 4x");return t}))}=i;let{renderer:u}=i;const d=(e,t,i,r,s)=>({device:s,fps:r,gpu:i,isMobile:l,tier:e,type:t});let _,p="";if(u)u=Zp(u),_=[u];else{const e=r||function(e){const t={alpha:!1,antialias:!1,depth:!1,failIfMajorPerformanceCaveat:arguments.length>1&&void 0!==arguments[1]&&arguments[1],powerPreference:"high-performance",stencil:!1};e&&delete t.powerPreference;const i=window.document.createElement("canvas"),r=i.getContext("webgl",t)||i.getContext("experimental-webgl",t);return null!=r?r:void 0}(null==ef?void 0:ef.isSafari12,s);if(!e)return d(0,"WEBGL_UNSUPPORTED");const t=(null==ef?void 0:ef.isFirefox)?null:e.getExtension("WEBGL_debug_renderer_info");if(u=t?e.getParameter(t.UNMASKED_RENDERER_WEBGL):e.getParameter(e.RENDERER),!u)return d(1,"FALLBACK");p=u,u=Zp(u),_=function(e,t,i){return"apple gpu"===t?function(e,t,i){if(!i)return[t];const r=function(e){const t=e.createShader(35633),i=e.createShader(35632),r=e.createProgram();if(!(i&&t&&r))return;e.shaderSource(t,"\n    precision highp float;\n    attribute vec3 aPosition;\n    varying float vvv;\n    void main() {\n      vvv = 0.31622776601683794;\n      gl_Position = vec4(aPosition, 1.0);\n    }\n  "),e.shaderSource(i,"\n    precision highp float;\n    varying float vvv;\n    void main() {\n      vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * vvv;\n      enc = fract(enc);\n      enc -= enc.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\n      gl_FragColor = enc;\n    }\n  "),e.compileShader(t),e.compileShader(i),e.attachShader(r,t),e.attachShader(r,i),e.linkProgram(r),e.detachShader(r,t),e.detachShader(r,i),e.deleteShader(t),e.deleteShader(i),e.useProgram(r);const s=e.createBuffer();e.bindBuffer(34962,s),e.bufferData(34962,new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),35044);const n=e.getAttribLocation(r,"aPosition");e.vertexAttribPointer(n,3,5126,!1,0,0),e.enableVertexAttribArray(n),e.clearColor(1,1,1,1),e.clear(16384),e.viewport(0,0,1,1),e.drawArrays(4,0,3);const a=new Uint8Array(4);return e.readPixels(0,0,1,1,6408,5121,a),e.deleteProgram(r),e.deleteBuffer(s),a.join("")}(e),s="801621810",n="8016218135",a="80162181161",o=(null==ef?void 0:ef.isIpad)?[["a7",a,12],["a8",n,15],["a8x",n,15],["a9",n,15],["a9x",n,15],["a10",n,15],["a10x",n,15],["a12",s,15],["a12x",s,15],["a12z",s,15],["a14",s,15],["a15",s,15],["m1",s,15],["m2",s,15]]:[["a7",a,12],["a8",n,12],["a9",n,15],["a10",n,15],["a11",s,15],["a12",s,15],["a13",s,15],["a14",s,15],["a15",s,15],["a16",s,15],["a17",s,15]];let l;return"80162181255"===r?l=o.filter((e=>{let[,,t]=e;return t>=14})):(l=o.filter((e=>{let[,t]=e;return t===r})),l.length||(l=o)),l.map((e=>{let[t]=e;return`apple ${t} gpu`}))}(e,t,i):[t]}(e,u,l)}const f=(yield Promise.all(_.map((function(e){var t;return Qp(this,void 0,void 0,(function*(){const i=(e=>{const t=l?["adreno","apple","mali-t","mali","nvidia","powervr","samsung"]:["intel","apple","amd","radeon","nvidia","geforce","adreno"];for(const i of t)if(e.includes(i))return i})(e);if(!i)return;const r=`${l?"m":"d"}-${i}${o?"-ipad":""}.json`,s=a[r]=null!==(t=a[r])&&void 0!==t?t:c(r);let n;try{n=yield s}catch(i){if(i instanceof tf)throw i;return}const u=function(e){var t;const i=(e=e.replace(/\([^)]+\)/,"")).match(/\d+/)||e.match(/(\W|^)([A-Za-z]{1,3})(\W|$)/g);return null!==(t=null==i?void 0:i.join("").replace(/\W|amd/g,""))&&void 0!==t?t:""}(e);let d=n.filter((e=>{let[,t]=e;return t===u}));d.length||(d=n.filter((t=>{let[i]=t;return i.includes(e)})));const _=d.length;if(0===_)return;const p=e.split(/[.,()\[\]/\s]/g).sort().filter(((e,t,i)=>0===t||e!==i[t-1])).join(" ");let f,[g,,,,m]=_>1?d.map((e=>[e,nf(p,e[2])])).sort(((e,t)=>{let[,i]=e,[,r]=t;return i-r}))[0][0]:d[0],b=Number.MAX_VALUE;const{devicePixelRatio:v}=window,y=h.width*v*h.height*v;for(const e of m){const[t,i]=e,r=t*i,s=Math.abs(y-r);s<b&&(b=s,f=e)}if(!f)return;const[,,T,x]=f;return[b,T,g,x]}))})))).filter(af).sort(((e,t)=>{let[i=Number.MAX_VALUE,r]=e,[s=Number.MAX_VALUE,n]=t;return i===s?r-n:i-s}));if(!f.length){const e=$p.find((e=>u.includes(e)));return e?d(0,"BLOCKLISTED",e):d(1,"FALLBACK",`${u} (${p})`)}const[,g,m,b]=f[0];if(-1===g)return d(0,"BLOCKLISTED",m,g,b);const v=l?e:t;let y=0;for(let e=0;e<v.length;e++)g>=v[e]&&(y=e);return d(y,"BENCHMARK",m,g,b)}))};var lf="",hf="function",cf="undefined",uf="object",df="string",_f="major",pf="model",ff="name",gf="type",mf="vendor",bf="version",vf="architecture",yf="console",Tf="mobile",xf="tablet",Af="smarttv",Cf="wearable",Rf="embedded",Ef="user-agent",Sf="brands",Mf="formFactors",Pf="fullVersionList",If="platform",Of="platformVersion",Df="bitness",wf="sec-ch-ua",Ff=wf+"-full-version-list",Lf=wf+"-arch",Bf=wf+"-"+Df,Nf=wf+"-form-factors",kf=wf+"-"+Tf,Uf=wf+"-"+pf,Vf=wf+"-"+If,zf=Vf+"-version",Gf=[Sf,Pf,Tf,pf,If,Of,vf,Mf,Df],Hf="browser",Wf="cpu",qf="device",Xf="engine",Kf="os",Yf="result",jf="Amazon",Qf="Apple",$f="ASUS",Zf="BlackBerry",Jf="Google",eg="Huawei",tg="Lenovo",ig="LG",rg="Microsoft",sg="Motorola",ng="Samsung",ag="Sharp",og="Sony",lg="Xiaomi",hg="Zebra",cg="Mobile ",ug=" Browser",dg="Chrome",_g="Firefox",pg="Opera",fg="Facebook",gg="Sogou",mg="Windows",bg=typeof window!==cf&&window.navigator?window.navigator:void 0,vg=bg&&bg.userAgentData?bg.userAgentData:void 0,yg=function(e){for(var t={},i=0;i<e.length;i++)t[e[i].toUpperCase()]=e[i];return t},Tg=function(e,t){if(typeof e===uf&&e.length>0){for(var i in e)if(Rg(e[i])==Rg(t))return!0;return!1}return!!Ag(e)&&-1!==Rg(t).indexOf(Rg(e))},xg=function(e,t){for(var i in e)return/^(browser|cpu|device|engine|os)$/.test(i)||!!t&&xg(e[i])},Ag=function(e){return typeof e===df},Cg=function(e){if(e){for(var t=[],i=Mg(/\\?\"/g,e).split(","),r=0;r<i.length;r++)if(i[r].indexOf(";")>-1){var s=Ig(i[r]).split(";v=");t[r]={brand:s[0],version:s[1]}}else t[r]=Ig(i[r]);return t}},Rg=function(e){return Ag(e)?e.toLowerCase():e},Eg=function(e){return Ag(e)?Mg(/[^\d\.]/g,e).split(".")[0]:void 0},Sg=function(e){for(var t in e){var i=e[t];typeof i==uf&&2==i.length?this[i[0]]=i[1]:this[i]=void 0}return this},Mg=function(e,t){return Ag(t)?t.replace(e,lf):t},Pg=function(e){return Mg(/\\?\"/g,e)},Ig=function(e,t){if(Ag(e))return e=Mg(/^\s\s*/,e),typeof t===cf?e:e.substring(0,500)},Og=function(e,t){if(e&&t)for(var i,r,s,n,a,o,l=0;l<t.length&&!a;){var h=t[l],c=t[l+1];for(i=r=0;i<h.length&&!a&&h[i];)if(a=h[i++].exec(e))for(s=0;s<c.length;s++)o=a[++r],typeof(n=c[s])===uf&&n.length>0?2===n.length?typeof n[1]==hf?this[n[0]]=n[1].call(this,o):this[n[0]]=n[1]:3===n.length?typeof n[1]!==hf||n[1].exec&&n[1].test?this[n[0]]=o?o.replace(n[1],n[2]):void 0:this[n[0]]=o?n[1].call(this,o,n[2]):void 0:4===n.length&&(this[n[0]]=o?n[3].call(this,o.replace(n[1],n[2])):void 0):this[n]=o||void 0;l+=2}},Dg=function(e,t){for(var i in t)if(typeof t[i]===uf&&t[i].length>0){for(var r=0;r<t[i].length;r++)if(Tg(t[i][r],e))return"?"===i?void 0:i}else if(Tg(t[i],e))return"?"===i?void 0:i;return t.hasOwnProperty("*")?t["*"]:e},wg={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Fg={embedded:"Automotive",mobile:"Mobile",tablet:["Tablet","EInk"],smarttv:"TV",wearable:"Watch",xr:["VR","XR"],"?":["Desktop","Unknown"],"*":void 0},Lg={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[bf,[ff,cg+"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[bf,[ff,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[ff,bf],[/opios[\/ ]+([\w\.]+)/i],[bf,[ff,pg+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[bf,[ff,pg+" GX"]],[/\bopr\/([\w\.]+)/i],[bf,[ff,pg]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[bf,[ff,"Baidu"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim)\s?(?:browser)?[\/ ]?([\w\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[ff,bf],[/\bddg\/([\w\.]+)/i],[bf,[ff,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[bf,[ff,"UCBrowser"]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[bf,[ff,"WeChat"]],[/konqueror\/([\w\.]+)/i],[bf,[ff,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[bf,[ff,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[bf,[ff,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[bf,[ff,"Smart "+tg+ug]],[/(avast|avg)\/([\w\.]+)/i],[[ff,/(.+)/,"$1 Secure"+ug],bf],[/\bfocus\/([\w\.]+)/i],[bf,[ff,_g+" Focus"]],[/\bopt\/([\w\.]+)/i],[bf,[ff,pg+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[bf,[ff,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[bf,[ff,"Dolphin"]],[/coast\/([\w\.]+)/i],[bf,[ff,pg+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[bf,[ff,"MIUI"+ug]],[/fxios\/([\w\.-]+)/i],[bf,[ff,cg+_g]],[/\bqihu|(qi?ho?o?|360)browser/i],[[ff,"360"+ug]],[/\b(qq)\/([\w\.]+)/i],[[ff,/(.+)/,"$1Browser"],bf],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[ff,/(.+)/,"$1"+ug],bf],[/samsungbrowser\/([\w\.]+)/i],[bf,[ff,ng+" Internet"]],[/(comodo_dragon)\/([\w\.]+)/i],[[ff,/_/g," "],bf],[/metasr[\/ ]?([\d\.]+)/i],[bf,[ff,gg+" Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[ff,gg+" Mobile"],bf],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345Explorer)[\/ ]?([\w\.]+)/i],[ff,bf],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[ff],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[ff,fg],bf],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[ff,bf],[/\bgsa\/([\w\.]+) .*safari\//i],[bf,[ff,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[bf,[ff,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[bf,[ff,dg+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[ff,dg+" WebView"],bf],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[bf,[ff,"Android"+ug]],[/chrome\/([\w\.]+) mobile/i],[bf,[ff,cg+"Chrome"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[ff,bf],[/version\/([\w\.\,]+) .*mobile(?:\/\w+ | ?)safari/i],[bf,[ff,cg+"Safari"]],[/iphone .*mobile(?:\/\w+ | ?)safari/i],[[ff,cg+"Safari"]],[/version\/([\w\.\,]+) .*(safari)/i],[bf,ff],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[ff,[bf,"1"]],[/(webkit|khtml)\/([\w\.]+)/i],[ff,bf],[/(?:mobile|tablet);.*(firefox)\/([\w\.-]+)/i],[[ff,cg+_g],bf],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[ff,"Netscape"],bf],[/(wolvic)\/([\w\.]+)/i],[ff,bf],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[bf,[ff,_g+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[ff,[bf,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[ff,[bf,/[^\d\.]+./,lf]]],cpu:[[/\b(?:(amd|x|x86[-_]?|wow|win)64)\b/i],[[vf,"amd64"]],[/(ia32(?=;))/i,/((?:i[346]|x)86)[;\)]/i],[[vf,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[vf,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[vf,"armhf"]],[/windows (ce|mobile); ppc;/i],[[vf,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[vf,/ower/,lf,Rg]],[/(sun4\w)[;\)]/i],[[vf,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[vf,Rg]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[pf,[mf,ng],[gf,xf]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[pf,[mf,ng],[gf,Tf]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[pf,[mf,Qf],[gf,Tf]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[pf,[mf,Qf],[gf,xf]],[/(macintosh);/i],[pf,[mf,Qf]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[pf,[mf,ag],[gf,Tf]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[pf,[mf,eg],[gf,xf]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[pf,[mf,eg],[gf,Tf]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[pf,/_/g," "],[mf,lg],[gf,Tf]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[pf,/_/g," "],[mf,lg],[gf,xf]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[pf,[mf,"OPPO"],[gf,Tf]],[/\b(opd2\d{3}a?) bui/i],[pf,[mf,"OPPO"],[gf,xf]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[pf,[mf,"Vivo"],[gf,Tf]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[pf,[mf,"Realme"],[gf,Tf]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[pf,[mf,sg],[gf,Tf]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[pf,[mf,sg],[gf,xf]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[pf,[mf,ig],[gf,xf]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[pf,[mf,ig],[gf,Tf]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[pf,[mf,tg],[gf,xf]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[pf,/_/g," "],[mf,"Nokia"],[gf,Tf]],[/(pixel c)\b/i],[pf,[mf,Jf],[gf,xf]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[pf,[mf,Jf],[gf,Tf]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[pf,[mf,og],[gf,Tf]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[pf,"Xperia Tablet"],[mf,og],[gf,xf]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[pf,[mf,"OnePlus"],[gf,Tf]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[pf,[mf,jf],[gf,xf]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[pf,/(.+)/g,"Fire Phone $1"],[mf,jf],[gf,Tf]],[/(playbook);[-\w\),; ]+(rim)/i],[pf,mf,[gf,xf]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[pf,[mf,Zf],[gf,Tf]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[pf,[mf,$f],[gf,xf]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[pf,[mf,$f],[gf,Tf]],[/(nexus 9)/i],[pf,[mf,"HTC"],[gf,xf]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[mf,[pf,/_/g," "],[gf,Tf]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[pf,[mf,"Acer"],[gf,xf]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[pf,[mf,"Meizu"],[gf,Tf]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[pf,[mf,"Ulefone"],[gf,Tf]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[mf,pf,[gf,Tf]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i],[mf,pf,[gf,xf]],[/(surface duo)/i],[pf,[mf,rg],[gf,xf]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[pf,[mf,"Fairphone"],[gf,Tf]],[/(shield[\w ]+) b/i],[pf,[mf,"Nvidia"],[gf,xf]],[/(sprint) (\w+)/i],[mf,pf,[gf,Tf]],[/(kin\.[onetw]{3})/i],[[pf,/\./g," "],[mf,rg],[gf,Tf]],[/droid.+; ([c6]+|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[pf,[mf,hg],[gf,xf]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[pf,[mf,hg],[gf,Tf]],[/smart-tv.+(samsung)/i],[mf,[gf,Af]],[/hbbtv.+maple;(\d+)/i],[[pf,/^/,"SmartTV"],[mf,ng],[gf,Af]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[mf,ig],[gf,Af]],[/(apple) ?tv/i],[mf,[pf,Qf+" TV"],[gf,Af]],[/crkey/i],[[pf,dg+"cast"],[mf,Jf],[gf,Af]],[/droid.+aft(\w+)( bui|\))/i],[pf,[mf,jf],[gf,Af]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[pf,[mf,ag],[gf,Af]],[/(bravia[\w ]+)( bui|\))/i],[pf,[mf,og],[gf,Af]],[/(mitv-\w{5}) bui/i],[pf,[mf,lg],[gf,Af]],[/Hbbtv.*(technisat) (.*);/i],[mf,pf,[gf,Af]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[mf,Ig],[pf,Ig],[gf,Af]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[gf,Af]],[/(ouya)/i,/(nintendo) (\w+)/i],[mf,pf,[gf,yf]],[/droid.+; (shield) bui/i],[pf,[mf,"Nvidia"],[gf,yf]],[/(playstation \w+)/i],[pf,[mf,og],[gf,yf]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[pf,[mf,rg],[gf,yf]],[/((pebble))app/i],[mf,pf,[gf,Cf]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[pf,[mf,Qf],[gf,Cf]],[/droid.+; (wt63?0{2,3})\)/i],[pf,[mf,hg],[gf,Cf]],[/droid.+; (glass) \d/i],[pf,[mf,Jf],[gf,"xr"]],[/(quest( \d| pro)?)/i],[pf,[mf,fg],[gf,"xr"]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[mf,[gf,Rf]],[/(aeobc)\b/i],[pf,[mf,jf],[gf,Rf]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[pf,[gf,Tf]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[pf,[gf,xf]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[gf,xf]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[gf,Tf]],[/(android[-\w\. ]{0,9});.+buil/i],[pf,[mf,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[bf,[ff,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[bf,[ff,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[ff,bf],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[bf,ff]],os:[[/microsoft (windows) (vista|xp)/i],[ff,bf],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[ff,[bf,Dg,wg]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[bf,Dg,wg],[ff,mg]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[bf,/_/g,"."],[ff,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[ff,"macOS"],[bf,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[bf,ff],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[ff,bf],[/\(bb(10);/i],[bf,[ff,Zf]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[bf,[ff,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[bf,[ff,_g+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[bf,[ff,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[bf,[ff,"watchOS"]],[/crkey\/([\d\.]+)/i],[bf,[ff,dg+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[ff,"Chrome OS"],bf],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) (\w+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[ff,bf],[/(sunos) ?([\w\.\d]*)/i],[[ff,"Solaris"],bf],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[ff,bf]]},Bg=function(){var e={init:{},isIgnore:{},isIgnoreRgx:{},toString:{}};return Sg.call(e.init,[[Hf,[ff,bf,_f,gf]],[Wf,[vf]],[qf,[gf,pf,mf]],[Xf,[ff,bf]],[Kf,[ff,bf]]]),Sg.call(e.isIgnore,[[Hf,[bf,_f]],[Xf,[bf]],[Kf,[bf]]]),Sg.call(e.isIgnoreRgx,[[Hf,/ ?browser$/i],[Kf,/ ?os$/i]]),Sg.call(e.toString,[[Hf,[ff,bf]],[Wf,[vf]],[qf,[mf,pf]],[Xf,[ff,bf]],[Kf,[ff,bf]]]),e}(),Ng=function(e,t){var i=Bg.init[t],r=Bg.isIgnore[t]||0,s=Bg.isIgnoreRgx[t]||0,n=Bg.toString[t]||0;function a(){Sg.call(this,i)}return a.prototype.getItem=function(){return e},a.prototype.withClientHints=function(){return vg?vg.getHighEntropyValues(Gf).then((function(t){return e.setCH(new kg(t,!1)).parseCH().get()})):e.parseCH().get()},a.prototype.withFeatureCheck=function(){return e.detectFeature().get()},t!=Yf&&(a.prototype.is=function(e){var t=!1;for(var i in this)if(this.hasOwnProperty(i)&&!Tg(r,i)&&Rg(s?Mg(s,this[i]):this[i])==Rg(s?Mg(s,e):e)){if(t=!0,e!=cf)break}else if(e==cf&&t){t=!t;break}return t},a.prototype.toString=function(){var e=lf;for(var t in n)typeof this[n[t]]!==cf&&(e+=(e?" ":lf)+this[n[t]]);return e||cf}),vg||(a.prototype.then=function(e){var t=this,i=function(){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e])};i.prototype={is:a.prototype.is,toString:a.prototype.toString};var r=new i;return e(r),r}),new a};function kg(e,t){if(e=e||{},Sg.call(this,Gf),t)Sg.call(this,[[Sf,Cg(e[wf])],[Pf,Cg(e[Ff])],[Tf,/\?1/.test(e[kf])],[pf,Pg(e[Uf])],[If,Pg(e[Vf])],[Of,Pg(e[zf])],[vf,Pg(e[Lf])],[Mf,Cg(e[Nf])],[Df,Pg(e[Bf])]]);else for(var i in e)this.hasOwnProperty(i)&&typeof e[i]!==cf&&(this[i]=e[i])}function Ug(e,t,i,r){return this.get=function(e){return e?this.data.hasOwnProperty(e)?this.data[e]:void 0:this.data},this.set=function(e,t){return this.data[e]=t,this},this.setCH=function(e){return this.uaCH=e,this},this.detectFeature=function(){if(bg&&bg.userAgent==this.ua)switch(this.itemType){case Hf:bg.brave&&typeof bg.brave.isBrave==hf&&this.set(ff,"Brave");break;case qf:!this.get(gf)&&vg&&vg[Tf]&&this.set(gf,Tf),"Macintosh"==this.get(pf)&&bg&&typeof bg.standalone!==cf&&bg.maxTouchPoints&&bg.maxTouchPoints>2&&this.set(pf,"iPad").set(gf,xf);break;case Kf:!this.get(ff)&&vg&&vg[If]&&this.set(ff,vg[If]);break;case Yf:var e=this.data,t=function(t){return e[t].getItem().detectFeature().get()};this.set(Hf,t(Hf)).set(Wf,t(Wf)).set(qf,t(qf)).set(Xf,t(Xf)).set(Kf,t(Kf))}return this},this.parseUA=function(){return this.itemType!=Yf&&Og.call(this.data,this.ua,this.rgxMap),this.itemType==Hf&&this.set(_f,Eg(this.get(bf))),this},this.parseCH=function(){var e=this.uaCH,t=this.rgxMap;switch(this.itemType){case Hf:var i,r=e[Pf]||e[Sf];if(r)for(var s in r){var n=Mg(/(Google|Microsoft) /,r[s].brand||r[s]),a=r[s].version;/not.a.brand/i.test(n)||i&&(!/chrom/i.test(i)||/chromi/i.test(n))||(this.set(ff,n).set(bf,a).set(_f,Eg(a)),i=n)}break;case Wf:var o=e[vf];o&&(o&&"64"==e[Df]&&(o+="64"),Og.call(this.data,o+";",t));break;case qf:if(e[Tf]&&this.set(gf,Tf),e[pf]&&this.set(pf,e[pf]),"Xbox"==e[pf]&&this.set(gf,yf).set(mf,rg),e[Mf]){var l;if("string"!==typeof e[Mf])for(var h=0;!l&&h<e[Mf].length;)l=Dg(e[Mf][h++],Fg);else l=Dg(e[Mf],Fg);this.set(gf,l)}break;case Kf:var c=e[If];if(c){var u=e[Of];c==mg&&(u=parseInt(Eg(u),10)>=13?"11":"10"),this.set(ff,c).set(bf,u)}this.get(ff)==mg&&"Xbox"==e[pf]&&this.set(ff,"Xbox").set(bf,void 0);break;case Yf:var d=this.data,_=function(t){return d[t].getItem().setCH(e).parseCH().get()};this.set(Hf,_(Hf)).set(Wf,_(Wf)).set(qf,_(qf)).set(Xf,_(Xf)).set(Kf,_(Kf))}return this},Sg.call(this,[["itemType",e],["ua",t],["uaCH",r],["rgxMap",i],["data",Ng(this,e)]]),this}function Vg(e,t,i){if(typeof e===uf?(xg(e,!0)?(typeof t===uf&&(i=t),t=e):(i=e,t=void 0),e=void 0):typeof e!==df||xg(t,!0)||(i=t,t=void 0),!(this instanceof Vg))return new Vg(e,t,i).getResult();var r=typeof e===df?e:bg&&bg.userAgent?bg.userAgent:i&&i[Ef]?i[Ef]:lf,s=new kg(i,!0),n=t?function(e,t){var i={},r=t;if(!xg(t))for(var s in r={},t)for(var n in t[s])r[n]=t[s][n].concat(r[n]?r[n]:[]);for(var a in e)i[a]=r[a]&&r[a].length%2===0?r[a].concat(e[a]):e[a];return i}(Lg,t):Lg,a=function(e){return e==Yf?function(){return new Ug(e,r,n,s).set("ua",r).set(Hf,this.getBrowser()).set(Wf,this.getCPU()).set(qf,this.getDevice()).set(Xf,this.getEngine()).set(Kf,this.getOS()).get()}:function(){return new Ug(e,r,n[e],s).parseUA().get()}};return Sg.call(this,[["getBrowser",a(Hf)],["getCPU",a(Wf)],["getDevice",a(qf)],["getEngine",a(Xf)],["getOS",a(Kf)],["getResult",a(Yf)],["getUA",function(){return r}],["setUA",function(e){return Ag(e)&&(r=e.length>500?Ig(e,500):e),this}]]).setUA(r),this}Vg.VERSION="2.0.0-beta.3",Vg.BROWSER=yg([ff,bf,_f,gf]),Vg.CPU=yg([vf]),Vg.DEVICE=yg([pf,mf,gf,yf,Tf,Af,xf,Cf,Rf]),Vg.ENGINE=Vg.OS=yg([ff,bf]);const zg={device:[[/(Mujin)\/[\d.]+ \((pendant|hmi)\w+\)/],[Vg.DEVICE.VENDOR,Vg.DEVICE.MODEL]]},Gg=()=>{const[t,i]=(0,e.useState)();(0,e.useEffect)((()=>{(async()=>{const e=await of();i(e)})()}),[]);const r=new Vg(zg).setUA(window.navigator.userAgent).getResult();return(0,Wp.jsxs)("div",{className:"container",children:[(0,Wp.jsx)("p",{children:"Hardware"}),(0,Wp.jsxs)("div",{className:"instrumentation",children:[(0,Wp.jsx)(qp,{title:"browser",items:[{label:"Name",value:r.browser.name},{label:"Version",value:r.browser.version},{label:"Engine",value:r.engine.name}]}),(0,Wp.jsx)(qp,{title:"OS",items:[{label:"Name",value:r.os.name},{label:"Version",value:r.os.version}]}),(0,Wp.jsx)(qp,{title:"Device",items:[{label:"Vendor",value:r.device.vendor},{label:"Modal",value:r.device.model},{label:"Type",value:r.device.type}]}),(0,Wp.jsx)(qp,{title:"CPU",items:[{label:"architecture",value:r.cpu.architecture}]}),(0,Wp.jsx)(qp,{title:"GTP",items:[{label:"model",value:null===t||void 0===t?void 0:t.gpu},{label:"tier",value:null===t||void 0===t?void 0:t.tier}]})]})]})};const Hg=function(){return(0,Wp.jsxs)("div",{className:"app",children:[(0,Wp.jsx)(Gg,{}),(0,Wp.jsx)(Kp,{})]})},Wg=e=>{e&&e instanceof Function&&i.e(453).then(i.bind(i,6453)).then((t=>{let{getCLS:i,getFID:r,getFCP:s,getLCP:n,getTTFB:a}=t;i(e),r(e),s(e),n(e),a(e)}))};r.createRoot(document.getElementById("root")).render((0,Wp.jsx)(e.StrictMode,{children:(0,Wp.jsx)(Hg,{})})),Wg()})()})();
//# sourceMappingURL=main.6643967f.js.map